<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Copy ALL the CSS from your dashboard.ejs file here */
        :root {
            --tg-body-font-family: 'Inter', serif;
            --tg-heading-font-family: 'Inter', serif;
            --tg-icon-font-family: "Font Awesome 5 Free";
            --tg-body-font-size: 16px;
            --tg-body-color: #9E9E9E;
            --tg-heading-color: #ffffff;
            --tg-theme-primary: #4b59f5;
            --tg-color-dark: #0C0C0C;
            --tg-color-dark-2: #000000;
            --tg-color-dark-3: #262626;
            --tg-border-1: #363636;
        }
        /* Include ALL the CSS styles from your dashboard.ejs */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--tg-body-font-family); font-size: var(--tg-body-font-size); color: var(--tg-body-color); background: var(--tg-color-dark); }
        .admin-wrapper { display: flex; min-height: 100vh; }
        .admin-sidebar { width: 280px; background: var(--tg-color-dark-2); border-right: 1px solid var(--tg-border-1); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--tg-border-1); }
        .logo-text { font-size: 24px; font-weight: 800; color: white; text-decoration: none; letter-spacing: 2.5px; text-transform: uppercase; display: block; text-align: center; }
        .sidebar-nav { flex: 1; padding: 20px 0; }
        .sidebar-nav ul { list-style: none; }
        .sidebar-nav li { margin-bottom: 5px; }
        .nav-link { display: flex; align-items: center; padding: 12px 20px; color: var(--tg-body-color); text-decoration: none; transition: all 0.3s; border-left: 3px solid transparent; }
        .nav-link:hover { background: var(--tg-color-dark-3); color: var(--tg-heading-color); }
        .nav-link.active { background: var(--tg-color-dark-3); color: var(--tg-theme-primary); border-left-color: var(--tg-theme-primary); }
        .nav-link i { width: 24px; margin-right: 12px; font-size: 16px; }
        .sidebar-footer { padding: 20px; border-top: 1px solid var(--tg-border-1); }
        .admin-main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background: var(--tg-color-dark-2); border-bottom: 1px solid var(--tg-border-1); }
        .header-left { display: flex; align-items: center; }
        .sidebar-toggle { background: none; border: none; color: var(--tg-heading-color); font-size: 18px; margin-right: 20px; cursor: pointer; padding: 5px; border-radius: 5px; }
        .admin-header h1 { font-size: 24px; font-weight: 700; color: var(--tg-heading-color); }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .admin-name { color: var(--tg-heading-color); font-weight: 500; }
        .badge { background: var(--tg-theme-primary); color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .admin-content { flex: 1; padding: 30px; overflow-y: auto; }
        .alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; }
        .alert-error { background: rgba(220, 53, 69, 0.1); border: 1px solid rgba(220, 53, 69, 0.3); color: #dc3545; }
        .alert-success { background: rgba(40, 167, 69, 0.1); border: 1px solid rgba(40, 167, 69, 0.3); color: #28a745; }
        .card { background: var(--tg-color-dark-2); border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); margin-bottom: 30px; overflow: hidden; }
        .card-header { padding: 20px 25px; border-bottom: 1px solid var(--tg-border-1); display: flex; justify-content: space-between; align-items: center; }
        .card-header h2 { font-size: 20px; font-weight: 600; color: var(--tg-heading-color); }
        .tg-btn { background: var(--tg-theme-primary); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 500; }
        .card-body { padding: 25px; }
        .table-responsive { overflow-x: auto; }
        .admin-table { width: 100%; border-collapse: collapse; }
        .admin-table th { text-align: left; padding: 12px 15px; font-weight: 600; color: var(--tg-heading-color); border-bottom: 1px solid var(--tg-border-1); }
        .admin-table td { padding: 12px 15px; border-bottom: 1px solid var(--tg-border-1); }
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-badge.pending { background: rgba(255, 193, 7, 0.1); color: #ffc107; }
        .status-badge.completed { background: rgba(40, 167, 69, 0.1); color: #28a745; }
        .status-badge.rejected { background: rgba(220, 53, 69, 0.1); color: #dc3545; }
        .action-buttons { display: flex; gap: 8px; }
        .btn-icon { width: 32px; height: 32px; border-radius: 6px; background: var(--tg-color-dark-3); display: flex; align-items: center; justify-content: center; color: var(--tg-body-color); text-decoration: none; }
       
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <a href="/admin" class="logo-text">QFS ADMIN</a>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/admin" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                    </a></li>
                    <li><a href="/admin/users" class="nav-link">
                        <i class="fas fa-users"></i> <span>Users</span>
                    </a></li>
                    <li><a href="/admin/transactions" class="nav-link active">
                        <i class="fas fa-exchange-alt"></i> <span>Transactions</span>
                    </a></li>
                    <li><a href="/admin/investments" class="nav-link">
                        <i class="fas fa-chart-line"></i> <span>Investments</span>
                    </a></li>
                    <li><a href="/admin/tickets" class="nav-link">
                        <i class="fas fa-ticket-alt"></i> <span>Support Tickets</span>
                    </a></li>
                    <li><a href="/admin/users/balances" class="nav-link">
                        <i class="fas fa-wallet"></i> <span>User Balances</span>
                    </a></li>
                    <li><a href="/admin/pending-deposits" class="nav-link">
                        <i class="fas fa-money-bill-wave"></i> <span>Pending Deposits</span>
                    </a></li>
                    <li><a href="/admin/pending-withdrawals" class="nav-link">
                        <i class="fas fa-hand-holding-usd"></i> <span>Pending Withdrawals</span>
                    </a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="/dashboard" class="nav-link">
                    <i class="fas fa-arrow-left"></i> <span>Back to Site</span>
                </a>
                <a href="/auth/logout" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1><%= title %></h1>
                </div>
                <div class="header-right">
                    <span class="admin-name">Welcome, <%= user.firstName %> <%= user.lastName %></span>
                    <span class="admin-role badge"><%= user.role %></span>
                </div>
            </header>

            <div class="admin-content">

<!-- User Info Header -->
<div class="user-info-section mb-4 p-3 bg-light rounded">
  <div class="d-flex justify-content-between align-items-center">
    <div>

<!-- Transactions Container -->
<div id="transactionsContainer">
  <% if (transactions && transactions.length > 0) { %>
    <% transactions.forEach((transaction, index) => { %>
      <!-- Transaction Card - Clickable to open modal -->
      <div class="transaction-card border rounded p-3 mb-3 cursor-pointer" 
           data-bs-toggle="modal" 
           data-bs-target="#transactionModal<%= transaction._id %>">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="mb-0 f-15 gilroy-medium text-dark">
              <%= transaction.type %> 
              <span class="text-muted">|</span> 
              <%= transaction.status %>
              <% if (['admin_credit', 'admin_debit', 'system'].includes(transaction.type)) { %>
                <span class="badge bg-info ms-2">Admin</span>
              <% } %>
            </p>
            <p class="mb-0 text-gray-100 f-13">
              <%= transaction.createdAt ? new Date(transaction.createdAt).toLocaleDateString() : 'Unknown Date' %>
              <% if (transaction.userId && transaction.userId.role && ['admin', 'superadmin'].includes(transaction.userId.role)) { %>
                <span class="text-info"> â€¢ By Admin</span>
              <% } %>
            </p>
          </div>
          <p class="mb-0 f-15 gilroy-semibold 
            <%= transaction.type === 'admin_credit' ? 'text-success' : 
                transaction.type === 'admin_debit' ? 'text-danger' : 'text-primary' %>">
            <%= transaction.type === 'admin_debit' ? '-' : '' %><%= transaction.currency %> <%= transaction.amount.toLocaleString() %>
          </p>
        </div>
      </div>

      <!-- Dynamic Modal for each transaction -->
      <div class="modal fade modal-overly" id="transactionModal<%= transaction._id %>" tabindex="-1" aria-hidden="true">
        <div class="transac modal-dialog modal-dialog-centered modal-lg res-dialog">
          <div class="modal-content modal-transac transaction-modal">
            <div class="modal-body modal-themeBody">
              <div class="d-flex position-relative modal-res">
                <button type="button" class="cursor-pointer close-btn" data-bs-dismiss="modal" aria-label="Close">
                  <svg class="position-absolute close-btn text-gray-100" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.24408 5.24408C5.56951 4.91864 6.09715 4.91864 6.42259 5.24408L10 8.82149L13.5774 5.24408C13.9028 4.91864 14.4305 4.91864 14.7559 5.24408C15.0814 5.56951 15.0814 6.09715 14.7559 6.42259L11.1785 10L14.7559 13.5774C15.0814 13.9028 15.0814 14.4305 14.7559 14.7559C14.4305 15.0814 13.9028 15.0814 13.5774 14.7559L10 11.1785L6.42259 14.7559C6.09715 15.0814 5.56951 15.0814 5.24408 14.7559C4.91864 14.4305 4.91864 13.9028 5.24408 13.5774L8.82149 10L5.24408 6.42259C4.91864 6.09715 4.91864 5.56951 5.24408 5.24408Z" fill="currentColor"></path>
                  </svg>
                </button>
                <div class="deposit-transac d-flex flex-column justify-content-center p-4 text-wrap">
                  <div class="d-flex justify-content-center text-primary align-items-center transac-img">
                    <img src="/images/transactions/<%= transaction.type %>.svg" alt="<%= transaction.type %>" class="img-fluid" onerror="this.src='/images/transactions/default.svg'">
                  </div>
                  <p class="mb-0 mt-28 text-dark gilroy-medium f-15 r-f-12 r-mt-18 text-center">
                    <%= transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1) %> Amount
                  </p>
                  <p class="mb-0 text-dark gilroy-Semibold f-24 leading-29 r-f-26 text-center l-s2 mt-10">
                    <%= transaction.currency %> <%= transaction.amount.toLocaleString() %>
                  </p>
                  <p class="mb-0 mt-18 text-gray-100 gilroy-medium f-13 leading-20 r-f-14 text-center">
                    <%= transaction.createdAt ? new Date(transaction.createdAt).toLocaleString() : 'Unknown Date' %>
                    <% if (transaction.userId && transaction.userId.role && ['admin', 'superadmin'].includes(transaction.userId.role)) { %>
                      <br><span class="text-info">Initiated by Administrator</span>
                    <% } %>
                  </p>
                  <div class="d-flex justify-content-center">
                    <a href="/transactions/print/<%= transaction._id %>" class="infoBtn-print cursor-pointer f-14 gilroy-medium text-dark mt-35 d-flex justify-content-center align-items-center" target="_blank">
                      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.15385 16.5H13.8462V13.5H4.15385V16.5ZM4.15385 9H13.8462V4.5H12.1154C11.8269 4.5 11.5817 4.39062 11.3798 4.17188C11.1779 3.95312 11.0769 3.6875 11.0769 3.375V1.5H4.15385V9ZM16.6154 9.75C16.6154 9.54688 16.5469 9.37109 16.4099 9.22266C16.2728 9.07422 16.1106 9 15.9231 9C15.7356 9 15.5733 9.07422 15.4363 9.22266C15.2993 9.37109 15.2308 9.54688 15.2308 9.75C15.2308 9.95312 15.2993 10.1289 15.4363 10.2773C15.5733 10.4258 15.7356 10.5 15.9231 10.5C16.1106 10.5 16.2728 10.4258 16.4099 10.2773C16.5469 10.1289 16.6154 9.95312 16.6154 9.75ZM18 9.75V14.625C18 14.7266 17.9657 14.8145 17.8972 14.8887C17.8287 14.9629 17.7476 15 17.6538 15H15.2308V16.875C15.2308 17.1875 15.1298 17.4531 14.9279 17.6719C14.726 17.8906 14.4808 18 14.1923 18H3.80769C3.51923 18 3.27404 17.8906 3.07212 17.6719C2.87019 17.4531 2.76923 17.1875 2.76923 16.875V15H0.346154C0.252404 15 0.171274 14.9629 0.102764 14.8887C0.0342548 14.8145 0 14.7266 0 14.625V9.75C0 9.13281 0.203726 8.60352 0.611178 8.16211C1.01863 7.7207 1.50721 7.5 2.07692 7.5H2.76923V1.125C2.76923 0.8125 2.87019 0.546875 3.07212 0.328125C3.27404 0.109375 3.51923 0 3.80769 0H11.0769C11.3654 0 11.6827 0.078125 12.0288 0.234375C12.375 0.390625 12.649 0.578125 12.851 0.796875L14.4952 2.57812C14.6971 2.79688 14.8702 3.09375 15.0144 3.46875C15.1587 3.84375 15.2308 4.1875 15.2308 4.5V7.5H15.9231C16.4928 7.5 16.9814 7.7207 17.3888 8.16211C17.7963 8.60352 18 9.13281 18 9.75Z" fill="currentColor"></path>
                      </svg>&nbsp;
                      <span>Print</span>
                    </a>
                  </div>
                </div>
                <div class="ml-20 trans-details">
                  <p class="mb-0 mt-9 text-dark dark-5B f-20 gilroy-Semibold transac-title">Transaction Details</p>

                  <div class="row gx-sm-5">
                    <div class="col-6">
                      <p class="mb-0 mt-4 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">
                        <%= transaction.type === 'send' ? 'Sent To' : 
                           transaction.type === 'admin_credit' ? 'Credited By' :
                           transaction.type === 'admin_debit' ? 'Debited By' : 'Received From' %>
                      </p>
                      <p class="mb-0 mt-5p text-dark gilroy-medium f-15 leading-22 r-text">
                        <% if (transaction.type === 'send' && transaction.recipientId) { %>
                          <%= transaction.recipientId.firstName %> <%= transaction.recipientId.lastName %>
                        <% } else if (transaction.type === 'receive' && transaction.userId) { %>
                          <%= transaction.userId.firstName %> <%= transaction.userId.lastName %>
                        <% } else if (['admin_credit', 'admin_debit', 'system'].includes(transaction.type)) { %>
                          System Administrator
                        <% } else { %>
                          <%= user.firstName %> <%= user.lastName %>
                        <% } %>
                      </p>
                    </div>
                    <div class="col-6">
                      <p class="mb-0 mt-4 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Currency</p>
                      <p class="mb-0 mt-5p text-dark gilroy-medium f-15 leading-22 r-text"><%= transaction.currency %></p>
                    </div>
                  </div>
                  <div class="row gx-sm-5">
                    <div class="col-6">
                      <p class="mb-0 mt-20 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Transaction ID</p>
                      <p class="mb-0 mt-5p text-dark gilroy-medium f-15 leading-22 r-text"><%= transaction._id.toString().substring(0, 13).toUpperCase() %></p>
                    </div>
                    <div class="col-6">
                      <p class="mb-0 mt-20 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Transaction Fee</p>
                      <p class="mb-0 mt-5p text-dark gilroy-medium f-15 leading-22 r-text">
                        <%= transaction.fee ? `${transaction.currency} ${transaction.fee.toLocaleString()}` : '-' %>
                      </p>
                    </div>
                  </div>
                  <div class="row gx-sm-5">
                    <div class="col-6">
                      <p class="mb-0 mt-20 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Payment Method</p>
                      <p class="mb-0 mt-5p text-dark gilroy-medium f-15 leading-22 r-text">
                        <%= transaction.method ? transaction.method.charAt(0).toUpperCase() + transaction.method.slice(1) : 
                           ['admin_credit', 'admin_debit', 'system'].includes(transaction.type) ? 'System' : 'Manual' %>
                      </p>
                    </div>
                    <div class="col-6">
                      <p class="mb-0 mt-20 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Status</p>
                      <p class="mb-0 mt-5p 
                        <%= transaction.status === 'completed' ? 'text-success' : 
                           transaction.status === 'pending' ? 'text-warning' : 'text-danger' %> 
                        gilroy-medium f-15 leading-22 r-text">
                        <%= transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1) %>
                      </p>
                    </div>
                  </div>
                  <p class="hr-border w-100 mb-0"></p>
                  <div class="row gx-sm-5">
                    <div class="col-6">
                      <p class="mb-0 mt-4 text-gray-100 dark-B87 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">
                        <%= transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1) %> Amount
                      </p>
                      <p class="mb-0 mt-5p text-dark dark-CDO gilroy-medium f-15 leading-22 r-text">
                        <%= transaction.currency %> <%= transaction.amount.toLocaleString() %>
                      </p>
                    </div>
                    <div class="col-6">
                      <p class="mb-0 mt-4 text-gray-100 dark-B87 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Total Amount</p>
                      <p class="mb-0 mt-5p text-dark dark-CDO gilroy-medium f-15 leading-22 r-text">
                        <%= transaction.currency %> 
                        <%= (transaction.amount + (transaction.fee || 0)).toLocaleString() %>
                      </p>
                    </div>
                  </div>
                  
                  <!-- Transaction Description -->
                  <% if (transaction.description) { %>
                    <div class="row gx-sm-5">
                      <div class="col-12">
                        <p class="mb-0 mt-20 text-gray-100 gilroy-medium f-13 leading-20 r-f-9 r-mt-11">Description</p>
                        <p class="mb-0 mt-5p text-dark gilroy-medium f-15 leading-22 r-text"><%= transaction.description %></p>
                      </div>
                    </div>
                  <% } %>

                  <!-- Admin Transaction Note -->
                  <% if (['admin_credit', 'admin_debit', 'system'].includes(transaction.type)) { %>
                    <div class="row gx-sm-5">
                      <div class="col-12">
                        <p class="mb-0 mt-20 text-info gilroy-medium f-13 leading-20 r-f-9 r-mt-11">
                          <i class="fas fa-info-circle"></i> Admin Transaction
                        </p>
                        <p class="mb-0 mt-5p text-info gilroy-medium f-12 leading-18 r-text">
                          This transaction was processed by system administration.
                        </p>
                      </div>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <div class="text-center py-5">
      <p class="mt-2 text-gray-100">No transactions found for <%= userEmail %>.</p>
    </div>
  <% } %>
</div>

<!-- Load More Button -->
<div id="loadMoreContainer" class="text-center mt-4 <%= (transactions && transactions.length > 5) ? '' : 'd-none' %>">
  <button id="loadMoreBtn" class="btn btn-outline-primary">Load More Transactions</button>
</div>

<style>
.cursor-pointer {
  cursor: pointer;
}
.cursor-pointer:hover {
  background-color: #f8f9fa;
}
</style>
    
<div class="mt-4">
    
</div>

    <script>
        // Copy the same JavaScript from your dashboard.ejs
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.querySelector('.admin-wrapper').classList.toggle('sidebar-collapsed');
        });
    </script>
</body>
</html>