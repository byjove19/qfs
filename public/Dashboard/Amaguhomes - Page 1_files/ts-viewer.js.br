
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="59640c47-b740-5ab3-9686-7a0a662009b5")}catch(e){}}();
(()=>{var KM=Object.create;var Mh=Object.defineProperty;var YM=Object.getOwnPropertyDescriptor;var QM=Object.getOwnPropertyNames;var qM=Object.getPrototypeOf,XM=Object.prototype.hasOwnProperty;var Jt=(t,e)=>()=>(t&&(e=t(t=0)),e);var rc=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ya=(t,e)=>{for(var r in e)Mh(t,r,{get:e[r],enumerable:!0})},zN=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of QM(e))!XM.call(t,o)&&o!==r&&Mh(t,o,{get:()=>e[o],enumerable:!(n=YM(e,o))||n.enumerable});return t};var Ja=(t,e,r)=>(r=t!=null?KM(qM(t)):{},zN(e||!t||!t.__esModule?Mh(r,"default",{value:t,enumerable:!0}):r,t)),Oi=t=>zN(Mh({},"__esModule",{value:!0}),t);var KN={};ya(KN,{ByteBuffer:()=>ho});var FA,WN,ho,Xu=Jt(()=>{FA=new Int32Array(1),WN=new Float32Array(FA.buffer),ho=class t{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new t(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),r=this._index,n=r+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let o=new Uint8Array(e);return o.set(this._data.subarray(r,n)),o}readVarFloat(){let e=this._index,r=this._data,n=r.length;if(e+1>n)throw new Error("Index out of bounds");let o=r[e];if(o===0)return this._index=e+1,0;if(e+4>n)throw new Error("Index out of bounds");let i=o|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24;return this._index=e+4,i=i<<23|i>>>9,FA[0]=i,WN[0]}readVarUint(){let e=0,r=0;do{var n=this.readByte();e|=(n&127)<<r,r+=7}while(n&128&&r<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,r="";do{var n=this.readByte();if(e<8){let o=((n&127)>>>0).toString(2);r=(n&128?o.padStart(7,"0"):o)+r}else{r=n.toString(2)+r;break}e+=1}while(n&128);return r}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let r=this.parseToDigitsArray(e.slice(0,-1),2);return r=this.add(r,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(r,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let r,n=this.readByte();if(n<192)r=n;else{let o=this.readByte();if(n<224)r=(n&31)<<6|o&63;else{let i=this.readByte();if(n<240)r=(n&15)<<12|(o&63)<<6|i&63;else{let a=this.readByte();r=(n&7)<<18|(o&63)<<12|(i&63)<<6|a&63}}}if(r===0)break;r<65536?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let r=new Uint8Array(this.length+e<<1);r.set(this._data),this._data=r}this.length+=e}writeByte(e){let r=this.length;this._growBy(1),this._data[r]=e}overwriteByte(e){this._data[this._index]=e,this._index+=1}writeByteArray(e){this.writeVarUint(e.length);let r=this.length;this._growBy(e.length),this._data.set(e,r)}writeVarFloat(e){let r=this.length;WN[0]=e;let n=FA[0];if(n=n>>>23|n<<9,(n&255)===0){this.writeByte(0);return}this._growBy(4);let o=this._data;o[r]=n,o[r+1]=n>>8,o[r+2]=n>>16,o[r+3]=n>>24}writeVarUint(e){do{let r=e&127;e>>>=7,this.writeByte(e?r|128:r)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(e){var r=0;do{if(r<8){var n=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var n=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(n);break}this.writeByte(e?n|128:n),r+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let r=this.convertBase(e,10,2);this.writeVarUint64Helper(r)}subtractOne(e){let r=1,n=e.split("").map(Number);for(let o=n.length-1;o>=0;o--)if(n[o]<r)n[o]=1;else{n[o]--,r=0;break}return n.join("").replace(/^0+/,"")}cleanNumericString(e){let r="";for(let n=0;n<e.length;n++){let o=e.charAt(n);(o>="0"&&o<="9"||n===0&&o==="-")&&(r+=o)}return r}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var r=this.convertBase(e,10,2)+"0";else{var r=this.convertBase(e.slice(1),10,2);if(r=="0"||r==""){this.writeVarUint64("0");return}r=this.subtractOne(r)+"1"}this.writeVarUint64Helper(r)}}add(e,r,n){let o=[],i=Math.max(e.length,r.length),a=0,s=0;for(;s<i||a;){let l=s<e.length?e[s]:0,c=s<r.length?r[s]:0,d=a+l+c;o.push(d%n),a=Math.floor(d/n),s++}return o}multiplyByNumber(e,r,n){if(e<0)return[];if(e===0)return[];let o=[],i=r;for(;e&1&&(o=this.add(o,i,n)),e=e>>1,e!==0;)i=this.add(i,i,n);return o}parseToDigitsArray(e,r){let n=e.toString().split(""),o=[];for(let i=n.length-1;i>=0;i--){let a=parseInt(n[i],r);if(isNaN(a))return[];o.push(a)}return o}parseFromDigitsArray(e,r){let n="";for(let o=e.length-1;o>=0;o--)n+=e[o].toString(r);return n}convertBase(e,r,n){let o=this.parseToDigitsArray(e,r);if(o===null)return"";let i=[0],a=[1];for(let s=0;s<o.length;s++)o[s]&&(i=this.add(i,this.multiplyByNumber(o[s],a,n),n)),a=this.multiplyByNumber(r,a,n);return this.parseFromDigitsArray(i,n)}writeString(e){let r;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);if(n+1===e.length||o<55296||o>=56320)r=o;else{let i=e.charCodeAt(++n);r=(o<<10)+i+-56613888}if(r===0)throw new Error("Cannot encode a string containing the null character");r<128?this.writeByte(r):(r<2048?this.writeByte(r>>6&31|192):(r<65536?this.writeByte(r>>12&15|224):(this.writeByte(r>>18&7|240),this.writeByte(r>>12&63|128)),this.writeByte(r>>6&63|128)),this.writeByte(r&63|128))}this.writeByte(0)}redactString(e){let r=this._index,n=this.readString(),o=this._index,i=n.length>=2&&n[0]==='"'&&n[n.length-1]==='"',a=i?n.substring(1,n.length-1):n;if(e.test(a.toLowerCase()))return;let s="*".repeat(o-r-1),l=d=>d<=127;if(i)s=`"${s.substring(1,s.length-1)}"`;else if(s.length>=2){let d=n.charAt(0),u=n.charAt(n.length-1);l(d.charCodeAt(0))&&l(u.charCodeAt(0))&&(s=`${d}${s.substring(1,s.length-1)}${u}`)}this._index=r;let c;for(let d=0;d<s.length;d++){let u=s.charCodeAt(d);if(d+1===s.length||u<55296||u>=56320)c=u;else{let p=s.charCodeAt(++d);c=(u<<10)+p+-56613888}if(c===0)throw new Error("Cannot encode a string containing the null character");c<128?this.overwriteByte(c):(c<2048?this.overwriteByte(c>>6&31|192):(c<65536?this.overwriteByte(c>>12&15|224):(this.overwriteByte(c>>18&7|240),this.overwriteByte(c>>12&63|128)),this.overwriteByte(c>>6&63|128)),this.overwriteByte(c&63|128))}this.overwriteByte(0),this._index=o}}});var DA,nc,xA=Jt(()=>{DA=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var r=0;r<e.length;++r)this.hashI(e.codePointAt(r)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var r=0;r<e.length;++r)this.hashI(e[r])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,r){return r+2654435769+(e<<6)+(e>>2)}},nc=class{constructor(e){this._helper=new DA,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}}});var nl,wA=Jt(()=>{nl=class{constructor(e,r){this._buckets=new Map,this._hash=e,this._equals=r}get(e,r){let n=this._hash(e),o=this._buckets.get(n);if(o!==void 0)for(let i=0;i<o.length;++i){let a=o[i];if(this._equals(e,a.key))return a.value}return r}set(e,r){let n=this._hash(e),o=this._buckets.get(n);o===void 0&&(o=[],this._buckets.set(n,o));for(let i=0;i<o.length;++i){let a=o[i];if(this._equals(e,a.key))return a.value=r,r}return o.push({key:e,value:r}),r}remove(e){let r=this._hash(e),n=this._buckets.get(r);if(n!==void 0){for(let o=0;o<n.length;++o)if(this._equals(e,n[o].key)){n.splice(o,1),n.length===0&&this._buckets.delete(r);break}}}}});var YN={};ya(YN,{error:()=>Mr,quote:()=>ut});function ut(t){return JSON.stringify(t)}function Mr(t,e,r){var n=new Error(t);throw n.line=e,n.column=r,n}var pd=Jt(()=>{});var jN={};ya(jN,{nativeTypes:()=>qN,parseSchema:()=>ju,reservedNames:()=>XN});function cB(t){let e=t.split(jM),r=[],n=0,o=0;for(let[i,a]of e.entries()){i&1?ZM.test(a)||r.push({text:a,line:o+1,column:n+1}):a!==""&&Mr("Syntax error "+ut(a),o+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),o+=s.length-1,n+=s[s.length-1].length}return r.push({text:"",line:o,column:n}),r}function dB(t){function e(){return t[s]}function r(l){return l.test(e().text)?(s++,!0):!1}function n(l,c){if(!r(l)){let d=e();Mr("Expected "+c+" but found "+ut(d.text),d.line,d.column)}}function o(){let l=e();Mr("Unexpected token "+ut(l.text),l.line,l.column)}let i=[],a=null,s=0;for(r(sB)&&(a=e().text,n(Bh,"identifier"),n(QN,'";"'));s<t.length&&!r($M);){let l=[],c;r(oB)?c="ENUM":r(iB)?c="STRUCT":r(aB)?c="MESSAGE":o();let d=e();for(n(Bh,"identifier"),n(tB,'"{"');!r(rB);){let u=null,p=!1,_=!1;c!=="ENUM"&&(u=e().text,n(Bh,"identifier"),p=r(nB));let h=e();n(Bh,"identifier");let g=null;c!=="STRUCT"&&(n(JM,'"="'),g=e(),n(eB,"integer"),(+g.text|0)+""!==g.text&&Mr("Invalid integer "+ut(g.text),g.line,g.column));let m=e();r(lB)&&(c!=="MESSAGE"&&Mr("Cannot deprecate this field",m.line,m.column),_=!0),n(QN,'";"'),l.push({name:h.text,line:h.line,column:h.column,type:u,isArray:p,isDeprecated:_,value:g!==null?+g.text|0:l.length+1})}i.push({name:d.text,line:d.line,column:d.column,kind:c,fields:l})}return{package:a,definitions:i}}function uB(t){let e=qN.slice(),r={};for(let i of t.definitions)e.indexOf(i.name)!==-1&&Mr("The type "+ut(i.name)+" is defined twice",i.line,i.column),XN.indexOf(i.name)!==-1&&Mr("The type name "+ut(i.name)+" is reserved",i.line,i.column),e.push(i.name),r[i.name]=i;for(let i of t.definitions){let a=i.fields;if(i.kind==="ENUM"||a.length===0)continue;for(let l of a)e.indexOf(l.type)===-1&&Mr("The type "+ut(l.type)+" is not defined for field "+ut(l.name),l.line,l.column);let s=[];for(let l of a)s.indexOf(l.value)!==-1&&Mr("The id for field "+ut(l.name)+" is used twice",l.line,l.column),l.value<=0&&Mr("The id for field "+ut(l.name)+" must be positive",l.line,l.column),l.value>a.length&&Mr("The id for field "+ut(l.name)+" cannot be larger than "+a.length,l.line,l.column),s.push(l.value)}let n={},o=i=>{let a=r[i];if(a&&a.kind==="STRUCT"&&(n[i]===1&&Mr("Recursive nesting of "+ut(i)+" is not allowed",a.line,a.column),n[i]!==2&&a)){n[i]=1;for(let s of a.fields)s.isArray||o(s.type);n[i]=2}return!0};for(let i of t.definitions)o(i.name)}function ju(t){let e=dB(cB(t));return uB(e),e}var qN,XN,jM,Bh,ZM,JM,$M,QN,eB,tB,rB,nB,oB,iB,aB,sB,lB,Gh=Jt(()=>{pd();qN=["bool","byte","float","int","string","uint","int64","uint64"],XN=["ByteBuffer","package"],jM=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,Bh=/^[A-Za-z_][A-Za-z0-9_]*$/,ZM=/^\/\/.*|\s+$/,JM=/^=$/,$M=/^$/,QN=/^;$/,eB=/^-?\d+$/,tB=/^\{$/,rB=/^\}$/,nB=/^\[\]$/,oB=/^enum$/,iB=/^struct$/,aB=/^message$/,sB=/^package$/,lB=/^\[deprecated\]$/});var ZN={};ya(ZN,{decodeBinarySchema:()=>Zu,encodeBinarySchema:()=>pB});function Zu(t){let e=t instanceof ho?t:new ho(t),r=e.readVarUint(),n=[];for(let o=0;o<r;o++){let i=e.readString(),a=e.readByte(),s=e.readVarUint(),l=[];for(let c=0;c<s;c++){let d=e.readString(),u=e.readVarInt(),p=!!(e.readByte()&1),_=e.readVarUint();l.push({name:d,line:0,column:0,type:MA[a]==="ENUM"?null:u,isArray:p,isDeprecated:!1,value:_})}n.push({name:i,line:0,column:0,kind:MA[a],fields:l})}for(let o=0;o<r;o++)for(let i of n[o].fields){let a=i.type;if(a!==null&&a<0){if(~a>=LA.length)throw new Error("Invalid type "+a);i.type=LA[~a]}else{if(a!==null&&a>=n.length)throw new Error("Invalid type "+a);i.type=a===null?null:n[a].name}}return{package:null,definitions:n}}function pB(t){let e=new ho,r=t.definitions,n={};e.writeVarUint(r.length);for(let o=0;o<r.length;o++)n[r[o].name]=o;for(let o of r){e.writeString(o.name),e.writeByte(MA.indexOf(o.kind)),e.writeVarUint(o.fields.length);for(let i of o.fields){let a=LA.indexOf(i.type);e.writeString(i.name),e.writeVarInt(a===-1?n[i.type]:~a),e.writeByte(i.isArray?1:0),e.writeVarUint(i.value)}}return e.toUint8Array()}var LA,MA,Uh=Jt(()=>{Xu();LA=["bool","byte","int","uint","float","string","int64","uint64"],MA=["ENUM","STRUCT","MESSAGE"]});var $N={};ya($N,{compileSchema:()=>BA,compileSchemaJS:()=>JN});function _B(t,e,r){let n=[],o="  ";n.push("function(bb) {"),n.push("  if (!(bb instanceof this.ByteBuffer)) {"),n.push("    bb = new this.ByteBuffer(bb);"),n.push("  }"),n.push(""),t.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("  var x = bb.readVarUint();"),n.push("    switch (x) {"),n.push("    case 0:"),n.push("      return;"),n.push(""),o="      ");for(let i of t.fields){let a;switch(i.type){case"bool":{a="!!bb.readByte()";break}case"byte":{a="bb.readByte()";break}case"int":{a="bb.readVarInt()";break}case"uint":{a="bb.readVarUint()";break}case"int64":{a="bb.readVarInt64()";break}case"uint64":{a="bb.readVarUint64()";break}case"float":{a="bb.readVarFloat()";break}case"string":{r.has(i.name)?a="bb.redactString(this.shouldIgnoreForRedaction)":a="bb.readString()";break}default:{let s=e[i.type];s?s.kind==="ENUM"?a=`this[${ut(s.name)}][bb.readVarUint()]`:a=`this[${ut("redact"+s.name)}](bb)`:Mr(`Invalid type ${ut(i.type)} for field ${ut(i.name)}`,i.line,i.column)}}t.kind==="MESSAGE"&&n.push(`    case ${i.value}:`),i.isArray?i.isDeprecated?i.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var length = bb.readVarUint();"),n.push(o+`while (length-- > 0) ${a};`)):i.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var values = null;"),n.push(o+"if (values === null) {"),n.push(o+"  var length = bb.readVarUint();"),n.push(o+"  var values = Array(length);"),n.push(o+`  for (var i = 0; i < length; i++) values[i] = ${a};`),n.push(o+"}")):i.isDeprecated?n.push(o+`${a};`):n.push(o+`${a};`),t.kind==="MESSAGE"&&(n.push("      break;"),n.push(""))}return t.kind==="MESSAGE"&&(n.push("    default:"),n.push('      throw new Error("Attempted to parse invalid message");'),n.push("    }"),n.push("  }")),n.push("}"),n.join(`
`)}function hB(t,e,r,n){let o=[],i="  ";o.push("function(bb, optDedupCache) {"),o.push("  var dedupKey = null;"),r.includes(t.name)&&(o.push("  if (!!optDedupCache) {"),o.push("    if (!(optDedupCache instanceof this.HashTable)) {"),o.push('      throw new Error("optDedupCache must be instance of HashTable");'),o.push("    }"),o.push("    // lookahead with hasher then reference result with dedup cache"),o.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),o.push(`    this[${ut("hash"+t.name)}](hasher);`),o.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${ut(t.name)} };`),o.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),o.push("    if (cachedResult !== null) {"),o.push("      bb.extendWindowTo(hasher.bb());"),o.push("      return cachedResult;"),o.push("    }"),o.push("  }")),o.push("  var result = {};"),o.push("  if (!(bb instanceof this.ByteBuffer)) {"),o.push("    bb = new this.ByteBuffer(bb);"),o.push("  }"),o.push(""),t.kind==="MESSAGE"&&(o.push("  while (true) {"),o.push("  var x = bb.readVarUint();"),o.push("    switch (x) {"),o.push("    case 0:"),o.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),o.push(""),i="      ");for(let a of t.fields){let s,l;switch(a.type){case"bool":{s="!!bb.readByte()",l="!!hasher.readByte()";break}case"byte":{s="bb.readByte()",l="hasher.readByte()";break}case"int":{s="bb.readVarInt()",l="hasher.readVarInt()";break}case"uint":{s="bb.readVarUint()",l="hasher.readVarUint()";break}case"int64":{s="bb.readVarInt64()",l="hasher.readVarInt64()";break}case"uint64":{s="bb.readVarUint64()",l="hasher.readVarUint64()";break}case"float":{s="bb.readVarFloat()",l="hasher.readVarFloat()";break}case"string":{s="bb.readString()",l="hasher.readString()";break}default:{let c=e[a.type];c?c.kind==="ENUM"?(s=`this[${ut(c.name)}][bb.readVarUint()]`,l=`this[${ut(c.name)}][hasher.readVarUint()]`):(s=`this[${ut("decode"+c.name)}](bb, optDedupCache || null)`,l=`this[${ut("hash"+c.name)}](hasher)`):Mr(`Invalid type ${ut(a.type)} for field ${ut(a.name)}`,a.line,a.column)}}t.kind==="MESSAGE"&&o.push(`    case ${a.value}:`),a.isArray?a.isDeprecated?a.type==="byte"?o.push(i+"bb.readByteArray();"):(o.push(i+"var length = bb.readVarUint();"),o.push(i+`while (length-- > 0) ${s};`)):a.type==="byte"?o.push(i+`result[${ut(a.name)}] = bb.readByteArray();`):(o.push(i+"var arrayDedupKey = null;"),o.push(i+"var values = null;"),n.includes(a.type)&&(o.push(i+"if (!!optDedupCache) {"),o.push(i+"  // lookahead with hasher then reference result with dedup cache"),o.push(i+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),o.push(i+"  var length = hasher.readVarUint();"),o.push(i+`  for (var i = 0; i < length; i++) ${l};`),o.push(i+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${ut(a.type+"[]")} };`),o.push(i+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),o.push(i+"  if (cachedResult !== null) {"),o.push(i+"    bb.extendWindowTo(hasher.bb());"),o.push(i+"    values = cachedResult;"),o.push(i+"  }"),o.push(i+"}")),o.push(i+"if (values === null) {"),o.push(i+"  var length = bb.readVarUint();"),o.push(i+"  var values = Array(length);"),o.push(i+`  for (var i = 0; i < length; i++) values[i] = ${s};`),o.push(i+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),o.push(i+"}"),o.push(i+`result[${ut(a.name)}] = values;`)):a.isDeprecated?o.push(i+`${s};`):o.push(i+`result[${ut(a.name)}] = ${s};`),t.kind==="MESSAGE"&&(o.push("      break;"),o.push(""))}return t.kind==="MESSAGE"?(o.push("    default:"),o.push('      throw new Error("Attempted to parse invalid message");'),o.push("    }"),o.push("  }")):o.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),o.push("}"),o.join(`
`)}function mB(t,e){let r=[],n="  ";r.push("function(hasher) {"),r.push("  var result = {};"),r.push("  if (!(hasher instanceof this.Hasher)) {"),r.push('    throw new Error("Expected Hasher");'),r.push("  }"),r.push(""),t.kind==="MESSAGE"&&(r.push("  while (true) {"),r.push("    switch (hasher.readVarUint()) {"),r.push("    case 0:"),r.push("      return;"),r.push(""),n="      ");for(let o of t.fields){let i;switch(o.type){case"bool":{i="hasher.readByte()";break}case"byte":{i="hasher.readByte()";break}case"int":{i="hasher.readVarInt()";break}case"uint":{i="hasher.readVarUint()";break}case"int64":{i="hasher.readVarInt64()";break}case"uint64":{i="hasher.readVarUint64()";break}case"float":{i="hasher.readVarFloat()";break}case"string":{i="hasher.readString()";break}default:{let a=e[o.type];a?a.kind==="ENUM"?i="hasher.readVarUint()":i=`this[${ut("hash"+a.name)}](hasher)`:Mr(`Invalid type ${ut(o.type)} for field ${ut(o.name)}`,o.line,o.column)}}t.kind==="MESSAGE"&&r.push(`    case ${o.value}:`),o.isArray?o.type==="byte"?r.push(n+"hasher.readByteArray();"):(r.push(n+"var length = hasher.readVarUint();"),r.push(n+`while (length-- > 0) ${i};`)):r.push(n+`${i};`),t.kind==="MESSAGE"&&(r.push("      break;"),r.push(""))}return t.kind==="MESSAGE"?(r.push("    default:"),r.push('      throw new Error("Attempted to parse invalid message");'),r.push("    }"),r.push("  }")):r.push("  return;"),r.push("}"),r.join(`
`)}function fB(t,e){let r=[];r.push("function(message, bb) {"),r.push("  var isTopLevel = !bb;"),r.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let n of t.fields){let o;if(!n.isDeprecated){switch(n.type){case"bool":{o="bb.writeByte(value);";break}case"byte":{o="bb.writeByte(value);";break}case"int":{o="bb.writeVarInt(value);";break}case"uint":{o="bb.writeVarUint(value);";break}case"int64":{o="bb.writeVarInt64(value);";break}case"uint64":{o="bb.writeVarUint64(value);";break}case"float":{o="bb.writeVarFloat(value);";break}case"string":{o="bb.writeString(value);";break}default:{let i=e[n.type];if(i)i.kind==="ENUM"?o=`var encoded = this[${ut(i.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${ut(" for enum "+ut(i.name))}); bb.writeVarUint(encoded);`:o=`this[${ut("encode"+i.name)}](value, bb);`;else throw new Error(`Invalid type ${ut(n.type)} for field ${ut(n.name)}`)}}r.push(""),r.push(`  var value = message[${ut(n.name)}];`),r.push("  if (value != null) {"),t.kind==="MESSAGE"&&r.push(`    bb.writeVarUint(${n.value});`),n.isArray?n.type==="byte"?r.push("    bb.writeByteArray(value);"):(r.push("    var values = value, n = values.length;"),r.push("    bb.writeVarUint(n);"),r.push("    for (var i = 0; i < n; i++) {"),r.push("      value = values[i];"),r.push(`      ${o}`),r.push("    }")):r.push(`    ${o}`),t.kind==="STRUCT"&&(r.push("  } else {"),r.push(`    throw new Error(${ut("Missing required field "+ut(n.name))});`)),r.push("  }")}}return t.kind==="MESSAGE"&&r.push("  bb.writeVarUint(0);"),r.push(""),r.push("  if (isTopLevel) return bb.toUint8Array();"),r.push("}"),r.join(`
`)}function gB(t){return typeof t=="string"?ju(t):t instanceof Uint8Array||t instanceof ho?Zu(t):t}function JN(t,e,r,n){t=gB(t);let o={},i=t.package,a=[];i!==null?a.push(`var ${i} = exports || ${i} || {}, exports;`):(a.push("var exports = exports || {};"),i="exports"),a.push(`${i}.ByteBuffer = ${i}.ByteBuffer || require("kiwi-schema").ByteBuffer;`),a.push(`${i}.shouldIgnoreForRedaction = ${(n==null?void 0:n.shouldIgnoreForRedaction)??/$^/};`);for(let s of t.definitions)o[s.name]=s;for(let s of t.definitions)switch(s.kind){case"ENUM":{let l={};for(let c of s.fields)l[c.name]=c.value,l[c.value]=c.name;a.push(`${i}[${ut(s.name)}] = ${JSON.stringify(l,null,2)};`);break}case"STRUCT":case"MESSAGE":{a.push(""),a.push(`${i}[${ut("decode"+s.name)}] = ${hB(s,o,e,r)};`),a.push(""),a.push(`${i}[${ut("encode"+s.name)}] = ${fB(s,o)};`),a.push(""),a.push(`${i}[${ut("hash"+s.name)}] = ${mB(s,o)};`),a.push(""),a.push(`${i}[${ut("redact"+s.name)}] = ${_B(s,o,(n==null?void 0:n.sensitiveFields)??new Set)};`);break}default:Mr("Invalid definition kind "+ut(s.kind),s.line,s.column)}return a.push(""),a.join(`
`)}function SB(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function BA(t,e,r){let n={ByteBuffer:ho,Hasher:nc,HashTable:nl,makeDedupCache:()=>new nl(a=>a.hash,(a,s)=>a.defName===s.defName&&SB(a.data,s.data))},o=[],i=[];return e&&(o=e.filter(a=>!!a.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),i=e.filter(a=>!!a.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(a=>a.slice(0,a.length-2)),i.length+o.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",JN(t,o,i,r))(n),n}var GA=Jt(()=>{Xu();xA();wA();pd();Gh();Uh()});var e1={};ya(e1,{KiwiCodec:()=>Vh,createKiwiCodec:()=>TB});function TB(t,e,r,n){return!t&&UA?BA(e,r,n):new Vh(e,r,n)}var UA,AB,Vh,t1=Jt(()=>{Xu();xA();wA();GA();Gh();Uh();AB=eval;try{UA=AB("true")}catch{UA=!1}Vh=class{constructor(e,r,n){this._definitions={};this._fieldValueToIndex={};this._enums={};typeof e=="string"?e=ju(e):(e instanceof Uint8Array||e instanceof ho)&&(e=Zu(e));for(let o of e.definitions)this._definitions[o.name]=o;this._sensitiveFields=(n==null?void 0:n.sensitiveFields)??new Set,this._shouldIgnoreForRedaction=(n==null?void 0:n.shouldIgnoreForRedaction)??/$^/;for(let o of e.definitions)if(o.kind==="ENUM"){let i={};for(let a of o.fields)i[a.name]=a.value,i[a.value]=a.name;this._enums[o.name]=i,this[o.name]=i}else if(o.kind==="STRUCT"||o.kind==="MESSAGE"){if(this["decode"+o.name]=(i,a)=>this.decodeObject(o,i,a),this["encode"+o.name]=i=>this.encodeObject(o,i),this["redact"+o.name]=i=>this.redactObject(o,i),o.kind==="MESSAGE"){let i={};for(let a=0;a<o.fields.length;a++)i[o.fields[a].value]=a;this._fieldValueToIndex[o.name]=i}}else throw new Error(`Invalid definition kind ${o.kind}`);this._nonArrayDefinitionsToDedup=new Set,this._arrayDefinitionsToDedup=new Set,r&&(this._nonArrayDefinitionsToDedup=new Set(r.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*$/))),this._arrayDefinitionsToDedup=new Set(r.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(o=>o.slice(0,o.length-2))),this._arrayDefinitionsToDedup.size+this._nonArrayDefinitionsToDedup.size!==r.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping..."))}decode(e,r,n){let o=this._definitions[e];if(o===void 0)throw new Error(`Invalid definition ${e}`);return this.decodeObject(o,r,n)}encode(e,r){let n=this._definitions[e];if(n===void 0)throw new Error(`Invalid definition ${e}`);return this.encodeObject(n,r)}decodeSingleField(e,r,n){switch(e.type){case"bool":return!!r.readByte();case"byte":return r.readByte();case"int":return r.readVarInt();case"uint":return r.readVarUint();case"int64":return r.readVarInt64();case"uint64":return r.readVarUint64();case"float":return r.readVarFloat();case"string":return r.readString();default:let o=this._definitions[e.type];if(!o)throw new Error(`Invalid type ${e.type}`);if(o.kind==="ENUM")return this._enums[e.type][r.readVarUint()];if(o.kind==="STRUCT"||o.kind==="MESSAGE")return this.decodeObject(o,r,n);throw new Error(`Invalid definition kind ${o.kind}`)}}encodeSingleField(e,r,n){switch(e.type){case"bool":n.writeByte(r);break;case"byte":n.writeByte(r);break;case"int":n.writeVarInt(r);break;case"uint":n.writeVarUint(r);break;case"int64":n.writeVarInt64(r);break;case"uint64":n.writeVarUint64(r);break;case"float":n.writeVarFloat(r);break;case"string":n.writeString(r);break;default:let o=this._definitions[e.type];if(!o)throw new Error(`Invalid type ${e.type}`);if(o.kind==="ENUM"){let i=this._enums[e.type][r];if(i===void 0)throw new Error("Invalid value "+JSON.stringify(r)+" for enum "+e.type);n.writeVarUint(i)}else if(o.kind==="STRUCT"||o.kind==="MESSAGE")this.encodeObject(o,r,n);else throw new Error(`Invalid definition kind ${o.kind}`);break}}hashSingleField(e,r){switch(e.type){case"bool":r.readByte();break;case"byte":r.readByte();break;case"int":r.readVarInt();break;case"uint":r.readVarUint();break;case"int64":r.readVarInt64();break;case"uint64":r.readVarUint64();break;case"float":r.readVarFloat();break;case"string":r.readString();break;default:let n=this._definitions[e.type];if(!n)throw new Error(`Invalid type ${e.type}`);if(n.kind==="ENUM")r.readVarUint();else if(n.kind==="STRUCT"||n.kind==="MESSAGE")this.hashObject(n,r);else throw new Error(`Invalid definition kind ${n.kind}`);break}}redactSingleField(e,r){switch(e.type){case"bool":r.readByte();break;case"byte":r.readByte();break;case"int":r.readVarInt();break;case"uint":r.readVarUint();break;case"int64":r.readVarInt64();break;case"uint64":r.readVarUint64();break;case"float":r.readVarFloat();break;case"string":this._sensitiveFields.has(e.name)?r.redactString(this._shouldIgnoreForRedaction):r.readString();break;default:let n=this._definitions[e.type];if(!n)throw new Error(`Invalid type ${e.type}`);if(n.kind==="ENUM")r.readVarUint();else if(n.kind==="STRUCT"||n.kind==="MESSAGE")this.redactObject(n,r);else throw new Error(`Invalid definition kind ${n.kind}`);break}}decodeArrayField(e,r,n){if(e.type==="byte")return r.readByteArray();let o=null,i=null;if(n&&this._arrayDefinitionsToDedup.has(e.type)){let a=new nc(r.getNewWindowFromRight()),s=a.readVarUint();for(let c=0;c<s;c++)this.hashSingleField(e,a);o={hash:a.value(),data:a.windowToUint8Array(),defName:e.type+"[]"};let l=n.get(o,null);l!==null&&(r.extendWindowTo(a.bb()),i=l)}if(i===null){let a=r.readVarUint();i=Array(a);for(let s=0;s<a;s++)i[s]=this.decodeSingleField(e,r,n);o!==null&&n.set(o,i)}return i}decodeObject(e,r,n){r instanceof ho||(r=new ho(r));let o=null;if(n&&this._nonArrayDefinitionsToDedup.has(e.name)){if(!(n instanceof nl))throw new Error("optDedupCache must be instance of HashTable");let a=new nc(r.getNewWindowFromRight());this.hashObject(e,a),o={hash:a.value(),data:a.windowToUint8Array(),defName:e.name};let s=n.get(o,null);if(s!==null)return r.extendWindowTo(a.bb()),s}let i={};if(e.kind==="MESSAGE")for(;;){let a=r.readVarUint();if(a===0)break;let s=this._fieldValueToIndex[e.name][a];if(s===void 0)throw new Error("Attempted to parse invalid message");let l=e.fields[s],c=l.isDeprecated?null:n,d=l.isArray?this.decodeArrayField(l,r,c):this.decodeSingleField(l,r,c);l.isDeprecated||(i[l.name]=d)}else for(let a of e.fields){let s=a.isDeprecated?null:n,l=a.isArray?this.decodeArrayField(a,r,s):this.decodeSingleField(a,r,s);a.isDeprecated||(i[a.name]=l)}return o!==null&&n.set(o,i),i}hashObject(e,r){if(e.kind==="MESSAGE")for(;;){let n=r.readVarUint();if(n===0)break;let o=this._fieldValueToIndex[e.name][n];if(o===void 0)throw new Error("Attempted to parse invalid message");let i=e.fields[o];if(i.isArray)if(i.type==="byte")r.readByteArray();else{let a=r.readVarUint();for(let s=0;s<a;s++)this.hashSingleField(i,r)}else this.hashSingleField(i,r)}else for(let n of e.fields)if(n.isArray)if(n.type==="byte")r.readByteArray();else{let o=r.readVarUint();for(let i=0;i<o;i++)this.hashSingleField(n,r)}else this.hashSingleField(n,r)}encodeObject(e,r,n){let o=!n;n||(n=new ho);for(let i of e.fields){if(i.isDeprecated)continue;let a=r[i.name];if(a!=null)if(e.kind==="MESSAGE"&&n.writeVarUint(i.value),i.isArray)if(i.type==="byte")n.writeByteArray(a);else{n.writeVarUint(a.length);for(let s=0;s<a.length;s++)this.encodeSingleField(i,a[s],n)}else this.encodeSingleField(i,a,n);else if(e.kind==="STRUCT")throw new Error("Missing required field "+i.name)}if(e.kind==="MESSAGE"&&n.writeVarUint(0),o)return n.toUint8Array()}redactObject(e,r){if(r instanceof ho||(r=new ho(r)),e.kind==="MESSAGE")for(;;){let n=r.readVarUint();if(n===0)break;let o=this._fieldValueToIndex[e.name][n];if(o===void 0)throw new Error("Attempted to parse invalid message");let i=e.fields[o];if(i.isArray)if(i.type==="byte")r.readByteArray();else{let a=r.readVarUint();for(let s=0;s<a;s++)this.redactSingleField(i,r)}else this.redactSingleField(i,r)}else for(let n of e.fields)if(n.isArray)if(n.type==="byte")r.readByteArray();else{let o=r.readVarUint();for(let i=0;i<o;i++)this.redactSingleField(n,r)}else this.redactSingleField(n,r)}makeDedupCache(){let e=(r,n)=>{if(r.length!==n.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==n[o])return!1;return!0};return new nl(r=>r.hash,(r,n)=>r.defName===n.defName&&e(r.data,n.data))}}});var a1={};ya(a1,{compileSchemaCallbackCPP:()=>IB});function EB(t,e,r){switch(e){case"bool":return{type:"bool ",name:r};case"byte":return{type:"uint8_t ",name:r};case"int":return{type:"int32_t ",name:r};case"uint":return{type:"uint32_t ",name:r};case"int64":return{type:"int64_t ",name:r};case"uint64":return{type:"uint64_t ",name:r};case"float":return{type:"float ",name:r};case"string":return{type:"const char *",name:r};default:{let n=t[e];return n.kind==="ENUM"?{type:n.name+" ",name:r}:null}}}function oc(t,e,r,n){let o=[];for(let i of r){let a=e+i.name;if(i.isArray&&!n)return null;let s=EB(t,i.type,a);if(s!==null){o.push(s);continue}let l=t[i.type];if(l.kind!=="STRUCT")return null;let c=oc(t,a+"_",l.fields,!1);if(c===null)return null;o.push.apply(o,c)}return o}function _d(t){return t.type+t.name}function o1(t){return t.name}function i1(t){switch(t.type){case"bool ":return`!bb.readBool(${t.name})`;case"uint8_t ":return`!bb.readByte(${t.name})`;case"int32_t ":return`!bb.readVarInt(${t.name})`;case"uint32_t ":return`!bb.readVarUint(${t.name})`;case"int64_t ":return`!bb.readVarInt64(${t.name})`;case"uint64_t ":return`!bb.readVarUint64(${t.name})`;case"float ":return`!bb.readVarFloat(${t.name})`;case"const char *":return`!bb.readString(${t.name})`;default:return`!bb.readVarUint(reinterpret_cast<uint32_t &>(${t.name}))`}}function r1(t){switch(t.type){case"bool ":return`_wb.writeBool(${t.name})`;case"uint8_t ":return`_wb.writeByte(${t.name})`;case"int32_t ":return`_wb.writeVarInt(${t.name})`;case"uint32_t ":return`_wb.writeVarUint(${t.name})`;case"int64_t ":return`_wb.writeVarInt64(${t.name})`;case"uint64_t ":return`_wb.writeVarUint64(${t.name})`;case"float ":return`_wb.writeVarFloat(${t.name})`;case"const char *":return`_wb.writeString(${t.name})`;default:return`_wb.writeVarUint(static_cast<uint32_t>(${t.name}))`}}function n1(t,e,r,n,o){let i=n.name;if(n.isArray){let s=`_${i}_count`;t.push(o+`uint32_t ${s};`),t.push(o+`if (!bb.readVarUint(${s})) return false;`),n.isDeprecated||t.push(o+`visitor.visit${r.name}_${n.name}_count(${s});`),t.push(o+`while (${s}-- > 0) {`),o+="  ",i+="_element"}let a=oc(e,"",[n],!0);if(a!==null){for(let s of a)t.push(o+`${_d(s)};`);t.push(o+`if (${a.map(i1).join(" || ")}) return false;`),n.isDeprecated||t.push(o+`visitor.visit${r.name}_${i}(${a.map(o1).join(", ")});`)}else{n.isDeprecated||t.push(o+`visitor.visit${r.name}_${i}();`);let s=e[n.type];t.push(o+`if (!parse${s.name}(bb, visitor)) return false;`)}n.isArray&&t.push(o.slice(2)+"}")}function IB(t,e={}){let r={},n=[],o=e.includePrefix||"";for(let i of t.definitions)r[i.name]=i;t.package!==null&&(n.push(`#ifndef INCLUDE_${t.package.toUpperCase()}_H`),n.push(`#define INCLUDE_${t.package.toUpperCase()}_H`),n.push("")),n.push(`#include "${o}kiwi.h"`),n.push(""),t.package!==null&&(n.push(`namespace ${t.package} {`),n.push(""));for(let i of t.definitions)if(i.kind==="ENUM"){n.push(`enum class ${i.name} : uint32_t {`);for(let a of i.fields)a.isDeprecated||n.push(`  ${a.name} = ${a.value},`);n.push("};"),n.push("")}for(let i=0;i<2;i++){let a=") = 0;";i===0?(n.push("class Visitor {"),n.push("public:")):(n.push("class Writer : public Visitor {"),n.push("private:"),n.push("  kiwi::WriteBuffer &_wb;"),n.push("public:"),n.push("  Writer(kiwi::WriteBuffer &wb) : _wb(wb) {}"),a=") override;");for(let s of t.definitions){if(s.kind==="STRUCT"){let l=oc(r,"",s.fields,!1);if(l!==null){n.push(`  virtual void visit${s.name}(${l.map(_d).join(", ")}${a}`);continue}}if(s.kind==="STRUCT"||s.kind==="MESSAGE"){n.push(`  virtual void begin${s.name}(${a}`);for(let l of s.fields){if(l.isDeprecated)continue;let c=l.name;l.isArray&&(n.push(`  virtual void visit${s.name}_${l.name}_count(uint32_t size${a}`),c+="_element");let d=oc(r,"",[l],!0);d!==null?n.push(`  virtual void visit${s.name}_${c}(${d.map(_d).join(", ")}${a}`):n.push(`  virtual void visit${s.name}_${c}(${a}`)}n.push(`  virtual void end${s.name}(${a}`)}}n.push("};"),n.push("")}for(let i of t.definitions)(i.kind==="STRUCT"||i.kind==="MESSAGE")&&n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor);`);n.push(""),n.push("#ifdef IMPLEMENT_SCHEMA_H"),n.push("");for(let i of t.definitions)if(i.kind==="STRUCT"){let a=oc(r,"",i.fields,!1);if(a!==null){n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`);for(let s of a)n.push(`  ${_d(s)};`);n.push(`  if (${a.map(i1).join(" || ")}) return false;`),n.push(`  visitor.visit${i.name}(${a.map(o1).join(", ")});`),n.push("  return true;"),n.push("}"),n.push("")}else{n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),n.push(`  visitor.begin${i.name}();`);for(let s of i.fields)n1(n,r,i,s,"  ");n.push(`  visitor.end${i.name}();`),n.push("  return true;"),n.push("}"),n.push("")}}else if(i.kind==="MESSAGE"){n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),n.push(`  visitor.begin${i.name}();`),n.push("  while (true) {"),n.push("    uint32_t _type;"),n.push("    if (!bb.readVarUint(_type)) return false;"),n.push("    switch (_type) {"),n.push("      case 0: {"),n.push(`        visitor.end${i.name}();`),n.push("        return true;"),n.push("      }");for(let a of i.fields)n.push(`      case ${a.value}: {`),n1(n,r,i,a,"        "),n.push("        break;"),n.push("      }");n.push("      default: return false;"),n.push("    }"),n.push("  }"),n.push("}"),n.push("")}for(let i of t.definitions){if(i.kind==="STRUCT"){let a=oc(r,"",i.fields,!1);if(a!==null){n.push(`void Writer::visit${i.name}(${a.map(_d).join(", ")}) {`);for(let s of a)n.push(`  ${r1(s)};`);n.push("}"),n.push("");continue}}if(i.kind==="STRUCT"||i.kind==="MESSAGE"){n.push(`void Writer::begin${i.name}() {`),n.push("}"),n.push("");for(let a of i.fields){if(a.isDeprecated)continue;let s=a.name;a.isArray&&(n.push(`void Writer::visit${i.name}_${a.name}_count(uint32_t size) {`),i.kind==="MESSAGE"&&n.push(`  _wb.writeVarUint(${a.value});`),n.push("  _wb.writeVarUint(size);"),n.push("}"),n.push(""),s+="_element");let l=oc(r,"",[a],!0);if(l!==null){n.push(`void Writer::visit${i.name}_${s}(${l.map(_d).join(", ")}) {`),i.kind==="MESSAGE"&&!a.isArray&&n.push(`  _wb.writeVarUint(${a.value});`);for(let c of l)n.push(`  ${r1(c)};`);n.push("}"),n.push("")}else n.push(`void Writer::visit${i.name}_${s}() {`),i.kind==="MESSAGE"&&!a.isArray&&n.push(`  _wb.writeVarUint(${a.value});`),n.push("}"),n.push("")}n.push(`void Writer::end${i.name}() {`),i.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("}"),n.push("")}}return n.push("#endif"),n.push(""),t.package!==null&&(n.push("}"),n.push(""),n.push("#endif"),n.push("")),n.join(`
`)}var s1=Jt(()=>{});var f1={};ya(f1,{compileSchemaCPP:()=>MB,compileSchemaEnumsCPP:()=>BB});function RB(t,e,r){return(e.type==="int64"||e.type==="uint64")&&!r?"std::array<std::byte, 8>":mo(t,e,r)}function Ju(t,e){return(e.type==="int64"||e.type==="uint64")&&!e.isArray?`std::bit_cast<std::array<std::byte, 8>>(${t})`:t}function l1(t,e){return e.isArray?t:e.type==="int64"?`std::bit_cast<int64_t>(${t})`:e.type==="uint64"?`std::bit_cast<uint64_t>(${t})`:t}function d1(t,e,r){if(!e.isArray||e.isDeprecated||!e.type)return!1;let n=t[e.type];return n?r.includes(n.name):!1}function mo(t,e,r){let n;switch(e.type){case"bool":n="bool";break;case"byte":n="uint8_t";break;case"int":n="int32_t";break;case"uint":n="uint32_t";break;case"int64":n="int64_t";break;case"uint64":n="uint64_t";break;case"float":n="float";break;case"string":n="kiwi::String";break;default:{let o=t[e.type];o||Mr(`Invalid type ${ut(e.type)} for field ${ut(e.name)}`,e.line,e.column),n=o.name;break}}return r&&(n=`kiwi::Array<${n}>`),n}function ol(t){return"_data_"+t.name}function VA(t){return t>>5}function kA(t){return`(1 << ${t%32})`}function Ni(t,e){return!e.isArray&&e.type in t&&t[e.type].kind!=="ENUM"}function u1(t,e,r){switch(e.type){case"bool":return`_wb.writeBool(${r});`;case"byte":return`_wb.writeByte(${r});`;case"int":return`_wb.writeVarInt(${r});`;case"uint":return`_wb.writeVarUint(${r});`;case"int64":return`_wb.writeVarInt64(${r});`;case"uint64":return`_wb.writeVarUint64(${r});`;case"float":return`_wb.writeVarFloat(${r});`;case"string":return`_wb.writeString(${r}.c_str());`;default:{let n=t[e.type];if(!n)Mr(`Invalid type ${ut(e.type)} for field ${ut(e.name)}`,e.line,e.column);else return n.kind==="ENUM"?`_wb.writeVarUint(static_cast<uint32_t>(${r}));`:`if (!${r}${Ni(t,e)?"->":"."}encode(_wb)) return false;`}}}function kh(t,e,r,n){let o=Ni(t,e);switch(e.type){case"bool":return`_bb.readBool(${r})`;case"byte":return`_bb.readByte(${r})`;case"int":return`_bb.readVarInt(${r})`;case"uint":return`_bb.readVarUint(${r})`;case"int64":return`_bb.readVarInt64(${r})`;case"uint64":return`_bb.readVarUint64(${r})`;case"float":return`_bb.readVarFloat(${r})`;case"string":return`_bb.readString(${r}, _pool)`;default:{let i=t[e.type];if(!i)Mr(`Invalid type ${ut(e.type)} for field ${ut(e.name)}`,e.line,e.column);else return i.kind==="ENUM"?`_bb.readVarUint(reinterpret_cast<uint32_t &>(${r}))`:n?`${r+(o?"->":".")}decode(_bb, _pool, _schema, tempDecodingFields)`:`${r+(o?"->":".")}decode(_bb, _pool, _schema)`}}}function p1(t){let e={bool:1,byte:1,int:4,uint:4,float:4};return t.slice().sort(function(r,n){let o=!r.isArray&&e[r.type]||8,i=!n.isArray&&e[n.type]||8;return o!==i?i-o:t.indexOf(r)-t.indexOf(n)})}function yB(t,e,r){let n=t.fields,o=[];o.push(`class ${t.name} {`),o.push("public:"),o.push(`  ${t.name}() { (void)_flags; }`),r||(o.push(`  ${t.name}(const ${t.name}&) = delete;`),o.push(`  ${t.name}& operator=(const ${t.name}&) = delete;`)),o.push(`  ${t.name}(${t.name}&&) = default;`),o.push(`  ${t.name}& operator=(${t.name}&&) = default;`),o.push(""),r&&(o.push(`  ${t.name} copy() const;`),o.push(""));for(let s of n){if(s.isDeprecated)continue;let l=mo(e,s,s.isArray);o.push(`  ${l} *${s.name}();`),o.push(`  const ${l} *${s.name}() const;`),Ni(e,s)?o.push(`  void set_${s.name}(${l} *value);`):s.isArray?o.push(`  ${l} &set_${s.name}(kiwi::MemoryPool &pool, uint32_t count);`):o.push(`  void set_${s.name}(const ${l} &value);`),o.push("")}o.push("  bool encode(kiwi::WriteBuffer &wb) const;"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),o.push(""),o.push("private:"),r&&(o.push(`  ${t.name}(const ${t.name}&) = default;`),o.push(`  ${t.name}& operator=(const ${t.name}&) = default;`)),o.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let i=p1(n),a="  ";for(let s of i){if(s.isDeprecated)continue;let l=ol(s),c=mo(e,s,s.isArray);Ni(e,s)?o.push(a+`${c} *${l} = {};`):o.push(a+`${c} ${l} = {};`)}return o.push("};"),o.push(""),o}function bB(t,e,r){let n=t.fields,o=[];o.push(`class ${t.name} {`),o.push("public:"),o.push("  union Field;"),o.push(`  ${t.name}() { (void)_flags; }`),o.push(`  ${t.name}(const ${t.name}&) = delete;`),o.push(`  ${t.name}& operator=(const ${t.name}&) = delete;`),o.push(`  ${t.name}(${t.name}&&) = default;`),o.push(`  ${t.name}& operator=(${t.name}&&) = default;`),o.push(""),r&&(o.push(`  ${t.name} copy(kiwi::MemoryPool& pool) const;`),o.push("")),o.push("  auto fields() const {"),o.push("    return _fields.fields();"),o.push("  }"),o.push("");for(let s of n){if(s.isDeprecated)continue;let l=mo(e,s,s.isArray);Ni(e,s)?(o.push(`  ${l} *${s.name}();`),o.push(`  const ${l} *${s.name}() const;`),o.push(`  const ${l} *iterator_${s.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const;`)):(o.push(`  kiwi::Optional<${l}> ${s.name}() const;`),o.push(`  ${l} iterator_${s.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const;`)),Ni(e,s)?o.push(`  void set_${s.name}(kiwi::MemoryPool &pool, ${l} *value);`):s.isArray?o.push(`  ${l} &set_${s.name}(kiwi::MemoryPool &pool, uint32_t count);`):o.push(`  void set_${s.name}(kiwi::MemoryPool &pool, const ${l} &value);`),o.push("")}o.push("  bool encode(kiwi::WriteBuffer &wb) const;"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema, std::vector<kiwi::SparseFields<Field>::Element> &tempFields);"),o.push(""),o.push("private:"),o.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let i=p1(n);o.push("public:"),o.push("  union Field {"),o.push("  public:"),o.push("    bool operator==(const Field&) const { return false; }");let a="    ";for(let s of i){if(s.isDeprecated)continue;let l=ol(s),c=RB(e,s,s.isArray);Ni(e,s)?o.push(a+`${c} *${l};`):o.push(a+`${c} ${l};`)}return o.push("  };"),o.push("private:"),o.push("  kiwi::SparseFields<Field> _fields;"),o.push("  friend std::hash<Field>;"),o.push("};"),o.push(""),o}function vB(t,e){if(t.type){let r=e[t.type];if(r&&r.kind==="ENUM")return!0}return!1}function _1(t,e){switch(t.type){case"bool":case"byte":case"int":case"uint":case"int64":case"uint64":case"float":case"string":return!0}return vB(t,e)}function h1(t,e){return e.type==="string"?"const char*":mo(t,e,!1)}function CB(t,e,r){return e.type==="string"?`bb.readString(${r})`:kh(t,e,r,!1).slice(1)}function OB(t,e){let r=[];r.push(`struct ${t.name}Visitor {`),r.push("  kiwi::ByteBuffer& bb;"),r.push("  BinarySchema& schema;"),r.push(""),r.push(`  ${t.name}Visitor(kiwi::ByteBuffer& _bb, BinarySchema& _schema) : bb(_bb), schema(_schema) {}`),r.push("");for(let n of t.fields)if(!n.isDeprecated)if(n.isArray)r.push("  // If this is overridden, the new implementation must skip over exactly count"),r.push(`  // encoded instances of ${n.type} in bb`),r.push(`  virtual bool visit${t.name}_${n.name}(size_t count) {`),r.push("    for (size_t i=0; i<count; i++) {"),r.push(`      if (!schema.skip${n.type}(bb)) return false;`),r.push("    }"),r.push("    return true;"),r.push("  }");else if(_1(n,e)){let o=h1(e,n);r.push(`  virtual bool visit${t.name}_${n.name}(${o} ${n.name}) { return true; }`)}else r.push(`  // If this is overridden, the new implementation must skip over encoded one ${n.type} in bb`),r.push(`  virtual bool visit${t.name}_${n.name}() {`),r.push(`    return schema.skip${n.type}(bb);`),r.push("  }");return r.push("};"),r.push(""),r.push(`bool parse${t.name}(kiwi::ByteBuffer& bb, ${t.name}Visitor& visitor);`),r.push(""),r}function NB(t,e){let r=[];r.push(`bool parse${t.name}(kiwi::ByteBuffer& bb, ${t.name}Visitor& visitor) {`),r.push("  while (true) {"),r.push("    uint32_t _field;"),r.push("    if (!bb.readVarUint(_field)) return false;"),r.push("    switch (_field) {"),r.push("      case 0: {"),r.push("        return true;"),r.push("      }");for(let n of t.fields)n.isDeprecated||(r.push(`      case ${n.value}: {`),n.isArray?(r.push("        uint32_t count;"),r.push("        if (!bb.readVarUint(count)) return false;"),r.push(`        if (!visitor.visit${t.name}_${n.name}(count)) return false;`),r.push("        break;")):_1(n,e)?(r.push(`        ${h1(e,n)} v;`),r.push(`        if (!${CB(e,n,"v")}) return false;`),r.push(`        if (!visitor.visit${t.name}_${n.name}(v)) return false;`),r.push("        break;")):(r.push(`        if (!visitor.visit${t.name}_${n.name}()) return false;`),r.push("        break;")),r.push("      }"));return r.push("      default:"),r.push(`        if (visitor.schema.skip${t.name}Field(bb, _field)) break;`),r.push("        return false;"),r.push("    }"),r.push("  }"),r.push("}"),r.push(""),r}function PB(t,e,r){let n=t.fields,o=[];r&&(o.push(`inline ${t.name} ${t.name}::copy() const {`),o.push(`  ${t.name} clone = *this;`),o.push("  return clone;"),o.push("}"),o.push(""));for(let[i,a]of n.entries()){let s=ol(a),l=mo(e,a,a.isArray),c=VA(i),d=kA(i);if(a.isDeprecated)continue;let u=`_flags[${c}] |= ${d}`,p=`_flags[${c}] & ${d}`;Ni(e,a)?(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  return ${s};`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  return ${s};`),o.push("}"),o.push(""),o.push(`inline void ${t.name}::set_${a.name}(${l} *value) {`),o.push(`  ${s} = value;`),o.push("}"),o.push("")):a.isArray?(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline ${l} &${t.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),o.push(`  ${u}; return ${s} = pool.array<${mo(e,a,!1)}>(count);`),o.push("}"),o.push("")):(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline void ${t.name}::set_${a.name}(const ${l} &value) {`),o.push(`  ${u}; ${s} = value;`),o.push("}"),o.push(""))}return o}function FB(t,e){let r=t.fields,n=[];n.push(`bool ${t.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o of r){if(o.isDeprecated)continue;let i="  ";t.kind==="STRUCT"?n.push(`  if (${o.name}() == nullptr) return false;`):(n.push(`  if (${o.name}() != nullptr) {`),i="    ");let a=ol(o),s=o.isArray?"_it":a,l=u1(e,o,s);t.kind==="MESSAGE"&&n.push(i+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(i+`_wb.writeVarUint(${a}.size());`),n.push(i+`for (const ${mo(e,o,!1)} &_it : ${a}) ${l}`)):n.push(i+l),t.kind!=="STRUCT"&&n.push("  }")}return t.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function DB(t,e,r){let n=t.fields,o=[];o.push(`bool ${t.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let i of n)if(i.isArray){o.push("  uint32_t count;");break}t.kind==="MESSAGE"&&(o.push("  while (true) {"),o.push("    uint32_t type;"),o.push("    if (!_bb.readVarUint(type)) return false;"),o.push("    switch (type) {"),o.push("      case 0:"),o.push("        return true;"));for(let i of n){let a=ol(i),s=i.isArray?"_it":a,l=Ni(e,i),c=d1(e,i,r),d=mo(e,i,!1),u=kh(e,i,s,c),p="  ";if(t.kind==="MESSAGE"&&(o.push(`      case ${i.value}: {`),p="        "),i.isArray)if(o.push(p+"if (!_bb.readVarUint(count)) return false;"),i.isDeprecated)if(i.type==="byte")o.push(p+"if (!_bb.skipCount(count)) return false;");else{let _=kh(e,i,s,!1);o.push(p+`for (${d} &_it : _pool.array<${d}>(count)) if (!${_}) return false;`)}else i.type==="byte"?o.push(p+`if (!_bb.readByteArray(set_${i.name}(_pool, count).data(), count)) return false;`):c?(o.push(p+`std::vector<kiwi::SparseFields<${d}::Field>::Element> tempDecodingFields;`),o.push(p+`for (${d} &_it : set_${i.name}(_pool, count)) if (!${u}) return false;`)):o.push(p+`for (${d} &_it : set_${i.name}(_pool, count)) if (!${u}) return false;`);else i.isDeprecated?(l?o.push(p+`${d} *${a} = _pool.allocate<${d}>();`):o.push(p+`${d} ${a} = {};`),o.push(p+`if (!${u}) return false;`)):(l&&o.push(p+`${a} = _pool.allocate<${d}>();`),o.push(p+`if (!${u}) return false;`),l||o.push(p+`set_${i.name}(${a});`));t.kind==="MESSAGE"&&(o.push("        break;"),o.push("      }"))}return t.kind==="MESSAGE"?(o.push("      default: {"),o.push(`        if (!_schema || !_schema->skip${t.name}Field(_bb, type)) return false;`),o.push("        break;"),o.push("      }"),o.push("    }"),o.push("  }")):o.push("  return true;"),o.push("}"),o.push(""),o}function xB(t,e,r){let n=t.fields,o=[];r&&(o.push(`inline ${t.name} ${t.name}::copy(kiwi::MemoryPool& pool) const {`),o.push(`  ${t.name} clone;`),o.push("  clone._fields = _fields.copy(pool);"),o.push("  memcpy(clone._flags, _flags, sizeof(_flags));"),o.push("  return clone;"),o.push("}"),o.push(""));for(let[i,a]of n.entries()){let s=ol(a),l=mo(e,a,a.isArray),c=VA(i),d=kA(i);if(a.isDeprecated)continue;let u=`_flags[${c}] |= ${d}`,p=`_flags[${c}] & ${d}`,_=Ni(e,a);_?(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  if (!(${p})) return nullptr;`),o.push(`  Field* field = _fields.getField(${a.value});`),o.push(`  return field ? ${_?"":"&"}field->${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  if (!(${p})) return nullptr;`),o.push(`  const Field* field = _fields.getField(${a.value});`),o.push(`  return field ? ${_?"":"&"}field->${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::iterator_${a.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const {`),o.push(`  REPORT_IF_FALSE_DEBUG_ONLY(it.fieldNumber == ${a.value});`),o.push(`  return it.element->field.${s};`),o.push("}"),o.push("")):(o.push(`inline kiwi::Optional<${l}> ${t.name}::${a.name}() const {`),o.push(`  if (!(${p})) return std::nullopt;`),o.push(`  const Field* field = _fields.getField(${a.value});`),o.push(`  return field ? kiwi::Optional<${l}>(${l1(`field->${s}`,a)}) : std::nullopt;`),o.push("}"),o.push(""),o.push(`inline ${l} ${t.name}::iterator_${a.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const {`),o.push(`  REPORT_IF_FALSE_DEBUG_ONLY(it.fieldNumber == ${a.value});`),o.push(`  return ${l1(`it.element->field.${s}`,a)};`),o.push("}"),o.push("")),Ni(e,a)?o.push(`inline void ${t.name}::set_${a.name}(kiwi::MemoryPool &pool, ${l} *value) {`):a.isArray?(o.push(`inline ${l} &${t.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),o.push(`  ${l} value = pool.array<${mo(e,a,!1)}>(count);`)):o.push(`inline void ${t.name}::set_${a.name}(kiwi::MemoryPool &pool, const ${l} &value) {`),o.push(`  if (${p}) {`),o.push(`    Field* field = _fields.getField(${a.value});`),o.push(`    field->${s} = ${Ju("value",a)};`),a.isArray&&o.push(`    return field->${s};`),o.push("  } else {"),o.push(`    ${u};`),a.isArray?o.push(`    return _fields.addField({${a.value}, Field{.${s} = ${Ju("value",a)}}}, pool)->field.${s};`):o.push(`    _fields.addField({${a.value}, Field{.${s} = ${Ju("value",a)}}}, pool);`),o.push("  }"),o.push("}"),o.push("")}return o}function wB(t,e){let r=t.fields,n=[];n.push(`bool ${t.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o of r){if(o.isDeprecated)continue;let i=mo(e,o,o.isArray),a=Ni(e,o),s;a?s=`${i}*`:s=`kiwi::Optional<${i}>`;let l=ol(o);n.push(`  const ${s} ${l} = ${o.name}();`),a?(n.push(`  if (${l}) {`),n.push(`    const ${mo(e,o,o.isArray)}* _data = ${l};`)):(n.push(`  if (${l}.has_value()) {`),n.push(`    const ${mo(e,o,o.isArray)}& _data = *${l};`));let c="    ";l="_data";let d=o.isArray?"_it":l,u=u1(e,o,d);n.push(c+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(c+`_wb.writeVarUint(${l}.size());`),n.push(c+`for (const ${mo(e,o,!1)} &_it : ${l}) ${u}`)):n.push(c+u),n.push("  }")}return n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function LB(t,e,r){let n=t.fields,o=[];o.push(`bool ${t.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema, std::vector<kiwi::SparseFields<Field>::Element> &tempFields) {`);for(let i of n)if(i.isArray){o.push("  uint32_t count;");break}o.push("  while (true) {"),o.push("    uint32_t type;"),o.push("    if (!_bb.readVarUint(type)) return false;"),o.push("    switch (type) {"),o.push("      case 0: {"),o.push("        _fields = kiwi::SparseFields<Field>(tempFields.data(), tempFields.size(), _pool);"),o.push("        tempFields.clear();"),o.push("        return true;"),o.push("      }");for(let[i,a]of n.entries()){let s=ol(a),l=a.isArray?"_it":s,c=Ni(e,a),d=d1(e,a,r),u=kh(e,a,l,d),p=mo(e,a,!1),_=VA(i),h=kA(i),g=`_flags[${_}] |= ${h}`;o.push(`      case ${a.value}: {`);let m="        ";a.isArray?(o.push(m+"if (!_bb.readVarUint(count)) return false;"),a.isDeprecated?a.type==="byte"?o.push(m+"if (!_bb.skipCount(count)) return false;"):o.push(m+`for (${p} &_it : _pool.array<${p}>(count)) if (!${u}) return false;`):(o.push(m+`${g};`),o.push(m+`${mo(e,a,!0)} ${s} = _pool.array<${p}>(count);`),a.type==="byte"?o.push(m+`if (!_bb.readByteArray(${s}.data(), count)) return false;`):(d&&o.push(m+`std::vector<kiwi::SparseFields<${p}::Field>::Element> tempDecodingFields;`),o.push(m+`for (${p} &_it : ${s}) if (!${u}) return false;`)),o.push(m+`tempFields.push_back({${a.value}, Field{.${s} = ${Ju(s,a)}}});`))):(c?o.push(m+`${p}* ${s} = _pool.allocate<${p}>();`):o.push(m+`${p} ${s} = {};`),o.push(m+`if (!${u}) return false;`),a.isDeprecated||(o.push(m+`${g};`),o.push(m+`tempFields.push_back({${a.value}, Field{.${s} = ${Ju(s,a)}}});`))),o.push("        break;"),o.push("      }")}return o.push("      default: {"),o.push(`        if (!_schema || !_schema->skip${t.name}Field(_bb, type)) return false;`),o.push("        break;"),o.push("      }"),o.push("    }"),o.push("  }"),o.push("}"),o.push(""),o.push(`bool ${t.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`),o.push("  std::vector<kiwi::SparseFields<Field>::Element> tempFields;"),o.push("  return decode(_bb, _pool, _schema, tempFields);"),o.push("}"),o}function c1(t){return t.fields.every(e=>e.type==="uint"||e.type==="float"||e.type==="byte"&&e.isArray)}function MB(t,e={}){let r={};for(let c of t.definitions)r[c.name]=c;let n=e.includePrefix||"",{sparseMessages:o=[],copyableMessages:i=[],generateVisitors:a=[],separateEnumFile:s}=e;for(let c of o)c in r||Mr(`Requesting sparse implementation for ${ut(c)} which is not defined in the schema`,0,0);let l=[];l.push(`#include "${n}kiwi.h"`),s&&l.push(`#include "${n}${s}"`),l.push(""),t.package!==null&&(l.push(`namespace ${t.package} {`),l.push(""),l.push(`#ifndef INCLUDE_${t.package.toUpperCase()}_H`),l.push(`#define INCLUDE_${t.package.toUpperCase()}_H`),l.push("")),l.push("class BinarySchema {"),l.push("public:"),l.push("  bool parse(kiwi::ByteBuffer &bb);"),l.push("  const kiwi::BinarySchema &underlyingSchema() const { return _schema; }");for(let c of t.definitions)c.kind==="MESSAGE"&&(l.push(`  bool skip${c.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const;`),l.push(`  bool skip${c.name}(kiwi::ByteBuffer &bb) const;`)),c.kind==="STRUCT"&&c1(c)&&l.push(`  bool skip${c.name}(kiwi::ByteBuffer &bb) const;`);l.push(""),l.push("private:"),l.push("  kiwi::BinarySchema _schema;");for(let c of t.definitions)c.kind==="MESSAGE"&&l.push(`  uint32_t _index${c.name} = 0;`);l.push("};"),l.push(""),s||m1(t,l);for(let c of[0,1,2,3]){let d=!1;if(c===3){if(t.package!==null){if(o.length>0){l.push(`}  // namespace ${t.package}`);for(let u of o)l.push("template<>"),l.push(`struct std::hash<${t.package}::${u}::Field> {`),l.push(`  size_t operator()(const ${t.package}::${u}::Field& msg) const {`),l.push("    return 0;"),l.push("  }"),l.push("};");l.push(`namespace ${t.package} {`)}l.push(`#endif  // INCLUDE_${t.package.toUpperCase()}_H`)}l.push("#ifdef IMPLEMENT_SCHEMA_H"),l.push(""),l.push("bool BinarySchema::parse(kiwi::ByteBuffer &bb) {"),l.push("  if (!_schema.parse(bb)) return false;");for(let u of t.definitions)u.kind==="MESSAGE"&&l.push(`  _schema.findDefinition("${u.name}", _index${u.name});`);l.push("  return true;"),l.push("}"),l.push("");for(let u of t.definitions)if(u.kind==="MESSAGE"&&(l.push(`bool BinarySchema::skip${u.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const {`),l.push(`  return _schema.skipField(bb, _index${u.name}, id);`),l.push("}"),l.push(""),l.push(`bool BinarySchema::skip${u.name}(kiwi::ByteBuffer &bb) const {`),l.push("  while (true) {"),l.push("    uint32_t type;"),l.push("    if (!bb.readVarUint(type)) return false;"),l.push("    if (type == 0) return true;"),l.push(`    if (!skip${u.name}Field(bb, type)) return false;`),l.push("  }"),l.push("}"),l.push(""),a.includes(u.name)&&(l=l.concat(NB(u,r)))),u.kind==="STRUCT"&&c1(u)){l.push(`bool BinarySchema::skip${u.name}(kiwi::ByteBuffer &bb) const {`);let p=!1,_=!1;for(let h of u.fields)l.push(`  // ${h.name}`),h.type==="float"?(_||(l.push("  float f;"),_=!0),l.push("  if (!bb.readVarFloat(f)) return false;")):(p||(l.push("  uint32_t i;"),p=!0),l.push("  if (!bb.readVarUint(i)) return false;"),h.isArray&&l.push("  if (!bb.skipCount(i)) return false;"));l.push("  return true;"),l.push("}"),l.push("")}}for(let u of t.definitions){if(u.kind==="ENUM")continue;let p=o.includes(u.name);if(p&&u.kind!=="MESSAGE"){let _=`Type ${ut(u.name)} cannot be declared as sparse. `;_+=`${ut(u.name)} is type ${ut(u.kind)}, but needs to be a MESSAGE.`,Mr(_,u.line,u.column)}c===0?(l.push(`class ${u.name};`),d=!0):c===1?(p?l=l.concat(bB(u,r,i.includes(u.name))):l=l.concat(yB(u,r,i.includes(u.name))),a.includes(u.name)&&(l=l.concat(OB(u,r)))):c===2?p?l=l.concat(xB(u,r,i.includes(u.name))):l=l.concat(PB(u,r,i.includes(u.name))):p?(l=l.concat(wB(u,r)),l=l.concat(LB(u,r,o))):(l=l.concat(FB(u,r)),l=l.concat(DB(u,r,o)))}c===3?(l.push("#endif  // IMPLEMENT_SCHEMA_H"),l.push("")):d&&l.push("")}return t.package!==null&&(l.push(`}  // namespace ${t.package}`),l.push("")),l.join(`
`)}function BB(t){let e=["#pragma once",""];return t.package&&(e.push(`namespace ${t.package} {`),e.push("")),m1(t,e),t.package&&(e.push(""),e.push(`}  // namespace ${t.package}`),e.push("")),e.join(`
`)}function m1(t,e){for(let r of t.definitions)if(r.kind==="ENUM"){e.push(`enum class ${r.name} : uint32_t {`);for(let n of r.fields)e.push(`  ${n.name} = ${n.value},`);e.push("};"),e.push("")}}var g1=Jt(()=>{pd()});var S1={};ya(S1,{compileSchemaTypeScript:()=>GB});function GB(t){var e="",r=[];r.push("// This file is auto-generated from share/sync.kiwi"),r.push("// Do not edit this file directly."),r.push("// Run `bazel run //share/kiwi:copy_sync_kiwi` to regenerate."),r.push(""),t.package!==null&&(r.push("export namespace "+t.package+" {"),e+="  ");for(let o of t.definitions)if(o.kind==="ENUM"){r.push(e+"export type "+o.name+" =");for(let[i,a]of o.fields.entries())r.push(e+"  "+JSON.stringify(a.name)+(i+1<o.fields.length?" |":";"));o.fields.length||r.push(e+"  any;"),r.push("")}for(let o of t.definitions)if(o.kind==="STRUCT"||o.kind==="MESSAGE"){r.push(e+"export interface "+o.name+" {");for(let i of o.fields){var n;if(!i.isDeprecated){switch(i.type){case"bool":n="boolean";break;case"byte":case"int":case"uint":case"float":n="number";break;case"int64":case"uint64":n="string";break;default:n=i.type;break}i.type==="byte"&&i.isArray?n="Uint8Array<ArrayBuffer>":i.isArray&&(n+="[]"),r.push(e+"  "+i.name+(o.kind==="MESSAGE"?"?":"")+": "+n+";")}}r.push(e+"}"),r.push("")}else o.kind!=="ENUM"&&Mr("Invalid definition kind "+ut(o.kind),o.line,o.column);r.push(e+"export type DedupCache = any;"),r.push(""),r.push(e+"export interface Schema {"),r.push(e+"  makeDedupCache(): DedupCache;");for(let o of t.definitions)o.kind==="ENUM"?r.push(e+"  "+o.name+": any;"):(o.kind==="STRUCT"||o.kind==="MESSAGE")&&(r.push(e+"  encode"+o.name+"(message: "+o.name+"): Uint8Array<ArrayBuffer>;"),r.push(e+"  decode"+o.name+"(buffer: Uint8Array, optionalDedupCache?: DedupCache): "+o.name+";"),r.push(e+"  redact"+o.name+"(buffer: Uint8Array): void;"));return r.push(e+"}"),t.package!==null&&r.push("}"),r.push(""),r.join(`
`)}var A1=Jt(()=>{pd()});var T1={};ya(T1,{prettyPrintSchema:()=>UB});function UB(t){let e=t.definitions,r="";t.package!==null&&(r+="package "+t.package+`;

`);let n=!0;for(let o of e){n?n=!1:r+=`
`,r+=o.kind.toLowerCase()+" "+o.name+` {
`;for(let i of o.fields)r+="  ",o.kind!=="ENUM"&&(r+=i.type,i.isArray&&(r+="[]"),r+=" "),r+=i.name,o.kind!=="STRUCT"&&(r+=" = "+i.value),i.isDeprecated&&(r+=" [deprecated]"),r+=`;
`;r+=`}
`}return r}var E1=Jt(()=>{});var hd=rc(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.prettyPrintSchema=Wr.parseSchema=Wr.encodeBinarySchema=Wr.decodeBinarySchema=Wr.compileSchemaTypeScript=Wr.compileSchemaCPP=Wr.compileSchemaCallbackCPP=Wr.createKiwiCodec=Wr.KiwiCodec=Wr.compileSchemaJS=Wr.compileSchema=Wr.ByteBuffer=void 0;var VB=(Xu(),Oi(KN));Object.defineProperty(Wr,"ByteBuffer",{enumerable:!0,get:function(){return VB.ByteBuffer}});var I1=(GA(),Oi($N));Object.defineProperty(Wr,"compileSchema",{enumerable:!0,get:function(){return I1.compileSchema}});Object.defineProperty(Wr,"compileSchemaJS",{enumerable:!0,get:function(){return I1.compileSchemaJS}});var R1=(t1(),Oi(e1));Object.defineProperty(Wr,"KiwiCodec",{enumerable:!0,get:function(){return R1.KiwiCodec}});Object.defineProperty(Wr,"createKiwiCodec",{enumerable:!0,get:function(){return R1.createKiwiCodec}});var kB=(s1(),Oi(a1));Object.defineProperty(Wr,"compileSchemaCallbackCPP",{enumerable:!0,get:function(){return kB.compileSchemaCallbackCPP}});var HB=(g1(),Oi(f1));Object.defineProperty(Wr,"compileSchemaCPP",{enumerable:!0,get:function(){return HB.compileSchemaCPP}});var zB=(A1(),Oi(S1));Object.defineProperty(Wr,"compileSchemaTypeScript",{enumerable:!0,get:function(){return zB.compileSchemaTypeScript}});var y1=(Uh(),Oi(ZN));Object.defineProperty(Wr,"decodeBinarySchema",{enumerable:!0,get:function(){return y1.decodeBinarySchema}});Object.defineProperty(Wr,"encodeBinarySchema",{enumerable:!0,get:function(){return y1.encodeBinarySchema}});var WB=(Gh(),Oi(jN));Object.defineProperty(Wr,"parseSchema",{enumerable:!0,get:function(){return WB.parseSchema}});var KB=(E1(),Oi(T1));Object.defineProperty(Wr,"prettyPrintSchema",{enumerable:!0,get:function(){return KB.prettyPrintSchema}})});var C1=rc(rb=>{"use strict";Object.defineProperty(rb,"__esModule",{value:!0});Object.defineProperty(rb,"devicePresetHasOverlyRoundedCorners",{enumerable:!0,get:function(){return w2}});var x2=["APPLE_IPHONE_14_PRO","APPLE_IPHONE_14_PLUS","APPLE_IPHONE_15","APPLE_WATCH_45MM","APPLE_WATCH_SERIES_10_42MM","APPLE_WATCH_SERIES_10_46MM","APPLE_IPHONE_16"],w2=t=>x2.some(e=>t.startsWith(e))});var O1=rc(nb=>{"use strict";Object.defineProperty(nb,"__esModule",{value:!0});Object.defineProperty(nb,"WebGLVersionSupport",{enumerable:!0,get:function(){return L2}});var L2=class ac{_isWebGL2Supported=!1;_initializationStatus="webgl1_success";static _instance;constructor(){this._isWebGL2Supported=!1;let r=document.createElement("canvas").getContext("webgl2");if(!r){this._initializationStatus="webgl2_not_supported";return}let n=this.renderer(r);if(!n||/radeon/.test(n)){this._initializationStatus="webgl2_disallow_list";return}if(/swiftshader/.test(n)){let i=document.createElement("canvas").getContext("webgl"),a=this.renderer(i);if(!a||!/swiftshader/.test(a)){this._initializationStatus="webgl2_software_rendering";return}}this._initializationStatus="webgl2_success",this._isWebGL2Supported=!0}renderer(e){if(!e)return null;let r=e.getExtension("WEBGL_debug_renderer_info");return r&&(e.getParameter(r.UNMASKED_RENDERER_WEBGL)+"").toLowerCase()}static instance(){return ac._instance||(ac._instance=new ac),ac._instance}static isWebGL2Supported(){return ac.instance()._isWebGL2Supported}static initializationStatus(){return ac.instance()._initializationStatus}}});var ib=rc(ob=>{"use strict";Object.defineProperty(ob,"__esModule",{value:!0});function M2(t,e){for(var r in e)Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}M2(ob,{WebGLVersionSupport:function(){return G2.WebGLVersionSupport},devicePresetHasOverlyRoundedCorners:function(){return B2.devicePresetHasOverlyRoundedCorners}});var B2=C1(),G2=O1()});function jf(t){return Zf(t.map(([e,r])=>new Array(e).fill(r,0,e)))}function Zf(t){return t.reduce((e,r)=>e.concat(Array.isArray(r)?Zf(r):r),[])}function tn(){let t=this;function e(o){let i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length,d,u,p,_,h,g,m=0;for(_=0;_<=15;_++)o.bl_count[_]=0;for(i[o.heap[o.heap_max]*2+1]=0,d=o.heap_max+1;d<573;d++)u=o.heap[d],_=i[i[u*2+1]*2+1]+1,_>c&&(_=c,m++),i[u*2+1]=_,!(u>t.max_code)&&(o.bl_count[_]++,h=0,u>=l&&(h=s[u-l]),g=i[u*2],o.opt_len+=g*(_+h),a&&(o.static_len+=g*(a[u*2+1]+h)));if(m!==0){do{for(_=c-1;o.bl_count[_]===0;)_--;o.bl_count[_]--,o.bl_count[_+1]+=2,o.bl_count[c]--,m-=2}while(m>0);for(_=c;_!==0;_--)for(u=o.bl_count[_];u!==0;)p=o.heap[--d],!(p>t.max_code)&&(i[p*2+1]!=_&&(o.opt_len+=(_-i[p*2+1])*i[p*2],i[p*2+1]=_),u--)}}function r(o,i){let a=0;do a|=o&1,o>>>=1,a<<=1;while(--i>0);return a>>>1}function n(o,i,a){let s=[],l=0,c,d,u;for(c=1;c<=15;c++)s[c]=l=l+a[c-1]<<1;for(d=0;d<=i;d++)u=o[d*2+1],u!==0&&(o[d*2]=r(s[u]++,u))}t.build_tree=function(o){let i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.elems,l,c,d=-1,u;for(o.heap_len=0,o.heap_max=573,l=0;l<s;l++)i[l*2]!==0?(o.heap[++o.heap_len]=d=l,o.depth[l]=0):i[l*2+1]=0;for(;o.heap_len<2;)u=o.heap[++o.heap_len]=d<2?++d:0,i[u*2]=1,o.depth[u]=0,o.opt_len--,a&&(o.static_len-=a[u*2+1]);for(t.max_code=d,l=Math.floor(o.heap_len/2);l>=1;l--)o.pqdownheap(i,l);u=s;do l=o.heap[1],o.heap[1]=o.heap[o.heap_len--],o.pqdownheap(i,1),c=o.heap[1],o.heap[--o.heap_max]=l,o.heap[--o.heap_max]=c,i[u*2]=i[l*2]+i[c*2],o.depth[u]=Math.max(o.depth[l],o.depth[c])+1,i[l*2+1]=i[c*2+1]=u,o.heap[1]=u++,o.pqdownheap(i,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],e(o),n(i,t.max_code,o.bl_count)}}function yo(t,e,r,n,o){let i=this;i.static_tree=t,i.extra_bits=e,i.extra_base=r,i.elems=n,i.max_length=o}function ps(t,e,r,n,o){let i=this;i.good_length=t,i.max_lazy=e,i.nice_length=r,i.max_chain=n,i.func=o}function Cx(t,e,r,n){let o=t[e*2],i=t[r*2];return o<i||o==i&&n[e]<=n[r]}function fk(){let t=this,e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S,T,R,b,O,f,I,y,P,E,C,B,G,V,D,w,k=new tn,z=new tn,H=new tn;t.depth=[];let K,j,q,J,ie,Ee;t.bl_count=[],t.heap=[],V=[],D=[],w=[];function Ke(){c=2*i,u[_-1]=0;for(let me=0;me<_-1;me++)u[me]=0;P=ka[E].max_lazy,B=ka[E].good_length,G=ka[E].nice_length,y=ka[E].max_chain,b=0,A=0,f=0,S=I=hn-1,R=0,p=0}function Ve(){let me;for(me=0;me<286;me++)V[me*2]=0;for(me=0;me<30;me++)D[me*2]=0;for(me=0;me<19;me++)w[me*2]=0;V[256*2]=1,t.opt_len=t.static_len=0,j=q=0}function at(){k.dyn_tree=V,k.stat_desc=yo.static_l_desc,z.dyn_tree=D,z.stat_desc=yo.static_d_desc,H.dyn_tree=w,H.stat_desc=yo.static_bl_desc,ie=0,Ee=0,J=8,Ve()}t.pqdownheap=function(me,Pe){let be=t.heap,x=be[Pe],M=Pe<<1;for(;M<=t.heap_len&&(M<t.heap_len&&Cx(me,be[M+1],be[M],t.depth)&&M++,!Cx(me,x,be[M],t.depth));)be[Pe]=be[M],Pe=M,M<<=1;be[Pe]=x};function Dt(me,Pe){let be=-1,x,M=me[0*2+1],W=0,Z=7,te=4;M===0&&(Z=138,te=3),me[(Pe+1)*2+1]=65535;for(let Y=0;Y<=Pe;Y++)x=M,M=me[(Y+1)*2+1],!(++W<Z&&x==M)&&(W<te?w[x*2]+=W:x!==0?(x!=be&&w[x*2]++,w[16*2]++):W<=10?w[17*2]++:w[18*2]++,W=0,be=x,M===0?(Z=138,te=3):x==M?(Z=6,te=3):(Z=7,te=4))}function qt(){let me;for(Dt(V,k.max_code),Dt(D,z.max_code),H.build_tree(t),me=18;me>=3&&w[tn.bl_order[me]*2+1]===0;me--);return t.opt_len+=3*(me+1)+5+5+4,me}function zt(me){t.pending_buf[t.pending++]=me}function ae(me){zt(me&255),zt(me>>>8&255)}function nt(me){zt(me>>8&255),zt(me&255&255)}function Et(me,Pe){let be,x=Pe;Ee>16-x?(be=me,ie|=be<<Ee&65535,ae(ie),ie=be>>>16-Ee,Ee+=x-16):(ie|=me<<Ee&65535,Ee+=x)}function He(me,Pe){let be=me*2;Et(Pe[be]&65535,Pe[be+1]&65535)}function st(me,Pe){let be,x=-1,M,W=me[0*2+1],Z=0,te=7,Y=4;for(W===0&&(te=138,Y=3),be=0;be<=Pe;be++)if(M=W,W=me[(be+1)*2+1],!(++Z<te&&M==W)){if(Z<Y)do He(M,w);while(--Z!==0);else M!==0?(M!=x&&(He(M,w),Z--),He(16,w),Et(Z-3,2)):Z<=10?(He(17,w),Et(Z-3,3)):(He(18,w),Et(Z-11,7));Z=0,x=M,W===0?(te=138,Y=3):M==W?(te=6,Y=3):(te=7,Y=4)}}function ke(me,Pe,be){let x;for(Et(me-257,5),Et(Pe-1,5),Et(be-4,4),x=0;x<be;x++)Et(w[tn.bl_order[x]*2+1],3);st(V,me-1),st(D,Pe-1)}function kt(){Ee==16?(ae(ie),ie=0,Ee=0):Ee>=8&&(zt(ie&255),ie>>>=8,Ee-=8)}function Zt(){Et(eC<<1,3),He(256,yo.static_ltree),kt(),1+J+10-Ee<9&&(Et(eC<<1,3),He(256,yo.static_ltree),kt()),J=7}function Wt(me,Pe){let be,x,M;if(t.dist_buf[j]=me,t.lc_buf[j]=Pe&255,j++,me===0?V[Pe*2]++:(q++,me--,V[(tn._length_code[Pe]+256+1)*2]++,D[tn.d_code(me)*2]++),(j&8191)===0&&E>2){for(be=j*8,x=b-A,M=0;M<30;M++)be+=D[M*2]*(5+tn.extra_dbits[M]);if(be>>>=3,q<Math.floor(j/2)&&be<Math.floor(x/2))return!0}return j==K-1}function br(me,Pe){let be,x,M=0,W,Z;if(j!==0)do be=t.dist_buf[M],x=t.lc_buf[M],M++,be===0?He(x,me):(W=tn._length_code[x],He(W+256+1,me),Z=tn.extra_lbits[W],Z!==0&&(x-=tn.base_length[W],Et(x,Z)),be--,W=tn.d_code(be),He(W,Pe),Z=tn.extra_dbits[W],Z!==0&&(be-=tn.base_dist[W],Et(be,Z)));while(M<j);He(256,me),J=me[256*2+1]}function on(){Ee>8?ae(ie):Ee>0&&zt(ie&255),ie=0,Ee=0}function an(me,Pe,be){on(),J=8,be&&(ae(Pe),ae(~Pe)),t.pending_buf.set(l.subarray(me,me+Pe),t.pending),t.pending+=Pe}function _o(me,Pe,be){Et((hk<<1)+(be?1:0),3),an(me,Pe,!0)}function Ia(me,Pe,be){let x,M,W=0;E>0?(k.build_tree(t),z.build_tree(t),W=qt(),x=t.opt_len+3+7>>>3,M=t.static_len+3+7>>>3,M<=x&&(x=M)):x=M=Pe+5,Pe+4<=x&&me!=-1?_o(me,Pe,be):M==x?(Et((eC<<1)+(be?1:0),3),br(yo.static_ltree,yo.static_dtree)):(Et((mk<<1)+(be?1:0),3),ke(k.max_code+1,z.max_code+1,W+1),br(V,D)),Ve(),be&&on()}function vr(me){Ia(A>=0?A:-1,b-A,me),A=b,e.flush_pending()}function ri(){let me,Pe,be,x;do{if(x=c-f-b,x===0&&b===0&&f===0)x=i;else if(x==-1)x--;else if(b>=i+i-Vi){l.set(l.subarray(i,i+i),0),O-=i,b-=i,A-=i,me=_,be=me;do Pe=u[--be]&65535,u[be]=Pe>=i?Pe-i:0;while(--me!==0);me=i,be=me;do Pe=d[--be]&65535,d[be]=Pe>=i?Pe-i:0;while(--me!==0);x+=i}if(e.avail_in===0)return;me=e.read_buf(l,b+f,x),f+=me,f>=hn&&(p=l[b]&255,p=(p<<m^l[b+1]&255)&g)}while(f<Vi&&e.avail_in!==0)}function Xi(me){let Pe=65535,be;for(Pe>n-5&&(Pe=n-5);;){if(f<=1){if(ri(),f===0&&me==0)return _a;if(f===0)break}if(b+=f,f=0,be=A+Pe,(b===0||b>=be)&&(f=b-be,b=be,vr(!1),e.avail_out===0)||b-A>=i-Vi&&(vr(!1),e.avail_out===0))return _a}return vr(me==4),e.avail_out===0?me==4?o_:_a:me==4?Yf:Kf}function vi(me){let Pe=y,be=b,x,M,W=I,Z=b>i-Vi?b-(i-Vi):0,te=G,Y=s,re=b+Xf,se=l[be+W-1],oe=l[be+W];I>=B&&(Pe>>=2),te>f&&(te=f);do if(x=me,!(l[x+W]!=oe||l[x+W-1]!=se||l[x]!=l[be]||l[++x]!=l[be+1])){be+=2,x++;do;while(l[++be]==l[++x]&&l[++be]==l[++x]&&l[++be]==l[++x]&&l[++be]==l[++x]&&l[++be]==l[++x]&&l[++be]==l[++x]&&l[++be]==l[++x]&&l[++be]==l[++x]&&be<re);if(M=Xf-(re-be),be=re-Xf,M>W){if(O=me,W=M,M>=te)break;se=l[be+W-1],oe=l[be+W]}}while((me=d[me&Y]&65535)>Z&&--Pe!==0);return W<=f?W:f}function ji(me){let Pe=0,be;for(;;){if(f<Vi){if(ri(),f<Vi&&me==0)return _a;if(f===0)break}if(f>=hn&&(p=(p<<m^l[b+(hn-1)]&255)&g,Pe=u[p]&65535,d[b&s]=u[p],u[p]=b),Pe!==0&&(b-Pe&65535)<=i-Vi&&C!=2&&(S=vi(Pe)),S>=hn)if(be=Wt(b-O,S-hn),f-=S,S<=P&&f>=hn){S--;do b++,p=(p<<m^l[b+(hn-1)]&255)&g,Pe=u[p]&65535,d[b&s]=u[p],u[p]=b;while(--S!==0);b++}else b+=S,S=0,p=l[b]&255,p=(p<<m^l[b+1]&255)&g;else be=Wt(0,l[b]&255),f--,b++;if(be&&(vr(!1),e.avail_out===0))return _a}return vr(me==4),e.avail_out===0?me==4?o_:_a:me==4?Yf:Kf}function Zi(me){let Pe=0,be,x;for(;;){if(f<Vi){if(ri(),f<Vi&&me==0)return _a;if(f===0)break}if(f>=hn&&(p=(p<<m^l[b+(hn-1)]&255)&g,Pe=u[p]&65535,d[b&s]=u[p],u[p]=b),I=S,T=O,S=hn-1,Pe!==0&&I<P&&(b-Pe&65535)<=i-Vi&&(C!=2&&(S=vi(Pe)),S<=5&&(C==1||S==hn&&b-O>4096)&&(S=hn-1)),I>=hn&&S<=I){x=b+f-hn,be=Wt(b-1-T,I-hn),f-=I-1,I-=2;do++b<=x&&(p=(p<<m^l[b+(hn-1)]&255)&g,Pe=u[p]&65535,d[b&s]=u[p],u[p]=b);while(--I!==0);if(R=0,S=hn-1,b++,be&&(vr(!1),e.avail_out===0))return _a}else if(R!==0){if(be=Wt(0,l[b-1]&255),be&&vr(!1),b++,f--,e.avail_out===0)return _a}else R=1,b++,f--}return R!==0&&(be=Wt(0,l[b-1]&255),R=0),vr(me==4),e.avail_out===0?me==4?o_:_a:me==4?Yf:Kf}function Ci(me){return me.total_in=me.total_out=0,me.msg=null,t.pending=0,t.pending_out=0,r=Qf,o=0,at(),Ke(),0}t.deflateInit=function(me,Pe,be,x,M,W){return x||(x=$v),M||(M=pk),W||(W=0),me.msg=null,Pe==-1&&(Pe=6),M<1||M>uk||x!=$v||be<9||be>15||Pe<0||Pe>9||W<0||W>2?-2:(me.dstate=t,a=be,i=1<<a,s=i-1,h=M+7,_=1<<h,g=_-1,m=Math.floor((h+hn-1)/hn),l=new Uint8Array(i*2),d=[],u=[],K=1<<M+6,t.pending_buf=new Uint8Array(K*4),n=K*4,t.dist_buf=new Uint16Array(K),t.lc_buf=new Uint8Array(K),E=Pe,C=W,Ci(me))},t.deflateEnd=function(){return r!=Jv&&r!=Qf&&r!=i_?-2:(t.lc_buf=null,t.dist_buf=null,t.pending_buf=null,u=null,d=null,l=null,t.dstate=null,r==Qf?-3:0)},t.deflateParams=function(me,Pe,be){let x=0;return Pe==-1&&(Pe=6),Pe<0||Pe>9||be<0||be>2?-2:(ka[E].func!=ka[Pe].func&&me.total_in!==0&&(x=me.deflate(1)),E!=Pe&&(E=Pe,P=ka[E].max_lazy,B=ka[E].good_length,G=ka[E].nice_length,y=ka[E].max_chain),C=be,x)},t.deflateSetDictionary=function(me,Pe,be){let x=be,M,W=0;if(!Pe||r!=Jv)return-2;if(x<hn)return 0;for(x>i-Vi&&(x=i-Vi,W=be-x),l.set(Pe.subarray(W,W+x),0),b=x,A=x,p=l[0]&255,p=(p<<m^l[1]&255)&g,M=0;M<=x-hn;M++)p=(p<<m^l[M+(hn-1)]&255)&g,d[M&s]=u[p],u[p]=M;return 0},t.deflate=function(me,Pe){let be,x,M,W,Z;if(Pe>4||Pe<0)return-2;if(!me.next_out||!me.next_in&&me.avail_in!==0||r==i_&&Pe!=4)return me.msg=Wf[4],-2;if(me.avail_out===0)return me.msg=Wf[7],-5;if(e=me,W=o,o=Pe,r==Jv&&(x=$v+(a-8<<4)<<8,M=(E-1&255)>>1,M>3&&(M=3),x|=M<<6,b!==0&&(x|=_k),x+=31-x%31,r=Qf,nt(x)),t.pending!==0){if(e.flush_pending(),e.avail_out===0)return o=-1,0}else if(e.avail_in===0&&Pe<=W&&Pe!=4)return e.msg=Wf[7],-5;if(r==i_&&e.avail_in!==0)return me.msg=Wf[7],-5;if(e.avail_in!==0||f!==0||Pe!=0&&r!=i_){switch(Z=-1,ka[E].func){case Ox:Z=Xi(Pe);break;case qf:Z=ji(Pe);break;case zc:Z=Zi(Pe);break;default:}if((Z==o_||Z==Yf)&&(r=i_),Z==_a||Z==o_)return e.avail_out===0&&(o=-1),0;if(Z==Kf){if(Pe==1)Zt();else if(_o(0,0,!1),Pe==3)for(be=0;be<_;be++)u[be]=0;if(e.flush_pending(),e.avail_out===0)return o=-1,0}}return Pe!=4?0:1}}function Nx(){let t=this;t.next_in_index=0,t.next_out_index=0,t.avail_in=0,t.total_in=0,t.avail_out=0,t.total_out=0}function gk(t){let e=this,r=new Nx,n=Sk(t&&t.chunkSize?t.chunkSize:64*1024),o=0,i=new Uint8Array(n),a=t?t.level:-1;typeof a>"u"&&(a=-1),r.deflateInit(a),r.next_out=i,e.append=function(s,l){let c,d,u=0,p=0,_=0,h=[];if(s.length){r.next_in_index=0,r.next_in=s,r.avail_in=s.length;do{if(r.next_out_index=0,r.avail_out=n,c=r.deflate(o),c!=0)throw new Error("deflating: "+r.msg);r.next_out_index&&(r.next_out_index==n?h.push(new Uint8Array(i)):h.push(i.slice(0,r.next_out_index))),_+=r.next_out_index,l&&r.next_in_index>0&&r.next_in_index!=u&&(l(r.next_in_index),u=r.next_in_index)}while(r.avail_in>0||r.avail_out===0);return h.length>1?(d=new Uint8Array(_),h.forEach(function(g){d.set(g,p),p+=g.length})):d=h[0]||new Uint8Array(0),d}},e.flush=function(){let s,l,c=0,d=0,u=[];do{if(r.next_out_index=0,r.avail_out=n,s=r.deflate(4),s!=1&&s!=0)throw new Error("deflating: "+r.msg);n-r.avail_out>0&&u.push(i.slice(0,r.next_out_index)),d+=r.next_out_index}while(r.avail_in>0||r.avail_out===0);return r.deflateEnd(),l=new Uint8Array(d),u.forEach(function(p){l.set(p,c),c+=p.length}),l}}function Sk(t){return t+5*(Math.floor(t/16383)+1)}var vx,sk,lk,ck,dk,uk,pk,Ox,qf,zc,ka,Wf,_a,Kf,o_,Yf,_k,Jv,Qf,i_,$v,hk,eC,mk,hn,Xf,Vi,Px,Fx=Jt(()=>{vx=[0,1,2,3].concat(...jf([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));tn._length_code=[0,1,2,3,4,5,6,7].concat(...jf([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));tn.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];tn.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];tn.d_code=function(t){return t<256?vx[t]:vx[256+(t>>>7)]};tn.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];tn.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];tn.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];tn.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];sk=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],lk=jf([[144,8],[112,9],[24,7],[8,8]]);yo.static_ltree=Zf(sk.map((t,e)=>[t,lk[e]]));ck=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],dk=jf([[30,5]]);yo.static_dtree=Zf(ck.map((t,e)=>[t,dk[e]]));yo.static_l_desc=new yo(yo.static_ltree,tn.extra_lbits,257,286,15);yo.static_d_desc=new yo(yo.static_dtree,tn.extra_dbits,0,30,15);yo.static_bl_desc=new yo(null,tn.extra_blbits,0,19,7);uk=9,pk=8;Ox=0,qf=1,zc=2,ka=[new ps(0,0,0,0,Ox),new ps(4,4,8,4,qf),new ps(4,5,16,8,qf),new ps(4,6,32,32,qf),new ps(4,4,16,16,zc),new ps(8,16,32,32,zc),new ps(8,16,128,128,zc),new ps(8,32,128,256,zc),new ps(32,128,258,1024,zc),new ps(32,258,258,4096,zc)],Wf=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],_a=0,Kf=1,o_=2,Yf=3,_k=32,Jv=42,Qf=113,i_=666,$v=8,hk=0,eC=1,mk=2,hn=3,Xf=258,Vi=Xf+hn+1;Nx.prototype={deflateInit:function(t,e){let r=this;return r.dstate=new fk,e||(e=15),r.dstate.deflateInit(r,t,e)},deflate:function(t){let e=this;return e.dstate?e.dstate.deflate(e,t):-2},deflateEnd:function(){let t=this;if(!t.dstate)return-2;let e=t.dstate.deflateEnd();return t.dstate=null,e},deflateParams:function(t,e){let r=this;return r.dstate?r.dstate.deflateParams(r,t,e):-2},deflateSetDictionary:function(t,e){let r=this;return r.dstate?r.dstate.deflateSetDictionary(r,t,e):-2},read_buf:function(t,e,r){let n=this,o=n.avail_in;return o>r&&(o=r),o===0?0:(n.avail_in-=o,t.set(n.next_in.subarray(n.next_in_index,n.next_in_index+o),e),n.next_in_index+=o,n.total_in+=o,o)},flush_pending:function(){let t=this,e=t.dstate.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.next_out.set(t.dstate.pending_buf.subarray(t.dstate.pending_out,t.dstate.pending_out+e),t.next_out_index),t.next_out_index+=e,t.dstate.pending_out+=e,t.total_out+=e,t.avail_out-=e,t.dstate.pending-=e,t.dstate.pending===0&&(t.dstate.pending_out=0))}};Px=gk});function oC(){let t=this,e,r,n,o,i,a;function s(c,d,u,p,_,h,g,m,A,S,T){let R,b,O,f,I,y,P,E,C,B,G,V,D,w,k;B=0,I=u;do n[c[d+B]]++,B++,I--;while(I!==0);if(n[0]==u)return g[0]=-1,m[0]=0,0;for(E=m[0],y=1;y<=Fl&&n[y]===0;y++);for(P=y,E<y&&(E=y),I=Fl;I!==0&&n[I]===0;I--);for(O=I,E>I&&(E=I),m[0]=E,w=1<<y;y<I;y++,w<<=1)if((w-=n[y])<0)return-3;if((w-=n[I])<0)return-3;for(n[I]+=w,a[1]=y=0,B=1,D=2;--I!==0;)a[D]=y+=n[B],D++,B++;I=0,B=0;do(y=c[d+B])!==0&&(T[a[y]++]=I),B++;while(++I<u);for(u=a[O],a[0]=I=0,B=0,f=-1,V=-E,i[0]=0,G=0,k=0;P<=O;P++)for(R=n[P];R--!==0;){for(;P>V+E;){if(f++,V+=E,k=O-V,k=k>E?E:k,(b=1<<(y=P-V))>R+1&&(b-=R+1,D=P,y<k))for(;++y<k&&!((b<<=1)<=n[++D]);)b-=n[D];if(k=1<<y,S[0]+k>Zx)return-3;i[f]=G=S[0],S[0]+=k,f!==0?(a[f]=I,o[0]=y,o[1]=E,y=I>>>V-E,o[2]=G-i[f-1]-y,A.set(o,(i[f-1]+y)*3)):g[0]=G}for(o[1]=P-V,B>=u?o[0]=192:T[B]<p?(o[0]=T[B]<256?0:96,o[2]=T[B++]):(o[0]=h[T[B]-p]+16+64,o[2]=_[T[B++]-p]),b=1<<P-V,y=I>>>V;y<k;y+=b)A.set(o,(G+y)*3);for(y=1<<P-1;(I&y)!==0;y>>>=1)I^=y;for(I^=y,C=(1<<V)-1;(I&C)!=a[f];)f--,V-=E,C=(1<<V)-1}return w!==0&&O!=1?-5:0}function l(c){let d;for(e||(e=[],r=[],n=new Int32Array(Fl+1),o=[],i=new Int32Array(Fl),a=new Int32Array(Fl+1)),r.length<c&&(r=[]),d=0;d<c;d++)r[d]=0;for(d=0;d<Fl+1;d++)n[d]=0;for(d=0;d<3;d++)o[d]=0;i.set(n.subarray(0,Fl),0),a.set(n.subarray(0,Fl+1),0)}t.inflate_trees_bits=function(c,d,u,p,_){let h;return l(19),e[0]=0,h=s(c,0,19,19,null,null,u,d,p,e,r),h==-3?_.msg="oversubscribed dynamic bit lengths tree":(h==-5||d[0]===0)&&(_.msg="incomplete dynamic bit lengths tree",h=-3),h},t.inflate_trees_dynamic=function(c,d,u,p,_,h,g,m,A){let S;return l(288),e[0]=0,S=s(u,0,c,257,bk,vk,h,p,m,e,r),S!=0||p[0]===0?(S==-3?A.msg="oversubscribed literal/length tree":S!=-4&&(A.msg="incomplete literal/length tree",S=-3),S):(l(288),S=s(u,c,d,0,Ck,Ok,g,_,m,e,r),S!=0||_[0]===0&&c>257?(S==-3?A.msg="oversubscribed distance tree":S==-5?(A.msg="incomplete distance tree",S=-3):S!=-4&&(A.msg="empty distance tree with lengths",S=-3),S):0)}}function Nk(){let t=this,e,r=0,n,o=0,i=0,a=0,s=0,l=0,c=0,d=0,u,p=0,_,h=0;function g(m,A,S,T,R,b,O,f){let I,y,P,E,C,B,G,V,D,w,k,z,H,K,j,q;G=f.next_in_index,V=f.avail_in,C=O.bitb,B=O.bitk,D=O.write,w=D<O.read?O.read-D-1:O.end-D,k=ki[m],z=ki[A];do{for(;B<20;)V--,C|=(f.read_byte(G++)&255)<<B,B+=8;if(I=C&k,y=S,P=T,q=(P+I)*3,(E=y[q])===0){C>>=y[q+1],B-=y[q+1],O.win[D++]=y[q+2],w--;continue}do{if(C>>=y[q+1],B-=y[q+1],(E&16)!==0){for(E&=15,H=y[q+2]+(C&ki[E]),C>>=E,B-=E;B<15;)V--,C|=(f.read_byte(G++)&255)<<B,B+=8;I=C&z,y=R,P=b,q=(P+I)*3,E=y[q];do if(C>>=y[q+1],B-=y[q+1],(E&16)!==0){for(E&=15;B<E;)V--,C|=(f.read_byte(G++)&255)<<B,B+=8;if(K=y[q+2]+(C&ki[E]),C>>=E,B-=E,w-=H,D>=K)j=D-K,D-j>0&&2>D-j?(O.win[D++]=O.win[j++],O.win[D++]=O.win[j++],H-=2):(O.win.set(O.win.subarray(j,j+2),D),D+=2,j+=2,H-=2);else{j=D-K;do j+=O.end;while(j<0);if(E=O.end-j,H>E){if(H-=E,D-j>0&&E>D-j)do O.win[D++]=O.win[j++];while(--E!==0);else O.win.set(O.win.subarray(j,j+E),D),D+=E,j+=E,E=0;j=0}}if(D-j>0&&H>D-j)do O.win[D++]=O.win[j++];while(--H!==0);else O.win.set(O.win.subarray(j,j+H),D),D+=H,j+=H,H=0;break}else if((E&64)===0)I+=y[q+2],I+=C&ki[E],q=(P+I)*3,E=y[q];else return f.msg="invalid distance code",H=f.avail_in-V,H=B>>3<H?B>>3:H,V+=H,G-=H,B-=H<<3,O.bitb=C,O.bitk=B,f.avail_in=V,f.total_in+=G-f.next_in_index,f.next_in_index=G,O.write=D,-3;while(!0);break}if((E&64)===0){if(I+=y[q+2],I+=C&ki[E],q=(P+I)*3,(E=y[q])===0){C>>=y[q+1],B-=y[q+1],O.win[D++]=y[q+2],w--;break}}else return(E&32)!==0?(H=f.avail_in-V,H=B>>3<H?B>>3:H,V+=H,G-=H,B-=H<<3,O.bitb=C,O.bitk=B,f.avail_in=V,f.total_in+=G-f.next_in_index,f.next_in_index=G,O.write=D,1):(f.msg="invalid literal/length code",H=f.avail_in-V,H=B>>3<H?B>>3:H,V+=H,G-=H,B-=H<<3,O.bitb=C,O.bitk=B,f.avail_in=V,f.total_in+=G-f.next_in_index,f.next_in_index=G,O.write=D,-3)}while(!0)}while(w>=258&&V>=10);return H=f.avail_in-V,H=B>>3<H?B>>3:H,V+=H,G-=H,B-=H<<3,O.bitb=C,O.bitk=B,f.avail_in=V,f.total_in+=G-f.next_in_index,f.next_in_index=G,O.write=D,0}t.init=function(m,A,S,T,R,b){e=Jf,c=m,d=A,u=S,p=T,_=R,h=b,n=null},t.proc=function(m,A,S){let T,R,b,O=0,f=0,I=0,y,P,E,C;for(I=A.next_in_index,y=A.avail_in,O=m.bitb,f=m.bitk,P=m.write,E=P<m.read?m.read-P-1:m.end-P;;)switch(e){case Jf:if(E>=258&&y>=10&&(m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,S=g(c,d,u,p,_,h,m,A),I=A.next_in_index,y=A.avail_in,O=m.bitb,f=m.bitk,P=m.write,E=P<m.read?m.read-P-1:m.end-P,S!=0)){e=S==1?tC:$f;break}i=c,n=u,o=p,e=Dx;case Dx:for(T=i;f<T;){if(y!==0)S=0;else return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);y--,O|=(A.read_byte(I++)&255)<<f,f+=8}if(R=(o+(O&ki[T]))*3,O>>>=n[R+1],f-=n[R+1],b=n[R],b===0){a=n[R+2],e=Bx;break}if((b&16)!==0){s=b&15,r=n[R+2],e=xx;break}if((b&64)===0){i=b,o=R/3+n[R+2];break}if((b&32)!==0){e=tC;break}return e=$f,A.msg="invalid literal/length code",S=-3,m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);case xx:for(T=s;f<T;){if(y!==0)S=0;else return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);y--,O|=(A.read_byte(I++)&255)<<f,f+=8}r+=O&ki[T],O>>=T,f-=T,i=d,n=_,o=h,e=wx;case wx:for(T=i;f<T;){if(y!==0)S=0;else return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);y--,O|=(A.read_byte(I++)&255)<<f,f+=8}if(R=(o+(O&ki[T]))*3,O>>=n[R+1],f-=n[R+1],b=n[R],(b&16)!==0){s=b&15,l=n[R+2],e=Lx;break}if((b&64)===0){i=b,o=R/3+n[R+2];break}return e=$f,A.msg="invalid distance code",S=-3,m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);case Lx:for(T=s;f<T;){if(y!==0)S=0;else return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);y--,O|=(A.read_byte(I++)&255)<<f,f+=8}l+=O&ki[T],O>>=T,f-=T,e=Mx;case Mx:for(C=P-l;C<0;)C+=m.end;for(;r!==0;){if(E===0&&(P==m.end&&m.read!==0&&(P=0,E=P<m.read?m.read-P-1:m.end-P),E===0&&(m.write=P,S=m.inflate_flush(A,S),P=m.write,E=P<m.read?m.read-P-1:m.end-P,P==m.end&&m.read!==0&&(P=0,E=P<m.read?m.read-P-1:m.end-P),E===0)))return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);m.win[P++]=m.win[C++],E--,C==m.end&&(C=0),r--}e=Jf;break;case Bx:if(E===0&&(P==m.end&&m.read!==0&&(P=0,E=P<m.read?m.read-P-1:m.end-P),E===0&&(m.write=P,S=m.inflate_flush(A,S),P=m.write,E=P<m.read?m.read-P-1:m.end-P,P==m.end&&m.read!==0&&(P=0,E=P<m.read?m.read-P-1:m.end-P),E===0)))return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);S=0,m.win[P++]=a,E--,e=Jf;break;case tC:if(f>7&&(f-=8,y++,I--),m.write=P,S=m.inflate_flush(A,S),P=m.write,E=P<m.read?m.read-P-1:m.end-P,m.read!=m.write)return m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);e=Gx;case Gx:return S=1,m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);case $f:return S=-3,m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S);default:return S=-2,m.bitb=O,m.bitk=f,A.avail_in=y,A.total_in+=I-A.next_in_index,A.next_in_index=I,m.write=P,m.inflate_flush(A,S)}},t.free=function(){}}function Pk(t,e){let r=this,n=ru,o=0,i=0,a=0,s,l=[0],c=[0],d=new Nk,u=0,p=new Int32Array(Zx*3),_=0,h=new oC;r.bitk=0,r.bitb=0,r.win=new Uint8Array(e),r.end=e,r.read=0,r.write=0,r.reset=function(g,m){m&&(m[0]=_),n==eg&&d.free(g),n=ru,r.bitk=0,r.bitb=0,r.read=r.write=0},r.reset(t,null),r.inflate_flush=function(g,m){let A,S,T;return S=g.next_out_index,T=r.read,A=(T<=r.write?r.write:r.end)-T,A>g.avail_out&&(A=g.avail_out),A!==0&&m==-5&&(m=0),g.avail_out-=A,g.total_out+=A,g.next_out.set(r.win.subarray(T,T+A),S),S+=A,T+=A,T==r.end&&(T=0,r.write==r.end&&(r.write=0),A=r.write-T,A>g.avail_out&&(A=g.avail_out),A!==0&&m==-5&&(m=0),g.avail_out-=A,g.total_out+=A,g.next_out.set(r.win.subarray(T,T+A),S),S+=A,T+=A),g.next_out_index=S,r.read=T,m},r.proc=function(g,m){let A,S,T,R,b,O,f,I;for(R=g.next_in_index,b=g.avail_in,S=r.bitb,T=r.bitk,O=r.write,f=O<r.read?r.read-O-1:r.end-O;;){let y,P,E,C,B,G,V,D;switch(n){case ru:for(;T<3;){if(b!==0)m=0;else return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);b--,S|=(g.read_byte(R++)&255)<<T,T+=8}switch(A=S&7,u=A&1,A>>>1){case 0:S>>>=3,T-=3,A=T&7,S>>>=A,T-=A,n=rC;break;case 1:y=[],P=[],E=[[]],C=[[]],oC.inflate_trees_fixed(y,P,E,C),d.init(y[0],P[0],E[0],0,C[0],0),S>>>=3,T-=3,n=eg;break;case 2:S>>>=3,T-=3,n=kx;break;case 3:return S>>>=3,T-=3,n=Wc,g.msg="invalid block type",m=-3,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m)}break;case rC:for(;T<32;){if(b!==0)m=0;else return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);b--,S|=(g.read_byte(R++)&255)<<T,T+=8}if((~S>>>16&65535)!=(S&65535))return n=Wc,g.msg="invalid stored block lengths",m=-3,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);o=S&65535,S=T=0,n=o!==0?Vx:u!==0?tg:ru;break;case Vx:if(b===0||f===0&&(O==r.end&&r.read!==0&&(O=0,f=O<r.read?r.read-O-1:r.end-O),f===0&&(r.write=O,m=r.inflate_flush(g,m),O=r.write,f=O<r.read?r.read-O-1:r.end-O,O==r.end&&r.read!==0&&(O=0,f=O<r.read?r.read-O-1:r.end-O),f===0)))return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);if(m=0,A=o,A>b&&(A=b),A>f&&(A=f),r.win.set(g.read_buf(R,A),O),R+=A,b-=A,O+=A,f-=A,(o-=A)!==0)break;n=u!==0?tg:ru;break;case kx:for(;T<14;){if(b!==0)m=0;else return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);b--,S|=(g.read_byte(R++)&255)<<T,T+=8}if(i=A=S&16383,(A&31)>29||(A>>5&31)>29)return n=Wc,g.msg="too many length or distance symbols",m=-3,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);if(A=258+(A&31)+(A>>5&31),!s||s.length<A)s=[];else for(I=0;I<A;I++)s[I]=0;S>>>=14,T-=14,a=0,n=Hx;case Hx:for(;a<4+(i>>>10);){for(;T<3;){if(b!==0)m=0;else return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);b--,S|=(g.read_byte(R++)&255)<<T,T+=8}s[Ux[a++]]=S&7,S>>>=3,T-=3}for(;a<19;)s[Ux[a++]]=0;if(l[0]=7,A=h.inflate_trees_bits(s,l,c,p,g),A!=0)return m=A,m==-3&&(s=null,n=Wc),r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);a=0,n=zx;case zx:for(;A=i,!(a>=258+(A&31)+(A>>5&31));){let w,k;for(A=l[0];T<A;){if(b!==0)m=0;else return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);b--,S|=(g.read_byte(R++)&255)<<T,T+=8}if(A=p[(c[0]+(S&ki[A]))*3+1],k=p[(c[0]+(S&ki[A]))*3+2],k<16)S>>>=A,T-=A,s[a++]=k;else{for(I=k==18?7:k-14,w=k==18?11:3;T<A+I;){if(b!==0)m=0;else return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);b--,S|=(g.read_byte(R++)&255)<<T,T+=8}if(S>>>=A,T-=A,w+=S&ki[I],S>>>=I,T-=I,I=a,A=i,I+w>258+(A&31)+(A>>5&31)||k==16&&I<1)return s=null,n=Wc,g.msg="invalid bit length repeat",m=-3,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);k=k==16?s[I-1]:0;do s[I++]=k;while(--w!==0);a=I}}if(c[0]=-1,B=[],G=[],V=[],D=[],B[0]=9,G[0]=6,A=i,A=h.inflate_trees_dynamic(257+(A&31),1+(A>>5&31),s,B,G,V,D,p,g),A!=0)return A==-3&&(s=null,n=Wc),m=A,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);d.init(B[0],G[0],p,V[0],p,D[0]),n=eg;case eg:if(r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,(m=d.proc(r,g,m))!=1)return r.inflate_flush(g,m);if(m=0,d.free(g),R=g.next_in_index,b=g.avail_in,S=r.bitb,T=r.bitk,O=r.write,f=O<r.read?r.read-O-1:r.end-O,u===0){n=ru;break}n=tg;case tg:if(r.write=O,m=r.inflate_flush(g,m),O=r.write,f=O<r.read?r.read-O-1:r.end-O,r.read!=r.write)return r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);n=Wx;case Wx:return m=1,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);case Wc:return m=-3,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m);default:return m=-2,r.bitb=S,r.bitk=T,g.avail_in=b,g.total_in+=R-g.next_in_index,g.next_in_index=R,r.write=O,r.inflate_flush(g,m)}}},r.free=function(g){r.reset(g,null),r.win=null,p=null},r.set_dictionary=function(g,m,A){r.win.set(g.subarray(m,m+A),0),r.read=r.write=A},r.sync_point=function(){return n==rC?1:0}}function Lk(){let t=this;t.mode=0,t.method=0,t.was=[0],t.need=0,t.marker=0,t.wbits=0;function e(r){return!r||!r.istate?-2:(r.total_in=r.total_out=0,r.msg=null,r.istate.mode=a_,r.istate.blocks.reset(r,null),0)}t.inflateEnd=function(r){return t.blocks&&t.blocks.free(r),t.blocks=null,0},t.inflateInit=function(r,n){return r.msg=null,t.blocks=null,n<8||n>15?(t.inflateEnd(r),-2):(t.wbits=n,r.istate.blocks=new Pk(r,1<<n),e(r),0)},t.inflate=function(r,n){let o,i;if(!r||!r.istate||!r.next_in)return-2;let a=r.istate;for(n=n==Tk?-5:0,o=-5;;)switch(a.mode){case xk:if(r.avail_in===0)return o;if(o=n,r.avail_in--,r.total_in++,((a.method=r.read_byte(r.next_in_index++))&15)!=Dk){a.mode=Dl,r.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=Dl,r.msg="invalid win size",a.marker=5;break}a.mode=Kx;case Kx:if(r.avail_in===0)return o;if(o=n,r.avail_in--,r.total_in++,i=r.read_byte(r.next_in_index++)&255,((a.method<<8)+i)%31!==0){a.mode=Dl,r.msg="incorrect header check",a.marker=5;break}if((i&Fk)===0){a.mode=a_;break}a.mode=Yx;case Yx:if(r.avail_in===0)return o;o=n,r.avail_in--,r.total_in++,a.need=(r.read_byte(r.next_in_index++)&255)<<24&4278190080,a.mode=Qx;case Qx:if(r.avail_in===0)return o;o=n,r.avail_in--,r.total_in++,a.need+=(r.read_byte(r.next_in_index++)&255)<<16&16711680,a.mode=qx;case qx:if(r.avail_in===0)return o;o=n,r.avail_in--,r.total_in++,a.need+=(r.read_byte(r.next_in_index++)&255)<<8&65280,a.mode=Xx;case Xx:return r.avail_in===0?o:(o=n,r.avail_in--,r.total_in++,a.need+=r.read_byte(r.next_in_index++)&255,a.mode=nC,2);case nC:return a.mode=Dl,r.msg="need dictionary",a.marker=0,-2;case a_:if(o=a.blocks.proc(r,o),o==-3){a.mode=Dl,a.marker=0;break}if(o==0&&(o=n),o!=1)return o;o=n,a.blocks.reset(r,a.was),a.mode=jx;case jx:return r.avail_in=0,1;case Dl:return-3;default:return-2}},t.inflateSetDictionary=function(r,n,o){let i=0,a=o;if(!r||!r.istate||r.istate.mode!=nC)return-2;let s=r.istate;return a>=1<<s.wbits&&(a=(1<<s.wbits)-1,i=o-a),s.blocks.set_dictionary(n,i,a),s.mode=a_,0},t.inflateSync=function(r){let n,o,i,a,s;if(!r||!r.istate)return-2;let l=r.istate;if(l.mode!=Dl&&(l.mode=Dl,l.marker=0),(n=r.avail_in)===0)return-5;for(o=r.next_in_index,i=l.marker;n!==0&&i<4;)r.read_byte(o)==wk[i]?i++:r.read_byte(o)!==0?i=0:i=4-i,o++,n--;return r.total_in+=o-r.next_in_index,r.next_in_index=o,r.avail_in=n,l.marker=i,i!=4?-3:(a=r.total_in,s=r.total_out,e(r),r.total_in=a,r.total_out=s,l.mode=a_,0)},t.inflateSyncPoint=function(r){return!r||!r.istate||!r.istate.blocks?-2:r.istate.blocks.sync_point()}}function Jx(){}function Mk(t){let e=this,r=new Jx,n=t&&t.chunkSize?Math.floor(t.chunkSize*2):128*1024,o=Ak,i=new Uint8Array(n),a=!1;r.inflateInit(),r.next_out=i,e.append=function(s,l){let c=[],d,u,p=0,_=0,h=0;if(s.length!==0){r.next_in_index=0,r.next_in=s,r.avail_in=s.length;do{if(r.next_out_index=0,r.avail_out=n,r.avail_in===0&&!a&&(r.next_in_index=0,a=!0),d=r.inflate(o),a&&d===-5){if(r.avail_in!==0)throw new Error("inflating: bad input")}else if(d!==0&&d!==1)throw new Error("inflating: "+r.msg);if((a||d===1)&&r.avail_in===s.length)throw new Error("inflating: bad input");r.next_out_index&&(r.next_out_index===n?c.push(new Uint8Array(i)):c.push(i.slice(0,r.next_out_index))),h+=r.next_out_index,l&&r.next_in_index>0&&r.next_in_index!=p&&(l(r.next_in_index),p=r.next_in_index)}while(r.avail_in>0||r.avail_out===0);return c.length>1?(u=new Uint8Array(h),c.forEach(function(g){u.set(g,_),_+=g.length})):u=c[0]||new Uint8Array(0),u}},e.flush=function(){r.inflateEnd()}}var ki,Zx,Ak,Tk,Ek,Ik,Rk,yk,bk,vk,Ck,Ok,Fl,Jf,Dx,xx,wx,Lx,Mx,Bx,tC,Gx,$f,Ux,ru,rC,Vx,kx,Hx,zx,eg,tg,Wx,Wc,Fk,Dk,xk,Kx,Yx,Qx,qx,Xx,nC,a_,jx,Dl,wk,$x,ew=Jt(()=>{ki=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],Zx=1440,Ak=0,Tk=4,Ek=9,Ik=5,Rk=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],yk=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],bk=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],vk=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],Ck=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Ok=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Fl=15;oC.inflate_trees_fixed=function(t,e,r,n){return t[0]=Ek,e[0]=Ik,r[0]=Rk,n[0]=yk,0};Jf=0,Dx=1,xx=2,wx=3,Lx=4,Mx=5,Bx=6,tC=7,Gx=8,$f=9;Ux=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ru=0,rC=1,Vx=2,kx=3,Hx=4,zx=5,eg=6,tg=7,Wx=8,Wc=9;Fk=32,Dk=8,xk=0,Kx=1,Yx=2,Qx=3,qx=4,Xx=5,nC=6,a_=7,jx=12,Dl=13,wk=[0,0,255,255];Jx.prototype={inflateInit:function(t){let e=this;return e.istate=new Lk,t||(t=15),e.istate.inflateInit(e,t)},inflate:function(t){let e=this;return e.istate?e.istate.inflate(e,t):-2},inflateEnd:function(){let t=this;if(!t.istate)return-2;let e=t.istate.inflateEnd(t);return t.istate=null,e},inflateSync:function(){let t=this;return t.istate?t.istate.inflateSync(t):-2},inflateSetDictionary:function(t,e){let r=this;return r.istate?r.istate.inflateSetDictionary(r,t,e):-2},read_byte:function(t){return this.next_in[t]},read_buf:function(t,e){return this.next_in.subarray(t,t+e)}};$x=Mk});function rg(){return Si}function Kc(t){if(t.baseURL!==void 0&&(Si.baseURL=t.baseURL),t.chunkSize!==void 0&&(Si.chunkSize=t.chunkSize),t.maxWorkers!==void 0&&(Si.maxWorkers=t.maxWorkers),t.terminateWorkerTimeout!==void 0&&(Si.terminateWorkerTimeout=t.terminateWorkerTimeout),t.useWebWorkers!==void 0&&(Si.useWebWorkers=t.useWebWorkers),t.Deflate!==void 0&&(Si.Deflate=t.Deflate),t.Inflate!==void 0&&(Si.Inflate=t.Inflate),t.workerScripts!==void 0){if(t.workerScripts.deflate){if(!Array.isArray(t.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");Si.workerScripts||(Si.workerScripts={}),Si.workerScripts.deflate=t.workerScripts.deflate}if(t.workerScripts.inflate){if(!Array.isArray(t.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");Si.workerScripts||(Si.workerScripts={}),Si.workerScripts.inflate=t.workerScripts.inflate}}}var Bk,Si,s_=Jt(()=>{Bk={chunkSize:524288,maxWorkers:typeof navigator<"u"&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},Si=Object.assign({},Bk)});function iC(){return"application/octet-stream"}var aC=Jt(()=>{});function tw(t){return t&&Gk[t.split(".").pop().toLowerCase()]||iC()}var l_,Gk,rw=Jt(()=>{aC();l_={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},Gk=(()=>{let t={};for(let e in l_)if(l_.hasOwnProperty(e)){for(let r in l_[e])if(l_[e].hasOwnProperty(r)){let n=l_[e][r];if(typeof n=="string")t[n]=e+"/"+r;else for(let o=0;o<n.length;o++)t[n[o]]=e+"/"+r}}return t})()});var nw,sC,xl,ng=Jt(()=>{nw=[];for(let t=0;t<256;t++){let e=t;for(let r=0;r<8;r++)e&1?e=e>>>1^3988292384:e=e>>>1;nw[t]=e}sC=class{constructor(e){this.crc=e||-1}append(e){let r=this.crc|0;for(let n=0,o=e.length|0;n<o;n++)r=r>>>8^nw[(r^e[n])&255];this.crc=r}get(){return~this.crc}},xl=sC});function Uk(t){if(typeof TextEncoder>"u"){t=unescape(encodeURIComponent(t));let e=new Uint8Array(t.length);for(let r=0;r<e.length;r++)e[r]=t.charCodeAt(r);return e}else return new TextEncoder().encode(t)}var c_,lC=Jt(()=>{c_=Uk});var $o,d_,cC,dC,ow,uC,nu,iw=Jt(()=>{$o={concat(t,e){if(t.length===0||e.length===0)return t.concat(e);let r=t[t.length-1],n=$o.getPartial(r);return n===32?t.concat(e):$o._shiftRight(e,n,r|0,t.slice(0,t.length-1))},bitLength(t){let e=t.length;if(e===0)return 0;let r=t[e-1];return(e-1)*32+$o.getPartial(r)},clamp(t,e){if(t.length*32<e)return t;t=t.slice(0,Math.ceil(e/32));let r=t.length;return e=e&31,r>0&&e&&(t[r-1]=$o.partial(e,t[r-1]&2147483648>>e-1,1)),t},partial(t,e,r){return t===32?e:(r?e|0:e<<32-t)+t*1099511627776},getPartial(t){return Math.round(t/1099511627776)||32},_shiftRight(t,e,r,n){for(n===void 0&&(n=[]);e>=32;e-=32)n.push(r),r=0;if(e===0)return n.concat(t);for(let a=0;a<t.length;a++)n.push(r|t[a]>>>e),r=t[a]<<32-e;let o=t.length?t[t.length-1]:0,i=$o.getPartial(o);return n.push($o.partial(e+i&31,e+i>32?r:n.pop(),1)),n}},d_={bytes:{fromBits(t){let r=$o.bitLength(t)/8,n=new Uint8Array(r),o;for(let i=0;i<r;i++)(i&3)===0&&(o=t[i/4]),n[i]=o>>>24,o<<=8;return n},toBits(t){let e=[],r,n=0;for(r=0;r<t.length;r++)n=n<<8|t[r],(r&3)===3&&(e.push(n),n=0);return r&3&&e.push($o.partial(8*(r&3),n)),e}}},cC={};cC.sha1=function(t){t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()};cC.sha1.prototype={blockSize:512,reset:function(){let t=this;return t._h=this._init.slice(0),t._buffer=[],t._length=0,t},update:function(t){let e=this;typeof t=="string"&&(t=d_.utf8String.toBits(t));let r=e._buffer=$o.concat(e._buffer,t),n=e._length,o=e._length=n+$o.bitLength(t);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let i=new Uint32Array(r),a=0;for(let s=e.blockSize+n-(e.blockSize+n&e.blockSize-1);s<=o;s+=e.blockSize)e._block(i.subarray(16*a,16*(a+1))),a+=1;return r.splice(0,16*a),e},finalize:function(){let t=this,e=t._buffer,r=t._h;e=$o.concat(e,[$o.partial(1,1)]);for(let n=e.length+2;n&15;n++)e.push(0);for(e.push(Math.floor(t._length/4294967296)),e.push(t._length|0);e.length;)t._block(e.splice(0,16));return t.reset(),r},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(t,e,r,n){if(t<=19)return e&r|~e&n;if(t<=39)return e^r^n;if(t<=59)return e&r|e&n|r&n;if(t<=79)return e^r^n},_S:function(t,e){return e<<t|e>>>32-t},_block:function(t){let e=this,r=e._h,n=Array(80);for(let c=0;c<16;c++)n[c]=t[c];let o=r[0],i=r[1],a=r[2],s=r[3],l=r[4];for(let c=0;c<=79;c++){c>=16&&(n[c]=e._S(1,n[c-3]^n[c-8]^n[c-14]^n[c-16]));let d=e._S(5,o)+e._f(c,i,a,s)+l+n[c]+e._key[Math.floor(c/20)]|0;l=s,s=a,a=e._S(30,i),i=o,o=d}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+l|0}};dC={};dC.aes=class{constructor(t){let e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();let r=e._tables[0][4],n=e._tables[1],o=t.length,i,a,s,l=1;if(o!==4&&o!==6&&o!==8)throw new Error("invalid aes key size");for(e._key=[a=t.slice(0),s=[]],i=o;i<4*o+28;i++){let c=a[i-1];(i%o===0||o===8&&i%o===4)&&(c=r[c>>>24]<<24^r[c>>16&255]<<16^r[c>>8&255]<<8^r[c&255],i%o===0&&(c=c<<8^c>>>24^l<<24,l=l<<1^(l>>7)*283)),a[i]=a[i-o]^c}for(let c=0;i;c++,i--){let d=a[c&3?i:i-4];i<=4||c<4?s[c]=d:s[c]=n[0][r[d>>>24]]^n[1][r[d>>16&255]]^n[2][r[d>>8&255]]^n[3][r[d&255]]}}encrypt(t){return this._crypt(t,0)}decrypt(t){return this._crypt(t,1)}_precompute(){let t=this._tables[0],e=this._tables[1],r=t[4],n=e[4],o=[],i=[],a,s,l,c;for(let d=0;d<256;d++)i[(o[d]=d<<1^(d>>7)*283)^d]=d;for(let d=a=0;!r[d];d^=s||1,a=i[a]||1){let u=a^a<<1^a<<2^a<<3^a<<4;u=u>>8^u&255^99,r[d]=u,n[u]=d,c=o[l=o[s=o[d]]];let p=c*16843009^l*65537^s*257^d*16843008,_=o[u]*257^u*16843008;for(let h=0;h<4;h++)t[h][d]=_=_<<24^_>>>8,e[h][u]=p=p<<24^p>>>8}for(let d=0;d<5;d++)t[d]=t[d].slice(0),e[d]=e[d].slice(0)}_crypt(t,e){if(t.length!==4)throw new Error("invalid aes block size");let r=this._key[e],n=r.length/4-2,o=[0,0,0,0],i=this._tables[e],a=i[0],s=i[1],l=i[2],c=i[3],d=i[4],u=t[0]^r[0],p=t[e?3:1]^r[1],_=t[2]^r[2],h=t[e?1:3]^r[3],g=4,m,A,S;for(let T=0;T<n;T++)m=a[u>>>24]^s[p>>16&255]^l[_>>8&255]^c[h&255]^r[g],A=a[p>>>24]^s[_>>16&255]^l[h>>8&255]^c[u&255]^r[g+1],S=a[_>>>24]^s[h>>16&255]^l[u>>8&255]^c[p&255]^r[g+2],h=a[h>>>24]^s[u>>16&255]^l[p>>8&255]^c[_&255]^r[g+3],g+=4,u=m,p=A,_=S;for(let T=0;T<4;T++)o[e?3&-T:T]=d[u>>>24]<<24^d[p>>16&255]<<16^d[_>>8&255]<<8^d[h&255]^r[g++],m=u,u=p,p=_,_=h,h=m;return o}};ow={getRandomValues(t){let e=new Uint32Array(t.buffer),r=n=>{let o=987654321,i=4294967295;return function(){return o=36969*(o&65535)+(o>>16)&i,n=18e3*(n&65535)+(n>>16)&i,(((o<<16)+n&i)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,o;n<t.length;n+=4){let i=r((o||Math.random())*4294967296);o=i()*987654071,e[n/4]=i()*4294967296|0}return t}},uC={};uC.ctrGladman=class{constructor(t,e){this._prf=t,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(t){return this.calculate(this._prf,t,this._iv)}incWord(t){if((t>>24&255)===255){let e=t>>16&255,r=t>>8&255,n=t&255;e===255?(e=0,r===255?(r=0,n===255?n=0:++n):++r):++e,t=0,t+=e<<16,t+=r<<8,t+=n}else t+=1<<24;return t}incCounter(t){(t[0]=this.incWord(t[0]))===0&&(t[1]=this.incWord(t[1]))}calculate(t,e,r){let n;if(!(n=e.length))return[];let o=$o.bitLength(e);for(let i=0;i<n;i+=4){this.incCounter(r);let a=t.encrypt(r);e[i]^=a[0],e[i+1]^=a[1],e[i+2]^=a[2],e[i+3]^=a[3]}return $o.clamp(e,o)}};nu={importKey(t){return new nu.hmacSha1(d_.bytes.toBits(t))},pbkdf2(t,e,r,n){if(r=r||1e4,n<0||r<0)throw new Error("invalid params to pbkdf2");let o=(n>>5)+1<<2,i,a,s,l,c,d=new ArrayBuffer(o),u=new DataView(d),p=0,_=$o;for(e=d_.bytes.toBits(e),c=1;p<(o||1);c++){for(i=a=t.encrypt(_.concat(e,[c])),s=1;s<r;s++)for(a=t.encrypt(a),l=0;l<a.length;l++)i[l]^=a[l];for(s=0;p<(o||1)&&s<i.length;s++)u.setInt32(p,i[s]),p+=4}return d.slice(0,n/8)}};nu.hmacSha1=class{constructor(t){let e=this,r=e._hash=cC.sha1,n=[[],[]],o=r.prototype.blockSize/32;e._baseHash=[new r,new r],t.length>o&&(t=r.hash(t));for(let i=0;i<o;i++)n[0][i]=t[i]^909522486,n[1][i]=t[i]^1549556828;e._baseHash[0].update(n[0]),e._baseHash[1].update(n[1]),e._resultHash=new r(e._baseHash[0])}reset(){let t=this;t._resultHash=new t._hash(t._baseHash[0]),t._updated=!1}update(t){let e=this;e._updated=!0,e._resultHash.update(t)}digest(){let t=this,e=t._resultHash.finalize(),r=new t._hash(t._baseHash[1]).update(e).finalize();return t.reset(),r}encrypt(t){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}});function _w(t,e,r,n,o,i){let a=e.length-o;t.pendingInput.length&&(e=pC(t.pendingInput,e),r=jk(r,a-a%ou));let s;for(s=0;s<=a-ou;s+=ou){let l=_s.toBits(Hi(e,s,s+ou));i&&t.hmac.update(l);let c=t.aesCtrGladman.update(l);i||t.hmac.update(c),r.set(_s.fromBits(c),s+n)}return t.pendingInput=Hi(e,s),r}async function Kk(t,e,r){await hw(t,r,Hi(e,0,p_[t.strength]));let n=Hi(e,p_[t.strength]),o=t.keys.passwordVerification;if(o[0]!=n[0]||o[1]!=n[1])throw new Error(Ll)}async function Yk(t,e){let r=Qk(new Uint8Array(p_[t.strength]));return await hw(t,e,r),pC(r,t.keys.passwordVerification)}async function hw(t,e,r){let n=c_(e),o=await qk(Vk,n,zk,!1,Wk),i=await Xk(Object.assign({salt:r},sw),o,8*(u_[t.strength]*2+2)),a=new Uint8Array(i);t.keys={key:_s.toBits(Hi(a,0,u_[t.strength])),authentication:_s.toBits(Hi(a,u_[t.strength],u_[t.strength]*2)),passwordVerification:Hi(a,u_[t.strength]*2)}}function Qk(t){return ag&&typeof crypto.getRandomValues=="function"?crypto.getRandomValues(t):ow.getRandomValues(t)}function qk(t,e,r,n,o){return ag&&cw&&typeof crypto.subtle.importKey=="function"?crypto.subtle.importKey(t,e,r,n,o):nu.importKey(e)}async function Xk(t,e,r){return ag&&cw&&typeof crypto.subtle.deriveBits=="function"?await crypto.subtle.deriveBits(t,e,r):nu.pbkdf2(e,t.salt,sw.iterations,r)}function pC(t,e){let r=t;return t.length+e.length&&(r=new Uint8Array(t.length+e.length),r.set(t,0),r.set(e,t.length)),r}function jk(t,e){if(e&&e>t.length){let r=t;t=new Uint8Array(e),t.set(r,0)}return t}function Hi(t,e,r){return t.subarray(e,r)}var Ll,ou,Vk,aw,kk,Hk,zk,sw,Wk,p_,u_,wl,lw,ag,cw,_s,dw,uw,pw,og,ig,_C=Jt(()=>{lC();iw();Ll="Invalid pasword",ou=16,Vk="raw",aw={name:"PBKDF2"},kk={name:"HMAC"},Hk="SHA-1",zk=Object.assign({hash:kk},aw),sw=Object.assign({iterations:1e3,hash:{name:Hk}},aw),Wk=["deriveBits"],p_=[8,12,16],u_=[16,24,32],wl=10,lw=[0,0,0,0],ag=typeof crypto<"u",cw=ag&&typeof crypto.subtle<"u",_s=d_.bytes,dw=dC.aes,uw=uC.ctrGladman,pw=nu.hmacSha1,og=class{constructor(e,r,n){Object.assign(this,{password:e,signed:r,strength:n-1,pendingInput:new Uint8Array(0)})}async append(e){let r=this;if(r.password){let o=Hi(e,0,p_[r.strength]+2);await Kk(r,o,r.password),r.password=null,r.aesCtrGladman=new uw(new dw(r.keys.key),Array.from(lw)),r.hmac=new pw(r.keys.authentication),e=Hi(e,p_[r.strength]+2)}let n=new Uint8Array(e.length-wl-(e.length-wl)%ou);return _w(r,e,n,0,wl,!0)}flush(){let e=this,r=e.pendingInput,n=Hi(r,0,r.length-wl),o=Hi(r,r.length-wl),i=new Uint8Array(0);if(n.length){let s=_s.toBits(n);e.hmac.update(s);let l=e.aesCtrGladman.update(s);i=_s.fromBits(l)}let a=!0;if(e.signed){let s=Hi(_s.fromBits(e.hmac.digest()),0,wl);for(let l=0;l<wl;l++)s[l]!=o[l]&&(a=!1)}return{valid:a,data:i}}},ig=class{constructor(e,r){Object.assign(this,{password:e,strength:r-1,pendingInput:new Uint8Array(0)})}async append(e){let r=this,n=new Uint8Array(0);r.password&&(n=await Yk(r,r.password),r.password=null,r.aesCtrGladman=new uw(new dw(r.keys.key),Array.from(lw)),r.hmac=new pw(r.keys.authentication));let o=new Uint8Array(n.length+e.length-e.length%ou);return o.set(n,0),_w(r,e,o,n.length,0)}flush(){let e=this,r=new Uint8Array(0);if(e.pendingInput.length){let o=e.aesCtrGladman.update(_s.toBits(e.pendingInput));e.hmac.update(o),r=_s.fromBits(o)}let n=Hi(_s.fromBits(e.hmac.digest()),0,wl);return{data:pC(r,n),signature:n}}}});function mw(t,e){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=Aw(t)^e[n],hC(t,r[n]);return r}function fw(t,e){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=Aw(t)^e[n],hC(t,e[n]);return r}function Sw(t,e){t.keys=[305419896,591751049,878082192],t.crcKey0=new xl(t.keys[0]),t.crcKey2=new xl(t.keys[2]);for(let r=0;r<e.length;r++)hC(t,e.charCodeAt(r))}function hC(t,e){t.crcKey0.append([e]),t.keys[0]=~t.crcKey0.get(),t.keys[1]=gw(t.keys[1]+Tw(t.keys[0])),t.keys[1]=gw(Math.imul(t.keys[1],134775813)+1),t.crcKey2.append([t.keys[1]>>>24]),t.keys[2]=~t.crcKey2.get()}function Aw(t){let e=t.keys[2]|2;return Tw(Math.imul(e,e^1)>>>8)}function Tw(t){return t&255}function gw(t){return t&4294967295}var iu,sg,lg,Ew=Jt(()=>{ng();_C();iu=12,sg=class{constructor(e,r){let n=this;Object.assign(n,{password:e,passwordVerification:r}),Sw(n,e)}append(e){let r=this;if(r.password){let n=mw(r,e.subarray(0,iu));if(r.password=null,n[iu-1]!=r.passwordVerification)throw new Error(Ll);e=e.subarray(iu)}return mw(r,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}},lg=class{constructor(e,r){let n=this;Object.assign(n,{password:e,passwordVerification:r}),Sw(n,e)}append(e){let r=this,n,o;if(r.password){r.password=null;let i=crypto.getRandomValues(new Uint8Array(iu));i[iu-1]=r.passwordVerification,n=new Uint8Array(e.length+i.length),n.set(fw(r,i),0),o=iu}else n=new Uint8Array(e.length),o=0;return n.set(fw(r,e),o),n}flush(){return{data:new Uint8Array(0)}}}});function Iw(t,e,r){if(e.codecType.startsWith(cg))return new fC(t,e,r);if(e.codecType.startsWith(dg))return new mC(t,e,r)}var cg,dg,au,mC,fC,gC=Jt(()=>{ng();_C();Ew();cg="deflate",dg="inflate",au="Invalid signature",mC=class{constructor(e,{signature:r,password:n,signed:o,compressed:i,zipCrypto:a,passwordVerification:s,encryptionStrength:l},{chunkSize:c}){let d=!!n;Object.assign(this,{signature:r,encrypted:d,signed:o,compressed:i,inflate:i&&new e({chunkSize:c}),crc32:o&&new xl,zipCrypto:a,decrypt:d&&a?new sg(n,s):new og(n,o,l)})}async append(e){let r=this;return r.encrypted&&e.length&&(e=await r.decrypt.append(e)),r.compressed&&e.length&&(e=await r.inflate.append(e)),(!r.encrypted||r.zipCrypto)&&r.signed&&e.length&&r.crc32.append(e),e}async flush(){let e=this,r,n=new Uint8Array(0);if(e.encrypted){let o=e.decrypt.flush();if(!o.valid)throw new Error(au);n=o.data}if((!e.encrypted||e.zipCrypto)&&e.signed){let o=new DataView(new Uint8Array(4).buffer);if(r=e.crc32.get(),o.setUint32(0,r),e.signature!=o.getUint32(0,!1))throw new Error(au)}return e.compressed&&(n=await e.inflate.append(n)||new Uint8Array(0),await e.inflate.flush()),{data:n,signature:r}}},fC=class{constructor(e,{encrypted:r,signed:n,compressed:o,level:i,zipCrypto:a,password:s,passwordVerification:l,encryptionStrength:c},{chunkSize:d}){Object.assign(this,{encrypted:r,signed:n,compressed:o,deflate:o&&new e({level:i||5,chunkSize:d}),crc32:n&&new xl,zipCrypto:a,encrypt:r&&a?new lg(s,l):new ig(s,c)})}async append(e){let r=this,n=e;return r.compressed&&e.length&&(n=await r.deflate.append(e)),r.encrypted&&n.length&&(n=await r.encrypt.append(n)),(!r.encrypted||r.zipCrypto)&&r.signed&&e.length&&r.crc32.append(e),n}async flush(){let e=this,r,n=new Uint8Array(0);if(e.compressed&&(n=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){n=await e.encrypt.append(n);let o=e.encrypt.flush();r=o.signature;let i=new Uint8Array(n.length+o.data.length);i.set(n,0),i.set(o.data,n.length),n=i}return(!e.encrypted||e.zipCrypto)&&e.signed&&(r=e.crc32.get()),{data:n,signature:r}}}});function Jk(t,e){let r=Iw(t.codecConstructor,t.options,e);return{async append(n){try{return await r.append(n)}catch(o){throw t.onTaskFinished(),o}},async flush(){try{return await r.flush()}finally{t.onTaskFinished()}},abort(){t.onTaskFinished()}}}function $k(t,e){let r,n={type:"module"};if(!t.interface){if(!bw)t.worker=o(n,e.baseURL);else try{t.worker=o({},e.baseURL)}catch{bw=!1,t.worker=o(n,e.baseURL)}t.worker.addEventListener(Zk,s,!1),t.interface={append(l){return i({type:yw,data:l})},flush(){return i({type:SC})},abort(){t.onTaskFinished()}}}return t.interface;function o(l,c){let d,u;d=t.scripts[0],typeof d=="function"&&(d=d());try{u=new URL(d,c)}catch{u=d}return new Worker(u,l)}async function i(l){if(!r){let c=t.options,d=t.scripts.slice(1);await a({scripts:d,type:Rw,options:c,config:{chunkSize:e.chunkSize}})}return a(l)}function a(l){let c=t.worker,d=new Promise((u,p)=>r={resolve:u,reject:p});try{if(l.data)try{l.data=l.data.buffer,c.postMessage(l,[l.data])}catch{c.postMessage(l)}else c.postMessage(l)}catch(u){r.reject(u),r=null,t.onTaskFinished()}return d}function s(l){let c=l.data;if(r){let d=c.error,u=c.type;if(d){let p=new Error(d.message);p.stack=d.stack,r.reject(p),r=null,t.onTaskFinished()}else if(u==Rw||u==SC||u==yw){let p=c.data;u==SC?(r.resolve({data:new Uint8Array(p),signature:c.signature}),r=null,t.onTaskFinished()):r.resolve(p&&new Uint8Array(p))}}}}var Rw,yw,SC,Zk,bw,ug,vw=Jt(()=>{gC();Rw="init",yw="append",SC="flush",Zk="message",bw=!0,ug=(t,e,r,n,o,i,a)=>(Object.assign(t,{busy:!0,codecConstructor:e,options:Object.assign({},r),scripts:a,terminate(){t.worker&&!t.busy&&(t.worker.terminate(),t.interface=null)},onTaskFinished(){t.busy=!1,o(t)}}),i?$k(t,n):Jk(t,n))});function pg(t,e,r){let o=!(!e.compressed&&!e.signed&&!e.encrypted)&&(e.useWebWorkers||e.useWebWorkers===void 0&&r.useWebWorkers),i=o&&r.workerScripts?r.workerScripts[e.codecType]:[];if(Ml.length<r.maxWorkers){let s={};return Ml.push(s),ug(s,t,e,r,a,o,i)}else{let s=Ml.find(l=>!l.busy);return s?(TC(s),ug(s,t,e,r,a,o,i)):new Promise(l=>AC.push({resolve:l,codecConstructor:t,options:e,webWorker:o,scripts:i}))}function a(s){if(AC.length){let[{resolve:l,codecConstructor:c,options:d,webWorker:u,scripts:p}]=AC.splice(0,1);l(ug(s,c,d,r,a,u,p))}else s.worker?(TC(s),Number.isFinite(r.terminateWorkerTimeout)&&r.terminateWorkerTimeout>=0&&(s.terminateTimeout=setTimeout(()=>{Ml=Ml.filter(l=>l!=s),s.terminate()},r.terminateWorkerTimeout))):Ml=Ml.filter(l=>l!=s)}}function TC(t){t.terminateTimeout&&(clearTimeout(t.terminateTimeout),t.terminateTimeout=null)}function EC(){Ml.forEach(t=>{TC(t),t.terminate()})}var Ml,AC,__=Jt(()=>{gC();vw();Ml=[],AC=[]});var Cw,Ow=Jt(()=>{Cw=t=>{if(typeof URL.createObjectURL=="function"){let e=()=>URL.createObjectURL(new Blob([`const{Array:t,Object:e,Math:n,Error:r,Uint8Array:i,Uint16Array:o,Uint32Array:s,Int32Array:f,DataView:c,TextEncoder:l,crypto:u,postMessage:a}=globalThis,w=[];for(let t=0;256>t;t++){let e=t;for(let t=0;8>t;t++)1&e?e=e>>>1^3988292384:e>>>=1;w[t]=e}class h{constructor(t){this.t=t||-1}append(t){let e=0|this.t;for(let n=0,r=0|t.length;r>n;n++)e=e>>>8^w[255&(e^t[n])];this.t=e}get(){return~this.t}}const d={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],r=d.i(n);return 32===r?t.concat(e):d.o(e,r,0|n,t.slice(0,t.length-1))},l(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+d.i(n)},u(t,e){if(32*t.length<e)return t;const r=(t=t.slice(0,n.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=d.h(e,t[r-1]&2147483648>>e-1,1)),t},h:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,i:t=>n.round(t/1099511627776)||32,o(t,e,n,r){for(void 0===r&&(r=[]);e>=32;e-=32)r.push(n),n=0;if(0===e)return r.concat(t);for(let i=0;i<t.length;i++)r.push(n|t[i]>>>e),n=t[i]<<32-e;const i=t.length?t[t.length-1]:0,o=d.i(i);return r.push(d.h(e+o&31,e+o>32?n:r.pop(),1)),r}},p={p:{k(t){const e=d.l(t)/8,n=new i(e);let r;for(let i=0;e>i;i++)0==(3&i)&&(r=t[i/4]),n[i]=r>>>24,r<<=8;return n},g(t){const e=[];let n,r=0;for(n=0;n<t.length;n++)r=r<<8|t[n],3==(3&n)&&(e.push(r),r=0);return 3&n&&e.push(d.h(8*(3&n),r)),e}}},y={v:function(t){t?(this.m=t.m.slice(0),this.S=t.S.slice(0),this._=t._):this.reset()}};y.v.prototype={blockSize:512,reset:function(){const t=this;return t.m=this.I.slice(0),t.S=[],t._=0,t},update:function(t){const e=this;"string"==typeof t&&(t=p.A.g(t));const n=e.S=d.concat(e.S,t),i=e._,o=e._=i+d.l(t);if(o>9007199254740991)throw new r("Cannot hash more than 2^53 - 1 bits");const f=new s(n);let c=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);o>=t;t+=e.blockSize)e.C(f.subarray(16*c,16*(c+1))),c+=1;return n.splice(0,16*c),e},V:function(){const t=this;let e=t.S;const r=t.m;e=d.concat(e,[d.h(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(n.floor(t._/4294967296)),e.push(0|t._);e.length;)t.C(e.splice(0,16));return t.reset(),r},I:[1732584193,4023233417,2562383102,271733878,3285377520],B:[1518500249,1859775393,2400959708,3395469782],D:(t,e,n,r)=>t>19?t>39?t>59?t>79?void 0:e^n^r:e&n|e&r|n&r:e^n^r:e&n|~e&r,U:(t,e)=>e<<t|e>>>32-t,C:function(e){const r=this,i=r.m,o=t(80);for(let t=0;16>t;t++)o[t]=e[t];let s=i[0],f=i[1],c=i[2],l=i[3],u=i[4];for(let t=0;79>=t;t++){16>t||(o[t]=r.U(1,o[t-3]^o[t-8]^o[t-14]^o[t-16]));const e=r.U(5,s)+r.D(t,f,c,l)+u+o[t]+r.B[n.floor(t/20)]|0;u=l,l=c,c=r.U(30,f),f=s,s=e}i[0]=i[0]+s|0,i[1]=i[1]+f|0,i[2]=i[2]+c|0,i[3]=i[3]+l|0,i[4]=i[4]+u|0}};const b={getRandomValues(t){const e=new s(t.buffer),r=t=>{let e=987654321;const r=4294967295;return()=>(e=36969*(65535&e)+(e>>16)&r,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r)/4294967296+.5)*(n.random()>.5?1:-1))};for(let i,o=0;o<t.length;o+=4){const t=r(4294967296*(i||n.random()));i=987654071*t(),e[o/4]=4294967296*t()|0}return t}},k={importKey:t=>new k.M(p.p.g(t)),P(t,e,n,i){if(n=n||1e4,0>i||0>n)throw new r("invalid params to pbkdf2");const o=1+(i>>5)<<2;let s,f,l,u,a;const w=new ArrayBuffer(o),h=new c(w);let y=0;const b=d;for(e=p.p.g(e),a=1;(o||1)>y;a++){for(s=f=t.encrypt(b.concat(e,[a])),l=1;n>l;l++)for(f=t.encrypt(f),u=0;u<f.length;u++)s[u]^=f[u];for(l=0;(o||1)>y&&l<s.length;l++)h.setInt32(y,s[l]),y+=4}return w.slice(0,i/8)},M:class{constructor(t){const e=this,n=e.R=y.v,r=[[],[]],i=n.prototype.blockSize/32;e.H=[new n,new n],t.length>i&&(t=n.hash(t));for(let e=0;i>e;e++)r[0][e]=909522486^t[e],r[1][e]=1549556828^t[e];e.H[0].update(r[0]),e.H[1].update(r[1]),e.K=new n(e.H[0])}reset(){const t=this;t.K=new t.R(t.H[0]),t.L=!1}update(t){this.L=!0,this.K.update(t)}digest(){const t=this,e=t.K.V(),n=new t.R(t.H[1]).update(e).V();return t.reset(),n}encrypt(t){if(this.L)throw new r("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},g={name:"PBKDF2"},v=e.assign({hash:{name:"HMAC"}},g),m=e.assign({iterations:1e3,hash:{name:"SHA-1"}},g),S=["deriveBits"],z=[8,12,16],_=[16,24,32],I=[0,0,0,0],A=void 0!==u,C=A&&void 0!==u.subtle,V=p.p,B=class{constructor(t){const e=this;e.T=[[[],[],[],[],[]],[[],[],[],[],[]]],e.T[0][0][0]||e.j();const n=e.T[0][4],i=e.T[1],o=t.length;let s,f,c,l=1;if(4!==o&&6!==o&&8!==o)throw new r("invalid aes key size");for(e.B=[f=t.slice(0),c=[]],s=o;4*o+28>s;s++){let t=f[s-1];(s%o==0||8===o&&s%o==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],s%o==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),f[s]=f[s-o]^t}for(let t=0;s;t++,s--){const e=f[3&t?s:s-4];c[t]=4>=s||4>t?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this.F(t,0)}decrypt(t){return this.F(t,1)}j(){const t=this.T[0],e=this.T[1],n=t[4],r=e[4],i=[],o=[];let s,f,c,l;for(let t=0;256>t;t++)o[(i[t]=t<<1^283*(t>>7))^t]=t;for(let u=s=0;!n[u];u^=f||1,s=o[s]||1){let o=s^s<<1^s<<2^s<<3^s<<4;o=o>>8^255&o^99,n[u]=o,r[o]=u,l=i[c=i[f=i[u]]];let a=16843009*l^65537*c^257*f^16843008*u,w=257*i[o]^16843008*o;for(let n=0;4>n;n++)t[n][u]=w=w<<24^w>>>8,e[n][o]=a=a<<24^a>>>8}for(let n=0;5>n;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}F(t,e){if(4!==t.length)throw new r("invalid aes block size");const n=this.B[e],i=n.length/4-2,o=[0,0,0,0],s=this.T[e],f=s[0],c=s[1],l=s[2],u=s[3],a=s[4];let w,h,d,p=t[0]^n[0],y=t[e?3:1]^n[1],b=t[2]^n[2],k=t[e?1:3]^n[3],g=4;for(let t=0;i>t;t++)w=f[p>>>24]^c[y>>16&255]^l[b>>8&255]^u[255&k]^n[g],h=f[y>>>24]^c[b>>16&255]^l[k>>8&255]^u[255&p]^n[g+1],d=f[b>>>24]^c[k>>16&255]^l[p>>8&255]^u[255&y]^n[g+2],k=f[k>>>24]^c[p>>16&255]^l[y>>8&255]^u[255&b]^n[g+3],g+=4,p=w,y=h,b=d;for(let t=0;4>t;t++)o[e?3&-t:t]=a[p>>>24]<<24^a[y>>16&255]<<16^a[b>>8&255]<<8^a[255&k]^n[g++],w=p,p=y,y=b,b=k,k=w;return o}},E=class{constructor(t,e){this.O=t,this.W=e,this.q=e}reset(){this.q=this.W}update(t){return this.G(this.O,t,this.q)}J(t){if(255==(t>>24&255)){let e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}N(t){0===(t[0]=this.J(t[0]))&&(t[1]=this.J(t[1]))}G(t,e,n){let r;if(!(r=e.length))return[];const i=d.l(e);for(let i=0;r>i;i+=4){this.N(n);const r=t.encrypt(n);e[i]^=r[0],e[i+1]^=r[1],e[i+2]^=r[2],e[i+3]^=r[3]}return d.u(e,i)}},D=k.M;class U{constructor(t,n,r){e.assign(this,{password:t,signed:n,X:r-1,Y:new i(0)})}async append(e){const n=this;if(n.password){const i=K(e,0,z[n.X]+2);await(async(t,e,n)=>{await R(t,n,K(e,0,z[t.X]));const i=K(e,z[t.X]),o=t.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new r("Invalid pasword")})(n,i,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt),e=K(e,z[n.X]+2)}return P(n,e,new i(e.length-10-(e.length-10)%16),0,10,!0)}flush(){const t=this,e=t.Y,n=K(e,0,e.length-10),r=K(e,e.length-10);let o=new i(0);if(n.length){const e=V.g(n);t.$.update(e);const r=t.Z.update(e);o=V.k(r)}let s=!0;if(t.signed){const e=K(V.k(t.$.digest()),0,10);for(let t=0;10>t;t++)e[t]!=r[t]&&(s=!1)}return{valid:s,data:o}}}class M{constructor(t,n){e.assign(this,{password:t,X:n-1,Y:new i(0)})}async append(e){const n=this;let r=new i(0);n.password&&(r=await(async(t,e)=>{const n=(r=new i(z[t.X]),A&&"function"==typeof u.getRandomValues?u.getRandomValues(r):b.getRandomValues(r));var r;return await R(t,e,n),H(n,t.keys.passwordVerification)})(n,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt));const o=new i(r.length+e.length-e.length%16);return o.set(r,0),P(n,e,o,r.length,0)}flush(){const t=this;let e=new i(0);if(t.Y.length){const n=t.Z.update(V.g(t.Y));t.$.update(n),e=V.k(n)}const n=K(V.k(t.$.digest()),0,10);return{data:H(e,n),signature:n}}}function P(t,e,n,r,o,s){const f=e.length-o;let c;for(t.Y.length&&(e=H(t.Y,e),n=((t,e)=>{if(e&&e>t.length){const n=t;(t=new i(e)).set(n,0)}return t})(n,f-f%16)),c=0;f-16>=c;c+=16){const i=V.g(K(e,c,c+16));s&&t.$.update(i);const o=t.Z.update(i);s||t.$.update(o),n.set(V.k(o),c+r)}return t.Y=K(e,c),n}async function R(t,n,r){const o=(t=>{if(void 0===l){const e=new i((t=unescape(encodeURIComponent(t))).length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new l).encode(t)})(n),s=await((t,e,n,r,i)=>A&&C&&"function"==typeof u.subtle.importKey?u.subtle.importKey("raw",e,n,!1,i):k.importKey(e))(0,o,v,0,S),f=await(async(t,e,n)=>A&&C&&"function"==typeof u.subtle.deriveBits?await u.subtle.deriveBits(t,e,n):k.P(e,t.salt,m.iterations,n))(e.assign({salt:r},m),s,8*(2*_[t.X]+2)),c=new i(f);t.keys={key:V.g(K(c,0,_[t.X])),tt:V.g(K(c,_[t.X],2*_[t.X])),passwordVerification:K(c,2*_[t.X])}}function H(t,e){let n=t;return t.length+e.length&&(n=new i(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function K(t,e,n){return t.subarray(e,n)}class L{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;if(e.password){const n=j(e,t.subarray(0,12));if(e.password=null,n[11]!=e.passwordVerification)throw new r("Invalid pasword");t=t.subarray(12)}return j(e,t)}flush(){return{valid:!0,data:new i(0)}}}class T{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;let n,r;if(e.password){e.password=null;const o=u.getRandomValues(new i(12));o[11]=e.passwordVerification,n=new i(t.length+o.length),n.set(x(e,o),0),r=12}else n=new i(t.length),r=0;return n.set(x(e,t),r),n}flush(){return{data:new i(0)}}}function j(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,n[r]);return n}function x(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,e[r]);return n}function F(t,e){t.keys=[305419896,591751049,878082192],t.et=new h(t.keys[0]),t.nt=new h(t.keys[2]);for(let n=0;n<e.length;n++)O(t,e.charCodeAt(n))}function O(t,e){t.et.append([e]),t.keys[0]=~t.et.get(),t.keys[1]=G(t.keys[1]+q(t.keys[0])),t.keys[1]=G(n.imul(t.keys[1],134775813)+1),t.nt.append([t.keys[1]>>>24]),t.keys[2]=~t.nt.get()}function W(t){const e=2|t.keys[2];return q(n.imul(e,1^e)>>>8)}function q(t){return 255&t}function G(t){return 4294967295&t}class J{constructor(t,{signature:n,password:r,signed:i,compressed:o,zipCrypto:s,passwordVerification:f,encryptionStrength:c},{rt:l}){const u=!!r;e.assign(this,{signature:n,encrypted:u,signed:i,compressed:o,it:o&&new t({rt:l}),ot:i&&new h,zipCrypto:s,decrypt:u&&s?new L(r,f):new U(r,i,c)})}async append(t){const e=this;return e.encrypted&&t.length&&(t=await e.decrypt.append(t)),e.compressed&&t.length&&(t=await e.it.append(t)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),t}async flush(){const t=this;let e,n=new i(0);if(t.encrypted){const e=t.decrypt.flush();if(!e.valid)throw new r("Invalid signature");n=e.data}if((!t.encrypted||t.zipCrypto)&&t.signed){const n=new c(new i(4).buffer);if(e=t.ot.get(),n.setUint32(0,e),t.signature!=n.getUint32(0,!1))throw new r("Invalid signature")}return t.compressed&&(n=await t.it.append(n)||new i(0),await t.it.flush()),{data:n,signature:e}}}class N{constructor(t,{encrypted:n,signed:r,compressed:i,level:o,zipCrypto:s,password:f,passwordVerification:c,encryptionStrength:l},{rt:u}){e.assign(this,{encrypted:n,signed:r,compressed:i,st:i&&new t({level:o||5,rt:u}),ot:r&&new h,zipCrypto:s,encrypt:n&&s?new T(f,c):new M(f,l)})}async append(t){const e=this;let n=t;return e.compressed&&t.length&&(n=await e.st.append(t)),e.encrypted&&n.length&&(n=await e.encrypt.append(n)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),n}async flush(){const t=this;let e,n=new i(0);if(t.compressed&&(n=await t.st.flush()||new i(0)),t.encrypted){n=await t.encrypt.append(n);const r=t.encrypt.flush();e=r.signature;const o=new i(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return t.encrypted&&!t.zipCrypto||!t.signed||(e=t.ot.get()),{data:n,signature:e}}}const Q={init(t){t.scripts&&t.scripts.length&&importScripts.apply(void 0,t.scripts);const e=t.options;let n;self.initCodec&&self.initCodec(),e.codecType.startsWith("deflate")?n=self.Deflate:e.codecType.startsWith("inflate")&&(n=self.Inflate),X=((t,e,n)=>e.codecType.startsWith("deflate")?new N(t,e,n):e.codecType.startsWith("inflate")?new J(t,e,n):void 0)(n,e,t.config)},append:async t=>({data:await X.append(t.data)}),flush:()=>X.flush()};let X;function Y(e){return Z(e.map((([e,n])=>new t(e).fill(n,0,e))))}function Z(e){return e.reduce(((e,n)=>e.concat(t.isArray(n)?Z(n):n)),[])}addEventListener("message",(async t=>{const e=t.data,n=e.type,r=Q[n];if(r)try{e.data&&(e.data=new i(e.data));const t=await r(e)||{};if(t.type=n,t.data)try{t.data=t.data.buffer,a(t,[t.data])}catch(e){a(t)}else a(t)}catch(t){a({type:n,error:{message:t.message,stack:t.stack}})}}));const $=[0,1,2,3].concat(...Y([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function tt(){const t=this;function e(t,e){let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}t.ft=r=>{const i=t.ct,o=t.ut.lt,s=t.ut.wt;let f,c,l,u=-1;for(r.ht=0,r.dt=573,f=0;s>f;f++)0!==i[2*f]?(r.yt[++r.ht]=u=f,r.bt[f]=0):i[2*f+1]=0;for(;2>r.ht;)l=r.yt[++r.ht]=2>u?++u:0,i[2*l]=1,r.bt[l]=0,r.kt--,o&&(r.gt-=o[2*l+1]);for(t.vt=u,f=n.floor(r.ht/2);f>=1;f--)r.St(i,f);l=s;do{f=r.yt[1],r.yt[1]=r.yt[r.ht--],r.St(i,1),c=r.yt[1],r.yt[--r.dt]=f,r.yt[--r.dt]=c,i[2*l]=i[2*f]+i[2*c],r.bt[l]=n.max(r.bt[f],r.bt[c])+1,i[2*f+1]=i[2*c+1]=l,r.yt[1]=l++,r.St(i,1)}while(r.ht>=2);r.yt[--r.dt]=r.yt[1],(e=>{const n=t.ct,r=t.ut.lt,i=t.ut.zt,o=t.ut._t,s=t.ut.It;let f,c,l,u,a,w,h=0;for(u=0;15>=u;u++)e.At[u]=0;for(n[2*e.yt[e.dt]+1]=0,f=e.dt+1;573>f;f++)c=e.yt[f],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,h++),n[2*c+1]=u,c>t.vt||(e.At[u]++,a=0,o>c||(a=i[c-o]),w=n[2*c],e.kt+=w*(u+a),r&&(e.gt+=w*(r[2*c+1]+a)));if(0!==h){do{for(u=s-1;0===e.At[u];)u--;e.At[u]--,e.At[u+1]+=2,e.At[s]--,h-=2}while(h>0);for(u=s;0!==u;u--)for(c=e.At[u];0!==c;)l=e.yt[--f],l>t.vt||(n[2*l+1]!=u&&(e.kt+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}})(r),((t,n,r)=>{const i=[];let o,s,f,c=0;for(o=1;15>=o;o++)i[o]=c=c+r[o-1]<<1;for(s=0;n>=s;s++)f=t[2*s+1],0!==f&&(t[2*s]=e(i[f]++,f))})(i,t.vt,r.At)}}function et(t,e,n,r,i){const o=this;o.lt=t,o.zt=e,o._t=n,o.wt=r,o.It=i}tt.Ct=[0,1,2,3,4,5,6,7].concat(...Y([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),tt.Vt=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],tt.Bt=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],tt.Et=t=>256>t?$[t]:$[256+(t>>>7)],tt.Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt.Ut=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt.Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt.Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const nt=Y([[144,8],[112,9],[24,7],[8,8]]);et.Rt=Z([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((t,e)=>[t,nt[e]])));const rt=Y([[30,5]]);function it(t,e,n,r,i){const o=this;o.Ht=t,o.Kt=e,o.Lt=n,o.Tt=r,o.jt=i}et.xt=Z([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((t,e)=>[t,rt[e]]))),et.Ft=new et(et.Rt,tt.Dt,257,286,15),et.Ot=new et(et.xt,tt.Ut,0,30,15),et.Wt=new et(null,tt.Mt,0,19,7);const ot=[new it(0,0,0,0,0),new it(4,4,8,4,1),new it(4,5,16,8,1),new it(4,6,32,32,1),new it(4,4,16,16,2),new it(8,16,32,32,2),new it(8,16,128,128,2),new it(8,32,128,256,2),new it(32,128,258,1024,2),new it(32,258,258,4096,2)],st=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function ft(t,e,n,r){const i=t[2*e],o=t[2*n];return o>i||i==o&&r[e]<=r[n]}function ct(){const t=this;let e,r,s,f,c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z,_,I,A,C,V,B,E,D,U,M,P,R,H;const K=new tt,L=new tt,T=new tt;let j,x,F,O,W,q;function G(){let e;for(e=0;286>e;e++)P[2*e]=0;for(e=0;30>e;e++)R[2*e]=0;for(e=0;19>e;e++)H[2*e]=0;P[512]=1,t.kt=t.gt=0,x=F=0}function J(t,e){let n,r=-1,i=t[1],o=0,s=7,f=4;0===i&&(s=138,f=3),t[2*(e+1)+1]=65535;for(let c=0;e>=c;c++)n=i,i=t[2*(c+1)+1],++o<s&&n==i||(f>o?H[2*n]+=o:0!==n?(n!=r&&H[2*n]++,H[32]++):o>10?H[36]++:H[34]++,o=0,r=n,0===i?(s=138,f=3):n==i?(s=6,f=3):(s=7,f=4))}function N(e){t.qt[t.pending++]=e}function Q(t){N(255&t),N(t>>>8&255)}function X(t,e){let n;const r=e;q>16-r?(n=t,W|=n<<q&65535,Q(W),W=n>>>16-q,q+=r-16):(W|=t<<q&65535,q+=r)}function Y(t,e){const n=2*t;X(65535&e[n],65535&e[n+1])}function Z(t,e){let n,r,i=-1,o=t[1],s=0,f=7,c=4;for(0===o&&(f=138,c=3),n=0;e>=n;n++)if(r=o,o=t[2*(n+1)+1],++s>=f||r!=o){if(c>s)do{Y(r,H)}while(0!=--s);else 0!==r?(r!=i&&(Y(r,H),s--),Y(16,H),X(s-3,2)):s>10?(Y(18,H),X(s-11,7)):(Y(17,H),X(s-3,3));s=0,i=r,0===o?(f=138,c=3):r==o?(f=6,c=3):(f=7,c=4)}}function $(){16==q?(Q(W),W=0,q=0):8>q||(N(255&W),W>>>=8,q-=8)}function nt(e,r){let i,o,s;if(t.Gt[x]=e,t.Jt[x]=255&r,x++,0===e?P[2*r]++:(F++,e--,P[2*(tt.Ct[r]+256+1)]++,R[2*tt.Et(e)]++),0==(8191&x)&&E>2){for(i=8*x,o=_-v,s=0;30>s;s++)i+=R[2*s]*(5+tt.Ut[s]);if(i>>>=3,F<n.floor(x/2)&&i<n.floor(o/2))return!0}return x==j-1}function rt(e,n){let r,i,o,s,f=0;if(0!==x)do{r=t.Gt[f],i=t.Jt[f],f++,0===r?Y(i,e):(o=tt.Ct[i],Y(o+256+1,e),s=tt.Dt[o],0!==s&&(i-=tt.Vt[o],X(i,s)),r--,o=tt.Et(r),Y(o,n),s=tt.Ut[o],0!==s&&(r-=tt.Bt[o],X(r,s)))}while(x>f);Y(256,e),O=e[513]}function it(){q>8?Q(W):q>0&&N(255&W),W=0,q=0}function ct(e,n,r){X(0+(r?1:0),3),((e,n)=>{it(),O=8,Q(n),Q(~n),t.qt.set(a.subarray(e,e+n),t.pending),t.pending+=n})(e,n)}function lt(n){((e,n,r)=>{let i,o,s=0;E>0?(K.ft(t),L.ft(t),s=(()=>{let e;for(J(P,K.vt),J(R,L.vt),T.ft(t),e=18;e>=3&&0===H[2*tt.Pt[e]+1];e--);return t.kt+=14+3*(e+1),e})(),i=t.kt+3+7>>>3,o=t.gt+3+7>>>3,o>i||(i=o)):i=o=n+5,n+4>i||-1==e?o==i?(X(2+(r?1:0),3),rt(et.Rt,et.xt)):(X(4+(r?1:0),3),((t,e,n)=>{let r;for(X(t-257,5),X(e-1,5),X(n-4,4),r=0;n>r;r++)X(H[2*tt.Pt[r]+1],3);Z(P,t-1),Z(R,e-1)})(K.vt+1,L.vt+1,s+1),rt(P,R)):ct(e,n,r),G(),r&&it()})(0>v?-1:v,_-v,n),v=_,e.Nt()}function ut(){let t,n,r,i;do{if(i=w-A-_,0===i&&0===_&&0===A)i=c;else if(-1==i)i--;else if(_>=c+c-262){a.set(a.subarray(c,c+c),0),I-=c,_-=c,v-=c,t=y,r=t;do{n=65535&d[--r],d[r]=c>n?0:n-c}while(0!=--t);t=c,r=t;do{n=65535&h[--r],h[r]=c>n?0:n-c}while(0!=--t);i+=c}if(0===e.Qt)return;t=e.Xt(a,_+A,i),A+=t,3>A||(p=255&a[_],p=(p<<g^255&a[_+1])&k)}while(262>A&&0!==e.Qt)}function at(t){let e,n,r=V,i=_,o=C;const s=_>c-262?_-(c-262):0;let f=M;const l=u,w=_+258;let d=a[i+o-1],p=a[i+o];U>C||(r>>=2),f>A&&(f=A);do{if(e=t,a[e+o]==p&&a[e+o-1]==d&&a[e]==a[i]&&a[++e]==a[i+1]){i+=2,e++;do{}while(a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&w>i);if(n=258-(w-i),i=w-258,n>o){if(I=t,o=n,n>=f)break;d=a[i+o-1],p=a[i+o]}}}while((t=65535&h[t&l])>s&&0!=--r);return o>A?A:o}t.bt=[],t.At=[],t.yt=[],P=[],R=[],H=[],t.St=(e,n)=>{const r=t.yt,i=r[n];let o=n<<1;for(;o<=t.ht&&(o<t.ht&&ft(e,r[o+1],r[o],t.bt)&&o++,!ft(e,i,r[o],t.bt));)r[n]=r[o],n=o,o<<=1;r[n]=i},t.Yt=(e,S,I,x,F,J)=>(x||(x=8),F||(F=8),J||(J=0),e.Zt=null,-1==S&&(S=6),1>F||F>9||8!=x||9>I||I>15||0>S||S>9||0>J||J>2?-2:(e.$t=t,l=I,c=1<<l,u=c-1,b=F+7,y=1<<b,k=y-1,g=n.floor((b+3-1)/3),a=new i(2*c),h=[],d=[],j=1<<F+6,t.qt=new i(4*j),s=4*j,t.Gt=new o(j),t.Jt=new i(j),E=S,D=J,(e=>(e.te=e.ee=0,e.Zt=null,t.pending=0,t.ne=0,r=113,f=0,K.ct=P,K.ut=et.Ft,L.ct=R,L.ut=et.Ot,T.ct=H,T.ut=et.Wt,W=0,q=0,O=8,G(),(()=>{w=2*c,d[y-1]=0;for(let t=0;y-1>t;t++)d[t]=0;B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt,_=0,v=0,A=0,m=C=2,z=0,p=0})(),0))(e))),t.re=()=>42!=r&&113!=r&&666!=r?-2:(t.Jt=null,t.Gt=null,t.qt=null,d=null,h=null,a=null,t.$t=null,113==r?-3:0),t.ie=(t,e,n)=>{let r=0;return-1==e&&(e=6),0>e||e>9||0>n||n>2?-2:(ot[E].jt!=ot[e].jt&&0!==t.te&&(r=t.st(1)),E!=e&&(E=e,B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt),D=n,r)},t.oe=(t,e,n)=>{let i,o=n,s=0;if(!e||42!=r)return-2;if(3>o)return 0;for(o>c-262&&(o=c-262,s=n-o),a.set(e.subarray(s,s+o),0),_=o,v=o,p=255&a[0],p=(p<<g^255&a[1])&k,i=0;o-3>=i;i++)p=(p<<g^255&a[i+2])&k,h[i&u]=d[p],d[p]=i;return 0},t.st=(n,i)=>{let o,w,b,V,U;if(i>4||0>i)return-2;if(!n.se||!n.fe&&0!==n.Qt||666==r&&4!=i)return n.Zt=st[4],-2;if(0===n.ce)return n.Zt=st[7],-5;var M;if(e=n,V=f,f=i,42==r&&(w=8+(l-8<<4)<<8,b=(E-1&255)>>1,b>3&&(b=3),w|=b<<6,0!==_&&(w|=32),w+=31-w%31,r=113,N((M=w)>>8&255),N(255&M)),0!==t.pending){if(e.Nt(),0===e.ce)return f=-1,0}else if(0===e.Qt&&V>=i&&4!=i)return e.Zt=st[7],-5;if(666==r&&0!==e.Qt)return n.Zt=st[7],-5;if(0!==e.Qt||0!==A||0!=i&&666!=r){switch(U=-1,ot[E].jt){case 0:U=(t=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=A){if(ut(),0===A&&0==t)return 0;if(0===A)break}if(_+=A,A=0,n=v+r,(0===_||_>=n)&&(A=_-n,_=n,lt(!1),0===e.ce))return 0;if(_-v>=c-262&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 1:U=(t=>{let n,r=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_),0===r||(_-r&65535)>c-262||2!=D&&(m=at(r)),3>m)n=nt(0,255&a[_]),A--,_++;else if(n=nt(_-I,m-3),A-=m,m>B||3>A)_+=m,m=0,p=255&a[_],p=(p<<g^255&a[_+1])&k;else{m--;do{_++,p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_}while(0!=--m);_++}if(n&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 2:U=(t=>{let n,r,i=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_),C=m,S=I,m=2,0!==i&&B>C&&c-262>=(_-i&65535)&&(2!=D&&(m=at(i)),5>=m&&(1==D||3==m&&_-I>4096)&&(m=2)),3>C||m>C)if(0!==z){if(n=nt(0,255&a[_-1]),n&&lt(!1),_++,A--,0===e.ce)return 0}else z=1,_++,A--;else{r=_+A-3,n=nt(_-1-S,C-3),A-=C-1,C-=2;do{++_>r||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_)}while(0!=--C);if(z=0,m=2,_++,n&&(lt(!1),0===e.ce))return 0}}return 0!==z&&(n=nt(0,255&a[_-1]),z=0),lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i)}if(2!=U&&3!=U||(r=666),0==U||2==U)return 0===e.ce&&(f=-1),0;if(1==U){if(1==i)X(2,3),Y(256,et.Rt),$(),9>1+O+10-q&&(X(2,3),Y(256,et.Rt),$()),O=7;else if(ct(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(e.Nt(),0===e.ce)return f=-1,0}}return 4!=i?0:1}}function lt(){const t=this;t.le=0,t.ue=0,t.Qt=0,t.te=0,t.ce=0,t.ee=0}function ut(t){const e=new lt,o=(s=t&&t.rt?t.rt:65536)+5*(n.floor(s/16383)+1);var s;const f=new i(o);let c=t?t.level:-1;void 0===c&&(c=-1),e.Yt(c),e.se=f,this.append=(t,n)=>{let s,c,l=0,u=0,a=0;const w=[];if(t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,s=e.st(0),0!=s)throw new r("deflating: "+e.Zt);e.ue&&(e.ue==o?w.push(new i(f)):w.push(f.slice(0,e.ue))),a+=e.ue,n&&e.le>0&&e.le!=l&&(n(e.le),l=e.le)}while(e.Qt>0||0===e.ce);return w.length>1?(c=new i(a),w.forEach((t=>{c.set(t,u),u+=t.length}))):c=w[0]||new i(0),c}},this.flush=()=>{let t,n,s=0,c=0;const l=[];do{if(e.ue=0,e.ce=o,t=e.st(4),1!=t&&0!=t)throw new r("deflating: "+e.Zt);o-e.ce>0&&l.push(f.slice(0,e.ue)),c+=e.ue}while(e.Qt>0||0===e.ce);return e.re(),n=new i(c),l.forEach((t=>{n.set(t,s),s+=t.length})),n}}lt.prototype={Yt:function(t,e){const n=this;return n.$t=new ct,e||(e=15),n.$t.Yt(n,t,e)},st:function(t){const e=this;return e.$t?e.$t.st(e,t):-2},re:function(){const t=this;if(!t.$t)return-2;const e=t.$t.re();return t.$t=null,e},ie:function(t,e){const n=this;return n.$t?n.$t.ie(n,t,e):-2},oe:function(t,e){const n=this;return n.$t?n.$t.oe(n,t,e):-2},Xt:function(t,e,n){const r=this;let i=r.Qt;return i>n&&(i=n),0===i?0:(r.Qt-=i,t.set(r.fe.subarray(r.le,r.le+i),e),r.le+=i,r.te+=i,i)},Nt:function(){const t=this;let e=t.$t.pending;e>t.ce&&(e=t.ce),0!==e&&(t.se.set(t.$t.qt.subarray(t.$t.ne,t.$t.ne+e),t.ue),t.ue+=e,t.$t.ne+=e,t.ee+=e,t.ce-=e,t.$t.pending-=e,0===t.$t.pending&&(t.$t.ne=0))}};const at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wt=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ht=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],dt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],yt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],bt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function kt(){let t,e,n,r,i,o;function s(t,e,s,f,c,l,u,a,w,h,d){let p,y,b,k,g,v,m,S,z,_,I,A,C,V,B;_=0,g=s;do{n[t[e+_]]++,_++,g--}while(0!==g);if(n[0]==s)return u[0]=-1,a[0]=0,0;for(S=a[0],v=1;15>=v&&0===n[v];v++);for(m=v,v>S&&(S=v),g=15;0!==g&&0===n[g];g--);for(b=g,S>g&&(S=g),a[0]=S,V=1<<v;g>v;v++,V<<=1)if(0>(V-=n[v]))return-3;if(0>(V-=n[g]))return-3;for(n[g]+=V,o[1]=v=0,_=1,C=2;0!=--g;)o[C]=v+=n[_],C++,_++;g=0,_=0;do{0!==(v=t[e+_])&&(d[o[v]++]=g),_++}while(++g<s);for(s=o[b],o[0]=g=0,_=0,k=-1,A=-S,i[0]=0,I=0,B=0;b>=m;m++)for(p=n[m];0!=p--;){for(;m>A+S;){if(k++,A+=S,B=b-A,B=B>S?S:B,(y=1<<(v=m-A))>p+1&&(y-=p+1,C=m,B>v))for(;++v<B&&(y<<=1)>n[++C];)y-=n[C];if(B=1<<v,h[0]+B>1440)return-3;i[k]=I=h[0],h[0]+=B,0!==k?(o[k]=g,r[0]=v,r[1]=S,v=g>>>A-S,r[2]=I-i[k-1]-v,w.set(r,3*(i[k-1]+v))):u[0]=I}for(r[1]=m-A,s>_?d[_]<f?(r[0]=256>d[_]?0:96,r[2]=d[_++]):(r[0]=l[d[_]-f]+16+64,r[2]=c[d[_++]-f]):r[0]=192,y=1<<m-A,v=g>>>A;B>v;v+=y)w.set(r,3*(I+v));for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,z=(1<<A)-1;(g&z)!=o[k];)k--,A-=S,z=(1<<A)-1}return 0!==V&&1!=b?-5:0}function c(s){let c;for(t||(t=[],e=[],n=new f(16),r=[],i=new f(15),o=new f(16)),e.length<s&&(e=[]),c=0;s>c;c++)e[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;i.set(n.subarray(0,15),0),o.set(n.subarray(0,16),0)}this.ae=(n,r,i,o,f)=>{let l;return c(19),t[0]=0,l=s(n,0,19,19,null,null,i,r,o,t,e),-3==l?f.Zt="oversubscribed dynamic bit lengths tree":-5!=l&&0!==r[0]||(f.Zt="incomplete dynamic bit lengths tree",l=-3),l},this.we=(n,r,i,o,f,l,u,a,w)=>{let h;return c(288),t[0]=0,h=s(i,0,n,257,dt,pt,l,o,a,t,e),0!=h||0===o[0]?(-3==h?w.Zt="oversubscribed literal/length tree":-4!=h&&(w.Zt="incomplete literal/length tree",h=-3),h):(c(288),h=s(i,n,r,0,yt,bt,u,f,a,t,e),0!=h||0===f[0]&&n>257?(-3==h?w.Zt="oversubscribed distance tree":-5==h?(w.Zt="incomplete distance tree",h=-3):-4!=h&&(w.Zt="empty distance tree with lengths",h=-3),h):0)}}function gt(){const t=this;let e,n,r,i,o=0,s=0,f=0,c=0,l=0,u=0,a=0,w=0,h=0,d=0;function p(t,e,n,r,i,o,s,f){let c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z;d=f.le,p=f.Qt,w=s.he,h=s.de,y=s.write,b=y<s.read?s.read-y-1:s.end-y,k=at[t],g=at[e];do{for(;20>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(c=w&k,l=n,u=r,z=3*(u+c),0!==(a=l[z]))for(;;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15,v=l[z+2]+(w&at[a]),w>>=a,h-=a;15>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;for(c=w&g,l=i,u=o,z=3*(u+c),a=l[z];;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15;a>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(m=l[z+2]+(w&at[a]),w>>=a,h-=a,b-=v,m>y){S=y-m;do{S+=s.end}while(0>S);if(a=s.end-S,v>a){if(v-=a,y-S>0&&a>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--a);else s.ye.set(s.ye.subarray(S,S+a),y),y+=a,S+=a,a=0;S=0}}else S=y-m,y-S>0&&2>y-S?(s.ye[y++]=s.ye[S++],s.ye[y++]=s.ye[S++],v-=2):(s.ye.set(s.ye.subarray(S,S+2),y),y+=2,S+=2,v-=2);if(y-S>0&&v>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--v);else s.ye.set(s.ye.subarray(S,S+v),y),y+=v,S+=v,v=0;break}if(0!=(64&a))return f.Zt="invalid distance code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3;c+=l[z+2],c+=w&at[a],z=3*(u+c),a=l[z]}break}if(0!=(64&a))return 0!=(32&a)?(v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,1):(f.Zt="invalid literal/length code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3);if(c+=l[z+2],c+=w&at[a],z=3*(u+c),0===(a=l[z])){w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--;break}}else w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--}while(b>=258&&p>=10);return v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,0}t.init=(t,o,s,f,c,l)=>{e=0,a=t,w=o,r=s,h=f,i=c,d=l,n=null},t.be=(t,y,b)=>{let k,g,v,m,S,z,_,I=0,A=0,C=0;for(C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S;;)switch(e){case 0:if(z>=258&&m>=10&&(t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,b=p(a,w,r,h,i,d,t,y),C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S,0!=b)){e=1==b?7:9;break}f=a,n=r,s=h,e=1;case 1:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>>=n[g+1],A-=n[g+1],v=n[g],0===v){c=n[g+2],e=6;break}if(0!=(16&v)){l=15&v,o=n[g+2],e=2;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}if(0!=(32&v)){e=7;break}return e=9,y.Zt="invalid literal/length code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 2:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}o+=I&at[k],I>>=k,A-=k,f=w,n=i,s=d,e=3;case 3:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>=n[g+1],A-=n[g+1],v=n[g],0!=(16&v)){l=15&v,u=n[g+2],e=4;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}return e=9,y.Zt="invalid distance code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 4:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}u+=I&at[k],I>>=k,A-=k,e=5;case 5:for(_=S-u;0>_;)_+=t.end;for(;0!==o;){if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);t.ye[S++]=t.ye[_++],z--,_==t.end&&(_=0),o--}e=0;break;case 6:if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,t.ye[S++]=c,z--,e=0;break;case 7:if(A>7&&(A-=8,m++,C--),t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);e=8;case 8:return b=1,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 9:return b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);default:return b=-2,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b)}},t.ge=()=>{}}kt.ve=(t,e,n,r)=>(t[0]=9,e[0]=5,n[0]=wt,r[0]=ht,0);const vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function mt(t,e){const n=this;let r,o=0,s=0,c=0,l=0;const u=[0],a=[0],w=new gt;let h=0,d=new f(4320);const p=new kt;n.de=0,n.he=0,n.ye=new i(e),n.end=e,n.read=0,n.write=0,n.reset=(t,e)=>{e&&(e[0]=0),6==o&&w.ge(t),o=0,n.de=0,n.he=0,n.read=n.write=0},n.reset(t,null),n.ke=(t,e)=>{let r,i,o;return i=t.ue,o=n.read,r=(o>n.write?n.end:n.write)-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r,o==n.end&&(o=0,n.write==n.end&&(n.write=0),r=n.write-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r),t.ue=i,n.read=o,e},n.be=(t,e)=>{let i,f,y,b,k,g,v,m;for(b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g;;){let S,z,_,I,A,C,V,B;switch(o){case 0:for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,o=1;break;case 1:S=[],z=[],_=[[]],I=[[]],kt.ve(S,z,_,I),w.init(S[0],z[0],_[0],0,I[0],0),f>>>=3,y-=3,o=6;break;case 2:f>>>=3,y-=3,o=3;break;case 3:return f>>>=3,y-=3,o=9,t.Zt="invalid block type",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}break;case 1:for(;32>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return o=9,t.Zt="invalid stored block lengths",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);s=65535&f,f=y=0,o=0!==s?2:0!==h?7:0;break;case 2:if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(0===v&&(g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v&&(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v)))return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(e=0,i=s,i>k&&(i=k),i>v&&(i=v),n.ye.set(t.Xt(b,i),g),b+=i,k-=i,g+=i,v-=i,0!=(s-=i))break;o=0!==h?7:0;break;case 3:for(;14>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return o=9,t.Zt="too many length or distance symbols",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(m=0;i>m;m++)r[m]=0;f>>>=14,y-=14,l=0,o=4;case 4:for(;4+(c>>>10)>l;){for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}r[vt[l++]]=7&f,f>>>=3,y-=3}for(;19>l;)r[vt[l++]]=0;if(u[0]=7,i=p.ae(r,u,a,d,t),0!=i)return-3==(e=i)&&(r=null,o=9),n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);l=0,o=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>l;){let s,w;for(i=u[0];i>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(i=d[3*(a[0]+(f&at[i]))+1],w=d[3*(a[0]+(f&at[i]))+2],16>w)f>>>=i,y-=i,r[l++]=w;else{for(m=18==w?7:w-14,s=18==w?11:3;i+m>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(f>>>=i,y-=i,s+=f&at[m],f>>>=m,y-=m,m=l,i=c,m+s>258+(31&i)+(i>>5&31)||16==w&&1>m)return r=null,o=9,t.Zt="invalid bit length repeat",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w=16==w?r[m-1]:0;do{r[m++]=w}while(0!=--s);l=m}}if(a[0]=-1,A=[],C=[],V=[],B=[],A[0]=9,C[0]=6,i=c,i=p.we(257+(31&i),1+(i>>5&31),r,A,C,V,B,d,t),0!=i)return-3==i&&(r=null,o=9),e=i,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w.init(A[0],C[0],d,V[0],d,B[0]),o=6;case 6:if(n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,1!=(e=w.be(n,t,e)))return n.ke(t,e);if(e=0,w.ge(t),b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g,0===h){o=0;break}o=7;case 7:if(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);o=8;case 8:return e=1,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);case 9:return e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);default:return e=-2,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}}},n.ge=t=>{n.reset(t,null),n.ye=null,d=null},n.me=(t,e,r)=>{n.ye.set(t.subarray(e,e+r),0),n.read=n.write=r},n.Se=()=>1==o?1:0}const St=[0,0,255,255];function zt(){const t=this;function e(t){return t&&t.ze?(t.te=t.ee=0,t.Zt=null,t.ze.mode=7,t.ze._e.reset(t,null),0):-2}t.mode=0,t.method=0,t.Ie=[0],t.Ae=0,t.marker=0,t.Ce=0,t.Ve=e=>(t._e&&t._e.ge(e),t._e=null,0),t.Be=(n,r)=>(n.Zt=null,t._e=null,8>r||r>15?(t.Ve(n),-2):(t.Ce=r,n.ze._e=new mt(n,1<<r),e(n),0)),t.it=(t,e)=>{let n,r;if(!t||!t.ze||!t.fe)return-2;const i=t.ze;for(e=4==e?-5:0,n=-5;;)switch(i.mode){case 0:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,8!=(15&(i.method=t.pe(t.le++)))){i.mode=13,t.Zt="unknown compression method",i.marker=5;break}if(8+(i.method>>4)>i.Ce){i.mode=13,t.Zt="invalid win size",i.marker=5;break}i.mode=1;case 1:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,r=255&t.pe(t.le++),((i.method<<8)+r)%31!=0){i.mode=13,t.Zt="incorrect header check",i.marker=5;break}if(0==(32&r)){i.mode=7;break}i.mode=2;case 2:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae=(255&t.pe(t.le++))<<24&4278190080,i.mode=3;case 3:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<16&16711680,i.mode=4;case 4:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<8&65280,i.mode=5;case 5:return 0===t.Qt?n:(n=e,t.Qt--,t.te++,i.Ae+=255&t.pe(t.le++),i.mode=6,2);case 6:return i.mode=13,t.Zt="need dictionary",i.marker=0,-2;case 7:if(n=i._e.be(t,n),-3==n){i.mode=13,i.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,i._e.reset(t,i.Ie),i.mode=12;case 12:return t.Qt=0,1;case 13:return-3;default:return-2}},t.Ee=(t,e,n)=>{let r=0,i=n;if(!t||!t.ze||6!=t.ze.mode)return-2;const o=t.ze;return i<1<<o.Ce||(i=(1<<o.Ce)-1,r=n-i),o._e.me(e,r,i),o.mode=7,0},t.De=t=>{let n,r,i,o,s;if(!t||!t.ze)return-2;const f=t.ze;if(13!=f.mode&&(f.mode=13,f.marker=0),0===(n=t.Qt))return-5;for(r=t.le,i=f.marker;0!==n&&4>i;)t.pe(r)==St[i]?i++:i=0!==t.pe(r)?0:4-i,r++,n--;return t.te+=r-t.le,t.le=r,t.Qt=n,f.marker=i,4!=i?-3:(o=t.te,s=t.ee,e(t),t.te=o,t.ee=s,f.mode=7,0)},t.Ue=t=>t&&t.ze&&t.ze._e?t.ze._e.Se():-2}function _t(){}function It(t){const e=new _t,o=t&&t.rt?n.floor(2*t.rt):131072,s=new i(o);let f=!1;e.Be(),e.se=s,this.append=(t,n)=>{const c=[];let l,u,a=0,w=0,h=0;if(0!==t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,0!==e.Qt||f||(e.le=0,f=!0),l=e.it(0),f&&-5===l){if(0!==e.Qt)throw new r("inflating: bad input")}else if(0!==l&&1!==l)throw new r("inflating: "+e.Zt);if((f||1===l)&&e.Qt===t.length)throw new r("inflating: bad input");e.ue&&(e.ue===o?c.push(new i(s)):c.push(s.slice(0,e.ue))),h+=e.ue,n&&e.le>0&&e.le!=a&&(n(e.le),a=e.le)}while(e.Qt>0||0===e.ce);return c.length>1?(u=new i(h),c.forEach((t=>{u.set(t,w),w+=t.length}))):u=c[0]||new i(0),u}},this.flush=()=>{e.Ve()}}_t.prototype={Be:function(t){const e=this;return e.ze=new zt,t||(t=15),e.ze.Be(e,t)},it:function(t){const e=this;return e.ze?e.ze.it(e,t):-2},Ve:function(){const t=this;if(!t.ze)return-2;const e=t.ze.Ve(t);return t.ze=null,e},De:function(){const t=this;return t.ze?t.ze.De(t):-2},Ee:function(t,e){const n=this;return n.ze?n.ze.Ee(n,t,e):-2},pe:function(t){return this.fe[t]},Xt:function(t,e){return this.fe.subarray(t,t+e)}},self.initCodec=()=>{self.Deflate=ut,self.Inflate=It};
`],{type:"text/javascript"}));t({workerScripts:{inflate:[e],deflate:[e]}})}}});function Nw(t,e,r){return class{constructor(o){let i=this,a=s=>{if(i.pendingData){let l=i.pendingData;i.pendingData=new Uint8Array(l.length+s.length),i.pendingData.set(l,0),i.pendingData.set(s,l.length)}else i.pendingData=new Uint8Array(s)};i.codec=new t(Object.assign({},e,o)),r(i.codec,a)}append(o){return this.codec.push(o),n(this)}flush(){return this.codec.push(new Uint8Array(0),!0),n(this)}};function n(o){if(o.pendingData){let i=o.pendingData;return o.pendingData=null,i}else return new Uint8Array(0)}}var IC,Pw=Jt(()=>{IC=(t,e={},r)=>({Deflate:Nw(t.Deflate,e.deflate,r),Inflate:Nw(t.Inflate,e.inflate,r)})});function Fw(t){t.pendingBlob=new Blob([],{type:t.contentType}),t.arrayBuffers=[]}function Dw(t){t.pendingBlob=new Blob([t.pendingBlob,...t.arrayBuffers],{type:t.contentType}),t.arrayBuffers=[]}async function Gw(t,e,r){if(iH(t.url)&&(t.useRangeHeader||t.forceRangeRequests)){let n=await e(NC,t,Vw(t));if(!t.forceRangeRequests&&n.headers.get(rH)!=Bw)throw new Error(gg);{let o,i=n.headers.get(tH);if(i){let a=i.trim().split(/\s*\/\s*/);if(a.length){let s=a[1];s&&s!="*"&&(o=Number(s))}}o===void 0?await Lw(t,e,r):t.size=o}}else await Lw(t,e,r)}async function Uw(t,e,r,n,o){if(t.useRangeHeader||t.forceRangeRequests){let i=await n(NC,t,Vw(t,e,r));if(i.status!=206)throw new Error(gg);return new Uint8Array(await i.arrayBuffer())}else return t.data||await o(t,t.options),new Uint8Array(t.data.subarray(e,e+r))}function Vw(t,e=0,r=1){return Object.assign({},PC(t),{[nH]:Bw+"="+e+"-"+(e+r-1)})}function PC(t){let e=t.options.headers;if(e)return Symbol.iterator in e?Object.fromEntries(e):e}async function xw(t){await kw(t,vC)}async function ww(t){await kw(t,CC)}async function kw(t,e){let r=await e(NC,t,PC(t));t.data=new Uint8Array(await r.arrayBuffer()),t.size||(t.size=t.data.length)}async function Lw(t,e,r){if(t.preventHeadRequest)await r(t,t.options);else{let o=(await e(oH,t,PC(t))).headers.get(eH);o?t.size=Number(o):await r(t,t.options)}}async function vC(t,{options:e,url:r},n){let o=await fetch(r,Object.assign({},e,{method:t,headers:n}));if(o.status<400)return o;throw new Error(Mw+(o.statusText||o.status))}function CC(t,{url:e},r){return new Promise((n,o)=>{let i=new XMLHttpRequest;if(i.addEventListener("load",()=>{if(i.status<400){let a=[];i.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(s=>{let l=s.trim().split(/\s*:\s*/);l[0]=l[0].trim().replace(/^[a-z]|-[a-z]/g,c=>c.toUpperCase()),a.push(l)}),n({status:i.status,arrayBuffer:()=>i.response,headers:new Map(a)})}else o(new Error(Mw+(i.statusText||i.status)))},!1),i.addEventListener("error",a=>o(a.detail.error),!1),i.open(t,e),r)for(let a of Object.entries(r))i.setRequestHeader(a[0],a[1]);i.responseType="arraybuffer",i.send()})}function iH(t){if(typeof document<"u"){let e=document.createElement("a");return e.href=t,e.protocol=="http:"||e.protocol=="https:"}else return/^https?:\/\//i.test(t)}var Mw,gg,OC,RC,eH,tH,rH,nH,oH,NC,Bw,_g,zi,ks,Yc,Bl,Gl,Hs,hs,ha,hg,mg,yC,bC,Ul,fg,Vl,zs,Sg=Jt(()=>{Mw="HTTP error ",gg="HTTP Range not supported",OC="Reader is not seekable",RC="text/plain",eH="Content-Length",tH="Content-Range",rH="Accept-Ranges",nH="Range",oH="HEAD",NC="GET",Bw="bytes",_g=class{constructor(){this.size=0}init(){this.initialized=!0}},zi=class extends _g{},ks=class extends _g{writeUint8Array(e){this.size+=e.length}},Yc=class extends zi{constructor(e){super(),this.blobReader=new hs(new Blob([e],{type:RC}))}init(){super.init(),this.blobReader.init(),this.size=this.blobReader.size}readUint8Array(e,r){return this.blobReader.readUint8Array(e,r)}},Bl=class extends ks{constructor(e){super(),this.encoding=e,this.blob=new Blob([],{type:RC})}writeUint8Array(e){super.writeUint8Array(e),this.blob=new Blob([this.blob,e.buffer],{type:RC})}getData(){if(this.blob.text)return this.blob.text();{let e=new FileReader;return new Promise((r,n)=>{e.onload=o=>r(o.target.result),e.onerror=()=>n(e.error),e.readAsText(this.blob,this.encoding)})}}},Gl=class extends zi{constructor(e){super(),this.dataURI=e;let r=e.length;for(;e.charAt(r-1)=="=";)r--;this.dataStart=e.indexOf(",")+1,this.size=Math.floor((r-this.dataStart)*.75)}readUint8Array(e,r){let n=new Uint8Array(r),o=Math.floor(e/3)*4,i=atob(this.dataURI.substring(o+this.dataStart,Math.ceil((e+r)/3)*4+this.dataStart)),a=e-Math.floor(o/4)*3;for(let s=a;s<a+r;s++)n[s-a]=i.charCodeAt(s);return n}},Hs=class extends ks{constructor(e){super(),this.data="data:"+(e||"")+";base64,",this.pending=[]}writeUint8Array(e){super.writeUint8Array(e);let r=0,n=this.pending,o=this.pending.length;for(this.pending="",r=0;r<Math.floor((o+e.length)/3)*3-o;r++)n+=String.fromCharCode(e[r]);for(;r<e.length;r++)this.pending+=String.fromCharCode(e[r]);n.length>2?this.data+=btoa(n):this.pending=n}getData(){return this.data+btoa(this.pending)}},hs=class extends zi{constructor(e){super(),this.blob=e,this.size=e.size}async readUint8Array(e,r){if(this.blob.arrayBuffer)return new Uint8Array(await this.blob.slice(e,e+r).arrayBuffer());{let n=new FileReader;return new Promise((o,i)=>{n.onload=a=>o(new Uint8Array(a.target.result)),n.onerror=()=>i(n.error),n.readAsArrayBuffer(this.blob.slice(e,e+r))})}}},ha=class extends ks{constructor(e){super(),this.contentType=e,this.arrayBuffersMaxlength=8,Fw(this)}writeUint8Array(e){super.writeUint8Array(e),this.arrayBuffers.length==this.arrayBuffersMaxlength&&Dw(this),this.arrayBuffers.push(e.buffer)}getData(){return this.blob||(this.arrayBuffers.length&&Dw(this),this.blob=this.pendingBlob,Fw(this)),this.blob}};hg=class{constructor(e){this.readableStream=e,this.reader=e.getReader(),this.size=1/0,this.index=0,this.currentSize=0,this.pendingValue=new Uint8Array}init(){this.initialized=!0}async readUint8Array(e,r){if(this.index!=e)throw new Error(OC);let n=new Uint8Array(r),o=0,i;do{let a=await this.reader.read(),{value:s}=a;if(i=a.done,s?this.currentSize+=s.length:(s=this.pendingValue,this.pendingValue=new Uint8Array),this.pendingValue.length){let l=new Uint8Array(this.pendingValue.length+s.length);l.set(this.pendingValue),l.set(s,this.pendingValue.length),this.pendingValue=new Uint8Array,s=l}o+s.length>r?(n.set(s.subarray(0,r),o),this.pendingValue=s.subarray(r),o+=r):(n.set(s,o),o+=s.length)}while(o<r&&!i);return i&&this.size==1/0&&(this.size=this.currentSize),this.size<r&&(n=n.slice(0,this.size),r=this.size),this.index+=r,n}},mg=class extends ks{constructor(e){super(),this.writableStream=e,this.writer=e.getWriter()}async writeUint8Array(e){return await this.writer.ready,this.writer.write(e)}async getData(){return await this.writer.ready,await this.writer.close(),this.writableStream}},yC=class extends zi{constructor(e,r){super(),this.url=e,this.preventHeadRequest=r.preventHeadRequest,this.useRangeHeader=r.useRangeHeader,this.forceRangeRequests=r.forceRangeRequests,this.options=Object.assign({},r),delete this.options.preventHeadRequest,delete this.options.useRangeHeader,delete this.options.forceRangeRequests,delete this.options.useXHR}async init(){super.init(),await Gw(this,vC,xw)}readUint8Array(e,r){return Uw(this,e,r,vC,xw)}},bC=class extends zi{constructor(e,r){super(),this.url=e,this.preventHeadRequest=r.preventHeadRequest,this.useRangeHeader=r.useRangeHeader,this.forceRangeRequests=r.forceRangeRequests,this.options=r}async init(){super.init(),await Gw(this,CC,ww)}readUint8Array(e,r){return Uw(this,e,r,CC,ww)}};Ul=class extends zi{constructor(e,r={}){super(),this.url=e,r.useXHR?this.reader=new bC(e,r):this.reader=new yC(e,r)}set size(e){}get size(){return this.reader.size}async init(){super.init(),await this.reader.init()}readUint8Array(e,r){return this.reader.readUint8Array(e,r)}},fg=class extends Ul{constructor(e,r={}){r.useRangeHeader=!0,super(e,r)}},Vl=class extends zi{constructor(e){super(),this.array=e,this.size=e.length}readUint8Array(e,r){return this.array.slice(e,e+r)}},zs=class extends ks{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(e){super.writeUint8Array(e);let r=this.array;this.array=new Uint8Array(r.length+e.length),this.array.set(r),this.array.set(e,r.length)}getData(){return this.array}}});var su,FC,DC,xC=Jt(()=>{su="/",FC=new Date(2107,11,31),DC=new Date(1980,0,1)});var aH,Hw,zw=Jt(()=>{aH="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),Hw=t=>{let e="";for(let r=0;r<t.length;r++)e+=aH[t[r]];return e}});function sH(t,e){if(e&&e.trim().toLowerCase()=="cp437")return Hw(t);if(typeof TextDecoder>"u"){let r=new FileReader;return new Promise((n,o)=>{r.onload=i=>n(i.target.result),r.onerror=()=>o(r.error),r.readAsText(new Blob([t]))})}else return new TextDecoder(e).decode(t)}var Ag,Ww=Jt(()=>{zw();Ag=sH});async function Eg(t,e,r,n,o,i,a){let s=Math.max(i.chunkSize,64);return l();async function l(c=0,d=0){let u=a.signal,p=o();if(c<p){wC(u,t);let _=await e.readUint8Array(c+n,Math.min(s,p-c)),h=_.length;wC(u,t);let g=await t.append(_);if(wC(u,t),d+=await Kw(r,g),a.onprogress)try{a.onprogress(c+h,p)}catch{}return l(c+s,d)}else{let _=await t.flush();return d+=await Kw(r,_.data),{signature:_.signature,length:d}}}}function wC(t,e){if(t&&t.aborted)throw e.abort(),new Error(Tg)}async function Kw(t,e){return e.length&&await t.writeUint8Array(e),e.length}var Tg,Ig=Jt(()=>{Tg="Abort error"});var lH,Ws,LC=Jt(()=>{lH=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"],Ws=class{constructor(e){lH.forEach(r=>this[r]=e[r])}}});function jw(t,e,r){let n=t.rawBitFlag=Wi(e,r+2),o=(n&1)==1,i=lo(e,r+6);Object.assign(t,{encrypted:o,version:Wi(e,r),bitFlag:{level:(n&6)>>1,dataDescriptor:(n&8)==8,languageEncodingFlag:(n&2048)==2048},rawLastModDate:i,lastModDate:gH(i),filenameLength:Wi(e,r+22),extraFieldLength:Wi(e,r+24)})}async function Zw(t,e,r,n){let o=e.rawExtraField,i=e.extraField=new Map,a=Do(new Uint8Array(o)),s=0;try{for(;s<o.length;){let g=Wi(a,s),m=Wi(a,s+2);i.set(g,{type:g,data:o.slice(s+4,s+4+m)}),s+=4+m}}catch{}let l=Wi(r,n+4);e.signature=lo(r,n+10),e.uncompressedSize=lo(r,n+18),e.compressedSize=lo(r,n+14);let c=i.get(1);c&&(pH(c,e),e.extraFieldZip64=c);let d=i.get(28789);d&&(await Xw(d,"filename","rawFilename",e,t),e.extraFieldUnicodePath=d);let u=i.get(25461);u&&(await Xw(u,"comment","rawComment",e,t),e.extraFieldUnicodeComment=u);let p=i.get(39169);p?(_H(p,e,l),e.extraFieldAES=p):e.compressionMethod=l;let _=i.get(10);_&&(hH(_,e),e.extraFieldNTFS=_);let h=i.get(21589);h&&(mH(h,e),e.extraFieldExtendedTimestamp=h)}function pH(t,e){e.zip64=!0;let r=Do(t.data);t.values=[];for(let o=0;o<Math.floor(t.data.length/8);o++)t.values.push(Rg(r,0+o*8));let n=qw.filter(o=>e[o]==4294967295);for(let o=0;o<n.length;o++)t[n[o]]=t.values[o];qw.forEach(o=>{if(e[o]==4294967295)if(t[o]!==void 0)e[o]=t[o];else throw new Error(eO)})}async function Xw(t,e,r,n,o){let i=Do(t.data);t.version=cu(i,0),t.signature=lo(i,1);let a=new xl;a.append(o[r]);let s=Do(new Uint8Array(4));s.setUint32(0,a.get(),!0),t[e]=await Ag(t.data.subarray(5)),t.valid=!o.bitFlag.languageEncodingFlag&&t.signature==lo(s,0),t.valid&&(n[e]=t[e],n[e+"UTF8"]=!0)}function _H(t,e,r){let n=Do(t.data);t.vendorVersion=cu(n,0),t.vendorId=cu(n,2);let o=cu(n,4);t.strength=o,t.originalCompressionMethod=r,e.compressionMethod=t.compressionMethod=Wi(n,5)}function hH(t,e){let r=Do(t.data),n=4,o;try{for(;n<t.data.length&&!o;){let i=Wi(r,n),a=Wi(r,n+2);i==1&&(o=t.data.slice(n+4,n+4+a)),n+=4+a}}catch{}try{if(o&&o.length==24){let i=Do(o),a=i.getBigUint64(0,!0),s=i.getBigUint64(8,!0),l=i.getBigUint64(16,!0);Object.assign(t,{rawLastModDate:a,rawLastAccessDate:s,rawCreationDate:l});let c=GC(a),d=GC(s),u=GC(l),p={lastModDate:c,lastAccessDate:d,creationDate:u};Object.assign(t,p),Object.assign(e,p)}}catch{}}function mH(t,e){let r=Do(t.data),n=cu(r,0),o=[],i=[];(n&1)==1&&(o.push("lastModDate"),i.push("rawLastModDate")),(n&2)==2&&(o.push("lastAccessDate"),i.push("rawLastAccessDate")),(n&4)==4&&(o.push("creationDate"),i.push("rawCreationDate"));let a=1;o.forEach((s,l)=>{if(t.data.length>=a+4){let c=lo(r,a);e[s]=t[s]=new Date(c*1e3);let d=i[l];t[d]=c}a+=4})}async function fH(t,e,r,n,o){let i=new Uint8Array(4),a=Do(i);SH(a,0,e);let s=n+o;return await l(n)||await l(Math.min(s,r));async function l(c){let d=r-c,u=await kl(t,d,c);for(let p=u.length-n;p>=0;p--)if(u[p]==i[0]&&u[p+1]==i[1]&&u[p+2]==i[2]&&u[p+3]==i[3])return{offset:d+p,buffer:u.slice(p,p+n).buffer}}}function lu(t,e,r){return e[r]===void 0?t.options[r]:e[r]}function gH(t){let e=(t&4294901760)>>16,r=t&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(r&63488)>>11,(r&2016)>>5,(r&31)*2,0)}catch{}}function GC(t){return new Date(Number(t/BigInt(1e4)-BigInt(116444736e5)))}function cu(t,e){return t.getUint8(e)}function Wi(t,e){return t.getUint16(e,!0)}function lo(t,e){return t.getUint32(e,!0)}function Rg(t,e){return Number(t.getBigUint64(e,!0))}function SH(t,e,r){t.setUint32(e,r,!0)}function Do(t){return new DataView(t.buffer)}function kl(t,e,r){return t.readUint8Array(e,r)}var h_,XC,jC,ZC,JC,$C,eO,tO,rO,Fg,Yw,Qw,qw,du,UC,nO=Jt(()=>{xC();s_();__();Ww();ng();Ig();LC();h_="File format is not recognized",XC="End of central directory not found",jC="End of Zip64 central directory not found",ZC="End of Zip64 central directory locator not found",JC="Central directory header not found",$C="Local file header not found",eO="Zip64 extra field not found",tO="File contains encrypted entry",rO="Encryption method not supported",Fg="Compression method not supported",Yw="utf-8",Qw="cp437",qw=["uncompressedSize","compressedSize","offset"],du=class{constructor(e,r={}){Object.assign(this,{reader:e,options:r,config:rg()})}async*getEntriesGenerator(e={}){let r=this,n=r.reader;if(n.initialized||await n.init(),n.size<22)throw new Error(h_);let o=await fH(n,101010256,n.size,22,65535*16);if(!o)throw new Error(XC);let i=Do(o),a=lo(i,12),s=lo(i,16),l=Wi(i,8),c=0;if(s==4294967295||a==4294967295||l==65535){let _=await kl(n,o.offset-20,20),h=Do(_);if(lo(h,0)!=117853008)throw new Error(jC);s=Rg(h,8);let g=await kl(n,s,56),m=Do(g),A=o.offset-20-56;if(lo(m,0)!=101075792&&s!=A){let S=s;s=A,c=s-S,g=await kl(n,s,56),m=Do(g)}if(lo(m,0)!=101075792)throw new Error(ZC);l=Rg(m,32),a=Rg(m,40),s-=a}if(s<0||s>=n.size)throw new Error(h_);let d=0,u=await kl(n,s,a),p=Do(u);if(a){let _=o.offset-a;if(lo(p,d)!=33639248&&s!=_){let h=s;s=_,c=s-h,u=await kl(n,s,a),p=Do(u)}}if(s<0||s>=n.size)throw new Error(h_);for(let _=0;_<l;_++){let h=new UC(n,r.config,r.options);if(lo(p,d)!=33639248)throw new Error(JC);jw(h,p,d+6);let g=!!h.bitFlag.languageEncodingFlag,m=d+46,A=m+h.filenameLength,S=A+h.extraFieldLength,T=Wi(p,d+4),R=(T&0)==0;Object.assign(h,{versionMadeBy:T,msDosCompatible:R,compressedSize:0,uncompressedSize:0,commentLength:Wi(p,d+32),directory:R&&(cu(p,d+38)&16)==16,offset:lo(p,d+42)+c,internalFileAttribute:lo(p,d+34),externalFileAttribute:lo(p,d+38),rawFilename:u.subarray(m,A),filenameUTF8:g,commentUTF8:g,rawExtraField:u.subarray(A,S)});let b=S+h.commentLength;h.rawComment=u.subarray(S,b);let O=lu(r,e,"filenameEncoding"),f=lu(r,e,"commentEncoding"),[I,y]=await Promise.all([Ag(h.rawFilename,h.filenameUTF8?Yw:O||Qw),Ag(h.rawComment,h.commentUTF8?Yw:f||Qw)]);h.filename=I,h.comment=y,!h.directory&&h.filename.endsWith(su)&&(h.directory=!0),await Zw(h,h,p,d+6);let P=new Ws(h);if(P.getData=(E,C)=>h.getData(E,P,C),d=b,e.onprogress)try{e.onprogress(_+1,l,new Ws(h))}catch{}yield P}return!0}async getEntries(e={}){let r=[],n=this.getEntriesGenerator(e),o=n.next();for(;!(await o).done;)r.push((await o).value),o=n.next();return r}async close(){}},UC=class{constructor(e,r,n){Object.assign(this,{reader:e,config:r,options:n})}async getData(e,r,n={}){let o=this,{reader:i,offset:a,extraFieldAES:s,compressionMethod:l,config:c,bitFlag:d,signature:u,rawLastModDate:p,compressedSize:_}=o,h=o.localDirectory={};i.initialized||await i.init();let g=await kl(i,a,30),m=Do(g),A=lu(o,n,"password");if(A=A&&A.length&&A,s&&s.originalCompressionMethod!=99)throw new Error(Fg);if(l!=0&&l!=8)throw new Error(Fg);if(lo(m,0)!=67324752)throw new Error($C);jw(h,m,4),g=await kl(i,a,30+h.filenameLength+h.extraFieldLength),h.rawExtraField=g.subarray(30+h.filenameLength),await Zw(o,h,m,4),r.lastAccessDate=h.lastAccessDate,r.creationDate=h.creationDate;let S=o.encrypted&&h.encrypted,T=S&&!s;if(S){if(!T&&s.strength===void 0)throw new Error(rO);if(!A)throw new Error(tO)}let R=await pg(c.Inflate,{codecType:dg,password:A,zipCrypto:T,encryptionStrength:s&&s.strength,signed:lu(o,n,"checkSignature"),passwordVerification:T&&(d.dataDescriptor?p>>>8&255:u>>>24&255),signature:u,compressed:l!=0,encrypted:S,useWebWorkers:lu(o,n,"useWebWorkers")},c);e.initialized||await e.init();let b=lu(o,n,"signal"),O=a+30+h.filenameLength+h.extraFieldLength;return await Eg(R,i,e,O,()=>_,c,{onprogress:n.onprogress,signal:b}),e.getData()}}});async function RH(t,e,r,n){if(e=e.trim(),n.directory&&!e.endsWith(su)?e+=su:n.directory=e.endsWith(su),t.files.has(e))throw new Error(aO);let o=c_(e);if(o.length>65535)throw new Error(cO);let i=n.comment||"",a=c_(i);if(a.length>65535)throw new Error(lO);let s=t.options.version||n.version||0;if(s>65535)throw new Error(wg);let l=t.options.versionMadeBy||n.versionMadeBy||20;if(l>65535)throw new Error(wg);let c=bo(t,n,"lastModDate")||new Date,d=bo(t,n,"lastAccessDate"),u=bo(t,n,"creationDate"),p=bo(t,n,"password"),_=bo(t,n,"encryptionStrength")||3,h=bo(t,n,"zipCrypto");if(p!==void 0&&_!==void 0&&(_<1||_>3))throw new Error(dO);let g=new Uint8Array(0),m=n.extraField;if(m){let D=0,w=0;m.forEach(k=>D+=4+k.length),g=new Uint8Array(D),m.forEach((k,z)=>{if(z>65535)throw new Error(uO);if(k.length>65535)throw new Error(pO);uo(g,new Uint16Array([z]),w),uo(g,new Uint16Array([k.length]),w+2),uo(g,k,w+4),w+=4+k.length})}let A=bo(t,n,"extendedTimestamp");A===void 0&&(A=!0);let S=0,T=bo(t,n,"keepOrder");T===void 0&&(T=!0);let R=0,b=bo(t,n,"msDosCompatible");b===void 0&&(b=!0);let O=bo(t,n,"internalFileAttribute")||0,f=bo(t,n,"externalFileAttribute")||0;r&&(r.initialized||await r.init(),R=r.size,S=OH(R));let I=n.zip64||t.options.zip64||!1;if(t.offset+t.pendingCompressedSize>=4294967295||R>=4294967295||S>=4294967295){if(n.zip64===!1||t.options.zip64===!1||!T)throw new Error(m_);I=!0}t.pendingCompressedSize+=S,await Promise.resolve();let y=bo(t,n,"level"),P=bo(t,n,"useWebWorkers"),E=bo(t,n,"bufferedWrite"),C=bo(t,n,"dataDescriptor"),B=bo(t,n,"dataDescriptorSignature"),G=bo(t,n,"signal");C===void 0&&(C=!0),C&&B===void 0&&(B=!1);let V=await yH(t,e,r,Object.assign({},n,{rawFilename:o,rawComment:a,version:s,versionMadeBy:l,lastModDate:c,lastAccessDate:d,creationDate:u,rawExtraField:g,zip64:I,password:p,level:y,useWebWorkers:P,encryptionStrength:_,extendedTimestamp:A,zipCrypto:h,bufferedWrite:E,keepOrder:T,dataDescriptor:C,dataDescriptorSignature:B,signal:G,msDosCompatible:b,internalFileAttribute:O,externalFileAttribute:f}));return S&&(t.pendingCompressedSize-=S),Object.assign(V,{name:e,comment:i,extraField:m}),new Ws(V)}async function yH(t,e,r,n){let o=t.files,i=t.writer,a=Array.from(o.values()).pop(),s={},l,c,d;o.set(e,s);try{let u,p,_;if(n.keepOrder&&(u=a&&a.lock),s.lock=_=new Promise(h=>d=h),n.bufferedWrite||t.lockWrite||!n.dataDescriptor?(p=new ha,p.init(),l=!0):(t.lockWrite=new Promise(h=>c=h),i.initialized||await i.init(),p=i),s=await bH(r,p,t.config,n),s.lock=_,o.set(e,s),s.filename=e,l){let h=0,g=p.getData();await Promise.all([t.lockWrite,u]);let m;do m=Array.from(o.values()).find(A=>A.writingBufferedData),m&&await m.lock;while(m&&m.lock);if(s.writingBufferedData=!0,!n.dataDescriptor){let S=await rL(g,0,26),T=new DataView(S);(!s.encrypted||n.zipCrypto)&&Rr(T,14,s.signature),s.zip64?(Rr(T,18,4294967295),Rr(T,22,4294967295)):(Rr(T,18,s.compressedSize),Rr(T,22,s.uncompressedSize)),await i.writeUint8Array(new Uint8Array(S)),h=26}await CH(i,g,h),delete s.writingBufferedData}if(s.offset=t.offset,s.zip64){let h=Ha(s.rawExtraFieldZip64);Ai(h,20,BigInt(s.offset))}else if(s.offset>=4294967295)throw new Error(m_);return t.offset+=s.length,s}catch(u){throw(l&&s.writingBufferedData||!l&&s.dataWritten)&&(u.corruptedEntry=t.hasCorruptedEntries=!0,s.uncompressedSize&&(t.offset+=s.uncompressedSize)),o.delete(e),u}finally{d(),c&&c()}}async function bH(t,e,r,n){let{rawFilename:o,lastAccessDate:i,creationDate:a,password:s,level:l,zip64:c,zipCrypto:d,dataDescriptor:u,dataDescriptorSignature:p,directory:_,version:h,versionMadeBy:g,rawComment:m,rawExtraField:A,useWebWorkers:S,onprogress:T,signal:R,encryptionStrength:b,extendedTimestamp:O,msDosCompatible:f,internalFileAttribute:I,externalFileAttribute:y}=n,P=!!(s&&s.length),E=l!==0&&!_,C;if(P&&!d){C=new Uint8Array(eL.length+2);let nt=Ha(C);jr(nt,0,39169),uo(C,eL,2),Lg(nt,8,b)}else C=new Uint8Array(0);let B,G;if(O){G=new Uint8Array(9+(i?4:0)+(a?4:0));let nt=Ha(G);jr(nt,0,21589),jr(nt,2,G.length-4);let Et=1+(i?2:0)+(a?4:0);Lg(nt,4,Et),Rr(nt,5,Math.floor(n.lastModDate.getTime()/1e3)),i&&Rr(nt,9,Math.floor(i.getTime()/1e3)),a&&Rr(nt,13,Math.floor(a.getTime()/1e3));try{B=new Uint8Array(36);let He=Ha(B),st=iO(n.lastModDate);jr(He,0,10),jr(He,2,32),jr(He,8,1),jr(He,10,24),Ai(He,12,st),Ai(He,20,iO(i)||st),Ai(He,28,iO(a)||st)}catch{B=new Uint8Array(0)}}else B=G=new Uint8Array(0);let V={version:h||20,versionMadeBy:g,zip64:c,directory:!!_,filenameUTF8:!0,rawFilename:o,commentUTF8:!0,rawComment:m,rawExtraFieldZip64:c?new Uint8Array(tL+4):new Uint8Array(0),rawExtraFieldExtendedTimestamp:G,rawExtraFieldNTFS:B,rawExtraFieldAES:C,rawExtraField:A,extendedTimestamp:O,msDosCompatible:f,internalFileAttribute:I,externalFileAttribute:y},D=V.uncompressedSize=0,w=2048;u&&(w=w|8);let k=0;E&&(k=8),c&&(V.version=V.version>45?V.version:45),P&&(w=w|1,d||(V.version=V.version>51?V.version:51,k=99,E&&(V.rawExtraFieldAES[9]=8))),V.compressionMethod=k;let z=V.headerArray=new Uint8Array(26),H=Ha(z);jr(H,0,V.version),jr(H,2,w),jr(H,4,k);let K=new Uint32Array(1),j=Ha(K),q;n.lastModDate<DC?q=DC:n.lastModDate>FC?q=FC:q=n.lastModDate,jr(j,0,(q.getHours()<<6|q.getMinutes())<<5|q.getSeconds()/2),jr(j,2,(q.getFullYear()-1980<<4|q.getMonth()+1)<<5|q.getDate());let J=K[0];Rr(H,6,J),jr(H,22,o.length);let ie=C.length+G.length+B.length+V.rawExtraField.length;jr(H,24,ie);let Ee=new Uint8Array(30+o.length+ie),Ke=Ha(Ee);Rr(Ke,0,67324752),uo(Ee,z,4),uo(Ee,o,30),uo(Ee,C,30+o.length),uo(Ee,G,30+o.length+C.length),uo(Ee,B,30+o.length+C.length+G.length),uo(Ee,V.rawExtraField,30+o.length+C.length+G.length+B.length);let Ve,at=0;if(t){let nt=await pg(r.Deflate,{codecType:cg,level:l,password:s,encryptionStrength:b,zipCrypto:P&&d,passwordVerification:P&&d&&J>>8&255,signed:!0,compressed:E,encrypted:P,useWebWorkers:S},r);await e.writeUint8Array(Ee),V.dataWritten=!0,Ve=await Eg(nt,t,e,0,()=>t.size,r,{onprogress:T,signal:R}),D=V.uncompressedSize=t.size,at=Ve.length}else await e.writeUint8Array(Ee),V.dataWritten=!0;let Dt=new Uint8Array(0),qt,zt=0;if(u&&(Dt=new Uint8Array(c?p?24:20:p?16:12),qt=Ha(Dt),p&&(zt=4,Rr(qt,0,134695760))),t){let nt=Ve.signature;if((!P||d)&&nt!==void 0&&(Rr(H,10,nt),V.signature=nt,u&&Rr(qt,zt,nt)),c){let Et=Ha(V.rawExtraFieldZip64);jr(Et,0,1),jr(Et,2,tL),Rr(H,14,4294967295),Ai(Et,12,BigInt(at)),Rr(H,18,4294967295),Ai(Et,4,BigInt(D)),u&&(Ai(qt,zt+4,BigInt(at)),Ai(qt,zt+12,BigInt(D)))}else Rr(H,14,at),Rr(H,18,D),u&&(Rr(qt,zt+4,at),Rr(qt,zt+8,D))}u&&await e.writeUint8Array(Dt);let ae=Ee.length+at+Dt.length;return Object.assign(V,{compressedSize:at,lastModDate:q,rawLastModDate:J,creationDate:a,lastAccessDate:i,encrypted:P,length:ae}),V}async function vH(t,e,r){let n=t.writer,o=t.files,i=0,a=0,s=t.offset,l=o.size;for(let[,p]of o)a+=46+p.rawFilename.length+p.rawComment.length+p.rawExtraFieldZip64.length+p.rawExtraFieldAES.length+p.rawExtraFieldExtendedTimestamp.length+p.rawExtraFieldNTFS.length+p.rawExtraField.length;let c=r.zip64||t.options.zip64||!1;if(s>=4294967295||a>=4294967295||l>=65535){if(r.zip64===!1||t.options.zip64===!1)throw new Error(m_);c=!0}let d=new Uint8Array(a+(c?98:22)),u=Ha(d);if(e&&e.length)if(e.length<=65535)jr(u,i+20,e.length);else throw new Error(sO);for(let[p,_]of Array.from(o.values()).entries()){let{rawFilename:h,rawExtraFieldZip64:g,rawExtraFieldAES:m,rawExtraField:A,rawComment:S,versionMadeBy:T,headerArray:R,directory:b,zip64:O,msDosCompatible:f,internalFileAttribute:I,externalFileAttribute:y}=_,P,E;if(_.extendedTimestamp){E=_.rawExtraFieldNTFS,P=new Uint8Array(9);let B=Ha(P);jr(B,0,21589),jr(B,2,P.length-4),Lg(B,4,1),Rr(B,5,Math.floor(_.lastModDate.getTime()/1e3))}else E=P=new Uint8Array(0);let C=g.length+m.length+P.length+E.length+A.length;if(Rr(u,i,33639248),jr(u,i+4,T),uo(d,R,i+6),jr(u,i+30,C),jr(u,i+32,S.length),Rr(u,i+34,I),y?Rr(u,i+38,y):b&&f&&Lg(u,i+38,16),O?Rr(u,i+42,4294967295):Rr(u,i+42,_.offset),uo(d,h,i+46),uo(d,g,i+46+h.length),uo(d,m,i+46+h.length+g.length),uo(d,P,i+46+h.length+g.length+m.length),uo(d,E,i+46+h.length+g.length+m.length+P.length),uo(d,A,i+46+h.length+g.length+m.length+P.length+E.length),uo(d,S,i+46+h.length+C),i+=46+h.length+C+S.length,r.onprogress)try{r.onprogress(p+1,o.size,new Ws(_))}catch{}}c&&(Rr(u,i,101075792),Ai(u,i+4,BigInt(44)),jr(u,i+12,45),jr(u,i+14,45),Ai(u,i+24,BigInt(l)),Ai(u,i+32,BigInt(l)),Ai(u,i+40,BigInt(a)),Ai(u,i+48,BigInt(s)),Rr(u,i+56,117853008),Ai(u,i+64,BigInt(s)+BigInt(a)),Rr(u,i+72,1),l=65535,s=4294967295,a=4294967295,i+=76),Rr(u,i,101010256),jr(u,i+8,l),jr(u,i+10,l),Rr(u,i+12,a),Rr(u,i+16,s),await n.writeUint8Array(d),e&&e.length&&await n.writeUint8Array(e)}function rL(t,e,r){if(t.arrayBuffer)return e||r?t.slice(e,r).arrayBuffer():t.arrayBuffer();{let n=new FileReader;return new Promise((o,i)=>{n.onload=a=>o(a.target.result),n.onerror=()=>i(n.error),n.readAsArrayBuffer(e||r?t.slice(e,r):t)})}}async function CH(t,e,r=0){await o();async function o(){if(r<e.size){let i=await rL(e,r,r+536870912);await t.writeUint8Array(new Uint8Array(i)),r+=536870912,await o()}}}function iO(t){if(t)return(BigInt(t.getTime())+BigInt(116444736e5))*BigInt(1e4)}function bo(t,e,r){return e[r]===void 0?t.options[r]:e[r]}function OH(t){return t+5*(Math.floor(t/16383)+1)}function Lg(t,e,r){t.setUint8(e,r)}function jr(t,e,r){t.setUint16(e,r,!0)}function Rr(t,e,r){t.setUint32(e,r,!0)}function Ai(t,e,r){t.setBigUint64(e,r,!0)}function uo(t,e,r){t.set(e,r)}function Ha(t){return new DataView(t.buffer)}var aO,sO,lO,cO,wg,dO,uO,pO,m_,eL,tL,oO,uu,_O=Jt(()=>{xC();s_();__();lC();Sg();Ig();LC();aO="File already exists",sO="Zip file comment exceeds 64KB",lO="File entry comment exceeds 64KB",cO="File entry name exceeds 64KB",wg="Version exceeds 65535",dO="The strength must equal 1, 2, or 3",uO="Extra field type exceeds 65535",pO="Extra field data exceeds 64KB",m_="Zip64 is not supported",eL=new Uint8Array([7,0,2,0,65,69,3,0,0]),tL=24,oO=0,uu=class{constructor(e,r={}){Object.assign(this,{writer:e,options:r,config:rg(),files:new Map,offset:e.size,pendingCompressedSize:0,pendingEntries:[],pendingAddFileCalls:new Set})}async add(e="",r,n={}){let o=this;if(oO<o.config.maxWorkers){oO++;let i;try{return i=RH(o,e,r,n),this.pendingAddFileCalls.add(i),await i}finally{this.pendingAddFileCalls.delete(i),oO--;let a=o.pendingEntries.shift();a&&o.add(a.name,a.reader,a.options).then(a.resolve).catch(a.reject)}}else return new Promise((i,a)=>o.pendingEntries.push({name:e,reader:r,options:n,resolve:i,reject:a}))}async close(e=new Uint8Array(0),r={}){for(;this.pendingAddFileCalls.size;)await Promise.all(Array.from(this.pendingAddFileCalls));return await vH(this,e,r),this.writer.getData()}}});function NH(t,e){let r=0;return t.forEach(n),r;function n(o){r+=o[e],o.children&&o.children.forEach(n)}}function PH(t){return class extends zi{constructor(e,r={}){super(),this.entry=e,this.options=r}async init(){let e=this;e.size=e.entry.uncompressedSize;let r=await e.entry.getData(new ha,Object.assign({},e.options,t));e.data=r,e.blobReader=new hs(r)}readUint8Array(e,r){return this.blobReader.readUint8Array(e,r)}}}async function aL(t){if(t.children.length)for(let e of t.children)e.directory?await aL(e):(e.reader=new e.Reader(e.data),await e.reader.init(),e.uncompressedSize=e.reader.size)}function oL(t){let e=t.parent.children;e.forEach((r,n)=>{r.id==t.id&&e.splice(n,1)})}async function FH(t,e,r,n){let o=e,i=new Map;await a(t,e);async function a(s,l){await c();async function c(){if(n.bufferedWrite)await Promise.all(l.children.map(d));else for(let u of l.children)await d(u)}async function d(u){let p=n.relativePath?u.getRelativeName(o):u.getFullname();await s.add(p,u.reader,Object.assign({directory:u.directory},Object.assign({},n,{onprogress:_=>{if(n.onprogress){i.set(p,_);try{n.onprogress(Array.from(i.values()).reduce((h,g)=>h+g),r)}catch{}}}}))),await a(s,u)}}}async function DH(t,e){if(e.isDirectory){let o=t.addDirectory(e.name);return await r(o,e),o}else return new Promise((o,i)=>e.file(a=>o(t.addBlob(e.name,a)),i));async function r(o,i){let a=await n(i);for(let s of a)s.isDirectory?await r(o.addDirectory(s.name),s):await new Promise((l,c)=>{s.file(d=>{let u=o.addBlob(s.name,d);u.uncompressedSize=d.size,l(u)},c)})}function n(o){return new Promise((i,a)=>{let s=[];o.isDirectory&&l(o.createReader()),o.isFile&&i(s);function l(c){c.readEntries(d=>{d.length?(s=s.concat(d),l(c)):i(s)},a)}})}}function Mg(t){t.entries=[],t.root=new f_(t)}function xH(t,e){return r();async function r(n=0){let o=n*nL;if(o<t.size){let i=await t.readUint8Array(o,Math.min(nL,t.size-o));return await e.writeUint8Array(i),r(n+1)}else return e.getData()}}function Hl(t,e,r,n){if(t.directory)return n?new f_(t.fs,e,r,t):new Gg(t.fs,e,r,t);throw new Error("Parent entry is not a directory")}var nL,Bg,Gg,f_,hO,iL,sL=Jt(()=>{Ig();Sg();nO();_O();nL=512*1024,Bg=class{constructor(e,r,n,o){let i=this;if(e.root&&o&&o.getChildByName(r))throw new Error("Entry filename already exists");n||(n={}),Object.assign(i,{fs:e,name:r,data:n.data,id:e.entries.length,parent:o,children:[],uncompressedSize:0}),e.entries.push(i),o&&i.parent.children.push(i)}moveTo(e){let r=this;r.fs.move(r,e)}getFullname(){return this.getRelativeName()}getRelativeName(e=this.fs.root){let r=this,n=r.name,o=r.parent;for(;o&&o!=e;)n=(o.name?o.name+"/":"")+n,o=o.parent;return n}isDescendantOf(e){let r=this.parent;for(;r&&r.id!=e.id;)r=r.parent;return!!r}},Gg=class extends Bg{constructor(e,r,n,o){super(e,r,n,o);let i=this;i.Reader=n.Reader,i.Writer=n.Writer,n.getData&&(i.getData=n.getData)}async getData(e,r={}){let n=this;return!e||e.constructor==n.Writer&&n.data?n.data:(n.reader=new n.Reader(n.data,r),await n.reader.init(),e.initialized||await e.init(),n.uncompressedSize=n.reader.size,xH(n.reader,e))}getText(e,r){return this.getData(new Bl(e),r)}getBlob(e,r){return this.getData(new ha(e),r)}getData64URI(e,r){return this.getData(new Hs(e),r)}getUint8Array(e){return this.getData(new zs,e)}replaceBlob(e){Object.assign(this,{data:e,Reader:hs,Writer:ha,reader:null})}replaceText(e){Object.assign(this,{data:e,Reader:Yc,Writer:Bl,reader:null})}replaceData64URI(e){Object.assign(this,{data:e,Reader:Gl,Writer:Hs,reader:null})}replaceUint8Array(e){Object.assign(this,{data:e,Reader:Vl,Writer:zs,reader:null})}},f_=class t extends Bg{constructor(e,r,n,o){super(e,r,n,o),this.directory=!0}addDirectory(e){return Hl(this,e,null,!0)}addText(e,r){return Hl(this,e,{data:r,Reader:Yc,Writer:Bl})}addBlob(e,r){return Hl(this,e,{data:r,Reader:hs,Writer:ha})}addData64URI(e,r){return Hl(this,e,{data:r,Reader:Gl,Writer:Hs})}addUint8Array(e,r){return Hl(this,e,{data:r,Reader:Vl,Writer:zs})}addHttpContent(e,r,n={}){return Hl(this,e,{data:r,Reader:class extends Ul{constructor(o){super(o,n)}}})}addFileSystemEntry(e){return DH(this,e)}addData(e,r){return Hl(this,e,r)}async importBlob(e,r={}){await this.importZip(new hs(e),r)}async importData64URI(e,r={}){await this.importZip(new Gl(e),r)}async importUint8Array(e,r={}){await this.importZip(new Vl(e),r)}async importHttpContent(e,r={}){await this.importZip(new Ul(e,r),r)}exportBlob(e={}){return this.exportZip(new ha("application/zip"),e)}exportData64URI(e={}){return this.exportZip(new Hs("application/zip"),e)}exportUint8Array(e={}){return this.exportZip(new zs,e)}async importZip(e,r){e.initialized||await e.init(),(await new du(e,r).getEntries()).forEach(i=>{let a=this,s=i.filename.split("/"),l=s.pop();s.forEach(c=>a=a.getChildByName(c)||new t(this.fs,c,null,a)),i.directory||Hl(a,l,{data:i,Reader:PH(Object.assign({},r))})})}async exportZip(e,r){let n=this;await aL(n),await e.init();let o=new uu(e,r);return await FH(o,n,NH([n],"uncompressedSize"),r),await o.close(),e.getData()}getChildByName(e){let r=this.children;for(let n=0;n<r.length;n++){let o=r[n];if(o.name==e)return o}}},hO=class{constructor(){Mg(this)}get children(){return this.root.children}remove(e){oL(e),this.entries[e.id]=null}move(e,r){if(e==this.root)throw new Error("Root directory cannot be moved");if(r.directory){if(r.isDescendantOf(e))throw new Error("Entry is a ancestor of target entry");if(e!=r){if(r.getChildByName(e.name))throw new Error("Entry filename already exists");oL(e),e.parent=r,r.children.push(e)}}else throw new Error("Target entry is not a directory")}find(e){let r=e.split("/"),n=this.root;for(let o=0;n&&o<r.length;o++)n=n.getChildByName(r[o]);return n}getById(e){return this.entries[e]}getChildByName(e){return this.root.getChildByName(e)}addDirectory(e){return this.root.addDirectory(e)}addText(e,r){return this.root.addText(e,r)}addBlob(e,r){return this.root.addBlob(e,r)}addData64URI(e,r){return this.root.addData64URI(e,r)}addHttpContent(e,r,n){return this.root.addHttpContent(e,r,n)}addFileSystemEntry(e){return this.root.addFileSystemEntry(e)}addData(e,r){return this.root.addData(e,r)}async importBlob(e,r){Mg(this),await this.root.importBlob(e,r)}async importData64URI(e,r){Mg(this),await this.root.importData64URI(e,r)}async importHttpContent(e,r){Mg(this),await this.root.importHttpContent(e,r)}exportBlob(e){return this.root.exportBlob(e)}exportData64URI(e){return this.root.exportData64URI(e)}},iL={FS:hO,ZipDirectoryEntry:f_,ZipFileEntry:Gg}});var wH,lL,cL=Jt(()=>{s_();Ow();aC();Pw();__();Sg();nO();_O();sL();wH={};try{lL=wH.url}catch{}Kc({baseURL:lL});Cw(Kc)});var Ug={};ya(Ug,{BlobReader:()=>hs,BlobWriter:()=>ha,Data64URIReader:()=>Gl,Data64URIWriter:()=>Hs,ERR_ABORT:()=>Tg,ERR_BAD_FORMAT:()=>h_,ERR_CENTRAL_DIRECTORY_NOT_FOUND:()=>JC,ERR_DUPLICATED_NAME:()=>aO,ERR_ENCRYPTED:()=>tO,ERR_EOCDR_LOCATOR_ZIP64_NOT_FOUND:()=>ZC,ERR_EOCDR_NOT_FOUND:()=>XC,ERR_EOCDR_ZIP64_NOT_FOUND:()=>jC,ERR_EXTRAFIELD_ZIP64_NOT_FOUND:()=>eO,ERR_HTTP_RANGE:()=>gg,ERR_INVALID_COMMENT:()=>sO,ERR_INVALID_ENCRYPTION_STRENGTH:()=>dO,ERR_INVALID_ENTRY_COMMENT:()=>lO,ERR_INVALID_ENTRY_NAME:()=>cO,ERR_INVALID_EXTRAFIELD_DATA:()=>pO,ERR_INVALID_EXTRAFIELD_TYPE:()=>uO,ERR_INVALID_PASSWORD:()=>Ll,ERR_INVALID_SIGNATURE:()=>au,ERR_INVALID_VERSION:()=>wg,ERR_LOCAL_FILE_HEADER_NOT_FOUND:()=>$C,ERR_NOT_SEEKABLE_READER:()=>OC,ERR_UNSUPPORTED_COMPRESSION:()=>Fg,ERR_UNSUPPORTED_ENCRYPTION:()=>rO,ERR_UNSUPPORTED_FORMAT:()=>m_,HttpRangeReader:()=>fg,HttpReader:()=>Ul,ReadableStreamReader:()=>hg,Reader:()=>zi,TextReader:()=>Yc,TextWriter:()=>Bl,Uint8ArrayReader:()=>Vl,Uint8ArrayWriter:()=>zs,WritableStreamWriter:()=>mg,Writer:()=>ks,ZipReader:()=>du,ZipWriter:()=>uu,configure:()=>Kc,fs:()=>iL,getMimeType:()=>tw,initShimAsyncCodec:()=>IC,terminateWorkers:()=>EC});var Vg=Jt(()=>{Fx();ew();s_();rw();__();cL();Kc({Deflate:Px,Inflate:$x})});var hL=rc((fO,gO)=>{(function(t,e){typeof fO=="object"&&typeof gO<"u"?gO.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(fO,function(){"use strict";function t(m,A,S,T,R){(function b(O,f,I,y,P){for(;y>I;){if(y-I>600){var E=y-I+1,C=f-I+1,B=Math.log(E),G=.5*Math.exp(2*B/3),V=.5*Math.sqrt(B*G*(E-G)/E)*(C-E/2<0?-1:1),D=Math.max(I,Math.floor(f-C*G/E+V)),w=Math.min(y,Math.floor(f+(E-C)*G/E+V));b(O,f,D,w,P)}var k=O[f],z=I,H=y;for(e(O,I,f),P(O[y],k)>0&&e(O,I,y);z<H;){for(e(O,z,H),z++,H--;P(O[z],k)<0;)z++;for(;P(O[H],k)>0;)H--}P(O[I],k)===0?e(O,I,H):e(O,++H,y),H<=f&&(I=H+1),f<=H&&(y=H-1)}})(m,A,S||0,T||m.length-1,R||r)}function e(m,A,S){var T=m[A];m[A]=m[S],m[S]=T}function r(m,A){return m<A?-1:m>A?1:0}var n=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(m,A,S){if(!S)return A.indexOf(m);for(var T=0;T<A.length;T++)if(S(m,A[T]))return T;return-1}function i(m,A){a(m,0,m.children.length,A,m)}function a(m,A,S,T,R){R||(R=h(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var b=A;b<S;b++){var O=m.children[b];s(R,m.leaf?T(O):O)}return R}function s(m,A){return m.minX=Math.min(m.minX,A.minX),m.minY=Math.min(m.minY,A.minY),m.maxX=Math.max(m.maxX,A.maxX),m.maxY=Math.max(m.maxY,A.maxY),m}function l(m,A){return m.minX-A.minX}function c(m,A){return m.minY-A.minY}function d(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function u(m){return m.maxX-m.minX+(m.maxY-m.minY)}function p(m,A){return m.minX<=A.minX&&m.minY<=A.minY&&A.maxX<=m.maxX&&A.maxY<=m.maxY}function _(m,A){return A.minX<=m.maxX&&A.minY<=m.maxY&&A.maxX>=m.minX&&A.maxY>=m.minY}function h(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(m,A,S,T,R){for(var b=[A,S];b.length;)if(!((S=b.pop())-(A=b.pop())<=T)){var O=A+Math.ceil((S-A)/T/2)*T;t(m,O,A,S,R),b.push(A,O,O,S)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(m){var A=this.data,S=[];if(!_(m,A))return S;for(var T=this.toBBox,R=[];A;){for(var b=0;b<A.children.length;b++){var O=A.children[b],f=A.leaf?T(O):O;_(m,f)&&(A.leaf?S.push(O):p(m,f)?this._all(O,S):R.push(O))}A=R.pop()}return S},n.prototype.collides=function(m){var A=this.data;if(!_(m,A))return!1;for(var S=[];A;){for(var T=0;T<A.children.length;T++){var R=A.children[T],b=A.leaf?this.toBBox(R):R;if(_(m,b)){if(A.leaf||p(m,b))return!0;S.push(R)}}A=S.pop()}return!1},n.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var A=0;A<m.length;A++)this.insert(m[A]);return this}var S=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===S.height)this._splitRoot(this.data,S);else{if(this.data.height<S.height){var T=this.data;this.data=S,S=T}this._insert(S,this.data.height-S.height-1,!0)}else this.data=S;return this},n.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},n.prototype.clear=function(){return this.data=h([]),this},n.prototype.remove=function(m,A){if(!m)return this;for(var S,T,R,b=this.data,O=this.toBBox(m),f=[],I=[];b||f.length;){if(b||(b=f.pop(),T=f[f.length-1],S=I.pop(),R=!0),b.leaf){var y=o(m,b.children,A);if(y!==-1)return b.children.splice(y,1),f.push(b),this._condense(f),this}R||b.leaf||!p(b,O)?T?(S++,b=T.children[S],R=!1):b=null:(f.push(b),I.push(S),S=0,T=b,b=b.children[0])}return this},n.prototype.toBBox=function(m){return m},n.prototype.compareMinX=function(m,A){return m.minX-A.minX},n.prototype.compareMinY=function(m,A){return m.minY-A.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(m){return this.data=m,this},n.prototype._all=function(m,A){for(var S=[];m;)m.leaf?A.push.apply(A,m.children):S.push.apply(S,m.children),m=S.pop();return A},n.prototype._build=function(m,A,S,T){var R,b=S-A+1,O=this._maxEntries;if(b<=O)return i(R=h(m.slice(A,S+1)),this.toBBox),R;T||(T=Math.ceil(Math.log(b)/Math.log(O)),O=Math.ceil(b/Math.pow(O,T-1))),(R=h([])).leaf=!1,R.height=T;var f=Math.ceil(b/O),I=f*Math.ceil(Math.sqrt(O));g(m,A,S,I,this.compareMinX);for(var y=A;y<=S;y+=I){var P=Math.min(y+I-1,S);g(m,y,P,f,this.compareMinY);for(var E=y;E<=P;E+=f){var C=Math.min(E+f-1,P);R.children.push(this._build(m,E,C,T-1))}}return i(R,this.toBBox),R},n.prototype._chooseSubtree=function(m,A,S,T){for(;T.push(A),!A.leaf&&T.length-1!==S;){for(var R=1/0,b=1/0,O=void 0,f=0;f<A.children.length;f++){var I=A.children[f],y=d(I),P=(E=m,C=I,(Math.max(C.maxX,E.maxX)-Math.min(C.minX,E.minX))*(Math.max(C.maxY,E.maxY)-Math.min(C.minY,E.minY))-y);P<b?(b=P,R=y<R?y:R,O=I):P===b&&y<R&&(R=y,O=I)}A=O||A.children[0]}var E,C;return A},n.prototype._insert=function(m,A,S){var T=S?m:this.toBBox(m),R=[],b=this._chooseSubtree(T,this.data,A,R);for(b.children.push(m),s(b,T);A>=0&&R[A].children.length>this._maxEntries;)this._split(R,A),A--;this._adjustParentBBoxes(T,R,A)},n.prototype._split=function(m,A){var S=m[A],T=S.children.length,R=this._minEntries;this._chooseSplitAxis(S,R,T);var b=this._chooseSplitIndex(S,R,T),O=h(S.children.splice(b,S.children.length-b));O.height=S.height,O.leaf=S.leaf,i(S,this.toBBox),i(O,this.toBBox),A?m[A-1].children.push(O):this._splitRoot(S,O)},n.prototype._splitRoot=function(m,A){this.data=h([m,A]),this.data.height=m.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(m,A,S){for(var T,R,b,O,f,I,y,P=1/0,E=1/0,C=A;C<=S-A;C++){var B=a(m,0,C,this.toBBox),G=a(m,C,S,this.toBBox),V=(R=B,b=G,O=void 0,f=void 0,I=void 0,y=void 0,O=Math.max(R.minX,b.minX),f=Math.max(R.minY,b.minY),I=Math.min(R.maxX,b.maxX),y=Math.min(R.maxY,b.maxY),Math.max(0,I-O)*Math.max(0,y-f)),D=d(B)+d(G);V<P?(P=V,T=C,E=D<E?D:E):V===P&&D<E&&(E=D,T=C)}return T||S-A},n.prototype._chooseSplitAxis=function(m,A,S){var T=m.leaf?this.compareMinX:l,R=m.leaf?this.compareMinY:c;this._allDistMargin(m,A,S,T)<this._allDistMargin(m,A,S,R)&&m.children.sort(T)},n.prototype._allDistMargin=function(m,A,S,T){m.children.sort(T);for(var R=this.toBBox,b=a(m,0,A,R),O=a(m,S-A,S,R),f=u(b)+u(O),I=A;I<S-A;I++){var y=m.children[I];s(b,m.leaf?R(y):y),f+=u(b)}for(var P=S-A-1;P>=A;P--){var E=m.children[P];s(O,m.leaf?R(E):E),f+=u(O)}return f},n.prototype._adjustParentBBoxes=function(m,A,S){for(var T=S;T>=0;T--)s(A[T],m)},n.prototype._condense=function(m){for(var A=m.length-1,S=void 0;A>=0;A--)m[A].children.length===0?A>0?(S=m[A-1].children).splice(S.indexOf(m[A]),1):this.clear():i(m[A],this.toBBox)},n})});var fL=rc(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.reservedNames=Ys.nativeTypes=void 0;Ys.parseSchema=ZH;var mn=(pd(),Oi(YN));Ys.nativeTypes=["bool","byte","float","int","string","uint","int64","uint64"];Ys.reservedNames=["ByteBuffer","package"];var LH=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,Xg=/^[A-Za-z_][A-Za-z0-9_]*$/,MH=/^\/\/.*|\s+$/,BH=/^=$/,GH=/^$/,mL=/^;$/,UH=/^-?\d+$/,VH=/^\{$/,kH=/^\}$/,HH=/^\[\]$/,zH=/^enum$/,WH=/^struct$/,KH=/^message$/,YH=/^package$/,QH=/^\[deprecated\]$/;function qH(t){let e=t.split(LH),r=[],n=0,o=0;for(let[i,a]of e.entries()){i&1?MH.test(a)||r.push({text:a,line:o+1,column:n+1}):a!==""&&(0,mn.error)("Syntax error "+(0,mn.quote)(a),o+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),o+=s.length-1,n+=s[s.length-1].length}return r.push({text:"",line:o,column:n}),r}function XH(t){function e(){return t[s]}function r(l){return l.test(e().text)?(s++,!0):!1}function n(l,c){if(!r(l)){let d=e();(0,mn.error)("Expected "+c+" but found "+(0,mn.quote)(d.text),d.line,d.column)}}function o(){let l=e();(0,mn.error)("Unexpected token "+(0,mn.quote)(l.text),l.line,l.column)}let i=[],a=null,s=0;for(r(YH)&&(a=e().text,n(Xg,"identifier"),n(mL,'";"'));s<t.length&&!r(GH);){let l=[],c;r(zH)?c="ENUM":r(WH)?c="STRUCT":r(KH)?c="MESSAGE":o();let d=e();for(n(Xg,"identifier"),n(VH,'"{"');!r(kH);){let u=null,p=!1,_=!1;c!=="ENUM"&&(u=e().text,n(Xg,"identifier"),p=r(HH));let h=e();n(Xg,"identifier");let g=null;c!=="STRUCT"&&(n(BH,'"="'),g=e(),n(UH,"integer"),(+g.text|0)+""!==g.text&&(0,mn.error)("Invalid integer "+(0,mn.quote)(g.text),g.line,g.column));let m=e();r(QH)&&(c!=="MESSAGE"&&(0,mn.error)("Cannot deprecate this field",m.line,m.column),_=!0),n(mL,'";"'),l.push({name:h.text,line:h.line,column:h.column,type:u,isArray:p,isDeprecated:_,value:g!==null?+g.text|0:l.length+1})}i.push({name:d.text,line:d.line,column:d.column,kind:c,fields:l})}return{package:a,definitions:i}}function jH(t){let e=Ys.nativeTypes.slice(),r={};for(let i of t.definitions)e.indexOf(i.name)!==-1&&(0,mn.error)("The type "+(0,mn.quote)(i.name)+" is defined twice",i.line,i.column),Ys.reservedNames.indexOf(i.name)!==-1&&(0,mn.error)("The type name "+(0,mn.quote)(i.name)+" is reserved",i.line,i.column),e.push(i.name),r[i.name]=i;for(let i of t.definitions){let a=i.fields;if(i.kind==="ENUM"||a.length===0)continue;for(let l of a)e.indexOf(l.type)===-1&&(0,mn.error)("The type "+(0,mn.quote)(l.type)+" is not defined for field "+(0,mn.quote)(l.name),l.line,l.column);let s=[];for(let l of a)s.indexOf(l.value)!==-1&&(0,mn.error)("The id for field "+(0,mn.quote)(l.name)+" is used twice",l.line,l.column),l.value<=0&&(0,mn.error)("The id for field "+(0,mn.quote)(l.name)+" must be positive",l.line,l.column),l.value>a.length&&(0,mn.error)("The id for field "+(0,mn.quote)(l.name)+" cannot be larger than "+a.length,l.line,l.column),s.push(l.value)}let n={},o=i=>{let a=r[i];if(a&&a.kind==="STRUCT"&&(n[i]===1&&(0,mn.error)("Recursive nesting of "+(0,mn.quote)(i)+" is not allowed",a.line,a.column),n[i]!==2&&a)){n[i]=1;for(let s of a.fields)s.isArray||o(s.type);n[i]=2}return!0};for(let i of t.definitions)o(i.name)}function ZH(t){let e=XH(qH(t));return jH(e),e}});var LL=rc((Q_,UO)=>{(function(e,r){typeof Q_=="object"&&typeof UO=="object"?UO.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Q_=="object"?Q_.JsDiff=r():e.JsDiff=r()})(Q_,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}return r.m=t,r.c=e,r.p="",r(0)}([function(t,e,r){"use strict";e.__esModule=!0,e.canonicalize=e.convertChangesToXML=e.convertChangesToDMP=e.merge=e.parsePatch=e.applyPatches=e.applyPatch=e.createPatch=e.createTwoFilesPatch=e.structuredPatch=e.diffArrays=e.diffJson=e.diffCss=e.diffSentences=e.diffTrimmedLines=e.diffLines=e.diffWordsWithSpace=e.diffWords=e.diffChars=e.Diff=void 0;var n=r(1),o=S(n),i=r(2),a=r(3),s=r(5),l=r(6),c=r(7),d=r(8),u=r(9),p=r(10),_=r(11),h=r(13),g=r(14),m=r(16),A=r(17);function S(T){return T&&T.__esModule?T:{default:T}}e.Diff=o.default,e.diffChars=i.diffChars,e.diffWords=a.diffWords,e.diffWordsWithSpace=a.diffWordsWithSpace,e.diffLines=s.diffLines,e.diffTrimmedLines=s.diffTrimmedLines,e.diffSentences=l.diffSentences,e.diffCss=c.diffCss,e.diffJson=d.diffJson,e.diffArrays=u.diffArrays,e.structuredPatch=g.structuredPatch,e.createTwoFilesPatch=g.createTwoFilesPatch,e.createPatch=g.createPatch,e.applyPatch=p.applyPatch,e.applyPatches=p.applyPatches,e.parsePatch=_.parsePatch,e.merge=h.merge,e.convertChangesToDMP=m.convertChangesToDMP,e.convertChangesToXML=A.convertChangesToXML,e.canonicalize=d.canonicalize},function(t,e){"use strict";e.__esModule=!0,e.default=r;function r(){}r.prototype={diff:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=l.callback;typeof l=="function"&&(c=l,l={}),this.options=l;var d=this;function u(R){return c?(setTimeout(function(){c(void 0,R)},0),!0):R}a=this.castInput(a),s=this.castInput(s),a=this.removeEmpty(this.tokenize(a)),s=this.removeEmpty(this.tokenize(s));var p=s.length,_=a.length,h=1,g=p+_,m=[{newPos:-1,components:[]}],A=this.extractCommon(m[0],s,a,0);if(m[0].newPos+1>=p&&A+1>=_)return u([{value:this.join(s),count:s.length}]);function S(){for(var R=-1*h;R<=h;R+=2){var b=void 0,O=m[R-1],f=m[R+1],I=(f?f.newPos:0)-R;O&&(m[R-1]=void 0);var y=O&&O.newPos+1<p,P=f&&0<=I&&I<_;if(!y&&!P){m[R]=void 0;continue}if(!y||P&&O.newPos<f.newPos?(b=o(f),d.pushComponent(b.components,void 0,!0)):(b=O,b.newPos++,d.pushComponent(b.components,!0,void 0)),I=d.extractCommon(b,s,a,R),b.newPos+1>=p&&I+1>=_)return u(n(d,b.components,s,a,d.useLongestToken));m[R]=b}h++}if(c)(function R(){setTimeout(function(){if(h>g)return c();S()||R()},0)})();else for(;h<=g;){var T=S();if(T)return T}},pushComponent:function(a,s,l){var c=a[a.length-1];c&&c.added===s&&c.removed===l?a[a.length-1]={count:c.count+1,added:s,removed:l}:a.push({count:1,added:s,removed:l})},extractCommon:function(a,s,l,c){for(var d=s.length,u=l.length,p=a.newPos,_=p-c,h=0;p+1<d&&_+1<u&&this.equals(s[p+1],l[_+1]);)p++,_++,h++;return h&&a.components.push({count:h}),a.newPos=p,_},equals:function(a,s){return this.options.comparator?this.options.comparator(a,s):a===s||this.options.ignoreCase&&a.toLowerCase()===s.toLowerCase()},removeEmpty:function(a){for(var s=[],l=0;l<a.length;l++)a[l]&&s.push(a[l]);return s},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function n(i,a,s,l,c){for(var d=0,u=a.length,p=0,_=0;d<u;d++){var h=a[d];if(h.removed){if(h.value=i.join(l.slice(_,_+h.count)),_+=h.count,d&&a[d-1].added){var m=a[d-1];a[d-1]=a[d],a[d]=m}}else{if(!h.added&&c){var g=s.slice(p,p+h.count);g=g.map(function(S,T){var R=l[_+T];return R.length>S.length?R:S}),h.value=i.join(g)}else h.value=i.join(s.slice(p,p+h.count));p+=h.count,h.added||(_+=h.count)}}var A=a[u-1];return u>1&&typeof A.value=="string"&&(A.added||A.removed)&&i.equals("",A.value)&&(a[u-2].value+=A.value,a.pop()),a}function o(i){return{newPos:i.newPos,components:i.components.slice(0)}}},function(t,e,r){"use strict";e.__esModule=!0,e.characterDiff=void 0,e.diffChars=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.characterDiff=new o.default;function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.wordDiff=void 0,e.diffWords=d,e.diffWordsWithSpace=u;var n=r(1),o=a(n),i=r(4);function a(p){return p&&p.__esModule?p:{default:p}}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,c=e.wordDiff=new o.default;c.equals=function(p,_){return this.options.ignoreCase&&(p=p.toLowerCase(),_=_.toLowerCase()),p===_||this.options.ignoreWhitespace&&!l.test(p)&&!l.test(_)},c.tokenize=function(p){for(var _=p.split(/(\s+|\b)/),h=0;h<_.length-1;h++)!_[h+1]&&_[h+2]&&s.test(_[h])&&s.test(_[h+2])&&(_[h]+=_[h+2],_.splice(h+1,2),h--);return _};function d(p,_,h){return h=(0,i.generateOptions)(h,{ignoreWhitespace:!0}),c.diff(p,_,h)}function u(p,_,h){return c.diff(p,_,h)}},function(t,e){"use strict";e.__esModule=!0,e.generateOptions=r;function r(n,o){if(typeof n=="function")o.callback=n;else if(n)for(var i in n)n.hasOwnProperty(i)&&(o[i]=n[i]);return o}},function(t,e,r){"use strict";e.__esModule=!0,e.lineDiff=void 0,e.diffLines=l,e.diffTrimmedLines=c;var n=r(1),o=a(n),i=r(4);function a(d){return d&&d.__esModule?d:{default:d}}var s=e.lineDiff=new o.default;s.tokenize=function(d){var u=[],p=d.split(/(\n|\r\n)/);p[p.length-1]||p.pop();for(var _=0;_<p.length;_++){var h=p[_];_%2&&!this.options.newlineIsToken?u[u.length-1]+=h:(this.options.ignoreWhitespace&&(h=h.trim()),u.push(h))}return u};function l(d,u,p){return s.diff(d,u,p)}function c(d,u,p){var _=(0,i.generateOptions)(p,{ignoreWhitespace:!0});return s.diff(d,u,_)}},function(t,e,r){"use strict";e.__esModule=!0,e.sentenceDiff=void 0,e.diffSentences=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.sentenceDiff=new o.default;a.tokenize=function(l){return l.split(/(\S.+?[.!?])(?=\s+|$)/)};function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.cssDiff=void 0,e.diffCss=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.cssDiff=new o.default;a.tokenize=function(l){return l.split(/([{}:;,]|\s+)/)};function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.jsonDiff=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p};e.diffJson=d,e.canonicalize=u;var o=r(1),i=s(o),a=r(5);function s(p){return p&&p.__esModule?p:{default:p}}var l=Object.prototype.toString,c=e.jsonDiff=new i.default;c.useLongestToken=!0,c.tokenize=a.lineDiff.tokenize,c.castInput=function(p){var _=this.options,h=_.undefinedReplacement,g=_.stringifyReplacer,m=g===void 0?function(A,S){return typeof S>"u"?h:S}:g;return typeof p=="string"?p:JSON.stringify(u(p,null,null,m),m,"  ")},c.equals=function(p,_){return i.default.prototype.equals.call(c,p.replace(/,([\r\n])/g,"$1"),_.replace(/,([\r\n])/g,"$1"))};function d(p,_,h){return c.diff(p,_,h)}function u(p,_,h,g,m){_=_||[],h=h||[],g&&(p=g(m,p));var A=void 0;for(A=0;A<_.length;A+=1)if(_[A]===p)return h[A];var S=void 0;if(l.call(p)==="[object Array]"){for(_.push(p),S=new Array(p.length),h.push(S),A=0;A<p.length;A+=1)S[A]=u(p[A],_,h,g,m);return _.pop(),h.pop(),S}if(p&&p.toJSON&&(p=p.toJSON()),(typeof p>"u"?"undefined":n(p))==="object"&&p!==null){_.push(p),S={},h.push(S);var T=[],R=void 0;for(R in p)p.hasOwnProperty(R)&&T.push(R);for(T.sort(),A=0;A<T.length;A+=1)R=T[A],S[R]=u(p[R],_,h,g,R);_.pop(),h.pop()}else S=p;return S}},function(t,e,r){"use strict";e.__esModule=!0,e.arrayDiff=void 0,e.diffArrays=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.arrayDiff=new o.default;a.tokenize=function(l){return l.slice()},a.join=a.removeEmpty=function(l){return l};function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.applyPatch=s,e.applyPatches=l;var n=r(11),o=r(12),i=a(o);function a(c){return c&&c.__esModule?c:{default:c}}function s(c,d){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof d=="string"&&(d=(0,n.parsePatch)(d)),Array.isArray(d)){if(d.length>1)throw new Error("applyPatch only works with a single input.");d=d[0]}var p=c.split(/\r\n|[\n\v\f\r\x85]/),_=c.match(/\r\n|[\n\v\f\r\x85]/g)||[],h=d.hunks,g=u.compareLine||function(J,ie,Ee,Ke){return ie===Ke},m=0,A=u.fuzzFactor||0,S=0,T=0,R=void 0,b=void 0;function O(J,ie){for(var Ee=0;Ee<J.lines.length;Ee++){var Ke=J.lines[Ee],Ve=Ke.length>0?Ke[0]:" ",at=Ke.length>0?Ke.substr(1):Ke;if(Ve===" "||Ve==="-"){if(!g(ie+1,p[ie],Ve,at)&&(m++,m>A))return!1;ie++}}return!0}for(var f=0;f<h.length;f++){for(var I=h[f],y=p.length-I.oldLines,P=0,E=T+I.oldStart-1,C=(0,i.default)(E,S,y);P!==void 0;P=C())if(O(I,E+P)){I.offset=T+=P;break}if(P===void 0)return!1;S=I.offset+I.oldStart+I.oldLines}for(var B=0,G=0;G<h.length;G++){var V=h[G],D=V.oldStart+V.offset+B-1;B+=V.newLines-V.oldLines,D<0&&(D=0);for(var w=0;w<V.lines.length;w++){var k=V.lines[w],z=k.length>0?k[0]:" ",H=k.length>0?k.substr(1):k,K=V.linedelimiters[w];if(z===" ")D++;else if(z==="-")p.splice(D,1),_.splice(D,1);else if(z==="+")p.splice(D,0,H),_.splice(D,0,K),D++;else if(z==="\\"){var j=V.lines[w-1]?V.lines[w-1][0]:null;j==="+"?R=!0:j==="-"&&(b=!0)}}}if(R)for(;!p[p.length-1];)p.pop(),_.pop();else b&&(p.push(""),_.push(`
`));for(var q=0;q<p.length-1;q++)p[q]=p[q]+_[q];return p.join("")}function l(c,d){typeof c=="string"&&(c=(0,n.parsePatch)(c));var u=0;function p(){var _=c[u++];if(!_)return d.complete();d.loadFile(_,function(h,g){if(h)return d.complete(h);var m=s(g,_,d);d.patched(_,m,function(A){if(A)return d.complete(A);p()})})}p()}},function(t,e){"use strict";e.__esModule=!0,e.parsePatch=r;function r(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.split(/\r\n|[\n\v\f\r\x85]/),a=n.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],l=0;function c(){var p={};for(s.push(p);l<i.length;){var _=i[l];if(/^(\-\-\-|\+\+\+|@@)\s/.test(_))break;var h=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(_);h&&(p.index=h[1]),l++}for(d(p),d(p),p.hunks=[];l<i.length;){var g=i[l];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(g))break;if(/^@@/.test(g))p.hunks.push(u());else{if(g&&o.strict)throw new Error("Unknown line "+(l+1)+" "+JSON.stringify(g));l++}}}function d(p){var _=/^(---|\+\+\+)\s+(.*)$/.exec(i[l]);if(_){var h=_[1]==="---"?"old":"new",g=_[2].split("	",2),m=g[0].replace(/\\\\/g,"\\");/^".*"$/.test(m)&&(m=m.substr(1,m.length-2)),p[h+"FileName"]=m,p[h+"Header"]=(g[1]||"").trim(),l++}}function u(){for(var p=l,_=i[l++],h=_.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),g={oldStart:+h[1],oldLines:+h[2]||1,newStart:+h[3],newLines:+h[4]||1,lines:[],linedelimiters:[]},m=0,A=0;l<i.length&&!(i[l].indexOf("--- ")===0&&l+2<i.length&&i[l+1].indexOf("+++ ")===0&&i[l+2].indexOf("@@")===0);l++){var S=i[l].length==0&&l!=i.length-1?" ":i[l][0];if(S==="+"||S==="-"||S===" "||S==="\\")g.lines.push(i[l]),g.linedelimiters.push(a[l]||`
`),S==="+"?m++:S==="-"?A++:S===" "&&(m++,A++);else break}if(!m&&g.newLines===1&&(g.newLines=0),!A&&g.oldLines===1&&(g.oldLines=0),o.strict){if(m!==g.newLines)throw new Error("Added line count did not match for hunk at line "+(p+1));if(A!==g.oldLines)throw new Error("Removed line count did not match for hunk at line "+(p+1))}return g}for(;l<i.length;)c();return s}},function(t,e){"use strict";e.__esModule=!0,e.default=function(r,n,o){var i=!0,a=!1,s=!1,l=1;return function c(){if(i&&!s){if(a?l++:i=!1,r+l<=o)return l;s=!0}if(!a)return s||(i=!0),n<=r-l?-l++:(a=!0,c())}}},function(t,e,r){"use strict";e.__esModule=!0,e.calcLineCount=s,e.merge=l;var n=r(14),o=r(11),i=r(15);function a(y){if(Array.isArray(y)){for(var P=0,E=Array(y.length);P<y.length;P++)E[P]=y[P];return E}else return Array.from(y)}function s(y){var P=I(y.lines),E=P.oldLines,C=P.newLines;E!==void 0?y.oldLines=E:delete y.oldLines,C!==void 0?y.newLines=C:delete y.newLines}function l(y,P,E){y=c(y,E),P=c(P,E);var C={};(y.index||P.index)&&(C.index=y.index||P.index),(y.newFileName||P.newFileName)&&(d(y)?d(P)?(C.oldFileName=u(C,y.oldFileName,P.oldFileName),C.newFileName=u(C,y.newFileName,P.newFileName),C.oldHeader=u(C,y.oldHeader,P.oldHeader),C.newHeader=u(C,y.newHeader,P.newHeader)):(C.oldFileName=y.oldFileName,C.newFileName=y.newFileName,C.oldHeader=y.oldHeader,C.newHeader=y.newHeader):(C.oldFileName=P.oldFileName||y.oldFileName,C.newFileName=P.newFileName||y.newFileName,C.oldHeader=P.oldHeader||y.oldHeader,C.newHeader=P.newHeader||y.newHeader)),C.hunks=[];for(var B=0,G=0,V=0,D=0;B<y.hunks.length||G<P.hunks.length;){var w=y.hunks[B]||{oldStart:1/0},k=P.hunks[G]||{oldStart:1/0};if(p(w,k))C.hunks.push(_(w,V)),B++,D+=w.newLines-w.oldLines;else if(p(k,w))C.hunks.push(_(k,D)),G++,V+=k.newLines-k.oldLines;else{var z={oldStart:Math.min(w.oldStart,k.oldStart),oldLines:0,newStart:Math.min(w.newStart+V,k.oldStart+D),newLines:0,lines:[]};h(z,w.oldStart,w.lines,k.oldStart,k.lines),G++,B++,C.hunks.push(z)}}return C}function c(y,P){if(typeof y=="string"){if(/^@@/m.test(y)||/^Index:/m.test(y))return(0,o.parsePatch)(y)[0];if(!P)throw new Error("Must provide a base reference or pass in a patch");return(0,n.structuredPatch)(void 0,void 0,P,y)}return y}function d(y){return y.newFileName&&y.newFileName!==y.oldFileName}function u(y,P,E){return P===E?P:(y.conflict=!0,{mine:P,theirs:E})}function p(y,P){return y.oldStart<P.oldStart&&y.oldStart+y.oldLines<P.oldStart}function _(y,P){return{oldStart:y.oldStart,oldLines:y.oldLines,newStart:y.newStart+P,newLines:y.newLines,lines:y.lines}}function h(y,P,E,C,B){var G={offset:P,lines:E,index:0},V={offset:C,lines:B,index:0};for(S(y,G,V),S(y,V,G);G.index<G.lines.length&&V.index<V.lines.length;){var D=G.lines[G.index],w=V.lines[V.index];if((D[0]==="-"||D[0]==="+")&&(w[0]==="-"||w[0]==="+"))g(y,G,V);else if(D[0]==="+"&&w[0]===" "){var k;(k=y.lines).push.apply(k,a(R(G)))}else if(w[0]==="+"&&D[0]===" "){var z;(z=y.lines).push.apply(z,a(R(V)))}else D[0]==="-"&&w[0]===" "?m(y,G,V):w[0]==="-"&&D[0]===" "?m(y,V,G,!0):D===w?(y.lines.push(D),G.index++,V.index++):A(y,R(G),R(V))}T(y,G),T(y,V),s(y)}function g(y,P,E){var C=R(P),B=R(E);if(O(C)&&O(B)){if((0,i.arrayStartsWith)(C,B)&&f(E,C,C.length-B.length)){var G;(G=y.lines).push.apply(G,a(C));return}else if((0,i.arrayStartsWith)(B,C)&&f(P,B,B.length-C.length)){var V;(V=y.lines).push.apply(V,a(B));return}}else if((0,i.arrayEqual)(C,B)){var D;(D=y.lines).push.apply(D,a(C));return}A(y,C,B)}function m(y,P,E,C){var B=R(P),G=b(E,B);if(G.merged){var V;(V=y.lines).push.apply(V,a(G.merged))}else A(y,C?G:B,C?B:G)}function A(y,P,E){y.conflict=!0,y.lines.push({conflict:!0,mine:P,theirs:E})}function S(y,P,E){for(;P.offset<E.offset&&P.index<P.lines.length;){var C=P.lines[P.index++];y.lines.push(C),P.offset++}}function T(y,P){for(;P.index<P.lines.length;){var E=P.lines[P.index++];y.lines.push(E)}}function R(y){for(var P=[],E=y.lines[y.index][0];y.index<y.lines.length;){var C=y.lines[y.index];if(E==="-"&&C[0]==="+"&&(E="+"),E===C[0])P.push(C),y.index++;else break}return P}function b(y,P){for(var E=[],C=[],B=0,G=!1,V=!1;B<P.length&&y.index<y.lines.length;){var D=y.lines[y.index],w=P[B];if(w[0]==="+")break;if(G=G||D[0]!==" ",C.push(w),B++,D[0]==="+")for(V=!0;D[0]==="+";)E.push(D),D=y.lines[++y.index];w.substr(1)===D.substr(1)?(E.push(D),y.index++):V=!0}if((P[B]||"")[0]==="+"&&G&&(V=!0),V)return E;for(;B<P.length;)C.push(P[B++]);return{merged:C,changes:E}}function O(y){return y.reduce(function(P,E){return P&&E[0]==="-"},!0)}function f(y,P,E){for(var C=0;C<E;C++){var B=P[P.length-E+C].substr(1);if(y.lines[y.index+C]!==" "+B)return!1}return y.index+=E,!0}function I(y){var P=0,E=0;return y.forEach(function(C){if(typeof C!="string"){var B=I(C.mine),G=I(C.theirs);P!==void 0&&(B.oldLines===G.oldLines?P+=B.oldLines:P=void 0),E!==void 0&&(B.newLines===G.newLines?E+=B.newLines:E=void 0)}else E!==void 0&&(C[0]==="+"||C[0]===" ")&&E++,P!==void 0&&(C[0]==="-"||C[0]===" ")&&P++}),{oldLines:P,newLines:E}}},function(t,e,r){"use strict";e.__esModule=!0,e.structuredPatch=i,e.createTwoFilesPatch=a,e.createPatch=s;var n=r(5);function o(l){if(Array.isArray(l)){for(var c=0,d=Array(l.length);c<l.length;c++)d[c]=l[c];return d}else return Array.from(l)}function i(l,c,d,u,p,_,h){h||(h={}),typeof h.context>"u"&&(h.context=4);var g=(0,n.diffLines)(d,u,h);g.push({value:"",lines:[]});function m(y){return y.map(function(P){return" "+P})}for(var A=[],S=0,T=0,R=[],b=1,O=1,f=function(P){var E=g[P],C=E.lines||E.value.replace(/\n$/,"").split(`
`);if(E.lines=C,E.added||E.removed){var B;if(!S){var G=g[P-1];S=b,T=O,G&&(R=h.context>0?m(G.lines.slice(-h.context)):[],S-=R.length,T-=R.length)}(B=R).push.apply(B,o(C.map(function(K){return(E.added?"+":"-")+K}))),E.added?O+=C.length:b+=C.length}else{if(S)if(C.length<=h.context*2&&P<g.length-2){var V;(V=R).push.apply(V,o(m(C)))}else{var D,w=Math.min(C.length,h.context);(D=R).push.apply(D,o(m(C.slice(0,w))));var k={oldStart:S,oldLines:b-S+w,newStart:T,newLines:O-T+w,lines:R};if(P>=g.length-2&&C.length<=h.context){var z=/\n$/.test(d),H=/\n$/.test(u);C.length==0&&!z?R.splice(k.oldLines,0,"\\ No newline at end of file"):(!z||!H)&&R.push("\\ No newline at end of file")}A.push(k),S=0,T=0,R=[]}b+=C.length,O+=C.length}},I=0;I<g.length;I++)f(I);return{oldFileName:l,newFileName:c,oldHeader:p,newHeader:_,hunks:A}}function a(l,c,d,u,p,_,h){var g=i(l,c,d,u,p,_,h),m=[];l==c&&m.push("Index: "+l),m.push("==================================================================="),m.push("--- "+g.oldFileName+(typeof g.oldHeader>"u"?"":"	"+g.oldHeader)),m.push("+++ "+g.newFileName+(typeof g.newHeader>"u"?"":"	"+g.newHeader));for(var A=0;A<g.hunks.length;A++){var S=g.hunks[A];m.push("@@ -"+S.oldStart+","+S.oldLines+" +"+S.newStart+","+S.newLines+" @@"),m.push.apply(m,S.lines)}return m.join(`
`)+`
`}function s(l,c,d,u,p,_){return a(l,l,c,d,u,p,_)}},function(t,e){"use strict";e.__esModule=!0,e.arrayEqual=r,e.arrayStartsWith=n;function r(o,i){return o.length!==i.length?!1:n(o,i)}function n(o,i){if(i.length>o.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==o[a])return!1;return!0}},function(t,e){"use strict";e.__esModule=!0,e.convertChangesToDMP=r;function r(n){for(var o=[],i=void 0,a=void 0,s=0;s<n.length;s++)i=n[s],i.added?a=1:i.removed?a=-1:a=0,o.push([a,i.value]);return o}},function(t,e){"use strict";e.__esModule=!0,e.convertChangesToXML=r;function r(o){for(var i=[],a=0;a<o.length;a++){var s=o[a];s.added?i.push("<ins>"):s.removed&&i.push("<del>"),i.push(n(s.value)),s.added?i.push("</ins>"):s.removed&&i.push("</del>")}return i.join("")}function n(o){var i=o;return i=i.replace(/&/g,"&amp;"),i=i.replace(/</g,"&lt;"),i=i.replace(/>/g,"&gt;"),i=i.replace(/"/g,"&quot;"),i}}])})});var BM=Ja(hd());var Hh=class{_statsigDelegate;setDelegate(e){this._statsigDelegate=e}clearDelegate(){this._statsigDelegate=void 0}getDynamicConfigBoolean(e,r,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigBoolean(e,r,n):n}getDynamicConfigNumber(e,r,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigNumber(e,r,n):n}getDynamicConfigString(e,r,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigString(e,r,n):n}getExperimentBoolean(e,r,n){return this._statsigDelegate?this._statsigDelegate.getExperimentBoolean(e,r,n):n}getExperimentNumber(e,r,n){return this._statsigDelegate?this._statsigDelegate.getExperimentNumber(e,r,n):n}getExperimentString(e,r,n){return this._statsigDelegate?this._statsigDelegate.getExperimentString(e,r,n):n}getFeatureGate(e){return this._statsigDelegate?this._statsigDelegate.getFeatureGate(e):!1}logFeatureGateExposure(e,r){this._statsigDelegate&&this._statsigDelegate.logFeatureGateExposure(e,r)}updateFeatureGateForTesting(e,r){this._statsigDelegate&&this._statsigDelegate.updateFeatureGateForTesting(e,r)}clearFeatureGatesForTesting(){this._statsigDelegate&&this._statsigDelegate.clearFeatureGatesForTesting()}setInRenderServerForViewerTests(){this._statsigDelegate&&this._statsigDelegate.setInRenderServerForViewerTests()}updateExperimentForTesting(e,r,n){this._statsigDelegate&&this._statsigDelegate.updateExperimentForTesting(e,r,n)}clearExperimentsForTesting(){this._statsigDelegate&&this._statsigDelegate.clearExperimentsForTesting()}};var Bt=new Hh;var Fr;(e=>{function t(r,n,o){return r<n?n:r>o?o:r}e.Math_clamp=t})(Fr||(Fr={}));var md=t=>t===(t|0);var zh;(n=>{function t(i,a){let s=0;switch(a){case 0:{for(let l of i)l<128?s=s+1:l<2048?s=s+2:l<65536?s=s+3:s=s+4;break}case 1:{for(let l of i)l<65536?s=s+1:s=s+2;break}case 2:{s=i.length;break}}return s}n.codeUnitCountForCodePoints=t;let e;(l=>(l[l.UTF8=0]="UTF8",l[l.UTF16=1]="UTF16",l[l.UTF32=2]="UTF32"))(e=n.Encoding||(n.Encoding={}));let o=class o{reset(a,s){return this.value=a,this.index=s,this.stop=a.length,this}countCodePointsUntil(a){let s=0;for(;this.index<a&&this.nextCodePoint()>=0;)s=s+1;return s}previousCodePoint(){if(this.index<=0)return-1;let a=this.value.charCodeAt(this.index=this.index-1);return(a&64512)!=56320?a:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+a+-56613888}nextCodePoint(){if(this.index>=this.stop)return-1;let a=this.value.charCodeAt((this.index=this.index+1)+-1);if((a&64512)!=55296)return a;if(this.index>=this.stop)return-1;let s=this.value.charCodeAt((this.index=this.index+1)+-1);return(a<<10)+s+-56613888}constructor(){this.value="",this.index=0,this.stop=0}};o.INSTANCE=new o;let r=o;n.StringIterator=o})(zh||(zh={}));var fe=class{static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:e.value==r.value}constructor(e){this.value=e}},b1=1e5;function ln(t,e){if(e!=t,e.length<b1){t.push(...e);return}for(let r of e)t.push(r)}function v1(t,e,r){if(r!=t,r.length<b1){t.splice(e,0,...r);return}for(let n of r)t.splice(e,0,n),e=e+1}var le;(c=>{function t(d){d.length!=0,d.pop()}c.List_removeLast=t;function e(d){let u=0;for(let p=0,_=d.length;p<_;p=p+1){let h=!1,g=d[p];for(let m=0;m<p;m=m+1)if(g==d[m]){h=!0;break}h||(u<p&&(d[u]=d[p]),u=u+1)}for(;u<d.length;)t(d)}c.List_removeDuplicates=e;function r(d){return d.length!=0,d[d.length-1]}c.List_last=r;function n(d,u){d.indexOf(u)==-1&&d.push(u)}c.List_appendOne=n;function o(d,u){let p=d.indexOf(u);p>=0&&d.splice(p,1)}c.List_removeOne=o;function i(d,u){let p=0;for(let _=0,h=d.length;_<h;_=_+1)u(d[_])||(p<_&&(d[p]=d[_]),p=p+1);for(;p<d.length;)t(d)}c.List_removeIf=i;function a(d,u){if(d.length!=u.length)return!1;for(let p=0,_=d.length;p<_;p=p+1)if(d[p]!=u[p])return!1;return!0}c.List_equals=a;function s(d,u){let p=d.slice();return p.push(u),p}c.List_cloneAndAppend=s;function l(d,u,p){if(d==null!=(u==null))return!1;if(d==null)return!0;if(d.length==u.length){for(let _=0,h=d.length;_<h;_=_+1)if(!p(d[_],u[_]))return!1;return!0}return!1}c.List_equalsWithComparison=l})(le||(le={}));var qe;(n=>{function t(o,i,a){let s=o.get(i);return s!==void 0?s:a}n.StringMap_get=t;function e(o,i){o.forEach((a,s)=>{i(s,a)})}n.StringMap_each=e;function r(o){let i={};return e(o,(a,s)=>{i[a]=s}),i}n.StringMap_toJSObject=r})(qe||(qe={}));var nr;(r=>{function t(n,o,i){let a=n.get(o);return a!==void 0?a:i}r.IntMap_get=t;function e(n,o){n.forEach((i,a)=>{o(a,i)})}r.IntMap_each=e})(nr||(nr={}));var Ut;(r=>{function t(n,o){return(o<n?1:0)-(o>n?1:0)}r.int_compare=t;function e(n,o){return n%o|0}r.int_remainder=e})(Ut||(Ut={}));var Ye;(n=>{function t(o,i){return(i<o?1:0)-(i>o?1:0)}n.double_compare=t;function e(o,i,a){return o*(1-a)+i*a}n.double_lerp=e;function r(o,i,a){return Math.min(Math.max(o,i),a)}n.double_clamp=r})(Ye||(Ye={}));var Pi;(i=>{function t(a){let s="";for(let l of a)s+=o(l);return s}i.string_fromCodePoints=t;function e(a,s){return(s<a|0)-(s>a|0)}i.string_compare=e;function r(a){let s="";for(let l of a)s+=String.fromCharCode(l);return s}i.string_fromCodeUnits=r;function n(a){let s=[],l=zh.StringIterator.INSTANCE;for(l.reset(a,0);;){let c=l.nextCodePoint();if(c<0)return s;s.push(c)}}i.string_codePoints=n;function o(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a-65536>>10)+55296)+String.fromCharCode((a-65536&1023)+56320)}i.string_fromCodePoint=o})(Pi||(Pi={}));var $u=3;var HA;(function(t){t[t.LEGACY=0]="LEGACY",t[t.DEFAULT=1]="DEFAULT",t[t.MERGE_MODAL=2]="MERGE_MODAL",t[t.RECOVERY=3]="RECOVERY",t[t.MAXIMUM=4]="MAXIMUM"})(HA||(HA={}));var zA;(function(t){t[t.RENDERER=0]="RENDERER",t[t.JS=1]="JS",t[t.MEDIA=2]="MEDIA"})(zA||(zA={}));var WA;(function(t){t[t.BUFFER=0]="BUFFER"})(WA||(WA={}));var il;(function(t){t[t.TEXTURE=0]="TEXTURE",t[t.VERTEX_BUFFER=1]="VERTEX_BUFFER",t[t.INDEX_BUFFER=2]="INDEX_BUFFER",t[t.RENDERBUFFER=3]="RENDERBUFFER",t[t.UNIFORM_BUFFER=4]="UNIFORM_BUFFER"})(il||(il={}));var ba;(function(t){t[t.COMPRESSED=0]="COMPRESSED",t[t.BUFFER=1]="BUFFER",t[t.BITMAP=2]="BITMAP"})(ba||(ba={}));var $a;(function(t){t[t.IMAGE=0]="IMAGE",t[t.GIF=1]="GIF",t[t.VIDEO=2]="VIDEO"})($a||($a={}));var fr;(function(t){t[t.BACKBUFFER=0]="BACKBUFFER",t[t.EYEDROPPER_BACKBUFFER_COPY=1]="EYEDROPPER_BACKBUFFER_COPY",t[t.EXPORT=2]="EXPORT",t[t.GLYPH_DATA=3]="GLYPH_DATA",t[t.GRADIENT=4]="GRADIENT",t[t.IMAGE=5]="IMAGE",t[t.OVERLAY_IMAGE=6]="OVERLAY_IMAGE",t[t.OVERLAY_NINE_GRID=7]="OVERLAY_NINE_GRID",t[t.OVERLAY_TEXT=8]="OVERLAY_TEXT",t[t.OVERLAY_TILE=9]="OVERLAY_TILE",t[t.SINGLE_PIXEL_TEXTURE=10]="SINGLE_PIXEL_TEXTURE",t[t.SWAP_CHAIN=11]="SWAP_CHAIN",t[t.TEST=12]="TEST",t[t.TILE_ATLAS=13]="TILE_ATLAS",t[t.TILE_STACK=14]="TILE_STACK",t[t.STENCIL=15]="STENCIL",t[t.CHROME_HACK=16]="CHROME_HACK"})(fr||(fr={}));var KA;(function(t){t[t.FULLSCREEN=0]="FULLSCREEN",t[t.NON_FULLSCREEN=1]="NON_FULLSCREEN"})(KA||(KA={}));var YA;(function(t){t[t.IGNORE_AUTOLAYOUT=0]="IGNORE_AUTOLAYOUT",t[t.FORCE_INSERTION=1]="FORCE_INSERTION",t[t.PREVENT_NESTING=2]="PREVENT_NESTING"})(YA||(YA={}));var QA;(function(t){t[t.None=0]="None",t[t.WebGL1=1]="WebGL1",t[t.WebGL2=2]="WebGL2",t[t.WebGPU=3]="WebGPU"})(QA||(QA={}));var qA;(function(t){t[t.LOW=0]="LOW",t[t.HIGH=1]="HIGH"})(qA||(qA={}));var XA;(function(t){t[t.GL_VERTEX_BUFFER_FAILURE=0]="GL_VERTEX_BUFFER_FAILURE",t[t.GL_TEXTURE_FAILURE=1]="GL_TEXTURE_FAILURE",t[t.GL_RENDERBUFFER_FAILURE=2]="GL_RENDERBUFFER_FAILURE",t[t.GL_UNIFORM_BUFFER_FAILURE=3]="GL_UNIFORM_BUFFER_FAILURE",t[t.GL_INDEX_BUFFER_FAILURE=4]="GL_INDEX_BUFFER_FAILURE",t[t.WASM_FAILURE=100]="WASM_FAILURE"})(XA||(XA={}));var jA;(function(t){t[t.GENERIC=0]="GENERIC"})(jA||(jA={}));var ZA;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALWAYS=1]="ALWAYS",t[t.NEVER=2]="NEVER"})(ZA||(ZA={}));var JA;(function(t){t[t.AFTER_INITIAL_JOIN_END=0]="AFTER_INITIAL_JOIN_END",t[t.AFTER_FIRST_RENDER=1]="AFTER_FIRST_RENDER",t[t.DOCUMENT_STARTED_SAVING=2]="DOCUMENT_STARTED_SAVING",t[t.DOCUMENT_FINISHED_SAVING=3]="DOCUMENT_FINISHED_SAVING"})(JA||(JA={}));var $A;(function(t){t[t.NONE=0]="NONE",t[t.FAST=1]="FAST",t[t.DEFAULT=6]="DEFAULT",t[t.BEST=9]="BEST"})($A||($A={}));var eT;(function(t){t[t.INVALID=0]="INVALID",t[t.TEST_SETUP=1]="TEST_SETUP",t[t.USER=2]="USER",t[t.PLUGIN=3]="PLUGIN",t[t.SYSTEM=4]="SYSTEM",t[t.REST_API=5]="REST_API",t[t.ONBOARDING=6]="ONBOARDING",t[t.AUTOSAVE=7]="AUTOSAVE",t[t.AI=8]="AI"})(eT||(eT={}));var tT;(function(t){t[t.IN_CUBIC=0]="IN_CUBIC",t[t.OUT_CUBIC=1]="OUT_CUBIC",t[t.INOUT_CUBIC=2]="INOUT_CUBIC",t[t.LINEAR=3]="LINEAR",t[t.IN_BACK_CUBIC=4]="IN_BACK_CUBIC",t[t.OUT_BACK_CUBIC=5]="OUT_BACK_CUBIC",t[t.INOUT_BACK_CUBIC=6]="INOUT_BACK_CUBIC",t[t.CUSTOM_CUBIC=7]="CUSTOM_CUBIC",t[t.SPRING=8]="SPRING",t[t.GENTLE_SPRING=9]="GENTLE_SPRING",t[t.CUSTOM_SPRING=10]="CUSTOM_SPRING",t[t.SPRING_PRESET_ONE=11]="SPRING_PRESET_ONE",t[t.SPRING_PRESET_TWO=12]="SPRING_PRESET_TWO",t[t.SPRING_PRESET_THREE=13]="SPRING_PRESET_THREE"})(tT||(tT={}));var rT;(function(t){t[t.CLICK=0]="CLICK",t[t.COPY_PASTE=1]="COPY_PASTE",t[t.COPY_PASTE_DIFFERENT_FILE=2]="COPY_PASTE_DIFFERENT_FILE",t[t.DLT_DRAG_DROP=3]="DLT_DRAG_DROP",t[t.SHAPES_SIDEBAR_CLICK=4]="SHAPES_SIDEBAR_CLICK",t[t.SHAPES_SIDEBAR_DRAG_DROP=5]="SHAPES_SIDEBAR_DRAG_DROP",t[t.DUPLICATION=6]="DUPLICATION",t[t.LIBRARY_DRAG_AND_DROP=7]="LIBRARY_DRAG_AND_DROP",t[t.PLAYGROUND=8]="PLAYGROUND",t[t.SWAPPING_FROM_LIBRARY_DRAG_AND_DROP=9]="SWAPPING_FROM_LIBRARY_DRAG_AND_DROP",t[t.SWAPPING_FROM_PROPERTIES_PANEL=10]="SWAPPING_FROM_PROPERTIES_PANEL",t[t.LEFT_PANEL=11]="LEFT_PANEL",t[t.CMS_PROPERTIES_PANEL=12]="CMS_PROPERTIES_PANEL",t[t.CMS_CONNECT_MODE=13]="CMS_CONNECT_MODE",t[t.UNKNOWN=14]="UNKNOWN"})(rT||(rT={}));var nT;(function(t){t[t.LIVE_FILE=0]="LIVE_FILE",t[t.HISTORY=1]="HISTORY",t[t.DETACHED_COMPONENTS=2]="DETACHED_COMPONENTS",t[t.PLAYGROUND=3]="PLAYGROUND",t[t.FIRST_DRAFT=4]="FIRST_DRAFT",t[t.HUB_FILE_EMBED=5]="HUB_FILE_EMBED",t[t.HUB_FILE_MOBILE=6]="HUB_FILE_MOBILE",t[t.FIGMASCOPE=7]="FIGMASCOPE",t[t.MOBILE=8]="MOBILE",t[t.COMPARE_CHANGES=9]="COMPARE_CHANGES",t[t.GARBAGE_COLLECTION_RESTORER=10]="GARBAGE_COLLECTION_RESTORER",t[t.TEMPLATE_COMMIT=11]="TEMPLATE_COMMIT",t[t.TEMPLATE_PREVIEW=12]="TEMPLATE_PREVIEW",t[t.FAKE_CLIPBOARD=13]="FAKE_CLIPBOARD",t[t.DEV_MODE_TYPOGRAPHY_PREVIEW=14]="DEV_MODE_TYPOGRAPHY_PREVIEW",t[t.SLIDE_THEME_STYLE_PREVIEW=15]="SLIDE_THEME_STYLE_PREVIEW",t[t.STYLE_SELECTION_PROPERTIES=16]="STYLE_SELECTION_PROPERTIES",t[t.EXPORTER_PAINT_ICON_RENDERING=17]="EXPORTER_PAINT_ICON_RENDERING",t[t.STYLE_RENDERING=18]="STYLE_RENDERING",t[t.AUTO_SUGGEST=19]="AUTO_SUGGEST",t[t.LINTER=20]="LINTER",t[t.LIBRARY_PREVIEW=21]="LIBRARY_PREVIEW",t[t.AI_TOOLS=22]="AI_TOOLS"})(nT||(nT={}));var ne;(function(t){t[t.REDUX=0]="REDUX",t[t.PLUGIN=1]="PLUGIN",t[t.PROTOTYPE_LIB=2]="PROTOTYPE_LIB"})(ne||(ne={}));var oT;(function(t){t[t.NONE=0]="NONE",t[t.DOCUMENT=1]="DOCUMENT",t[t.CANVAS=2]="CANVAS",t[t.GROUP_DEPRECATED=3]="GROUP_DEPRECATED",t[t.FRAME=4]="FRAME",t[t.SYMBOL=5]="SYMBOL",t[t.INSTANCE=6]="INSTANCE",t[t.STICKY=7]="STICKY",t[t.SHAPE_WITH_TEXT=8]="SHAPE_WITH_TEXT",t[t.CONNECTOR=9]="CONNECTOR",t[t.CODE_BLOCK=10]="CODE_BLOCK",t[t.WIDGET=11]="WIDGET",t[t.STAMP=12]="STAMP",t[t.MEDIA=13]="MEDIA",t[t.SECTION=14]="SECTION",t[t.SECTION_OVERLAY=15]="SECTION_OVERLAY",t[t.TABLE=16]="TABLE",t[t.TABLE_CELL=17]="TABLE_CELL",t[t.SLIDE=18]="SLIDE",t[t.CANVAS_GRID=19]="CANVAS_GRID",t[t.CANVAS_ROW=20]="CANVAS_ROW",t[t.MODULE=21]="MODULE",t[t.VECTOR_OPERATION=22]="VECTOR_OPERATION",t[t.VECTOR=23]="VECTOR",t[t.HIGHLIGHT=24]="HIGHLIGHT",t[t.STAR=25]="STAR",t[t.LINE=26]="LINE",t[t.ELLIPSE=27]="ELLIPSE",t[t.RECTANGLE=28]="RECTANGLE",t[t.REGULAR_POLYGON=29]="REGULAR_POLYGON",t[t.ROUNDED_RECTANGLE=30]="ROUNDED_RECTANGLE",t[t.TEXT=31]="TEXT",t[t.SLICE=32]="SLICE",t[t.WASHI_TAPE=33]="WASHI_TAPE",t[t.VARIABLE=34]="VARIABLE",t[t.VARIABLE_SET=35]="VARIABLE_SET",t[t.ASSISTED_LAYOUT_DEPRECATED=36]="ASSISTED_LAYOUT_DEPRECATED",t[t.INTERACTIVE_SLIDE_ELEMENT=37]="INTERACTIVE_SLIDE_ELEMENT",t[t.VARIABLE_OVERRIDE=38]="VARIABLE_OVERRIDE",t[t.RESPONSIVE_SET=39]="RESPONSIVE_SET",t[t.CODE_COMPONENT=40]="CODE_COMPONENT",t[t.TEXT_PATH=41]="TEXT_PATH",t[t.CODE_INSTANCE=42]="CODE_INSTANCE",t[t.CODE_LIBRARY=43]="CODE_LIBRARY",t[t.CODE_FILE=44]="CODE_FILE",t[t.CODE_LAYER=45]="CODE_LAYER",t[t.BRUSH=46]="BRUSH",t[t.MANAGED_STRING=47]="MANAGED_STRING",t[t.TRANSFORM=48]="TRANSFORM",t[t.CMS_RICH_TEXT=49]="CMS_RICH_TEXT",t[t.REPEATER=50]="REPEATER",t[t.JSX=51]="JSX",t[t.EMBEDDED_PROTOTYPE=52]="EMBEDDED_PROTOTYPE",t[t.REACT_FIBER=53]="REACT_FIBER",t[t.RESPONSIVE_NODE_SET=54]="RESPONSIVE_NODE_SET",t[t.WEBPAGE=55]="WEBPAGE"})(oT||(oT={}));var iT;(function(t){t[t.BOOLEAN=0]="BOOLEAN",t[t.FLOAT=1]="FLOAT",t[t.STRING=2]="STRING",t[t.COLOR=3]="COLOR",t[t.MAP=4]="MAP",t[t.SYMBOL_ID=5]="SYMBOL_ID",t[t.FONT_STYLE=6]="FONT_STYLE",t[t.TEXT_DATA=7]="TEXT_DATA",t[t.IMAGE=8]="IMAGE",t[t.LINK=9]="LINK",t[t.JS_RUNTIME_ALIAS=10]="JS_RUNTIME_ALIAS",t[t.SLOT_CONTENT_ID=11]="SLOT_CONTENT_ID",t[t.KEYFRAME_TRACK_ID=12]="KEYFRAME_TRACK_ID"})(iT||(iT={}));var aT;(function(t){t[t.BOOLEAN=0]="BOOLEAN",t[t.FLOAT=1]="FLOAT",t[t.STRING=2]="STRING",t[t.ALIAS=3]="ALIAS",t[t.COLOR=4]="COLOR",t[t.EXPRESSION=5]="EXPRESSION",t[t.MAP=6]="MAP",t[t.SYMBOL_ID=7]="SYMBOL_ID",t[t.FONT_STYLE=8]="FONT_STYLE",t[t.TEXT_DATA=9]="TEXT_DATA",t[t.INVALID=10]="INVALID",t[t.NODE_FIELD_ALIAS=11]="NODE_FIELD_ALIAS",t[t.CMS_ALIAS=12]="CMS_ALIAS",t[t.PROP_REF=13]="PROP_REF",t[t.IMAGE=14]="IMAGE",t[t.MANAGED_STRING_ALIAS=15]="MANAGED_STRING_ALIAS",t[t.LINK=16]="LINK",t[t.JS_RUNTIME_ALIAS=17]="JS_RUNTIME_ALIAS",t[t.SLOT_CONTENT_ID=18]="SLOT_CONTENT_ID",t[t.DATE=19]="DATE",t[t.KEYFRAME_TRACK_ID=20]="KEYFRAME_TRACK_ID"})(aT||(aT={}));var sT;(function(t){t[t.ADDITION=0]="ADDITION",t[t.SUBTRACTION=1]="SUBTRACTION",t[t.RESOLVE_VARIANT=2]="RESOLVE_VARIANT",t[t.MULTIPLY=3]="MULTIPLY",t[t.DIVIDE=4]="DIVIDE",t[t.EQUALS=5]="EQUALS",t[t.NOT_EQUAL=6]="NOT_EQUAL",t[t.LESS_THAN=7]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL=8]="LESS_THAN_OR_EQUAL",t[t.GREATER_THAN=9]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL=10]="GREATER_THAN_OR_EQUAL",t[t.AND=11]="AND",t[t.OR=12]="OR",t[t.NOT=13]="NOT",t[t.STRINGIFY=14]="STRINGIFY",t[t.TERNARY=15]="TERNARY",t[t.VAR_MODE_LOOKUP=16]="VAR_MODE_LOOKUP",t[t.NEGATE=17]="NEGATE",t[t.IS_TRUTHY=18]="IS_TRUTHY",t[t.KEYFRAME=19]="KEYFRAME"})(sT||(sT={}));var lT;(function(t){t[t.MISSING=0]="MISSING",t[t.CORNER_RADIUS=1]="CORNER_RADIUS",t[t.PARAGRAPH_SPACING=2]="PARAGRAPH_SPACING",t[t.PARAGRAPH_INDENT=3]="PARAGRAPH_INDENT",t[t.STROKE_WEIGHT=4]="STROKE_WEIGHT",t[t.STACK_SPACING=5]="STACK_SPACING",t[t.STACK_PADDING_LEFT=6]="STACK_PADDING_LEFT",t[t.STACK_PADDING_TOP=7]="STACK_PADDING_TOP",t[t.STACK_PADDING_RIGHT=8]="STACK_PADDING_RIGHT",t[t.STACK_PADDING_BOTTOM=9]="STACK_PADDING_BOTTOM",t[t.VISIBLE=10]="VISIBLE",t[t.TEXT_DATA=11]="TEXT_DATA",t[t.WIDTH=12]="WIDTH",t[t.HEIGHT=13]="HEIGHT",t[t.RECTANGLE_TOP_LEFT_CORNER_RADIUS=14]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",t[t.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=15]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",t[t.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=16]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",t[t.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=17]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",t[t.BORDER_TOP_WEIGHT=18]="BORDER_TOP_WEIGHT",t[t.BORDER_BOTTOM_WEIGHT=19]="BORDER_BOTTOM_WEIGHT",t[t.BORDER_LEFT_WEIGHT=20]="BORDER_LEFT_WEIGHT",t[t.BORDER_RIGHT_WEIGHT=21]="BORDER_RIGHT_WEIGHT",t[t.VARIANT_PROPERTIES=22]="VARIANT_PROPERTIES",t[t.STACK_COUNTER_SPACING=23]="STACK_COUNTER_SPACING",t[t.MIN_WIDTH=24]="MIN_WIDTH",t[t.MAX_WIDTH=25]="MAX_WIDTH",t[t.MIN_HEIGHT=26]="MIN_HEIGHT",t[t.MAX_HEIGHT=27]="MAX_HEIGHT",t[t.FONT_FAMILY=28]="FONT_FAMILY",t[t.FONT_STYLE=29]="FONT_STYLE",t[t.FONT_VARIATIONS=30]="FONT_VARIATIONS",t[t.OPACITY=31]="OPACITY",t[t.FONT_SIZE=32]="FONT_SIZE",t[t.LETTER_SPACING=34]="LETTER_SPACING",t[t.LINE_HEIGHT=36]="LINE_HEIGHT",t[t.OVERRIDDEN_SYMBOL_ID=37]="OVERRIDDEN_SYMBOL_ID",t[t.CMS_SERIALIZED_RICH_TEXT_DATA=38]="CMS_SERIALIZED_RICH_TEXT_DATA",t[t.HYPERLINK=39]="HYPERLINK",t[t.SLOT_CONTENT_ID=40]="SLOT_CONTENT_ID",t[t.GRID_ROW_GAP=41]="GRID_ROW_GAP",t[t.GRID_COLUMN_GAP=42]="GRID_COLUMN_GAP",t[t.X_POSITION=43]="X_POSITION",t[t.Y_POSITION=44]="Y_POSITION",t[t.ROTATION=45]="ROTATION"})(lT||(lT={}));var cT;(function(t){t[t.IGNORE=0]="IGNORE",t[t.TRACK=1]="TRACK"})(cT||(cT={}));var dT;(function(t){t[t.NONE=0]="NONE",t[t.BUILD=1]="BUILD",t[t.COMPLETED=2]="COMPLETED"})(dT||(dT={}));var uT;(function(t){t[t.NONE=0]="NONE",t[t.AUTO=1]="AUTO",t[t.TOP=2]="TOP",t[t.LEFT=3]="LEFT",t[t.BOTTOM=4]="BOTTOM",t[t.RIGHT=5]="RIGHT",t[t.CENTER=6]="CENTER",t[t.EDGE=7]="EDGE",t[t.ABSOLUTE=8]="ABSOLUTE"})(uT||(uT={}));var pT;(function(t){t[t.FILL=0]="FILL",t[t.STROKE=1]="STROKE",t[t.WIDTH=2]="WIDTH",t[t.HEIGHT=3]="HEIGHT",t[t.MIN_WIDTH=4]="MIN_WIDTH",t[t.MIN_HEIGHT=5]="MIN_HEIGHT",t[t.MAX_WIDTH=6]="MAX_WIDTH",t[t.MAX_HEIGHT=7]="MAX_HEIGHT",t[t.STROKE_WIDTH=8]="STROKE_WIDTH",t[t.CORNER_RADIUS=9]="CORNER_RADIUS",t[t.EFFECT=10]="EFFECT",t[t.TEXT_STYLE=11]="TEXT_STYLE",t[t.TEXT_ALIGN_HORIZONTAL=12]="TEXT_ALIGN_HORIZONTAL",t[t.FONT_FAMILY=13]="FONT_FAMILY",t[t.FONT_SIZE=14]="FONT_SIZE",t[t.FONT_WEIGHT=15]="FONT_WEIGHT",t[t.LINE_HEIGHT=16]="LINE_HEIGHT",t[t.LETTER_SPACING=17]="LETTER_SPACING",t[t.STACK_SPACING=18]="STACK_SPACING",t[t.STACK_PADDING=19]="STACK_PADDING",t[t.STACK_MODE=20]="STACK_MODE",t[t.STACK_ALIGNMENT=21]="STACK_ALIGNMENT",t[t.OPACITY=22]="OPACITY",t[t.COMPONENT=23]="COMPONENT",t[t.FONT_STYLE=24]="FONT_STYLE",t[t.GRID_ROW_GAP=25]="GRID_ROW_GAP",t[t.GRID_COLUMN_GAP=26]="GRID_COLUMN_GAP",t[t.GRID_ROW_COUNT=27]="GRID_ROW_COUNT",t[t.GRID_COLUMN_COUNT=28]="GRID_COLUMN_COUNT",t[t.GRID_ROW_ANCHOR_INDEX=29]="GRID_ROW_ANCHOR_INDEX",t[t.GRID_COLUMN_ANCHOR_INDEX=30]="GRID_COLUMN_ANCHOR_INDEX",t[t.GRID_ROW_SPAN=31]="GRID_ROW_SPAN",t[t.GRID_COLUMN_SPAN=32]="GRID_COLUMN_SPAN"})(pT||(pT={}));var _T;(function(t){t[t.YELLOW=0]="YELLOW",t[t.ORANGE=1]="ORANGE",t[t.RED=2]="RED",t[t.PINK=3]="PINK",t[t.VIOLET=4]="VIOLET",t[t.BLUE=5]="BLUE",t[t.TEAL=6]="TEAL",t[t.GREEN=7]="GREEN"})(_T||(_T={}));var hT;(function(t){t[t.NONE=0]="NONE",t[t.ACCESSIBILITY=1]="ACCESSIBILITY",t[t.BEHAVIOR=2]="BEHAVIOR",t[t.CONTENT=3]="CONTENT",t[t.DEVELOPMENT=4]="DEVELOPMENT",t[t.INTERACTION=5]="INTERACTION"})(hT||(hT={}));var mT;(function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})(mT||(mT={}));var fT;(function(t){t[t.LOCAL=0]="LOCAL",t[t.LIBRARY=1]="LIBRARY"})(fT||(fT={}));var gT;(function(t){t[t.NONE=0]="NONE",t[t.BUILDING_BLOCK=1]="BUILDING_BLOCK",t[t.GROUPED_COMPONENT=2]="GROUPED_COMPONENT"})(gT||(gT={}));var ST;(function(t){t[t.COMPONENT=0]="COMPONENT",t[t.STATE_GROUP=1]="STATE_GROUP"})(ST||(ST={}));var AT;(function(t){t[t.NONE=0]="NONE",t[t.CAP_HEIGHT=1]="CAP_HEIGHT"})(AT||(AT={}));var TT;(function(t){t[t.POLL=0]="POLL",t[t.EMBED=1]="EMBED",t[t.FACEPILE=2]="FACEPILE",t[t.ALIGNMENT=3]="ALIGNMENT",t[t.YOUTUBE=4]="YOUTUBE"})(TT||(TT={}));var ET;(function(t){t[t.RAW=0]="RAW",t[t.PIXELS=1]="PIXELS",t[t.PERCENT=2]="PERCENT"})(ET||(ET={}));var ep;(function(t){t[t.FILL=0]="FILL",t[t.STROKE=1]="STROKE",t[t.BACKGROUND__NO_LONGER_USED=2]="BACKGROUND__NO_LONGER_USED",t[t.TEXT=3]="TEXT",t[t.EFFECT=4]="EFFECT",t[t.GRID=5]="GRID",t[t.DEPRECATED_STROKE=6]="DEPRECATED_STROKE",t[t.NOT_SUPPORTED=7]="NOT_SUPPORTED"})(ep||(ep={}));var IT;(function(t){t[t.TOGGLE_BOLD=0]="TOGGLE_BOLD",t[t.INCREASE_BOLD=1]="INCREASE_BOLD",t[t.DECREASE_BOLD=2]="DECREASE_BOLD",t[t.TOGGLE_ITALIC=3]="TOGGLE_ITALIC",t[t.TOGGLE_UNDERLINE=4]="TOGGLE_UNDERLINE",t[t.TOGGLE_STRIKETHROUGH=5]="TOGGLE_STRIKETHROUGH",t[t.REMOVE_DECORATION=6]="REMOVE_DECORATION",t[t.SET_ORIGINAL_CASE=7]="SET_ORIGINAL_CASE",t[t.SET_UPPER_CASE=8]="SET_UPPER_CASE",t[t.SET_LOWER_CASE=9]="SET_LOWER_CASE",t[t.SET_TITLE_CASE=10]="SET_TITLE_CASE",t[t.INCREASE_LETTER_SPACING=11]="INCREASE_LETTER_SPACING",t[t.DECREASE_LETTER_SPACING=12]="DECREASE_LETTER_SPACING",t[t.INCREASE_LINE_HEIGHT=13]="INCREASE_LINE_HEIGHT",t[t.DECREASE_LINE_HEIGHT=14]="DECREASE_LINE_HEIGHT"})(IT||(IT={}));var RT;(function(t){t[t.SET_BOLD=0]="SET_BOLD",t[t.SET_UNBOLD=1]="SET_UNBOLD",t[t.INCREASE_BOLD=2]="INCREASE_BOLD",t[t.DECREASE_BOLD=3]="DECREASE_BOLD",t[t.SET_ITALIC=4]="SET_ITALIC",t[t.SET_UNITALIC=5]="SET_UNITALIC",t[t.SET_UNDERLINE=6]="SET_UNDERLINE",t[t.SET_STRIKETHROUGH=7]="SET_STRIKETHROUGH",t[t.REMOVE_DECORATION=8]="REMOVE_DECORATION",t[t.SET_ORIGINAL_CASE=9]="SET_ORIGINAL_CASE",t[t.SET_UPPER_CASE=10]="SET_UPPER_CASE",t[t.SET_LOWER_CASE=11]="SET_LOWER_CASE",t[t.SET_TITLE_CASE=12]="SET_TITLE_CASE",t[t.INCREASE_LETTER_SPACING=13]="INCREASE_LETTER_SPACING",t[t.DECREASE_LETTER_SPACING=14]="DECREASE_LETTER_SPACING",t[t.INCREASE_LINE_HEIGHT=15]="INCREASE_LINE_HEIGHT",t[t.DECREASE_LINE_HEIGHT=16]="DECREASE_LINE_HEIGHT"})(RT||(RT={}));var yT;(function(t){t[t.NONE=0]="NONE",t[t.CREATED=1]="CREATED",t[t.EDITED=2]="EDITED",t[t.REMOVED=3]="REMOVED",t[t.INDIRECTLY_EDITED=4]="INDIRECTLY_EDITED",t[t.AFFECTED=5]="AFFECTED",t[t.LIBRARY_UPDATES=6]="LIBRARY_UPDATES"})(yT||(yT={}));var bT;(function(t){t[t.ALL_SCOPES=0]="ALL_SCOPES",t[t.TEXT_CONTENT=1]="TEXT_CONTENT",t[t.CORNER_RADIUS=2]="CORNER_RADIUS",t[t.WIDTH_HEIGHT=3]="WIDTH_HEIGHT",t[t.GAP=4]="GAP",t[t.ALL_FILLS=5]="ALL_FILLS",t[t.FRAME_FILL=6]="FRAME_FILL",t[t.SHAPE_FILL=7]="SHAPE_FILL",t[t.TEXT_FILL=8]="TEXT_FILL",t[t.STROKE=9]="STROKE",t[t.STROKE_FLOAT=10]="STROKE_FLOAT",t[t.EFFECT_FLOAT=11]="EFFECT_FLOAT",t[t.EFFECT_COLOR=12]="EFFECT_COLOR",t[t.OPACITY=13]="OPACITY",t[t.FONT_STYLE=14]="FONT_STYLE",t[t.FONT_FAMILY=15]="FONT_FAMILY",t[t.FONT_SIZE=16]="FONT_SIZE",t[t.LINE_HEIGHT=17]="LINE_HEIGHT",t[t.LETTER_SPACING=18]="LETTER_SPACING",t[t.PARAGRAPH_SPACING=19]="PARAGRAPH_SPACING",t[t.PARAGRAPH_INDENT=20]="PARAGRAPH_INDENT",t[t.FONT_VARIATIONS=21]="FONT_VARIATIONS",t[t.TRANSFORM=22]="TRANSFORM"})(bT||(bT={}));var vT;(function(t){t[t.WEB=0]="WEB",t[t.ANDROID=1]="ANDROID",t[t.iOS=2]="iOS"})(vT||(vT={}));var CT;(function(t){t[t.DESIGN_LAYOUT=0]="DESIGN_LAYOUT",t[t.WHITEBOARD_LAYOUT=1]="WHITEBOARD_LAYOUT",t[t.VECTOR=2]="VECTOR",t[t.TEXT=3]="TEXT",t[t.RASTER=4]="RASTER",t[t.GRADIENT=5]="GRADIENT",t[t.PLACE_IMAGE=6]="PLACE_IMAGE",t[t.HISTORY=7]="HISTORY",t[t.PREVIEW=8]="PREVIEW",t[t.COMMENTS=9]="COMMENTS",t[t.BRANCHING=10]="BRANCHING",t[t.DEV_HANDOFF=11]="DEV_HANDOFF",t[t.COMPARE_CHANGES=12]="COMPARE_CHANGES",t[t.LIBRARY=13]="LIBRARY",t[t.DEV_HANDOFF_HISTORY=14]="DEV_HANDOFF_HISTORY",t[t.SLIDE_LAYOUT=15]="SLIDE_LAYOUT",t[t.MAGIC_LINK=16]="MAGIC_LINK",t[t.BUZZ_LAYOUT=17]="BUZZ_LAYOUT",t[t.PROGRESSIVE_BLUR=18]="PROGRESSIVE_BLUR",t[t.COOPER_BULK_CREATE=19]="COOPER_BULK_CREATE",t[t.CMS_BINDING_CONSTRAINED=20]="CMS_BINDING_CONSTRAINED",t[t.SITES_LAYOUT=21]="SITES_LAYOUT"})(CT||(CT={}));var OT;(function(t){t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE"})(OT||(OT={}));var ic;(function(t){t[t.STRETCH=0]="STRETCH",t[t.SCATTER=1]="SCATTER"})(ic||(ic={}));var NT;(function(t){t[t.USER_MESSAGE=0]="USER_MESSAGE",t[t.ASSISTANT_MESSAGE=1]="ASSISTANT_MESSAGE",t[t.TOOL_MESSAGE=2]="TOOL_MESSAGE",t[t.SYSTEM_MESSAGE=3]="SYSTEM_MESSAGE"})(NT||(NT={}));var PT;(function(t){t[t.HEADING1=0]="HEADING1",t[t.HEADING2=1]="HEADING2",t[t.HEADING3=2]="HEADING3",t[t.HEADING4=3]="HEADING4",t[t.HEADING5=4]="HEADING5",t[t.HEADING6=5]="HEADING6",t[t.PARAGRAPH=6]="PARAGRAPH",t[t.LINK=7]="LINK",t[t.BLOCKQUOTE=8]="BLOCKQUOTE"})(PT||(PT={}));var FT;(function(t){t[t.INITIAL=0]="INITIAL",t[t.SNAPSHOTTING=1]="SNAPSHOTTING",t[t.OK=2]="OK",t[t.SNAPSHOT_ERROR=3]="SNAPSHOT_ERROR",t[t.LLM_IN_PROGRESS=4]="LLM_IN_PROGRESS"})(FT||(FT={}));var DT;(function(t){t[t.WEB_LAYER=0]="WEB_LAYER",t[t.WEB_INTERACTION=1]="WEB_INTERACTION",t[t.NATIVE_LAYER=2]="NATIVE_LAYER"})(DT||(DT={}));var xT;(function(t){t[t.USER=0]="USER",t[t.ASSISTANT=1]="ASSISTANT",t[t.TOOL=2]="TOOL",t[t.SYSTEM=3]="SYSTEM"})(xT||(xT={}));var wT;(function(t){t[t.INVALID=0]="INVALID",t[t.TEXT=1]="TEXT",t[t.SELECTED_NODE_IDS=2]="SELECTED_NODE_IDS"})(wT||(wT={}));var LT;(function(t){t[t.FLEX=0]="FLEX",t[t.FIXED=1]="FIXED",t[t.HUG=2]="HUG"})(LT||(LT={}));var fd;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(fd||(fd={}));var MT;(function(t){t[t.NONE=0]="NONE",t[t.SLOT_SUBLAYERS=1]="SLOT_SUBLAYERS",t[t.SLOTS_AND_SLOT_SUBLAYERS=2]="SLOTS_AND_SLOT_SUBLAYERS"})(MT||(MT={}));var BT;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"})(BT||(BT={}));var GT;(function(t){t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.STROKE=2]="STROKE",t[t.STROKE_PRESET=3]="STROKE_PRESET",t[t.EFFECT=4]="EFFECT",t[t.EXPORT=5]="EXPORT",t[t.LAYOUT_GRID=6]="LAYOUT_GRID",t[t.PLUGIN=7]="PLUGIN",t[t.PROTOTYPE_INTERACTION=8]="PROTOTYPE_INTERACTION",t[t.PROTOTYPE_INHERITED_INTERNAL_INTERACTION=9]="PROTOTYPE_INHERITED_INTERNAL_INTERACTION",t[t.PROTOTOTYPE_STARTING_POINT=10]="PROTOTOTYPE_STARTING_POINT",t[t.BEHAVIOR=11]="BEHAVIOR",t[t.TRANSFORM_MODIFIER=12]="TRANSFORM_MODIFIER",t[t.COMPONENT_PROP_ASSIGNMENT=13]="COMPONENT_PROP_ASSIGNMENT",t[t.ASSET_ALL_EXPORT=14]="ASSET_ALL_EXPORT"})(GT||(GT={}));var UT;(function(t){t[t.NONE=0]="NONE",t[t.BOOL=1]="BOOL",t[t.TEXT=2]="TEXT",t[t.INSTANCE_SWAP=3]="INSTANCE_SWAP",t[t.VARIANT=4]="VARIANT",t[t.NUMBER=5]="NUMBER",t[t.IMAGE=6]="IMAGE",t[t.SLOT=7]="SLOT"})(UT||(UT={}));var VT;(function(t){t[t.NONE=0]="NONE",t[t.UNUSED_DEF_ERROR=1]="UNUSED_DEF_ERROR",t[t.CONFLICTING_NAMES_ERROR=2]="CONFLICTING_NAMES_ERROR",t[t.CONFLICTING_NAMES_WITH_VARIANT_ERROR=3]="CONFLICTING_NAMES_WITH_VARIANT_ERROR"})(VT||(VT={}));var kT;(function(t){t[t.NONE=0]="NONE",t[t.TOO_MANY_STATES_ERROR=1]="TOO_MANY_STATES_ERROR",t[t.MISSING_PROPERTIES_ERROR=2]="MISSING_PROPERTIES_ERROR",t[t.DUPLICATE_STATE_ERROR=3]="DUPLICATE_STATE_ERROR",t[t.PARSE_ERROR=4]="PARSE_ERROR"})(kT||(kT={}));var HT;(function(t){t[t.OVERRIDES_FOR_LAYER_AND_SUBLAYERS=0]="OVERRIDES_FOR_LAYER_AND_SUBLAYERS",t[t.EXPORTS=1]="EXPORTS",t[t.EFFECTS=2]="EFFECTS",t[t.LAYER=3]="LAYER",t[t.VISIBLE=4]="VISIBLE",t[t.NAME=5]="NAME",t[t.FILL=6]="FILL",t[t.STROKE=7]="STROKE",t[t.TEXT=8]="TEXT",t[t.TEXT_STYLE=9]="TEXT_STYLE",t[t.SIZE=10]="SIZE",t[t.OVERRIDDEN_SYMBOL=11]="OVERRIDDEN_SYMBOL",t[t.PROTOTYPE_INTERACTIONS=12]="PROTOTYPE_INTERACTIONS",t[t.OVERLAY=13]="OVERLAY",t[t.SLOT_ASSIGNMENT=14]="SLOT_ASSIGNMENT",t[t.NUM_VALUES=15]="NUM_VALUES"})(HT||(HT={}));var zT;(function(t){t[t.ALWAYS=0]="ALWAYS",t[t.ONLY_WHEN_NOT_EMPTY=1]="ONLY_WHEN_NOT_EMPTY",t[t.ONLY_WHEN_NOT_DISABLED=2]="ONLY_WHEN_NOT_DISABLED"})(zT||(zT={}));var WT;(function(t){t[t.SOLID=0]="SOLID",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.GRID=2]="GRID"})(WT||(WT={}));var KT;(function(t){t[t.DESIGN=0]="DESIGN",t[t.WHITEBOARD=1]="WHITEBOARD",t[t.SLIDES=2]="SLIDES",t[t.DEV_HANDOFF=3]="DEV_HANDOFF",t[t.SITES=4]="SITES",t[t.COOPER=5]="COOPER",t[t.ILLUSTRATION=6]="ILLUSTRATION",t[t.FIGMAKE=7]="FIGMAKE"})(KT||(KT={}));var YT;(function(t){t[t.NONE=0]="NONE",t[t.FRAME=1]="FRAME",t[t.GROUP=2]="GROUP",t[t.STACK=3]="STACK",t[t.SECTION=4]="SECTION",t[t.RESPONSIVE_SET=5]="RESPONSIVE_SET",t[t.TRANSFORM=6]="TRANSFORM",t[t.GRID=7]="GRID"})(YT||(YT={}));var QT;(function(t){t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.TEXT=2]="TEXT",t[t.EFFECT=3]="EFFECT",t[t.GRID=4]="GRID"})(QT||(QT={}));var qT;(function(t){t[t.FIXED=0]="FIXED",t[t.HUG_CONTENT=1]="HUG_CONTENT",t[t.FILL_CONTAINER=2]="FILL_CONTAINER"})(qT||(qT={}));var XT;(function(t){t[t.CLICK=0]="CLICK",t[t.DRAG=1]="DRAG"})(XT||(XT={}));var jT;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(jT||(jT={}));var ZT;(function(t){t[t.ROW=0]="ROW",t[t.COLUMN=1]="COLUMN"})(ZT||(ZT={}));var JT;(function(t){t[t.FORWARD=0]="FORWARD",t[t.BACKWARD=1]="BACKWARD"})(JT||(JT={}));var $T;(function(t){t[t.NONE=0]="NONE",t[t.PIXEL_GRID=1]="PIXEL_GRID",t[t.DOT_GRID=16]="DOT_GRID"})($T||($T={}));var eE;(function(t){t[t.BLANK=0]="BLANK",t[t.DUPLICATE=1]="DUPLICATE"})(eE||(eE={}));var tE;(function(t){t[t.FILE=0]="FILE",t[t.CODE=1]="CODE",t[t.DAKOTA=2]="DAKOTA",t[t.SETTINGS=3]="SETTINGS",t[t.INSERT=4]="INSERT"})(tE||(tE={}));var rE;(function(t){t[t.MORE_THAN_ONE_HIGHLEVEL_NODE_FOUND=0]="MORE_THAN_ONE_HIGHLEVEL_NODE_FOUND",t[t.INSERTED_NODES_TOO_LARGE=1]="INSERTED_NODES_TOO_LARGE",t[t.MAXIMUM_ATTACHMENTS_EXCEEDED=2]="MAXIMUM_ATTACHMENTS_EXCEEDED",t[t.USER_PASTED_FIGMA_LINK_IN_CHAT=3]="USER_PASTED_FIGMA_LINK_IN_CHAT",t[t.DESIGN_2_REACT_OTHER=4]="DESIGN_2_REACT_OTHER",t[t.DESIGN_2_REACT_STATE_GROUP=5]="DESIGN_2_REACT_STATE_GROUP",t[t.OTHER=6]="OTHER",t[t.PASTING_INTO_MAKE_FROM_FIGJAM_NOT_SUPPORTED=7]="PASTING_INTO_MAKE_FROM_FIGJAM_NOT_SUPPORTED",t[t.PASTING_INTO_MAKE_FROM_SLIDES_NOT_SUPPORTED=8]="PASTING_INTO_MAKE_FROM_SLIDES_NOT_SUPPORTED",t[t.PASTING_INTO_MAKE_FROM_BUZZ_NOT_SUPPORTED=9]="PASTING_INTO_MAKE_FROM_BUZZ_NOT_SUPPORTED",t[t.UNSUPPORTED_FILE_TYPE=10]="UNSUPPORTED_FILE_TYPE"})(rE||(rE={}));var nE;(function(t){t[t.LOCAL=0]="LOCAL",t[t.REMOTE=1]="REMOTE"})(nE||(nE={}));var oE;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.INVALID=1]="INVALID",t[t.IS_HOMEPAGE=2]="IS_HOMEPAGE",t[t.NODE_TYPE_MISMATCH=3]="NODE_TYPE_MISMATCH",t[t.EMPTY_COLLECTION=4]="EMPTY_COLLECTION",t[t.ALREADY_BOUND_REPEATER=5]="ALREADY_BOUND_REPEATER",t[t.ALREADY_BOUND_PAGE=6]="ALREADY_BOUND_PAGE",t[t.ERROR=7]="ERROR"})(oE||(oE={}));var al;(function(t){t[t.NORMAL=0]="NORMAL",t[t.PROGRESSIVE=1]="PROGRESSIVE"})(al||(al={}));var iE;(function(t){t[t.MISSING=0]="MISSING",t[t.OFFSET_X=1]="OFFSET_X",t[t.OFFSET_Y=2]="OFFSET_Y",t[t.RADIUS=3]="RADIUS",t[t.SPREAD=4]="SPREAD",t[t.COLOR=5]="COLOR"})(iE||(iE={}));var aE;(function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK",t[t.FORWARD_AMOUNT=2]="FORWARD_AMOUNT",t[t.BACKWARD_AMOUNT=3]="BACKWARD_AMOUNT"})(aE||(aE={}));var sE;(function(t){t[t.NONE=0]="NONE",t[t.TOP=1]="TOP",t[t.VERTICAL_CENTER=2]="VERTICAL_CENTER",t[t.BOTTOM=3]="BOTTOM",t[t.LEFT=4]="LEFT",t[t.HORIZONTAL_CENTER=5]="HORIZONTAL_CENTER",t[t.RIGHT=6]="RIGHT",t[t.VERTICAL_INTERSECTING=7]="VERTICAL_INTERSECTING",t[t.HORIZONTAL_INTERSECTING=8]="HORIZONTAL_INTERSECTING"})(sE||(sE={}));var lE;(function(t){t[t.ALIGNING_TO_PARENT=0]="ALIGNING_TO_PARENT",t[t.ALIGNING_TO_NODES_IN_SELECTION=1]="ALIGNING_TO_NODES_IN_SELECTION"})(lE||(lE={}));var cE;(function(t){t[t.BOX=0]="BOX",t[t.PICK=1]="PICK"})(cE||(cE={}));var dE;(function(t){t[t.NONE=0]="NONE",t[t.FIGJAM=1]="FIGJAM",t[t.VIEWER=2]="VIEWER",t[t.DESIGN=3]="DESIGN",t[t.SLIDES=4]="SLIDES",t[t.BUZZ=5]="BUZZ"})(dE||(dE={}));var uE;(function(t){t[t.READ=0]="READ",t[t.ELIDE=1]="ELIDE",t[t.SKIP=2]="SKIP"})(uE||(uE={}));var pE;(function(t){t[t.LOCK_SECTION=0]="LOCK_SECTION",t[t.LOCK_ALL=1]="LOCK_ALL",t[t.UNLOCK=2]="UNLOCK"})(pE||(pE={}));var _E;(function(t){t[t.UNION=0]="UNION",t[t.SUBTRACT=1]="SUBTRACT",t[t.INTERSECT=2]="INTERSECT",t[t.XOR=3]="XOR"})(_E||(_E={}));var hE;(function(t){t[t.ANNOUNCE_REMAINING=0]="ANNOUNCE_REMAINING",t[t.START=1]="START",t[t.PAUSE=2]="PAUSE",t[t.RESUME=3]="RESUME",t[t.STOP=4]="STOP",t[t.END=5]="END"})(hE||(hE={}));var mE;(function(t){t[t.ROW_SELECTED=0]="ROW_SELECTED",t[t.COLUMN_SELECTED=1]="COLUMN_SELECTED",t[t.CELL_SELECTED=2]="CELL_SELECTED",t[t.CELL_SELECTION_EXTENDED=3]="CELL_SELECTION_EXTENDED",t[t.ROW_ADDED_ABOVE=4]="ROW_ADDED_ABOVE",t[t.ROW_ADDED_BELOW=5]="ROW_ADDED_BELOW",t[t.COLUMN_ADDED_BEFORE=6]="COLUMN_ADDED_BEFORE",t[t.COLUMN_ADDED_AFTER=7]="COLUMN_ADDED_AFTER",t[t.ROW_MOVED_UP=8]="ROW_MOVED_UP",t[t.ROW_MOVED_DOWN=9]="ROW_MOVED_DOWN",t[t.COLUMN_MOVED_LEFT=10]="COLUMN_MOVED_LEFT",t[t.COLUMN_MOVED_RIGHT=11]="COLUMN_MOVED_RIGHT",t[t.ROW_RESIZED=12]="ROW_RESIZED",t[t.COLUMN_RESIZED=13]="COLUMN_RESIZED",t[t.ROW_DELETED=14]="ROW_DELETED",t[t.COLUMN_DELETED=15]="COLUMN_DELETED",t[t.CONTENTS_DELETED=16]="CONTENTS_DELETED"})(mE||(mE={}));var fE;(function(t){t[t.NONE=0]="NONE",t[t.ABOVE=1]="ABOVE",t[t.BELOW=2]="BELOW"})(fE||(fE={}));var gE;(function(t){t[t.SWT_CREATED=0]="SWT_CREATED",t[t.SWT_DELETED=1]="SWT_DELETED",t[t.SWT_EDITED=2]="SWT_EDITED",t[t.SWT_RESIZED=3]="SWT_RESIZED",t[t.STICKY_DELETED=4]="STICKY_DELETED",t[t.STICKY_EDITED=5]="STICKY_EDITED",t[t.STICKY_RESIZED=6]="STICKY_RESIZED"})(gE||(gE={}));var SE;(function(t){t[t.LOCAL=0]="LOCAL",t[t.SUBSCRIBED=1]="SUBSCRIBED"})(SE||(SE={}));var AE;(function(t){t[t.NONE=0]="NONE",t[t.STATE_GROUP=1]="STATE_GROUP",t[t.STYLE=2]="STYLE",t[t.SYMBOL=3]="SYMBOL",t[t.VARIABLE=4]="VARIABLE",t[t.VARIABLE_SET=5]="VARIABLE_SET",t[t.VARIABLE_OVERRIDE=6]="VARIABLE_OVERRIDE",t[t.MODULE=7]="MODULE",t[t.RESPONSIVE_SET=8]="RESPONSIVE_SET",t[t.CONSTRAINED_TEMPLATE=9]="CONSTRAINED_TEMPLATE",t[t.CODE_LIBRARY=10]="CODE_LIBRARY",t[t.CODE_FILE=11]="CODE_FILE",t[t.CODE_COMPONENT=12]="CODE_COMPONENT",t[t.BRUSH=13]="BRUSH",t[t.MANAGED_STRING=14]="MANAGED_STRING",t[t.KEYFRAME_TRACK=15]="KEYFRAME_TRACK"})(AE||(AE={}));var TE;(function(t){t[t.TextOverflow=0]="TextOverflow",t[t.TextOverlap=1]="TextOverlap"})(TE||(TE={}));var EE;(function(t){t[t.FIGJAM_DARK=0]="FIGJAM_DARK",t[t.DRACULA=1]="DRACULA",t[t.DUOTONE_SEA=2]="DUOTONE_SEA",t[t.DUOTONE_SPACE=3]="DUOTONE_SPACE",t[t.DUOTONE_EARTH=4]="DUOTONE_EARTH",t[t.DUOTONE_FOREST=5]="DUOTONE_FOREST",t[t.DUOTONE_LIGHT=6]="DUOTONE_LIGHT"})(EE||(EE={}));var IE;(function(t){t[t.ELBOWED=0]="ELBOWED",t[t.STRAIGHT=1]="STRAIGHT",t[t.CURVED=2]="CURVED"})(IE||(IE={}));var RE;(function(t){t[t.EQUALS=0]="EQUALS"})(RE||(RE={}));var yE;(function(t){t[t.MATCH_ALL=0]="MATCH_ALL",t[t.MATCH_ANY=1]="MATCH_ANY"})(yE||(yE={}));var bE;(function(t){t[t.LOCAL=0]="LOCAL",t[t.GOOGLE=1]="GOOGLE",t[t.SHARED=2]="SHARED"})(bE||(bE={}));var vE;(function(t){t[t.FILL=0]="FILL",t[t.FIT=1]="FIT",t[t.STRETCH=2]="STRETCH",t[t.TILE=3]="TILE"})(vE||(vE={}));var CE;(function(t){t[t.NON_ANIMATED_ONLY=0]="NON_ANIMATED_ONLY",t[t.LOW_RES_ONLY=1]="LOW_RES_ONLY",t[t.ALL=2]="ALL"})(CE||(CE={}));var OE;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.UNSUPPORTED_MEDIA=1]="UNSUPPORTED_MEDIA",t[t.OTHER_FAILURE=2]="OTHER_FAILURE"})(OE||(OE={}));var NE;(function(t){t[t.HOLD=0]="HOLD",t[t.BEZIER=1]="BEZIER"})(NE||(NE={}));var PE;(function(t){t[t.SET=0]="SET",t[t.SCALE=1]="SCALE",t[t.OFFSET=2]="OFFSET"})(PE||(PE={}));var FE;(function(t){t[t.MISSING=0]="MISSING",t[t.PARAMETER_CONSUMPTION_MAP=1]="PARAMETER_CONSUMPTION_MAP",t[t.EFFECT_DATA=2]="EFFECT_DATA"})(FE||(FE={}));var DE;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(DE||(DE={}));var xE;(function(t){t[t.NONE=0]="NONE",t[t.PRESET=1]="PRESET",t[t.CUSTOM=2]="CUSTOM",t[t.PRESENTATION=3]="PRESENTATION"})(xE||(xE={}));var wE;(function(t){t[t.ALL=0]="ALL",t[t.BASE_SCREENS=1]="BASE_SCREENS",t[t.SCROLL_TO=2]="SCROLL_TO",t[t.STATES=3]="STATES",t[t.RESPONSIVE_SETS=4]="RESPONSIVE_SETS"})(wE||(wE={}));var LE;(function(t){t[t.NONE=0]="NONE",t[t.CCW_90=1]="CCW_90"})(LE||(LE={}));var ME;(function(t){t[t.TRIGGER=0]="TRIGGER",t[t.AFTER_PREVIOUS=1]="AFTER_PREVIOUS"})(ME||(ME={}));var BE;(function(t){t[t.TEXT=0]="TEXT",t[t.DATE=1]="DATE",t[t.TIME=2]="TIME",t[t.NUMBER=3]="NUMBER"})(BE||(BE={}));var GE;(function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})(GE||(GE={}));var UE;(function(t){t[t.LIGHT=0]="LIGHT",t[t.DARK=1]="DARK"})(UE||(UE={}));var VE;(function(t){t[t.NO_THEME_COLORS=0]="NO_THEME_COLORS",t[t.NONE_AVAILABLE=1]="NONE_AVAILABLE",t[t.SWAPPED=2]="SWAPPED",t[t.NO_THEME_FOUND=3]="NO_THEME_FOUND"})(VE||(VE={}));var kE;(function(t){t[t.ON_CLICK=0]="ON_CLICK",t[t.AFTER_DELAY=1]="AFTER_DELAY"})(kE||(kE={}));var HE;(function(t){t[t.NONE=0]="NONE",t[t.DISSOLVE=1]="DISSOLVE",t[t.SLIDE_FROM_LEFT=2]="SLIDE_FROM_LEFT",t[t.SLIDE_FROM_RIGHT=3]="SLIDE_FROM_RIGHT",t[t.SLIDE_FROM_TOP=4]="SLIDE_FROM_TOP",t[t.SLIDE_FROM_BOTTOM=5]="SLIDE_FROM_BOTTOM",t[t.PUSH_FROM_LEFT=6]="PUSH_FROM_LEFT",t[t.PUSH_FROM_RIGHT=7]="PUSH_FROM_RIGHT",t[t.PUSH_FROM_TOP=8]="PUSH_FROM_TOP",t[t.PUSH_FROM_BOTTOM=9]="PUSH_FROM_BOTTOM",t[t.MOVE_FROM_LEFT=10]="MOVE_FROM_LEFT",t[t.MOVE_FROM_RIGHT=11]="MOVE_FROM_RIGHT",t[t.MOVE_FROM_TOP=12]="MOVE_FROM_TOP",t[t.MOVE_FROM_BOTTOM=13]="MOVE_FROM_BOTTOM",t[t.SLIDE_OUT_TO_LEFT=14]="SLIDE_OUT_TO_LEFT",t[t.SLIDE_OUT_TO_RIGHT=15]="SLIDE_OUT_TO_RIGHT",t[t.SLIDE_OUT_TO_TOP=16]="SLIDE_OUT_TO_TOP",t[t.SLIDE_OUT_TO_BOTTOM=17]="SLIDE_OUT_TO_BOTTOM",t[t.MOVE_OUT_TO_LEFT=18]="MOVE_OUT_TO_LEFT",t[t.MOVE_OUT_TO_RIGHT=19]="MOVE_OUT_TO_RIGHT",t[t.MOVE_OUT_TO_TOP=20]="MOVE_OUT_TO_TOP",t[t.MOVE_OUT_TO_BOTTOM=21]="MOVE_OUT_TO_BOTTOM",t[t.SMART_ANIMATE=22]="SMART_ANIMATE"})(HE||(HE={}));var zE;(function(t){t[t.PLAIN=0]="PLAIN",t[t.ORDERED_LIST=1]="ORDERED_LIST",t[t.UNORDERED_LIST=2]="UNORDERED_LIST",t[t.BLOCKQUOTE=3]="BLOCKQUOTE",t[t.HEADER=4]="HEADER"})(zE||(zE={}));var WE;(function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"})(WE||(WE={}));var KE;(function(t){t[t.NONE=0]="NONE",t[t.SEMANTIC_WEIGHT=1]="SEMANTIC_WEIGHT",t[t.SEMANTIC_ITALIC=2]="SEMANTIC_ITALIC",t[t.TEXT_DECORATION=3]="TEXT_DECORATION",t[t.HYPERLINK=4]="HYPERLINK",t[t.TEXT_DECORATION_THICKNESS=5]="TEXT_DECORATION_THICKNESS",t[t.TEXT_UNDERLINE_OFFSET=6]="TEXT_UNDERLINE_OFFSET",t[t.TEXT_DECORATION_SKIP_INK=7]="TEXT_DECORATION_SKIP_INK",t[t.TEXT_DECORATION_FILL_PAINT_DATA=8]="TEXT_DECORATION_FILL_PAINT_DATA",t[t.TEXT_DECORATION_STYLE=9]="TEXT_DECORATION_STYLE",t[t.FONT_VARIANT_POSITION=10]="FONT_VARIANT_POSITION"})(KE||(KE={}));var tp;(function(t){t[t.STOPPED=0]="STOPPED",t[t.PAUSED=1]="PAUSED",t[t.PLAYING=2]="PLAYING"})(tp||(tp={}));var YE;(function(t){t[t.REPEAT=0]="REPEAT",t[t.SYMMETRY=1]="SYMMETRY",t[t.SKEW=2]="SKEW"})(YE||(YE={}));var QE;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.X_AND_Y=2]="X_AND_Y"})(QE||(QE={}));var qE;(function(t){t[t.LINEAR=0]="LINEAR",t[t.RADIAL=1]="RADIAL"})(qE||(qE={}));var XE;(function(t){t[t.PIXELS=0]="PIXELS",t[t.RELATIVE=1]="RELATIVE"})(XE||(XE={}));var jE;(function(t){t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE"})(jE||(jE={}));var ZE;(function(t){t[t.CENTER=0]="CENTER",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE=2]="OUTSIDE"})(ZE||(ZE={}));var eI;(function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT",t[t.JUSTIFIED=3]="JUSTIFIED"})(eI||(eI={}));var tI;(function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"})(tI||(tI={}));var rI;(function(t){t[t.X=0]="X",t[t.Y=1]="Y"})(rI||(rI={}));var nI;(function(t){t[t.FullscreenApp=0]="FullscreenApp",t[t.PrototypeLib=1]="PrototypeLib",t[t.InteractionTest=2]="InteractionTest"})(nI||(nI={}));var oI;(function(t){t[t.FROM=0]="FROM",t[t.TO=1]="TO"})(oI||(oI={}));var iI;(function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"})(iI||(iI={}));var aI;(function(t){t[t.INVALID=0]="INVALID",t[t.PRIMARY_INSTANCE_BACKED_BY_SYMBOL=1]="PRIMARY_INSTANCE_BACKED_BY_SYMBOL",t[t.PRIMARY_INSTANCE_WITH_NESTED_SWAP_TO_SYMBOL=2]="PRIMARY_INSTANCE_WITH_NESTED_SWAP_TO_SYMBOL",t[t.PRIMARY_INSTANCE_WITH_TOP_LEVEL_PROP_ASSIGNMENT_TO_SYMBOL=3]="PRIMARY_INSTANCE_WITH_TOP_LEVEL_PROP_ASSIGNMENT_TO_SYMBOL",t[t.PRIMARY_INSTANCE_WITH_NESTED_PROP_ASSIGNMENT_TO_SYMBOL=4]="PRIMARY_INSTANCE_WITH_NESTED_PROP_ASSIGNMENT_TO_SYMBOL",t[t.PRODUCT_COMPONENT_WITH_PROP_DEF_TO_SYMBOL=5]="PRODUCT_COMPONENT_WITH_PROP_DEF_TO_SYMBOL",t[t.STATE_WITH_PROP_DEF_TO_SYMBOL=6]="STATE_WITH_PROP_DEF_TO_SYMBOL",t[t.SYMBOL_CONTAINING_PRIMARY_INSTANCE=7]="SYMBOL_CONTAINING_PRIMARY_INSTANCE"})(aI||(aI={}));var rp;(function(t){t[t.INTERACTION_TEST=0]="INTERACTION_TEST",t[t.VIEWER_TEST=1]="VIEWER_TEST"})(rp||(rp={}));var sI;(function(t){t[t.NONE=0]="NONE",t[t.TOO_MANY_VARIABLES_ERROR=1]="TOO_MANY_VARIABLES_ERROR",t[t.TOO_MANY_MODES_ERROR=2]="TOO_MANY_MODES_ERROR"})(sI||(sI={}));var lI;(function(t){t[t.NONE=0]="NONE",t[t.LESS_THAN_MIN_WIDTH=1]="LESS_THAN_MIN_WIDTH",t[t.LESS_THAN_MIN_HEIGHT=2]="LESS_THAN_MIN_HEIGHT",t[t.GREATER_THAN_MAX_WIDTH=3]="GREATER_THAN_MAX_WIDTH",t[t.GREATER_THAN_MAX_HEIGHT=4]="GREATER_THAN_MAX_HEIGHT",t[t.NEGATIVE=5]="NEGATIVE",t[t.NEGATIVE_OR_ZERO=6]="NEGATIVE_OR_ZERO",t[t.LESS_THAN_ONE=7]="LESS_THAN_ONE"})(lI||(lI={}));var cI;(function(t){t[t.SRGB=0]="SRGB",t[t.DISPLAY_P3=1]="DISPLAY_P3"})(cI||(cI={}));var dI;(function(t){t[t.LEGACY=0]="LEGACY",t[t.SRGB=1]="SRGB",t[t.DISPLAY_P3=2]="DISPLAY_P3"})(dI||(dI={}));var uI;(function(t){t[t.DOCUMENT=0]="DOCUMENT",t[t.SRGB=1]="SRGB",t[t.DISPLAY_P3_V4=2]="DISPLAY_P3_V4",t[t.CMYK=3]="CMYK"})(uI||(uI={}));var pI;(function(t){t[t.NO_CONVERSION=0]="NO_CONVERSION",t[t.SRGB_TO_DISPLAY_P3=1]="SRGB_TO_DISPLAY_P3",t[t.DISPLAY_P3_TO_SRGB=2]="DISPLAY_P3_TO_SRGB"})(pI||(pI={}));var _I;(function(t){t[t.HEX=0]="HEX",t[t.RGB=1]="RGB",t[t.CSS=2]="CSS",t[t.HSL=3]="HSL",t[t.HSB=4]="HSB",t[t.UIColor=5]="UIColor"})(_I||(_I={}));var hI;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(hI||(hI={}));var mI;(function(t){t[t.CUT=0]="CUT",t[t.COPY=1]="COPY",t[t.PASTE=2]="PASTE"})(mI||(mI={}));var fI;(function(t){t[t.TEXT=0]="TEXT",t[t.KEY_PRESS=1]="KEY_PRESS",t[t.KEY_RELEASE=2]="KEY_RELEASE",t[t.MOUSE_MOVE=3]="MOUSE_MOVE",t[t.MOUSE_ENTER=4]="MOUSE_ENTER",t[t.MOUSE_LEAVE=5]="MOUSE_LEAVE",t[t.MOUSE_PRESS=6]="MOUSE_PRESS",t[t.MOUSE_DRAG=7]="MOUSE_DRAG",t[t.MOUSE_RELEASE=8]="MOUSE_RELEASE",t[t.MOUSE_WHEEL=9]="MOUSE_WHEEL",t[t.MOUSE_DROP=10]="MOUSE_DROP",t[t.MOUSE_ROTATE=11]="MOUSE_ROTATE",t[t.MOUSE_SCALE=12]="MOUSE_SCALE",t[t.MOUSE_SCALE_END=13]="MOUSE_SCALE_END",t[t.FOCUS_GAINED=14]="FOCUS_GAINED",t[t.FOCUS_LOST=15]="FOCUS_LOST",t[t.CLIPBOARD=16]="CLIPBOARD",t[t.MOUSE_MOVE_COALESCED=17]="MOUSE_MOVE_COALESCED",t[t.MOUSE_DRAG_COALESCED=18]="MOUSE_DRAG_COALESCED",t[t.CONTEXT_MENU_OPEN=19]="CONTEXT_MENU_OPEN",t[t.MOUSE_CANCEL=20]="MOUSE_CANCEL",t[t.APP_FOCUS_GAINED=21]="APP_FOCUS_GAINED",t[t.APP_FOCUS_LOST=22]="APP_FOCUS_LOST"})(fI||(fI={}));var gI;(function(t){t[t.MOUSE=0]="MOUSE",t[t.TOUCH=1]="TOUCH",t[t.STYLUS=2]="STYLUS",t[t.TRACKPAD=3]="TRACKPAD"})(gI||(gI={}));var SI;(function(t){t[t.MOBILE_NATIVE_NAVBAR=0]="MOBILE_NATIVE_NAVBAR"})(SI||(SI={}));var AI;(function(t){t[t.PREVIOUS=0]="PREVIOUS",t[t.NEXT=1]="NEXT"})(AI||(AI={}));var TI;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.US_QWERTY=1]="US_QWERTY",t[t.DVORAK=2]="DVORAK",t[t.GERMAN=3]="GERMAN",t[t.FRENCH_AZERTY=4]="FRENCH_AZERTY",t[t.HIRAGANA_KANA=5]="HIRAGANA_KANA",t[t.UK_MAC=6]="UK_MAC",t[t.UK_PC=7]="UK_PC",t[t.SWEDISH=8]="SWEDISH",t[t.FINNISH=9]="FINNISH",t[t.DANISH=10]="DANISH",t[t.NORWEGIAN=11]="NORWEGIAN",t[t.ITALIAN=12]="ITALIAN",t[t.SPANISH=13]="SPANISH",t[t.SPANISH_LATAM=14]="SPANISH_LATAM",t[t.CHINESE=15]="CHINESE",t[t.PORTUGUESE=16]="PORTUGUESE",t[t.KOREAN=17]="KOREAN"})(TI||(TI={}));var EI;(function(t){t[t.LINEAR=0]="LINEAR",t[t.BEZIER=1]="BEZIER",t[t.OSCILLATION=2]="OSCILLATION",t[t.SPRING=3]="SPRING"})(EI||(EI={}));var II;(function(t){t[t.SELF=0]="SELF",t[t.DESIGN=1]="DESIGN"})(II||(II={}));var RI;(function(t){t[t.NONE=0]="NONE",t[t.PRIMARY=1]="PRIMARY",t[t.SECONDARY=2]="SECONDARY"})(RI||(RI={}));var yI;(function(t){t[t.NONE=0]="NONE",t[t.START=1]="START",t[t.END=2]="END"})(yI||(yI={}));var bI;(function(t){t[t.SYNCED=0]="SYNCED",t[t.OFFLINE=1]="OFFLINE",t[t.SESSION_START=2]="SESSION_START",t[t.FORCED=3]="FORCED",t[t.LIMBOED_CHANGES=4]="LIMBOED_CHANGES"})(bI||(bI={}));var vI;(function(t){t[t.TEXT_MATCH=0]="TEXT_MATCH",t[t.LAYER_MATCH=1]="LAYER_MATCH",t[t.PAGE_MATCH=2]="PAGE_MATCH"})(vI||(vI={}));var CI;(function(t){t[t.TEXT=0]="TEXT",t[t.FRAME_OR_GROUP=1]="FRAME_OR_GROUP",t[t.COMPONENT=2]="COMPONENT",t[t.INSTANCE=3]="INSTANCE",t[t.IMAGE=4]="IMAGE",t[t.SHAPE=5]="SHAPE",t[t.OTHER=6]="OTHER"})(CI||(CI={}));var OI;(function(t){t[t.FIND=0]="FIND",t[t.REPLACE=1]="REPLACE"})(OI||(OI={}));var NI;(function(t){t[t.ACTIVE_PAGE=0]="ACTIVE_PAGE",t[t.ALL_PAGES=1]="ALL_PAGES"})(NI||(NI={}));var PI;(function(t){t[t.ONLY_ACTIVE=0]="ONLY_ACTIVE",t[t.ALL=1]="ALL"})(PI||(PI={}));var FI;(function(t){t[t.NONE=0]="NONE",t[t.UPPER_FIRST=1]="UPPER_FIRST",t[t.UPPER_ALL=2]="UPPER_ALL"})(FI||(FI={}));var DI;(function(t){t[t.NONE=0]="NONE",t[t.SELECT_ACTIVE=1]="SELECT_ACTIVE"})(DI||(DI={}));var xI;(function(t){t[t.ABOVE=0]="ABOVE",t[t.BELOW=1]="BELOW",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})(xI||(xI={}));var wI;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.TEXT_AUTOSUGGEST=1]="TEXT_AUTOSUGGEST",t[t.DESIGN_TO_CODE=2]="DESIGN_TO_CODE",t[t.DEV_MODE_FOCUS_VIEW=3]="DEV_MODE_FOCUS_VIEW",t[t.GLOBAL_DEBUGGING=4]="GLOBAL_DEBUGGING"})(wI||(wI={}));var LI;(function(t){t[t.HAS_CHILDREN=0]="HAS_CHILDREN",t[t.HAS_IDENTICAL_CHILDREN=1]="HAS_IDENTICAL_CHILDREN"})(LI||(LI={}));var MI;(function(t){t[t.IDLE=0]="IDLE",t[t.COLLECTION_SELECTED=1]="COLLECTION_SELECTED",t[t.FIELD_SELECTED=2]="FIELD_SELECTED"})(MI||(MI={}));var BI;(function(t){t[t.SIMPLE_SQUARE=0]="SIMPLE_SQUARE"})(BI||(BI={}));var GI;(function(t){t[t.TEXT=0]="TEXT",t[t.IMAGE=1]="IMAGE"})(GI||(GI={}));var UI;(function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TWITTER_POST=1]="TWITTER_POST",t[t.LINKEDIN_POST=2]="LINKEDIN_POST",t[t.INSTA_POST_SQUARE=3]="INSTA_POST_SQUARE",t[t.INSTA_POST_PORTRAIT=4]="INSTA_POST_PORTRAIT",t[t.INSTA_STORY=5]="INSTA_STORY",t[t.INSTA_AD=6]="INSTA_AD",t[t.FACEBOOK_POST=7]="FACEBOOK_POST",t[t.FACEBOOK_COVER_PHOTO=8]="FACEBOOK_COVER_PHOTO",t[t.FACEBOOK_EVENT_COVER=9]="FACEBOOK_EVENT_COVER",t[t.FACEBOOK_AD_PORTRAIT=10]="FACEBOOK_AD_PORTRAIT",t[t.FACEBOOK_AD_SQUARE=11]="FACEBOOK_AD_SQUARE",t[t.PINTEREST_AD_PIN=12]="PINTEREST_AD_PIN",t[t.TWITTER_BANNER=13]="TWITTER_BANNER",t[t.LINKEDIN_POST_SQUARE=14]="LINKEDIN_POST_SQUARE",t[t.LINKEDIN_POST_PORTRAIT=15]="LINKEDIN_POST_PORTRAIT",t[t.LINKEDIN_POST_LANDSCAPE=16]="LINKEDIN_POST_LANDSCAPE",t[t.LINKEDIN_PROFILE_BANNER=17]="LINKEDIN_PROFILE_BANNER",t[t.LINKEDIN_ARTICLE_BANNER=18]="LINKEDIN_ARTICLE_BANNER",t[t.LINKEDIN_AD_LANDSCAPE=19]="LINKEDIN_AD_LANDSCAPE",t[t.LINKEDIN_AD_SQUARE=20]="LINKEDIN_AD_SQUARE",t[t.LINKEDIN_AD_VERTICAL=21]="LINKEDIN_AD_VERTICAL",t[t.YOUTUBE_THUMBNAIL=22]="YOUTUBE_THUMBNAIL",t[t.YOUTUBE_BANNER=23]="YOUTUBE_BANNER",t[t.YOUTUBE_AD=24]="YOUTUBE_AD",t[t.TWITCH_BANNER=25]="TWITCH_BANNER",t[t.GOOGLE_LEADERBOARD_AD=26]="GOOGLE_LEADERBOARD_AD",t[t.GOOGLE_LARGE_AD=27]="GOOGLE_LARGE_AD",t[t.GOOGLE_MED_AD=28]="GOOGLE_MED_AD",t[t.GOOGLE_MOBILE_BANNER_AD=29]="GOOGLE_MOBILE_BANNER_AD",t[t.GOOGLE_SKYSCRAPER_AD=30]="GOOGLE_SKYSCRAPER_AD",t[t.CARD_HORIZONTAL=31]="CARD_HORIZONTAL",t[t.CARD_VERTICAL=32]="CARD_VERTICAL",t[t.PRINT_US_LETTER=33]="PRINT_US_LETTER",t[t.POSTER=34]="POSTER",t[t.BANNER_STANDARD=35]="BANNER_STANDARD",t[t.BANNER_WIDE=36]="BANNER_WIDE",t[t.BANNER_ULTRAWIDE=37]="BANNER_ULTRAWIDE",t[t.NAME_TAG_PORTRAIT=38]="NAME_TAG_PORTRAIT",t[t.NAME_TAG_LANDSCAPE=39]="NAME_TAG_LANDSCAPE",t[t.INSTA_REEL_COVER=40]="INSTA_REEL_COVER",t[t.ZOOM_BACKGROUND=41]="ZOOM_BACKGROUND",t[t.TIKTOK_POST=42]="TIKTOK_POST"})(UI||(UI={}));var VI;(function(t){t[t.TABLE=0]="TABLE",t[t.SINGLE_ASSET=1]="SINGLE_ASSET",t[t.GRID=2]="GRID"})(VI||(VI={}));var kI;(function(t){t[t.PROPERTIES_PANEL=0]="PROPERTIES_PANEL"})(kI||(kI={}));var HI;(function(t){t[t.PROPERTIES_PANEL=0]="PROPERTIES_PANEL"})(HI||(HI={}));var zI;(function(t){t[t.ADD=0]="ADD",t[t.REMOVE=1]="REMOVE"})(zI||(zI={}));var WI;(function(t){t[t.TOGGLE=0]="TOGGLE",t[t.SELECT_ALL_INSTANCES=1]="SELECT_ALL_INSTANCES"})(WI||(WI={}));var KI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.MERGE_IN_PROGRESS=1]="MERGE_IN_PROGRESS",t[t.PARSE_ERROR=2]="PARSE_ERROR",t[t.VERSION_MISMATCH=3]="VERSION_MISMATCH",t[t.INTERNAL_ERROR=4]="INTERNAL_ERROR"})(KI||(KI={}));var YI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.PARSE_ERROR=1]="PARSE_ERROR",t[t.VERSION_MISMATCH=2]="VERSION_MISMATCH",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR"})(YI||(YI={}));var QI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",t[t.INTERNAL_ERROR=2]="INTERNAL_ERROR",t[t.MISSING_BACKING_SYMBOL=3]="MISSING_BACKING_SYMBOL",t[t.VERSION_MISMATCH=4]="VERSION_MISMATCH"})(QI||(QI={}));var qI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",t[t.INVALID_INDEX=2]="INVALID_INDEX",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t[t.INVALID_STATE_TRANSITION=4]="INVALID_STATE_TRANSITION"})(qI||(qI={}));var XI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILURE=1]="FAILURE"})(XI||(XI={}));var jI;(function(t){t[t.SOURCE=0]="SOURCE",t[t.BRANCH=1]="BRANCH",t[t.COMPARE=2]="COMPARE"})(jI||(jI={}));var ZI;(function(t){t[t.UPDATED_LIBRARY=0]="UPDATED_LIBRARY",t[t.CREATED=1]="CREATED",t[t.REMOVED=2]="REMOVED",t[t.UPDATED=3]="UPDATED",t[t.UNMODIFIED=4]="UNMODIFIED"})(ZI||(ZI={}));var JI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",t[t.UNABLE_TO_UNDO_CHANGES=2]="UNABLE_TO_UNDO_CHANGES",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR"})(JI||(JI={}));var $I;(function(t){t[t.BASIS_PARENT=0]="BASIS_PARENT",t[t.PARENT=1]="PARENT"})($I||($I={}));var eR;(function(t){t[t.PREVIEW=0]="PREVIEW",t[t.STAGE=1]="STAGE"})(eR||(eR={}));var tR;(function(t){t[t.GENERIC=0]="GENERIC",t[t.STATE_GROUP=1]="STATE_GROUP",t[t.VARIABLE_COLLECTION=2]="VARIABLE_COLLECTION"})(tR||(tR={}));var rR;(function(t){t[t.STYLE_ATTACH=0]="STYLE_ATTACH",t[t.STYLE_DETACH=1]="STYLE_DETACH",t[t.VARIABLE_ATTACH=2]="VARIABLE_ATTACH",t[t.VARIABLE_DETACH=3]="VARIABLE_DETACH",t[t.IGNORE=4]="IGNORE",t[t.NONE=5]="NONE"})(rR||(rR={}));var nR;(function(t){t[t.DUPLICATION=0]="DUPLICATION",t[t.COPY_PASTE_FROM_SAME_FILE=1]="COPY_PASTE_FROM_SAME_FILE",t[t.COPY_PASTE_FROM_DIFFERENT_FILE=2]="COPY_PASTE_FROM_DIFFERENT_FILE",t[t.SWAPPING_FROM_LIBRARY_DRAG_AND_DROP=3]="SWAPPING_FROM_LIBRARY_DRAG_AND_DROP",t[t.SWAPPING_FROM_PROPERTIES_PANEL=4]="SWAPPING_FROM_PROPERTIES_PANEL",t[t.LIBRARY_DRAG_AND_DROP=5]="LIBRARY_DRAG_AND_DROP",t[t.PLAYGROUND=6]="PLAYGROUND",t[t.VIA_NODE_INSERTION=7]="VIA_NODE_INSERTION",t[t.DIRECT=8]="DIRECT",t[t.SLOT_PREFERRED_INSTANCE_INSERT=9]="SLOT_PREFERRED_INSTANCE_INSERT",t[t.UNKNOWN=10]="UNKNOWN"})(nR||(nR={}));var oR;(function(t){t[t.APPLE=0]="APPLE",t[t.NOTO=1]="NOTO"})(oR||(oR={}));var iR;(function(t){t[t.PNG=0]="PNG",t[t.SVG=1]="SVG",t[t.RASTERIZE=2]="RASTERIZE"})(iR||(iR={}));var aR;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.YES_WITHOUT_REORDER=2]="YES_WITHOUT_REORDER"})(aR||(aR={}));var sR;(function(t){t[t.SHAPES_SIDEBAR_REGULAR=0]="SHAPES_SIDEBAR_REGULAR",t[t.SHAPES_SIDEBAR_RECENTS=1]="SHAPES_SIDEBAR_RECENTS",t[t.OTHER=2]="OTHER",t[t.NONE=3]="NONE"})(sR||(sR={}));var lR;(function(t){t[t.CURRENT_TAB=0]="CURRENT_TAB",t[t.NEW_TAB=1]="NEW_TAB"})(lR||(lR={}));var cR;(function(t){t[t.SEARCH=0]="SEARCH",t[t.PREFERENCES=1]="PREFERENCES",t[t.HIDE_UI=2]="HIDE_UI"})(cR||(cR={}));var dR;(function(t){t[t.COPY_PASTE=0]="COPY_PASTE",t[t.COMPONENT_IMPORT=1]="COMPONENT_IMPORT",t[t.STATE_GROUP_IMPORT=2]="STATE_GROUP_IMPORT",t[t.STYLE_IMPORT=3]="STYLE_IMPORT",t[t.BRANCH_MERGE=4]="BRANCH_MERGE",t[t.TEMPLATE_INSERTION=5]="TEMPLATE_INSERTION",t[t.VARIABLE_IMPORT=6]="VARIABLE_IMPORT",t[t.VARIABLE_SET_IMPORT=7]="VARIABLE_SET_IMPORT",t[t.PLAYGROUND_INSERT=8]="PLAYGROUND_INSERT",t[t.MODULE_IMPORT=9]="MODULE_IMPORT"})(dR||(dR={}));var uR;(function(t){t[t.SOLID=0]="SOLID",t[t.DASHED=1]="DASHED",t[t.NONE=2]="NONE"})(uR||(uR={}));var pR;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(pR||(pR={}));var _R;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(_R||(_R={}));var hR;(function(t){t[t.ACTIVE_SCENE=0]="ACTIVE_SCENE",t[t.PLAYGROUND_SCENE=1]="PLAYGROUND_SCENE",t[t.LINTER_SCENE=2]="LINTER_SCENE",t[t.LIBRARY_PREVIEW_SCENE=3]="LIBRARY_PREVIEW_SCENE"})(hR||(hR={}));var mR;(function(t){t[t.NONE=0]="NONE",t[t.BLACK=1]="BLACK",t[t.GRAY_DARK=2]="GRAY_DARK",t[t.GRAY=3]="GRAY",t[t.GRAY_LIGHT=4]="GRAY_LIGHT",t[t.RED=5]="RED",t[t.RED_LIGHT=6]="RED_LIGHT",t[t.ORANGE=7]="ORANGE",t[t.ORANGE_LIGHT=8]="ORANGE_LIGHT",t[t.YELLOW=9]="YELLOW",t[t.YELLOW_LIGHT=10]="YELLOW_LIGHT",t[t.GREEN=11]="GREEN",t[t.GREEN_LIGHT=12]="GREEN_LIGHT",t[t.BLUE=13]="BLUE",t[t.BLUE_LIGHT=14]="BLUE_LIGHT",t[t.VIOLET=15]="VIOLET",t[t.VIOLET_LIGHT=16]="VIOLET_LIGHT",t[t.WHITE=17]="WHITE",t[t.PINK=18]="PINK",t[t.PINK_LIGHT=19]="PINK_LIGHT",t[t.INDIGO=20]="INDIGO",t[t.INDIGO_LIGHT=21]="INDIGO_LIGHT",t[t.COBALT=22]="COBALT",t[t.COBALT_LIGHT=23]="COBALT_LIGHT",t[t.TEAL=24]="TEAL",t[t.TEAL_LIGHT=25]="TEAL_LIGHT",t[t.OLIVE=26]="OLIVE",t[t.OLIVE_LIGHT=27]="OLIVE_LIGHT",t[t.STICKY_GRAY=28]="STICKY_GRAY",t[t.STICKY_GRAY_UI3=29]="STICKY_GRAY_UI3",t[t.STICKY_RED=30]="STICKY_RED",t[t.STICKY_ORANGE=31]="STICKY_ORANGE",t[t.STICKY_YELLOW=32]="STICKY_YELLOW",t[t.STICKY_GREEN=33]="STICKY_GREEN",t[t.STICKY_BLUE=34]="STICKY_BLUE",t[t.STICKY_VIOLET=35]="STICKY_VIOLET",t[t.STICKY_PINK=36]="STICKY_PINK",t[t.STICKY_GRAY_LIGHT=37]="STICKY_GRAY_LIGHT",t[t.STICKY_INDIGO=38]="STICKY_INDIGO",t[t.STICKY_COBALT=39]="STICKY_COBALT",t[t.STICKY_TEAL=40]="STICKY_TEAL",t[t.STICKY_OLIVE=41]="STICKY_OLIVE",t[t.HIGHLIGHT_GRAY=42]="HIGHLIGHT_GRAY",t[t.HIGHLIGHT_RED=43]="HIGHLIGHT_RED",t[t.HIGHLIGHT_YELLOW=44]="HIGHLIGHT_YELLOW",t[t.HIGHLIGHT_GREEN=45]="HIGHLIGHT_GREEN",t[t.HIGHLIGHT_BLUE=46]="HIGHLIGHT_BLUE",t[t.HIGHLIGHT_VIOLET=47]="HIGHLIGHT_VIOLET",t[t.HIGHLIGHT_ORANGE=48]="HIGHLIGHT_ORANGE",t[t.HIGHLIGHT_WHITE=49]="HIGHLIGHT_WHITE",t[t.CODE_BLOCK_DRACULA=50]="CODE_BLOCK_DRACULA",t[t.CODE_BLOCK_DUOTONE_LIGHT=51]="CODE_BLOCK_DUOTONE_LIGHT",t[t.CODE_BLOCK_DUOTONE_SEA=52]="CODE_BLOCK_DUOTONE_SEA",t[t.CODE_BLOCK_DUOTONE_SPACE=53]="CODE_BLOCK_DUOTONE_SPACE",t[t.CODE_BLOCK_DUOTONE_EARTH=54]="CODE_BLOCK_DUOTONE_EARTH",t[t.CODE_BLOCK_DUOTONE_FOREST=55]="CODE_BLOCK_DUOTONE_FOREST",t[t.CUSTOM=56]="CUSTOM"})(mR||(mR={}));var fR;(function(t){t[t.LAYERS=0]="LAYERS",t[t.ASSETS=1]="ASSETS",t[t.CODE=2]="CODE",t[t.CHAT=3]="CHAT",t[t.DESIGN_SYSTEM=4]="DESIGN_SYSTEM"})(fR||(fR={}));var gR;(function(t){t[t.NEXT=0]="NEXT",t[t.PREVIOUS=1]="PREVIOUS",t[t.COMMIT=2]="COMMIT",t[t.CANCEL=3]="CANCEL",t[t.CLEAR=4]="CLEAR"})(gR||(gR={}));var SR;(function(t){t[t.VISIBLE=0]="VISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.TRANSPARENT_CUSTOM=2]="TRANSPARENT_CUSTOM",t[t.HIDDEN=3]="HIDDEN"})(SR||(SR={}));var AR;(function(t){t[t.COPY_TO_CLIPBOARD=0]="COPY_TO_CLIPBOARD",t[t.COMPOSE_EMAIL=1]="COMPOSE_EMAIL"})(AR||(AR={}));var TR;(function(t){t[t.PLACEHOLDER=1]="PLACEHOLDER",t[t.COMMENTS_A11Y=2]="COMMENTS_A11Y",t[t.COLLAB_TOOLS_IN_DESIGN=3]="COLLAB_TOOLS_IN_DESIGN",t[t.NAVBAR_IN_DESIGN=4]="NAVBAR_IN_DESIGN",t[t.COLLAB_TOOL_SHORTCUTS_IN_DESIGN=5]="COLLAB_TOOL_SHORTCUTS_IN_DESIGN"})(TR||(TR={}));var ER;(function(t){t[t.RULER=0]="RULER",t[t.GUIDE=1]="GUIDE",t[t.BOTH=2]="BOTH"})(ER||(ER={}));var IR;(function(t){t[t.GENERIC=0]="GENERIC",t[t.SNAP=1]="SNAP",t[t.LEVEL=2]="LEVEL"})(IR||(IR={}));var RR;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(RR||(RR={}));var yR;(function(t){t[t.FIGMA=0]="FIGMA",t[t.SITE=1]="SITE"})(yR||(yR={}));var bR;(function(t){t[t.TRANSLATE_TEXT=0]="TRANSLATE_TEXT",t[t.REWRITE_TEXT=1]="REWRITE_TEXT",t[t.SHORTEN_TEXT=2]="SHORTEN_TEXT",t[t.FIRST_DRAFT=3]="FIRST_DRAFT",t[t.FIRST_DRAFT_MAKE_CHANGES=4]="FIRST_DRAFT_MAKE_CHANGES",t[t.FIRST_DRAFT_MAKE_KIT_DEBUG=5]="FIRST_DRAFT_MAKE_KIT_DEBUG",t[t.FIND_INSPIRATION=6]="FIND_INSPIRATION",t[t.REMOVE_BACKGROUND=7]="REMOVE_BACKGROUND",t[t.AUTO_RENAME_LAYERS=8]="AUTO_RENAME_LAYERS",t[t.GENERATE_IMAGE=9]="GENERATE_IMAGE",t[t.MAGIC_LINK=10]="MAGIC_LINK",t[t.CONTENT_FILL=11]="CONTENT_FILL",t[t.SLIDES_REWRITE_TEXT=12]="SLIDES_REWRITE_TEXT",t[t.ASSISTANT_CHAT=13]="ASSISTANT_CHAT",t[t.MAKE_EDITS=14]="MAKE_EDITS",t[t.UPSCALE_IMAGE=15]="UPSCALE_IMAGE",t[t.FIRST_DRAFT_FINE_TUNE=16]="FIRST_DRAFT_FINE_TUNE",t[t.EDIT_IMAGE=17]="EDIT_IMAGE"})(bR||(bR={}));var vR;(function(t){t[t.CONTEXT_MENU=0]="CONTEXT_MENU",t[t.QUICK_ACTIONS=1]="QUICK_ACTIONS",t[t.CREATE_COMPONENT=2]="CREATE_COMPONENT",t[t.CREATE_FRAME=3]="CREATE_FRAME",t[t.DRAW_FRAME_AROUND_NODES=4]="DRAW_FRAME_AROUND_NODES",t[t.STACK_SELECTION=5]="STACK_SELECTION",t[t.FIRST_DRAFT_LINT=6]="FIRST_DRAFT_LINT",t[t.EXPORT_FRAME=7]="EXPORT_FRAME",t[t.EXPORT_PICKER=8]="EXPORT_PICKER",t[t.MAGIC_LINK=9]="MAGIC_LINK",t[t.READY_FOR_DEV=10]="READY_FOR_DEV",t[t.LAYERS_PANEL_ACTION_ROW=11]="LAYERS_PANEL_ACTION_ROW",t[t.LAYERS_PANEL_OVERFLOW_MENU=12]="LAYERS_PANEL_OVERFLOW_MENU"})(vR||(vR={}));var CR;(function(t){t[t.CURRENT=0]="CURRENT",t[t.FIRST_DRAFT=1]="FIRST_DRAFT"})(CR||(CR={}));var OR;(function(t){t[t.EMPTY=0]="EMPTY",t[t.RESIZING_WIDTH_AND_HEIGHT=1]="RESIZING_WIDTH_AND_HEIGHT",t[t.RESIZING_HEIGHT=2]="RESIZING_HEIGHT",t[t.RESIZING_NONE=3]="RESIZING_NONE",t[t.TRUNCATION_DISABLED=4]="TRUNCATION_DISABLED",t[t.TRUNCATION_ENABLED=5]="TRUNCATION_ENABLED",t[t.ALIGNMENT_LEFT=6]="ALIGNMENT_LEFT",t[t.ALIGNMENT_CENTER=7]="ALIGNMENT_CENTER",t[t.ALIGNMENT_RIGHT=8]="ALIGNMENT_RIGHT",t[t.ALIGNMENT_JUSTIFIED=9]="ALIGNMENT_JUSTIFIED",t[t.DECORATION_NONE=10]="DECORATION_NONE",t[t.DECORATION_UNDERLINE=11]="DECORATION_UNDERLINE",t[t.DECORATION_STRIKETHROUGH=12]="DECORATION_STRIKETHROUGH",t[t.LIST_STYLE_PLAIN=13]="LIST_STYLE_PLAIN",t[t.LIST_STYLE_UNORDERED=14]="LIST_STYLE_UNORDERED",t[t.LIST_STYLE_ORDERED=15]="LIST_STYLE_ORDERED",t[t.TEXT_CASE_ORIGINAL=16]="TEXT_CASE_ORIGINAL",t[t.TEXT_CASE_UPPER=17]="TEXT_CASE_UPPER",t[t.TEXT_CASE_LOWER=18]="TEXT_CASE_LOWER",t[t.TEXT_CASE_TITLE=19]="TEXT_CASE_TITLE",t[t.TEXT_CASE_SMALL_CAPS=20]="TEXT_CASE_SMALL_CAPS",t[t.TEXT_CASE_SMALL_CAPS_FORCED=21]="TEXT_CASE_SMALL_CAPS_FORCED",t[t.FRACTIONS_ON=22]="FRACTIONS_ON",t[t.FRACTIONS_OFF=23]="FRACTIONS_OFF",t[t.DISCRETIONARY_LIGATURES_ON=24]="DISCRETIONARY_LIGATURES_ON",t[t.DISCRETIONARY_LIGATURES_OFF=25]="DISCRETIONARY_LIGATURES_OFF",t[t.HISTORICAL_LIGATURES_ON=26]="HISTORICAL_LIGATURES_ON",t[t.HISTORICAL_LIGATURES_OFF=27]="HISTORICAL_LIGATURES_OFF",t[t.NUMERIC_STYLE_ORIGINAL=28]="NUMERIC_STYLE_ORIGINAL",t[t.NUMERIC_STYLE_UPPER_PROPORTIONAL=29]="NUMERIC_STYLE_UPPER_PROPORTIONAL",t[t.NUMERIC_STYLE_UPPER_MONOSPACE=30]="NUMERIC_STYLE_UPPER_MONOSPACE",t[t.NUMERIC_STYLE_LOWER_PROPORTIONAL=31]="NUMERIC_STYLE_LOWER_PROPORTIONAL",t[t.NUMERIC_STYLE_LOWER_MONOSPACE=32]="NUMERIC_STYLE_LOWER_MONOSPACE",t[t.NUMERIC_POSITION_SUB=33]="NUMERIC_POSITION_SUB",t[t.NUMERIC_POSITION_SUPER=34]="NUMERIC_POSITION_SUPER",t[t.NUMERIC_POSITION_NORMAL=35]="NUMERIC_POSITION_NORMAL",t[t.OPENTYPE_FEATURE_ON=36]="OPENTYPE_FEATURE_ON",t[t.OPENTYPE_FEATURE_OFF=37]="OPENTYPE_FEATURE_OFF",t[t.FONT_VARIATIONS=38]="FONT_VARIATIONS",t[t.LEADING_TRIM_CAP_HEIGHT=39]="LEADING_TRIM_CAP_HEIGHT",t[t.LEADING_TRIM_NONE=40]="LEADING_TRIM_NONE",t[t.HANGING_PUNCTUATION_ON=41]="HANGING_PUNCTUATION_ON",t[t.HANGING_PUNCTUATION_OFF=42]="HANGING_PUNCTUATION_OFF",t[t.HANGING_LISTS_ON=43]="HANGING_LISTS_ON",t[t.HANGING_LISTS_OFF=44]="HANGING_LISTS_OFF",t[t.DECORATION_STYLE_SOLID=45]="DECORATION_STYLE_SOLID",t[t.DECORATION_STYLE_DOTTED=46]="DECORATION_STYLE_DOTTED",t[t.DECORATION_STYLE_WAVY=47]="DECORATION_STYLE_WAVY",t[t.DECORATION_SKIP_INK_ON=48]="DECORATION_SKIP_INK_ON",t[t.DECORATION_SKIP_INK_OFF=49]="DECORATION_SKIP_INK_OFF"})(OR||(OR={}));var NR;(function(t){t[t.CURRENT_PAGE=0]="CURRENT_PAGE",t[t.ALL_PAGES=1]="ALL_PAGES",t[t.CURRENT_SELECTION=2]="CURRENT_SELECTION"})(NR||(NR={}));var PR;(function(t){t[t.LOADED=0]="LOADED",t[t.LOADING=1]="LOADING",t[t.FAILED=2]="FAILED"})(PR||(PR={}));var FR;(function(t){t[t.PLUGIN=0]="PLUGIN",t[t.NON_PLUGIN=1]="NON_PLUGIN"})(FR||(FR={}));var DR;(function(t){t[t.ULTRACONDENSED=1]="ULTRACONDENSED",t[t.EXTRACONDENSED=2]="EXTRACONDENSED",t[t.CONDENSED=3]="CONDENSED",t[t.SEMICONDENSED=4]="SEMICONDENSED",t[t.NORMAL=5]="NORMAL",t[t.SEMIEXPANDED=6]="SEMIEXPANDED",t[t.EXPANDED=7]="EXPANDED",t[t.EXTRAEXPANDED=8]="EXTRAEXPANDED",t[t.ULTRAEXPANDED=9]="ULTRAEXPANDED"})(DR||(DR={}));var xR;(function(t){t[t.AUTOMATIC=0]="AUTOMATIC",t[t.WHEN_REQUESTED=1]="WHEN_REQUESTED"})(xR||(xR={}));var wR;(function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"})(wR||(wR={}));var LR;(function(t){t[t.MIN=0]="MIN",t[t.CENTER=1]="CENTER",t[t.MAX=2]="MAX",t[t.SPACE_EVENLY=3]="SPACE_EVENLY",t[t.SPACE_BETWEEN=4]="SPACE_BETWEEN"})(LR||(LR={}));var MR;(function(t){t[t.MIN=0]="MIN",t[t.CENTER=1]="CENTER",t[t.MAX=2]="MAX",t[t.BASELINE=3]="BASELINE"})(MR||(MR={}));var BR;(function(t){t[t.MIN=0]="MIN",t[t.CENTER=1]="CENTER",t[t.MAX=2]="MAX",t[t.STRETCH=3]="STRETCH",t[t.AUTO=4]="AUTO",t[t.BASELINE=5]="BASELINE"})(BR||(BR={}));var GR;(function(t){t[t.AUTO=0]="AUTO",t[t.ABSOLUTE=1]="ABSOLUTE"})(GR||(GR={}));var UR;(function(t){t[t.FIXED=0]="FIXED",t[t.RESIZE_TO_FIT=1]="RESIZE_TO_FIT",t[t.RESIZE_TO_FIT_WITH_IMPLICIT_SIZE=2]="RESIZE_TO_FIT_WITH_IMPLICIT_SIZE"})(UR||(UR={}));var VR;(function(t){t[t.PACKED=0]="PACKED",t[t.SPACE_BETWEEN=1]="SPACE_BETWEEN"})(VR||(VR={}));var kR;(function(t){t[t.PADDING_TOP=0]="PADDING_TOP",t[t.PADDING_RIGHT=1]="PADDING_RIGHT",t[t.PADDING_BOTTOM=2]="PADDING_BOTTOM",t[t.PADDING_LEFT=3]="PADDING_LEFT",t[t.PADDING_HORIZONTAL=4]="PADDING_HORIZONTAL",t[t.PADDING_VERTICAL=5]="PADDING_VERTICAL",t[t.PADDING_ALL=6]="PADDING_ALL",t[t.SPACING=7]="SPACING",t[t.COUNTER_SPACING=8]="COUNTER_SPACING"})(kR||(kR={}));var HR;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(HR||(HR={}));var zR;(function(t){t[t.LAYOUT=0]="LAYOUT",t[t.HISTORY=1]="HISTORY",t[t.PREVIEW=2]="PREVIEW",t[t.BRANCHING=3]="BRANCHING",t[t.DEV_HANDOFF=4]="DEV_HANDOFF",t[t.LIBRARY=5]="LIBRARY"})(zR||(zR={}));var WR;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DRAGGING=1]="DRAGGING",t[t.RESIZING=2]="RESIZING",t[t.ROTATING=3]="ROTATING",t[t.SELECTING_TEXT=4]="SELECTING_TEXT",t[t.CLICKING_TO_CHANGE_SELECTION=5]="CLICKING_TO_CHANGE_SELECTION",t[t.PREVIEWING_OBJECT_ANIMATION=6]="PREVIEWING_OBJECT_ANIMATION"})(WR||(WR={}));var KR;(function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON",t[t.MIXED=2]="MIXED"})(KR||(KR={}));var YR;(function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR"})(YR||(YR={}));var QR;(function(t){t[t.NONE=0]="NONE",t[t.PHONE=1]="PHONE",t[t.TABLET=2]="TABLET",t[t.DESKTOP=3]="DESKTOP",t[t.WATCH=4]="WATCH",t[t.PAPER=5]="PAPER",t[t.SOCIALMEDIA=6]="SOCIALMEDIA",t[t.FIGMA=7]="FIGMA",t[t.PRESENTATION=8]="PRESENTATION",t[t.ARCHIVE=9]="ARCHIVE"})(QR||(QR={}));var qR;(function(t){t[t.NONE=0]="NONE",t[t.SELECT=1]="SELECT",t[t.HAND=2]="HAND",t[t.COMMENTS=3]="COMMENTS",t[t.DROPPER_COLOR=4]="DROPPER_COLOR",t[t.FRAME=5]="FRAME",t[t.SLICE=6]="SLICE",t[t.STACK=7]="STACK",t[t.SHAPE_STAR=8]="SHAPE_STAR",t[t.SHAPE_LINE=9]="SHAPE_LINE",t[t.SHAPE_ARROW=10]="SHAPE_ARROW",t[t.SHAPE_ELLIPSE=11]="SHAPE_ELLIPSE",t[t.SHAPE_RECTANGLE=12]="SHAPE_RECTANGLE",t[t.SHAPE_REGULAR_POLYGON=13]="SHAPE_REGULAR_POLYGON",t[t.VECTOR_PEN=14]="VECTOR_PEN",t[t.VECTOR_PENCIL=15]="VECTOR_PENCIL",t[t.VECTOR_BEND=16]="VECTOR_BEND",t[t.VECTOR_CUT=17]="VECTOR_CUT",t[t.VECTOR_PAINT_BUCKET=18]="VECTOR_PAINT_BUCKET",t[t.VECTOR_VAR_WIDTH_POINT=19]="VECTOR_VAR_WIDTH_POINT",t[t.SHAPE_BUILDER=20]="SHAPE_BUILDER",t[t.VECTOR_LASSO=21]="VECTOR_LASSO",t[t.IMAGE_LASSO=22]="IMAGE_LASSO",t[t.TYPE=23]="TYPE",t[t.SCALE=24]="SCALE",t[t.STICKY=25]="STICKY",t[t.STAMP=26]="STAMP",t[t.SHAPE_WHITEBOARD_SQUARE=27]="SHAPE_WHITEBOARD_SQUARE",t[t.SHAPE_WHITEBOARD_ELLIPSE=28]="SHAPE_WHITEBOARD_ELLIPSE",t[t.SHAPE_WHITEBOARD_DIAMOND=29]="SHAPE_WHITEBOARD_DIAMOND",t[t.SHAPE_WHITEBOARD_TRIANGLE_UP=30]="SHAPE_WHITEBOARD_TRIANGLE_UP",t[t.SHAPE_WHITEBOARD_TRIANGLE_DOWN=31]="SHAPE_WHITEBOARD_TRIANGLE_DOWN",t[t.SHAPE_WHITEBOARD_ROUNDED_RECTANGLE=32]="SHAPE_WHITEBOARD_ROUNDED_RECTANGLE",t[t.SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT=33]="SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT",t[t.SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT=34]="SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT",t[t.CONNECTOR_ELBOWED=35]="CONNECTOR_ELBOWED",t[t.CONNECTOR_STRAIGHT=36]="CONNECTOR_STRAIGHT",t[t.CONNECTOR_CURVED=37]="CONNECTOR_CURVED",t[t.CODE_BLOCK=38]="CODE_BLOCK",t[t.SHAPE_WHITEBOARD_ENG_DATABASE=39]="SHAPE_WHITEBOARD_ENG_DATABASE",t[t.SHAPE_WHITEBOARD_ENG_QUEUE=40]="SHAPE_WHITEBOARD_ENG_QUEUE",t[t.SHAPE_WHITEBOARD_ENG_FILE=41]="SHAPE_WHITEBOARD_ENG_FILE",t[t.SHAPE_WHITEBOARD_ENG_FOLDER=42]="SHAPE_WHITEBOARD_ENG_FOLDER",t[t.ERASER=43]="ERASER",t[t.HIGHLIGHTER=44]="HIGHLIGHTER",t[t.SECTION=45]="SECTION",t[t.WASHI_TAPE=46]="WASHI_TAPE",t[t.TABLE=47]="TABLE",t[t.SHAPE_WHITEBOARD_TRAPEZOID=48]="SHAPE_WHITEBOARD_TRAPEZOID",t[t.SHAPE_WHITEBOARD_STAR=49]="SHAPE_WHITEBOARD_STAR",t[t.SHAPE_WHITEBOARD_SHIELD=50]="SHAPE_WHITEBOARD_SHIELD",t[t.SHAPE_WHITEBOARD_HEXAGON=51]="SHAPE_WHITEBOARD_HEXAGON",t[t.SHAPE_WHITEBOARD_PENTAGON=52]="SHAPE_WHITEBOARD_PENTAGON",t[t.SHAPE_WHITEBOARD_OCTAGON=53]="SHAPE_WHITEBOARD_OCTAGON",t[t.SHAPE_WHITEBOARD_PLUS=54]="SHAPE_WHITEBOARD_PLUS",t[t.SHAPE_WHITEBOARD_PREDEFINED_PROCESS=55]="SHAPE_WHITEBOARD_PREDEFINED_PROCESS",t[t.SHAPE_WHITEBOARD_MANUAL_INPUT=56]="SHAPE_WHITEBOARD_MANUAL_INPUT",t[t.SHAPE_WHITEBOARD_CHEVRON=57]="SHAPE_WHITEBOARD_CHEVRON",t[t.SHAPE_WHITEBOARD_DOCUMENT_SINGLE=58]="SHAPE_WHITEBOARD_DOCUMENT_SINGLE",t[t.SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE=59]="SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE",t[t.SHAPE_WHITEBOARD_ARROW_LEFT=60]="SHAPE_WHITEBOARD_ARROW_LEFT",t[t.SHAPE_WHITEBOARD_ARROW_RIGHT=61]="SHAPE_WHITEBOARD_ARROW_RIGHT",t[t.SHAPE_WHITEBOARD_SUMMING_JUNCTION=62]="SHAPE_WHITEBOARD_SUMMING_JUNCTION",t[t.SHAPE_WHITEBOARD_OR=63]="SHAPE_WHITEBOARD_OR",t[t.SHAPE_WHITEBOARD_SPEECH_BUBBLE=64]="SHAPE_WHITEBOARD_SPEECH_BUBBLE",t[t.SHAPE_WHITEBOARD_INTERNAL_STORAGE=65]="SHAPE_WHITEBOARD_INTERNAL_STORAGE",t[t.SHAPE_WHITEBOARD_MINDMAP_TREE_NUCLEUS=66]="SHAPE_WHITEBOARD_MINDMAP_TREE_NUCLEUS",t[t.SHAPE_WHITEBOARD_PLATFORM=67]="SHAPE_WHITEBOARD_PLATFORM",t[t.ANNOTATE=68]="ANNOTATE",t[t.IMAGE_OR_VIDEO=69]="IMAGE_OR_VIDEO",t[t.MEASURE=70]="MEASURE",t[t.SLIDES_POLL=71]="SLIDES_POLL",t[t.SLIDES_EMBED=72]="SLIDES_EMBED",t[t.SLIDES_FACEPILE=73]="SLIDES_FACEPILE",t[t.SLIDES_ALIGNMENT_SCALE=74]="SLIDES_ALIGNMENT_SCALE",t[t.SLIDES_YOUTUBE=75]="SLIDES_YOUTUBE",t[t.SLIDE_NUMBER=76]="SLIDE_NUMBER",t[t.HAND_SELECT=77]="HAND_SELECT",t[t.MULTISELECT=78]="MULTISELECT",t[t.LASSO=79]="LASSO",t[t.SITES_RESPONSIVE_SET=80]="SITES_RESPONSIVE_SET",t[t.SITES_RESPONSIVE_NODE_SET=81]="SITES_RESPONSIVE_NODE_SET",t[t.SITES_LINK=82]="SITES_LINK",t[t.CODE_COMPONENT=83]="CODE_COMPONENT",t[t.SITES_EMBED=84]="SITES_EMBED",t[t.PATTERN_SOURCE_SELECTOR=85]="PATTERN_SOURCE_SELECTOR",t[t.BRUSH=86]="BRUSH",t[t.KEYBOARD_SELECT=87]="KEYBOARD_SELECT",t[t.JSX=88]="JSX",t[t.OFFSET_PATH=89]="OFFSET_PATH",t[t.SIMPLIFY_VECTOR=90]="SIMPLIFY_VECTOR",t[t.SITES_WEBPAGE=91]="SITES_WEBPAGE"})(qR||(qR={}));var XR;(function(t){t[t.MISSING=0]="MISSING",t[t.PRESENT=1]="PRESENT",t[t.MIXED=2]="MIXED",t[t.MIXED_VALUES_FIRST=3]="MIXED_VALUES_FIRST",t[t.MIXED_VALUES_NEXT=4]="MIXED_VALUES_NEXT"})(XR||(XR={}));var jR;(function(t){t[t.FRAME_PRESETS=0]="FRAME_PRESETS",t[t.PENCIL_TOOL=1]="PENCIL_TOOL",t[t.CANVAS_ITEM=2]="CANVAS_ITEM",t[t.TRANSFORM_ITEM=3]="TRANSFORM_ITEM",t[t.COMPONENT_ITEM=4]="COMPONENT_ITEM",t[t.INSTANCE_ITEM=5]="INSTANCE_ITEM",t[t.STATE_GROUP_ITEM=6]="STATE_GROUP_ITEM",t[t.CONSTRAINTS_ITEM=7]="CONSTRAINTS_ITEM",t[t.GRIDS_ITEM=8]="GRIDS_ITEM",t[t.MASK_ITEM=9]="MASK_ITEM",t[t.LAYER_ITEM=10]="LAYER_ITEM",t[t.TYPE_ITEM=11]="TYPE_ITEM",t[t.FILL_ITEM=12]="FILL_ITEM",t[t.STROKE_ITEM=13]="STROKE_ITEM",t[t.EFFECTS_ITEM=14]="EFFECTS_ITEM",t[t.EXPORT_ITEM=15]="EXPORT_ITEM",t[t.STACK_ITEM=16]="STACK_ITEM",t[t.SCALE_ITEM=17]="SCALE_ITEM",t[t.REMOVE_GROUP_BACKGROUND_ITEM=18]="REMOVE_GROUP_BACKGROUND_ITEM",t[t.JSX_ITEM=19]="JSX_ITEM",t[t.OVERFLOW_ITEM=20]="OVERFLOW_ITEM",t[t.SELECTION_COLORS=21]="SELECTION_COLORS",t[t.VARIABLE_MODE_ITEM=22]="VARIABLE_MODE_ITEM",t[t.VARIABLE_PAGE_LEVEL_MODE_ITEM=23]="VARIABLE_PAGE_LEVEL_MODE_ITEM",t[t.SLIDES_ANIMATION=24]="SLIDES_ANIMATION",t[t.SLIDES_OBJECT_ANIMATION=25]="SLIDES_OBJECT_ANIMATION",t[t.SLIDES_EMBED=26]="SLIDES_EMBED",t[t.SLIDES_INTERACTIVE_WIDGET=27]="SLIDES_INTERACTIVE_WIDGET",t[t.SLIDES_OPACITY_ITEM=28]="SLIDES_OPACITY_ITEM",t[t.IMAGE_ITEM=29]="IMAGE_ITEM",t[t.SLIDES_THEME=30]="SLIDES_THEME",t[t.CODE_BLOCK_ITEM=31]="CODE_BLOCK_ITEM",t[t.SLIDE_NUMBER=32]="SLIDE_NUMBER",t[t.SITES_POSITION_ITEM=33]="SITES_POSITION_ITEM",t[t.SITES_LINK_ITEM=34]="SITES_LINK_ITEM",t[t.SITES_PAGE_METADATA_ITEM=35]="SITES_PAGE_METADATA_ITEM",t[t.SITES_ACCESSIBILITY_ITEM=36]="SITES_ACCESSIBILITY_ITEM",t[t.SITES_HTML_WIDGET_ITEM=37]="SITES_HTML_WIDGET_ITEM",t[t.SITES_INTERACTIONS_ITEM=38]="SITES_INTERACTIONS_ITEM",t[t.SITES_RESPONSIVENESS_ITEM=39]="SITES_RESPONSIVENESS_ITEM",t[t.SITES_CODE_COMPONENT_ITEM=40]="SITES_CODE_COMPONENT_ITEM",t[t.CODE_INSTANCE_HTML_FIBER=41]="CODE_INSTANCE_HTML_FIBER",t[t.TRANSFORM_MODIFIERS_ITEM=42]="TRANSFORM_MODIFIERS_ITEM",t[t.VECTOR_TRANSFORM_UNIFIED_ITEM=43]="VECTOR_TRANSFORM_UNIFIED_ITEM",t[t.SLOT_ITEM=44]="SLOT_ITEM",t[t.GRID_TRACKS=45]="GRID_TRACKS",t[t.RULER_GUIDES=46]="RULER_GUIDES",t[t.NUM_VALUES=47]="NUM_VALUES"})(jR||(jR={}));var ZR;(function(t){t[t.FRAME_PRESETS_ITEM=0]="FRAME_PRESETS_ITEM",t[t.CORNER_RADIUS=1]="CORNER_RADIUS",t[t.FRAME_OPTIONS=2]="FRAME_OPTIONS",t[t.COUNT=3]="COUNT",t[t.STAR_INNER_SCALE=4]="STAR_INNER_SCALE",t[t.RECTANGLE_CORNER_RADII=5]="RECTANGLE_CORNER_RADII",t[t.FIXED_FRAME_OPTIONS=6]="FIXED_FRAME_OPTIONS",t[t.ARC_DATA=7]="ARC_DATA",t[t.TRANSFORM=8]="TRANSFORM",t[t.SIZE=9]="SIZE",t[t.ANGLE=10]="ANGLE",t[t.SECTION_ITEM=11]="SECTION_ITEM",t[t.NUM_VALUES=12]="NUM_VALUES"})(ZR||(ZR={}));var JR;(function(t){t[t.TEXT_ALIGN_HORIZONTAL=0]="TEXT_ALIGN_HORIZONTAL",t[t.TEXT_ALIGN_VERTICAL=1]="TEXT_ALIGN_VERTICAL",t[t.TEXT_AUTO_RESIZE=2]="TEXT_AUTO_RESIZE",t[t.TEXT_STYLE=3]="TEXT_STYLE",t[t.TEXT_TRUNCATION=4]="TEXT_TRUNCATION",t[t.NUM_VALUES=5]="NUM_VALUES"})(JR||(JR={}));var $R;(function(t){t[t.NOT_APPLICABLE=0]="NOT_APPLICABLE",t[t.YES=1]="YES",t[t.NO=2]="NO"})($R||($R={}));var e0;(function(t){t[t.STATE_GROUP=0]="STATE_GROUP",t[t.STATE=1]="STATE",t[t.STATE_INSTANCE=2]="STATE_INSTANCE",t[t.STATE_OR_STATE_INSTANCE_SUBLAYER=3]="STATE_OR_STATE_INSTANCE_SUBLAYER",t[t.NON_STATE_COMPONENTS=4]="NON_STATE_COMPONENTS",t[t.NONE=5]="NONE"})(e0||(e0={}));var t0;(function(t){t[t.NONE=0]="NONE",t[t.SINGLE_NODE=1]="SINGLE_NODE",t[t.MULTI_NODE=2]="MULTI_NODE"})(t0||(t0={}));var r0;(function(t){t[t.CANVAS=0]="CANVAS",t[t.PROPERTIES_PANEL=1]="PROPERTIES_PANEL",t[t.DRAG_TO_CREATE=2]="DRAG_TO_CREATE"})(r0||(r0={}));var n0;(function(t){t[t.NONE=0]="NONE",t[t.CONNECTOR=1]="CONNECTOR",t[t.LINE=2]="LINE",t[t.VECTOR=3]="VECTOR",t[t.VERTEX=4]="VERTEX",t[t.ENDPOINT=5]="ENDPOINT",t[t.PENCIL=6]="PENCIL",t[t.WASHI_TAPE=7]="WASHI_TAPE",t[t.SECTION=8]="SECTION",t[t.SHAPE_WITH_TEXT=9]="SHAPE_WITH_TEXT"})(n0||(n0={}));var o0;(function(t){t[t.NONE=0]="NONE",t[t.FRAME_NAME=1]="FRAME_NAME",t[t.FLOW_STARTING_POINT_NAME=2]="FLOW_STARTING_POINT_NAME",t[t.SECTION_NAME=3]="SECTION_NAME",t[t.MEASUREMENT_FREE_TEXT=4]="MEASUREMENT_FREE_TEXT",t[t.RESPONSIVE_SET_NAME=5]="RESPONSIVE_SET_NAME",t[t.CANVAS_GRID_ROW_NAME=6]="CANVAS_GRID_ROW_NAME",t[t.GRID_TRACK_SIZE=7]="GRID_TRACK_SIZE",t[t.VAR_WIDTH_SIZE=8]="VAR_WIDTH_SIZE",t[t.CANVAS_GRID_ROW_STATE_GROUP=9]="CANVAS_GRID_ROW_STATE_GROUP"})(o0||(o0={}));var i0;(function(t){t[t.NONE=0]="NONE",t[t.INT=1]="INT",t[t.BOOL=2]="BOOL",t[t.FLOAT=3]="FLOAT",t[t.STRING=4]="STRING",t[t.JSON=5]="JSON",t[t.GRADIENT_STOP_SELECTION=7]="GRADIENT_STOP_SELECTION",t[t.SELECTED_PROPERTY=8]="SELECTED_PROPERTY",t[t.BOOL_ARRAY=9]="BOOL_ARRAY",t[t.GUID=10]="GUID",t[t.ON_CANVAS_NAME_EDITOR_INFO=11]="ON_CANVAS_NAME_EDITOR_INFO",t[t.EXPORT_SELECTION_SETTINGS=12]="EXPORT_SELECTION_SETTINGS",t[t.ACTIVE_EMBED_DATA=13]="ACTIVE_EMBED_DATA",t[t.VOTING_SESSION_INFO=14]="VOTING_SESSION_INFO",t[t.HOVERED_COMPONENT_PROP_DEF=15]="HOVERED_COMPONENT_PROP_DEF",t[t.TEXT_REVIEW_PLUGIN_INFO=16]="TEXT_REVIEW_PLUGIN_INFO",t[t.DEV_HANDOFF_CODE_LANGUAGE=17]="DEV_HANDOFF_CODE_LANGUAGE",t[t.DEV_HANDOFF_PREFERENCES=18]="DEV_HANDOFF_PREFERENCES",t[t.PROPERTIES_PANEL_PREFERENCES=19]="PROPERTIES_PANEL_PREFERENCES"})(i0||(i0={}));var a0;(function(t){t[t.UNJOINED=0]="UNJOINED",t[t.UNJOINED_FROM_ERROR=1]="UNJOINED_FROM_ERROR",t[t.UNJOINED_FROM_VALIDATION_FAILURE=2]="UNJOINED_FROM_VALIDATION_FAILURE",t[t.GOT_SCHEMA=3]="GOT_SCHEMA",t[t.JOINING_INITIAL_LOAD=4]="JOINING_INITIAL_LOAD",t[t.JOINING_RECONNECT=5]="JOINING_RECONNECT",t[t.JOINING_RECONNECT_AWAITING_QUERY_REPLY=6]="JOINING_RECONNECT_AWAITING_QUERY_REPLY",t[t.JOINED=7]="JOINED",t[t.SHOULD_UPGRADE=8]="SHOULD_UPGRADE",t[t.UPGRADING=9]="UPGRADING",t[t.WAITING_FOR_RELOAD=10]="WAITING_FOR_RELOAD",t[t.DETACHED=11]="DETACHED"})(a0||(a0={}));var s0;(function(t){t[t.COMMENT=0]="COMMENT",t[t.EMPTY_LINE=1]="EMPTY_LINE",t[t.DECLARATION=2]="DECLARATION",t[t.BLOCK_COMMENT=3]="BLOCK_COMMENT"})(s0||(s0={}));var l0;(function(t){t[t.DESIGN=0]="DESIGN",t[t.PROTOTYPE=1]="PROTOTYPE",t[t.INSPECT=2]="INSPECT",t[t.COMMENT=3]="COMMENT",t[t.EXPORT=4]="EXPORT",t[t.SLIDE=5]="SLIDE",t[t.SLIDE_ANIMATION=6]="SLIDE_ANIMATION",t[t.SITE=7]="SITE",t[t.COOPER=8]="COOPER",t[t.DAKOTA=9]="DAKOTA",t[t.ILLUSTRATION=10]="ILLUSTRATION"})(l0||(l0={}));var c0;(function(t){t[t.PRIMARY=0]="PRIMARY",t[t.PLUGIN=1]="PLUGIN",t[t.STRING_MANAGEMENT=2]="STRING_MANAGEMENT",t[t.PROPERTIES=3]="PROPERTIES",t[t.COMPONENT=4]="COMPONENT",t[t.DEV_RESOURCES=5]="DEV_RESOURCES",t[t.ASSETS=6]="ASSETS"})(c0||(c0={}));var d0;(function(t){t[t.PAN=0]="PAN",t[t.ZOOM=1]="ZOOM"})(d0||(d0={}));var u0;(function(t){t[t.CSS=0]="CSS",t[t.IOS=1]="IOS",t[t.ANDROID=2]="ANDROID"})(u0||(u0={}));var p0;(function(t){t[t.TABULAR=0]="TABULAR",t[t.CODE=1]="CODE"})(p0||(p0={}));var _0;(function(t){t[t.FRAME=0]="FRAME",t[t.IMAGE=1]="IMAGE",t[t.TEXT=2]="TEXT",t[t.GROUP=3]="GROUP",t[t.ROUNDED_RECTANGLE=4]="ROUNDED_RECTANGLE",t[t.INSTANCE=5]="INSTANCE",t[t.SYMBOL=6]="SYMBOL",t[t.VECTOR=7]="VECTOR",t[t.STAR=8]="STAR",t[t.LINE=9]="LINE",t[t.ELLIPSE=10]="ELLIPSE",t[t.REGULAR_POLYGON=11]="REGULAR_POLYGON"})(_0||(_0={}));var h0;(function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.REQUESTED=1]="REQUESTED",t[t.LOADED=2]="LOADED"})(h0||(h0={}));var m0;(function(t){t[t.NONE=0]="NONE",t[t.DIVIDER=1]="DIVIDER",t[t.WHITEBOARD_COLOR=2]="WHITEBOARD_COLOR",t[t.STICKY_COLOR=3]="STICKY_COLOR",t[t.HIGHLIGHT_COLOR=4]="HIGHLIGHT_COLOR",t[t.PENCIL_COLOR=5]="PENCIL_COLOR",t[t.WHITEBOARD_STROKE=6]="WHITEBOARD_STROKE",t[t.WHITEBOARD_SHAPE=7]="WHITEBOARD_SHAPE",t[t.WHITEBOARD_PLATFORM_SHAPE=8]="WHITEBOARD_PLATFORM_SHAPE",t[t.TEXT_DECORATION=9]="TEXT_DECORATION",t[t.HYPERLINK=10]="HYPERLINK",t[t.BULLETED_LIST=11]="BULLETED_LIST",t[t.WHITEBOARD_TEXT_STYLE=12]="WHITEBOARD_TEXT_STYLE",t[t.TEXT_ALIGN_H=13]="TEXT_ALIGN_H",t[t.TEXT_ALIGN_V=14]="TEXT_ALIGN_V",t[t.FONT_FAMILY=15]="FONT_FAMILY",t[t.CONNECTOR_LINE_STYLE=16]="CONNECTOR_LINE_STYLE",t[t.CONNECTOR_START_CAP=17]="CONNECTOR_START_CAP",t[t.CONNECTOR_END_CAP=18]="CONNECTOR_END_CAP",t[t.AUTHOR_VISIBILITY=19]="AUTHOR_VISIBILITY",t[t.ADD_TEXT=20]="ADD_TEXT",t[t.CODE_BLOCK_LANGUAGE=21]="CODE_BLOCK_LANGUAGE",t[t.CODE_BLOCK_THEME=22]="CODE_BLOCK_THEME",t[t.IMAGE=23]="IMAGE",t[t.BORDER=24]="BORDER",t[t.DESCRIPTION=25]="DESCRIPTION",t[t.EMBED_OPEN_EXTERNAL=26]="EMBED_OPEN_EXTERNAL",t[t.EMBED_MAXIMIZE=27]="EMBED_MAXIMIZE",t[t.EMBED_CONVERT_TO_TEXT=28]="EMBED_CONVERT_TO_TEXT",t[t.SECTION_SHOW_HIDE=29]="SECTION_SHOW_HIDE",t[t.SECTION_RENAME=30]="SECTION_RENAME",t[t.RESIZE_TO_FIT=31]="RESIZE_TO_FIT",t[t.WASHI_TAPE_PATTERN=32]="WASHI_TAPE_PATTERN",t[t.FACE_STAMP=33]="FACE_STAMP",t[t.START_MIND_MAP=34]="START_MIND_MAP",t[t.LOCK=35]="LOCK",t[t.WIDGET=36]="WIDGET"})(m0||(m0={}));var f0;(function(t){t[t.PNG=0]="PNG",t[t.JPEG=1]="JPEG",t[t.PDF=2]="PDF",t[t.CSV=3]="CSV"})(f0||(f0={}));var g0;(function(t){t[t.STICKY=0]="STICKY",t[t.TABLE=1]="TABLE"})(g0||(g0={}));var S0;(function(t){t[t.TRANSPARENT=0]="TRANSPARENT",t[t.WHITE=1]="WHITE",t[t.CHECKERBOARD=2]="CHECKERBOARD",t[t.HALF_CHECKERBOARD=3]="HALF_CHECKERBOARD",t[t.HALF_WHITE=4]="HALF_WHITE",t[t.CUSTOM_COLOR=5]="CUSTOM_COLOR"})(S0||(S0={}));var A0;(function(t){t[t.ATTACHED_FILE_TIP=0]="ATTACHED_FILE_TIP",t[t.DETACHED_FILE_TIP=1]="DETACHED_FILE_TIP",t[t.DETACHED_BRANCH_TIP=2]="DETACHED_BRANCH_TIP",t[t.BRANCH_POINT=3]="BRANCH_POINT",t[t.PREVIEW_BRANCH_TIP=4]="PREVIEW_BRANCH_TIP",t[t.STAGED_BRANCH_TIP=5]="STAGED_BRANCH_TIP",t[t.STAGED_FILE_TIP=6]="STAGED_FILE_TIP"})(A0||(A0={}));var T0;(function(t){t[t.NONE=0]="NONE",t[t.BEGIN_PREVIEW=1]="BEGIN_PREVIEW",t[t.RECREATE_BRANCH_POINT=2]="RECREATE_BRANCH_POINT",t[t.PREVIEW_CHANGES=3]="PREVIEW_CHANGES",t[t.STAGE_CHANGES=4]="STAGE_CHANGES",t[t.RESET_TO_BRANCH_POINT=5]="RESET_TO_BRANCH_POINT",t[t.COMMIT=6]="COMMIT",t[t.ABANDON=7]="ABANDON",t[t.STAGE_CHANGES_WHILE_ATTACHED=8]="STAGE_CHANGES_WHILE_ATTACHED",t[t.BEGIN_MERGE=9]="BEGIN_MERGE"})(T0||(T0={}));var E0;(function(t){t[t.RIGHT=0]="RIGHT",t[t.ABOVE=1]="ABOVE",t[t.CUSTOM_POSITION=2]="CUSTOM_POSITION",t[t.BELOW=3]="BELOW"})(E0||(E0={}));var I0;(function(t){t[t.OFF=0]="OFF",t[t.ON_AND_LOCKED=1]="ON_AND_LOCKED",t[t.KEEP_UI=2]="KEEP_UI",t[t.HIDE_UI=3]="HIDE_UI"})(I0||(I0={}));var R0;(function(t){t[t.SELECTION=0]="SELECTION",t[t.SNAPPING=1]="SNAPPING"})(R0||(R0={}));var y0;(function(t){t[t.BELOW=0]="BELOW",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.ABOVE=3]="ABOVE"})(y0||(y0={}));var b0;(function(t){t[t.DONT_MERGE=0]="DONT_MERGE",t[t.TEXT_EDIT=1]="TEXT_EDIT",t[t.TEXT_LINE_HEIGHT=2]="TEXT_LINE_HEIGHT",t[t.TEXT_FONT_SIZE=3]="TEXT_FONT_SIZE",t[t.TEXT_LETTER_SPACING=4]="TEXT_LETTER_SPACING",t[t.LAYER_OPACITY=5]="LAYER_OPACITY",t[t.NUDGE=6]="NUDGE",t[t.SELECTION_PROPERTY=7]="SELECTION_PROPERTY",t[t.STYLE_SELECTION_PROPERTY=8]="STYLE_SELECTION_PROPERTY",t[t.CONTENT_FILL_INSERT_AND_GENERATE=9]="CONTENT_FILL_INSERT_AND_GENERATE",t[t.AI_TEXT_MANIPULATION_START=10]="AI_TEXT_MANIPULATION_START",t[t.AI_TEXT_MANIPULATION_DELTA=11]="AI_TEXT_MANIPULATION_DELTA",t[t.COLLABORATIVE_TEXT_EDIT=12]="COLLABORATIVE_TEXT_EDIT",t[t.AI_IMAGE_MODIFICATION=13]="AI_IMAGE_MODIFICATION"})(b0||(b0={}));var v0;(function(t){t[t.NO_SESSION=0]="NO_SESSION",t[t.JOINED=1]="JOINED",t[t.NOT_JOINED=2]="NOT_JOINED",t[t.ENDED=3]="ENDED"})(v0||(v0={}));var C0;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_CENTER=1]="TOP_CENTER",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.MIDDLE_LEFT=3]="MIDDLE_LEFT",t[t.MIDDLE_CENTER=4]="MIDDLE_CENTER",t[t.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_CENTER=7]="BOTTOM_CENTER",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(C0||(C0={}));var O0;(function(t){t[t.PRESENT=0]="PRESENT",t[t.PREVIEW=1]="PREVIEW"})(O0||(O0={}));var N0;(function(t){t[t.DEFINITELY_COVERED_ONLY=0]="DEFINITELY_COVERED_ONLY",t[t.DEFINITELY_COVERED_AND_OUTDATED=1]="DEFINITELY_COVERED_AND_OUTDATED"})(N0||(N0={}));var P0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALWAYS=1]="ALWAYS",t[t.NEVER=2]="NEVER"})(P0||(P0={}));var F0;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.ERROR_TEXT_SIZE=1]="ERROR_TEXT_SIZE",t[t.TIMEOUT=2]="TIMEOUT",t[t.ERROR_OTHER=3]="ERROR_OTHER"})(F0||(F0={}));var D0;(function(t){t[t.MIRO=0]="MIRO",t[t.MURAL=1]="MURAL",t[t.LUCID=2]="LUCID",t[t.JAMBOARD=3]="JAMBOARD",t[t.UNKNOWN=4]="UNKNOWN"})(D0||(D0={}));var x0;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.YOUTUBE=1]="YOUTUBE",t[t.GOOGLE_MAP=2]="GOOGLE_MAP",t[t.MAILCHIMP=3]="MAILCHIMP",t[t.GENERIC=4]="GENERIC"})(x0||(x0={}));var w0;(function(t){t[t.NONE=0]="NONE",t[t.IGNORE_COMMIT_FOR_CONTENT_FILL=1]="IGNORE_COMMIT_FOR_CONTENT_FILL"})(w0||(w0={}));var L0;(function(t){t[t.TRACE=0]="TRACE",t[t.DBG=1]="DBG",t[t.INFO=2]="INFO",t[t.LOG=3]="LOG",t[t.WARN=4]="WARN",t[t.ERROR=5]="ERROR"})(L0||(L0={}));var M0;(function(t){t[t.BOOLEAN=0]="BOOLEAN",t[t.STRING=1]="STRING",t[t.FLOAT=2]="FLOAT",t[t.INT=3]="INT",t[t.STRING_LIST=4]="STRING_LIST"})(M0||(M0={}));var B0;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.CENTER=1]="CENTER"})(B0||(B0={}));var G0;(function(t){t[t.COMPONENTS=0]="COMPONENTS",t[t.PROPS=1]="PROPS"})(G0||(G0={}));var U0;(function(t){t[t.OFF=0]="OFF",t[t.TRANSIENT=1]="TRANSIENT",t[t.STICKY=2]="STICKY"})(U0||(U0={}));var V0;(function(t){t[t.ROW=0]="ROW",t[t.COLUMN=1]="COLUMN"})(V0||(V0={}));var k0;(function(t){t[t.PIXEL=0]="PIXEL",t[t.SCALED=1]="SCALED"})(k0||(k0={}));var H0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.UNDO_REDO=1]="UNDO_REDO",t[t.ANNOTATIONS=2]="ANNOTATIONS",t[t.NODE_STATUS=3]="NODE_STATUS"})(H0||(H0={}));var z0;(function(t){t[t.FIT_TO_SCREEN=0]="FIT_TO_SCREEN",t[t.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",t[t.FILL_SCREEN=2]="FILL_SCREEN"})(z0||(z0={}));var W0;(function(t){t[t.FIRST_PARTY=0]="FIRST_PARTY",t[t.LOCAL_PLUGIN=1]="LOCAL_PLUGIN",t[t.PUBLISHED_PLUGIN=2]="PUBLISHED_PLUGIN"})(W0||(W0={}));var K0;(function(t){t[t.ALL=0]="ALL",t[t.SECTION_STATUS_LABEL=1]="SECTION_STATUS_LABEL",t[t.SECTION_PRESET_PICKER=2]="SECTION_PRESET_PICKER",t[t.RESPONSIVE_SET_PLAY_BUTTON=3]="RESPONSIVE_SET_PLAY_BUTTON",t[t.RESPONSIVE_SET_PLUS_BUTTON=4]="RESPONSIVE_SET_PLUS_BUTTON",t[t.CMS_ITEM_BUTTON=5]="CMS_ITEM_BUTTON"})(K0||(K0={}));var Y0;(function(t){t[t.GENERATE=0]="GENERATE",t[t.EDIT=1]="EDIT"})(Y0||(Y0={}));var Q0;(function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.TOP_LEFT=4]="TOP_LEFT",t[t.TOP_RIGHT=5]="TOP_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=7]="BOTTOM_RIGHT"})(Q0||(Q0={}));var q0;(function(t){t[t.NO_IMAGE=0]="NO_IMAGE",t[t.IMAGE_NEEDS_CROP=1]="IMAGE_NEEDS_CROP",t[t.IMAGE_NEEDS_RESET=2]="IMAGE_NEEDS_RESET",t[t.IMAGE_EXPANDABLE=3]="IMAGE_EXPANDABLE"})(q0||(q0={}));var X0;(function(t){t[t.TEXT=0]="TEXT",t[t.BOX=1]="BOX"})(X0||(X0={}));var j0;(function(t){t[t.NORMAL=0]="NORMAL",t[t.MEDIUM=1]="MEDIUM",t[t.BOLD=2]="BOLD"})(j0||(j0={}));var Z0;(function(t){t[t.NONE=0]="NONE",t[t.ABSOLUTE=1]="ABSOLUTE",t[t.EDGE=2]="EDGE",t[t.CENTER=3]="CENTER",t[t.TOP=4]="TOP",t[t.RIGHT=5]="RIGHT",t[t.LEFT=6]="LEFT",t[t.BOTTOM=7]="BOTTOM"})(Z0||(Z0={}));var J0;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(J0||(J0={}));var $0;(function(t){t[t.HIDE=0]="HIDE",t[t.REORDER_AND_APPEND_ONLY=1]="REORDER_AND_APPEND_ONLY",t[t.FULL=2]="FULL"})($0||($0={}));var ey;(function(t){t[t.AXIS=0]="AXIS",t[t.POINT=1]="POINT"})(ey||(ey={}));var ty;(function(t){t[t.UNSELECTED_NODES=0]="UNSELECTED_NODES",t[t.UNSELECTED_NODES_AND_SELECTED_FRAME_CONTENT=1]="UNSELECTED_NODES_AND_SELECTED_FRAME_CONTENT"})(ty||(ty={}));var ry;(function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.BOTH=2]="BOTH",t[t.NONE=3]="NONE"})(ry||(ry={}));var ny;(function(t){t[t.EDITOR_TEMPLATE=0]="EDITOR_TEMPLATE",t[t.SLIDES_TEMPLATE=1]="SLIDES_TEMPLATE",t[t.SITES_TEMPLATE=2]="SITES_TEMPLATE",t[t.LITE_TEMPLATE=3]="LITE_TEMPLATE"})(ny||(ny={}));var oy;(function(t){t[t.ACTIONS_MENU=0]="ACTIONS_MENU",t[t.RFD_INITIAL_NUDGE=1]="RFD_INITIAL_NUDGE",t[t.RFD_STATUS_MENU=2]="RFD_STATUS_MENU",t[t.INTEGRATION_TEST=3]="INTEGRATION_TEST"})(oy||(oy={}));var iy;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.TRIGGERED_DETACH=1]="TRIGGERED_DETACH",t[t.INTERNAL_ERROR=2]="INTERNAL_ERROR"})(iy||(iy={}));var ay;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NOT_DETACHED_ERROR=1]="NOT_DETACHED_ERROR",t[t.INTERNAL_ERROR=2]="INTERNAL_ERROR"})(ay||(ay={}));var sy;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.CONTAINING_PAGE=1]="CONTAINING_PAGE",t[t.PLUGIN=2]="PLUGIN"})(sy||(sy={}));var ly;(function(t){t[t.LEGACY_PLUGIN=0]="LEGACY_PLUGIN",t[t.PLUGIN_VALIDATION=1]="PLUGIN_VALIDATION",t[t.DYNAMIC_PLUGIN_LOAD_ALL=2]="DYNAMIC_PLUGIN_LOAD_ALL",t[t.SAVE_LOCAL_COPY=3]="SAVE_LOCAL_COPY",t[t.LEGACY_IMAGES_CODE=4]="LEGACY_IMAGES_CODE",t[t.FIND_AND_REPLACE=5]="FIND_AND_REPLACE",t[t.REPLACE_LIBRARIES=6]="REPLACE_LIBRARIES",t[t.LIBRARY_UPDATES=7]="LIBRARY_UPDATES",t[t.MISSING_FONTS=8]="MISSING_FONTS",t[t.BRANCHING_MODAL_OPEN=9]="BRANCHING_MODAL_OPEN",t[t.BRANCHING_MERGE_TO_MAIN=10]="BRANCHING_MERGE_TO_MAIN",t[t.DEBUG_TOOL=11]="DEBUG_TOOL"})(ly||(ly={}));var cy;(function(t){t[t.ASSET_UPDATE=0]="ASSET_UPDATE",t[t.AUTOSAVE=1]="AUTOSAVE",t[t.BRANCHING_MODAL_OPEN=2]="BRANCHING_MODAL_OPEN",t[t.BRANCHING_MERGE_TO_MAIN=3]="BRANCHING_MERGE_TO_MAIN",t[t.DEV_HANDOFF_STATUS=4]="DEV_HANDOFF_STATUS",t[t.HYPERLINK_PRELOAD=5]="HYPERLINK_PRELOAD",t[t.PAGE_INITIAL_LOAD=6]="PAGE_INITIAL_LOAD",t[t.PAGE_CHANGE=7]="PAGE_CHANGE",t[t.PAGE_DELETE=8]="PAGE_DELETE",t[t.PAGE_DIVIDER_CHECK=9]="PAGE_DIVIDER_CHECK",t[t.PAGE_DUPLICATE=10]="PAGE_DUPLICATE",t[t.PAGE_MOVE_TO=11]="PAGE_MOVE_TO",t[t.PLUGIN=12]="PLUGIN",t[t.PLAYGROUND_NODE_LOAD=13]="PLAYGROUND_NODE_LOAD"})(cy||(cy={}));var dy;(function(t){t[t.MITER=0]="MITER",t[t.ROUND=1]="ROUND"})(dy||(dy={}));var uy;(function(t){t[t.EMBED=0]="EMBED",t[t.LINK_PREVIEW=1]="LINK_PREVIEW",t[t.WIDGET=2]="WIDGET"})(uy||(uy={}));var py;(function(t){t[t.LOCAL=0]="LOCAL",t[t.REMOTE=1]="REMOTE"})(py||(py={}));var _y;(function(t){t[t.CREATE=0]="CREATE",t[t.DELETE=1]="DELETE",t[t.PROPERTY_CHANGE=2]="PROPERTY_CHANGE",t[t.STYLE_PROPERTY_CHANGE=3]="STYLE_PROPERTY_CHANGE",t[t.STYLE_CREATE=4]="STYLE_CREATE",t[t.STYLE_DELETE=5]="STYLE_DELETE"})(_y||(_y={}));var hy;(function(t){t[t.SINGLE_SLIDE=0]="SINGLE_SLIDE",t[t.GRID=1]="GRID"})(hy||(hy={}));var my;(function(t){t[t.SINGLE_ASSET=0]="SINGLE_ASSET",t[t.GRID=1]="GRID"})(my||(my={}));var fy;(function(t){t[t.GROUP=0]="GROUP",t[t.UNION=1]="UNION",t[t.SUBTRACT=2]="SUBTRACT",t[t.INTERSECT=3]="INTERSECT",t[t.XOR=4]="XOR",t[t.STATE_GROUP=5]="STATE_GROUP",t[t.TRANSFORM=6]="TRANSFORM"})(fy||(fy={}));var gy;(function(t){t[t.UNLOADED=0]="UNLOADED",t[t.NOT_ANIMATED=1]="NOT_ANIMATED",t[t.ANIMATED=2]="ANIMATED"})(gy||(gy={}));var Sy;(function(t){t[t.KEYBOARD=0]="KEYBOARD",t[t.UNKNOWN_CONTROLLER=1]="UNKNOWN_CONTROLLER",t[t.XBOX_ONE=2]="XBOX_ONE",t[t.PS4=3]="PS4",t[t.SWITCH_PRO=4]="SWITCH_PRO"})(Sy||(Sy={}));var Ay;(function(t){t[t.NONE=0]="NONE",t[t.PRESET=1]="PRESET",t[t.CUSTOM=2]="CUSTOM",t[t.PRESENTATION=3]="PRESENTATION"})(Ay||(Ay={}));var Ty;(function(t){t[t.VALID=0]="VALID",t[t.NO_FRAMES=1]="NO_FRAMES",t[t.INVALID_START_NODE=2]="INVALID_START_NODE"})(Ty||(Ty={}));var Ey;(function(t){t[t.SCROLLS=0]="SCROLLS",t[t.FIXED=1]="FIXED",t[t.STICKY_SCROLLS=2]="STICKY_SCROLLS"})(Ey||(Ey={}));var Iy;(function(t){t[t.PLUGIN=0]="PLUGIN",t[t.INTERNAL=1]="INTERNAL"})(Iy||(Iy={}));var Ry;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(Ry||(Ry={}));var yy;(function(t){t[t.SET_AUTOLAYOUT_SPACING_AUTO=0]="SET_AUTOLAYOUT_SPACING_AUTO",t[t.SET_CLIP_CONTENT=1]="SET_CLIP_CONTENT",t[t.SET_CORNER_SMOOTHING_ZERO=2]="SET_CORNER_SMOOTHING_ZERO",t[t.USE_BLEND_MODE_MULTIPLY=3]="USE_BLEND_MODE_MULTIPLY",t[t.REMOVE_VERTICAL_TRIM=4]="REMOVE_VERTICAL_TRIM",t[t.REMOVE_VIDEO_FILL=5]="REMOVE_VIDEO_FILL",t[t.REMOVE_TEXTURE_PATTERN_FILL=6]="REMOVE_TEXTURE_PATTERN_FILL",t[t.REMOVE_TEXTURE_NOISE_FILL=7]="REMOVE_TEXTURE_NOISE_FILL",t[t.REMOVE_VIDEO_STROKE=8]="REMOVE_VIDEO_STROKE",t[t.REMOVE_STICKY=9]="REMOVE_STICKY",t[t.REMOVE_CONNECTOR=10]="REMOVE_CONNECTOR",t[t.REMOVE_WASHI_TAPE=11]="REMOVE_WASHI_TAPE",t[t.REMOVE_HIGHLIGHT=12]="REMOVE_HIGHLIGHT",t[t.REMOVE_SHAPE_WITH_TEXT=13]="REMOVE_SHAPE_WITH_TEXT",t[t.REMOVE_STAMP=14]="REMOVE_STAMP",t[t.REMOVE_TABLE=15]="REMOVE_TABLE",t[t.REMOVE_WIDGET=16]="REMOVE_WIDGET",t[t.REMOVE_STROKE=17]="REMOVE_STROKE",t[t.REMOVE_STROKE_GRADIENT=18]="REMOVE_STROKE_GRADIENT",t[t.REMOVE_STROKE_IMAGE=19]="REMOVE_STROKE_IMAGE",t[t.REMOVE_STROKE_BLEND_MODE=20]="REMOVE_STROKE_BLEND_MODE",t[t.REMOVE_CUSTOM_JOIN=21]="REMOVE_CUSTOM_JOIN",t[t.REMOVE_TEXT_INNER_SHADOW=22]="REMOVE_TEXT_INNER_SHADOW",t[t.SET_BLEND_MODE_NORMAL=23]="SET_BLEND_MODE_NORMAL",t[t.REMOVE_TEXT_BACKGROUND_BLUR=24]="REMOVE_TEXT_BACKGROUND_BLUR",t[t.REMOVE_BASELINE_ALIGNMENT=25]="REMOVE_BASELINE_ALIGNMENT",t[t.REMOVE_EFFECTS=26]="REMOVE_EFFECTS",t[t.REMOVE_OPEN_OVERLAY_ACTIONS=27]="REMOVE_OPEN_OVERLAY_ACTIONS",t[t.REMOVE_SWAP_OVERLAY_ACTIONS=28]="REMOVE_SWAP_OVERLAY_ACTIONS",t[t.REMOVE_CLOSE_OVERLAY_ACTIONS=29]="REMOVE_CLOSE_OVERLAY_ACTIONS",t[t.REMOVE_SET_VARIABLE_MODE_ACTIONS=30]="REMOVE_SET_VARIABLE_MODE_ACTIONS",t[t.REMOVE_SCROLL_TO_ACTIONS=31]="REMOVE_SCROLL_TO_ACTIONS",t[t.REMOVE_ON_DRAG_ACTIONS=32]="REMOVE_ON_DRAG_ACTIONS",t[t.REMOVE_GAMEPAD_ACTIONS=33]="REMOVE_GAMEPAD_ACTIONS",t[t.REMOVE_LINKS_TO_DELETED_NODES=34]="REMOVE_LINKS_TO_DELETED_NODES",t[t.REMOVE_MOUSE_IN_ACTIONS=35]="REMOVE_MOUSE_IN_ACTIONS",t[t.REMOVE_MOUSE_OUT_ACTIONS=36]="REMOVE_MOUSE_OUT_ACTIONS",t[t.REMOVE_NAVIGATE_ACTIONS_WITH_SMART_ANIMATE=37]="REMOVE_NAVIGATE_ACTIONS_WITH_SMART_ANIMATE",t[t.REMOVE_DISSOLVE_ANIMATIONS=38]="REMOVE_DISSOLVE_ANIMATIONS",t[t.REMOVE_SMART_ANIMATE=39]="REMOVE_SMART_ANIMATE",t[t.REMOVE_SMART_ANIMATE_FROM_ANCESTOR=40]="REMOVE_SMART_ANIMATE_FROM_ANCESTOR",t[t.REMOVE_UNSUPPORTED_VECTOR_OVERRIDES=41]="REMOVE_UNSUPPORTED_VECTOR_OVERRIDES",t[t.REMOVE_VECTOR_SET_VARIABLE_ACTIONS=42]="REMOVE_VECTOR_SET_VARIABLE_ACTIONS",t[t.SET_AUTOLAYOUT_SIZING_FIXED=43]="SET_AUTOLAYOUT_SIZING_FIXED",t[t.ADD_AUTOLAYOUT=44]="ADD_AUTOLAYOUT",t[t.REMOVE_AUTOLAYOUT=45]="REMOVE_AUTOLAYOUT",t[t.SET_POSITION_CONSTRAINTS_CENTER=46]="SET_POSITION_CONSTRAINTS_CENTER",t[t.REMOVE_FILL_CONTAINER=47]="REMOVE_FILL_CONTAINER",t[t.REMOVE_ROTATION=48]="REMOVE_ROTATION",t[t.REMOVE_SCROLLING=49]="REMOVE_SCROLLING",t[t.REMOVE_ON_CLICK_ACTIONS=50]="REMOVE_ON_CLICK_ACTIONS",t[t.REMOVE_TEXTURE_DYNAMIC_STROKE=51]="REMOVE_TEXTURE_DYNAMIC_STROKE",t[t.REMOVE_TEXTURE_BRUSH_STROKE=52]="REMOVE_TEXTURE_BRUSH_STROKE",t[t.REMOVE_GRAIN_EFFECT=53]="REMOVE_GRAIN_EFFECT",t[t.REMOVE_NOISE_EFFECT=54]="REMOVE_NOISE_EFFECT",t[t.REMOVE_PROGRESSIVE_BLUR=55]="REMOVE_PROGRESSIVE_BLUR",t[t.REMOVE_GLASS=56]="REMOVE_GLASS",t[t.REMOVE_IMAGE_ADJUSTMENTS=57]="REMOVE_IMAGE_ADJUSTMENTS",t[t.REMOVE_APPEAR_BEHAVIOR=58]="REMOVE_APPEAR_BEHAVIOR",t[t.REMOVE_SCROLL_TRANSFORM_BEHAVIOR=59]="REMOVE_SCROLL_TRANSFORM_BEHAVIOR",t[t.REMOVE_SCROLL_PARALLAX_BEHAVIOR=60]="REMOVE_SCROLL_PARALLAX_BEHAVIOR",t[t.REMOVE_HOVER_BEHAVIOR=61]="REMOVE_HOVER_BEHAVIOR",t[t.REMOVE_PRESS_BEHAVIOR=62]="REMOVE_PRESS_BEHAVIOR",t[t.REMOVE_ON_PRESS_ACTIONS=63]="REMOVE_ON_PRESS_ACTIONS",t[t.REMOVE_ON_HOVER_ACTIONS=64]="REMOVE_ON_HOVER_ACTIONS",t[t.REMOVE_CODE_BEHAVIORS=65]="REMOVE_CODE_BEHAVIORS",t[t.REMOVE_IMAGE_ROTATION=66]="REMOVE_IMAGE_ROTATION",t[t.REMOVE_ROTATED_IMAGE_FILL=67]="REMOVE_ROTATED_IMAGE_FILL",t[t.REMOVE_CURSOR_BEHAVIOR=68]="REMOVE_CURSOR_BEHAVIOR",t[t.REMOVE_MASK_TRANSFORM=69]="REMOVE_MASK_TRANSFORM",t[t.SET_POSITION_ABSOLUTE=70]="SET_POSITION_ABSOLUTE",t[t.SET_VIDEO_AUTOPLAY=71]="SET_VIDEO_AUTOPLAY",t[t.SET_VIDEO_CONTROLS=72]="SET_VIDEO_CONTROLS",t[t.REMOVE_VIDEO_ROTATION=73]="REMOVE_VIDEO_ROTATION",t[t.REMOVE_ROTATED_VIDEO_FILL=74]="REMOVE_ROTATED_VIDEO_FILL",t[t.SET_VIDEO_FILL_SCALE_MODE_FILL=75]="SET_VIDEO_FILL_SCALE_MODE_FILL",t[t.REMOVE_GRADIENT_FILL=76]="REMOVE_GRADIENT_FILL",t[t.REMOVE_IMAGE_FILL=77]="REMOVE_IMAGE_FILL",t[t.REMOVE_SCROLLABLE_AXIS_ALIGNMENT=78]="REMOVE_SCROLLABLE_AXIS_ALIGNMENT"})(yy||(yy={}));var by;(function(t){t[t.NONE=0]="NONE",t[t.FADE=1]="FADE",t[t.SLIDE_FROM_LEFT=2]="SLIDE_FROM_LEFT",t[t.SLIDE_FROM_RIGHT=3]="SLIDE_FROM_RIGHT",t[t.SLIDE_FROM_TOP=4]="SLIDE_FROM_TOP",t[t.SLIDE_FROM_BOTTOM=5]="SLIDE_FROM_BOTTOM"})(by||(by={}));var vy;(function(t){t[t.INACTIVE=0]="INACTIVE",t[t.ALL_FRAMES=1]="ALL_FRAMES",t[t.COMPONENT_SET=2]="COMPONENT_SET",t[t.RESPONSIVE_SET=3]="RESPONSIVE_SET"})(vy||(vy={}));var Cy;(function(t){t[t.VARIABLES_MODAL=0]="VARIABLES_MODAL",t[t.VARIABLE_PICKER=1]="VARIABLE_PICKER",t[t.SLIDES_THEME=2]="SLIDES_THEME"})(Cy||(Cy={}));var Oy;(function(t){t[t.AUTOMATIC_FIRST_COLLECTION=0]="AUTOMATIC_FIRST_COLLECTION",t[t.VARIABLES_MODAL=1]="VARIABLES_MODAL"})(Oy||(Oy={}));var Ny;(function(t){t[t.SET_AS_DEFAULT=0]="SET_AS_DEFAULT",t[t.MOVE_COLUMN_LEFT=1]="MOVE_COLUMN_LEFT",t[t.MOVE_COLUMN_RIGHT=2]="MOVE_COLUMN_RIGHT",t[t.DRAG_AND_DROP=3]="DRAG_AND_DROP"})(Ny||(Ny={}));var Py;(function(t){t[t.ADD_CHANGES=0]="ADD_CHANGES",t[t.REPLACE_CHANGES=1]="REPLACE_CHANGES"})(Py||(Py={}));var Fy;(function(t){t[t.NONE=0]="NONE",t[t.DISCONNECTED_AUTOSAVE_DISABLED=1]="DISCONNECTED_AUTOSAVE_DISABLED",t[t.DISCONNECTED_SERVER_ISSUES=2]="DISCONNECTED_SERVER_ISSUES",t[t.DISCONNECTED_OTHER=3]="DISCONNECTED_OTHER",t[t.SYNCING_AUTOSAVE_DISABLED=4]="SYNCING_AUTOSAVE_DISABLED",t[t.SYNCING_SERVER_ISSUES=5]="SYNCING_SERVER_ISSUES",t[t.SYNCING_OTHER=6]="SYNCING_OTHER",t[t.SUPPRESS_UNSAVED_CHANGES_UI=7]="SUPPRESS_UNSAVED_CHANGES_UI"})(Fy||(Fy={}));var Dy;(function(t){t[t.NONE=0]="NONE",t[t.SCENEGRAPH_VALIDATION_ERROR=1]="SCENEGRAPH_VALIDATION_ERROR",t[t.NON_ATOMIC_SYNC_ERROR=2]="NON_ATOMIC_SYNC_ERROR"})(Dy||(Dy={}));var xy;(function(t){t[t.NEW_FILE=0]="NEW_FILE",t[t.INITIAL_LOAD=1]="INITIAL_LOAD",t[t.RECONNECT=2]="RECONNECT"})(xy||(xy={}));var wy;(function(t){t[t.NONE=0]="NONE",t[t.VARIABLES=1]="VARIABLES",t[t.STYLES=2]="STYLES"})(wy||(wy={}));var Ly;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.CROSSHAIR=1]="CROSSHAIR",t[t.EYEDROPPER=2]="EYEDROPPER",t[t.HAND=3]="HAND",t[t.PAINT_BUCKET=4]="PAINT_BUCKET",t[t.PEN=5]="PEN",t[t.PENCIL=6]="PENCIL",t[t.MARKER=7]="MARKER",t[t.ERASER=8]="ERASER",t[t.HIGHLIGHTER=9]="HIGHLIGHTER",t[t.HIGH_FIVE=10]="HIGH_FIVE",t[t.LASSO=11]="LASSO"})(Ly||(Ly={}));var My;(function(t){t[t.BASIC=0]="BASIC",t[t.EXPANDED=1]="EXPANDED"})(My||(My={}));var By;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.PURPLE=3]="PURPLE",t[t.RED=4]="RED",t[t.YELLOW=5]="YELLOW"})(By||(By={}));var Gy;(function(t){t[t.DIAGRAM=0]="DIAGRAM",t[t.ORG_CHART=1]="ORG_CHART",t[t.STATE=2]="STATE"})(Gy||(Gy={}));var Uy;(function(t){t[t.TB=0]="TB",t[t.BT=1]="BT",t[t.LR=2]="LR",t[t.RL=3]="RL"})(Uy||(Uy={}));var Vy;(function(t){t[t.NONE=0]="NONE",t[t.ARROW=1]="ARROW",t[t.CIRCLE=2]="CIRCLE",t[t.CROSS=3]="CROSS",t[t.ARROW_TRIANGLE=4]="ARROW_TRIANGLE"})(Vy||(Vy={}));var ky;(function(t){t[t.NORMAL=0]="NORMAL",t[t.DOTTED=1]="DOTTED",t[t.THICK=2]="THICK"})(ky||(ky={}));var Hy;(function(t){t[t.STATE_FORK=0]="STATE_FORK",t[t.STATE_JOIN=1]="STATE_JOIN",t[t.STATE_CHOICE=2]="STATE_CHOICE",t[t.STATE_START=3]="STATE_START",t[t.STATE_END=4]="STATE_END"})(Hy||(Hy={}));var zy;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.PURPLE=1]="PURPLE",t[t.BLUE=2]="BLUE",t[t.GREEN=3]="GREEN"})(zy||(zy={}));var Wy;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.PURPLE=3]="PURPLE",t[t.RED=4]="RED",t[t.YELLOW=5]="YELLOW"})(Wy||(Wy={}));var Ky;(function(t){t[t.Eligible=0]="Eligible",t[t.Ineligible=1]="Ineligible",t[t.Ignored=2]="Ignored"})(Ky||(Ky={}));var Yy;(function(t){t[t.NONE=0]="NONE",t[t.STICKY=1]="STICKY",t[t.SHAPE_WITH_TEXT=2]="SHAPE_WITH_TEXT",t[t.SECTION=3]="SECTION",t[t.BUG_BASH=4]="BUG_BASH",t[t.STANDUP=5]="STANDUP",t[t.DESIGN_CRIT=6]="DESIGN_CRIT",t[t.USER_JOURNEY=7]="USER_JOURNEY",t[t.MAKE_SOMETHING_BRAINSTORM=8]="MAKE_SOMETHING_BRAINSTORM",t[t.MAKE_SOMETHING_TEAM_CHART=9]="MAKE_SOMETHING_TEAM_CHART",t[t.MAKE_SOMETHING_TEAM_UPDATES=10]="MAKE_SOMETHING_TEAM_UPDATES",t[t.MAKE_SOMETHING_PLANNING=11]="MAKE_SOMETHING_PLANNING",t[t.RETRO=12]="RETRO"})(Yy||(Yy={}));var Qy;(function(t){t[t.V100=0]="V100",t[t.V200=1]="V200",t[t.V300=2]="V300",t[t.V400=3]="V400",t[t.V500=4]="V500",t[t.V600=5]="V600",t[t.V700=6]="V700",t[t.V800=7]="V800",t[t.V900=8]="V900",t[t.V1000=9]="V1000"})(Qy||(Qy={}));var qy;(function(t){t[t.SELECTION=0]="SELECTION",t[t.SELECTION_STROKE=1]="SELECTION_STROKE",t[t.PENCIL_TOOL=2]="PENCIL_TOOL",t[t.SHAPE_TOOL=3]="SHAPE_TOOL",t[t.EDIT_PALETTE_MODAL=4]="EDIT_PALETTE_MODAL"})(qy||(qy={}));var Xy;(function(t){t[t.NONE=0]="NONE",t[t.PLACE=1]="PLACE",t[t.QUIT=2]="QUIT",t[t.BACK_TO_FILES=3]="BACK_TO_FILES",t[t.OPEN_FONT_SETTINGS=4]="OPEN_FONT_SETTINGS",t[t.SAVE=5]="SAVE",t[t.SAVE_AS=6]="SAVE_AS",t[t.CREATE_SAVEPOINT=7]="CREATE_SAVEPOINT",t[t.TOGGLE_VERSION_HISTORY=8]="TOGGLE_VERSION_HISTORY",t[t.EXPORT_SELECTED_EXPORTABLES=9]="EXPORT_SELECTED_EXPORTABLES",t[t.EXPORT_SELECTED_EXPORTABLES_DIRECT=10]="EXPORT_SELECTED_EXPORTABLES_DIRECT",t[t.EXPORT_NODE_DIRECT_COOPER=11]="EXPORT_NODE_DIRECT_COOPER",t[t.EXPORT_ASSETS_HANDOFF=12]="EXPORT_ASSETS_HANDOFF",t[t.EXPORT_ALL_EXPORTABLES=13]="EXPORT_ALL_EXPORTABLES",t[t.EXPORT_SELECTION_OR_CURRENT_PAGE=14]="EXPORT_SELECTION_OR_CURRENT_PAGE",t[t.EXPORT_SELECTED_VIDEO=15]="EXPORT_SELECTED_VIDEO",t[t.COMBINE_SELECTED_VIDEO_STACK=16]="COMBINE_SELECTED_VIDEO_STACK",t[t.EXPORT_BUZZ_ASSETS=17]="EXPORT_BUZZ_ASSETS",t[t.IMPORT_FROM_CSV=18]="IMPORT_FROM_CSV",t[t.IMPORT=19]="IMPORT",t[t.PAGE_NEW=20]="PAGE_NEW",t[t.PAGE_PREVIOUS=21]="PAGE_PREVIOUS",t[t.PAGE_NEXT=22]="PAGE_NEXT",t[t.PAGE_DELETE=23]="PAGE_DELETE",t[t.PAGE_DUPLICATE=24]="PAGE_DUPLICATE",t[t.PAGE_MOVE_TO=25]="PAGE_MOVE_TO",t[t.PAGE_RENAME=26]="PAGE_RENAME",t[t.TRACK_PAGE_RENAME=27]="TRACK_PAGE_RENAME",t[t.BATCH_PAGE_RENAME=28]="BATCH_PAGE_RENAME",t[t.PAGE_MOVE_TO_MENU=29]="PAGE_MOVE_TO_MENU",t[t.PAGE_MOVE_TO_NEW_FILE=30]="PAGE_MOVE_TO_NEW_FILE",t[t.PAGE_COPY_LINK=31]="PAGE_COPY_LINK",t[t.COPY_LINK=32]="COPY_LINK",t[t.UNDO=33]="UNDO",t[t.REDO=34]="REDO",t[t.CUT=35]="CUT",t[t.COPY=36]="COPY",t[t.COPY_AS_MENU=37]="COPY_AS_MENU",t[t.COPY_PASTE_MENU=38]="COPY_PASTE_MENU",t[t.COPY_AS_CODE=39]="COPY_AS_CODE",t[t.COPY_AS_CSS=40]="COPY_AS_CSS",t[t.COPY_AS_CSS_RECURSIVE=41]="COPY_AS_CSS_RECURSIVE",t[t.COPY_AS_ANDROID=42]="COPY_AS_ANDROID",t[t.COPY_AS_IOS=43]="COPY_AS_IOS",t[t.COPY_AS_SVG=44]="COPY_AS_SVG",t[t.COPY_AS_PNG=45]="COPY_AS_PNG",t[t.PANELS_MENU=46]="PANELS_MENU",t[t.MASTER_COMPONENT_MENU=47]="MASTER_COMPONENT_MENU",t[t.COPY_PROPERTIES=48]="COPY_PROPERTIES",t[t.COPY_TEXT=49]="COPY_TEXT",t[t.COPY_LAYER_NAME=50]="COPY_LAYER_NAME",t[t.PASTE=51]="PASTE",t[t.PASTE_HERE=52]="PASTE_HERE",t[t.PASTE_PROPERTIES=53]="PASTE_PROPERTIES",t[t.PASTE_OVER_SELECTION=54]="PASTE_OVER_SELECTION",t[t.PASTE_TO_REPLACE=55]="PASTE_TO_REPLACE",t[t.PASTE_WIDGETS_AS_SUBLAYERS=56]="PASTE_WIDGETS_AS_SUBLAYERS",t[t.SHOW_ROTATION_ORIGIN=57]="SHOW_ROTATION_ORIGIN",t[t.SELECT_CHILD=58]="SELECT_CHILD",t[t.SELECT_PARENT=59]="SELECT_PARENT",t[t.SELECT_NEXT_SIBLING=60]="SELECT_NEXT_SIBLING",t[t.SELECT_PREVIOUS_SIBLING=61]="SELECT_PREVIOUS_SIBLING",t[t.SELECT_NEXT_NODE=62]="SELECT_NEXT_NODE",t[t.SELECT_PREVIOUS_NODE=63]="SELECT_PREVIOUS_NODE",t[t.SELECT_ALL=64]="SELECT_ALL",t[t.SELECT_ALL_WIDGETS=65]="SELECT_ALL_WIDGETS",t[t.SELECT_ALL_SLIDES=66]="SELECT_ALL_SLIDES",t[t.SELECT_INVERSE=67]="SELECT_INVERSE",t[t.MOVE_TEXT_SELECTION_END=68]="MOVE_TEXT_SELECTION_END",t[t.MOVE_TEXT_SELECTION_START=69]="MOVE_TEXT_SELECTION_START",t[t.EXTEND_TEXT_SELECTION_END=70]="EXTEND_TEXT_SELECTION_END",t[t.EXTEND_TEXT_SELECTION_START=71]="EXTEND_TEXT_SELECTION_START",t[t.MOVE_TEXT_SELECTION_FORWARD=72]="MOVE_TEXT_SELECTION_FORWARD",t[t.MOVE_TEXT_SELECTION_BACKWARD=73]="MOVE_TEXT_SELECTION_BACKWARD",t[t.EXTEND_TEXT_SELECTION_FORWARD=74]="EXTEND_TEXT_SELECTION_FORWARD",t[t.EXTEND_TEXT_SELECTION_BACKWARD=75]="EXTEND_TEXT_SELECTION_BACKWARD",t[t.SELECT_MATCHING=76]="SELECT_MATCHING",t[t.SELECT_SIMILAR=77]="SELECT_SIMILAR",t[t.SELECT_NODE=78]="SELECT_NODE",t[t.SELECT_NODE_MENU=79]="SELECT_NODE_MENU",t[t.SET_DEFAULT_STYLE=80]="SET_DEFAULT_STYLE",t[t.FIND_SYMBOL=81]="FIND_SYMBOL",t[t.FIND_COMPONENT_IN_FILE=82]="FIND_COMPONENT_IN_FILE",t[t.CREATE_SYMBOL=83]="CREATE_SYMBOL",t[t.CREATE_MULTIPLE_SYMBOLS=84]="CREATE_MULTIPLE_SYMBOLS",t[t.CREATE_MULTIPLE_SYMBOLS_AND_STATE_GROUP=85]="CREATE_MULTIPLE_SYMBOLS_AND_STATE_GROUP",t[t.PUBLISH_SELECTION=86]="PUBLISH_SELECTION",t[t.PUBLISH_CHANGES_TO_LIBRARY=87]="PUBLISH_CHANGES_TO_LIBRARY",t[t.PUBLISH_TEMPLATE=88]="PUBLISH_TEMPLATE",t[t.PUSH_CHANGES_TO_MAIN=89]="PUSH_CHANGES_TO_MAIN",t[t.RESET_SYMBOL=90]="RESET_SYMBOL",t[t.RESET_FAUXVERRIDE=91]="RESET_FAUXVERRIDE",t[t.RESET_SIZE=92]="RESET_SIZE",t[t.RESET_EXPORTS=93]="RESET_EXPORTS",t[t.RESET_EFFECTS=94]="RESET_EFFECTS",t[t.RESET_LAYER=95]="RESET_LAYER",t[t.RESET_VISIBLE=96]="RESET_VISIBLE",t[t.RESET_NAME=97]="RESET_NAME",t[t.RESET_FILL=98]="RESET_FILL",t[t.RESET_STROKE=99]="RESET_STROKE",t[t.RESET_TEXT=100]="RESET_TEXT",t[t.RESET_TEXT_STYLE=101]="RESET_TEXT_STYLE",t[t.RESET_PROTOTYPE_INTERACTIONS=102]="RESET_PROTOTYPE_INTERACTIONS",t[t.RESET_OVERLAY=103]="RESET_OVERLAY",t[t.RESTORE_SYMBOL_OR_STATE_GROUP=104]="RESTORE_SYMBOL_OR_STATE_GROUP",t[t.SWAP_TO_RELATED_SYMBOL=105]="SWAP_TO_RELATED_SYMBOL",t[t.ADD_VARIANT=106]="ADD_VARIANT",t[t.CREATE_STATE_GROUP=107]="CREATE_STATE_GROUP",t[t.CREATE_STATE=108]="CREATE_STATE",t[t.SWAP_TO_RELATED_STATE=109]="SWAP_TO_RELATED_STATE",t[t.CREATE_BUZZ_TEMPLATES=110]="CREATE_BUZZ_TEMPLATES",t[t.CREATE_BUZZ_TEMPLATE_SET_ROW=111]="CREATE_BUZZ_TEMPLATE_SET_ROW",t[t.CREATE_BUZZ_TEMPLATES_FROM_ROW=112]="CREATE_BUZZ_TEMPLATES_FROM_ROW",t[t.ADD_VARIANT_TO_BUZZ_TEMPLATE_SET=113]="ADD_VARIANT_TO_BUZZ_TEMPLATE_SET",t[t.DETACH_LOCKED_TEMPLATE=114]="DETACH_LOCKED_TEMPLATE",t[t.CREATE_WEBPAGE=115]="CREATE_WEBPAGE",t[t.CREATE_RESPONSIVE_NODE_SET=116]="CREATE_RESPONSIVE_NODE_SET",t[t.CREATE_TEMPLATE=117]="CREATE_TEMPLATE",t[t.CONVERT_TO_SLOT=118]="CONVERT_TO_SLOT",t[t.GROUP_SELECTION_INTO_SLOT=119]="GROUP_SELECTION_INTO_SLOT",t[t.EMPTY_SLOT_CONTENTS=120]="EMPTY_SLOT_CONTENTS",t[t.RESET_SLOT_ASSIGNMENT=121]="RESET_SLOT_ASSIGNMENT",t[t.SWAP_NODES=122]="SWAP_NODES",t[t.DETACH_INSTANCE=123]="DETACH_INSTANCE",t[t.REMOVE_DETACHED_SYMBOL_ID=124]="REMOVE_DETACHED_SYMBOL_ID",t[t.UPDATE_INSTANCE_LAYOUT_VERSION=125]="UPDATE_INSTANCE_LAYOUT_VERSION",t[t.REGENERATE_ALL_INSTANCES=126]="REGENERATE_ALL_INSTANCES",t[t.REGENERATE_SELECTED_INSTANCES=127]="REGENERATE_SELECTED_INSTANCES",t[t.REGENERATE_FILE_GEOMETRY=128]="REGENERATE_FILE_GEOMETRY",t[t.REGENERATE_MISSING_THUMBNAILS=129]="REGENERATE_MISSING_THUMBNAILS",t[t.BACKUP_ALL_OVERRIDES=130]="BACKUP_ALL_OVERRIDES",t[t.DETACH_ALL_INSTANCES=131]="DETACH_ALL_INSTANCES",t[t.TOGGLE_VARIABLES=132]="TOGGLE_VARIABLES",t[t.REMOVE_ORPHANED_VARIABLES=133]="REMOVE_ORPHANED_VARIABLES",t[t.REMOVE_RESPONSIVE_TEXT_STYLE_VARIANTS=134]="REMOVE_RESPONSIVE_TEXT_STYLE_VARIANTS",t[t.REPAIR_SELECTED_INSTANCES=135]="REPAIR_SELECTED_INSTANCES",t[t.REPAIR_BREAKPOINT_MULTIEDIT=136]="REPAIR_BREAKPOINT_MULTIEDIT",t[t.DETACH_DELETED_VARIABLES=137]="DETACH_DELETED_VARIABLES",t[t.DETACH_DELETED_STYLES=138]="DETACH_DELETED_STYLES",t[t.REPAIR_STATE_GROUP_VERSIONS=139]="REPAIR_STATE_GROUP_VERSIONS",t[t.REPAIR_VARIABLE_CONNECTIONS=140]="REPAIR_VARIABLE_CONNECTIONS",t[t.REPAIR_VARIABLE_MODE_VALUES=141]="REPAIR_VARIABLE_MODE_VALUES",t[t.RESTORE_SOFT_DELETED_VARIABLE_SETS=142]="RESTORE_SOFT_DELETED_VARIABLE_SETS",t[t.RERESOLVE_VARIABLE_REFERENCES=143]="RERESOLVE_VARIABLE_REFERENCES",t[t.RESTORE_AUTOLAYOUT_POSITION=144]="RESTORE_AUTOLAYOUT_POSITION",t[t.RESET_TRANSFORM=145]="RESET_TRANSFORM",t[t.RESET_VARIABLE_MODES=146]="RESET_VARIABLE_MODES",t[t.FIND_SHARED_INSTANCES_NEED_RELINKING=147]="FIND_SHARED_INSTANCES_NEED_RELINKING",t[t.RELINK_INSTANCES_TO_LOCAL_COMPONENT=148]="RELINK_INSTANCES_TO_LOCAL_COMPONENT",t[t.CALC_DELETED_COMPONENT_PUBLISHED_VERSION=149]="CALC_DELETED_COMPONENT_PUBLISHED_VERSION",t[t.REPUBLISH_SELECTED_COMPONENTS=150]="REPUBLISH_SELECTED_COMPONENTS",t[t.REPUBLISH_AUTO_LAYOUT_COMPONENTS=151]="REPUBLISH_AUTO_LAYOUT_COMPONENTS",t[t.SELECT_BROKEN_FIXED_SCROLLING_NODES=152]="SELECT_BROKEN_FIXED_SCROLLING_NODES",t[t.CLEAR_SELECTION_COMPONENT_PROPS=153]="CLEAR_SELECTION_COMPONENT_PROPS",t[t.REGENERATE_COMPONENT_PROPS=154]="REGENERATE_COMPONENT_PROPS",t[t.PRUNE_INVALID_COMPONENT_PROP_REFS=155]="PRUNE_INVALID_COMPONENT_PROP_REFS",t[t.PRUNE_ORPHANED_SLOT_CONTENT=156]="PRUNE_ORPHANED_SLOT_CONTENT",t[t.PRUNE_DERIVED_DATA=157]="PRUNE_DERIVED_DATA",t[t.REPAIR_MISSING_OVERRIDE_KEYS=158]="REPAIR_MISSING_OVERRIDE_KEYS",t[t.REPAIR_CORRUPT_OVERRIDE_KEYS_FOR_SELECTION=159]="REPAIR_CORRUPT_OVERRIDE_KEYS_FOR_SELECTION",t[t.RESTORE_SOFT_DELETED_SELECTION=160]="RESTORE_SOFT_DELETED_SELECTION",t[t.REPAIR_DUPLICATE_SUBSCRIBED_ASSETS=161]="REPAIR_DUPLICATE_SUBSCRIBED_ASSETS",t[t.REFLOW_IMMUTABLE_FRAMES=162]="REFLOW_IMMUTABLE_FRAMES",t[t.DISABLE_ALL_UNFRAMED_MASKS=163]="DISABLE_ALL_UNFRAMED_MASKS",t[t.RESIZE_TO_FIT=164]="RESIZE_TO_FIT",t[t.TOGGLE_FRAME_ORIENTATION=165]="TOGGLE_FRAME_ORIENTATION",t[t.START_CHAT=166]="START_CHAT",t[t.TOGGLE_FRAME_CLIPPING=167]="TOGGLE_FRAME_CLIPPING",t[t.HIDE_SIBLING_LAYERS=168]="HIDE_SIBLING_LAYERS",t[t.COLLAPSE_LAYERS=169]="COLLAPSE_LAYERS",t[t.DUPLICATE=170]="DUPLICATE",t[t.DUPLICATE_IN_PLACE=171]="DUPLICATE_IN_PLACE",t[t.QUICK_CREATE=172]="QUICK_CREATE",t[t.QUICK_CREATE_DIAGRAM_SIBLING=173]="QUICK_CREATE_DIAGRAM_SIBLING",t[t.FLIP_HORIZONTAL=174]="FLIP_HORIZONTAL",t[t.FLIP_VERTICAL=175]="FLIP_VERTICAL",t[t.ROTATE_180=176]="ROTATE_180",t[t.ROTATE_90_COUNTERCLOCKWISE=177]="ROTATE_90_COUNTERCLOCKWISE",t[t.ROTATE_90_CLOCKWISE=178]="ROTATE_90_CLOCKWISE",t[t.BRING_TO_FRONT=179]="BRING_TO_FRONT",t[t.BRING_FORWARD=180]="BRING_FORWARD",t[t.SEND_BACKWARD=181]="SEND_BACKWARD",t[t.SEND_TO_BACK=182]="SEND_TO_BACK",t[t.CONVERT_TO_RASTER=183]="CONVERT_TO_RASTER",t[t.FLATTEN_SELECTION=184]="FLATTEN_SELECTION",t[t.REMOVE_ANNOTATIONS=185]="REMOVE_ANNOTATIONS",t[t.ADD_ANNOTATION=186]="ADD_ANNOTATION",t[t.REMOVE_FILL=187]="REMOVE_FILL",t[t.REMOVE_GUIDE=188]="REMOVE_GUIDE",t[t.REMOVE_HORIZONTAL_GUIDES=189]="REMOVE_HORIZONTAL_GUIDES",t[t.REMOVE_VERTICAL_GUIDES=190]="REMOVE_VERTICAL_GUIDES",t[t.REMOVE_STROKE=191]="REMOVE_STROKE",t[t.SWAP_FILL_AND_STROKE=192]="SWAP_FILL_AND_STROKE",t[t.SELECT_SAME_FILL=193]="SELECT_SAME_FILL",t[t.SELECT_SAME_STROKE=194]="SELECT_SAME_STROKE",t[t.SELECT_SAME_EFFECT=195]="SELECT_SAME_EFFECT",t[t.SELECT_SAME_TEXT=196]="SELECT_SAME_TEXT",t[t.SELECT_SAME_FONT=197]="SELECT_SAME_FONT",t[t.SELECT_SAME_STYLE=198]="SELECT_SAME_STYLE",t[t.SELECT_SAME_INSTANCE=199]="SELECT_SAME_INSTANCE",t[t.SELECT_SAME_VARIANT=200]="SELECT_SAME_VARIANT",t[t.SELECT_ALL_TEXT=201]="SELECT_ALL_TEXT",t[t.REPLACE_SELECTED_TEXT=202]="REPLACE_SELECTED_TEXT",t[t.LOCK_ASPECT_RATIO=203]="LOCK_ASPECT_RATIO",t[t.UNLOCK_ASPECT_RATIO=204]="UNLOCK_ASPECT_RATIO",t[t.FRAME_SELECTION=205]="FRAME_SELECTION",t[t.GROUP_SELECTION=206]="GROUP_SELECTION",t[t.UNGROUP_SELECTION=207]="UNGROUP_SELECTION",t[t.CREATE_TEXT_NODE=208]="CREATE_TEXT_NODE",t[t.CREATE_TRIANGLE=209]="CREATE_TRIANGLE",t[t.CREATE_ELLIPSE=210]="CREATE_ELLIPSE",t[t.CREATE_ROUNDED_RECTANGLE=211]="CREATE_ROUNDED_RECTANGLE",t[t.CREATE_DIAMOND=212]="CREATE_DIAMOND",t[t.CREATE_COMMENT=213]="CREATE_COMMENT",t[t.CREATE_STICKY=214]="CREATE_STICKY",t[t.CREATE_SECTION=215]="CREATE_SECTION",t[t.CREATE_SLIDE=216]="CREATE_SLIDE",t[t.CREATE_ROW=217]="CREATE_ROW",t[t.MASK_SELECTION=218]="MASK_SELECTION",t[t.RENAME_SELECTION=219]="RENAME_SELECTION",t[t.CREATE_SECTION_FROM_SELECTION=220]="CREATE_SECTION_FROM_SELECTION",t[t.CREATE_BREAKPOINT=221]="CREATE_BREAKPOINT",t[t.REMOVE_BREAKPOINT=222]="REMOVE_BREAKPOINT",t[t.SET_AS_PRIMARY_BREAKPOINT=223]="SET_AS_PRIMARY_BREAKPOINT",t[t.REPLACE_SELECTED_FRAME_WITH_SECTION=224]="REPLACE_SELECTED_FRAME_WITH_SECTION",t[t.REPLACE_SELECTED_SECTION_WITH_FRAME=225]="REPLACE_SELECTED_SECTION_WITH_FRAME",t[t.CONVERT_SLOT_TO_FRAME=226]="CONVERT_SLOT_TO_FRAME",t[t.ADD_SELECTION_READY_STATUS=227]="ADD_SELECTION_READY_STATUS",t[t.MARK_INCOMPLETE=228]="MARK_INCOMPLETE",t[t.SET_SELECTION_COMPLETED_STATUS=229]="SET_SELECTION_COMPLETED_STATUS",t[t.REMOVE_SELECTION_STATUS=230]="REMOVE_SELECTION_STATUS",t[t.REMOVE_STATUS_IN_FOCUS_VIEW=231]="REMOVE_STATUS_IN_FOCUS_VIEW",t[t.CONVERT_TABLE_TO_STICKY_GRID=232]="CONVERT_TABLE_TO_STICKY_GRID",t[t.FIND_INSPIRATION=233]="FIND_INSPIRATION",t[t.FIND_CODEBASE_SUGGESTIONS=234]="FIND_CODEBASE_SUGGESTIONS",t[t.INSPECT_FRAGMENT=235]="INSPECT_FRAGMENT",t[t.CREATE_BRUSH_MENU=236]="CREATE_BRUSH_MENU",t[t.CREATE_STRETCH_BRUSH=237]="CREATE_STRETCH_BRUSH",t[t.CREATE_SCATTER_BRUSH=238]="CREATE_SCATTER_BRUSH",t[t.MIGRATE_EFFECT_REPEATS_TO_TRANSFORMS=239]="MIGRATE_EFFECT_REPEATS_TO_TRANSFORMS",t[t.MIGRATE_PATTERN_SPACING=240]="MIGRATE_PATTERN_SPACING",t[t.STACK_SELECTION=241]="STACK_SELECTION",t[t.STACK_SELECTED_NODES=242]="STACK_SELECTED_NODES",t[t.UNSTACK_SELECTION=243]="UNSTACK_SELECTION",t[t.GRID_SELECTION=244]="GRID_SELECTION",t[t.SET_SELECTION_FILL_HORIZONTAL=245]="SET_SELECTION_FILL_HORIZONTAL",t[t.SET_SELECTION_HUG_HORIZONTAL=246]="SET_SELECTION_HUG_HORIZONTAL",t[t.SET_SELECTION_FILL_VERTICAL=247]="SET_SELECTION_FILL_VERTICAL",t[t.SET_SELECTION_HUG_VERTICAL=248]="SET_SELECTION_HUG_VERTICAL",t[t.CREATE_ARC=249]="CREATE_ARC",t[t.APPLY_TRANSFORM_MODIFIERS=250]="APPLY_TRANSFORM_MODIFIERS",t[t.OUTLINE_STROKE=251]="OUTLINE_STROKE",t[t.LIVE_BOOLEAN_UNION=252]="LIVE_BOOLEAN_UNION",t[t.LIVE_BOOLEAN_SUBTRACT=253]="LIVE_BOOLEAN_SUBTRACT",t[t.LIVE_BOOLEAN_INTERSECT=254]="LIVE_BOOLEAN_INTERSECT",t[t.LIVE_BOOLEAN_XOR=255]="LIVE_BOOLEAN_XOR",t[t.ADD_TRANSFORM_MODIFIER_TO_SELECTION=256]="ADD_TRANSFORM_MODIFIER_TO_SELECTION",t[t.ADD_LINEAR_REPEAT_TO_SELECTION=257]="ADD_LINEAR_REPEAT_TO_SELECTION",t[t.ADD_SKEW_MODIFIER_TO_SELECTION=258]="ADD_SKEW_MODIFIER_TO_SELECTION",t[t.ALIGN_TOP=259]="ALIGN_TOP",t[t.ALIGN_VERTICAL_CENTER=260]="ALIGN_VERTICAL_CENTER",t[t.ALIGN_BOTTOM=261]="ALIGN_BOTTOM",t[t.ALIGN_LEFT=262]="ALIGN_LEFT",t[t.ALIGN_HORIZONTAL_CENTER=263]="ALIGN_HORIZONTAL_CENTER",t[t.ALIGN_RIGHT=264]="ALIGN_RIGHT",t[t.ALIGN_TOP_AS_GROUP=265]="ALIGN_TOP_AS_GROUP",t[t.ALIGN_VERTICAL_CENTER_AS_GROUP=266]="ALIGN_VERTICAL_CENTER_AS_GROUP",t[t.ALIGN_BOTTOM_AS_GROUP=267]="ALIGN_BOTTOM_AS_GROUP",t[t.ALIGN_LEFT_AS_GROUP=268]="ALIGN_LEFT_AS_GROUP",t[t.ALIGN_HORIZONTAL_CENTER_AS_GROUP=269]="ALIGN_HORIZONTAL_CENTER_AS_GROUP",t[t.ALIGN_RIGHT_AS_GROUP=270]="ALIGN_RIGHT_AS_GROUP",t[t.ROUND_TO_PIXELS=271]="ROUND_TO_PIXELS",t[t.ARRANGE_AS_GRID=272]="ARRANGE_AS_GRID",t[t.ARRANGE_AS_LIST=273]="ARRANGE_AS_LIST",t[t.TIDY_UP=274]="TIDY_UP",t[t.PACK_HORIZONTAL=275]="PACK_HORIZONTAL",t[t.PACK_VERTICAL=276]="PACK_VERTICAL",t[t.DISTRIBUTE_HORIZONTAL_SPACING=277]="DISTRIBUTE_HORIZONTAL_SPACING",t[t.DISTRIBUTE_VERTICAL_SPACING=278]="DISTRIBUTE_VERTICAL_SPACING",t[t.DISTRIBUTE_TOP=279]="DISTRIBUTE_TOP",t[t.DISTRIBUTE_VERTICAL_CENTER=280]="DISTRIBUTE_VERTICAL_CENTER",t[t.DISTRIBUTE_BOTTOM=281]="DISTRIBUTE_BOTTOM",t[t.DISTRIBUTE_LEFT=282]="DISTRIBUTE_LEFT",t[t.DISTRIBUTE_HORIZONTAL_CENTER=283]="DISTRIBUTE_HORIZONTAL_CENTER",t[t.DISTRIBUTE_RIGHT=284]="DISTRIBUTE_RIGHT",t[t.TOGGLE_BOLD=285]="TOGGLE_BOLD",t[t.TEXT_TOGGLE_ITALIC=286]="TEXT_TOGGLE_ITALIC",t[t.TEXT_BOLD_INCREASE=287]="TEXT_BOLD_INCREASE",t[t.TEXT_BOLD_DECREASE=288]="TEXT_BOLD_DECREASE",t[t.TEXT_TOGGLE_UNDERLINE=289]="TEXT_TOGGLE_UNDERLINE",t[t.TEXT_TOGGLE_STRIKETHROUGH=290]="TEXT_TOGGLE_STRIKETHROUGH",t[t.TEXT_REMOVE_DECORATION=291]="TEXT_REMOVE_DECORATION",t[t.TEXT_DELETE_SELECTION_OR_END=292]="TEXT_DELETE_SELECTION_OR_END",t[t.TEXT_DELETE_SELECTION_OR_NEXT_CHARACTER=293]="TEXT_DELETE_SELECTION_OR_NEXT_CHARACTER",t[t.TEXT_UPGRADE_TEXT_EXPLICIT_LAYOUT_VERSION=294]="TEXT_UPGRADE_TEXT_EXPLICIT_LAYOUT_VERSION",t[t.TEXT_UPGRADE_TO_BIDI=295]="TEXT_UPGRADE_TO_BIDI",t[t.TEXT_TOGGLE_ORDERED_LIST=296]="TEXT_TOGGLE_ORDERED_LIST",t[t.TEXT_TOGGLE_UNORDERED_LIST=297]="TEXT_TOGGLE_UNORDERED_LIST",t[t.TEXT_CLEAR_LIST_FORMATTING=298]="TEXT_CLEAR_LIST_FORMATTING",t[t.TEXT_INDENT_LIST=299]="TEXT_INDENT_LIST",t[t.TEXT_DEDENT_LIST=300]="TEXT_DEDENT_LIST",t[t.TEXT_DIRECTIONALITY_MENU=301]="TEXT_DIRECTIONALITY_MENU",t[t.SET_DIRECTIONALITY_LTR=302]="SET_DIRECTIONALITY_LTR",t[t.SET_DIRECTIONALITY_LTR_QA=303]="SET_DIRECTIONALITY_LTR_QA",t[t.SET_DIRECTIONALITY_RTL=304]="SET_DIRECTIONALITY_RTL",t[t.SET_DIRECTIONALITY_RTL_QA=305]="SET_DIRECTIONALITY_RTL_QA",t[t.TEXT_EDIT_HYPERLINK=306]="TEXT_EDIT_HYPERLINK",t[t.FOCUS_LINK_PANEL=307]="FOCUS_LINK_PANEL",t[t.TEXT_CASE_MENU=308]="TEXT_CASE_MENU",t[t.TEXT_SET_ORIGINAL_CASE=309]="TEXT_SET_ORIGINAL_CASE",t[t.TEXT_SET_UPPER_CASE=310]="TEXT_SET_UPPER_CASE",t[t.TEXT_SET_LOWER_CASE=311]="TEXT_SET_LOWER_CASE",t[t.TEXT_SET_TITLE_CASE=312]="TEXT_SET_TITLE_CASE",t[t.TEXT_SET_SMALL_CAPS=313]="TEXT_SET_SMALL_CAPS",t[t.TEXT_SET_FORCED_SMALL_CAPS=314]="TEXT_SET_FORCED_SMALL_CAPS",t[t.TEXT_RELAYOUT=315]="TEXT_RELAYOUT",t[t.TEXT_ALIGN_MENU=316]="TEXT_ALIGN_MENU",t[t.TEXT_ALIGN_LEFT=317]="TEXT_ALIGN_LEFT",t[t.TEXT_ALIGN_CENTER=318]="TEXT_ALIGN_CENTER",t[t.TEXT_ALIGN_RIGHT=319]="TEXT_ALIGN_RIGHT",t[t.TEXT_ALIGN_JUSTIFIED=320]="TEXT_ALIGN_JUSTIFIED",t[t.TEXT_ALIGN_TOP=321]="TEXT_ALIGN_TOP",t[t.TEXT_ALIGN_MIDDLE=322]="TEXT_ALIGN_MIDDLE",t[t.TEXT_ALIGN_BOTTOM=323]="TEXT_ALIGN_BOTTOM",t[t.TEXT_STYLE_TITLE=324]="TEXT_STYLE_TITLE",t[t.TEXT_STYLE_H1=325]="TEXT_STYLE_H1",t[t.TEXT_STYLE_H2=326]="TEXT_STYLE_H2",t[t.TEXT_STYLE_H3=327]="TEXT_STYLE_H3",t[t.TEXT_STYLE_NORMAL=328]="TEXT_STYLE_NORMAL",t[t.TEXT_ADJUST_MENU=329]="TEXT_ADJUST_MENU",t[t.TEXT_LINE_HEIGHT_DECREASE=330]="TEXT_LINE_HEIGHT_DECREASE",t[t.TEXT_LINE_HEIGHT_INCREASE=331]="TEXT_LINE_HEIGHT_INCREASE",t[t.TEXT_FONT_SIZE_DECREASE=332]="TEXT_FONT_SIZE_DECREASE",t[t.TEXT_FONT_SIZE_INCREASE=333]="TEXT_FONT_SIZE_INCREASE",t[t.TEXT_LETTER_SPACING_DECREASE=334]="TEXT_LETTER_SPACING_DECREASE",t[t.TEXT_LETTER_SPACING_INCREASE=335]="TEXT_LETTER_SPACING_INCREASE",t[t.GOTO_LAYER=336]="GOTO_LAYER",t[t.COMMIT=337]="COMMIT",t[t.AFTER_UNDO_REDO_COMMIT=338]="AFTER_UNDO_REDO_COMMIT",t[t.PURGE_ALL_MEMORY=339]="PURGE_ALL_MEMORY",t[t.REDRAW_CANVAS=340]="REDRAW_CANVAS",t[t.AFTER_FIRST_RENDER=341]="AFTER_FIRST_RENDER",t[t.REQUEST_EDIT_MODE=342]="REQUEST_EDIT_MODE",t[t.REQUEST_EDIT_MODE_VIA_TOOLBAR=343]="REQUEST_EDIT_MODE_VIA_TOOLBAR",t[t.LEAVE_EDIT_MODE=344]="LEAVE_EDIT_MODE",t[t.TOGGLE_EDIT_MODE=345]="TOGGLE_EDIT_MODE",t[t.TOGGLE_GRADIENT_EDIT_MODE=346]="TOGGLE_GRADIENT_EDIT_MODE",t[t.TOGGLE_PROGRESSIVE_BLUR_EDIT_MODE=347]="TOGGLE_PROGRESSIVE_BLUR_EDIT_MODE",t[t.TOGGLE_RASTER_EDIT_MODE=348]="TOGGLE_RASTER_EDIT_MODE",t[t.CROP_IMAGE=349]="CROP_IMAGE",t[t.ADD_IMAGE_OVERLAY=350]="ADD_IMAGE_OVERLAY",t[t.REMOVE_IMAGE_OVERLAY=351]="REMOVE_IMAGE_OVERLAY",t[t.ROTATE_IMAGE_90_CLOCKWISE=352]="ROTATE_IMAGE_90_CLOCKWISE",t[t.ENTER_LAYOUT_MODE=353]="ENTER_LAYOUT_MODE",t[t.ENTER_PREVIEW_MODE=354]="ENTER_PREVIEW_MODE",t[t.ENTER_HISTORY_MODE=355]="ENTER_HISTORY_MODE",t[t.ENTER_BRANCHING_MODE=356]="ENTER_BRANCHING_MODE",t[t.ENTER_LIBRARY_MODE=357]="ENTER_LIBRARY_MODE",t[t.DEV_HANDOFF_FOCUS_PREVIOUS=358]="DEV_HANDOFF_FOCUS_PREVIOUS",t[t.DEV_HANDOFF_FOCUS_NEXT=359]="DEV_HANDOFF_FOCUS_NEXT",t[t.TOGGLE_UI=360]="TOGGLE_UI",t[t.TOGGLE_KEYBOARD_SHORTCUTS=361]="TOGGLE_KEYBOARD_SHORTCUTS",t[t.TOGGLE_HELP_WIDGET=362]="TOGGLE_HELP_WIDGET",t[t.TOGGLE_LAYERS=363]="TOGGLE_LAYERS",t[t.TOGGLE_PUBLISH=364]="TOGGLE_PUBLISH",t[t.TOGGLE_LIBRARY=365]="TOGGLE_LIBRARY",t[t.TOGGLE_COMPONENT_INSERT_MODAL=366]="TOGGLE_COMPONENT_INSERT_MODAL",t[t.TOGGLE_SIDEBAR=367]="TOGGLE_SIDEBAR",t[t.TOGGLE_SNAPPING_TO_PIXELS=368]="TOGGLE_SNAPPING_TO_PIXELS",t[t.TOGGLE_SNAPPING_TO_OBJECTS=369]="TOGGLE_SNAPPING_TO_OBJECTS",t[t.TOGGLE_SNAPPING_TO_GEOMETRY=370]="TOGGLE_SNAPPING_TO_GEOMETRY",t[t.TOGGLE_SMART_QUOTES=371]="TOGGLE_SMART_QUOTES",t[t.TOGGLE_FLIP_DURING_RESIZE=372]="TOGGLE_FLIP_DURING_RESIZE",t[t.DISABLE_PINCH_ZOOM_FIX=373]="DISABLE_PINCH_ZOOM_FIX",t[t.TOGGLE_LAYER_HOVER=374]="TOGGLE_LAYER_HOVER",t[t.TOGGLE_STICKY_TOOLS=375]="TOGGLE_STICKY_TOOLS",t[t.TOGGLE_COPY_RENAMING=376]="TOGGLE_COPY_RENAMING",t[t.TOGGLE_VIEWPORT_OVERLAY_HIDING=377]="TOGGLE_VIEWPORT_OVERLAY_HIDING",t[t.TOGGLE_KEYBOARD_ZOOM_TO_SELECTION=378]="TOGGLE_KEYBOARD_ZOOM_TO_SELECTION",t[t.TOGGLE_MULTIPLAYER_CURSORS=379]="TOGGLE_MULTIPLAYER_CURSORS",t[t.TOGGLE_SHOW_PROPERTY_LABELS=380]="TOGGLE_SHOW_PROPERTY_LABELS",t[t.ZOOM_IN=381]="ZOOM_IN",t[t.ZOOM_OUT=382]="ZOOM_OUT",t[t.ZOOM_RESET=383]="ZOOM_RESET",t[t.ZOOM_TO_FIT=384]="ZOOM_TO_FIT",t[t.ZOOM_TO_SELECTION=385]="ZOOM_TO_SELECTION",t[t.SHOW_SELECTED_NODES=386]="SHOW_SELECTED_NODES",t[t.HIDE_SELECTED_NODES=387]="HIDE_SELECTED_NODES",t[t.TOGGLE_SHOWN_FOR_SELECTED_NODES=388]="TOGGLE_SHOWN_FOR_SELECTED_NODES",t[t.UNHIDE_ALL=389]="UNHIDE_ALL",t[t.LOCK_SELECTED_NODES=390]="LOCK_SELECTED_NODES",t[t.LOCK_SELECTED_SECTION_ONLY=391]="LOCK_SELECTED_SECTION_ONLY",t[t.UNLOCK_SELECTED_NODES=392]="UNLOCK_SELECTED_NODES",t[t.TOGGLE_LOCKED_FOR_SELECTED_NODES=393]="TOGGLE_LOCKED_FOR_SELECTED_NODES",t[t.UNLOCK_ALL=394]="UNLOCK_ALL",t[t.DELETE_AND_HEAL_SELECTION=395]="DELETE_AND_HEAL_SELECTION",t[t.JOIN_SELECTION=396]="JOIN_SELECTION",t[t.SMOOTH_JOIN_SELECTION=397]="SMOOTH_JOIN_SELECTION",t[t.BREAK_VECTOR_NETWORK_INTO_PATHS=398]="BREAK_VECTOR_NETWORK_INTO_PATHS",t[t.DESELECT_ALL=399]="DESELECT_ALL",t[t.DELETE_SELECTION=400]="DELETE_SELECTION",t[t.TOGGLE_MENU=401]="TOGGLE_MENU",t[t.INSERT_INTERACTIVE_ELEMENT_INTO_ACTIVE_SLIDE=402]="INSERT_INTERACTIVE_ELEMENT_INTO_ACTIVE_SLIDE",t[t.TOGGLE_PREFERENCES=403]="TOGGLE_PREFERENCES",t[t.ENTER=404]="ENTER",t[t.ESCAPE=405]="ESCAPE",t[t.MULTI_EDIT_TEXT=406]="MULTI_EDIT_TEXT",t[t.FOCUS_MODE=407]="FOCUS_MODE",t[t.FOCUS_MODE_COMPONENT_SET_TOGGLE=408]="FOCUS_MODE_COMPONENT_SET_TOGGLE",t[t.FOCUS_MODE_RESPONSIVE_SET_TOGGLE=409]="FOCUS_MODE_RESPONSIVE_SET_TOGGLE",t[t.TOGGLE_RESPONSIVE_CONTAINER_MULTIEDIT=410]="TOGGLE_RESPONSIVE_CONTAINER_MULTIEDIT",t[t.FOCUS_MODE_EXIT=411]="FOCUS_MODE_EXIT",t[t.CANVAS_SEARCH=412]="CANVAS_SEARCH",t[t.CANVAS_SEARCH_EXIT=413]="CANVAS_SEARCH_EXIT",t[t.CANVAS_SEARCH_NEXT=414]="CANVAS_SEARCH_NEXT",t[t.CANVAS_SEARCH_PREV=415]="CANVAS_SEARCH_PREV",t[t.CANVAS_SEARCH_REPLACE=416]="CANVAS_SEARCH_REPLACE",t[t.TOGGLE_RETINA_MODE=417]="TOGGLE_RETINA_MODE",t[t.TOGGLE_PIXEL_PREVIEW=418]="TOGGLE_PIXEL_PREVIEW",t[t.TOGGLE_GOOGLE_FONTS=419]="TOGGLE_GOOGLE_FONTS",t[t.TOGGLE_SHOW_SLICES=420]="TOGGLE_SHOW_SLICES",t[t.TOGGLE_SHOW_COMMENTS=421]="TOGGLE_SHOW_COMMENTS",t[t.TOGGLE_SHOW_ANNOTATIONS=422]="TOGGLE_SHOW_ANNOTATIONS",t[t.TOGGLE_ALWAYS_EXPAND_ANNOTATIONS=423]="TOGGLE_ALWAYS_EXPAND_ANNOTATIONS",t[t.TOGGLE_DROPPER=424]="TOGGLE_DROPPER",t[t.TOGGLE_INVERT_ZOOM=425]="TOGGLE_INVERT_ZOOM",t[t.TOGGLE_CURSOR_HIGH_FIVE_WIGGLE=426]="TOGGLE_CURSOR_HIGH_FIVE_WIGGLE",t[t.TOGGLE_USE_NUMBERS_FOR_OPACITY=427]="TOGGLE_USE_NUMBERS_FOR_OPACITY",t[t.TOGGLE_USE_OLD_OUTLINE_SHORTCUTS=428]="TOGGLE_USE_OLD_OUTLINE_SHORTCUTS",t[t.TOGGLE_TEXT_SUGGESTIONS_PREFERENCE=429]="TOGGLE_TEXT_SUGGESTIONS_PREFERENCE",t[t.TOGGLE_SUGGESTED_AI_ACTIONS_PREFERENCE=430]="TOGGLE_SUGGESTED_AI_ACTIONS_PREFERENCE",t[t.TOGGLE_AI_SOUND_NOTIFICATION=431]="TOGGLE_AI_SOUND_NOTIFICATION",t[t.TOGGLE_CTRL_CLICK_CONTEXT_MENU=432]="TOGGLE_CTRL_CLICK_CONTEXT_MENU",t[t.SHOW_NUDGE_AMOUNT_PICKER=433]="SHOW_NUDGE_AMOUNT_PICKER",t[t.SET_OPACITY_0=434]="SET_OPACITY_0",t[t.SET_OPACITY_1=435]="SET_OPACITY_1",t[t.SET_OPACITY_2=436]="SET_OPACITY_2",t[t.SET_OPACITY_3=437]="SET_OPACITY_3",t[t.SET_OPACITY_4=438]="SET_OPACITY_4",t[t.SET_OPACITY_5=439]="SET_OPACITY_5",t[t.SET_OPACITY_6=440]="SET_OPACITY_6",t[t.SET_OPACITY_7=441]="SET_OPACITY_7",t[t.SET_OPACITY_8=442]="SET_OPACITY_8",t[t.SET_OPACITY_9=443]="SET_OPACITY_9",t[t.KEYBOARD_LAYOUT_US_QWERTY=444]="KEYBOARD_LAYOUT_US_QWERTY",t[t.KEYBOARD_LAYOUT_FRENCH_AZERTY=445]="KEYBOARD_LAYOUT_FRENCH_AZERTY",t[t.KEYBOARD_LAYOUT_GERMAN=446]="KEYBOARD_LAYOUT_GERMAN",t[t.KEYBOARD_LAYOUT_JAPANESE_KANA=447]="KEYBOARD_LAYOUT_JAPANESE_KANA",t[t.KEYBOARD_LAYOUT_DVORAK=448]="KEYBOARD_LAYOUT_DVORAK",t[t.KEYBOARD_LAYOUT_RESET=449]="KEYBOARD_LAYOUT_RESET",t[t.KEYBOARD_LAYOUT_UK_MAC=450]="KEYBOARD_LAYOUT_UK_MAC",t[t.KEYBOARD_LAYOUT_UK_PC=451]="KEYBOARD_LAYOUT_UK_PC",t[t.KEYBOARD_LAYOUT_SWEDISH=452]="KEYBOARD_LAYOUT_SWEDISH",t[t.KEYBOARD_LAYOUT_FINNISH=453]="KEYBOARD_LAYOUT_FINNISH",t[t.KEYBOARD_LAYOUT_DANISH=454]="KEYBOARD_LAYOUT_DANISH",t[t.KEYBOARD_LAYOUT_NORWEGIAN=455]="KEYBOARD_LAYOUT_NORWEGIAN",t[t.KEYBOARD_LAYOUT_ITALIAN=456]="KEYBOARD_LAYOUT_ITALIAN",t[t.KEYBOARD_LAYOUT_SPANISH=457]="KEYBOARD_LAYOUT_SPANISH",t[t.KEYBOARD_LAYOUT_SPANISH_LATAM=458]="KEYBOARD_LAYOUT_SPANISH_LATAM",t[t.KEYBOARD_LAYOUT_CHINESE=459]="KEYBOARD_LAYOUT_CHINESE",t[t.KEYBOARD_LAYOUT_PORTUGUESE=460]="KEYBOARD_LAYOUT_PORTUGUESE",t[t.KEYBOARD_LAYOUT_KOREAN=461]="KEYBOARD_LAYOUT_KOREAN",t[t.TOGGLE_LEADING_TRIM=462]="TOGGLE_LEADING_TRIM",t[t.TOGGLE_HANGING_PUNCTUATION=463]="TOGGLE_HANGING_PUNCTUATION",t[t.TOGGLE_HANGING_LIST=464]="TOGGLE_HANGING_LIST",t[t.TOGGLE_SPELL_CHECK=465]="TOGGLE_SPELL_CHECK",t[t.REDO_SPELL_CHECKING=466]="REDO_SPELL_CHECKING",t[t.TOGGLE_ENABLE_CODGEN_MCP_SERVER=467]="TOGGLE_ENABLE_CODGEN_MCP_SERVER",t[t.SET_DEFAULT_EMOJI_SKIN_TONE=468]="SET_DEFAULT_EMOJI_SKIN_TONE",t[t.SET_TOOL_FRAME=469]="SET_TOOL_FRAME",t[t.SET_TOOL_SLICE=470]="SET_TOOL_SLICE",t[t.SET_TOOL_SCALE=471]="SET_TOOL_SCALE",t[t.SET_TOOL_TYPE=472]="SET_TOOL_TYPE",t[t.SET_TOOL_LINE=473]="SET_TOOL_LINE",t[t.SET_TOOL_ARROW=474]="SET_TOOL_ARROW",t[t.SET_TOOL_PEN=475]="SET_TOOL_PEN",t[t.SET_TOOL_PENCIL=476]="SET_TOOL_PENCIL",t[t.SET_TOOL_BEND=477]="SET_TOOL_BEND",t[t.SET_TOOL_CUT=478]="SET_TOOL_CUT",t[t.SET_TOOL_OFFSET_PATH=479]="SET_TOOL_OFFSET_PATH",t[t.SET_TOOL_SIMPLIFY_VECTOR=480]="SET_TOOL_SIMPLIFY_VECTOR",t[t.SET_TOOL_PAINT_BUCKET=481]="SET_TOOL_PAINT_BUCKET",t[t.SET_TOOL_SHAPE_BUILDER=482]="SET_TOOL_SHAPE_BUILDER",t[t.SET_TOOL_VECTOR_LASSO=483]="SET_TOOL_VECTOR_LASSO",t[t.SET_TOOL_IMAGE_LASSO=484]="SET_TOOL_IMAGE_LASSO",t[t.SET_TOOL_VAR_WIDTH_POINT=485]="SET_TOOL_VAR_WIDTH_POINT",t[t.SET_TOOL_STAR=486]="SET_TOOL_STAR",t[t.SET_TOOL_ELLIPSE=487]="SET_TOOL_ELLIPSE",t[t.SET_TOOL_RECTANGLE=488]="SET_TOOL_RECTANGLE",t[t.SET_TOOL_REGULAR_POLYGON=489]="SET_TOOL_REGULAR_POLYGON",t[t.SET_TOOL_DEFAULT=490]="SET_TOOL_DEFAULT",t[t.SET_TOOL_DEFAULT_FIGJAM=491]="SET_TOOL_DEFAULT_FIGJAM",t[t.SET_TOOL_DEFAULT_DEV_HANDOFF=492]="SET_TOOL_DEFAULT_DEV_HANDOFF",t[t.SET_TOOL_HAND=493]="SET_TOOL_HAND",t[t.SET_TOOL_OLD_SELECT=494]="SET_TOOL_OLD_SELECT",t[t.SET_TOOL_MULTISELECT=495]="SET_TOOL_MULTISELECT",t[t.SET_TOOL_LASSO=496]="SET_TOOL_LASSO",t[t.SET_TOOL_COMMENTS=497]="SET_TOOL_COMMENTS",t[t.SPOTLIGHT_ME=498]="SPOTLIGHT_ME",t[t.FOLLOW_PRESENTER=499]="FOLLOW_PRESENTER",t[t.SET_TOOL_CONNECTOR_ELBOWED=500]="SET_TOOL_CONNECTOR_ELBOWED",t[t.SET_TOOL_CONNECTOR_STRAIGHT=501]="SET_TOOL_CONNECTOR_STRAIGHT",t[t.SET_TOOL_CONNECTOR_CURVED=502]="SET_TOOL_CONNECTOR_CURVED",t[t.SET_TOOL_CONNECTOR_STRAIGHT_NO_ENDPOINTS=503]="SET_TOOL_CONNECTOR_STRAIGHT_NO_ENDPOINTS",t[t.SET_TOOL_STICKY=504]="SET_TOOL_STICKY",t[t.SET_TOOL_STAMP=505]="SET_TOOL_STAMP",t[t.SET_TOOL_SHAPE_WHITEBOARD_SQUARE=506]="SET_TOOL_SHAPE_WHITEBOARD_SQUARE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ELLIPSE=507]="SET_TOOL_SHAPE_WHITEBOARD_ELLIPSE",t[t.SET_TOOL_SHAPE_WHITEBOARD_DIAMOND=508]="SET_TOOL_SHAPE_WHITEBOARD_DIAMOND",t[t.SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_UP=509]="SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_UP",t[t.SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_DOWN=510]="SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_DOWN",t[t.SET_TOOL_SHAPE_WHITEBOARD_ROUNDED_RECTANGLE=511]="SET_TOOL_SHAPE_WHITEBOARD_ROUNDED_RECTANGLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT=512]="SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT",t[t.SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT=513]="SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_DATABASE=514]="SET_TOOL_SHAPE_WHITEBOARD_ENG_DATABASE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_QUEUE=515]="SET_TOOL_SHAPE_WHITEBOARD_ENG_QUEUE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_FILE=516]="SET_TOOL_SHAPE_WHITEBOARD_ENG_FILE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_FOLDER=517]="SET_TOOL_SHAPE_WHITEBOARD_ENG_FOLDER",t[t.SET_TOOL_SHAPE_WHITEBOARD_TRAPEZOID=518]="SET_TOOL_SHAPE_WHITEBOARD_TRAPEZOID",t[t.SET_TOOL_SHAPE_WHITEBOARD_STAR=519]="SET_TOOL_SHAPE_WHITEBOARD_STAR",t[t.SET_TOOL_SHAPE_WHITEBOARD_SHIELD=520]="SET_TOOL_SHAPE_WHITEBOARD_SHIELD",t[t.SET_TOOL_SHAPE_WHITEBOARD_HEXAGON=521]="SET_TOOL_SHAPE_WHITEBOARD_HEXAGON",t[t.SET_TOOL_SHAPE_WHITEBOARD_PENTAGON=522]="SET_TOOL_SHAPE_WHITEBOARD_PENTAGON",t[t.SET_TOOL_SHAPE_WHITEBOARD_OCTAGON=523]="SET_TOOL_SHAPE_WHITEBOARD_OCTAGON",t[t.SET_TOOL_SHAPE_WHITEBOARD_PLUS=524]="SET_TOOL_SHAPE_WHITEBOARD_PLUS",t[t.SET_TOOL_SHAPE_WHITEBOARD_PREDEFINED_PROCESS=525]="SET_TOOL_SHAPE_WHITEBOARD_PREDEFINED_PROCESS",t[t.SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_SINGLE=526]="SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_SINGLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE=527]="SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_MANUAL_INPUT=528]="SET_TOOL_SHAPE_WHITEBOARD_MANUAL_INPUT",t[t.SET_TOOL_SHAPE_WHITEBOARD_CHEVRON=529]="SET_TOOL_SHAPE_WHITEBOARD_CHEVRON",t[t.SET_TOOL_SHAPE_WHITEBOARD_ARROW_LEFT=530]="SET_TOOL_SHAPE_WHITEBOARD_ARROW_LEFT",t[t.SET_TOOL_SHAPE_WHITEBOARD_ARROW_RIGHT=531]="SET_TOOL_SHAPE_WHITEBOARD_ARROW_RIGHT",t[t.SET_TOOL_SHAPE_WHITEBOARD_SUMMING_JUNCTION=532]="SET_TOOL_SHAPE_WHITEBOARD_SUMMING_JUNCTION",t[t.SET_TOOL_SHAPE_WHITEBOARD_OR=533]="SET_TOOL_SHAPE_WHITEBOARD_OR",t[t.SET_TOOL_SHAPE_WHITEBOARD_SPEECH_BUBBLE=534]="SET_TOOL_SHAPE_WHITEBOARD_SPEECH_BUBBLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_INTERNAL_STORAGE=535]="SET_TOOL_SHAPE_WHITEBOARD_INTERNAL_STORAGE",t[t.SET_TOOL_MINDMAP_TREE_NUCLEUS=536]="SET_TOOL_MINDMAP_TREE_NUCLEUS",t[t.SET_TOOL_SHAPE_WHITEBOARD_PLATFORM=537]="SET_TOOL_SHAPE_WHITEBOARD_PLATFORM",t[t.SET_TOOL_ERASER=538]="SET_TOOL_ERASER",t[t.SET_TOOL_HIGHLIGHTER=539]="SET_TOOL_HIGHLIGHTER",t[t.SET_TOOL_SECTION=540]="SET_TOOL_SECTION",t[t.SET_TOOL_WASHI_TAPE=541]="SET_TOOL_WASHI_TAPE",t[t.SET_TOOL_TABLE=542]="SET_TOOL_TABLE",t[t.SET_TOOL_ANNOTATE=543]="SET_TOOL_ANNOTATE",t[t.START_MAGIC_LINK=544]="START_MAGIC_LINK",t[t.END_MAGIC_LINK=545]="END_MAGIC_LINK",t[t.OPEN_MAKE_PROTOTYPE_MODAL=546]="OPEN_MAKE_PROTOTYPE_MODAL",t[t.SET_TOOL_MEASURE=547]="SET_TOOL_MEASURE",t[t.SET_TOOL_BRUSH=548]="SET_TOOL_BRUSH",t[t.SET_TOOL_KEYBOARD_SELECT=549]="SET_TOOL_KEYBOARD_SELECT",t[t.SET_TOOL_SLIDES_POLL=550]="SET_TOOL_SLIDES_POLL",t[t.SET_TOOL_SLIDES_EMBED=551]="SET_TOOL_SLIDES_EMBED",t[t.SET_TOOL_SLIDES_FACEPILE=552]="SET_TOOL_SLIDES_FACEPILE",t[t.SET_TOOL_SLIDES_ALIGNMENT_SCALE=553]="SET_TOOL_SLIDES_ALIGNMENT_SCALE",t[t.SET_TOOL_SLIDES_YOUTUBE=554]="SET_TOOL_SLIDES_YOUTUBE",t[t.SET_TOOL_SLIDE_NUMBER=555]="SET_TOOL_SLIDE_NUMBER",t[t.SET_TOOL_SITES_RESPONSIVE_SET=556]="SET_TOOL_SITES_RESPONSIVE_SET",t[t.SET_TOOL_SITES_WEBPAGE=557]="SET_TOOL_SITES_WEBPAGE",t[t.SET_TOOL_SITES_RESPONSIVE_NODE_SET=558]="SET_TOOL_SITES_RESPONSIVE_NODE_SET",t[t.SET_TOOL_SITES_LINK=559]="SET_TOOL_SITES_LINK",t[t.SET_TOOL_SITES_EMBED=560]="SET_TOOL_SITES_EMBED",t[t.SET_TOOL_CODE_COMPONENT=561]="SET_TOOL_CODE_COMPONENT",t[t.SET_TOOL_PATTERN_SOURCE_SELECTOR=562]="SET_TOOL_PATTERN_SOURCE_SELECTOR",t[t.SET_TOOL_JSX=563]="SET_TOOL_JSX",t[t.TOGGLE_SECTION_VISIBILITY=564]="TOGGLE_SECTION_VISIBILITY",t[t.OPEN_TIMER=565]="OPEN_TIMER",t[t.SET_TOOL_CODE_BLOCK=566]="SET_TOOL_CODE_BLOCK",t[t.ADD_CONNECTOR_TEXT=567]="ADD_CONNECTOR_TEXT",t[t.TOGGLE_SHOW_GUIDS=568]="TOGGLE_SHOW_GUIDS",t[t.TEST_INDEPENDENT_LAYER_ANIMATION=569]="TEST_INDEPENDENT_LAYER_ANIMATION",t[t.TEST_INDEPENDENT_LAYER_ANIMATION_EASED=570]="TEST_INDEPENDENT_LAYER_ANIMATION_EASED",t[t.TEST_INDEPENDENT_LAYER_ANIMATION_OPACITY=571]="TEST_INDEPENDENT_LAYER_ANIMATION_OPACITY",t[t.TEST_NON_INDEPENDENT_LAYER_ANIMATION=572]="TEST_NON_INDEPENDENT_LAYER_ANIMATION",t[t.PRINT_VECTOR_NETWORK_AS_TEST_CODE=573]="PRINT_VECTOR_NETWORK_AS_TEST_CODE",t[t.DEBUG_TOGGLE_SHOW_VECTOR_NETWORK_LABELS=574]="DEBUG_TOGGLE_SHOW_VECTOR_NETWORK_LABELS",t[t.DEBUG_TOGGLE_DONT_MERGE_STROKE_OUTLINES=575]="DEBUG_TOGGLE_DONT_MERGE_STROKE_OUTLINES",t[t.TOGGLE_SHOW_SEMANTIC_TAGS_ON_LAYER_ROWS=576]="TOGGLE_SHOW_SEMANTIC_TAGS_ON_LAYER_ROWS",t[t.FORCE_PUBLISH_STATE_GROUP=577]="FORCE_PUBLISH_STATE_GROUP",t[t.INSPECT_IN_FIGMASCOPE=578]="INSPECT_IN_FIGMASCOPE",t[t.TOGGLE_SHOW_QUICK_COMMAND_RANK_DEBUG=579]="TOGGLE_SHOW_QUICK_COMMAND_RANK_DEBUG",t[t.TOGGLE_SHOW_IMMUTABLE_FRAME_SUBLAYERS=580]="TOGGLE_SHOW_IMMUTABLE_FRAME_SUBLAYERS",t[t.TOGGLE_RESOURCE_USE=581]="TOGGLE_RESOURCE_USE",t[t.TOGGLE_MEMORY_USAGE_INDICATOR=582]="TOGGLE_MEMORY_USAGE_INDICATOR",t[t.TOGGLE_RULERS=583]="TOGGLE_RULERS",t[t.ADJUST_RULER_GUIDES=584]="ADJUST_RULER_GUIDES",t[t.TOGGLE_PRINT_MARKS=585]="TOGGLE_PRINT_MARKS",t[t.TOGGLE_RULER_UNIT_PIXELS=586]="TOGGLE_RULER_UNIT_PIXELS",t[t.TOGGLE_RULER_UNIT_INCHES=587]="TOGGLE_RULER_UNIT_INCHES",t[t.TOGGLE_RULER_UNIT_CENTIMETERS=588]="TOGGLE_RULER_UNIT_CENTIMETERS",t[t.RULER_MENU=589]="RULER_MENU",t[t.RUN_MULTI_STACK_AUTO_LAYOUT=590]="RUN_MULTI_STACK_AUTO_LAYOUT",t[t.RUN_SET_RESPONSIVE_SETTINGS=591]="RUN_SET_RESPONSIVE_SETTINGS",t[t.DESTROY_ALL_AUTO_LAYOUT=592]="DESTROY_ALL_AUTO_LAYOUT",t[t.TOGGLE_ANNOTATIONS=593]="TOGGLE_ANNOTATIONS",t[t.TOGGLE_GRID=594]="TOGGLE_GRID",t[t.TOGGLE_PERF_HUD=595]="TOGGLE_PERF_HUD",t[t.TOGGLE_FAKE_MP_ACTIVITY=596]="TOGGLE_FAKE_MP_ACTIVITY",t[t.TOGGLE_TSMER_CONFIG=597]="TOGGLE_TSMER_CONFIG",t[t.TOGGLE_DEBUG_DOC_SYNC_LOGS=598]="TOGGLE_DEBUG_DOC_SYNC_LOGS",t[t.TOGGLE_DEBUG_USER_SYNC_LOGS=599]="TOGGLE_DEBUG_USER_SYNC_LOGS",t[t.TOGGLE_DEBUG_PAGE_SYNC_LOGS=600]="TOGGLE_DEBUG_PAGE_SYNC_LOGS",t[t.DEBUG_INCREMENTAL_LOADING_ALL_PAGES=601]="DEBUG_INCREMENTAL_LOADING_ALL_PAGES",t[t.DEBUG_INCREMENTAL_LOADING_CURRENT_ONLY=602]="DEBUG_INCREMENTAL_LOADING_CURRENT_ONLY",t[t.TOGGLE_DEBUG_LAYOUT_LOGS=603]="TOGGLE_DEBUG_LAYOUT_LOGS",t[t.TOGGLE_DEBUG_MATERIALIZER_LOGS=604]="TOGGLE_DEBUG_MATERIALIZER_LOGS",t[t.TOGGLE_OUTLINES=605]="TOGGLE_OUTLINES",t[t.TOGGLE_OUTLINE_HIDDEN_LAYERS=606]="TOGGLE_OUTLINE_HIDDEN_LAYERS",t[t.TOGGLE_OUTLINE_OBJECT_BOUNDS=607]="TOGGLE_OUTLINE_OBJECT_BOUNDS",t[t.TOGGLE_SHOWN_LAYOUT_GRIDS=608]="TOGGLE_SHOWN_LAYOUT_GRIDS",t[t.TOGGLE_SHOW_MASKS=609]="TOGGLE_SHOW_MASKS",t[t.TOGGLE_SHOW_ARTBOARD_OUTLINES=610]="TOGGLE_SHOW_ARTBOARD_OUTLINES",t[t.TOGGLE_USE_REALMS_FOR_PLUGIN_DEV=611]="TOGGLE_USE_REALMS_FOR_PLUGIN_DEV",t[t.CLEAR_TOOL=612]="CLEAR_TOOL",t[t.PLACE_ALL_IMAGES=613]="PLACE_ALL_IMAGES",t[t.DISCARD_ALL_IMAGES=614]="DISCARD_ALL_IMAGES",t[t.TOGGLE_PEN_TOOL_AVOID_SINGLE_HANDLES=615]="TOGGLE_PEN_TOOL_AVOID_SINGLE_HANDLES",t[t.TOGGLE_SNAPPING_TO_DOTS=616]="TOGGLE_SNAPPING_TO_DOTS",t[t.TOGGLE_SHOW_DOT_GRID=617]="TOGGLE_SHOW_DOT_GRID",t[t.TOGGLE_SCROLL_WHEEL_ZOOM=618]="TOGGLE_SCROLL_WHEEL_ZOOM",t[t.TOGGLE_RIGHT_CLICK_PAN=619]="TOGGLE_RIGHT_CLICK_PAN",t[t.SET_SCROLL_WHEEL_ZOOM_ENABLED=620]="SET_SCROLL_WHEEL_ZOOM_ENABLED",t[t.SET_SCROLL_WHEEL_ZOOM_DISABLED=621]="SET_SCROLL_WHEEL_ZOOM_DISABLED",t[t.SET_RIGHT_CLICK_PAN_ENABLED=622]="SET_RIGHT_CLICK_PAN_ENABLED",t[t.SET_RIGHT_CLICK_PAN_DISABLED=623]="SET_RIGHT_CLICK_PAN_DISABLED",t[t.TOGGLE_INCLUDE_EVERYTHING_IN_TAB_ORDER=624]="TOGGLE_INCLUDE_EVERYTHING_IN_TAB_ORDER",t[t.REMOVE_INTERACTIONS_ON_SELECTION=625]="REMOVE_INTERACTIONS_ON_SELECTION",t[t.REMOVE_INTERACTIONS_ON_PAGE=626]="REMOVE_INTERACTIONS_ON_PAGE",t[t.ADD_PROTOTYPE_STARTING_POINT=627]="ADD_PROTOTYPE_STARTING_POINT",t[t.DELETE_PROTOTYPE_STARTING_POINT=628]="DELETE_PROTOTYPE_STARTING_POINT",t[t.UPDATE_INTERACTIONS_STATE_MANAGEMENT_ON_PAGE=629]="UPDATE_INTERACTIONS_STATE_MANAGEMENT_ON_PAGE",t[t.TOGGLE_INLINE_PREVIEW=630]="TOGGLE_INLINE_PREVIEW",t[t.TOGGLE_INLINE_HTML_PREVIEW=631]="TOGGLE_INLINE_HTML_PREVIEW",t[t.INLINE_PREVIEW_RESET_SIZE=632]="INLINE_PREVIEW_RESET_SIZE",t[t.INLINE_PREVIEW_LOADED=633]="INLINE_PREVIEW_LOADED",t[t.INLINE_PREVIEW_PRESENTED_NODE_CHANGED=634]="INLINE_PREVIEW_PRESENTED_NODE_CHANGED",t[t.INLINE_PREVIEW_IFRAME_FOCUS_STATE_CHANGED=635]="INLINE_PREVIEW_IFRAME_FOCUS_STATE_CHANGED",t[t.OPEN_HELP=636]="OPEN_HELP",t[t.OPEN_SHORTCUTS=637]="OPEN_SHORTCUTS",t[t.OPEN_SUPPORT_FORUM=638]="OPEN_SUPPORT_FORUM",t[t.OPEN_TUTORIALS=639]="OPEN_TUTORIALS",t[t.OPEN_LEGAL_SUMMARY=640]="OPEN_LEGAL_SUMMARY",t[t.OPEN_RELEASE_NOTES=641]="OPEN_RELEASE_NOTES",t[t.OPEN_ACCOUNT_SETTINGS=642]="OPEN_ACCOUNT_SETTINGS",t[t.OPEN_PREFERENCES_MODAL=643]="OPEN_PREFERENCES_MODAL",t[t.SIMULATE_BACK_TO_FILES=644]="SIMULATE_BACK_TO_FILES",t[t.DUMP_PENDING_REGISTERS=645]="DUMP_PENDING_REGISTERS",t[t.DUMP_UNDO_HISTORY=646]="DUMP_UNDO_HISTORY",t[t.TOGGLE_RECORDING_INTERACTIONS=647]="TOGGLE_RECORDING_INTERACTIONS",t[t.TOGGLE_FEATURE_FLAG_BISECTOR=648]="TOGGLE_FEATURE_FLAG_BISECTOR",t[t.INSERT_LOTS_OF_TEXT=649]="INSERT_LOTS_OF_TEXT",t[t.ADD_FILL_TO_SELECTION=650]="ADD_FILL_TO_SELECTION",t[t.ADD_STROKE_TO_SELECTION=651]="ADD_STROKE_TO_SELECTION",t[t.ADD_FILL_TO_STYLE_SELECTION=652]="ADD_FILL_TO_STYLE_SELECTION",t[t.TOGGLE_PRESSURE_SENSITIVITY=653]="TOGGLE_PRESSURE_SENSITIVITY",t[t.NEXT_ARTBOARD=654]="NEXT_ARTBOARD",t[t.PREVIOUS_ARTBOARD=655]="PREVIOUS_ARTBOARD",t[t.NEXT_ARTBOARD_SAME_ZOOM=656]="NEXT_ARTBOARD_SAME_ZOOM",t[t.PREVIOUS_ARTBOARD_SAME_ZOOM=657]="PREVIOUS_ARTBOARD_SAME_ZOOM",t[t.TEST_MULTIPLAYER_UPGRADE=658]="TEST_MULTIPLAYER_UPGRADE",t[t.TEST_REJECT_TOO_OLD=659]="TEST_REJECT_TOO_OLD",t[t.TEST_REJECT_INVALID_PERMISSIONS=660]="TEST_REJECT_INVALID_PERMISSIONS",t[t.TEST_REJECT_NOT_LOGGED_IN=661]="TEST_REJECT_NOT_LOGGED_IN",t[t.TEST_REJECT_TOO_MANY_CONNECTIONS=662]="TEST_REJECT_TOO_MANY_CONNECTIONS",t[t.PLUGINS_RUN_LAST=663]="PLUGINS_RUN_LAST",t[t.VIEW_WIDGET_DETAILS=664]="VIEW_WIDGET_DETAILS",t[t.OPEN_BROWSE_ALL_RESOURCES_MODAL=665]="OPEN_BROWSE_ALL_RESOURCES_MODAL",t[t.ENTER_DRAW_MODE=666]="ENTER_DRAW_MODE",t[t.ENTER_INSPECT_MODE=667]="ENTER_INSPECT_MODE",t[t.ENTER_DESIGN_MODE=668]="ENTER_DESIGN_MODE",t[t.ENTER_SLIDES_MODE=669]="ENTER_SLIDES_MODE",t[t.ENTER_SLIDES_DESIGN_MODE=670]="ENTER_SLIDES_DESIGN_MODE",t[t.SHOW_DESIGN_PANEL=671]="SHOW_DESIGN_PANEL",t[t.SHOW_PROTOTYPE_PANEL=672]="SHOW_PROTOTYPE_PANEL",t[t.SHOW_DEV_MODE_INSPECT_PANEL=673]="SHOW_DEV_MODE_INSPECT_PANEL",t[t.SHOW_DEV_MODE_PLUGINS_PANEL=674]="SHOW_DEV_MODE_PLUGINS_PANEL",t[t.TOGGLE_PROTOTYPING_INFO=675]="TOGGLE_PROTOTYPING_INFO",t[t.TOGGLE_ANIMATE_INFO=676]="TOGGLE_ANIMATE_INFO",t[t.ENTER_FOCUS_VIEW=677]="ENTER_FOCUS_VIEW",t[t.EXIT_FOCUS_VIEW=678]="EXIT_FOCUS_VIEW",t[t.TOGGLE_GRID_FOCUS_VIEW=679]="TOGGLE_GRID_FOCUS_VIEW",t[t.SHOW_CODE_PANEL=680]="SHOW_CODE_PANEL",t[t.DEBUG_SELECTION=681]="DEBUG_SELECTION",t[t.DOWNLOAD_WEBGL_TRACE=682]="DOWNLOAD_WEBGL_TRACE",t[t.EXPORT_ALL_FRAMES_TO_PDF=683]="EXPORT_ALL_FRAMES_TO_PDF",t[t.EXPORT_SLIDES_TO_PDF=684]="EXPORT_SLIDES_TO_PDF",t[t.PRINT_IMAGE_DIAGNOSTICS=685]="PRINT_IMAGE_DIAGNOSTICS",t[t.PRINT_RENDER_TREE=686]="PRINT_RENDER_TREE",t[t.ADD_TABLE_ROW_ABOVE=687]="ADD_TABLE_ROW_ABOVE",t[t.ADD_TABLE_ROW_BELOW=688]="ADD_TABLE_ROW_BELOW",t[t.MOVE_TABLE_ROW_UP=689]="MOVE_TABLE_ROW_UP",t[t.MOVE_TABLE_ROW_DOWN=690]="MOVE_TABLE_ROW_DOWN",t[t.ADD_TABLE_COLUMN_BEFORE=691]="ADD_TABLE_COLUMN_BEFORE",t[t.ADD_TABLE_COLUMN_AFTER=692]="ADD_TABLE_COLUMN_AFTER",t[t.MOVE_TABLE_COLUMN_LEFT=693]="MOVE_TABLE_COLUMN_LEFT",t[t.MOVE_TABLE_COLUMN_RIGHT=694]="MOVE_TABLE_COLUMN_RIGHT",t[t.DELETE_TABLE_CONTENTS=695]="DELETE_TABLE_CONTENTS",t[t.DELETE_CURRENT_TABLE_COLUMN=696]="DELETE_CURRENT_TABLE_COLUMN",t[t.DELETE_CURRENT_TABLE_ROW=697]="DELETE_CURRENT_TABLE_ROW",t[t.ADD_DEFAULT_CELL_STYLES_TO_TABLES=698]="ADD_DEFAULT_CELL_STYLES_TO_TABLES",t[t.SELECT_CURRENT_TABLE_ROW=699]="SELECT_CURRENT_TABLE_ROW",t[t.SELECT_CURRENT_TABLE_COLUMN=700]="SELECT_CURRENT_TABLE_COLUMN",t[t.SELECT_CURRENT_TABLE_CELL=701]="SELECT_CURRENT_TABLE_CELL",t[t.MOVE_TABLE_CELL_SELECTION_LEFT=702]="MOVE_TABLE_CELL_SELECTION_LEFT",t[t.MOVE_TABLE_CELL_SELECTION_RIGHT=703]="MOVE_TABLE_CELL_SELECTION_RIGHT",t[t.MOVE_TABLE_CELL_SELECTION_UP=704]="MOVE_TABLE_CELL_SELECTION_UP",t[t.MOVE_TABLE_CELL_SELECTION_DOWN=705]="MOVE_TABLE_CELL_SELECTION_DOWN",t[t.EXTEND_TABLE_CELL_SELECTION_LEFT=706]="EXTEND_TABLE_CELL_SELECTION_LEFT",t[t.EXTEND_TABLE_CELL_SELECTION_RIGHT=707]="EXTEND_TABLE_CELL_SELECTION_RIGHT",t[t.EXTEND_TABLE_CELL_SELECTION_UP=708]="EXTEND_TABLE_CELL_SELECTION_UP",t[t.EXTEND_TABLE_CELL_SELECTION_DOWN=709]="EXTEND_TABLE_CELL_SELECTION_DOWN",t[t.RESIZE_TABLE_ROW_INCREASE=710]="RESIZE_TABLE_ROW_INCREASE",t[t.RESIZE_TABLE_ROW_DECREASE=711]="RESIZE_TABLE_ROW_DECREASE",t[t.RESIZE_TABLE_ROW_INCREASE_LARGE=712]="RESIZE_TABLE_ROW_INCREASE_LARGE",t[t.RESIZE_TABLE_ROW_DECREASE_LARGE=713]="RESIZE_TABLE_ROW_DECREASE_LARGE",t[t.RESIZE_TABLE_COLUMN_INCREASE=714]="RESIZE_TABLE_COLUMN_INCREASE",t[t.RESIZE_TABLE_COLUMN_DECREASE=715]="RESIZE_TABLE_COLUMN_DECREASE",t[t.RESIZE_TABLE_COLUMN_INCREASE_LARGE=716]="RESIZE_TABLE_COLUMN_INCREASE_LARGE",t[t.RESIZE_TABLE_COLUMN_DECREASE_LARGE=717]="RESIZE_TABLE_COLUMN_DECREASE_LARGE",t[t.TEST_ACTION=718]="TEST_ACTION",t[t.DEBUG_TOGGLE_WHITEBOARD_MODE=719]="DEBUG_TOGGLE_WHITEBOARD_MODE",t[t.DEBUG_TOGGLE_SLIDES_MODE=720]="DEBUG_TOGGLE_SLIDES_MODE",t[t.DEBUG_SET_SLIDES_GRID_MODE=721]="DEBUG_SET_SLIDES_GRID_MODE",t[t.DEBUG_TOGGLE_SITES_MODE=722]="DEBUG_TOGGLE_SITES_MODE",t[t.DEBUG_TOGGLE_FIGMAKE_MODE=723]="DEBUG_TOGGLE_FIGMAKE_MODE",t[t.DEBUG_LOG_CANVAS_SEARCH_INDEX=724]="DEBUG_LOG_CANVAS_SEARCH_INDEX",t[t.SET_IMAGE_AS_PROFILE_PICTURE=725]="SET_IMAGE_AS_PROFILE_PICTURE",t[t.TOGGLE_STRAIGHT_PENCIL=726]="TOGGLE_STRAIGHT_PENCIL",t[t.PRESENT_AS_PROTOTYPE=727]="PRESENT_AS_PROTOTYPE",t[t.PRESENT_SITES_FULL_PREVIEW=728]="PRESENT_SITES_FULL_PREVIEW",t[t.PRESENT_SLIDES_AUDIENCE_VIEW=729]="PRESENT_SLIDES_AUDIENCE_VIEW",t[t.PRESENT_SLIDES_PRESENTER_VIEW=730]="PRESENT_SLIDES_PRESENTER_VIEW",t[t.TOGGLE_BUZZ_TOOL_MODE=731]="TOGGLE_BUZZ_TOOL_MODE",t[t.ENTER_BUZZ_DESIGN_MODE=732]="ENTER_BUZZ_DESIGN_MODE",t[t.BUZZ_MAKE_BRAND_TEMPLATES=733]="BUZZ_MAKE_BRAND_TEMPLATES",t[t.ASSIGN_DOCUMENT_COLOR_PROFILE_LEGACY=734]="ASSIGN_DOCUMENT_COLOR_PROFILE_LEGACY",t[t.ASSIGN_DOCUMENT_COLOR_PROFILE_DISPLAY_P3=735]="ASSIGN_DOCUMENT_COLOR_PROFILE_DISPLAY_P3",t[t.CONVERT_DOCUMENT_COLOR_PROFILE_DISPLAY_P3=736]="CONVERT_DOCUMENT_COLOR_PROFILE_DISPLAY_P3",t[t.ASSIGN_DOCUMENT_COLOR_PROFILE_SRGB=737]="ASSIGN_DOCUMENT_COLOR_PROFILE_SRGB",t[t.CONVERT_DOCUMENT_COLOR_PROFILE_SRGB=738]="CONVERT_DOCUMENT_COLOR_PROFILE_SRGB",t[t.CHANGE_DOCUMENT_COLOR_PROFILE_TO_DISPLAY_P3=739]="CHANGE_DOCUMENT_COLOR_PROFILE_TO_DISPLAY_P3",t[t.CHANGE_DOCUMENT_COLOR_PROFILE_TO_SRGB=740]="CHANGE_DOCUMENT_COLOR_PROFILE_TO_SRGB",t[t.TOGGLE_OVERLAY_UI_RENDERING=741]="TOGGLE_OVERLAY_UI_RENDERING",t[t.TOGGLE_ALLOW_TIME_SLICED_EDIT_RENDERING_OPTIMIZATION=742]="TOGGLE_ALLOW_TIME_SLICED_EDIT_RENDERING_OPTIMIZATION",t[t.TOGGLE_SYNC_CURSOR_RENDERING=743]="TOGGLE_SYNC_CURSOR_RENDERING",t[t.SIMPLIFY_SELECTED_INSTANCE_PANELS=744]="SIMPLIFY_SELECTED_INSTANCE_PANELS",t[t.TOGGLE_SIMILAR_DEFINITION=745]="TOGGLE_SIMILAR_DEFINITION",t[t.TOGGLE_SIMILAR_HIGHLIGHTS=746]="TOGGLE_SIMILAR_HIGHLIGHTS",t[t.TOGGLE_NOODLES_WITHOUT_DRAGGING=747]="TOGGLE_NOODLES_WITHOUT_DRAGGING",t[t.DEBUG_MAGIC_LINK_AI_MODEL=748]="DEBUG_MAGIC_LINK_AI_MODEL",t[t.SHOW_PROTOTYPE_INTERACTION_EDIT_MODAL=749]="SHOW_PROTOTYPE_INTERACTION_EDIT_MODAL",t[t.REPORT_NO_VIDEO_UPLOAD_PERMISSIONS=750]="REPORT_NO_VIDEO_UPLOAD_PERMISSIONS",t[t.TOGGLE_DISPLAY_DIRTY_RECTS=751]="TOGGLE_DISPLAY_DIRTY_RECTS",t[t.TOGGLE_DISPLAY_DIRTY_TILES=752]="TOGGLE_DISPLAY_DIRTY_TILES",t[t.TOGGLE_DISPLAY_PIXEL_HEAT_MAP=753]="TOGGLE_DISPLAY_PIXEL_HEAT_MAP",t[t.TOGGLE_DISPLAY_EXPENSIVE_TILES=754]="TOGGLE_DISPLAY_EXPENSIVE_TILES",t[t.TOGGLE_DISPLAY_GPU_METRICS=755]="TOGGLE_DISPLAY_GPU_METRICS",t[t.TOGGLE_DISPLAY_CPU_TIMER_TREE=756]="TOGGLE_DISPLAY_CPU_TIMER_TREE",t[t.TOGGLE_PERF_MODE_MEDIUM=757]="TOGGLE_PERF_MODE_MEDIUM",t[t.SET_PROTOTYPE_VIEW_PRESENT=758]="SET_PROTOTYPE_VIEW_PRESENT",t[t.SET_PROTOTYPE_VIEW_PREVIEW=759]="SET_PROTOTYPE_VIEW_PREVIEW",t[t.SET_SITES_FULL_PREVIEW=760]="SET_SITES_FULL_PREVIEW",t[t.SET_SITES_INLINE_PREVIEW=761]="SET_SITES_INLINE_PREVIEW",t[t.SET_SLIDES_AUDIENCE_VIEW=762]="SET_SLIDES_AUDIENCE_VIEW",t[t.SET_SLIDES_PRESENTER_VIEW=763]="SET_SLIDES_PRESENTER_VIEW",t[t.DEBUG_TOGGLE_DIAGRAM_LAYOUT_PAUSED=764]="DEBUG_TOGGLE_DIAGRAM_LAYOUT_PAUSED",t[t.START_MIND_MAP=765]="START_MIND_MAP",t[t.REMOVE_IMAGE_BACKGROUND=766]="REMOVE_IMAGE_BACKGROUND",t[t.UPSCALE_IMAGE=767]="UPSCALE_IMAGE",t[t.EXPAND_IMAGE=768]="EXPAND_IMAGE",t[t.REMOVE_OBJECT=769]="REMOVE_OBJECT",t[t.GENERATE_IMAGE=770]="GENERATE_IMAGE",t[t.EDIT_IMAGE=771]="EDIT_IMAGE",t[t.MAKE_VIDEO=772]="MAKE_VIDEO",t[t.AUTO_RENAME_LAYERS=773]="AUTO_RENAME_LAYERS",t[t.MAGIC_LINK=774]="MAGIC_LINK",t[t.FIRST_DRAFT=775]="FIRST_DRAFT",t[t.FIRST_DRAFT_MAKE_CHANGES=776]="FIRST_DRAFT_MAKE_CHANGES",t[t.FIRST_DRAFT_MAKE_KIT=777]="FIRST_DRAFT_MAKE_KIT",t[t.FIRST_DRAFT_MAKE_KIT_DEBUG=778]="FIRST_DRAFT_MAKE_KIT_DEBUG",t[t.FIRST_DRAFT_COMPONENTIZE=779]="FIRST_DRAFT_COMPONENTIZE",t[t.FIRST_DRAFT_SUGGEST_PROPS=780]="FIRST_DRAFT_SUGGEST_PROPS",t[t.FIRST_DRAFT_LINTING=781]="FIRST_DRAFT_LINTING",t[t.FIRST_DRAFT_DEBUG=782]="FIRST_DRAFT_DEBUG",t[t.MAKE_EDITS=783]="MAKE_EDITS",t[t.MAKE_EDITS_DEBUG=784]="MAKE_EDITS_DEBUG",t[t.MAKE_EDITS_DEBUG_REVIEW=785]="MAKE_EDITS_DEBUG_REVIEW",t[t.FIRST_DRAFT_FINE_TUNE=786]="FIRST_DRAFT_FINE_TUNE",t[t.LINK_TO_COMPONENT=787]="LINK_TO_COMPONENT",t[t.LINK_TO_EXISTING_COMPONENT=788]="LINK_TO_EXISTING_COMPONENT",t[t.DETECT_VIOLATIONS=789]="DETECT_VIOLATIONS",t[t.TRANSLATE_TEXT=790]="TRANSLATE_TEXT",t[t.REWRITE_TEXT=791]="REWRITE_TEXT",t[t.SHORTEN_TEXT=792]="SHORTEN_TEXT",t[t.CONTENT_FILL=793]="CONTENT_FILL",t[t.SLIDES_GENERATE_SPEAKER_NOTES=794]="SLIDES_GENERATE_SPEAKER_NOTES",t[t.SLIDES_REWRITE_TEXT=795]="SLIDES_REWRITE_TEXT",t[t.DEBUG_TOGGLE_SHOW_CANVAS_AXIS=796]="DEBUG_TOGGLE_SHOW_CANVAS_AXIS",t[t.DEBUG_TOGGLE_SHOW_MOUSE_POSITION=797]="DEBUG_TOGGLE_SHOW_MOUSE_POSITION",t[t.DEBUG_TOGGLE_WHITEBOARD_PDF_IMPORT_NODE_REPLACEMENT=798]="DEBUG_TOGGLE_WHITEBOARD_PDF_IMPORT_NODE_REPLACEMENT",t[t.TOGGLE_CANVAS_SEARCH_DEBUG=799]="TOGGLE_CANVAS_SEARCH_DEBUG",t[t.TOGGLE_ACCESSIBILITY_DOM_DEBUG=800]="TOGGLE_ACCESSIBILITY_DOM_DEBUG",t[t.TOGGLE_TEXT_INPUT_SHORTCUT_BLOCKING=801]="TOGGLE_TEXT_INPUT_SHORTCUT_BLOCKING",t[t.OPEN_FPL_DEBUG=802]="OPEN_FPL_DEBUG",t[t.TOGGLE_SHOW_FIGMASCOPE=803]="TOGGLE_SHOW_FIGMASCOPE",t[t.PRINT_AS_TEST_CODE=804]="PRINT_AS_TEST_CODE",t[t.TOGGLE_UNDO_REDO_DEBUG=805]="TOGGLE_UNDO_REDO_DEBUG",t[t.TOGGLE_COLLABORATIVE_TEXT_DEBUG=806]="TOGGLE_COLLABORATIVE_TEXT_DEBUG",t[t.TOGGLE_PLUGIN_API_DEBUG=807]="TOGGLE_PLUGIN_API_DEBUG",t[t.FOCUS_PREVIOUS_AREA=808]="FOCUS_PREVIOUS_AREA",t[t.FOCUS_NEXT_AREA=809]="FOCUS_NEXT_AREA",t[t.CREATE_MAKE_FROM_DESIGN=810]="CREATE_MAKE_FROM_DESIGN",t[t.EDIT_MAKE_FROM_DESIGN=811]="EDIT_MAKE_FROM_DESIGN",t[t.SEND_TO_MAKE_FROM_DESIGN=812]="SEND_TO_MAKE_FROM_DESIGN",t[t.SEND_TO_MAKE_FROM_FIGJAM=813]="SEND_TO_MAKE_FROM_FIGJAM",t[t.COPY_MAKE_FOR_DESIGN=814]="COPY_MAKE_FOR_DESIGN",t[t.SET_AS_SITE_HOMEPAGE=815]="SET_AS_SITE_HOMEPAGE",t[t.SET_AS_DEFAULT_RESPONSIVE_SET=816]="SET_AS_DEFAULT_RESPONSIVE_SET",t[t.SITES_COPY_LINK=817]="SITES_COPY_LINK",t[t.SITES_FIX_ISSUE=818]="SITES_FIX_ISSUE",t[t.EDIT_CODE=819]="EDIT_CODE",t[t.CREATE_CODE_LAYER_FROM_DESIGN=820]="CREATE_CODE_LAYER_FROM_DESIGN",t[t.CREATE_NATIVE_CODE_LAYER=821]="CREATE_NATIVE_CODE_LAYER",t[t.BULK_EXPORT_DESIGN_TO_REACT=822]="BULK_EXPORT_DESIGN_TO_REACT",t[t.RESTORE_DESIGN_IN_PLACE_FROM_CODE=823]="RESTORE_DESIGN_IN_PLACE_FROM_CODE",t[t.COPY_OUT_DESIGN_FROM_CODE=824]="COPY_OUT_DESIGN_FROM_CODE",t[t.SET_SITES_VIEW_FILE=825]="SET_SITES_VIEW_FILE",t[t.SET_SITES_VIEW_CODE=826]="SET_SITES_VIEW_CODE",t[t.SET_SITES_VIEW_CMS=827]="SET_SITES_VIEW_CMS",t[t.SET_SITES_INSERTS_OVERLAY=828]="SET_SITES_INSERTS_OVERLAY",t[t.GO_TO_REPEATER_COMPONENT=829]="GO_TO_REPEATER_COMPONENT",t[t.CREATE_CMS_RICH_TEXT=830]="CREATE_CMS_RICH_TEXT",t[t.DETACH_CMS_RICH_TEXT=831]="DETACH_CMS_RICH_TEXT",t[t.UNBIND_SELECTION=832]="UNBIND_SELECTION",t[t.FOCUS_NEXT_SLIDE=833]="FOCUS_NEXT_SLIDE",t[t.FOCUS_PREVIOUS_SLIDE=834]="FOCUS_PREVIOUS_SLIDE",t[t.FOCUS_SLIDE_UP=835]="FOCUS_SLIDE_UP",t[t.FOCUS_SLIDE_DOWN=836]="FOCUS_SLIDE_DOWN",t[t.SKIP_SLIDE=837]="SKIP_SLIDE",t[t.UNSKIP_SLIDE=838]="UNSKIP_SLIDE",t[t.SKIP_SLIDES=839]="SKIP_SLIDES",t[t.UNSKIP_SLIDES=840]="UNSKIP_SLIDES",t[t.ADD_SLIDE_OBJECT_ANIMATION=841]="ADD_SLIDE_OBJECT_ANIMATION",t[t.INSERT_SLIDE_NUMBERS_ALL_SLIDES=842]="INSERT_SLIDE_NUMBERS_ALL_SLIDES",t[t.FOCUS_NEXT_ASSET=843]="FOCUS_NEXT_ASSET",t[t.FOCUS_PREVIOUS_ASSET=844]="FOCUS_PREVIOUS_ASSET",t[t.SEND_TO_BUZZ_FROM_DESIGN=845]="SEND_TO_BUZZ_FROM_DESIGN",t[t.SEND_SELECTION_TO_BUZZ_FROM_DESIGN=846]="SEND_SELECTION_TO_BUZZ_FROM_DESIGN",t[t.PASTE_SELECTION_INTO_BUZZ_FROM_DESIGN=847]="PASTE_SELECTION_INTO_BUZZ_FROM_DESIGN",t[t.ADD_PLATFORM_SHAPE_DEFINITION=848]="ADD_PLATFORM_SHAPE_DEFINITION",t[t.REMOVE_PLATFORM_SHAPE_DEFINITION=849]="REMOVE_PLATFORM_SHAPE_DEFINITION",t[t.OPEN_SHAPES_SIDEBAR=850]="OPEN_SHAPES_SIDEBAR",t[t.WHITEBOARD_GENERATE_CONTENT=851]="WHITEBOARD_GENERATE_CONTENT",t[t.SUMMARIZE_STICKIES=852]="SUMMARIZE_STICKIES",t[t.SORT_STICKIES_BY_TOPIC=853]="SORT_STICKIES_BY_TOPIC",t[t.SORT_STICKIES_BY_COLOR=854]="SORT_STICKIES_BY_COLOR",t[t.SORT_STICKIES_BY_AUTHOR=855]="SORT_STICKIES_BY_AUTHOR",t[t.SORT_STICKIES_BY_STAMP_COUNT=856]="SORT_STICKIES_BY_STAMP_COUNT",t[t.SORT_STICKIES_BY_STAMP_TYPE=857]="SORT_STICKIES_BY_STAMP_TYPE",t[t.MIND_MAP_GENERATE_IDEAS=858]="MIND_MAP_GENERATE_IDEAS",t[t.CREATE_IDEAS=859]="CREATE_IDEAS",t[t.MERMAID_TO_DIAGRAM=860]="MERMAID_TO_DIAGRAM",t[t.ASSISTANT_CHAT=861]="ASSISTANT_CHAT",t[t.COPY_TO_FIGMA_SLIDES=862]="COPY_TO_FIGMA_SLIDES",t[t.IMAGE_TO_DESIGN=863]="IMAGE_TO_DESIGN",t[t.IMAGE_TO_DESIGN_ORACLE=864]="IMAGE_TO_DESIGN_ORACLE",t[t.SET_CONSTRAINTS_AUTOMATICALLY=865]="SET_CONSTRAINTS_AUTOMATICALLY",t[t.SET_CONSTRAINTS_MANUALLY=866]="SET_CONSTRAINTS_MANUALLY",t[t.SET_CONSTRAINTS_AUTOMATICALLY_TOGGLE=867]="SET_CONSTRAINTS_AUTOMATICALLY_TOGGLE",t[t.TOGGLE_SMART_TEXT_SUBSTITUTION=868]="TOGGLE_SMART_TEXT_SUBSTITUTION",t[t.EXPORT_SLIDES_TO=869]="EXPORT_SLIDES_TO",t[t.ENTER_STAGING_MODE=870]="ENTER_STAGING_MODE",t[t.COMMIT_STAGED_CHANGES=871]="COMMIT_STAGED_CHANGES",t[t.ROLLBACK_STAGED_CHANGES=872]="ROLLBACK_STAGED_CHANGES"})(Xy||(Xy={}));var Vn;(function(t){t[t.NONE=0]="NONE",t[t.ODD_WINDING_NUMBER_COMPUTE=1]="ODD_WINDING_NUMBER_COMPUTE",t[t.NONZERO_WINDING_NUMBER_COMPUTE=2]="NONZERO_WINDING_NUMBER_COMPUTE",t[t.ODD_WINDING_NUMBER=3]="ODD_WINDING_NUMBER",t[t.ODD_WINDING_NUMBER_CLEAR=4]="ODD_WINDING_NUMBER_CLEAR",t[t.NONZERO_WINDING_NUMBER=5]="NONZERO_WINDING_NUMBER",t[t.NONZERO_WINDING_NUMBER_CLEAR=6]="NONZERO_WINDING_NUMBER_CLEAR",t[t.ODD_WINDING_NUMBER_FILL=7]="ODD_WINDING_NUMBER_FILL",t[t.NONZERO_WINDING_NUMBER_FILL=8]="NONZERO_WINDING_NUMBER_FILL",t[t.ODD_WINDING_NUMBER_STROKE=9]="ODD_WINDING_NUMBER_STROKE",t[t.NONZERO_WINDING_NUMBER_STROKE=10]="NONZERO_WINDING_NUMBER_STROKE",t[t.STROKE_INSIDE=11]="STROKE_INSIDE",t[t.STROKE_OUTSIDE=12]="STROKE_OUTSIDE",t[t.STROKE_CLEAR=13]="STROKE_CLEAR",t[t.OVERLAY_UI_COMPUTE_WINDING_NUMBER_ODD=14]="OVERLAY_UI_COMPUTE_WINDING_NUMBER_ODD",t[t.OVERLAY_UI_COMPUTE_WINDING_NUMBER_NONZERO=15]="OVERLAY_UI_COMPUTE_WINDING_NUMBER_NONZERO",t[t.OVERLAY_UI_COVER_ODD=16]="OVERLAY_UI_COVER_ODD",t[t.OVERLAY_UI_COVER_NONZERO=17]="OVERLAY_UI_COVER_NONZERO",t[t.OVERLAY_UI_COVER_EVEN=18]="OVERLAY_UI_COVER_EVEN",t[t.OVERLAY_UI_COVER_ZERO=19]="OVERLAY_UI_COVER_ZERO"})(Vn||(Vn={}));var Ar;(function(t){t[t.ALL=0]="ALL",t[t.COLOR=1]="COLOR",t[t.DEPTH_STENCIL=2]="DEPTH_STENCIL"})(Ar||(Ar={}));var ze;(function(t){t[t.TRIANGLES=0]="TRIANGLES",t[t.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"})(ze||(ze={}));var va;(function(t){t[t.COPY=0]="COPY",t[t.KEEP=1]="KEEP",t[t.PREMULTIPLIED=2]="PREMULTIPLIED",t[t.PREMULTIPLIED_SRC_UNDER_TARGET=3]="PREMULTIPLIED_SRC_UNDER_TARGET",t[t.SCREEN=4]="SCREEN",t[t.LINEAR_DODGE=5]="LINEAR_DODGE",t[t.INTERPOLATE=6]="INTERPOLATE",t[t.UNPREMULTIPLIED=7]="UNPREMULTIPLIED"})(va||(va={}));var jy;(function(t){t[t.REQUEST_DEVICE_FAILURE=0]="REQUEST_DEVICE_FAILURE",t[t.WEBGPU_ERROR=1]="WEBGPU_ERROR",t[t.WEBGPU_OOM=2]="WEBGPU_OOM",t[t.JS_ERROR=3]="JS_ERROR",t[t.COMPATIBILITY_TEST_FAILURE=4]="COMPATIBILITY_TEST_FAILURE",t[t.DEBUGGING_HELPERS=5]="DEBUGGING_HELPERS"})(jy||(jy={}));var sl;(function(t){t[t.RGBA8=0]="RGBA8",t[t.RG32F=1]="RG32F",t[t.RGB32F=2]="RGB32F",t[t.RGBA32F=3]="RGBA32F",t[t.ASTC_6x6=4]="ASTC_6x6",t[t.BC3=5]="BC3",t[t.BGRA8=6]="BGRA8",t[t.DEPTH24_STENCIL8=7]="DEPTH24_STENCIL8",t[t.STENCIL8=8]="STENCIL8"})(sl||(sl={}));var Zy;(function(t){t[t.Unknown=0]="Unknown",t[t.Validation=1]="Validation",t[t.OutOfMemory=2]="OutOfMemory",t[t.Internal=3]="Internal"})(Zy||(Zy={}));var yt;(function(t){t[t.AAAShapeSolidColorPaint=0]="AAAShapeSolidColorPaint",t[t.AAAShapeGradientPaint=1]="AAAShapeGradientPaint",t[t.AAAShapeLerpGradientPaint=2]="AAAShapeLerpGradientPaint",t[t.AAAShapeImagePaint=3]="AAAShapeImagePaint",t[t.AAAShapeImageColorAdjustPaint=4]="AAAShapeImageColorAdjustPaint",t[t.AAAShapeLerpImagePaintEllipse=5]="AAAShapeLerpImagePaintEllipse",t[t.AAAShapeLerpImagePaintRoundedRect=6]="AAAShapeLerpImagePaintRoundedRect",t[t.AAAShapeLerpImageColorAdjustPaintEllipse=7]="AAAShapeLerpImageColorAdjustPaintEllipse",t[t.AAAShapeLerpImageColorAdjustPaintRoundedRect=8]="AAAShapeLerpImageColorAdjustPaintRoundedRect",t[t.BackfillBackground=9]="BackfillBackground",t[t.BlendTexture=10]="BlendTexture",t[t.BlendTileCustom=11]="BlendTileCustom",t[t.BlendTileSimple=12]="BlendTileSimple",t[t.ClampedBlurTile=13]="ClampedBlurTile",t[t.ClampedGradientBlurTile=14]="ClampedGradientBlurTile",t[t.ClampedGradientBlurTile_UniformControlFlow=15]="ClampedGradientBlurTile_UniformControlFlow",t[t.ClampedGrain=16]="ClampedGrain",t[t.CompositeTile=17]="CompositeTile",t[t.CopyAndTintTile=18]="CopyAndTintTile",t[t.CopyTexture=19]="CopyTexture",t[t.CopyTile=20]="CopyTile",t[t.DashedLine=21]="DashedLine",t[t.DeviceFrame=22]="DeviceFrame",t[t.DownscaleTile=23]="DownscaleTile",t[t.DrawTexture=24]="DrawTexture",t[t.Glass=25]="Glass",t[t.GlassNonUniformCornerRadii=26]="GlassNonUniformCornerRadii",t[t.GradientPaint=27]="GradientPaint",t[t.HardMaskTileWithColor=28]="HardMaskTileWithColor",t[t.HardMaskWithColorAndDownscaleTile=29]="HardMaskWithColorAndDownscaleTile",t[t.Hotspot=30]="Hotspot",t[t.ImageBicubicSampler=31]="ImageBicubicSampler",t[t.ImageColorAdjustBicubicSampler=32]="ImageColorAdjustBicubicSampler",t[t.ImageColorAdjustPaint=33]="ImageColorAdjustPaint",t[t.ImageColorAdjustPaintViewer=34]="ImageColorAdjustPaintViewer",t[t.ImageColorAdjustPaint_UniformControlFlow=35]="ImageColorAdjustPaint_UniformControlFlow",t[t.ImagePaint=36]="ImagePaint",t[t.ImagePaintViewer=37]="ImagePaintViewer",t[t.ImagePaint_UniformControlFlow=38]="ImagePaint_UniformControlFlow",t[t.ImagePaintPattern=39]="ImagePaintPattern",t[t.ImagePaintPatternSingle=40]="ImagePaintPatternSingle",t[t.ImageWithFilter=41]="ImageWithFilter",t[t.InverseFillRegionSolidColor=42]="InverseFillRegionSolidColor",t[t.LayoutGrid=43]="LayoutGrid",t[t.LerpGradientPaint=44]="LerpGradientPaint",t[t.LerpImage=45]="LerpImage",t[t.LerpImageColorAdjust=46]="LerpImageColorAdjust",t[t.LerpTexture=47]="LerpTexture",t[t.LoopBlinn=48]="LoopBlinn",t[t.LoopBlinnInstanced=49]="LoopBlinnInstanced",t[t.LoopBlinnGlyphsUInt=50]="LoopBlinnGlyphsUInt",t[t.LoopBlinnGlyphsUShort=51]="LoopBlinnGlyphsUShort",t[t.LoopBlinnNoDiscard=52]="LoopBlinnNoDiscard",t[t.LoopBlinnSolidPaint=53]="LoopBlinnSolidPaint",t[t.MaskBackgroundBlurTile=54]="MaskBackgroundBlurTile",t[t.MaskInnerShadowTile=55]="MaskInnerShadowTile",t[t.MaskInnerShadowTileAndFirstHardMaskAlpha=56]="MaskInnerShadowTileAndFirstHardMaskAlpha",t[t.MaskKnockoutShadowTile=57]="MaskKnockoutShadowTile",t[t.MaskKnockoutShadowTilePassThrough=58]="MaskKnockoutShadowTilePassThrough",t[t.MaskTile=59]="MaskTile",t[t.MaskTileLuminance=60]="MaskTileLuminance",t[t.MaskTileLuminancePassThrough=61]="MaskTileLuminancePassThrough",t[t.MaskTilePassThrough=62]="MaskTilePassThrough",t[t.NineGridStretchCenter=63]="NineGridStretchCenter",t[t.Noise=64]="Noise",t[t.NoisePaint=65]="NoisePaint",t[t.PixelHeatmap=66]="PixelHeatmap",t[t.RectangleBlur=67]="RectangleBlur",t[t.RectangleInnerShadow=68]="RectangleInnerShadow",t[t.RenderEllipticalTexture=69]="RenderEllipticalTexture",t[t.RoundedRectangleBlur=70]="RoundedRectangleBlur",t[t.RoundedRectangleInnerShadow=71]="RoundedRectangleInnerShadow",t[t.ShadedRegion=72]="ShadedRegion",t[t.SmoothPath=73]="SmoothPath",t[t.SmoothPathShimmer=74]="SmoothPathShimmer",t[t.SolidColorPaint=75]="SolidColorPaint",t[t.SolidColorPaintLoopBlinn=76]="SolidColorPaintLoopBlinn",t[t.SquiggleLine=77]="SquiggleLine",t[t.SuperSSAA4x4Downsample=78]="SuperSSAA4x4Downsample",t[t.TextAlpha=79]="TextAlpha",t[t.TintTexture=80]="TintTexture",t[t.TintTextureColorAdjust=81]="TintTextureColorAdjust",t[t.UnclampedBlurTile=82]="UnclampedBlurTile",t[t.UnclampedGradientBlurTile=83]="UnclampedGradientBlurTile",t[t.UnclampedGradientBlurTile_UniformControlFlow=84]="UnclampedGradientBlurTile_UniformControlFlow",t[t.UnclampedGrain=85]="UnclampedGrain",t[t.UpscaleAndBlendGradientBlurTile=86]="UpscaleAndBlendGradientBlurTile",t[t.UpscaleAndBlendGradientBlurTile_UniformControlFlow=87]="UpscaleAndBlendGradientBlurTile_UniformControlFlow",t[t.UpscaleTile=88]="UpscaleTile"})(yt||(yt={}));var Jy;(function(t){t[t.HASHES_ONLY=0]="HASHES_ONLY",t[t.HASHES_AND_DATA=1]="HASHES_AND_DATA"})(Jy||(Jy={}));var ll;(function(t){t[t.ALLOWED=0]="ALLOWED",t[t.DISALLOWED_CYCLE=1]="DISALLOWED_CYCLE",t[t.DISALLOWED_OTHER=2]="DISALLOWED_OTHER"})(ll||(ll={}));var cl;(function(t){t[t.MATERIALIZE_SWAPPED_OUT_TREE=0]="MATERIALIZE_SWAPPED_OUT_TREE",t[t.SKIP_MATERIALIZATION=1]="SKIP_MATERIALIZATION"})(cl||(cl={}));var On;(function(t){t[t.PENDING_INITIAL_LOAD=0]="PENDING_INITIAL_LOAD",t[t.PENDING_LOAD_AFTER_RECONNECT=1]="PENDING_LOAD_AFTER_RECONNECT",t[t.LOADED=2]="LOADED"})(On||(On={}));var $y;(function(t){t[t.NONE=0]="NONE",t[t.CONTAIN=1]="CONTAIN",t[t.SCALE_DOWN=2]="SCALE_DOWN",t[t.MIN_ZOOM=3]="MIN_ZOOM",t[t.FREE=4]="FREE",t[t.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",t[t.FIT_WIDTH=6]="FIT_WIDTH",t[t.RESPONSIVE=7]="RESPONSIVE"})($y||($y={}));var eb;(function(t){t[t.FIXED=0]="FIXED",t[t.RESPONSIVE=1]="RESPONSIVE"})(eb||(eb={}));var tb;(function(t){t[t.MISSING_FONTS_ONLY=0]="MISSING_FONTS_ONLY",t[t.MISSING_OR_LOCAL_FONTS=1]="MISSING_OR_LOCAL_FONTS"})(tb||(tb={}));var dl;(function(t){t[t.CppUniquePath=0]="CppUniquePath",t[t.RoundedRectPath=1]="RoundedRectPath",t[t.EllipsePath=2]="EllipsePath",t[t.BezierPathSerialized=3]="BezierPathSerialized"})(dl||(dl={}));var cn;(function(t){t[t.METADATA=0]="METADATA",t[t.GROUP=1]="GROUP",t[t.FILL=2]="FILL",t[t.FILL_STROKE=3]="FILL_STROKE",t[t.FILL_GLYPHS=4]="FILL_GLYPHS",t[t.MASK=5]="MASK",t[t.BLUR=6]="BLUR",t[t.BLEND=7]="BLEND",t[t.COMPOSITE_TILE=8]="COMPOSITE_TILE",t[t.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",t[t.STATIC_TRANSFORM_BINDING=10]="STATIC_TRANSFORM_BINDING",t[t.GRAIN=11]="GRAIN",t[t.NOISE=12]="NOISE",t[t.SCATTER_BRUSH_FILL=13]="SCATTER_BRUSH_FILL",t[t.GLASS=14]="GLASS",t[t.VOLATILE_PROPERTY_BINDING=15]="VOLATILE_PROPERTY_BINDING",t[t.VOLATILE_RENDER_EFFECT=16]="VOLATILE_RENDER_EFFECT",t[t.DISSOLVE=17]="DISSOLVE",t[t.COMPOSITE_TILE_GRID=18]="COMPOSITE_TILE_GRID",t[t.SUPERSAMPLE_GROUP=19]="SUPERSAMPLE_GROUP"})(cn||(cn={}));var gd;(function(t){t[t.INSIDE=0]="INSIDE",t[t.OUTSIDE=1]="OUTSIDE"})(gd||(gd={}));var ys;(function(t){t[t.NORMAL=0]="NORMAL",t[t.LUMINANCE=1]="LUMINANCE",t[t.INNER_SHADOW=2]="INNER_SHADOW",t[t.BACKGROUND_BLUR=3]="BACKGROUND_BLUR",t[t.KNOCKOUT_SHADOW=4]="KNOCKOUT_SHADOW"})(ys||(ys={}));var $r;(function(t){t[t.PASS_THROUGH=0]="PASS_THROUGH",t[t.NORMAL=1]="NORMAL",t[t.DARKEN=2]="DARKEN",t[t.MULTIPLY=3]="MULTIPLY",t[t.LINEAR_BURN=4]="LINEAR_BURN",t[t.COLOR_BURN=5]="COLOR_BURN",t[t.LIGHTEN=6]="LIGHTEN",t[t.SCREEN=7]="SCREEN",t[t.LINEAR_DODGE=8]="LINEAR_DODGE",t[t.COLOR_DODGE=9]="COLOR_DODGE",t[t.OVERLAY=10]="OVERLAY",t[t.SOFT_LIGHT=11]="SOFT_LIGHT",t[t.HARD_LIGHT=12]="HARD_LIGHT",t[t.DIFFERENCE=13]="DIFFERENCE",t[t.EXCLUSION=14]="EXCLUSION",t[t.HUE=15]="HUE",t[t.SATURATION=16]="SATURATION",t[t.COLOR=17]="COLOR",t[t.LUMINOSITY=18]="LUMINOSITY"})($r||($r={}));var bs;(function(t){t[t.MULTITONE=0]="MULTITONE",t[t.MONOTONE=1]="MONOTONE",t[t.DUOTONE=2]="DUOTONE"})(bs||(bs={}));var et;(function(t){t[t.INVERSE_TRANSFORM=0]="INVERSE_TRANSFORM",t[t.TRANSFORM_ISOLATION=1]="TRANSFORM_ISOLATION",t[t.TRANSFORM=2]="TRANSFORM",t[t.MAX_TRANSFORM_SCALE=3]="MAX_TRANSFORM_SCALE",t[t.OPACITY=4]="OPACITY",t[t.STATE_SWAP=5]="STATE_SWAP",t[t.EFFECT=6]="EFFECT"})(et||(et={}));var Kr;(function(t){t[t.BLUR=0]="BLUR",t[t.GRAIN=1]="GRAIN",t[t.NOISE=2]="NOISE",t[t.GLASS=3]="GLASS"})(Kr||(Kr={}));var B1=Ja(ib());var Qt;(B=>{function t(){return B._workerURL}B.getWorkerURL=t;function e(G){B._workerURL=G}B.setWorkerURL=e;function r(){return B._imagePrefixURL}B.getImagePrefixURL=r;function n(G){B._imagePrefixURL=G}B.setImagePrefixURL=n;function o(){return B._imageBatchURL}B.getImageBatchURL=o;function i(G){B._imageBatchURL=G}B.setImageBatchURL=i;function a(){return B._compressedTexturesAvailabilityURL}B.getCompressedTexturesAvailabilityURL=a;function s(G){B._compressedTexturesAvailabilityURL=G}B.setCompressedTexturesAvailabilityURL=s;function l(){return B._videoPrefixURL}B.getVideoPrefixUrl=l;function c(G){B._videoPrefixURL=G}B.setVideoPrefixUrl=c;function d(){return B._deviceInfoByIdentifier}B.getDeviceInfoByIdentifier=d;function u(G){B._deviceInfoByIdentifier=G}B.setDeviceInfoByIdentifier=u;function p(){return B._containerElement}B.getContainerElement=p;function _(G){B._containerElement=G}B.setContainerElement=_;function h(){return B._forceMobileOptimizations}B.forceMobileOptimizations=h;function g(G){B._forceMobileOptimizations=G}B.setForceMobileOptimizations=g;function m(){return B._shouldUseCompressedTextures}B.shouldUseCompressedTextures=m;function A(G){B._shouldUseCompressedTextures=G}B.setShouldUseCompressedTextures=A;function S(G){let V=w=>{if(!(w in G))throw new Error(`Missing required parameter '${w}'`);return G[w]},D=(w,k)=>w in G?G[w]:k;B._workerURL=V("workerURL"),B._deviceInfoByIdentifier=D("deviceInfoByIdentifier",B._deviceInfoByIdentifierDefault),B._containerElement=V("containerElement"),B._forceMobileOptimizations=D("forceMobileOptimizations",!1)}B.initialize=S,B._workerURL=null,B._imagePrefixURL=null,B._imageBatchURL=null,B._videoPrefixURL=null,B._deviceInfoByIdentifierDefault=null,B._deviceInfoByIdentifier=B._deviceInfoByIdentifierDefault,B._containerElement=null,B._forceMobileOptimizations=!1,B._shouldUseCompressedTextures=!1})(Qt||(Qt={}));var jt;(m=>{let t;function e(A){t=A}m.initialize=e;function r(){return t!=null&&t.mac==!0}m.mac=r;function n(){return t!=null&&t.windows==!0}m.windows=n;function o(){return t!=null&&t.ios==!0}m.ios=o;function i(){return t!=null&&t.android==!0}m.android=i;function a(){return t!=null&&t.linux==!0}m.linux=a;function s(){return t!=null&&t.chrome==!0}m.chrome=s;function l(){return t!=null&&t.safari==!0}m.safari=l;function c(){return t!=null&&t.firefox==!0}m.firefox=c;function d(){return t!=null&&t.msedge==!0}m.edge=d;function u(){return t!=null&&t.msie==!0}m.msie=u;function p(A){return A==2||A==1}m.isMobile=p;function _(){return m.isMobile(m.current())||m.current()==4&&navigator.maxTouchPoints>0}m.isCurrentOSMobileOrIPad=_;function h(){return m.OS__current==0&&(m.OS__current=r()?4:n()?5:o()?2:i()?1:a()?3:0),m.OS__current}m.current=h,m.OS__current=0})(jt||(jt={}));var Re;(y=>{let t;(D=>(D[D.LEGACY=0]="LEGACY",D[D.LOW=100]="LOW",D[D.MEDIUM=200]="MEDIUM",D[D.HIGH=300]="HIGH",D[D.MAX=400]="MAX",D[D.DEFAULT=100]="DEFAULT"))(t=y.ProfileLevel||(y.ProfileLevel={}));function e(P,E,C,B,G,V,D,w,k){y._internalTrackAnalyticsEvent=P,y._internalDefinedAnalyticsHandler=E,y._appTimerStart=C,y._appTimerStop=B,y._nextFrame=G,y._startProfile=V,y._stopProfile=D,y._internalLoadTimeTracker=w,y._internalSocketConnectionTracker=k}y.initialize=e;function r(P){let E=y._internalTrackAnalyticsEvent;return y._internalTrackAnalyticsEvent=P,()=>{y._internalTrackAnalyticsEvent=E}}y.mockTrackEvent=r,y.trackDefinedEvent=(P,E)=>{y._internalDefinedAnalyticsHandler!==null&&y._internalDefinedAnalyticsHandler.trackDefinedEvent(P,E)},y.trackDefinedMetric=(P,E)=>{y._internalDefinedAnalyticsHandler!==null&&y._internalDefinedAnalyticsHandler.trackDefinedMetric(P,E)};function i(P,E,C){y._internalTrackAnalyticsEvent!=null&&(0,y._internalTrackAnalyticsEvent)(P,E,C)}y.trackEvent=i;function a(P,E=0){let C=!1;return y._startProfile!=null&&(C=(0,y._startProfile)(P,E)),C&&y._appTimerStart!=null&&(0,y._appTimerStart)(P,E),C}y.appTimerStart=a;function s(P,E=0){y._stopProfile!=null&&(0,y._stopProfile)(P,E),y._appTimerStop!=null&&(0,y._appTimerStop)(P,E)}y.appTimerStop=s;function l(P,E=0,C){let B=a(P,E),G=C();return B&&s(P,E),G}y.perfTimerScope=l;function c(P){y._nextFrame!=null&&(0,y._nextFrame)(P)}y.nextFrame=c;function d(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleMultiplayerOpenConnection()}y.handleMultiplayerOpenConnection=d;function u(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}y.handleMultiplayerIFLSatisfied=u;function p(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleMultiplayerFirstResponse()}y.handleMultiplayerFirstResponse=p;function _(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleIFLCompleted()}y.handleIFLCompleted=_;function h(P){y._internalSocketConnectionTracker!==null&&y._internalSocketConnectionTracker.handleSocketDisconnect(P)}y.handleMultiplayerSocketDisconnected=h;function g(P,E,C,B){y._internalSocketConnectionTracker!==null&&(P||E>3)&&y._internalSocketConnectionTracker.handleSocketConnectionAttempt(P,E,C,B)}y.handleMultiplayerSocketConnectionAttempt=g,y._internalTrackAnalyticsEvent=null,y._internalDefinedAnalyticsHandler=null,y._internalLoadTimeTracker=null,y._internalSocketConnectionTracker=null,y._appTimerStart=null,y._appTimerStop=null,y._nextFrame=null,y._startProfile=null,y._stopProfile=null})(Re||(Re={}));function xe(t){let e=typeof t=="string"?new Error(t):t;setTimeout(()=>{throw e},0)}function U2(t){let e=new Error(t);setTimeout(()=>{throw e},0)}function N1(t){U2(t)}var Nn;(a=>{function t(s){i=s}a.initialize=t;function e(s,l,c,d){i("DEBUG",s,l,c,d)}a.logd=e;function r(s,l,c,d){i("INFO",s,l,c,d)}a.logi=r;function n(s,l,c,d){i("WARN",s,l,c,d)}a.logw=n;function o(s,l,c,d){i("ERROR",s,l,c,d)}a.loge=o;let i=()=>{}})(Nn||(Nn={}));var es=null,Uo=!1,en=!1,P1=!1,Ca=!1;function F1(){en=!0}function D1(){P1=!0}function x1(){return en||P1}function Yr(){return Uo||en||Ca}var Sd=!0;var vs=null,np=null,Wh,w1=new Promise((t,e)=>{vs?t(vs):Wh=t});function ts(){return w1}function Kh(t){var e;if(vs!=null){xe("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}L1(t),np==null||np.setSerialization(t.appState().serialization()),Ca&&((e=t.modules().interactionTestHelpers)==null||e.setIsRunningViewerRenderServer())}function v(){return vs}function L1(t){vs=t,Wh&&Wh(t)}function Yh(){vs!=null&&vs.reset(),L1(null),w1=new Promise((t,e)=>{vs?t(vs):Wh=t})}function M1(t){np=t}function Qh(){return np}var U;(Y=>{function t(){return k().clip_to_shape_bounds_reduction??!1}Y.clipToShapeBoundsReducton=t;function e(){return Bt.getFeatureGate("viewer_cleanup_buffer_areas")}Y.viewerCleanupBufferAreas=e;function r(){return Bt.getFeatureGate("mirror_use_inline_preview_api")}Y.mirrorShouldUseInlinePreviewFrameLoader=r;function n(){return Bt.getFeatureGate("unaligned_axis_transform_overlap")}Y.nonAABBRenderingCheck=n;function o(){return Bt.getFeatureGate("override_disable_gpu_instancing")}Y.shouldOverrideDisableGpuInstancingSupport=o;function i(){return ke()}Y.shouldEnableVertexBufferDiscardBytesAfterUpload=i;function a(){return!ke()}Y.smartAnimateCacheTransform=a;function s(){return!ke()}Y.viewerCreateVideoTriggersOpt=s;function l(){return!ke()}Y.viewerLargeTilesDrawToScreen=l;function c(){return k().viewer_editor_renderer_unification??!1}Y.useUnifiedRenderer=c;function d(){return!ke()}Y.viewerDoubleTileCompositionLimit=d;function u(){return k().viewer_lock_prerendering_ratio??!1}Y.shouldLockPreRenderingRatio=u;function p(){return!ke()}Y.viewerScissorClear=p;function _(){return!ke()}Y.enableCreateImageBitmap=_;function h(){return k().mix_gl_downscale??!1}Y.shouldDownscaleGlassBackground=h;function g(){return k().mix_gl_corner_radii??!1}Y.useGlassNonUniformCornerRadii=g;function m(){if(Y._useWasmTileStackTile==null){let re=Bt.getFeatureGate("viewer_use_wasm_tile_stack_tile");Y._useWasmTileStackTile=new fe(re)}return Y._useWasmTileStackTile.value}Y.useWasmTileStackTile=m;function A(){if(Y._useWasmRasterizer==null){let re=Bt.getFeatureGate("viewer_use_wasm_rasterizer");Y._useWasmRasterizer=re&&Y.useWasmTileStackTile()&&Y.useUnifiedRenderer()}return Y._useWasmRasterizer}Y.useWasmRasterizer=A;function S(){return k().viewer_background_blur_opts}Y.useBackgroundBlurOpts=S;function T(){return k().viewer_fast_stroke_shadow}Y.useFastStrokeShadow=T;function R(){return k().viewer_flush_after_clear}Y.shouldFlushAfterClear=R;function b(){return k().viewer_flush_after_stencil_cover}Y.shouldFlushAfterStencilCover=b;function O(){return k().flush_after_draws}Y.shouldFlushAfterDraws=O;function f(){return ke()&&Bt.getFeatureGate("viewer_reclaim_tilestack_tiles")}Y.shouldReclaimTileStackTiles=f;function I(){return ke()}Y.shouldPreventVolatileCaching=I;function y(){return B1.WebGLVersionSupport.isWebGL2Supported()}Y.shouldUseWebGL2=y;function P(){return Ca}Y.shouldUseDesktopCompressedTextureFormat=P;function E(){return ke()||P()}Y.shouldUseCompressedTextures=E;function C(){return window.devicePixelRatio>3}Y.isHighDPR=C;function B(){return k().internal_only_debug_tools}Y.internalDebugTools=B;function G(){return Y._shouldPlayVideosLinearly}Y.shouldPlayVideosLinearly=G;function V(){return!C()}Y.useSSAA=V;function D(re){return Y._bowser.version===null||Y._bowser.version===void 0?!1:Y._bowser.compareVersions([Y._bowser.version,re])>=0}Y.isBrowserVersionAtLeast=D;function w(re){return Y._bowser.osversion===null||Y._bowser.osversion===void 0?!1:Y._bowser.compareVersions([Y._bowser.osversion,re])>=0}Y.isOSVersionAtLeast=w;function k(){return Y._featureFlags}Y.getFeatureFlags=k;function z(re){var se,oe;Y._featureFlags=re,Uo?es.featureFlagsCppApi.updateFeatureFlags(re):((oe=(se=v())==null?void 0:se.modules())==null?void 0:oe.featureFlagsCppApi)!=null&&v().modules().featureFlagsCppApi.updateFeatureFlags(re),Bt.clearFeatureGatesForTesting(),Bt.setInRenderServerForViewerTests();for(let[de,ue]of Object.entries(re))Bt.updateFeatureGateForTesting(de,ue)}Y.setFeatureFlags=z;function H(re){let se=Object.assign({},Y._featureFlags);z(Object.assign(se,re))}Y.updateFeatureFlags=H;function K(){return Y._viewerMode}Y.getViewerMode=K;function j(re){Y._viewerMode=re}Y.setViewerMode=j;function q(){return Y._scrollToPan}Y.getScrollToPan=q;function J(re){Y._scrollToPan=re}Y.setScrollToPan=J;function ie(){return Y._dragToPan}Y.getDragToPan=ie;function Ee(re){Y._dragToPan=re}Y.setDragToPan=Ee;function Ke(){return Y._disableKeyboardHandling}Y.disableKeyboardHandling=Ke;function Ve(){return Y._gameControllerListener}Y.gameControllerListener=Ve;function at(){return Y._isInlinePreview}Y.isInlinePreview=at;function Dt(){return Y._isSlidesEmbed}Y.isSlidesEmbed=Dt;function qt(re){Y.protoUseFrameEvictionForUnitTests=re}Y.setProtoUseFrameEvictionForUnitTests=qt;function zt(re){Y._shouldPlayVideosLinearly=re}Y.setShouldPlayVideosLinearly=zt;function ae(){return en?Y.protoUseFrameEvictionForUnitTests:ke()}Y.protoUseFrameEviction=ae;function nt(re){let se=ue=>{if(!(ue in re))throw new Error(`Missing required parameter '${ue}'`);return re[ue]},oe=(ue,Ne)=>ue in re?re[ue]:Ne,de=se("featureFlags");z(de),Y._viewerMode=Zt.ViewerMode_create(se("viewerMode")),Re.initialize(oe("trackAnalyticsEvent",null),oe("definedAnalyticsHandler",null),oe("appTimerStart",null),oe("appTimerStop",null),oe("nextFrame",null),oe("startProfile",null),oe("stopProfile",null),oe("loadTimeTracker",null),oe("socketConnectionTracker",null)),Nn.initialize(oe("logError",()=>{})),Y._bowser=se("bowser"),jt.initialize(Y._bowser),Y._scrollToPan=oe("scrollToPan",Y._scrollToPanDefault),Y._disablePrototypeDeviceFrames=oe("disablePrototypeDeviceFrames",Y._disablePrototypeDeviceFramesDefault),Y._disableKeyboardHandling=oe("disableKeyboardHandling",Y._disableKeyboardHandlingDefault),Y._gameControllerListener=oe("gameControllerListener",null),Y._isInlinePreview=oe("isInlinePreview",!1),Y._isSlidesEmbed=oe("isSlidesEmbed",!1),Y._shouldPlayVideosLinearly=oe("shouldPlayVideosLinearly",!1)}Y.initialize=nt;function Et(){return!Y._disablePrototypeDeviceFrames&&Y._viewerMode==1}Y.deviceFramesSupported=Et;function He(re){Y.prototypeBackgroundColorOverride=re}Y.setPrototypeBackgroundColorOverride=He;function st(){if(Y._htmlImageDecodeMethodIsPresent==null){let re=new Image,se=re.decode!==null&&re.decode!==void 0;Y._htmlImageDecodeMethodIsPresent=new fe(se)}return Y._htmlImageDecodeMethodIsPresent.value}Y.htmlImageDecodeMethodIsPresent=st;function ke(){return(jt.isMobile(jt.current())||jt.current()==4&&navigator.maxTouchPoints>0||Qt.forceMobileOptimizations()||Y.getFeatureFlags().force_mobile_optimizations)??!1}Y.shouldApplyMobileOptimizations=ke;let kt;(oe=>(oe[oe.MIRROR=0]="MIRROR",oe[oe.PROTOTYPE=1]="PROTOTYPE"))(kt=Y.ViewerMode||(Y.ViewerMode={}));let Zt;(se=>{function re(oe){if(typeof oe=="string")switch(oe){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${oe}`)}se.ViewerMode_create=re})(Zt=Y.in_ViewerMode||(Y.in_ViewerMode={})),Y._bowser=null,Y._featureFlags={},Y._viewerMode=1,Y._scrollToPanDefault=!0,Y._scrollToPan=Y._scrollToPanDefault,Y._dragToPanDefault=!0,Y._dragToPan=Y._dragToPanDefault,Y._disablePrototypeDeviceFramesDefault=!1,Y._disablePrototypeDeviceFrames=Y._disablePrototypeDeviceFramesDefault,Y._disableKeyboardHandlingDefault=!1,Y._disableKeyboardHandling=Y._disableKeyboardHandlingDefault,Y._gameControllerListener=null,Y._isInlinePreview=!1,Y.protoUseFrameEvictionForUnitTests=!1,Y.prototypeBackgroundColorOverride=null,Y._htmlImageDecodeMethodIsPresent=null,Y.forceInitiateStateChangeForTests=!1,Y._isSlidesEmbed=!1,Y._shouldPlayVideosLinearly=!1,Y._useWasmTileStackTile=null,Y._useWasmRasterizer=null})(U||(U={}));var dn;(a=>{function t(s,l){if(o.set(s,l),!i.has(s))i.set(s,o.get(s));else{let c=i.get(s);i.set(s,Math.max(c,l))}}a.trackNumber=t;function e(s,l){if(o.has(s)?o.set(s,o.get(s)+l):o.set(s,l),!i.has(s))i.set(s,o.get(s));else{let c=i.get(s);i.set(s,Math.max(c,o.get(s)))}return o.get(s)}a.increment=e;function r(s){return i.has(s)?i.get(s):0}a.getMax=r;function n(){let s=window.performance.memory;s&&s.jsHeapSizeLimit&&s.usedJSHeapSize&&(t("JS Heap size (MB)",s.jsHeapSizeLimit/(1024*1024)|0),t("Used Heap size (MB)",s.usedJSHeapSize/(1024*1024)|0));let l={};for(let c of Array.from(o.keys())){let d=o.get(c);l[c]=Math.round(d*100)/100}return l}a.getStatsForDebugging=n;let o=new Map,i=new Map})(dn||(dn={}));var Br=class t{constructor(){this.SHADER_NAME_U_TYPE="uType";this.SHADER_NAME_U_SHAPE_TYPE="uShapeType";this.SHADER_NAME_U_ELLIPSE_CENTER="uEllipseCenter";this.SHADER_NAME_U_ELLIPSE_RADII="uEllipseRadii";this.SHADER_NAME_U_RECT="uRect";this.SHADER_NAME_U_CORNER_RADII="uCornerRadii";this.SHADER_NAME_U_OPACITY="uOpacity";this.SHADER_NAME_TEXTURE0="texture0";this.SHADER_NAME_U_GLOBAL_TINT="uGlobalTint";this.SHADER_NAME_U_GLOBAL_COLOR="uGlobalColor";this.SHADER_NAME_U_GLOBAL_SHADOWS="uGlobalShadows";this.SHADER_NAME_U_GLOBAL_HIGHLIGHTS="uGlobalHighlights";this.SHADER_NAME_U_GLOBAL_EXPOSURE="uGlobalExposure";this.SHADER_NAME_U_GLOBAL_TEMPERATURE="uGlobalTemperature";this.SHADER_NAME_U_GLOBAL_CONTRAST="uGlobalContrast";this.SHADER_NAME_U_EMULATE_WRAP_ADDRESS="uEmulateWrapAddress";this.SHADER_NAME_U_EMULATE_BORDER_ADDRESS="uEmulateBorderAddress";this.SHADER_NAME_PREMULTIPLY_BEFORE_MSAA="premultiplyBeforeMSAA";this.SHADER_NAME_U_PROGRESS="uProgress";this.SHADER_NAME_TEXTURE1="texture1";this.SHADER_NAME_U_PATH_SIZE="uPathSize";this.SHADER_NAME_U_PIXEL_RATIO="uPixelRatio";this.SHADER_NAME_U_PAINT_TRANSFORM0="uPaintTransform0";this.SHADER_NAME_U_UV_SCALE="uUvScale";this.SHADER_NAME_U_VERTEX_TRANSFORM="uVertexTransform";this.SHADER_NAME_A_POSITION2="aPosition2";this.SHADER_NAME_U_COLOR="uColor";this.SHADER_NAME_U_PAINT_TRANSFORM1="uPaintTransform1";this.SHADER_NAME_U_COUNT="uCount";this.SHADER_NAME_U_BLUR_DELTA="uBlurDelta";this.SHADER_NAME_U_BLUR_CLAMP="uBlurClamp";this.SHADER_NAME_INCREASE_MAX_RADIUS_FOR_BLURS="increaseMaxRadiusForBlurs";this.SHADER_NAME_START_COUNT="startCount";this.SHADER_NAME_END_COUNT="endCount";this.SHADER_NAME_BLUR_DELTA="blurDelta";this.SHADER_NAME_BLUR_CLAMP="blurClamp";this.SHADER_NAME_BLUR_GRADIENT_START="blurGradientStart";this.SHADER_NAME_BLUR_GRADIENT_END="blurGradientEnd";this.SHADER_NAME_RADIUS_IN_PIXEL_SPACE="radiusInPixelSpace";this.SHADER_NAME_SCALE="scale";this.SHADER_NAME_NODE_SIZE="nodeSize";this.SHADER_NAME_NOISE_SIZE="noiseSize";this.SHADER_NAME_NODE_TO_TILE_SPACE="nodeToTileSpace";this.SHADER_NAME_TILE_TO_NODE_SPACE="tileToNodeSpace";this.SHADER_NAME_NODE_SPACE_CENTER_POINT="nodeSpaceCenterPoint";this.SHADER_NAME_U_SEED="uSeed";this.SHADER_NAME_U_QUAD="uQuad";this.SHADER_NAME_U_SOURCE="uSource";this.SHADER_NAME_U_UV_SPACE_CLAMPING_RECT="uUvSpaceClampingRect";this.SHADER_NAME_U_UV_SPACE_SOURCE_RECT="uUvSpaceSourceRect";this.SHADER_NAME_U_TO_CLIP_SPACE_TRANSFORM="uToClipSpaceTransform";this.SHADER_NAME_U_DESTINATION_RECT="uDestinationRect";this.SHADER_NAME_CORNER_RADIUS_IN_PIXEL_SPACE="cornerRadiusInPixelSpace";this.SHADER_NAME_CORNER_SMOOTHING="cornerSmoothing";this.SHADER_NAME_REFL_RADIUS_IN_PIXEL_SPACE="reflRadiusInPixelSpace";this.SHADER_NAME_REFRACTION_INTENSITY="refractionIntensity";this.SHADER_NAME_REFRACTION_DISTANCE="refractionDistance";this.SHADER_NAME_LIGHT_INTENSITY="lightIntensity";this.SHADER_NAME_LIGHT_ANGLE="lightAngle";this.SHADER_NAME_BEVEL_SIZE="bevelSize";this.SHADER_NAME_CHROMATIC_ABERRATION="chromaticAberration";this.SHADER_NAME_TINT_COLOR="tintColor";this.SHADER_NAME_CORNER_RADII="cornerRadii";this.SHADER_NAME_CORNER_SMOOTHINGS="cornerSmoothings";this.SHADER_NAME_HAS_UNIFORM_CORNERS="hasUniformCorners";this.SHADER_NAME_TILE_EXPANSION_SCALE="tileExpansionScale";this.SHADER_NAME_FRAME_ROTATION="frameRotation";this.SHADER_NAME_QUAD="quad";this.SHADER_NAME_SOURCE="source";this.SHADER_NAME_BLUR_RANGE_SOURCE="blurRangeSource";this.SHADER_NAME_POSITION2="position2";this.SHADER_NAME_U_TEXTURE_SIZE="uTextureSize";this.SHADER_NAME_U_TEXTURE_PX="uTexturePx";this.SHADER_NAME_PATTERN_TEX_SIZE_PIXELS="patternTexSizePixels";this.SHADER_NAME_PATTERN_BOUNDS_OFFSET_PIXELS="patternBoundsOffsetPixels";this.SHADER_NAME_TILE_SIZE_PIXELS="tileSizePixels";this.SHADER_NAME_FILL_SIZE_PIXELS="fillSizePixels";this.SHADER_NAME_OFFSET_PIXELS="offsetPixels";this.SHADER_NAME_PATTERN_TILE_TYPE="patternTileType";this.SHADER_NAME_PAINT_TRANSFORM="paintTransform";this.SHADER_NAME_VERTEX_TRANSFORM="vertexTransform";this.SHADER_NAME_COORD3="coord3";this.SHADER_NAME_TEXTURE0_UV_SPACE_SCISSOR="texture0UvSpaceScissor";this.SHADER_NAME_TEXTURE1_UV_SPACE_SCISSOR="texture1UvSpaceScissor";this.SHADER_NAME_A_COORD3="aCoord3";this.SHADER_NAME_CANVAS_SPACE_TO_CLIP_SPACE_TRANSFORM="canvasSpaceToClipSpaceTransform";this.SHADER_NAME_INSTANCE_TRANSFORM0="instanceTransform0";this.SHADER_NAME_INSTANCE_TRANSFORM1="instanceTransform1";this.SHADER_NAME_TEXTURE2="texture2";this.SHADER_NAME_U_NOISE_TYPE="uNoiseType";this.SHADER_NAME_U_NOISE_SIZE="uNoiseSize";this.SHADER_NAME_U_TILE_TO_NODE_SPACE="uTileToNodeSpace";this.SHADER_NAME_U_DENSITY="uDensity";this.SHADER_NAME_U_SECONDARY_COLOR="uSecondaryColor";this.SHADER_NAME_U_NODE_SPACE_CENTER_POINT="uNodeSpaceCenterPoint";this.SHADER_NAME_U_BLUR_RADIUS="uBlurRadius";this.SHADER_NAME_A_POSITION4="aPosition4";this.SHADER_NAME_U_HOTSPOT_OPACITY="uHotspotOpacity";this.SHADER_NAME_U_STROKE_PROPORTION="uStrokeProportion";this.SHADER_NAME_U_UV_HOTSPOT_CLIPPING_RECT="uUvHotspotClippingRect";this.SHADER_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="uHalfSizeOverBlurRadius";this.SHADER_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="uCornerRadiusOverBlurRadius";this.SHADER_NAME_A_COORD4="aCoord4";this.SHADER_NAME_TILE_ATLAS_TILE_SIZE="tileAtlasTileSize";this.SHADER_NAME_SCALE_TO_UNADJUST="scaleToUnadjust";U.shouldUseWebGL2()?(this.SHADER_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform sampler2D texture0;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);fig_FragColor =ditherColor(texture(texture0, coord) * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;uniform int premultiplyBeforeMSAA;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA_premultiplied();fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA_premultiplied_adjusted();fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped =mix(texture(texture0, coord), texture(texture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}vec4 sampleImagePaintBWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA_premultiplied();vec4 imageB = sampleImagePaintBWithMSAA_premultiplied();vec4 lerped = mix(imageA, imageB, uProgress);fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}vec4 sampleImagePaintBWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA_premultiplied_adjusted();vec4 imageB = sampleImagePaintBWithMSAA_premultiplied_adjusted();vec4 lerped = mix(imageA, imageB, uProgress);fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;out vec2 vPaintASample;out vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);fig_FragColor = uColor * uOpacity * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vPaintASample;out vec2 vStepA;out vec2 vPaintBSample;out vec2 vStepB;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB =(uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_BLEND_MODE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;float minv3(vec3 c) { return min(min(c.r, c.g), c.b); }float maxv3(vec3 c) { return max(max(c.r, c.g), c.b); }float satv3(vec3 c) { return maxv3(c) - minv3(c); }float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {cbase = clamp(cbase, 0.0, 1.0);clum = clamp(clum, 0.0, 1.0);float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}out vec4 fig_FragColor;void main() {const int DARKEN = 2;const int MULTIPLY = 3;const int LINEAR_BURN = 4;const int COLOR_BURN = 5;const int LIGHTEN = 6;const int SCREEN = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture(texture0, vCoord2) * uOpacity;vec4 target = texture(texture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {fig_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca), 2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca, Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0)Sc /= Sa;if (Da > 0.0)Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}fig_FragColor = vec4(color, Sa + Da - Sa * Da);}}`,this.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2) * uOpacity; }`,this.SHADER_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture(texture0, coord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg =(uCount - t0) *float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos =(uCount - t0) *float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg =(uCount - t1) *float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos =(uCount - t1) *float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg =(coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos =(coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result += texture(texture0, coord_neg) * weight_neg +texture(texture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}fig_FragColor = result / total;}`,this.SHADER_SOURCE_CLAMPED_GRADIENT_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec4 blurClamp;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;in vec2 _coord2;in vec2 _coord2Source;out vec4 fig_FragColor;void main() {vec2 coord2 = _coord2;vec2 coord2Source = clamp(_coord2Source, blurClamp.xy, blurClamp.zw);float coord2_x_scaling = coord2Source.x / _coord2Source.x;float coord2_y_scaling = coord2Source.y / _coord2Source.y;coord2.x = coord2.x * coord2_x_scaling;coord2.y = coord2.y * coord2_y_scaling;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;vec2 coord2Source_coord0_neg = coord2Source - blurDelta * t0;vec2 coord2Source_coord0_pos = coord2Source + blurDelta * t0;vec2 coord2Source_coord1_neg = coord2Source - blurDelta * t1;vec2 coord2Source_coord1_pos = coord2Source + blurDelta * t1;float weight0_neg =(radius - t0) *float(coord2Source_coord0_neg ==clamp(coord2Source_coord0_neg, blurClamp.xy, blurClamp.zw));float weight0_pos =(radius - t0) *float(coord2Source_coord0_pos ==clamp(coord2Source_coord0_pos, blurClamp.xy, blurClamp.zw));float weight1_neg =(radius - t1) *float(coord2Source_coord1_neg ==clamp(coord2Source_coord1_neg, blurClamp.xy, blurClamp.zw));float weight1_pos =(radius - t1) *float(coord2Source_coord1_pos ==clamp(coord2Source_coord1_pos, blurClamp.xy, blurClamp.zw));if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}fig_FragColor = result / total;}`,this.SHADER_SOURCE_CLAMPED_GRAIN_FRAGMENT=`#version 300 es
precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2; out vec4 fig_FragColor;uniform float radiusInPixelSpace;uniform float scale;uniform vec2 nodeSize;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 untransformedSamplingPoint = vCoord2;vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 sourceTexel = texture(texture1, untransformedSamplingPoint);vec4 destTexel = texture(texture0, expandedRegionSamplingPoint);float fixedAmountScaling = pow(sourceTexel.a, 0.2) * pow(destTexel.a, 0.2);vec2 samplingPointAlphaAdjusted =nodeSpacePixelPoint + amt * radiusInPixelSpace * fixedAmountScaling;vec2 finalSamplingPointAlphaAdjusted =(nodeToTileSpace * vec3(samplingPointAlphaAdjusted, 1.0)).xy;vec2 expandedRegionSamplingPointAlphaAdjusted =((((finalSamplingPointAlphaAdjusted - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 fixedDestTexel =texture(texture0, expandedRegionSamplingPointAlphaAdjusted);if (sourceTexel.a > 0.0 && fixedDestTexel.a > 0.0) {fig_FragColor = fixedDestTexel;} else {fig_FragColor = sourceTexel;}}`,this.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX=`#version 300 es
precision highp float;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}`,this.SHADER_SOURCE_COPY_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;void main() { gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1); }`,this.SHADER_SOURCE_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2); }`,this.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`,this.SHADER_SOURCE_DRAW_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D texture0;in vec2 vCoord2;const bool drawDebugStuff = false;out vec4 fig_FragColor;void main() {vec2 sampleCoordinates =clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);fig_FragColor = texture(texture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) /(uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) -0.5);float t = max(tt.x, tt.y);if (t > 0.99) {fig_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}`,this.SHADER_SOURCE_DRAW_TEXTURE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform *vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0, 1);}`,this.SHADER_SOURCE_GLASS_FRAGMENT=`#version 300 es
precision highp float;float sdBox(vec2 p, vec2 halfSize) {vec2 d = abs(p) - halfSize;return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);}float sdRoundBox(vec2 p, vec2 halfSize, float cornerRadius) {float rn = min(cornerRadius, min(halfSize.x, halfSize.y));return sdBox(p, halfSize - rn) - rn;}float sdRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 rs) {float d = -9999999.0;vec2 size = halfSize * 2.0;d = max(d, sdRoundBox(p * vec2(1.0, 1.0) + halfSize, size, rs.x));d = max(d, sdRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, rs.y));d = max(d, sdRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, rs.z));d = max(d, sdRoundBox(p * vec2(1.0, -1.0) + halfSize, size, rs.w));return d;}mat2 rot(float t) {float cosT = cos(t);float sinT = sin(t);return mat2(cosT, -sinT, sinT, cosT);}const int NUM_NEWTON_ITERATIONS =2; const int NUM_NEWTON_START_POINTS =3; const float NEWTON_DAMPING_FACTOR = 1.0; int solveCubic(float a, float b, float c, out vec3 roots) {float p = b - a * a / 3.0;float q = a * (2.0 * a * a - 9.0 * b) / 27.0 + c;float p3 = p * p * p;float discriminant = q * q + 4.0 * p3 / 27.0;float offset = -a / 3.0; if (discriminant >= 0.0) {float z = sqrt(discriminant);float u = (-q + z) / 2.0;float v = (-q - z) / 2.0;u = sign(u) * pow(abs(u), 1.0 / 3.0);v = sign(v) * pow(abs(v), 1.0 / 3.0);roots[0] = offset + u + v;float f = ((roots[0] + a) * roots[0] + b) * roots[0] + c; float f1 = (3. * roots[0] + 2. * a) * roots[0] + b;       roots[0] -= f / f1; return 1; }float u = sqrt(-p / 3.0);float v = acos(-sqrt(-27.0 / p3) * q / 2.0) / 3.0;float m = cos(v), n = sin(v) * 1.732050808; roots[0] = offset + u * (m + m); roots[1] = offset - u * (n + m); roots[2] = offset + u * (n - m); vec3 f = ((roots + a) * roots + b) * roots + c; vec3 f1 = (3.0 * roots + 2.0 * a) * roots + b;  roots -= f / f1;                                return 3; }float cubicBezierSign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {float cu = (-p0.y + 3.0 * p1.y - 3.0 * p2.y + p3.y); float qu = (3.0 * p0.y - 6.0 * p1.y + 3.0 * p2.y);   float li = (-3.0 * p0.y + 3.0 * p1.y);               float co = p0.y - uv.y; vec3 roots;int numRoots = solveCubic(qu / cu, li / cu, co / cu, roots);int numIntersections = 0;for (int i = 0; i < 3; i++) {if (i < numRoots) {if (roots[i] >= 0.0 && roots[i] <= 1.0) {float t = roots[i];float xPos = ((((-p0.x + 3. * p1.x - 3. * p2.x + p3.x) * t +(3. * p0.x - 6. * p1.x + 3. * p2.x)) *t) +(-3. * p0.x + 3. * p1.x)) *t +p0.x;if (xPos < uv.x) {numIntersections++;}}}}vec2 tangStart = p0.xy - p1.xy;vec2 tangEnd = p2.xy - p3.xy;vec2 normStart = vec2(tangStart.y, -tangStart.x);vec2 normEnd = vec2(tangEnd.y, -tangEnd.x);if (p0.y < p1.y) {if ((uv.y <= p0.y) && (dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}} else {if (!(uv.y <= p0.y) && !(dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}}if (p2.y < p3.y) {if (!(uv.y <= p3.y) && dot(uv - p3.xy, normEnd) < 0.0) {numIntersections++;}} else {if ((uv.y <= p3.y) && !(dot(uv - p3.xy, normEnd) < 0.0)) {numIntersections++;}}if (numIntersections == 0 || numIntersections == 2 || numIntersections == 4) {return 1.0; } else {return -1.0; }}float cubicBezierNormalIteration(float t, vec2 a0, vec2 a1, vec2 a2, vec2 a3) {vec2 a_2 = a2 + t * a3;  vec2 a_1 = a1 + t * a_2; vec2 b_2 = a_2 + t * a3; vec2 uvToP =a0 + t * a_1; vec2 tang = a_1 + t * b_2; float tanLenSq =dot(tang, tang); float projection = dot(tang, uvToP); return t - NEWTON_DAMPING_FACTOR * projection / tanLenSq;}float cubicBezierDistApproxSq(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {vec2 a3 = (-p0 + 3.0 * p1 - 3.0 * p2 + p3); vec2 a2 = (3.0 * p0 - 6.0 * p1 + 3.0 * p2); vec2 a1 = (-3.0 * p0 + 3.0 * p1);           vec2 a0 = p0 - uv; float d0 = 1.0e38; float t0 = 0.;     float t;           for (int i = 0; i < NUM_NEWTON_START_POINTS; i++) {t = t0; for (int j = 0; j < NUM_NEWTON_ITERATIONS; j++) {t = cubicBezierNormalIteration(t, a0, a1, a2, a3);}t = clamp(t, 0.0, 1.0);vec2 uvToP = ((a3 * t + a2) * t + a1) * t + a0;d0 = min(d0, dot(uvToP, uvToP)); t0 += 1. / float(NUM_NEWTON_START_POINTS - 1);}return d0; }float cubicBezierDistApprox(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {return sqrt(cubicBezierDistApproxSq(uv, p0, p1, p2, p3));}float sdSmoothRoundCorner(vec2 uv, float radius, float smoothing) {float PI = 3.14159265359;float HALF_PI = PI * 0.5;float SQRT_2 = 1.41421356237;float bezAngle = 0.5 * HALF_PI * smoothing;float arcAngle = HALF_PI * (1.0 - smoothing);float requiredEdgeLength = (1.0 + smoothing) * radius;float dOverC = tan(bezAngle);float l = sin(arcAngle * 0.5) * radius * SQRT_2;float c = radius * tan(bezAngle * 0.5) * cos(bezAngle);float d = c * dOverC;float b = ((requiredEdgeLength - l) - (1.0 + dOverC) * c) / 3.0;float a = 2.0 * b;uv = rot(PI * -0.25) * uv;uv.x = -abs(uv.x);vec2 cp = uv + vec2(0.0, 1.414213) * radius;float angle = atan(cp.x, cp.y);uv = rot(PI * 0.25) * uv;vec2 p0 = vec2(-requiredEdgeLength, 0.0);vec2 p1 = p0 + vec2(a, 0.0);vec2 p2 = p1 + vec2(b, 0.0);vec2 p3 = p2 + vec2(c, -d);vec2 cornerCenter = uv + requiredEdgeLength;if (cornerCenter.x < 0.0) {return cornerCenter.y - requiredEdgeLength;} else if (abs(angle) < arcAngle * 0.5) {return length(cp) - radius;}float dis = cubicBezierDistApprox(uv, p0, p1, p2, p3);float sgn = -cubicBezierSign(uv, p0, p1, p2, p3);return dis * sgn;}float sdSmoothRoundBox(vec2 uv, vec2 halfSize, float radius, float smoothing) {if (radius <= 1e-6) {return sdBox(uv, halfSize);}float minHalfSize = min(halfSize.x, halfSize.y);float requiredLength = radius * (1.0 + smoothing);float overlap = max(0.0, requiredLength - minHalfSize) / radius;float finalSmoothing = max(0.0, smoothing - overlap);float finalRadius = min(minHalfSize, radius);if (finalSmoothing <= 1e-6) {return sdRoundBox(uv, halfSize, finalRadius);}vec2 p = abs(uv) - halfSize;return sdSmoothRoundCorner(p, finalRadius, finalSmoothing);}float sdSmoothRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 radii,vec4 smoothings) {float d = sdBox(p, halfSize);vec2 size = halfSize * 2.0;d = max(d, sdSmoothRoundBox(p * vec2(1.0, 1.0) + halfSize, size, radii.x,smoothings.x));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, radii.y,smoothings.y));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, radii.z,smoothings.z));d = max(d, sdSmoothRoundBox(p * vec2(1.0, -1.0) + halfSize, size, radii.w,smoothings.w));return d;}const float HALF_PI = 1.57079632679;uniform sampler2D texture0;in vec2 vCoord2; out vec4 fig_FragColor;uniform float cornerRadiusInPixelSpace;uniform float cornerSmoothing;uniform float scale;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform float reflRadiusInPixelSpace;uniform float refractionIntensity;uniform float refractionDistance;uniform float lightIntensity;uniform float lightAngle;uniform float bevelSize;uniform float chromaticAberration;uniform vec4 tintColor;float linearstep(float a, float b, float t) {return clamp((t - a) / max(0.00001, b - a), 0.0, 1.0);}vec2 nodeSpaceToExpandedTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;vec2 expandedRegionSourceSamplingPoint =((((tileSpacePosition - 0.5) * 2.0) * scale) / 2.0) + 0.5;return expandedRegionSourceSamplingPoint;}vec2 nodeSpaceToStandardTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;return tileSpacePosition;}vec4 getRefractedTexture(vec2 p) {vec2 finalSamplingPositionInTileSpace =nodeSpaceToExpandedTileSpacePosition(p);return texture(texture0, finalSamplingPositionInTileSpace);}vec4 getRefractedTextureWithChromaticAberration(vec2 p, vec2 refrDir,float chromaAmt) {const int CHROMA_KERNEL_SIZE = 8;vec4 chromaBlurredColor = vec4(0.0, 0.0, 0.0, 0.0);float invKernelSize = 1.0 / float(CHROMA_KERNEL_SIZE - 1);float sum = 0.0;for (int i = 0; i < CHROMA_KERNEL_SIZE; i++) {float fi = float(i) * invKernelSize - 0.5; float window = 1.0 - abs(fi * 2.0);        vec4 red = getRefractedTexture(p + (fi + 0.5) * chromaAmt * refrDir);vec4 green = getRefractedTexture(p + fi * chromaAmt * refrDir);vec4 blue = getRefractedTexture(p + (fi - 0.5) * chromaAmt * refrDir);float alpha = max(max(red.a, green.a), blue.a);chromaBlurredColor += vec4(red.r, green.g, blue.b, alpha) * window;sum += window;}return chromaBlurredColor / sum;}vec2 getGlassRectNormal(vec2 p, vec2 halfSize, float cornerRad) {float r = min(min(halfSize.x, halfSize.y), cornerRad);vec2 d = abs(p) - (halfSize - r);bool isFlat = max(d.x, d.y) <= -bevelSize * step(cornerRad, bevelSize);if (isFlat) {return vec2(0.0, 0.0);} else {return normalize(d + max(-min(d.x, d.y), 0.0)) * sign(p);}}vec2 getGlassRectRefractionDir(vec2 p, vec2 halfSize, float cornerRad,float refractionDistance) {return getGlassRectNormal(p, halfSize, max(cornerRad, refractionDistance));}void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;vec2 boundsSize = nodeSpaceCenterPoint * 2.0;vec2 halfBoundsSize = boundsSize * 0.5;float minHalfSize = min(halfBoundsSize.x, halfBoundsSize.y);vec2 boundsCenter = nodeSpaceCenterPoint;vec2 pBox = nodeSpacePixelPoint - nodeSpaceCenterPoint;float boxDist = sdSmoothRoundBox(pBox, halfBoundsSize,cornerRadiusInPixelSpace, cornerSmoothing);float BEVEL_SIZE = bevelSize;float BEVEL_REFRACTION_MULT = 0.2; float REFRACTION_STRENGTH = refractionIntensity;float refractionDistance = min(minHalfSize, refractionDistance);float refrArea =linearstep(-refractionDistance - bevelSize, -bevelSize, boxDist);float refrMult = pow(refrArea, 3.5) * refractionDistance;float maxRefrOffset = 0.999 * refractionDistance;float dishRefrOffset =clamp(refrMult * REFRACTION_STRENGTH, -maxRefrOffset, maxRefrOffset);float bevelRefrOffset =REFRACTION_STRENGTH * BEVEL_REFRACTION_MULT * maxRefrOffset;float isBevel = linearstep(-bevelSize - 0.0001, -bevelSize * 0.3, boxDist);vec2 glassNormal = getGlassRectRefractionDir(pBox, halfBoundsSize, cornerRadiusInPixelSpace, refractionDistance);vec2 refrDir = -glassNormal * mix(dishRefrOffset, bevelRefrOffset, isBevel);vec2 p = nodeSpacePixelPoint;vec4 col = vec4(0.0);p += refrDir;if (chromaticAberration < 0.001) {col = getRefractedTexture(p);} else {col = getRefractedTextureWithChromaticAberration(p, refrDir,chromaticAberration);}col = col * (1.0 - tintColor.a) + tintColor;float LIGHT_INTENSITY = lightIntensity;float SPECULAR_HARDNESS = 0.2;float halfSpecThk = BEVEL_SIZE * 0.5;float rim =smoothstep(-BEVEL_SIZE - 0.001, -BEVEL_SIZE * SPECULAR_HARDNESS, boxDist);float frameRot =atan(nodeToTileSpace[1][0],nodeToTileSpace[0][0]); float SPECULAR_FALLOFF = 0.35;   float BOTTOM_LIGHT_MULT = 0.6;float specularAngle = lightAngle + frameRot + HALF_PI;vec2 specularNormal =getGlassRectNormal(pBox, halfBoundsSize, cornerRadiusInPixelSpace);vec2 lightDir = vec2(cos(specularAngle), sin(specularAngle));col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, -lightDir)) *rim * LIGHT_INTENSITY;col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, lightDir)) *rim * LIGHT_INTENSITY * BOTTOM_LIGHT_MULT;float DISH_SHADE_STRENGTH = 0.05;float shadeSize = refractionDistance;float shadeMult =pow(linearstep(-shadeSize, -BEVEL_SIZE + 0.0001, boxDist), 2.0);float shadeAmt = dot(glassNormal, lightDir);col.xyz += shadeAmt * shadeMult * DISH_SHADE_STRENGTH * LIGHT_INTENSITY;fig_FragColor = col;}`,this.SHADER_SOURCE_GLASS_NON_UNIFORM_CORNER_RADII_FRAGMENT=`#version 300 es
precision highp float;float sdBox(vec2 p, vec2 halfSize) {vec2 d = abs(p) - halfSize;return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);}float sdRoundBox(vec2 p, vec2 halfSize, float cornerRadius) {float rn = min(cornerRadius, min(halfSize.x, halfSize.y));return sdBox(p, halfSize - rn) - rn;}float sdRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 rs) {float d = -9999999.0;vec2 size = halfSize * 2.0;d = max(d, sdRoundBox(p * vec2(1.0, 1.0) + halfSize, size, rs.x));d = max(d, sdRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, rs.y));d = max(d, sdRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, rs.z));d = max(d, sdRoundBox(p * vec2(1.0, -1.0) + halfSize, size, rs.w));return d;}mat2 rot(float t) {float cosT = cos(t);float sinT = sin(t);return mat2(cosT, -sinT, sinT, cosT);}const int NUM_NEWTON_ITERATIONS =2; const int NUM_NEWTON_START_POINTS =3; const float NEWTON_DAMPING_FACTOR = 1.0; int solveCubic(float a, float b, float c, out vec3 roots) {float p = b - a * a / 3.0;float q = a * (2.0 * a * a - 9.0 * b) / 27.0 + c;float p3 = p * p * p;float discriminant = q * q + 4.0 * p3 / 27.0;float offset = -a / 3.0; if (discriminant >= 0.0) {float z = sqrt(discriminant);float u = (-q + z) / 2.0;float v = (-q - z) / 2.0;u = sign(u) * pow(abs(u), 1.0 / 3.0);v = sign(v) * pow(abs(v), 1.0 / 3.0);roots[0] = offset + u + v;float f = ((roots[0] + a) * roots[0] + b) * roots[0] + c; float f1 = (3. * roots[0] + 2. * a) * roots[0] + b;       roots[0] -= f / f1; return 1; }float u = sqrt(-p / 3.0);float v = acos(-sqrt(-27.0 / p3) * q / 2.0) / 3.0;float m = cos(v), n = sin(v) * 1.732050808; roots[0] = offset + u * (m + m); roots[1] = offset - u * (n + m); roots[2] = offset + u * (n - m); vec3 f = ((roots + a) * roots + b) * roots + c; vec3 f1 = (3.0 * roots + 2.0 * a) * roots + b;  roots -= f / f1;                                return 3; }float cubicBezierSign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {float cu = (-p0.y + 3.0 * p1.y - 3.0 * p2.y + p3.y); float qu = (3.0 * p0.y - 6.0 * p1.y + 3.0 * p2.y);   float li = (-3.0 * p0.y + 3.0 * p1.y);               float co = p0.y - uv.y; vec3 roots;int numRoots = solveCubic(qu / cu, li / cu, co / cu, roots);int numIntersections = 0;for (int i = 0; i < 3; i++) {if (i < numRoots) {if (roots[i] >= 0.0 && roots[i] <= 1.0) {float t = roots[i];float xPos = ((((-p0.x + 3. * p1.x - 3. * p2.x + p3.x) * t +(3. * p0.x - 6. * p1.x + 3. * p2.x)) *t) +(-3. * p0.x + 3. * p1.x)) *t +p0.x;if (xPos < uv.x) {numIntersections++;}}}}vec2 tangStart = p0.xy - p1.xy;vec2 tangEnd = p2.xy - p3.xy;vec2 normStart = vec2(tangStart.y, -tangStart.x);vec2 normEnd = vec2(tangEnd.y, -tangEnd.x);if (p0.y < p1.y) {if ((uv.y <= p0.y) && (dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}} else {if (!(uv.y <= p0.y) && !(dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}}if (p2.y < p3.y) {if (!(uv.y <= p3.y) && dot(uv - p3.xy, normEnd) < 0.0) {numIntersections++;}} else {if ((uv.y <= p3.y) && !(dot(uv - p3.xy, normEnd) < 0.0)) {numIntersections++;}}if (numIntersections == 0 || numIntersections == 2 || numIntersections == 4) {return 1.0; } else {return -1.0; }}float cubicBezierNormalIteration(float t, vec2 a0, vec2 a1, vec2 a2, vec2 a3) {vec2 a_2 = a2 + t * a3;  vec2 a_1 = a1 + t * a_2; vec2 b_2 = a_2 + t * a3; vec2 uvToP =a0 + t * a_1; vec2 tang = a_1 + t * b_2; float tanLenSq =dot(tang, tang); float projection = dot(tang, uvToP); return t - NEWTON_DAMPING_FACTOR * projection / tanLenSq;}float cubicBezierDistApproxSq(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {vec2 a3 = (-p0 + 3.0 * p1 - 3.0 * p2 + p3); vec2 a2 = (3.0 * p0 - 6.0 * p1 + 3.0 * p2); vec2 a1 = (-3.0 * p0 + 3.0 * p1);           vec2 a0 = p0 - uv; float d0 = 1.0e38; float t0 = 0.;     float t;           for (int i = 0; i < NUM_NEWTON_START_POINTS; i++) {t = t0; for (int j = 0; j < NUM_NEWTON_ITERATIONS; j++) {t = cubicBezierNormalIteration(t, a0, a1, a2, a3);}t = clamp(t, 0.0, 1.0);vec2 uvToP = ((a3 * t + a2) * t + a1) * t + a0;d0 = min(d0, dot(uvToP, uvToP)); t0 += 1. / float(NUM_NEWTON_START_POINTS - 1);}return d0; }float cubicBezierDistApprox(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {return sqrt(cubicBezierDistApproxSq(uv, p0, p1, p2, p3));}float sdSmoothRoundCorner(vec2 uv, float radius, float smoothing) {float PI = 3.14159265359;float HALF_PI = PI * 0.5;float SQRT_2 = 1.41421356237;float bezAngle = 0.5 * HALF_PI * smoothing;float arcAngle = HALF_PI * (1.0 - smoothing);float requiredEdgeLength = (1.0 + smoothing) * radius;float dOverC = tan(bezAngle);float l = sin(arcAngle * 0.5) * radius * SQRT_2;float c = radius * tan(bezAngle * 0.5) * cos(bezAngle);float d = c * dOverC;float b = ((requiredEdgeLength - l) - (1.0 + dOverC) * c) / 3.0;float a = 2.0 * b;uv = rot(PI * -0.25) * uv;uv.x = -abs(uv.x);vec2 cp = uv + vec2(0.0, 1.414213) * radius;float angle = atan(cp.x, cp.y);uv = rot(PI * 0.25) * uv;vec2 p0 = vec2(-requiredEdgeLength, 0.0);vec2 p1 = p0 + vec2(a, 0.0);vec2 p2 = p1 + vec2(b, 0.0);vec2 p3 = p2 + vec2(c, -d);vec2 cornerCenter = uv + requiredEdgeLength;if (cornerCenter.x < 0.0) {return cornerCenter.y - requiredEdgeLength;} else if (abs(angle) < arcAngle * 0.5) {return length(cp) - radius;}float dis = cubicBezierDistApprox(uv, p0, p1, p2, p3);float sgn = -cubicBezierSign(uv, p0, p1, p2, p3);return dis * sgn;}float sdSmoothRoundBox(vec2 uv, vec2 halfSize, float radius, float smoothing) {if (radius <= 1e-6) {return sdBox(uv, halfSize);}float minHalfSize = min(halfSize.x, halfSize.y);float requiredLength = radius * (1.0 + smoothing);float overlap = max(0.0, requiredLength - minHalfSize) / radius;float finalSmoothing = max(0.0, smoothing - overlap);float finalRadius = min(minHalfSize, radius);if (finalSmoothing <= 1e-6) {return sdRoundBox(uv, halfSize, finalRadius);}vec2 p = abs(uv) - halfSize;return sdSmoothRoundCorner(p, finalRadius, finalSmoothing);}float sdSmoothRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 radii,vec4 smoothings) {float d = sdBox(p, halfSize);vec2 size = halfSize * 2.0;d = max(d, sdSmoothRoundBox(p * vec2(1.0, 1.0) + halfSize, size, radii.x,smoothings.x));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, radii.y,smoothings.y));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, radii.z,smoothings.z));d = max(d, sdSmoothRoundBox(p * vec2(1.0, -1.0) + halfSize, size, radii.w,smoothings.w));return d;}const float HALF_PI = 1.57079632679;uniform sampler2D texture0;in vec2 vCoord2; out vec4 fig_FragColor;uniform vec4 cornerRadii;uniform vec4 cornerSmoothings;uniform int hasUniformCorners;uniform float tileExpansionScale;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform float reflRadiusInPixelSpace;uniform float frameRotation;uniform float refractionIntensity;uniform float refractionDistance;uniform float lightIntensity;uniform float lightAngle;uniform float bevelSize;uniform float chromaticAberration;uniform vec4 tintColor;float linearstep(float a, float b, float t) {return clamp((t - a) / max(0.00001, b - a), 0.0, 1.0);}vec2 nodeSpaceToExpandedTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;vec2 expandedRegionSourceSamplingPoint =(tileSpacePosition - 0.5) * tileExpansionScale + 0.5;return expandedRegionSourceSamplingPoint;}vec2 nodeSpaceToStandardTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;return tileSpacePosition;}vec4 getRefractedTexture(vec2 p) {vec2 finalSamplingPositionInTileSpace =nodeSpaceToExpandedTileSpacePosition(p);return texture(texture0, finalSamplingPositionInTileSpace);}vec4 getRefractedTextureWithChromaticAberration(vec2 p, vec2 refrDir,float chromaAmt) {const int CHROMA_KERNEL_SIZE = 8;vec4 chromaBlurredColor = vec4(0.0, 0.0, 0.0, 0.0);float invKernelSize = 1.0 / float(CHROMA_KERNEL_SIZE - 1);float sum = 0.0;for (int i = 0; i < CHROMA_KERNEL_SIZE; i++) {float fi = float(i) * invKernelSize - 0.5; float window = 1.0 - abs(fi * 2.0);        vec4 red = getRefractedTexture(p + (fi + 0.5) * chromaAmt * refrDir);vec4 green = getRefractedTexture(p + fi * chromaAmt * refrDir);vec4 blue = getRefractedTexture(p + (fi - 0.5) * chromaAmt * refrDir);float alpha = max(max(red.a, green.a), blue.a);chromaBlurredColor += vec4(red.r, green.g, blue.b, alpha) * window;sum += window;}return chromaBlurredColor / sum;}float getGlassRectSdf(vec2 p, vec2 halfSize) {if (hasUniformCorners == 1) {return sdSmoothRoundBox(p, halfSize, cornerRadii.x, cornerSmoothings.x);} else {return sdSmoothRoundBoxNonUniform(p, halfSize, cornerRadii,cornerSmoothings);}}vec2 getGlassRectNormal(vec2 p, vec2 halfSize, vec4 radii) {if (hasUniformCorners == 1) {float r = min(min(halfSize.x, halfSize.y), radii.x);vec2 d = abs(p) - (halfSize - r);float isFlat = step(max(d.x, d.y), -bevelSize * step(radii.x, bevelSize));return normalize(d + max(-min(d.x, d.y), 1.0e-5)) * sign(p) *(1.0 - isFlat);} else {float s = 0.1;float d = sdRoundBoxNonUniform(p, halfSize, radii);float dx = sdRoundBoxNonUniform(p + vec2(s, 0.0), halfSize, radii);float dy = sdRoundBoxNonUniform(p + vec2(0.0, s), halfSize, radii);return (vec2(dx, dy) - d) / s;}}vec2 getGlassRectRefractionDir(vec2 p, vec2 halfSize,float refractionDistance) {return getGlassRectNormal(p, halfSize,max(cornerRadii, vec4(refractionDistance)));}void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;vec2 boundsSize = nodeSpaceCenterPoint * 2.0;vec2 halfBoundsSize = boundsSize * 0.5;vec2 boundsCenter = nodeSpaceCenterPoint;vec2 pBox = nodeSpacePixelPoint - nodeSpaceCenterPoint;float boxDist = getGlassRectSdf(pBox, halfBoundsSize);float REFRACTION_CURVE_FACTOR =3.5; float BEVEL_REFRACTION_MULT = 0.2; float refrArea =linearstep(-refractionDistance - bevelSize, -bevelSize, boxDist);float refrMult = pow(refrArea, REFRACTION_CURVE_FACTOR) * refractionDistance;float maxRefrOffset = 0.999 * refractionDistance;float dishRefrOffset =clamp(refrMult * refractionIntensity, -maxRefrOffset, maxRefrOffset);float bevelRefrOffset =refractionIntensity * BEVEL_REFRACTION_MULT * maxRefrOffset;float isBevel = linearstep(-bevelSize - 0.0001, -bevelSize * 0.3, boxDist);vec2 glassNormal = getGlassRectRefractionDir(pBox, halfBoundsSize, max(bevelSize, refractionDistance));vec2 refrDir = -glassNormal * mix(dishRefrOffset, bevelRefrOffset, isBevel);vec2 p = nodeSpacePixelPoint;vec4 col = vec4(0.0);p += refrDir;if (chromaticAberration < 0.001) {col = getRefractedTexture(p);} else {col = getRefractedTextureWithChromaticAberration(p, refrDir,chromaticAberration);}float LIGHT_INTENSITY = lightIntensity;float SPECULAR_HARDNESS = 0.2;float halfSpecThk = bevelSize * 0.5;float rim =smoothstep(-bevelSize - 0.001, -bevelSize * SPECULAR_HARDNESS, boxDist);float SPECULAR_FALLOFF = 0.35; float BOTTOM_LIGHT_MULT = 0.6;float specularAngle = lightAngle - frameRotation + HALF_PI;vec2 specularNormal = getGlassRectNormal(pBox, halfBoundsSize, cornerRadii);vec2 lightDir = vec2(cos(specularAngle), sin(specularAngle));col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, -lightDir)) *rim * LIGHT_INTENSITY;col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, lightDir)) *rim * LIGHT_INTENSITY * BOTTOM_LIGHT_MULT;float DISH_SHADE_STRENGTH = 0.05;float shadeSize = refractionDistance;float shadeMult =pow(linearstep(-shadeSize, -bevelSize + 0.0001, boxDist), 2.0);float shadeAmt = dot(glassNormal, lightDir);col.xyz += shadeAmt * shadeMult * DISH_SHADE_STRENGTH * LIGHT_INTENSITY;fig_FragColor = col;}`,this.SHADER_SOURCE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);fig_FragColor = ditherColor(texture(texture0, coord) * uOpacity);}`,this.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 quad;uniform vec4 source;uniform vec4 blurRangeSource;in vec2 position2;out vec2 _coord2;out vec2 _coord2Source;void main() {_coord2Source = mix(blurRangeSource.xy, blurRangeSource.zw, position2);_coord2 = mix(source.xy, source.zw, position2);gl_Position = vec4(mix(quad.xy, quad.zw, position2) * 2.0 - 1.0, 0, 1);}`,this.SHADER_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = float(texture(texture0, vCoord2).a > 0.0) * uColor;}`,this.SHADER_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord =lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture(texture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture(texture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture(texture0, upperLeftTexelCoord).a;float upperRightAlpha = texture(texture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha = (hardMaskedLowerLeftAlpha * leftWeight +hardMaskedLowerRightAlpha * rightWeight) *bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight +hardMaskedUpperRightAlpha * rightWeight) *topWeight;fig_FragColor = downsampledHardMaskedAlpha * uColor;}`,this.SHADER_SOURCE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb *= color.a;fig_FragColor = color * uOpacity;}`,this.SHADER_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity;}`,this.SHADER_SOURCE_IMAGE_PATTERN_FRAGMENT=`#version 300 es
precision highp float;uniform vec2 patternTexSizePixels;uniform vec2 patternBoundsOffsetPixels;uniform float tileSizePixels;uniform vec2 fillSizePixels;uniform vec2 offsetPixels;uniform int patternTileType;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {const int RECTANGULAR = 0;const int HORIZONTAL_HEXAGONAL = 1;const int VERTICAL_HEXAGONAL = 2;float xRepeats = fillSizePixels.x / patternTexSizePixels.x;float yRepeats = fillSizePixels.y / patternTexSizePixels.y;vec2 offsetMultiplier = vec2(offsetPixels.x / patternTexSizePixels.x,offsetPixels.y / patternTexSizePixels.y);vec2 coord2 = vec2(vCoord2.x * xRepeats, vCoord2.y * yRepeats);vec2 patternBoundsOffsetUV =vec2(patternBoundsOffsetPixels.x / patternTexSizePixels.x,patternBoundsOffsetPixels.y / patternTexSizePixels.y);coord2 -= offsetMultiplier;coord2 += patternBoundsOffsetUV;if (patternTileType == HORIZONTAL_HEXAGONAL) {coord2.x += (1.0 + step(1., mod(coord2.y, 2.0))) * 0.5;} else if (patternTileType == VERTICAL_HEXAGONAL) {coord2.y += (1.0 + step(1., mod(coord2.x, 2.0))) * 0.5;}coord2 = fract(coord2);vec2 percentage = patternTexSizePixels / tileSizePixels;vec2 clampPercentage = (patternTexSizePixels - 0.5) / tileSizePixels;fig_FragColor = texture(texture0, min(coord2 * percentage, clampPercentage));}`,this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2); }`,this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_VERTEX=`#version 300 es
precision highp float;uniform mat3 paintTransform;uniform mat3 vertexTransform;in vec2 position2;in vec3 coord3; out vec2 vCoord2;void main() {vCoord2 = (paintTransform * coord3).xy;gl_Position = vec4(vertexTransform * vec3(position2, 1), 0).xywz;}`,this.SHADER_SOURCE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped =mix(texture(texture0, coord), texture(texture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity);}`,this.SHADER_SOURCE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity;}`,this.SHADER_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity;}`,this.SHADER_SOURCE_LERP_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 texture0UvSpaceScissor;uniform vec4 texture1UvSpaceScissor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 texture0Color = all(greaterThan(vCoord2, texture0UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture0UvSpaceScissor.zw))? texture(texture0, vCoord2): vec4(0.0);vec4 texture1Color = all(greaterThan(vCoord2, texture1UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture1UvSpaceScissor.zw))? texture(texture1, vCoord2): vec4(0.0);fig_FragColor = mix(texture0Color, texture1Color, uOpacity);}`,this.SHADER_SOURCE_LOOP_BLINN_FRAGMENT=`#version 300 es
precision highp float;in vec3 vCoord3;out vec4 fig_FragColor;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}`,this.SHADER_SOURCE_LOOP_BLINN_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;in vec3 aCoord3;out vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_LOOP_BLINN_INSTANCED_VERTEX=`#version 300 es
mat3 constructInstanceTransform(vec3 instTransform0, vec3 instTransform1) {return mat3(vec3(instTransform0.x, instTransform1.x, 0.0),vec3(instTransform0.y, instTransform1.y, 0.0),vec3(instTransform0.z, instTransform1.z, 1.0));}precision highp float;uniform mat3 canvasSpaceToClipSpaceTransform;in vec2 aPosition2;in vec3 aCoord3;in vec3 instanceTransform0;in vec3 instanceTransform1;out vec3 vCoord3;void main() {vCoord3 = aCoord3;mat3 instanceTransform =constructInstanceTransform(instanceTransform0, instanceTransform1);mat3 vertexTransform = canvasSpaceToClipSpaceTransform * instanceTransform;gl_Position = vec4(vertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {if (texture(texture1, vCoord2).a == 0.0) {discard;}fig_FragColor = texture(texture0, vCoord2);}`,this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = (1.0 - texture(texture0, vCoord2).a) *texture(texture1, vCoord2).a * uColor;}`,this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float texture1HardMasked = float(texture(texture1, vCoord2).a > 0.0);fig_FragColor =(1.0 - texture(texture0, vCoord2).a) * texture1HardMasked * uColor;}`,this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor =texture(texture0, vCoord2) * float(texture(texture1, vCoord2).a == 0.);}`,this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {float geometryAlpha = texture(texture2, vCoord2).a;fig_FragColor = mix(texture(texture1, vCoord2),texture(texture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}`,this.SHADER_SOURCE_MASK_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(texture0, vCoord2) * texture(texture1, vCoord2).a;}`,this.SHADER_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(texture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor =texture(texture0, vCoord2) * luminance * texture(texture1, vCoord2).a;}`,this.SHADER_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(texture2, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor = mix(texture(texture1, vCoord2),texture(texture0, vCoord2),texture(texture2, vCoord2).a * luminance);}`,this.SHADER_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = mix(texture(texture1, vCoord2), texture(texture0, vCoord2),texture(texture2, vCoord2).a);}`,this.SHADER_SOURCE_NOISE_EFFECT_FRAGMENT=`#version 300 es
precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;in vec2 vCoord2; out vec4 fig_FragColor;uniform int uNoiseType;uniform float uNoiseSize;uniform mat3 uTileToNodeSpace;uniform float uDensity; uniform vec4 uColor;uniform vec4 uSecondaryColor;uniform vec2 uNodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (uTileToNodeSpace * vec3(vCoord2, 1.0)).xy;float r = roundHelper((turbulence(0 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float g = roundHelper((turbulence(1 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float b = roundHelper((turbulence(2 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float a = roundHelper((turbulence(3 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);vec4 sourceValue = texture(texture0, vCoord2);if (uNoiseType == 0) {r = 2.0 * r - 0.5;g = 2.0 * g - 0.5;b = 2.0 * b - 0.5;a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;fig_FragColor = vec4(r * a, g * a, b * a, a);} else if (uNoiseType == 1) {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;fig_FragColor = vec4(uColor.rgb * a, a);} else {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);float a1 = filter_val(a, uDensity, false);float a2 = filter_val(a, uDensity, true);if (a1 == 1.0) {a1 *= uSecondaryColor.a;a1 *= sourceValue.a;fig_FragColor = vec4(uSecondaryColor.rgb * a1, a1);} else {a2 *= uColor.a;a2 *= sourceValue.a;fig_FragColor = vec4(uColor.rgb * a2, a2);}}}`,this.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float getBlurredRectangle(vec4 normBlurCoords) {return (integrateTriangle(normBlurCoords.x) -integrateTriangle(normBlurCoords.z)) *(integrateTriangle(normBlurCoords.y) -integrateTriangle(normBlurCoords.w));}float roundedRectangleBlur1D(float primCoord, float perpCoord,float cornerRadius, float primHalfSize,float perpHalfSize) {float delta = min(perpHalfSize - cornerRadius - abs(perpCoord), 0.0);float roundRectEdgePos =primHalfSize - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - delta * delta));vec2 relativeToLowerAndUpper =vec2(primCoord + roundRectEdgePos, primCoord - roundRectEdgePos);return integrateTriangle(relativeToLowerAndUpper.x) -integrateTriangle(relativeToLowerAndUpper.y);}float roundedRectangleBlurVert(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(y, x, cornerRadius, halfSize.y, halfSize.x);}float roundedRectangleBlurHoriz(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(x, y, cornerRadius, halfSize.x, halfSize.y);}float getBlurredRoundedRectangle(vec2 normCenterBlurPos,vec2 halfSizeOverBlurRadius,float cornerRadiusOverBlurRadius) {const int NUM_SAMPLES = 4;float weightSum = 0.0;float result = 0.0;float low = 0.0;float high = 0.0;float start = 0.0;float end = 0.0;float step = 0.0;float currentWeight = 0.0;if (abs(normCenterBlurPos.x) > abs(normCenterBlurPos.y)) {low = normCenterBlurPos.y - halfSizeOverBlurRadius.y;high = normCenterBlurPos.y + halfSizeOverBlurRadius.y;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float y = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(y);result += roundedRectangleBlurHoriz(normCenterBlurPos.x, normCenterBlurPos.y - y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;} else {low = normCenterBlurPos.x - halfSizeOverBlurRadius.x;high = normCenterBlurPos.x + halfSizeOverBlurRadius.x;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float x = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(x);result += roundedRectangleBlurVert(normCenterBlurPos.x - x, normCenterBlurPos.y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;x += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;}}uniform vec4 uColor;in vec4 vCoord4;out vec4 fig_FragColor;void main() {float alpha = getBlurredRectangle(vCoord4);fig_FragColor = ditherColor(uColor * alpha);}`,this.SHADER_SOURCE_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;in vec2 aPosition2;out vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.SHADER_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec4 vPosition4;out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;fig_FragColor = texture(texture0, uv);}`,this.SHADER_SOURCE_RENDER_DEVICE_FRAME_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.SHADER_SOURCE_RENDER_HOTSPOT_FRAGMENT=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;in vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 && rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {fig_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {fig_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {fig_FragColor = vec4(0.0);}}`,this.SHADER_SOURCE_RENDER_HOTSPOT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float getBlurredRectangle(vec4 normBlurCoords) {return (integrateTriangle(normBlurCoords.x) -integrateTriangle(normBlurCoords.z)) *(integrateTriangle(normBlurCoords.y) -integrateTriangle(normBlurCoords.w));}float roundedRectangleBlur1D(float primCoord, float perpCoord,float cornerRadius, float primHalfSize,float perpHalfSize) {float delta = min(perpHalfSize - cornerRadius - abs(perpCoord), 0.0);float roundRectEdgePos =primHalfSize - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - delta * delta));vec2 relativeToLowerAndUpper =vec2(primCoord + roundRectEdgePos, primCoord - roundRectEdgePos);return integrateTriangle(relativeToLowerAndUpper.x) -integrateTriangle(relativeToLowerAndUpper.y);}float roundedRectangleBlurVert(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(y, x, cornerRadius, halfSize.y, halfSize.x);}float roundedRectangleBlurHoriz(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(x, y, cornerRadius, halfSize.x, halfSize.y);}float getBlurredRoundedRectangle(vec2 normCenterBlurPos,vec2 halfSizeOverBlurRadius,float cornerRadiusOverBlurRadius) {const int NUM_SAMPLES = 4;float weightSum = 0.0;float result = 0.0;float low = 0.0;float high = 0.0;float start = 0.0;float end = 0.0;float step = 0.0;float currentWeight = 0.0;if (abs(normCenterBlurPos.x) > abs(normCenterBlurPos.y)) {low = normCenterBlurPos.y - halfSizeOverBlurRadius.y;high = normCenterBlurPos.y + halfSizeOverBlurRadius.y;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float y = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(y);result += roundedRectangleBlurHoriz(normCenterBlurPos.x, normCenterBlurPos.y - y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;} else {low = normCenterBlurPos.x - halfSizeOverBlurRadius.x;high = normCenterBlurPos.x + halfSizeOverBlurRadius.x;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float x = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(x);result += roundedRectangleBlurVert(normCenterBlurPos.x - x, normCenterBlurPos.y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;x += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;}}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float alpha;if (all(lessThan(abs(vCoord2),uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius +1.0 )))) {alpha = 1.0;} else {alpha = getBlurredRoundedRectangle(vCoord2, uHalfSizeOverBlurRadius,uCornerRadiusOverBlurRadius);}fig_FragColor = ditherColor(uColor * alpha);}`,this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.SHADER_SOURCE_SMOOTH_PATH_FRAGMENT=`#version 300 es
precision highp float;in vec2 vCoord2;in vec4 vCoord4;out vec4 fig_FragColor;void main() { fig_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y)); }`,this.SHADER_SOURCE_SMOOTH_PATH_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aCoord4;in vec4 aPosition4;out vec2 vCoord2;out vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uColor;out vec4 fig_FragColor;void main() { fig_FragColor = uColor * uOpacity; }`,this.SHADER_SOURCE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform int tileAtlasTileSize;in vec2 vCoord2;out vec4 fig_FragColor;void main() {int SSAA_4X4_DIMENSION = tileAtlasTileSize * 4;float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);vec4 downsampledColor =0.25 * (texture(texture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));fig_FragColor = downsampledColor * uOpacity;}`,this.SHADER_SOURCE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}`,this.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vCoord2;out vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float weight = uCount;vec4 result = texture(texture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture(texture0, coord_neg) + texture(texture0, coord_pos));total += 2.0 * weightSum;}fig_FragColor = result / total;}`,this.SHADER_SOURCE_UNCLAMPED_GRADIENT_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;in vec2 _coord2;in vec2 _coord2Source;out vec4 fig_FragColor;void main() {vec2 coord2 = _coord2;vec2 coord2Source = _coord2Source;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;float weight0_neg = (radius - t0);float weight0_pos = (radius - t0);float weight1_neg = (radius - t1);float weight1_pos = (radius - t1);if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}fig_FragColor = result / total;}`,this.SHADER_SOURCE_UNCLAMPED_GRAIN_FRAGMENT=`#version 300 es
precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;in vec2 vCoord2; out vec4 fig_FragColor;uniform float radiusInPixelSpace;uniform float scale;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {fig_FragColor = vec4(0.0, 0.0, 1.0, 1.0);vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 destTexel = texture(texture0, expandedRegionSamplingPoint);fig_FragColor = destTexel;}`,this.SHADER_SOURCE_UPSAMPLE_AND_BLEND_GRADIENT_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}uniform sampler2D texture0;uniform sampler2D texture1;uniform float startCount;uniform float endCount;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform float scaleToUnadjust;in vec2 _coord2;in vec2 _coord2Source;out vec4 fig_FragColor;void main() {float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;vec2 centerUnadjustedSamplePoint =((((_coord2Source.xy - 0.5) * 2.0) / scaleToUnadjust) + 1.0) / 2.0;if (radius < 1.0) {fig_FragColor = texture(texture1, centerUnadjustedSamplePoint);} else {float weightCenter = radius * radius;float weightBlur =(((radius - 1.0) * (radius - 1.0)) + (2.0 * (radius - 1.0)));weightBlur = weightBlur * 2.0; weightBlur = weightBlur * weightBlur;fig_FragColor =(weightBlur * texture(texture0, _coord2) +weightCenter * texture(texture1, centerUnadjustedSamplePoint)) /(weightBlur + weightCenter);}}`,this.SHADER_SOURCE_UPSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = ditherColor(texture(texture0, vCoord2)); }`,this.SHADER_SOURCE_UPSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`):(this.SHADER_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);gl_FragColor =ditherColor(texture2D(texture0, coord) * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;uniform int premultiplyBeforeMSAA;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA_premultiplied();gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA_premultiplied_adjusted();gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped =mix(texture2D(texture0, coord), texture2D(texture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}vec4 sampleImagePaintBWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA_premultiplied();vec4 imageB = sampleImagePaintBWithMSAA_premultiplied();vec4 lerped = mix(imageA, imageB, uProgress);gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample +AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultiplied(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}vec4 sampleImagePaintAWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImagePremultipliedAdjusted(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA_premultiplied() {return (sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample +AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultiplied(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}vec4 sampleImagePaintBWithMSAA_premultiplied_adjusted() {return (sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImagePremultipliedAdjusted(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA_premultiplied_adjusted();vec4 imageB = sampleImagePaintBWithMSAA_premultiplied_adjusted();vec4 lerped = mix(imageA, imageB, uProgress);gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;varying vec2 vPaintASample;varying vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;varying vec2 vNodeSpacePoint;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);gl_FragColor = uColor * uOpacity * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vPaintASample;varying vec2 vStepA;varying vec2 vPaintBSample;varying vec2 vStepB;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB =(uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;float minv3(vec3 c) { return min(min(c.r, c.g), c.b); }float maxv3(vec3 c) { return max(max(c.r, c.g), c.b); }float satv3(vec3 c) { return maxv3(c) - minv3(c); }float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {cbase = clamp(cbase, 0.0, 1.0);clum = clamp(clum, 0.0, 1.0);float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}void main() {const int DARKEN = 2;const int MULTIPLY = 3;const int LINEAR_BURN = 4;const int COLOR_BURN = 5;const int LIGHTEN = 6;const int SCREEN = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture2D(texture0, vCoord2) * uOpacity;vec4 target = texture2D(texture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {gl_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca), 2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca, Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0)Sc /= Sa;if (Da > 0.0)Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}gl_FragColor = vec4(color, Sa + Da - Sa * Da);}}",this.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2) * uOpacity; }",this.SHADER_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture2D(texture0, coord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg =(uCount - t0) *float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos =(uCount - t0) *float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg =(uCount - t1) *float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos =(uCount - t1) *float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg =(coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos =(coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result += texture2D(texture0, coord_neg) * weight_neg +texture2D(texture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}gl_FragColor = result / total;}",this.SHADER_SOURCE_CLAMPED_GRADIENT_BLUR_TILE_FRAGMENT="precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec4 blurClamp;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;varying vec2 _coord2;varying vec2 _coord2Source;void main() {vec2 coord2 = _coord2;vec2 coord2Source = clamp(_coord2Source, blurClamp.xy, blurClamp.zw);float coord2_x_scaling = coord2Source.x / _coord2Source.x;float coord2_y_scaling = coord2Source.y / _coord2Source.y;coord2.x = coord2.x * coord2_x_scaling;coord2.y = coord2.y * coord2_y_scaling;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;vec2 coord2Source_coord0_neg = coord2Source - blurDelta * t0;vec2 coord2Source_coord0_pos = coord2Source + blurDelta * t0;vec2 coord2Source_coord1_neg = coord2Source - blurDelta * t1;vec2 coord2Source_coord1_pos = coord2Source + blurDelta * t1;float weight0_neg =(radius - t0) *float(coord2Source_coord0_neg ==clamp(coord2Source_coord0_neg, blurClamp.xy, blurClamp.zw));float weight0_pos =(radius - t0) *float(coord2Source_coord0_pos ==clamp(coord2Source_coord0_pos, blurClamp.xy, blurClamp.zw));float weight1_neg =(radius - t1) *float(coord2Source_coord1_neg ==clamp(coord2Source_coord1_neg, blurClamp.xy, blurClamp.zw));float weight1_pos =(radius - t1) *float(coord2Source_coord1_pos ==clamp(coord2Source_coord1_pos, blurClamp.xy, blurClamp.zw));if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture2D(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture2D(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture2D(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture2D(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture2D(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture2D(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}gl_FragColor = result / total;}",this.SHADER_SOURCE_CLAMPED_GRAIN_FRAGMENT="precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;uniform float radiusInPixelSpace;uniform float scale;uniform vec2 nodeSize;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 untransformedSamplingPoint = vCoord2;vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 sourceTexel = texture2D(texture1, untransformedSamplingPoint);vec4 destTexel = texture2D(texture0, expandedRegionSamplingPoint);float fixedAmountScaling = pow(sourceTexel.a, 0.2) * pow(destTexel.a, 0.2);vec2 samplingPointAlphaAdjusted =nodeSpacePixelPoint + amt * radiusInPixelSpace * fixedAmountScaling;vec2 finalSamplingPointAlphaAdjusted =(nodeToTileSpace * vec3(samplingPointAlphaAdjusted, 1.0)).xy;vec2 expandedRegionSamplingPointAlphaAdjusted =((((finalSamplingPointAlphaAdjusted - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 fixedDestTexel =texture2D(texture0, expandedRegionSamplingPointAlphaAdjusted);if (sourceTexel.a > 0.0 && fixedDestTexel.a > 0.0) {gl_FragColor = fixedDestTexel;} else {gl_FragColor = sourceTexel;}}",this.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}",this.SHADER_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;void main() { gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1); }",this.SHADER_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2); }",this.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}",this.SHADER_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D texture0;varying vec2 vCoord2;const bool drawDebugStuff = false;void main() {vec2 sampleCoordinates =clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);gl_FragColor = texture2D(texture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) /(uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) -0.5);float t = max(tt.x, tt.y);if (t > 0.99) {gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}",this.SHADER_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform *vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0, 1);}",this.SHADER_SOURCE_GLASS_FRAGMENT="precision highp float;float sdBox(vec2 p, vec2 halfSize) {vec2 d = abs(p) - halfSize;return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);}float sdRoundBox(vec2 p, vec2 halfSize, float cornerRadius) {float rn = min(cornerRadius, min(halfSize.x, halfSize.y));return sdBox(p, halfSize - rn) - rn;}float sdRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 rs) {float d = -9999999.0;vec2 size = halfSize * 2.0;d = max(d, sdRoundBox(p * vec2(1.0, 1.0) + halfSize, size, rs.x));d = max(d, sdRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, rs.y));d = max(d, sdRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, rs.z));d = max(d, sdRoundBox(p * vec2(1.0, -1.0) + halfSize, size, rs.w));return d;}mat2 rot(float t) {float cosT = cos(t);float sinT = sin(t);return mat2(cosT, -sinT, sinT, cosT);}const int NUM_NEWTON_ITERATIONS =2; const int NUM_NEWTON_START_POINTS =3; const float NEWTON_DAMPING_FACTOR = 1.0; int solveCubic(float a, float b, float c, out vec3 roots) {float p = b - a * a / 3.0;float q = a * (2.0 * a * a - 9.0 * b) / 27.0 + c;float p3 = p * p * p;float discriminant = q * q + 4.0 * p3 / 27.0;float offset = -a / 3.0; if (discriminant >= 0.0) {float z = sqrt(discriminant);float u = (-q + z) / 2.0;float v = (-q - z) / 2.0;u = sign(u) * pow(abs(u), 1.0 / 3.0);v = sign(v) * pow(abs(v), 1.0 / 3.0);roots[0] = offset + u + v;float f = ((roots[0] + a) * roots[0] + b) * roots[0] + c; float f1 = (3. * roots[0] + 2. * a) * roots[0] + b;       roots[0] -= f / f1; return 1; }float u = sqrt(-p / 3.0);float v = acos(-sqrt(-27.0 / p3) * q / 2.0) / 3.0;float m = cos(v), n = sin(v) * 1.732050808; roots[0] = offset + u * (m + m); roots[1] = offset - u * (n + m); roots[2] = offset + u * (n - m); vec3 f = ((roots + a) * roots + b) * roots + c; vec3 f1 = (3.0 * roots + 2.0 * a) * roots + b;  roots -= f / f1;                                return 3; }float cubicBezierSign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {float cu = (-p0.y + 3.0 * p1.y - 3.0 * p2.y + p3.y); float qu = (3.0 * p0.y - 6.0 * p1.y + 3.0 * p2.y);   float li = (-3.0 * p0.y + 3.0 * p1.y);               float co = p0.y - uv.y; vec3 roots;int numRoots = solveCubic(qu / cu, li / cu, co / cu, roots);int numIntersections = 0;for (int i = 0; i < 3; i++) {if (i < numRoots) {if (roots[i] >= 0.0 && roots[i] <= 1.0) {float t = roots[i];float xPos = ((((-p0.x + 3. * p1.x - 3. * p2.x + p3.x) * t +(3. * p0.x - 6. * p1.x + 3. * p2.x)) *t) +(-3. * p0.x + 3. * p1.x)) *t +p0.x;if (xPos < uv.x) {numIntersections++;}}}}vec2 tangStart = p0.xy - p1.xy;vec2 tangEnd = p2.xy - p3.xy;vec2 normStart = vec2(tangStart.y, -tangStart.x);vec2 normEnd = vec2(tangEnd.y, -tangEnd.x);if (p0.y < p1.y) {if ((uv.y <= p0.y) && (dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}} else {if (!(uv.y <= p0.y) && !(dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}}if (p2.y < p3.y) {if (!(uv.y <= p3.y) && dot(uv - p3.xy, normEnd) < 0.0) {numIntersections++;}} else {if ((uv.y <= p3.y) && !(dot(uv - p3.xy, normEnd) < 0.0)) {numIntersections++;}}if (numIntersections == 0 || numIntersections == 2 || numIntersections == 4) {return 1.0; } else {return -1.0; }}float cubicBezierNormalIteration(float t, vec2 a0, vec2 a1, vec2 a2, vec2 a3) {vec2 a_2 = a2 + t * a3;  vec2 a_1 = a1 + t * a_2; vec2 b_2 = a_2 + t * a3; vec2 uvToP =a0 + t * a_1; vec2 tang = a_1 + t * b_2; float tanLenSq =dot(tang, tang); float projection = dot(tang, uvToP); return t - NEWTON_DAMPING_FACTOR * projection / tanLenSq;}float cubicBezierDistApproxSq(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {vec2 a3 = (-p0 + 3.0 * p1 - 3.0 * p2 + p3); vec2 a2 = (3.0 * p0 - 6.0 * p1 + 3.0 * p2); vec2 a1 = (-3.0 * p0 + 3.0 * p1);           vec2 a0 = p0 - uv; float d0 = 1.0e38; float t0 = 0.;     float t;           for (int i = 0; i < NUM_NEWTON_START_POINTS; i++) {t = t0; for (int j = 0; j < NUM_NEWTON_ITERATIONS; j++) {t = cubicBezierNormalIteration(t, a0, a1, a2, a3);}t = clamp(t, 0.0, 1.0);vec2 uvToP = ((a3 * t + a2) * t + a1) * t + a0;d0 = min(d0, dot(uvToP, uvToP)); t0 += 1. / float(NUM_NEWTON_START_POINTS - 1);}return d0; }float cubicBezierDistApprox(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {return sqrt(cubicBezierDistApproxSq(uv, p0, p1, p2, p3));}float sdSmoothRoundCorner(vec2 uv, float radius, float smoothing) {float PI = 3.14159265359;float HALF_PI = PI * 0.5;float SQRT_2 = 1.41421356237;float bezAngle = 0.5 * HALF_PI * smoothing;float arcAngle = HALF_PI * (1.0 - smoothing);float requiredEdgeLength = (1.0 + smoothing) * radius;float dOverC = tan(bezAngle);float l = sin(arcAngle * 0.5) * radius * SQRT_2;float c = radius * tan(bezAngle * 0.5) * cos(bezAngle);float d = c * dOverC;float b = ((requiredEdgeLength - l) - (1.0 + dOverC) * c) / 3.0;float a = 2.0 * b;uv = rot(PI * -0.25) * uv;uv.x = -abs(uv.x);vec2 cp = uv + vec2(0.0, 1.414213) * radius;float angle = atan(cp.x, cp.y);uv = rot(PI * 0.25) * uv;vec2 p0 = vec2(-requiredEdgeLength, 0.0);vec2 p1 = p0 + vec2(a, 0.0);vec2 p2 = p1 + vec2(b, 0.0);vec2 p3 = p2 + vec2(c, -d);vec2 cornerCenter = uv + requiredEdgeLength;if (cornerCenter.x < 0.0) {return cornerCenter.y - requiredEdgeLength;} else if (abs(angle) < arcAngle * 0.5) {return length(cp) - radius;}float dis = cubicBezierDistApprox(uv, p0, p1, p2, p3);float sgn = -cubicBezierSign(uv, p0, p1, p2, p3);return dis * sgn;}float sdSmoothRoundBox(vec2 uv, vec2 halfSize, float radius, float smoothing) {if (radius <= 1e-6) {return sdBox(uv, halfSize);}float minHalfSize = min(halfSize.x, halfSize.y);float requiredLength = radius * (1.0 + smoothing);float overlap = max(0.0, requiredLength - minHalfSize) / radius;float finalSmoothing = max(0.0, smoothing - overlap);float finalRadius = min(minHalfSize, radius);if (finalSmoothing <= 1e-6) {return sdRoundBox(uv, halfSize, finalRadius);}vec2 p = abs(uv) - halfSize;return sdSmoothRoundCorner(p, finalRadius, finalSmoothing);}float sdSmoothRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 radii,vec4 smoothings) {float d = sdBox(p, halfSize);vec2 size = halfSize * 2.0;d = max(d, sdSmoothRoundBox(p * vec2(1.0, 1.0) + halfSize, size, radii.x,smoothings.x));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, radii.y,smoothings.y));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, radii.z,smoothings.z));d = max(d, sdSmoothRoundBox(p * vec2(1.0, -1.0) + halfSize, size, radii.w,smoothings.w));return d;}const float HALF_PI = 1.57079632679;uniform sampler2D texture0;varying vec2 vCoord2;uniform float cornerRadiusInPixelSpace;uniform float cornerSmoothing;uniform float scale;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform float reflRadiusInPixelSpace;uniform float refractionIntensity;uniform float refractionDistance;uniform float lightIntensity;uniform float lightAngle;uniform float bevelSize;uniform float chromaticAberration;uniform vec4 tintColor;float linearstep(float a, float b, float t) {return clamp((t - a) / max(0.00001, b - a), 0.0, 1.0);}vec2 nodeSpaceToExpandedTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;vec2 expandedRegionSourceSamplingPoint =((((tileSpacePosition - 0.5) * 2.0) * scale) / 2.0) + 0.5;return expandedRegionSourceSamplingPoint;}vec2 nodeSpaceToStandardTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;return tileSpacePosition;}vec4 getRefractedTexture(vec2 p) {vec2 finalSamplingPositionInTileSpace =nodeSpaceToExpandedTileSpacePosition(p);return texture2D(texture0, finalSamplingPositionInTileSpace);}vec4 getRefractedTextureWithChromaticAberration(vec2 p, vec2 refrDir,float chromaAmt) {const int CHROMA_KERNEL_SIZE = 8;vec4 chromaBlurredColor = vec4(0.0, 0.0, 0.0, 0.0);float invKernelSize = 1.0 / float(CHROMA_KERNEL_SIZE - 1);float sum = 0.0;for (int i = 0; i < CHROMA_KERNEL_SIZE; i++) {float fi = float(i) * invKernelSize - 0.5; float window = 1.0 - abs(fi * 2.0);        vec4 red = getRefractedTexture(p + (fi + 0.5) * chromaAmt * refrDir);vec4 green = getRefractedTexture(p + fi * chromaAmt * refrDir);vec4 blue = getRefractedTexture(p + (fi - 0.5) * chromaAmt * refrDir);float alpha = max(max(red.a, green.a), blue.a);chromaBlurredColor += vec4(red.r, green.g, blue.b, alpha) * window;sum += window;}return chromaBlurredColor / sum;}vec2 getGlassRectNormal(vec2 p, vec2 halfSize, float cornerRad) {float r = min(min(halfSize.x, halfSize.y), cornerRad);vec2 d = abs(p) - (halfSize - r);bool isFlat = max(d.x, d.y) <= -bevelSize * step(cornerRad, bevelSize);if (isFlat) {return vec2(0.0, 0.0);} else {return normalize(d + max(-min(d.x, d.y), 0.0)) * sign(p);}}vec2 getGlassRectRefractionDir(vec2 p, vec2 halfSize, float cornerRad,float refractionDistance) {return getGlassRectNormal(p, halfSize, max(cornerRad, refractionDistance));}void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;vec2 boundsSize = nodeSpaceCenterPoint * 2.0;vec2 halfBoundsSize = boundsSize * 0.5;float minHalfSize = min(halfBoundsSize.x, halfBoundsSize.y);vec2 boundsCenter = nodeSpaceCenterPoint;vec2 pBox = nodeSpacePixelPoint - nodeSpaceCenterPoint;float boxDist = sdSmoothRoundBox(pBox, halfBoundsSize,cornerRadiusInPixelSpace, cornerSmoothing);float BEVEL_SIZE = bevelSize;float BEVEL_REFRACTION_MULT = 0.2; float REFRACTION_STRENGTH = refractionIntensity;float refractionDistance = min(minHalfSize, refractionDistance);float refrArea =linearstep(-refractionDistance - bevelSize, -bevelSize, boxDist);float refrMult = pow(refrArea, 3.5) * refractionDistance;float maxRefrOffset = 0.999 * refractionDistance;float dishRefrOffset =clamp(refrMult * REFRACTION_STRENGTH, -maxRefrOffset, maxRefrOffset);float bevelRefrOffset =REFRACTION_STRENGTH * BEVEL_REFRACTION_MULT * maxRefrOffset;float isBevel = linearstep(-bevelSize - 0.0001, -bevelSize * 0.3, boxDist);vec2 glassNormal = getGlassRectRefractionDir(pBox, halfBoundsSize, cornerRadiusInPixelSpace, refractionDistance);vec2 refrDir = -glassNormal * mix(dishRefrOffset, bevelRefrOffset, isBevel);vec2 p = nodeSpacePixelPoint;vec4 col = vec4(0.0);p += refrDir;if (chromaticAberration < 0.001) {col = getRefractedTexture(p);} else {col = getRefractedTextureWithChromaticAberration(p, refrDir,chromaticAberration);}col = col * (1.0 - tintColor.a) + tintColor;float LIGHT_INTENSITY = lightIntensity;float SPECULAR_HARDNESS = 0.2;float halfSpecThk = BEVEL_SIZE * 0.5;float rim =smoothstep(-BEVEL_SIZE - 0.001, -BEVEL_SIZE * SPECULAR_HARDNESS, boxDist);float frameRot =atan(nodeToTileSpace[1][0],nodeToTileSpace[0][0]); float SPECULAR_FALLOFF = 0.35;   float BOTTOM_LIGHT_MULT = 0.6;float specularAngle = lightAngle + frameRot + HALF_PI;vec2 specularNormal =getGlassRectNormal(pBox, halfBoundsSize, cornerRadiusInPixelSpace);vec2 lightDir = vec2(cos(specularAngle), sin(specularAngle));col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, -lightDir)) *rim * LIGHT_INTENSITY;col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, lightDir)) *rim * LIGHT_INTENSITY * BOTTOM_LIGHT_MULT;float DISH_SHADE_STRENGTH = 0.05;float shadeSize = refractionDistance;float shadeMult =pow(linearstep(-shadeSize, -BEVEL_SIZE + 0.0001, boxDist), 2.0);float shadeAmt = dot(glassNormal, lightDir);col.xyz += shadeAmt * shadeMult * DISH_SHADE_STRENGTH * LIGHT_INTENSITY;gl_FragColor = col;}",this.SHADER_SOURCE_GLASS_NON_UNIFORM_CORNER_RADII_FRAGMENT="precision highp float;float sdBox(vec2 p, vec2 halfSize) {vec2 d = abs(p) - halfSize;return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);}float sdRoundBox(vec2 p, vec2 halfSize, float cornerRadius) {float rn = min(cornerRadius, min(halfSize.x, halfSize.y));return sdBox(p, halfSize - rn) - rn;}float sdRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 rs) {float d = -9999999.0;vec2 size = halfSize * 2.0;d = max(d, sdRoundBox(p * vec2(1.0, 1.0) + halfSize, size, rs.x));d = max(d, sdRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, rs.y));d = max(d, sdRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, rs.z));d = max(d, sdRoundBox(p * vec2(1.0, -1.0) + halfSize, size, rs.w));return d;}mat2 rot(float t) {float cosT = cos(t);float sinT = sin(t);return mat2(cosT, -sinT, sinT, cosT);}const int NUM_NEWTON_ITERATIONS =2; const int NUM_NEWTON_START_POINTS =3; const float NEWTON_DAMPING_FACTOR = 1.0; int solveCubic(float a, float b, float c, out vec3 roots) {float p = b - a * a / 3.0;float q = a * (2.0 * a * a - 9.0 * b) / 27.0 + c;float p3 = p * p * p;float discriminant = q * q + 4.0 * p3 / 27.0;float offset = -a / 3.0; if (discriminant >= 0.0) {float z = sqrt(discriminant);float u = (-q + z) / 2.0;float v = (-q - z) / 2.0;u = sign(u) * pow(abs(u), 1.0 / 3.0);v = sign(v) * pow(abs(v), 1.0 / 3.0);roots[0] = offset + u + v;float f = ((roots[0] + a) * roots[0] + b) * roots[0] + c; float f1 = (3. * roots[0] + 2. * a) * roots[0] + b;       roots[0] -= f / f1; return 1; }float u = sqrt(-p / 3.0);float v = acos(-sqrt(-27.0 / p3) * q / 2.0) / 3.0;float m = cos(v), n = sin(v) * 1.732050808; roots[0] = offset + u * (m + m); roots[1] = offset - u * (n + m); roots[2] = offset + u * (n - m); vec3 f = ((roots + a) * roots + b) * roots + c; vec3 f1 = (3.0 * roots + 2.0 * a) * roots + b;  roots -= f / f1;                                return 3; }float cubicBezierSign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {float cu = (-p0.y + 3.0 * p1.y - 3.0 * p2.y + p3.y); float qu = (3.0 * p0.y - 6.0 * p1.y + 3.0 * p2.y);   float li = (-3.0 * p0.y + 3.0 * p1.y);               float co = p0.y - uv.y; vec3 roots;int numRoots = solveCubic(qu / cu, li / cu, co / cu, roots);int numIntersections = 0;for (int i = 0; i < 3; i++) {if (i < numRoots) {if (roots[i] >= 0.0 && roots[i] <= 1.0) {float t = roots[i];float xPos = ((((-p0.x + 3. * p1.x - 3. * p2.x + p3.x) * t +(3. * p0.x - 6. * p1.x + 3. * p2.x)) *t) +(-3. * p0.x + 3. * p1.x)) *t +p0.x;if (xPos < uv.x) {numIntersections++;}}}}vec2 tangStart = p0.xy - p1.xy;vec2 tangEnd = p2.xy - p3.xy;vec2 normStart = vec2(tangStart.y, -tangStart.x);vec2 normEnd = vec2(tangEnd.y, -tangEnd.x);if (p0.y < p1.y) {if ((uv.y <= p0.y) && (dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}} else {if (!(uv.y <= p0.y) && !(dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}}if (p2.y < p3.y) {if (!(uv.y <= p3.y) && dot(uv - p3.xy, normEnd) < 0.0) {numIntersections++;}} else {if ((uv.y <= p3.y) && !(dot(uv - p3.xy, normEnd) < 0.0)) {numIntersections++;}}if (numIntersections == 0 || numIntersections == 2 || numIntersections == 4) {return 1.0; } else {return -1.0; }}float cubicBezierNormalIteration(float t, vec2 a0, vec2 a1, vec2 a2, vec2 a3) {vec2 a_2 = a2 + t * a3;  vec2 a_1 = a1 + t * a_2; vec2 b_2 = a_2 + t * a3; vec2 uvToP =a0 + t * a_1; vec2 tang = a_1 + t * b_2; float tanLenSq =dot(tang, tang); float projection = dot(tang, uvToP); return t - NEWTON_DAMPING_FACTOR * projection / tanLenSq;}float cubicBezierDistApproxSq(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {vec2 a3 = (-p0 + 3.0 * p1 - 3.0 * p2 + p3); vec2 a2 = (3.0 * p0 - 6.0 * p1 + 3.0 * p2); vec2 a1 = (-3.0 * p0 + 3.0 * p1);           vec2 a0 = p0 - uv; float d0 = 1.0e38; float t0 = 0.;     float t;           for (int i = 0; i < NUM_NEWTON_START_POINTS; i++) {t = t0; for (int j = 0; j < NUM_NEWTON_ITERATIONS; j++) {t = cubicBezierNormalIteration(t, a0, a1, a2, a3);}t = clamp(t, 0.0, 1.0);vec2 uvToP = ((a3 * t + a2) * t + a1) * t + a0;d0 = min(d0, dot(uvToP, uvToP)); t0 += 1. / float(NUM_NEWTON_START_POINTS - 1);}return d0; }float cubicBezierDistApprox(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {return sqrt(cubicBezierDistApproxSq(uv, p0, p1, p2, p3));}float sdSmoothRoundCorner(vec2 uv, float radius, float smoothing) {float PI = 3.14159265359;float HALF_PI = PI * 0.5;float SQRT_2 = 1.41421356237;float bezAngle = 0.5 * HALF_PI * smoothing;float arcAngle = HALF_PI * (1.0 - smoothing);float requiredEdgeLength = (1.0 + smoothing) * radius;float dOverC = tan(bezAngle);float l = sin(arcAngle * 0.5) * radius * SQRT_2;float c = radius * tan(bezAngle * 0.5) * cos(bezAngle);float d = c * dOverC;float b = ((requiredEdgeLength - l) - (1.0 + dOverC) * c) / 3.0;float a = 2.0 * b;uv = rot(PI * -0.25) * uv;uv.x = -abs(uv.x);vec2 cp = uv + vec2(0.0, 1.414213) * radius;float angle = atan(cp.x, cp.y);uv = rot(PI * 0.25) * uv;vec2 p0 = vec2(-requiredEdgeLength, 0.0);vec2 p1 = p0 + vec2(a, 0.0);vec2 p2 = p1 + vec2(b, 0.0);vec2 p3 = p2 + vec2(c, -d);vec2 cornerCenter = uv + requiredEdgeLength;if (cornerCenter.x < 0.0) {return cornerCenter.y - requiredEdgeLength;} else if (abs(angle) < arcAngle * 0.5) {return length(cp) - radius;}float dis = cubicBezierDistApprox(uv, p0, p1, p2, p3);float sgn = -cubicBezierSign(uv, p0, p1, p2, p3);return dis * sgn;}float sdSmoothRoundBox(vec2 uv, vec2 halfSize, float radius, float smoothing) {if (radius <= 1e-6) {return sdBox(uv, halfSize);}float minHalfSize = min(halfSize.x, halfSize.y);float requiredLength = radius * (1.0 + smoothing);float overlap = max(0.0, requiredLength - minHalfSize) / radius;float finalSmoothing = max(0.0, smoothing - overlap);float finalRadius = min(minHalfSize, radius);if (finalSmoothing <= 1e-6) {return sdRoundBox(uv, halfSize, finalRadius);}vec2 p = abs(uv) - halfSize;return sdSmoothRoundCorner(p, finalRadius, finalSmoothing);}float sdSmoothRoundBoxNonUniform(vec2 p, vec2 halfSize, vec4 radii,vec4 smoothings) {float d = sdBox(p, halfSize);vec2 size = halfSize * 2.0;d = max(d, sdSmoothRoundBox(p * vec2(1.0, 1.0) + halfSize, size, radii.x,smoothings.x));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, 1.0) + halfSize, size, radii.y,smoothings.y));d = max(d, sdSmoothRoundBox(p * vec2(-1.0, -1.0) + halfSize, size, radii.z,smoothings.z));d = max(d, sdSmoothRoundBox(p * vec2(1.0, -1.0) + halfSize, size, radii.w,smoothings.w));return d;}const float HALF_PI = 1.57079632679;uniform sampler2D texture0;varying vec2 vCoord2;uniform vec4 cornerRadii;uniform vec4 cornerSmoothings;uniform int hasUniformCorners;uniform float tileExpansionScale;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform float reflRadiusInPixelSpace;uniform float frameRotation;uniform float refractionIntensity;uniform float refractionDistance;uniform float lightIntensity;uniform float lightAngle;uniform float bevelSize;uniform float chromaticAberration;uniform vec4 tintColor;float linearstep(float a, float b, float t) {return clamp((t - a) / max(0.00001, b - a), 0.0, 1.0);}vec2 nodeSpaceToExpandedTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;vec2 expandedRegionSourceSamplingPoint =(tileSpacePosition - 0.5) * tileExpansionScale + 0.5;return expandedRegionSourceSamplingPoint;}vec2 nodeSpaceToStandardTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;return tileSpacePosition;}vec4 getRefractedTexture(vec2 p) {vec2 finalSamplingPositionInTileSpace =nodeSpaceToExpandedTileSpacePosition(p);return texture2D(texture0, finalSamplingPositionInTileSpace);}vec4 getRefractedTextureWithChromaticAberration(vec2 p, vec2 refrDir,float chromaAmt) {const int CHROMA_KERNEL_SIZE = 8;vec4 chromaBlurredColor = vec4(0.0, 0.0, 0.0, 0.0);float invKernelSize = 1.0 / float(CHROMA_KERNEL_SIZE - 1);float sum = 0.0;for (int i = 0; i < CHROMA_KERNEL_SIZE; i++) {float fi = float(i) * invKernelSize - 0.5; float window = 1.0 - abs(fi * 2.0);        vec4 red = getRefractedTexture(p + (fi + 0.5) * chromaAmt * refrDir);vec4 green = getRefractedTexture(p + fi * chromaAmt * refrDir);vec4 blue = getRefractedTexture(p + (fi - 0.5) * chromaAmt * refrDir);float alpha = max(max(red.a, green.a), blue.a);chromaBlurredColor += vec4(red.r, green.g, blue.b, alpha) * window;sum += window;}return chromaBlurredColor / sum;}float getGlassRectSdf(vec2 p, vec2 halfSize) {if (hasUniformCorners == 1) {return sdSmoothRoundBox(p, halfSize, cornerRadii.x, cornerSmoothings.x);} else {return sdSmoothRoundBoxNonUniform(p, halfSize, cornerRadii,cornerSmoothings);}}vec2 getGlassRectNormal(vec2 p, vec2 halfSize, vec4 radii) {if (hasUniformCorners == 1) {float r = min(min(halfSize.x, halfSize.y), radii.x);vec2 d = abs(p) - (halfSize - r);float isFlat = step(max(d.x, d.y), -bevelSize * step(radii.x, bevelSize));return normalize(d + max(-min(d.x, d.y), 1.0e-5)) * sign(p) *(1.0 - isFlat);} else {float s = 0.1;float d = sdRoundBoxNonUniform(p, halfSize, radii);float dx = sdRoundBoxNonUniform(p + vec2(s, 0.0), halfSize, radii);float dy = sdRoundBoxNonUniform(p + vec2(0.0, s), halfSize, radii);return (vec2(dx, dy) - d) / s;}}vec2 getGlassRectRefractionDir(vec2 p, vec2 halfSize,float refractionDistance) {return getGlassRectNormal(p, halfSize,max(cornerRadii, vec4(refractionDistance)));}void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;vec2 boundsSize = nodeSpaceCenterPoint * 2.0;vec2 halfBoundsSize = boundsSize * 0.5;vec2 boundsCenter = nodeSpaceCenterPoint;vec2 pBox = nodeSpacePixelPoint - nodeSpaceCenterPoint;float boxDist = getGlassRectSdf(pBox, halfBoundsSize);float REFRACTION_CURVE_FACTOR =3.5; float BEVEL_REFRACTION_MULT = 0.2; float refrArea =linearstep(-refractionDistance - bevelSize, -bevelSize, boxDist);float refrMult = pow(refrArea, REFRACTION_CURVE_FACTOR) * refractionDistance;float maxRefrOffset = 0.999 * refractionDistance;float dishRefrOffset =clamp(refrMult * refractionIntensity, -maxRefrOffset, maxRefrOffset);float bevelRefrOffset =refractionIntensity * BEVEL_REFRACTION_MULT * maxRefrOffset;float isBevel = linearstep(-bevelSize - 0.0001, -bevelSize * 0.3, boxDist);vec2 glassNormal = getGlassRectRefractionDir(pBox, halfBoundsSize, max(bevelSize, refractionDistance));vec2 refrDir = -glassNormal * mix(dishRefrOffset, bevelRefrOffset, isBevel);vec2 p = nodeSpacePixelPoint;vec4 col = vec4(0.0);p += refrDir;if (chromaticAberration < 0.001) {col = getRefractedTexture(p);} else {col = getRefractedTextureWithChromaticAberration(p, refrDir,chromaticAberration);}float LIGHT_INTENSITY = lightIntensity;float SPECULAR_HARDNESS = 0.2;float halfSpecThk = bevelSize * 0.5;float rim =smoothstep(-bevelSize - 0.001, -bevelSize * SPECULAR_HARDNESS, boxDist);float SPECULAR_FALLOFF = 0.35; float BOTTOM_LIGHT_MULT = 0.6;float specularAngle = lightAngle - frameRotation + HALF_PI;vec2 specularNormal = getGlassRectNormal(pBox, halfBoundsSize, cornerRadii);vec2 lightDir = vec2(cos(specularAngle), sin(specularAngle));col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, -lightDir)) *rim * LIGHT_INTENSITY;col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, lightDir)) *rim * LIGHT_INTENSITY * BOTTOM_LIGHT_MULT;float DISH_SHADE_STRENGTH = 0.05;float shadeSize = refractionDistance;float shadeMult =pow(linearstep(-shadeSize, -bevelSize + 0.0001, boxDist), 2.0);float shadeAmt = dot(glassNormal, lightDir);col.xyz += shadeAmt * shadeMult * DISH_SHADE_STRENGTH * LIGHT_INTENSITY;gl_FragColor = col;}",this.SHADER_SOURCE_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);gl_FragColor = ditherColor(texture2D(texture0, coord) * uOpacity);}",this.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX="precision highp float;uniform vec4 quad;uniform vec4 source;uniform vec4 blurRangeSource;attribute vec2 position2;varying vec2 _coord2;varying vec2 _coord2Source;void main() {_coord2Source = mix(blurRangeSource.xy, blurRangeSource.zw, position2);_coord2 = mix(source.xy, source.zw, position2);gl_Position = vec4(mix(quad.xy, quad.zw, position2) * 2.0 - 1.0, 0, 1);}",this.SHADER_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = float(texture2D(texture0, vCoord2).a > 0.0) * uColor;}",this.SHADER_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord =lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture2D(texture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture2D(texture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture2D(texture0, upperLeftTexelCoord).a;float upperRightAlpha = texture2D(texture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha = (hardMaskedLowerLeftAlpha * leftWeight +hardMaskedLowerRightAlpha * rightWeight) *bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight +hardMaskedUpperRightAlpha * rightWeight) *topWeight;gl_FragColor = downsampledHardMaskedAlpha * uColor;}",this.SHADER_SOURCE_IMAGE_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb *= color.a;gl_FragColor = color * uOpacity;}",this.SHADER_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity;}",this.SHADER_SOURCE_IMAGE_PATTERN_FRAGMENT="precision highp float;uniform vec2 patternTexSizePixels;uniform vec2 patternBoundsOffsetPixels;uniform float tileSizePixels;uniform vec2 fillSizePixels;uniform vec2 offsetPixels;uniform int patternTileType;uniform sampler2D texture0;varying vec2 vCoord2;void main() {const int RECTANGULAR = 0;const int HORIZONTAL_HEXAGONAL = 1;const int VERTICAL_HEXAGONAL = 2;float xRepeats = fillSizePixels.x / patternTexSizePixels.x;float yRepeats = fillSizePixels.y / patternTexSizePixels.y;vec2 offsetMultiplier = vec2(offsetPixels.x / patternTexSizePixels.x,offsetPixels.y / patternTexSizePixels.y);vec2 coord2 = vec2(vCoord2.x * xRepeats, vCoord2.y * yRepeats);vec2 patternBoundsOffsetUV =vec2(patternBoundsOffsetPixels.x / patternTexSizePixels.x,patternBoundsOffsetPixels.y / patternTexSizePixels.y);coord2 -= offsetMultiplier;coord2 += patternBoundsOffsetUV;if (patternTileType == HORIZONTAL_HEXAGONAL) {coord2.x += (1.0 + step(1., mod(coord2.y, 2.0))) * 0.5;} else if (patternTileType == VERTICAL_HEXAGONAL) {coord2.y += (1.0 + step(1., mod(coord2.x, 2.0))) * 0.5;}coord2 = fract(coord2);vec2 percentage = patternTexSizePixels / tileSizePixels;vec2 clampPercentage = (patternTexSizePixels - 0.5) / tileSizePixels;gl_FragColor = texture2D(texture0, min(coord2 * percentage, clampPercentage));}",this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2); }",this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_VERTEX="precision highp float;uniform mat3 paintTransform;uniform mat3 vertexTransform;attribute vec2 position2;attribute vec3 coord3;varying vec2 vCoord2;void main() {vCoord2 = (paintTransform * coord3).xy;gl_Position = vec4(vertexTransform * vec3(position2, 1), 0).xywz;}",this.SHADER_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped =mix(texture2D(texture0, coord), texture2D(texture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity);}",this.SHADER_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity;}",this.SHADER_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}vec4 sampleImagePremultiplied(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = color.rgb * color.a;return color;}vec4 sampleImagePremultipliedAdjusted(sampler2D tex, vec2 coord) {vec4 color = sampleImage(tex, coord);color.rgb = pipeline(color.rgb);color.rgb = color.rgb * color.a;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity;}",this.SHADER_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 texture0UvSpaceScissor;uniform vec4 texture1UvSpaceScissor;varying vec2 vCoord2;void main() {vec4 texture0Color = all(greaterThan(vCoord2, texture0UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture0UvSpaceScissor.zw))? texture2D(texture0, vCoord2): vec4(0.0);vec4 texture1Color = all(greaterThan(vCoord2, texture1UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture1UvSpaceScissor.zw))? texture2D(texture1, vCoord2): vec4(0.0);gl_FragColor = mix(texture0Color, texture1Color, uOpacity);}",this.SHADER_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 vCoord3;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}",this.SHADER_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_LOOP_BLINN_INSTANCED_VERTEX="mat3 constructInstanceTransform(vec3 instTransform0, vec3 instTransform1) {return mat3(vec3(instTransform0.x, instTransform1.x, 0.0),vec3(instTransform0.y, instTransform1.y, 0.0),vec3(instTransform0.z, instTransform1.z, 1.0));}precision highp float;uniform mat3 canvasSpaceToClipSpaceTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;attribute vec3 instanceTransform0;attribute vec3 instanceTransform1;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;mat3 instanceTransform =constructInstanceTransform(instanceTransform0, instanceTransform1);mat3 vertexTransform = canvasSpaceToClipSpaceTransform * instanceTransform;gl_Position = vec4(vertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {if (texture2D(texture1, vCoord2).a == 0.0) {discard;}gl_FragColor = texture2D(texture0, vCoord2);}",this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = (1.0 - texture2D(texture0, vCoord2).a) *texture2D(texture1, vCoord2).a * uColor;}",this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {float texture1HardMasked = float(texture2D(texture1, vCoord2).a > 0.0);gl_FragColor =(1.0 - texture2D(texture0, vCoord2).a) * texture1HardMasked * uColor;}",this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {gl_FragColor =texture2D(texture0, vCoord2) * float(texture2D(texture1, vCoord2).a == 0.);}",this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {float geometryAlpha = texture2D(texture2, vCoord2).a;gl_FragColor = mix(texture2D(texture1, vCoord2),texture2D(texture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}",this.SHADER_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(texture0, vCoord2) * texture2D(texture1, vCoord2).a;}",this.SHADER_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(texture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor =texture2D(texture0, vCoord2) * luminance * texture2D(texture1, vCoord2).a;}",this.SHADER_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {vec3 rgb = texture2D(texture2, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = mix(texture2D(texture1, vCoord2),texture2D(texture0, vCoord2),texture2D(texture2, vCoord2).a * luminance);}",this.SHADER_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {gl_FragColor = mix(texture2D(texture1, vCoord2), texture2D(texture0, vCoord2),texture2D(texture2, vCoord2).a);}",this.SHADER_SOURCE_NOISE_EFFECT_FRAGMENT="precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;varying vec2 vCoord2;uniform int uNoiseType;uniform float uNoiseSize;uniform mat3 uTileToNodeSpace;uniform float uDensity; uniform vec4 uColor;uniform vec4 uSecondaryColor;uniform vec2 uNodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (uTileToNodeSpace * vec3(vCoord2, 1.0)).xy;float r = roundHelper((turbulence(0 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float g = roundHelper((turbulence(1 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float b = roundHelper((turbulence(2 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float a = roundHelper((turbulence(3 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);vec4 sourceValue = texture2D(texture0, vCoord2);if (uNoiseType == 0) {r = 2.0 * r - 0.5;g = 2.0 * g - 0.5;b = 2.0 * b - 0.5;a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;gl_FragColor = vec4(r * a, g * a, b * a, a);} else if (uNoiseType == 1) {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;gl_FragColor = vec4(uColor.rgb * a, a);} else {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);float a1 = filter_val(a, uDensity, false);float a2 = filter_val(a, uDensity, true);if (a1 == 1.0) {a1 *= uSecondaryColor.a;a1 *= sourceValue.a;gl_FragColor = vec4(uSecondaryColor.rgb * a1, a1);} else {a2 *= uColor.a;a2 *= sourceValue.a;gl_FragColor = vec4(uColor.rgb * a2, a2);}}}",this.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float getBlurredRectangle(vec4 normBlurCoords) {return (integrateTriangle(normBlurCoords.x) -integrateTriangle(normBlurCoords.z)) *(integrateTriangle(normBlurCoords.y) -integrateTriangle(normBlurCoords.w));}float roundedRectangleBlur1D(float primCoord, float perpCoord,float cornerRadius, float primHalfSize,float perpHalfSize) {float delta = min(perpHalfSize - cornerRadius - abs(perpCoord), 0.0);float roundRectEdgePos =primHalfSize - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - delta * delta));vec2 relativeToLowerAndUpper =vec2(primCoord + roundRectEdgePos, primCoord - roundRectEdgePos);return integrateTriangle(relativeToLowerAndUpper.x) -integrateTriangle(relativeToLowerAndUpper.y);}float roundedRectangleBlurVert(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(y, x, cornerRadius, halfSize.y, halfSize.x);}float roundedRectangleBlurHoriz(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(x, y, cornerRadius, halfSize.x, halfSize.y);}float getBlurredRoundedRectangle(vec2 normCenterBlurPos,vec2 halfSizeOverBlurRadius,float cornerRadiusOverBlurRadius) {const int NUM_SAMPLES = 4;float weightSum = 0.0;float result = 0.0;float low = 0.0;float high = 0.0;float start = 0.0;float end = 0.0;float step = 0.0;float currentWeight = 0.0;if (abs(normCenterBlurPos.x) > abs(normCenterBlurPos.y)) {low = normCenterBlurPos.y - halfSizeOverBlurRadius.y;high = normCenterBlurPos.y + halfSizeOverBlurRadius.y;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float y = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(y);result += roundedRectangleBlurHoriz(normCenterBlurPos.x, normCenterBlurPos.y - y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;} else {low = normCenterBlurPos.x - halfSizeOverBlurRadius.x;high = normCenterBlurPos.x + halfSizeOverBlurRadius.x;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float x = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(x);result += roundedRectangleBlurVert(normCenterBlurPos.x - x, normCenterBlurPos.y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;x += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;}}uniform vec4 uColor;varying vec4 vCoord4;void main() {float alpha = getBlurredRectangle(vCoord4);gl_FragColor = ditherColor(uColor * alpha);}",this.SHADER_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;attribute vec2 aPosition2;varying vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.SHADER_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec4 vPosition4;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;gl_FragColor = texture2D(texture0, uv);}",this.SHADER_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.SHADER_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;varying vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 && rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {gl_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {gl_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {gl_FragColor = vec4(0.0);}}",this.SHADER_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float getBlurredRectangle(vec4 normBlurCoords) {return (integrateTriangle(normBlurCoords.x) -integrateTriangle(normBlurCoords.z)) *(integrateTriangle(normBlurCoords.y) -integrateTriangle(normBlurCoords.w));}float roundedRectangleBlur1D(float primCoord, float perpCoord,float cornerRadius, float primHalfSize,float perpHalfSize) {float delta = min(perpHalfSize - cornerRadius - abs(perpCoord), 0.0);float roundRectEdgePos =primHalfSize - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - delta * delta));vec2 relativeToLowerAndUpper =vec2(primCoord + roundRectEdgePos, primCoord - roundRectEdgePos);return integrateTriangle(relativeToLowerAndUpper.x) -integrateTriangle(relativeToLowerAndUpper.y);}float roundedRectangleBlurVert(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(y, x, cornerRadius, halfSize.y, halfSize.x);}float roundedRectangleBlurHoriz(float x, float y, float cornerRadius,vec2 halfSize) {return roundedRectangleBlur1D(x, y, cornerRadius, halfSize.x, halfSize.y);}float getBlurredRoundedRectangle(vec2 normCenterBlurPos,vec2 halfSizeOverBlurRadius,float cornerRadiusOverBlurRadius) {const int NUM_SAMPLES = 4;float weightSum = 0.0;float result = 0.0;float low = 0.0;float high = 0.0;float start = 0.0;float end = 0.0;float step = 0.0;float currentWeight = 0.0;if (abs(normCenterBlurPos.x) > abs(normCenterBlurPos.y)) {low = normCenterBlurPos.y - halfSizeOverBlurRadius.y;high = normCenterBlurPos.y + halfSizeOverBlurRadius.y;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float y = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(y);result += roundedRectangleBlurHoriz(normCenterBlurPos.x, normCenterBlurPos.y - y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;} else {low = normCenterBlurPos.x - halfSizeOverBlurRadius.x;high = normCenterBlurPos.x + halfSizeOverBlurRadius.x;start = clamp(-1.0 , low, high);end = clamp(1.0 , low, high);if (start == end) {return 0.0;}step = (end - start) / float(NUM_SAMPLES);float x = start + step * 0.5;for (int i = 0; i < NUM_SAMPLES; i++) {currentWeight = triangle(x);result += roundedRectangleBlurVert(normCenterBlurPos.x - x, normCenterBlurPos.y,cornerRadiusOverBlurRadius, halfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;x += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;return result * weightNormalizationFactor;}}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;varying vec2 vCoord2;void main() {float alpha;if (all(lessThan(abs(vCoord2),uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius +1.0 )))) {alpha = 1.0;} else {alpha = getBlurredRoundedRectangle(vCoord2, uHalfSizeOverBlurRadius,uCornerRadiusOverBlurRadius);}gl_FragColor = ditherColor(uColor * alpha);}",this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.SHADER_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 vCoord2;varying vec4 vCoord4;void main() { gl_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y)); }",this.SHADER_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aCoord4;attribute vec4 aPosition4;varying vec2 vCoord2;varying vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uColor;void main() { gl_FragColor = uColor * uOpacity; }",this.SHADER_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform int tileAtlasTileSize;varying vec2 vCoord2;void main() {int SSAA_4X4_DIMENSION = tileAtlasTileSize * 4;float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);vec4 downsampledColor =0.25 * (texture2D(texture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));gl_FragColor = downsampledColor * uOpacity;}",this.SHADER_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}",this.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;varying vec2 vCoord2;void main() {float weight = uCount;vec4 result = texture2D(texture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture2D(texture0, coord_neg) + texture2D(texture0, coord_pos));total += 2.0 * weightSum;}gl_FragColor = result / total;}",this.SHADER_SOURCE_UNCLAMPED_GRADIENT_BLUR_TILE_FRAGMENT="precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;varying vec2 _coord2;varying vec2 _coord2Source;void main() {vec2 coord2 = _coord2;vec2 coord2Source = _coord2Source;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;float weight0_neg = (radius - t0);float weight0_pos = (radius - t0);float weight1_neg = (radius - t1);float weight1_pos = (radius - t1);if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture2D(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture2D(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture2D(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture2D(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture2D(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture2D(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}gl_FragColor = result / total;}",this.SHADER_SOURCE_UNCLAMPED_GRAIN_FRAGMENT="precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;varying vec2 vCoord2;uniform float radiusInPixelSpace;uniform float scale;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 destTexel = texture2D(texture0, expandedRegionSamplingPoint);gl_FragColor = destTexel;}",this.SHADER_SOURCE_UPSAMPLE_AND_BLEND_GRADIENT_BLUR_TILE_FRAGMENT="precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}uniform sampler2D texture0;uniform sampler2D texture1;uniform float startCount;uniform float endCount;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform float scaleToUnadjust;varying vec2 _coord2;varying vec2 _coord2Source;void main() {float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;vec2 centerUnadjustedSamplePoint =((((_coord2Source.xy - 0.5) * 2.0) / scaleToUnadjust) + 1.0) / 2.0;if (radius < 1.0) {gl_FragColor = texture2D(texture1, centerUnadjustedSamplePoint);} else {float weightCenter = radius * radius;float weightBlur =(((radius - 1.0) * (radius - 1.0)) + (2.0 * (radius - 1.0)));weightBlur = weightBlur * 2.0; weightBlur = weightBlur * weightBlur;gl_FragColor =(weightBlur * texture2D(texture0, _coord2) +weightCenter * texture2D(texture1, centerUnadjustedSamplePoint)) /(weightBlur + weightCenter);}}",this.SHADER_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = ditherColor(texture2D(texture0, vCoord2)); }",this.SHADER_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}")}static instance(){return t._instance||(t._instance=new t),t._instance}};function op(t,e={},r=null){r||(r=document.createElement("canvas"));let n=null;try{n=t?r.getContext("webgl2",e):r.getContext("webgl",e)}catch{}return n}var qh=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let r=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(r.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${r} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let r=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new ab(e,r))}pushFrame(e){this._markAction(new Xh(0,e))}popFrame(e){this._markAction(new Xh(1,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let r=this._eventsPendingTimestamps[e],n=r.query;if(!this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let o=this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(n);let a=(this._resolvedEvents.length==0?0:le.List_last(this._resolvedEvents).timestamp)+o;this._resolvedEvents.push(new sb(r.action,a)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],r=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let n={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:le.List_last(this._resolvedEvents).timestamp,events:r},o={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[n]},i=new Map,a=c=>(i.has(c)||(i.set(c,e.length),e.push({name:c})),i.get(c)),s="O",l="C";for(let c of this._resolvedEvents)r.push({type:c.action.type==0?s:l,frame:a(c.action.name),at:c.timestamp});return JSON.stringify(o)}};var Xh=class{constructor(e,r){this.type=e,this.name=r}},ab=class{constructor(e,r){this.action=e,this.query=r}},sb=class{constructor(e,r){this.action=e,this.timestamp=r}},Td;(o=>{function t(i,a,s){ip?i.annotateBlock(a,s):s()}o.WebGLRenderingContext_annotateBlock=t;function e(i,a,s){return ip?i.annotateBlock(a,s):s()}o.WebGLRenderingContext_annotateBlockAndReturn=e;function r(i,a,s){ip?i.annotateProfile(a,s):s()}o.WebGLRenderingContext_annotateProfile=r;function n(i,a){return i.TEXTURE0+a}o.WebGLRenderingContext_TEXTURE_N=n})(Td||(Td={}));var ip=!1;function G1(t,e){console.log("WebGL intercepts are enabled. This records all calls.");let r=window.requestAnimationFrame,n=0,o=new qh(e);window.requestAnimationFrame=()=>(n=n+1,o.hasPendingResults()&&o.resolveEventsIfPossible(),r.apply(window,arguments));let i=e,a=t.width,s=t.height,l=n,c=[],d={},u="  ",p=f=>{c.push(u+f)},_=()=>{n!=l&&(l=n,p("yield;"))},h=(f,I)=>{_(),p(`{ // ${f}`);let y=u;u+="  ",o.isRunning()&&o.pushFrame(f);let P=I();return o.isRunning()&&o.popFrame(f),u=y,p("}"),P},g=(f,I)=>{o.isRunning()&&o.pushFrame(f),I(),o.isRunning()&&o.popFrame(f)},m=()=>{let f=`function* render(gl) {

`;f+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let I in d)f+="  var "+I+`s = [];
`;for(let I of c)f+=I+`
`;return f+=`}
`,f},A=(f,I)=>{let y=document.createElement("a");y.href=URL.createObjectURL(new Blob([f],{type:"application/javascript"})),y.download=I??"trace.js",document.body.appendChild(y),y.click(),document.body.removeChild(y)},S=f=>{A(m(),f??"trace.js")},T=()=>{o.start()},R=f=>{o.stop();let I=()=>{o.hasPendingResults()?r(I):A(o.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};I()},b=f=>{if(f instanceof WebGLActiveInfo||f instanceof WebGLBuffer||f instanceof WebGLFramebuffer||f instanceof WebGLProgram||f instanceof WebGLRenderbuffer||f instanceof WebGLShader||f instanceof WebGLShaderPrecisionFormat||f instanceof WebGLTexture||f instanceof WebGLUniformLocation){let I=f.constructor.name,y=I in d?d[I]:d[I]=[],P=y.indexOf(f);return P==-1&&(P=y.length,y.push(f)),I+"s["+P+"]"}return null},O={traceLines:c,compileTrace:m,downloadTrace:S,startProfile:T,stopProfile:R,annotateBlock:h,annotateProfile:g};p(`gl.canvas.width = ${a};`),p(`gl.canvas.height = ${s};`);for(let f in i){let I=i[f];if(typeof I=="function"){let y=((P,E)=>()=>{let C=[];_(),(t.width!=a||t.height!=s)&&(a=t.width,s=t.height,p(`gl.canvas.width = ${a};`),p(`gl.canvas.height = ${s};`));for(let D=0,w=arguments.length;D<w;D=D+1){let k=arguments[D];if(typeof k=="number"||typeof k=="boolean"||typeof k=="string"||Array.isArray(k)||k===null)C.push(JSON.stringify(k));else if(ArrayBuffer.isView(k))C.push(`new ${k.constructor.name}([${Array.prototype.slice.call(k)}])`);else{let z=b(k);z!=null?C.push(z):(console.warn("unsupported value:",k),C.push("null"))}}let B=`gl.${P}(`;for(let D=0,w=C.length;D<w;D=D+1)D!=0&&(B+=", "),B+=C[D];B+=");",o.isRunning()&&P.startsWith("draw")&&o.pushFrame(B);let G=E.apply(i,arguments);o.isRunning()&&P.startsWith("draw")&&o.popFrame(B);let V=b(G);return V!=null&&(B=V+" = "+B),p(B),G})(f,I);O[f]=y}else(y=>{Object.defineProperty(O,y,{set:P=>{i[y]=P},get:()=>i[y]})})(f)}return window.recordingContext=O,O}var Cr;(i=>{function t(a){let s=[];for(let l=0,c=a.length;l<c;l=l+1)s.push(a[l]);return s}i.asList=t;function e(a,s,l){a.addEventListener(s,l)}i.on1=e;function r(a,s,l,c){a.addEventListener(s,l,c)}i.on2=r;function n(a,s,l){a.removeEventListener(s,l)}i.off=n;function o(a){a.preventDefault()}i.preventDefault=o})(Cr||(Cr={}));function ap(t,e={}){let r=op(t,e);return ip?G1(r.canvas,r):r}var jh;(r=>{function t(n){return n.result}r.FileReader_resultAsArrayBuffer=t;function e(n){return n.result}r.FileReader_resultAsString=e})(jh||(jh={}));var sc;(e=>{function t(r){return r&&r.now?r.now():+new Date}e.Performance_now=t})(sc||(sc={}));var Tr;(b=>{function t(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener1=t;function e(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener2=e;function r(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener3=r;function n(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener4=n;function o(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener5=o;function i(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener6=i;function a(O,f,I){Cr.on1(O,f,I)}b.EventTarget_addEventListener7=a;function s(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener8=s;function l(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener9=l;function c(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener10=c;function d(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener11=d;function u(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener12=u;function p(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener13=p;function _(O,f,I,y){Cr.on2(O,f,I,y)}b.EventTarget_addEventListener14=_;function h(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener1=h;function g(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener2=g;function m(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener3=m;function A(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener4=A;function S(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener5=S;function T(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener6=T;function R(O,f,I){Cr.off(O,f,I)}b.EventTarget_removeEventListener7=R})(Tr||(Tr={}));var Zh;(e=>{function t(r){return r.isConnected}e.Node_isConnected=t})(Zh||(Zh={}));var Jh;(e=>{function t(r){let n=r.getBoundingClientRect(),o=n.x+n.width/2,i=n.y+n.height/2;return r.ownerDocument.elementFromPoint(o,i)===r}e.Element_isVisible=t})(Jh||(Jh={}));var Ji;(e=>{function t(r){Cr.preventDefault(r)}e.Event_preventDefault=t})(Ji||(Ji={}));var $h;(r=>{function t(n){return Cr.asList(n.types)}r.DataTransfer_types=t;function e(n){return Cr.asList(n.files)}r.DataTransfer_files=e})($h||($h={}));var U1;(e=>{function t(r){if(typeof r.buttons>"u"){let n=r.which;return n<2?n:n==3?2:4}return r.buttons}e.MouseEvent_buttons=t})(U1||(U1={}));var em;(n=>{function t(o){return Cr.asList(o.touches)}n.TouchEvent_touches=t;function e(o){return Cr.asList(o.targetTouches)}n.TouchEvent_targetTouches=e;function r(o){return Cr.asList(o.changedTouches)}n.TouchEvent_changedTouches=r})(em||(em={}));function Jn(){return self}var N;(H=>{function t(K){return K&255}H.red=t;function e(K){return K>>8&255}H.green=e;function r(K){return K>>16&255}H.blue=r;function n(K){return K>>>24}H.alpha=n;function o(K){return t(K)/255}H.redF=o;function i(K){return e(K)/255}H.greenF=i;function a(K){return r(K)/255}H.blueF=a;function s(K){return n(K)/255}H.alphaF=s;function l(K,j){return T(t(K),e(K),r(K),j)}H.withAlpha=l;function c(K){let j=s(K);return R(o(K)*j,i(K)*j,a(K)*j,j)}H.premultiplied=c;function d(K){let j=s(K);return R(o(K)/j,i(K)/j,a(K)/j,j)}H.unpremultiplied=d;function u(K,j){return K&16777215|O(s(K)*j)<<24}H.multiplyOpacity=u;function p(K){return`Color(${t(K)}, ${e(K)}, ${r(K)}, ${n(K)})`}H.toString=p;function _(K){return n(K)==255}H.isOpaque=_;function h(K){return"#"+P(t(K))+P(e(K))+P(r(K))}H.toCSS=h;function g(K){return{red:o(K),green:i(K),blue:a(K),alpha:s(K)}}H.toColorF=g;function m(K){return{r:t(K),g:e(K),b:r(K),a:n(K)}}H.asInttoJSON=m;function A(K){return{r:o(K),g:i(K),b:a(K),a:s(K)}}H.asFloattoJSON=A;function S(K,j,q){return T(K,j,q,255)}H.new1=S;function T(K,j,q,J){return K|j<<8|q<<16|J<<24}H.new2=T;function R(K,j,q,J){return T(O(K),O(j),O(q),O(J))}H.new3=R;function b(K){return R(K.red,K.green,K.blue,K.alpha)}H.fromColorF=b;function O(K){return K<0?0:K>=1?255:Math.round(K*255)|0}H._clamp=O;function f(K,j,q){return R(o(K)+(o(j)-o(K))*q,i(K)+(i(j)-i(K))*q,a(K)+(a(j)-a(K))*q,s(K)+(s(j)-s(K))*q)}H.mix=f;function I(K,j){let q=s(K),J=s(j),ie=q*(1-J),Ee=ie+J,Ke=ie/Ee,Ve=J/Ee;return R(o(K)*Ke+o(j)*Ve,i(K)*Ke+i(j)*Ve,a(K)*Ke+a(j)*Ve,Ee)}H.blend=I;function y(K,j){return R(o(K)*(1-s(j))+o(j),i(K)*(1-s(j))+i(j),a(K)*(1-s(j))+a(j),s(K)*(1-s(j))+s(j))}H.over=y;function P(K){let j=K.toString(16);return(j.length==1?"0"+j:j).toUpperCase()}H.asCSSComponent=P,H.TRANSPARENT=T(0,0,0,0),H.BLACK=S(0,0,0),H.WHITE=S(255,255,255),H.RED=S(255,0,0),H.GREEN=S(0,255,0),H.BLUE=S(0,0,255),H.YELLOW=S(255,255,0),H.CYAN=S(0,255,255),H.MAGENTA=S(255,0,255)})(N||(N={}));function V2(t){return t==0?4:1}function V1(t){window.testFakeLostContext=()=>{let e=t.getExtension("WEBGL_lose_context");if(e==null)return;e.loseContext();let r=3;setTimeout(()=>{console.log(`waiting ${r} seconds to restore the context...`)},500),setTimeout(()=>{e.restoreContext()},r*1e3)},window.testRealLostContext=()=>{let e=[];for(let r=0;r<32;r=r+1)e.push(ap(U.shouldUseWebGL2()))}}function k1(t){let e=t==null?void 0:t.graphicsCardName();return e!=null&&e.indexOf("SwiftShader")!=-1}var Oa=class{constructor(e,r){this.canvasSize=e,this.webGLDidAdjustCanvasSize=r}};var lb=class{constructor(e,r,n,o,i=!1){this.name=e,this.type=r,this.count=n,this.byteOffset=o,this.isInstanced=i}},bt=class t{constructor(){this._supportsInstancing=!1;this._attributes=[],this._stride=0}supportsInstancing(){return this._supportsInstancing}attributes(){return this._attributes}stride(){return this._stride}add(e,r,n,o=!1){return this._attributes.push(new lb(e,r,n,this._stride,o)),this._stride=this._stride+n*V2(r),o&&(this._supportsInstancing=o),this}static getPositionF2(){return t._POSITION_F2||(t._POSITION_F2=new t().add(Br.instance().SHADER_NAME_A_POSITION2,0,2)),t._POSITION_F2}static getPositionF2CoordF3(){return t._POSITION_F2_COORD_F3||(t._POSITION_F2_COORD_F3=new t().add(Br.instance().SHADER_NAME_A_POSITION2,0,2).add(Br.instance().SHADER_NAME_A_COORD3,0,3)),t._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return t._POSITION_F4_COORD_F4||(t._POSITION_F4_COORD_F4=new t().add(Br.instance().SHADER_NAME_A_POSITION4,0,4).add(Br.instance().SHADER_NAME_A_COORD4,0,4)),t._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return t._POSITION_F4_COORD_B4||(t._POSITION_F4_COORD_B4=new t().add(Br.instance().SHADER_NAME_A_POSITION4,0,4).add(Br.instance().SHADER_NAME_A_COORD4,1,4)),t._POSITION_F4_COORD_B4}static getPositionF4(){return t._POSITION_F4||(t._POSITION_F4=new t().add(Br.instance().SHADER_NAME_A_POSITION4,0,4)),t._POSITION_F4}static getInstanceTransform_F3_F3(){return t._INSTANCETRANSFORM_F3_F3||(t._INSTANCETRANSFORM_F3_F3=new t().add(Br.instance().SHADER_NAME_INSTANCE_TRANSFORM0,0,3,!0).add(Br.instance().SHADER_NAME_INSTANCE_TRANSFORM1,0,3,!0)),t._INSTANCETRANSFORM_F3_F3}},St=class t{constructor(e){this._supportsInstancing=!1;this._vertexFormats=e;for(var r of e)r.supportsInstancing()&&(this._supportsInstancing=!0)}inputs(){return this._vertexFormats}numInputs(){return this._vertexFormats.length}input(e){return this._vertexFormats[e]}supportsInstancing(){return this._supportsInstancing}static getPositionF2(){return t._POSITION_F2||(t._POSITION_F2=new t(new Array(bt.getPositionF2()))),t._POSITION_F2}static getPositionF2CoordF3(){return t._POSITION_F2_COORD_F3||(t._POSITION_F2_COORD_F3=new t(new Array(bt.getPositionF2CoordF3()))),t._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return t._POSITION_F4_COORD_F4||(t._POSITION_F4_COORD_F4=new t(new Array(bt.getPositionF4CoordF4()))),t._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return t._POSITION_F4_COORD_B4||(t._POSITION_F4_COORD_B4=new t(new Array(bt.getPositionF4CoordB4()))),t._POSITION_F4_COORD_B4}static getPositionF4(){return t._POSITION_F4||(t._POSITION_F4=new t(new Array(bt.getPositionF4()))),t._POSITION_F4}static getPositionF2CoordF3_InstanceTransform_F3_F3(){return t._POSITION_F2_COORD_F3_INSTANCETRANSFORM_F3_F3||(t._POSITION_F2_COORD_F3_INSTANCETRANSFORM_F3_F3=new t(new Array(bt.getPositionF2CoordF3(),bt.getInstanceTransform_F3_F3()))),t._POSITION_F2_COORD_F3_INSTANCETRANSFORM_F3_F3}};var Oo=class Oo{constructor(e,r,n,o){this.pixelFormat=e,this.minFilter=r,this.magFilter=n,this.wrap=o}isCompressedFormat(){return lc.PixelFormat_isCompressedFormat(this.pixelFormat)}};Oo.RGBA_LINEAR_CLAMP=new Oo(0,1,1,1),Oo.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new Oo(0,1,0,1),Oo.RGBA_NEAREST_CLAMP=new Oo(0,0,0,1),Oo.RGBA_NEAREST_REPEAT=new Oo(0,0,0,0),Oo.STENCIL=new Oo(1,0,0,1),Oo.ASTC_6X6_NEAREST_CLAMP=new Oo(2,0,0,1),Oo.BC3_NEAREST_CLAMP=new Oo(3,0,0,1);var Fe=Oo,Ed=class{constructor(e,r){this.texture=null,this.uvSpaceRect=null,this.texture=e,this.uvSpaceRect=r}},Fi=class{bufferArea(){var e;return(e=this._bufferArea)!=null&&e.hasBuffer()||(this._bufferArea=this._recreateBufferArea()),this._bufferArea}constructor(e){this._recreateBufferArea=e,this._bufferArea=this._recreateBufferArea()}},rm=(n=>(n[n.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",n[n.WEBGL_BUFFER=1]="WEBGL_BUFFER",n[n.WEBGL_RENDERBUFFER=2]="WEBGL_RENDERBUFFER",n))(rm||{}),tm=class{increment(e,r,n){var l,c;let o=this._vramUsedByTypeAndPurpose.get(e)||new Map,a=(o.get(r)||0)+n;o.set(r,a),this._vramUsedByTypeAndPurpose.has(e)||this._vramUsedByTypeAndPurpose.set(e,o),dn.trackNumber(rm[e]+` (${r})`,a);let s=(c=(l=v())==null?void 0:l.modules())==null?void 0:c.corePerfInfo;switch(e){case 0:{if(!(r in fr))break;let d=r;n>=0?s==null||s.textureMemStatsAlloc(d,n):s==null||s.textureMemStatsFree(d,-n);break}case 1:{let d=r;n>=0?s==null||s.rendererMemStatsAlloc(il.VERTEX_BUFFER,n):s==null||s.rendererMemStatsFree(il.VERTEX_BUFFER,-n);break}case 2:{n>=0?s==null||s.rendererMemStatsAlloc(il.RENDERBUFFER,n):s==null||s.rendererMemStatsFree(il.RENDERBUFFER,-n);break}}}decrement(e,r,n){this.increment(e,r,-n)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}forType(e){if(!this._vramUsedByTypeAndPurpose.has(e))return 0;let r=0,n=this._vramUsedByTypeAndPurpose.get(e);for(let o of n.values())r+=o;return r}total(){let e=0;for(let r of this._vramUsedByTypeAndPurpose.values())for(let n of r.values())e+=n;return e}},ye;(o=>{function t(i,a,s){i.setUniformVec21(a,s.x(),s.y())}o.Material_setUniformVec22=t;function e(i,a,s){i.setUniformVec41(a,N.redF(s),N.greenF(s),N.blueF(s),N.alphaF(s))}o.Material_setUniformVec42=e;function r(i,a,s){i.setUniformVec41(a,s.x(),s.y(),s.x()+s.width(),s.y()+s.height())}o.Material_setUniformVec43=r;function n(i,a,s){i.setUniformMat31(a,s.m00(),s.m01(),s.m02(),s.m10(),s.m11(),s.m12())}o.Material_setUniformMat32=n})(ye||(ye={}));var lc;(r=>{function t(n){switch(n){case 2:case 3:return 3.58/8;case 1:case 0:default:return 4}}r.PixelFormat_byteCount=t;function e(n){switch(n){case 2:case 3:return!0;default:return!1}}r.PixelFormat_isCompressedFormat=e})(lc||(lc={}));var $n;(n=>{function t(o,i,a){o.resize1(i,a,null,!1)}n.Texture_resize2=t;function e(o,i,a,s){o.resize1(i,a,s,!1)}n.Texture_resize3=e;function r(o){return o.width()*o.height()*lc.PixelFormat_byteCount(o.format().pixelFormat)}n.Texture_totalVRAM=r})($n||($n={}));var nm=!0;var Os;(c=>{function t(){let d=op(U.shouldUseWebGL2());if(d==null)return!1;let u=d.canvas;document.body.appendChild(u);let p=d.createProgram();if(p==null)return!1;let _=d.createShader(d.VERTEX_SHADER);if(_==null)return!1;d.shaderSource(_,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),d.compileShader(_),d.attachShader(p,_);let h=d.createShader(d.FRAGMENT_SHADER);if(h==null)return!1;d.shaderSource(h,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),d.compileShader(h),d.attachShader(p,h),d.bindAttribLocation(p,0,"pos"),d.linkProgram(p);let g=d.createBuffer();if(g==null)return!1;d.bindBuffer(d.ARRAY_BUFFER,g);let m=new Float32Array([0,0,1,0,0,1,1,1]);d.bufferData(d.ARRAY_BUFFER,m.length*4,d.DYNAMIC_DRAW),d.bufferSubData(d.ARRAY_BUFFER,0,m),d.enableVertexAttribArray(0),d.vertexAttribPointer(0,2,d.FLOAT,!1,8,0),d.canvas.width=10,d.canvas.height=1;let A=d.createFramebuffer();if(A==null)return!1;d.bindFramebuffer(d.FRAMEBUFFER,A);let S=d.createTexture();if(S==null)return!1;d.bindTexture(d.TEXTURE_2D,S),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,S),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.canvas.width,d.canvas.height,0,d.RGBA,d.UNSIGNED_BYTE,null),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,S,0),d.useProgram(p),d.bindFramebuffer(d.FRAMEBUFFER,A),d.viewport(0,0,d.canvas.width/2|0,d.canvas.height),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,d.canvas.width/2|0,d.canvas.height),d.drawArrays(d.TRIANGLE_STRIP,0,4);let T=new Uint8Array(4);return d.readPixels((d.canvas.width/2|0)+2,0,1,1,d.RGBA,d.UNSIGNED_BYTE,T),document.body.removeChild(u),T[3]!=0}c._featureDetectViewportBug=t;function e(){let d=op(U.shouldUseWebGL2());if(d==null)return!1;let u=d.canvas;document.body.appendChild(u),d.canvas.width=1,d.canvas.height=1;let p=d.createTexture();if(p==null)return!1;d.bindTexture(d.TEXTURE_2D,p),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,p),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.canvas.width,d.canvas.height,0,d.RGBA,d.UNSIGNED_BYTE,null),d.bindTexture(d.TEXTURE_2D,p);let _=d.createFramebuffer();if(_==null)return!1;d.bindFramebuffer(d.FRAMEBUFFER,_),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,p,0);let h=d.createBuffer();if(h==null)return!1;d.bindBuffer(d.ARRAY_BUFFER,h),d.bufferData(d.ARRAY_BUFFER,32,d.DYNAMIC_DRAW),d.bufferSubData(d.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),d.vertexAttribPointer(0,2,d.FLOAT,!1,8,0),d.enableVertexAttribArray(0),d.bindBuffer(d.ARRAY_BUFFER,h);let g=d.createProgram();if(g==null)return!1;let m=d.createShader(d.VERTEX_SHADER);if(m==null)return!1;d.shaderSource(m,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),d.compileShader(m),d.attachShader(g,m);let A=d.createShader(d.FRAGMENT_SHADER);if(A==null)return!1;d.shaderSource(A,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),d.compileShader(A),d.attachShader(g,A),d.linkProgram(g);let S=d.createProgram();if(S==null)return!1;let T=d.createShader(d.VERTEX_SHADER);if(T==null)return!1;d.shaderSource(T,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),d.compileShader(T),d.attachShader(S,T);let R=d.createShader(d.FRAGMENT_SHADER);if(R==null)return!1;d.shaderSource(R,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),d.compileShader(R),d.attachShader(S,R),d.bindAttribLocation(S,0,"pos"),d.linkProgram(S),d.clearColor(1,0,0,1),d.bindFramebuffer(d.FRAMEBUFFER,_),d.useProgram(S),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,null),d.useProgram(g),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,_),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,null),d.useProgram(g),d.drawArrays(d.TRIANGLE_STRIP,0,4);let b=new Uint8Array(4);return d.readPixels(0,0,1,1,d.RGBA,d.UNSIGNED_BYTE,b),document.body.removeChild(u),b[0]!=255}c._featureDetectDrawClearReorderingBug=e;function r(){return c._hasViewportBug==null?(xe("Called hasViewportBug before running feature detection"),!1):c._hasViewportBug.value}c.hasViewportBug=r;function n(){return c._hasDrawClearReorderingBug==null?(xe("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasDrawClearReorderingBug.value}c.hasDrawClearReorderingBug=n;function o(){return c._hasUnexpectedCompositingBug==null?(xe("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasUnexpectedCompositingBug.value}c.hasUnexpectedCompositingBug=o;function i(){c._hasViewportBug=new fe(t()),r()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),c._hasDrawClearReorderingBug=new fe(e()),n()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let d=navigator.userAgent,u=(d.indexOf("iPhone OS 14_0")|0)!=-1,p=(d.indexOf("iPhone OS 14_1")|0)!=-1,_=u||p,h=(d.indexOf("iPad; CPU OS 14_0")|0)!=-1,g=(d.indexOf("iPad; CPU OS 14_1")|0)!=-1,m=h||g,S=(d.indexOf("Version/14")|0)!=-1&&(d.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;c._hasUnexpectedCompositingBug=new fe(_||m||S)}c.detect=i,c._hasViewportBug=null,c._hasDrawClearReorderingBug=null,c._hasUnexpectedCompositingBug=null})(Os||(Os={}));var cc=class cc{static instance(){return cc._instance==null&&(cc._instance=new cc),cc._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e,r){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e,{preload:r}).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}};cc._instance=null;var Vo=cc,sp;(e=>{function t(r){let n=document.getElementById(r.id());return(n==null?void 0:n.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=t})(sp||(sp={}));var F=class t{constructor(e,r){this._x=0,this._y=0,this._x=e,this._y=r}isContainedInSimpleHull(e){let r=0;for(let n=0;n<e.length;n++){let o=e[n],i=e[(n+1)%e.length];if(o.y()<=this.y()&&i.y()>this.y()||o.y()>this.y()&&i.y()<=this.y()){let a=(this.y()-o.y())/(i.y()-o.y());this.x()<o.x()+a*(i.x()-o.x())&&r++}}return r%2!==0}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiplyScalar(e){return new t(this.x()*e,this.y()*e)}multiply(e){return new t(this.x()*e.x(),this.y()*e.y())}addScalar(e){return new t(this.x()+e,this.y()+e)}add(e){return new t(this.x()+e.x(),this.y()+e.y())}negative(){return new t(-this.x(),-this.y())}subtractScalar(e){return new t(this.x()-e,this.y()-e)}subtract(e){return new t(this.x()-e.x(),this.y()-e.y())}divideScalar(e){return new t(this.x()/e,this.y()/e)}divide(e){return new t(this.x()/e.x(),this.y()/e.y())}clone(){return new t(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}floatEquals(e,r=1e-5){return Math.abs(this.x()-e.x())<=r&&Math.abs(this.y()-e.y())<=r}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}maxComponent(){return Math.max(this.x(),this.y())}max(e){return new t(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}minComponent(){return Math.min(this.x(),this.y())}min(e){return new t(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new t(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let r=this.x()-e.x(),n=this.y()-e.y();return r*r+n*n}approximatelyEquals(e,r){return this.squaredDistanceTo(e)<=r*r}mixedWith(e,r){return new t(this.x()+(e.x()-this.x())*r,this.y()+(e.y()-this.y())*r)}flipped(){return new t(this._y,this._x)}mixWith(e,r){this._x+=(e.x()-this.x())*r,this._y+=(e.y()-this.y())*r}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new t(Math.round(this._x),Math.round(this._y))}setTo(e,r){return this._x=e,this._y=r,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new(e=void 0){return e?new t(e.x(),e.y()):new t(0,0)}static cross(e,r){return e.x()*r.y()-e.y()*r.x()}static lerp(e,r,n){return e.multiplyScalar(1-n).add(r.multiplyScalar(n))}static equals_(e,r){return e==null!=(r==null)?!1:e==null?!0:e.equals(r)}},Ae;(s=>{function t(){return F.new()}s.FrozenVector_new1=t;function e(l){return l}s.FrozenVector_new2=e;function r(l){return F.new(l)}s.FrozenVector_new3=r;function n(l,c){return new F(l,c)}s.FrozenVector_new4=n,s.FrozenVector_ZERO=t(),s.FrozenVector_ONE=n(1,1),s.FrozenVector_INFINITY=n(1/0,1/0)})(Ae||(Ae={}));var Fn=class Fn{static fromMinAndMax(e,r,n,o){return new Fn(e,r,n-e,o-r)}static fromRect(e){return new Fn(e.x(),e.y(),e.width(),e.height())}constructor(e,r,n,o){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=r,this._width=n,this._height=o}intersectsLineSegment(e,r){let n=this.left(),o=this.right(),i=this.top(),a=this.bottom(),s=e.x(),l=e.y(),c=r.x(),d=r.y();return this._intersectsLineSegment(s,l,c,d,n,i,n,a)||this._intersectsLineSegment(s,l,c,d,n,a,o,a)||this._intersectsLineSegment(s,l,c,d,o,a,o,i)||this._intersectsLineSegment(s,l,c,d,o,i,n,i)}_intersectsLineSegment(e,r,n,o,i,a,s,l){let c=(i-s)*(r-o)-(a-l)*(e-n);if(Math.abs(c)<1e-10)return!1;let d=((i-e)*(r-o)-(a-r)*(e-n))/c,u=-((i-s)*(a-r)-(a-l)*(i-e))/c;return d>=0&&d<=1&&u>=0&&u<=1}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new Fn(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let r=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),n=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(r*r+n*n)}topLeft(){return new F(this.left(),this.top())}topRight(){return new F(this.right(),this.top())}bottomLeft(){return new F(this.left(),this.bottom())}bottomRight(){return new F(this.right(),this.bottom())}size(){return new F(this.width(),this.height())}center(){return new F(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,r){this._x+=e,this._y+=r}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let r=this.clone();return r.translate2(e),r}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new F(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(Fn.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(Fn.INFINITE)}expandToInts(){let e=Math.floor(this._x),r=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-r,this._x=e,this._y=r}setTo1(e,r,n,o){return this._x=e,this._y=r,this._width=n,this._height=o,this}setTo2(e,r){return this._x=e.x(),this._y=e.y(),this._width=r.x(),this._height=r.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,r){return this.expand2(e,r),this}expand2(e,r){this._x-=e,this._y-=r,this._width+=2*e,this._height+=2*r}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let r=Math.min(this._x,e.x()),n=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-r,this._height=Math.max(this._y+this._height,e.y()+e.height())-n,this._x=r,this._y=n}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(ar.FrozenRect_EMPTY);else{let r=Math.max(this._x,e.x()),n=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-r,this._height=Math.min(this._y+this._height,e.y()+e.height())-n,this._x=r,this._y=n}}round(){let e=Math.round(this._x),r=Math.round(this._y),n=Math.round(this._x+this._width),o=Math.round(this._y+this._height);this._x=e,this._y=r,this._width=n-e,this._height=o-r}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,r){vt.INSTANCE.reset();let n=F.new();for(let o=0;o<4;o=o+1)n.setTo(this._x+this._width*(o&1),this._y+this._height*(o>>1)),r.transformPoint(n),vt.INSTANCE.include2(n);vt.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,r){vt.INSTANCE.reset();let n=F.new();for(let o=0;o<4;o=o+1)n.setTo(this._x+this._width*(o&1),this._y+this._height*(o>>1)),r.transformPoint(n),vt.INSTANCE.include2(n);vt.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new Fn(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new Fn(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new Fn(0,0,0,0)}static new3(e){return new Fn(e.x(),e.y(),e.width(),e.height())}static new4(e,r){return new Fn(e.x(),e.y(),r.x(),r.y())}};Fn.INVALID=new Fn(1/0,1/0,-1/0,-1/0),Fn.INFINITE=new Fn(-1/0,-1/0,1/0,1/0),Fn.CLIP=Fn.fromMinAndMax(-1,-1,1,1),Fn.UNIT=new Fn(0,0,1,1);var L=Fn,om=class om{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,r){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,r),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,r)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,r){if(!e.isEmpty()){let n=L.new2();e.transformInto1(n,r),this.include3(n)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=L.new2();return this.buildTo(e),e}};om.INSTANCE=new om;var vt=om,Na=class t{constructor(){if(arguments[0]==0){let[,e,r,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=L.new4(e,r),this._nodeRadius=n,this._cornerSmoothing=o}else if(arguments[0]==1){let[,e,r,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=L.new4(e,r),this._vertexRadii=n,this._cornerSmoothing=o}else if(arguments[0]==2){let[,e,r,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=r,this._vertexRadii=n}}clone(){var e;return new t(2,this._rect.clone(),this._nodeRadius,(e=this._vertexRadii)==null?void 0:e.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}isUniform(){return this._nodeRadius>0&&this._vertexRadii==null||this._vertexRadii!=null&&this._vertexRadii[0]==this._vertexRadii[1]&&this._vertexRadii[1]==this._vertexRadii[2]&&this._vertexRadii[2]==this._vertexRadii[3]}isSimpleRoundedRect(){return this.isUniform()&&this._cornerSmoothing==0}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let r=0,n=this.vertexRadii().length;r<n;r=r+1)this._vertexRadii[r]!=0&&(this._vertexRadii[r]=Math.max(this._vertexRadii[r]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},ar;(i=>{function t(){return L.new2()}i.FrozenRect_new1=t;function e(a){return a}i.FrozenRect_new2=e;function r(a){return L.new3(a)}i.FrozenRect_new3=r;function n(a,s,l,c){return new L(a,s,l,c)}i.FrozenRect_new4=n,i.FrozenRect_EMPTY=t()})(ar||(ar={}));var Q=class t{constructor(e,r,n,o,i,a){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=r,this._m02=n,this._m10=o,this._m11=i,this._m12=a}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new F(this.m00(),this.m10())}axisY(){return new F(this.m01(),this.m11())}clone(){return new t(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new F(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let r=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,n=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<r&&Math.abs(this.m11())<n||Math.abs(this.m01())<r&&Math.abs(this.m10())<n}valueEquals(e,r){return e==r||isNaN(e)&&isNaN(r)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,r){return Math.abs(this._m00-e.m00())<r&&Math.abs(this._m01-e.m01())<r&&Math.abs(this._m02-e.m02())<r&&Math.abs(this._m10-e.m10())<r&&Math.abs(this._m11-e.m11())<r&&Math.abs(this._m12-e.m12())<r}translation(){return new F(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,r){this._m02+=e*this.m00()+r*this.m01(),this._m12+=e*this.m10()+r*this.m11()}preTranslate(e){this._m02+=e.x(),this._m12+=e.y()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,r){return this.translate2(e,r),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let r=Math.sin(e),n=Math.cos(e),o=n*this.m00()+r*this.m01(),i=n*this.m01()-r*this.m00(),a=n*this.m10()+r*this.m11(),s=n*this.m11()-r*this.m10();this._m00=o,this._m01=i,this._m10=a,this._m11=s}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,r){this._m00*=e,this._m01*=r,this._m10*=e,this._m11*=r}skewX(e){let r=Math.tan(e);this._m01+=this._m00*r,this._m11+=this._m10*r}skewY(e){let r=Math.tan(e);this._m00+=this._m01*r,this._m10+=this._m10*r}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,r){return this.scale4(e,r),this}multiply(e){let r=this.m00()*e.m00()+this.m01()*e.m10(),n=this.m00()*e.m01()+this.m01()*e.m11(),o=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),i=this.m10()*e.m00()+this.m11()*e.m10(),a=this.m10()*e.m01()+this.m11()*e.m11(),s=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=r,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s}rightMultiply(e){this.multiply(e)}leftMultiply(e){let r=this.m00()*e.m00()+this.m10()*e.m01(),n=this.m01()*e.m00()+this.m11()*e.m01(),o=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),i=this.m00()*e.m10()+this.m10()*e.m11(),a=this.m01()*e.m10()+this.m11()*e.m11(),s=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=r,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(wt.FrozenAffineTransform_new6(e))}determinant(){return this.m00()*this.m11()-this.m01()*this.m10()}invert(){let e=1/this.determinant();if(!isFinite(e))return!1;let r=this.m11()*e,n=-this.m01()*e,o=(this.m01()*this.m12()-this.m11()*this.m02())*e,i=-this.m10()*e,a=this.m00()*e,s=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=r,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s,!0}inverse(){let e=this.clone(),r=e.invert();return e}transformPoint(e){let r=this.m00()*e.x()+this.m01()*e.y()+this.m02(),n=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(r),e.setY(n),e}transformPoints(e){for(let r=0,n=e.length;r<n;r=r+1){let o=e[r],i=this.m00()*o.x()+this.m01()*o.y()+this.m02(),a=this.m10()*o.x()+this.m11()*o.y()+this.m12();o.setX(i),o.setY(a)}return e}transformDirection(e){let r=this.m00()*e.x()+this.m01()*e.y(),n=this.m10()*e.x()+this.m11()*e.y();return e.setX(r),e.setY(n),e}transformRect(e){if(e.isInvalid())return e.copyFrom(L.INVALID);if(!e.isFinite())return e.copyFrom(L.INFINITE);let r=new vt;return r.include2(this.transformPoint(e.topLeft())),r.include2(this.transformPoint(e.topRight())),r.include2(this.transformPoint(e.bottomLeft())),r.include2(this.transformPoint(e.bottomRight())),r.buildTo(e),e}setTo(e,r,n,o,i,a){return this._m00=e,this._m01=r,this._m02=n,this._m10=o,this._m11=i,this._m12=a,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let r=t.new2();r.translate1(e),this.leftMultiply(r)}postRotate(e){let r=t.new2();r.rotate(e),this.leftMultiply(r)}postScale(e){let r=t.new2();r.scale3(e),this.leftMultiply(r)}offset(){return new F(this.m02(),this.m12())}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new t(1,0,0,0,1,0)}static new3(e){return new t(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new t(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,r){let n=t.new2();return n.translate2(e,r),n}static forRotationAboutPoint(e,r){let n=t.translated(r.x(),r.y());return n.rotate(e),n.translate1(r.negative()),n}},wt;(s=>{function t(){return Q.new2()}s.FrozenAffineTransform_new1=t;function e(l){return l}s.FrozenAffineTransform_new2=e;function r(l){return Q.new3(l)}s.FrozenAffineTransform_new3=r;function n(l,c,d,u,p,_){return new Q(l,c,d,u,p,_)}s.FrozenAffineTransform_new4=n;function o(l){return Q.new4(l)}s.FrozenAffineTransform_new5=o;function i(l){return Q.new4(l)}s.FrozenAffineTransform_new6=i,s.FrozenAffineTransform_IDENTITY=t()})(wt||(wt={}));var im=new Uint8Array([171,75,84,88,32,50,48,187,13,10,26,10]).toString();var cb=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},dc=class{constructor(e,r,n,o){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=o,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){let n=this._offset,o=0;for(;this._dataView.getUint8(this._offset)!==r&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,o)}};var fle=new Uint8Array([0]),ko=[171,75,84,88,32,50,48,187,13,10,26,10];function H1(t){return new TextDecoder().decode(t)}function z1(t){let e=new Uint8Array(t.buffer,t.byteOffset,ko.length);if(e[0]!==ko[0]||e[1]!==ko[1]||e[2]!==ko[2]||e[3]!==ko[3]||e[4]!==ko[4]||e[5]!==ko[5]||e[6]!==ko[6]||e[7]!==ko[7]||e[8]!==ko[8]||e[9]!==ko[9]||e[10]!==ko[10]||e[11]!==ko[11])throw new Error("Missing KTX 2.0 identifier.");let r=new cb,n=17*Uint32Array.BYTES_PER_ELEMENT,o=new dc(t,ko.length,n,!0);r.vkFormat=o._nextUint32(),r.typeSize=o._nextUint32(),r.pixelWidth=o._nextUint32(),r.pixelHeight=o._nextUint32(),r.pixelDepth=o._nextUint32(),r.layerCount=o._nextUint32(),r.faceCount=o._nextUint32();let i=o._nextUint32();r.supercompressionScheme=o._nextUint32();let a=o._nextUint32(),s=o._nextUint32(),l=o._nextUint32(),c=o._nextUint32(),d=o._nextUint64(),u=o._nextUint64(),p=i*3*8,_=new dc(t,ko.length+n,p,!0);for(let H=0;H<i;H++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+_._nextUint64(),_._nextUint64()),uncompressedByteLength:_._nextUint64()});let h=new dc(t,a,s,!0),g={vendorId:h._skip(4)._nextUint16(),descriptorType:h._nextUint16(),versionNumber:h._nextUint16(),descriptorBlockSize:h._nextUint16(),colorModel:h._nextUint8(),colorPrimaries:h._nextUint8(),transferFunction:h._nextUint8(),flags:h._nextUint8(),texelBlockDimension:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],bytesPlane:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],samples:[]},S=(g.descriptorBlockSize/4-6)/4;for(let H=0;H<S;H++){let K={bitOffset:h._nextUint16(),bitLength:h._nextUint8(),channelType:h._nextUint8(),samplePosition:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};K.channelType&64?(K.sampleLower=h._nextInt32(),K.sampleUpper=h._nextInt32()):(K.sampleLower=h._nextUint32(),K.sampleUpper=h._nextUint32()),g.samples[H]=K}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(g);let T=new dc(t,l,c,!0);for(;T._offset<c;){let H=T._nextUint32(),K=T._scan(H),j=H1(K);if(r.keyValue[j]=T._nextUint8Array(H-K.byteLength-1),j.match(/^ktx/i)){let J=H1(r.keyValue[j]);r.keyValue[j]=J.substring(0,J.lastIndexOf("\0"))}let q=H%4?4-H%4:0;T._skip(q)}if(u<=0)return r;let R=new dc(t,d,u,!0),b=R._nextUint16(),O=R._nextUint16(),f=R._nextUint32(),I=R._nextUint32(),y=R._nextUint32(),P=R._nextUint32(),E=[];for(let H=0;H<i;H++)E.push({imageFlags:R._nextUint32(),rgbSliceByteOffset:R._nextUint32(),rgbSliceByteLength:R._nextUint32(),alphaSliceByteOffset:R._nextUint32(),alphaSliceByteLength:R._nextUint32()});let C=d+R._offset,B=C+f,G=B+I,V=G+y,D=new Uint8Array(t.buffer,t.byteOffset+C,f),w=new Uint8Array(t.buffer,t.byteOffset+B,I),k=new Uint8Array(t.buffer,t.byteOffset+G,y),z=new Uint8Array(t.buffer,t.byteOffset+V,P);return r.globalData={endpointCount:b,selectorCount:O,imageDescs:E,endpointsData:D,selectorsData:w,tablesData:k,extendedData:z},r}var am=class{seconds(){return sc.Performance_now(Jn().performance)/1e3}milliseconds(){return sc.Performance_now(Jn().performance)}constructor(){}};var $i=class{constructor(){this._seconds=0}reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}setCurrentTime(e){this._seconds=e/1e3}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}},lp=class{seconds(){return Ze.seconds()}milliseconds(){return Ze.milliseconds()}},Ze;(a=>{function t(s){a._implementations.push(s)}a.dangerouslyPushMockTime=t;function e(){if(a._implementations.length==1)throw new Error("Popping last time implementation");le.List_removeLast(a._implementations)}a.popMockTime=e;function r(){return le.List_last(a._implementations).seconds()}a.seconds=r;function n(){return le.List_last(a._implementations).milliseconds()}a.milliseconds=n;function o(s){let l=r(),c=r();for(;c-l<s;)c=r()}a.spin=o,a._implementations=[new am]})(Ze||(Ze={}));var db=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,r){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(r),this._cachedFrameIdx=new fe(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&xe("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new fe(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&xe("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},ea=class ea{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new db(this._frameByteLength)),this._timeSource=new lp}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&ea.fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return ea.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=this._timeSource.milliseconds(),ea.ShouldAdvance.ONCE;let e=this.loopsForever()?ea.ShouldAdvance.UNTIL_CAUGHT_UP:ea.ShouldAdvance.ONCE;return this._timeSource.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:ea.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=Ut.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==ea.ShouldAdvance.NO)return null;let r=this._timeSource.milliseconds(),n=this._advanceFrame();if(e==ea.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=ea.ShouldAdvance.NO;){if(this._timeSource.milliseconds()-r>=16){this._desiredFrameStartTimeMs=this._timeSource.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}n=this._advanceFrame()}return n}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=Ut.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}setAutoplay(e){this.replaceTimeSource(e?new lp:new $i)}replaceTimeSource(e){let r=this._timeSource;return this._timeSource=e,this.restart(),r}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=o=>"["+o.map(i=>`${i}`).join(", ")+"]",r=this._loopCount==0?"infinite":`${this._loopCount}`,n=this._frameInfos.map(o=>o.disposal);return le.List_removeDuplicates(n),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${r}
 frameCount: ${this._frameCount}
 disposals: ${e(n)}`}_forEachRowIndexPairInSubrect(e,r){for(let n=e.y,o=e.y+e.height;n<o;n=n+1){let i=this.width()*4*n;r(i+e.x*4,i+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(r,n)=>{this._currentFramePx.subarray(r,n).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let h=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,g=this._frameInfos[h],m=this._previousFrameCache.getLastNonDisposedFrame();g==null||m==null?this._clearLastFrameToBackground():g.width==this.width()&&g.height==this.height()?this._currentFramePx.set(m):this._forEachRowIndexPairInSubrect(g,(A,S)=>{let T=this._currentFramePx.subarray(A,S),R=m.subarray(A,S);T.set(R)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let r=e.width*e.height,n=new Uint8Array(r);this._LZWOutputIndexStream(this._buf,e.dataOffset,n,r);let o=e.paletteOffset,i=e.transparentIndex,a=e.width,s=this.width()-a,l=a,c=(e.y*this.width()+e.x)*4,d=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,u=c,p=s*4;e.interlaced&&(p=p+this.width()*4*7);let _=8;for(let h=0,g=n.length;h<g;h=h+1){let m=n[h];if(l==0&&(u=u+p,l=a,u>=d&&(p=s*4+this.width()*4*(_-1),u=c+(a+s)*(_<<1),_>>=1)),m==i)u=u+4;else{let A=this._buf[o+m*3],S=this._buf[o+m*3+1],T=this._buf[o+m*3+2];this._currentFramePx[u++]=A,this._currentFramePx[u++]=S,this._currentFramePx[u++]=T,this._currentFramePx[u++]=255}l=l-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,r,n,o){let i=e[r++],a=1<<i,s=a+1,l=s+1,c=i+1,d=(1<<c)-1,u=0,p=0,_=0,h=e[r++],g=new Int32Array(4096),m=-1;for(;;){for(;u<16&&h!=0;)p|=e[r++]<<u,u=u+8,h==1?h=e[r++]:h=h-1;if(u<c)break;let A=p&d;if(p>>=c,u=u-c,A==a){l=s+1,c=i+1,d=(1<<c)-1,m=-1;continue}else if(A==s)break;let S=A<l?A:m,T=0,R=S;for(;R>a;)R=g[R]>>8,T=T+1;let b=R;if(_+T+(S!=A?1:0)>o){console.warn("Warning, gif stream longer than expected.");return}n[_++]=b,_=_+T;let f=_;for(S!=A&&(n[_++]=b),R=S;(T=T-1)- -1!=0;)R=g[R],n[f=f-1]=R&255,R>>=8;m!=-1&&l<4096&&(g[l++]=m<<8|b,l>=d+1&&c<12&&(c=c+1,d=d<<1|1)),m=A}if(_!=o){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static fail(e){throw new Error(e)}};ea.DEBUG_LOG=!1;var eo=ea;(n=>{let t;(s=>(s[s.ONCE=0]="ONCE",s[s.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",s[s.NO=2]="NO"))(t=n.ShouldAdvance||(n.ShouldAdvance={}));class e{constructor(i,a,s,l,c,d,u){this.width=i,this.height=a,this.frameCount=s,this.loopCount=l,this.buf=c,this.frameInfos=d,this.needLastNonDisposed=u}}n.DecodeResult=e;class r{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(i,a,s,l,c,d,u,p,_,h,g,m,A){this.x=i,this.y=a,this.width=s,this.height=l,this.hasLocalPalette=c,this.paletteOffset=d,this.paletteSize=u,this.dataOffset=p,this.dataLength=_,this.transparentIndex=h,this.interlaced=g,this.delay=m,this.disposal=A}}n.Frame=r})(eo||(eo={}));function W1(){let t,e,n={promise:new Promise((o,i)=>{t=o,e=i}),resolve:o=>{n.status="resolved",n.result=o,t(o)},reject:o=>{n.status="rejected",n.error=o,e(o)},status:"pending"};return n}var ub=class{constructor(){this.onMessage=e=>{if(this.pendingWAFVerification&&e.data==="waf-successful"){if(this.pendingWAFVerification.type==="challenge"){let{deferred:r,iframe:n}=this.pendingWAFVerification;this.pendingWAFVerification=void 0,r.resolve(),n.remove()}window.removeEventListener("message",this.onMessage)}}}waitForWAFValidation(e){if(this.pendingWAFVerification)return this.pendingWAFVerification.deferred.promise;let r=W1();if(e==="challenge"){let n=document.createElement("iframe");return n.src=`${window.location.origin}/waf-validation`,n.id="waf-iframe",document.body.appendChild(n),window.addEventListener("message",this.onMessage),this.pendingWAFVerification={type:"challenge",deferred:r,iframe:n},r.promise}else if(e==="captcha")throw new Error("Unhandled")}},K1=new ub;function Y1(t){if(!t.responseURL||!t.responseURL.startsWith(window.location.origin))return null;let e=t.getResponseHeader("x-amzn-waf-action");return e?e==="challenge"?"challenge":"captcha":null}var cp=class{constructor(e){this.status=e}},q1,X1,oi=class{constructor(e){this.currentUserId=(X1=(q1=Jn().INITIAL_OPTIONS)==null?void 0:q1.user_data)==null?void 0:X1.id;this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}state(){return this._state}get(e={handleWAFChallenge:!0}){return e.handleWAFChallenge?this.sendWithWaf("GET"):this.tryOnce("GET")}put(){return this.sendWithWaf("PUT")}head(){return this.sendWithWaf("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,r){return this._headers.set(e,r),this}userIdHeader(){return this._headers.set("X-Figma-User-ID",this.currentUserId??""),this}format(e){return this._format=e,this}send1(e,r,n){if(!1)return this.sendWithWaf(e);if($u==3){this._blob=r;for(let o of Array.from(n.keys()))this._headers.set(o,n.get(o));return this.sendWithWaf(e)}else throw new Error("unimplemented")}send2(e,r){if(!1)return this.sendWithWaf(e);if($u==3)return this._blob=r,this.sendWithWaf(e);throw new Error("unimplemented")}async sendWithWaf(e){var o;let r=await this.tryOnce(e);return!en&&!Yr()&&r.wafChallenge&&(this._state=0,await((o=K1)==null?void 0:o.waitForWAFValidation(r.wafChallenge)),r=await this.tryOnce(e)),r}async tryOnce(e){if(!1)return new Promise((r,n)=>{if(Q1==null){n(new cp(0));return}let o=Q1(this._url);if(o==200){let i=new sm;i.url=this._url,i.status=200,r(i)}else n(new cp(o))});if($u==3){this._xhr.open(e,this._url);let r=null,n=null,o=new Promise((i,a)=>{r=i,n=a});o.then(null,i=>{this.cancel()});for(let i of Array.from(this._headers.keys()))this._xhr.setRequestHeader(i,this._headers.get(i));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let i=new sm;switch(i.url=this._url,i.status=this._xhr.status,i.contentType=this._xhr.getResponseHeader("Content-Type"),i.wafChallenge=Y1(this._xhr),this._format){case 0:{i.text=this._xhr.response;break}case 1:{i.bytes=new Uint8Array(this._xhr.response);break}}r(i)},this._xhr.onprogress=i=>{this._state!=2&&this._progressCallback!=null&&i.lengthComputable&&this._progressCallback(i.loaded/i.total)},this._xhr.onloadend=()=>{n(new cp(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,o}else throw new Error("unimplemented")}cancel(){if(!0)if($u==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}},sm=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null,this.url=null,this.wafChallenge=null}};var Q1=null;var pb;(e=>{function t(r,n){let o=Array.from(r);return ln(o,Array.from(n)),new Uint8Array(o)}e.concat=t})(pb||(pb={}));var j1;(e=>{function t(r,n){if(r.byteLength!=n.byteLength)return!1;for(let o=0,i=r.byteLength;o<i;o=o+1)if(r[o]!=n[o])return!1;return!0}e.Uint8Array_equals=t})(j1||(j1={}));var lm;(e=>{function t(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}e.DataView_new1=t})(lm||(lm={}));var cm;(u=>{function t(p,_){if(_.value+1>p.length)return null;let h=new fe(p[_.value]);return _.value=_.value+1,h}u._read8=t;function e(p,_,h){if(_.value+2>p.length)return null;let g=p[_.value],m=p[_.value+1];return _.value=_.value+2,new fe(h==1?g|m<<8:m|g<<8)}u._read16=e;function r(p,_,h){if(_.value+2>p.length)return null;let g=p[_.value],m=p[_.value+1],A=p[_.value+2],S=p[_.value+3];return _.value=_.value+4,new fe(h==1?g|m<<8|A<<16|S<<24:S|A<<8|m<<16|g<<24)}u._read32=r;function n(p){let _=[255,216,255];if(p.length<_.length)return null;for(let g=0,m=_.length;g<m;g=g+1)if(_[g]!=p[g])return null;let h=new fe(2);for(;h.value+4<=p.length;){let g=e(p,h,0);if(g==null||g.value>>8!=255)return null;let m=e(p,h,0);if(m==null||m.value<2)return null;if(h.value=h.value-2,g.value==65505){let A=o(p,h.value);if(A!=null)return A}h.value=h.value+m.value}return null}u.readFromJPEG=n;function o(p,_){let h=new fe(_),g=e(p,h,0);if(g==null||g.value<6)return null;let m=r(p,h,0);if(m==null||m.value!=1165519206)return null;let A=e(p,h,0);if(A==null||A.value!=0)return null;let S=r(p,h,0);if(S==null||S.value!=1229531648&&S.value!=1296891946)return null;let R=S.value==1229531648?1:0,b=r(p,h,R);if(b==null)return null;h.value=h.value+b.value-8;let O=e(p,h,R);if(O==null)return null;let f=O.value,I=-1;for(let y=0;y<f;y=y+1){let P=e(p,h,R);if(P==null)break;let E=P.value,C=e(p,h,R);if(C==null)break;let B=C.value,G=r(p,h,R);if(G==null)break;let V=G.value,D=new fe(h.value);if(h.value=h.value+4,!(E!=u.EXIF_TAG_ORIENTATION||V!=1)){if(B==u.EXIF_FORMAT_BYTE){let w=t(p,D);if(w==null)return null;I=w.value}else if(B==u.EXIF_FORMAT_SHORT){let w=e(p,D,R);if(w==null)return null;I=w.value}else if(B==u.EXIF_FORMAT_LONG||B==u.EXIF_FORMAT_SLONG){let w=r(p,D,R);if(w==null)return null;I=w.value}else continue;switch(I){case 1:return new fe(0);case 6:return new fe(1);case 3:return new fe(2);case 8:return new fe(3);case 2:return new fe(4);case 5:return new fe(5);case 4:return new fe(6);case 7:return new fe(7)}}}return null}u._decodeExifOrientation=o;let i;(h=>(h[h.BIG=0]="BIG",h[h.LITTLE=1]="LITTLE"))(i=u.Endianness||(u.Endianness={})),u.EXIF_TAG_ORIENTATION=274,u.EXIF_FORMAT_BYTE=1,u.EXIF_FORMAT_SHORT=3,u.EXIF_FORMAT_LONG=4,u.EXIF_FORMAT_SLONG=9})(cm||(cm={}));var dp;(r=>{function t(n){switch(n){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}r.ImageOrientation_rotationDegrees=t;function e(n){return n==4||n==5||n==6||n==7}r.ImageOrientation_shouldFlip=e})(dp||(dp={}));var up;(C=>{function t(B){return B<0?0:B>255?255:B}C._clip=t;function e(B){return t(B+64>>7)}C._CF=e;function r(B,G){let V=0,D=B[G+4]<<11,w=B[G+6],k=B[G+2],z=B[G+1],H=B[G+7],K=B[G+5],j=B[G+3],q=0;if((D|w|k|z|H|K|j)==0){let J=B[G]<<3;B[G]=J,B[G+1]=J,B[G+2]=J,B[G+3]=J,B[G+4]=J,B[G+5]=J,B[G+6]=J,B[G+7]=J;return}V=(B[G]<<11)+128,q=C._W7*(z+H),z=q+(C._W1-C._W7)*z,H=q-(C._W1+C._W7)*H,q=C._W3*(K+j),K=q-(C._W3-C._W5)*K,j=q-(C._W3+C._W5)*j,q=V+D,V=V-D,D=C._W6*(k+w),w=D-(C._W2+C._W6)*w,k=D+(C._W2-C._W6)*k,D=z+K,z=z-K,K=H+j,H=H-j,j=q+k,q=q-k,k=V+w,V=V-w,w=181*(z+H)+128>>8,z=181*(z-H)+128>>8,B[G]=j+D>>8,B[G+1]=k+w>>8,B[G+2]=V+z>>8,B[G+3]=q+K>>8,B[G+4]=q-K>>8,B[G+5]=V-z>>8,B[G+6]=k-w>>8,B[G+7]=j-D>>8}C._rowInverseDCT=r;function n(B,G,V,D,w){let k=0,z=B[G+8*4]<<8,H=B[G+8*6],K=B[G+8*2],j=B[G+8*1],q=B[G+8*7],J=B[G+8*5],ie=B[G+8*3],Ee=0;if((z|H|K|j|q|J|ie)==0){let Ke=t((B[G]+32>>6)+128);for(let Ve=8;Ve!=0;Ve=Ve-1)V[D]=Ke,D=D+w;return}k=(B[G]<<8)+8192,Ee=C._W7*(j+q)+4,j=Ee+(C._W1-C._W7)*j>>3,q=Ee-(C._W1+C._W7)*q>>3,Ee=C._W3*(J+ie)+4,J=Ee-(C._W3-C._W5)*J>>3,ie=Ee-(C._W3+C._W5)*ie>>3,Ee=k+z,k=k-z,z=C._W6*(K+H)+4,H=z-(C._W2+C._W6)*H>>3,K=z+(C._W2-C._W6)*K>>3,z=j+J,j=j-J,J=q+ie,q=q-ie,ie=Ee+K,Ee=Ee-K,K=k+H,k=k-H,H=181*(j+q)+128>>8,j=181*(j-q)+128>>8,V[D]=t((ie+z>>14)+128),D=D+w,V[D]=t((K+H>>14)+128),D=D+w,V[D]=t((k+j>>14)+128),D=D+w,V[D]=t((Ee+J>>14)+128),D=D+w,V[D]=t((Ee-J>>14)+128),D=D+w,V[D]=t((k-j>>14)+128),D=D+w,V[D]=t((K-H>>14)+128),D=D+w,V[D]=t((ie-z>>14)+128)}C._colInverseDCT=n;let o;(k=>(k[k.OK=0]="OK",k[k.NO_JPEG=1]="NO_JPEG",k[k.UNSUPPORTED=2]="UNSUPPORTED",k[k.SYNTAX_ERROR=3]="SYNTAX_ERROR",k[k.FINISHED=4]="FINISHED"))(o=C.Result||(C.Result={}));class i{upsampleH(){let G=this.width-3,V=0,D=0,w=new Uint8Array(this.width*this.height*2);for(let k=this.height;k!=0;k=k-1){w[D]=e(C._CF2A*this.pixels[V]+C._CF2B*this.pixels[V+1]),w[D+1]=e(C._CF3X*this.pixels[V]+C._CF3Y*this.pixels[V+1]+C._CF3Z*this.pixels[V+2]),w[D+2]=e(C._CF3A*this.pixels[V]+C._CF3B*this.pixels[V+1]+C._CF3C*this.pixels[V+2]);for(let z=0;z<G;z=z+1)w[D+z*2+3]=e(C._CF4A*this.pixels[V+z]+C._CF4B*this.pixels[V+z+1]+C._CF4C*this.pixels[V+z+2]+C._CF4D*this.pixels[V+z+3]),w[D+z*2+4]=e(C._CF4D*this.pixels[V+z]+C._CF4C*this.pixels[V+z+1]+C._CF4B*this.pixels[V+z+2]+C._CF4A*this.pixels[V+z+3]);V=V+this.stride,D=D+this.width*2,w[D+-3]=e(C._CF3A*this.pixels[V-1]+C._CF3B*this.pixels[V-2]+C._CF3C*this.pixels[V-3]),w[D+-2]=e(C._CF3X*this.pixels[V-1]+C._CF3Y*this.pixels[V-2]+C._CF3Z*this.pixels[V-3]),w[D+-1]=e(C._CF2A*this.pixels[V-1]+C._CF2B*this.pixels[V-2])}this.width<<=1,this.stride=this.width,this.pixels=w}upsampleV(){let G=this.width,V=this.stride,D=V+V,w=new Uint8Array(this.width*this.height*2);for(let k=0;k<G;k=k+1){let z=k,H=k;w[H]=e(C._CF2A*this.pixels[z]+C._CF2B*this.pixels[z+V]),H=H+G,w[H]=e(C._CF3X*this.pixels[z]+C._CF3Y*this.pixels[z+V]+C._CF3Z*this.pixels[z+D]),H=H+G,w[H]=e(C._CF3A*this.pixels[z]+C._CF3B*this.pixels[z+V]+C._CF3C*this.pixels[z+D]),H=H+G,z=z+V;for(let K=this.height-3;K!=0;K=K-1)w[H]=e(C._CF4A*this.pixels[z+-V]+C._CF4B*this.pixels[z]+C._CF4C*this.pixels[z+V]+C._CF4D*this.pixels[z+D]),H=H+G,w[H]=e(C._CF4D*this.pixels[z+-V]+C._CF4C*this.pixels[z]+C._CF4B*this.pixels[z+V]+C._CF4A*this.pixels[z+D]),H=H+G,z=z+V;z=z+V,w[H]=e(C._CF3A*this.pixels[z]+C._CF3B*this.pixels[z-V]+C._CF3C*this.pixels[z-D]),H=H+G,w[H]=e(C._CF3X*this.pixels[z]+C._CF3Y*this.pixels[z-V]+C._CF3Z*this.pixels[z-D]),H=H+G,w[H]=e(C._CF2A*this.pixels[z]+C._CF2B*this.pixels[z-V])}this.height<<=1,this.stride=this.width,this.pixels=w}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}C.Component=i;class a{constructor(){}}C.Stop=a;let s;(j=>(j[j.NONE=0]="NONE",j[j.ROTATE_0=1]="ROTATE_0",j[j.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",j[j.ROTATE_180=3]="ROTATE_180",j[j.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",j[j.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",j[j.ROTATE_90=6]="ROTATE_90",j[j.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",j[j.ROTATE_270=8]="ROTATE_270"))(s=C.Orientation||(C.Orientation={}));class l{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let G=0;G<4;G=G+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new i)}_throw(G){throw this._error=G,new a}_showBits(G){if(G==0)return 0;for(;this._bitCount<G;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let V=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|V,V==255){this._size==0&&this._throw(3);let D=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,D==217?this._size=0:D!=0&&D!=255&&((D&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|D,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-G&(1<<G)-1}_skipBits(G){this._bitCount<G&&this._showBits(G),this._bitCount=this._bitCount-G}_getBits(G){let V=this._showBits(G);return this._skipBits(G),V}_byteAlign(){this._bitCount&=248}_skip(G){this._offset=this._offset+G,this._size=this._size-G,this._length=this._length-G,this._size<0&&this._throw(3)}_decodeBig16(G){return this._bytes[G]<<8|this._bytes[G+1]}_decodeBig32(G){return this._bytes[G]<<24|this._bytes[G+1]<<16|this._bytes[G+2]<<8|this._bytes[G+3]}_decode16(G,V){return V==l.Endianness.LITTLE?this._bytes[G]|this._bytes[G+1]<<8:this._decodeBig16(G)}_decode32(G,V){return V==l.Endianness.LITTLE?this._bytes[G]|this._bytes[G+1]<<8|this._bytes[G+2]<<16|this._bytes[G+3]<<24:this._decodeBig32(G)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let G=0,V=0,D=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let w=0;w<this._componentCount;w=w+1)D=this._components[w],D.id=this._bytes[this._offset],D.ssx=this._bytes[this._offset+1]>>4,D.ssy=this._bytes[this._offset+1]&15,D.quantizationTableIndex=this._bytes[this._offset+2],(D.ssx==0||D.ssy==0||(D.quantizationTableIndex&252)!=0)&&this._throw(3),((D.ssx&D.ssx-1)!=0||(D.ssy&D.ssy-1)!=0)&&this._throw(2),this._skip(3),D.ssx>G&&(G=D.ssx),D.ssy>V&&(V=D.ssy);this._componentCount==1&&(D=this._components[0],D.ssx=D.ssy=G=V=1),this._macroBlockSizeX=G<<3,this._macroBlockSizeY=V<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let w=0;w<this._componentCount;w=w+1)D=this._components[w],D.width=(this._width*D.ssx+G-1)/G|0,D.height=(this._height*D.ssy+V-1)/V|0,D.stride=this._widthInMacroBlocks*this._macroBlockSizeX*D.ssx/G|0,(D.width<3&&D.ssx!=G||D.height<3&&D.ssy!=V)&&this._throw(2),D.pixels=new Uint8Array(D.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*D.ssy/V|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let G=this._bytes[this._offset];(G&236)!=0&&this._throw(3),(G&2)!=0&&this._throw(2),G=(G|G>>3)&3;let V=new Uint8Array(16);for(let H=1;H<=16;H=H+1)V[H-1]=this._bytes[this._offset+H];this._skip(17);let D=this._huffmanTable[G],w=0,k=65536,z=65536;for(let H=1;H<=16;H=H+1){z>>=1;let K=V[H-1];if(K!=0){this._length<K&&this._throw(3),k=k-(K<<16-H),k<0&&this._throw(3);for(let j=0;j<K;j=j+1){let q=this._bytes[this._offset+j];for(let J=z;J!=0;J=J-1)w<65536&&(D[w]=H<<8|q,w=w+1)}this._skip(K)}}for(;k!=0;)k=k-1,w<65536&&(D[w]=D[w]&65280,w=w+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let G=this._bytes[this._offset];(G&252)!=0&&this._throw(3);let V=this._quantizationTable[G];for(let D=0;D<64;D=D+1)V[D]=this._bytes[this._offset+D+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(G){let V=this._showBits(16),D=G[V]>>8;return D==0&&this._throw(3),this._skipBits(D),V=G[V]&255,this._getVLC_code=V,D=V&15,D==0?0:(V=this._getBits(D),V<1<<D-1&&(V=V+((-1<<D)+1)),V)}_decodeBlock(G,V){let D=0;for(this._block=new Int32Array(64),G.dcPred=G.dcPred+this._getVLC(this._huffmanTable[G.dcTableIndex]),this._block[0]=G.dcPred*this._quantizationTable[G.quantizationTableIndex][0];D<63;){let w=this._getVLC(this._huffmanTable[G.acTableIndex]);if(this._getVLC_code==0)break;(this._getVLC_code&15)==0&&this._getVLC_code!=240&&this._throw(3),D=D+((this._getVLC_code>>4)+1),D>63&&this._throw(3),this._block[C._zigZagTable[D]]=w*this._quantizationTable[G.quantizationTableIndex][D]}for(let w=0;w<64;w=w+8)r(this._block,w);for(let w=0;w<8;w=w+1)n(this._block,w,G.pixels,V+w,G.stride)}_decodeScan(){let G=this._restartInterval,V=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let D=0;D<this._componentCount;D=D+1){let w=this._components[D];this._bytes[this._offset]!=w.id&&this._throw(3),(this._bytes[this._offset+1]&238)!=0&&this._throw(3),w.dcTableIndex=this._bytes[this._offset+1]>>4,w.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let D=0;D<this._heightInMacroBlocks;D=D+1)for(let w=0;w<this._widthInMacroBlocks;w=w+1){if((w!=0||D!=0)&&this._restartInterval!=0&&(G=G-1,G==0)){this._byteAlign();let k=this._getBits(16);((k&65528)!=65488||(k&7)!=V)&&this._throw(3),V=V+1&7,G=this._restartInterval;for(let z=0;z<4;z=z+1)this._components[z].dcPred=0}for(let k=0;k<this._componentCount;k=k+1){let z=this._components[k];for(let H=0;H<z.ssy;H=H+1)for(let K=0;K<z.ssx;K=K+1)this._decodeBlock(z,(D*z.ssy+H)*z.stride+w*z.ssx+K<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let G=this._offset;this._length<8&&this._throw(3);let V=this._decodeBig32(G),D=V==1229531648?l.Endianness.LITTLE:l.Endianness.BIG;D==l.Endianness.BIG&&V!=1296891946&&this._throw(3);let w=274,k=1,z=3,H=4,K=9,j=G+this._decode32(G+4,D),q=this._decode16(j,D);j=j+2;for(let J=0,ie=q;J<ie;J=J+1){let Ee=this._decode16(j,D),Ke=this._decode16(j+2,D),Ve=this._decode32(j+4,D);if(j=j+8,Ee==w&&Ve==1){this._exifOrientation=0,Ke==k?this._exifOrientation=this._bytes[j]:Ke==z?this._exifOrientation=this._decode16(j,D):(Ke==H||Ke==K)&&(this._exifOrientation=this._decode32(j,D)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}j=j+4}this._skip(this._length)}_convert(){for(let D=0;D<this._componentCount;D=D+1){let w=this._components[D];for(;w.width<this._width||w.height<this._height;)w.width<this._width&&w.upsampleH(),w.height<this._height&&w.upsampleV()}let G=this._components[0],V=this._rgb;if(this._componentCount==1){let D=0,w=0;for(let k=this._height;k!=0;k=k-1){for(let z=0;z<this._width;z=z+1){let H=G.pixels[w+z];V[D]=H,V[D+1]=H,V[D+2]=H,D=D+3}w=w+G.stride}}else{let D=this._components[1],w=this._components[2],k=0,z=0,H=0,K=0;for(let j=this._height;j!=0;j=j-1){for(let q=0;q<this._width;q=q+1){let J=G.pixels[z+q]<<8,ie=D.pixels[H+q]-128,Ee=w.pixels[K+q]-128;V[k]=t(J+359*Ee+128>>8),V[k+1]=t(J-88*ie-183*Ee+128>>8),V[k+2]=t(J+454*ie+128>>8),k=k+3}z=z+G.stride,H=H+D.stride,K=K+w.stride}}}_orient(){if(this._exifOrientation==1)return;let G=this._width,V=this._height,D=this._exifOrientation>=5,w=D?V:G,k=D?G:V,z=this._rgb,H=new Uint8Array(w*k*3);for(let K=0,j=0;K<V;K=K+1){let q=0,J=0;switch(this._exifOrientation){case 2:{q=K*w+w-1,J=-1;break}case 3:{q=(V-K-1)*w+w-1,J=-1;break}case 4:{q=(V-K-1)*w,J=1;break}case 5:{q=K,J=w;break}case 6:{q=V-K-1,J=w;break}case 7:{q=V-K-1+w*(k-1),J=-w;break}case 8:{q=K+w*(k-1),J=-w;break}}q=q*3,J=J*3;for(let ie=0;ie<G;ie=ie+1,j=j+3)H[q]=z[j],H[q+1]=z[j+1],H[q+2]=z[j+2],q=q+J}this._width=w,this._height=k,this._rgb=H}decodeBytes(G){try{for(this._bytes=G,this._offset=0,this._size=G.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let V=this._bytes[this._offset-1];V==192?this._decodeSOF():V==196?this._decodeDHT():V==219?this._decodeDQT():V==221?this._decodeDRI():V==218?this._decodeScan():V==225?this._decodeEXIF():V==254?this._skipMarker():(V&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}C.Decoder=l,(G=>{let B;(w=>(w[w.BIG=0]="BIG",w[w.LITTLE=1]="LITTLE"))(B=G.Endianness||(G.Endianness={}))})(l=C.Decoder||(C.Decoder={})),C._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],C._W1=2841,C._W2=2676,C._W3=2408,C._W5=1609,C._W6=1108,C._W7=565,C._CF4A=-9,C._CF4B=111,C._CF4C=29,C._CF4D=-3,C._CF3A=28,C._CF3B=109,C._CF3C=-9,C._CF3X=104,C._CF3Y=27,C._CF3Z=-3,C._CF2A=139,C._CF2B=-11})(up||(up={}));var to=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,r)=>{this._resolve=e,this._reject=r})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,r){this._promise.then(e,r)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._error=e,this._reject(e)),this}state(){return this._state}},dm=class dm{constructor(){}};dm.VOID=new dm;var ul=dm;function um(t){Promise.resolve(ul.VOID).then(e=>{t()})}var uc=class{elapsedSeconds(){return Ze.seconds()-this._start}reset(){this._start=Ze.seconds()}constructor(){this._start=Ze.seconds()}};var pc=class t{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let r=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let n of this._queue)this.postMessage2(n.message,n.transfer)};new oi(e).get({handleWAFChallenge:!1}).then(n=>{if(n.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([n.text])))}catch{r();return}this._worker.onmessage=o=>{this.onmessage!=null&&this.onmessage(o)};for(let o of this._queue)this.postMessage2(o.message,o.transfer)}else r()},n=>{r()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,r){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new t.Item(e,r)):r!=null?this._worker.postMessage(e,r):this._worker.postMessage(e)}};(e=>{class t{constructor(n,o){this.message=n,this.transfer=o}}e.Item=t})(pc||(pc={}));function Cd(t){let e=t.length;for(;--e>=0;)t[e]=0}var k2=0,LP=1,H2=2,z2=3,W2=258,Mb=29,vp=256,Sp=vp+1+Mb,yd=30,Bb=19,MP=2*Sp+1,_c=15,_b=16,K2=7,Gb=256,BP=16,GP=17,UP=18,Cb=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),gm=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Y2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),VP=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Q2=512,Ps=new Array((Sp+2)*2);Cd(Ps);var mp=new Array(yd*2);Cd(mp);var Ap=new Array(Q2);Cd(Ap);var Tp=new Array(W2-z2+1);Cd(Tp);var Ub=new Array(Mb);Cd(Ub);var Sm=new Array(yd);Cd(Sm);function hb(t,e,r,n,o){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=o,this.has_stree=t&&t.length}var kP,HP,zP;function mb(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}var WP=t=>t<256?Ap[t]:Ap[256+(t>>>7)],Ep=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},ii=(t,e,r)=>{t.bi_valid>_b-r?(t.bi_buf|=e<<t.bi_valid&65535,Ep(t,t.bi_buf),t.bi_buf=e>>_b-t.bi_valid,t.bi_valid+=r-_b):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},ns=(t,e,r)=>{ii(t,r[e*2],r[e*2+1])},KP=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},q2=t=>{t.bi_valid===16?(Ep(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},X2=(t,e)=>{let r=e.dyn_tree,n=e.max_code,o=e.stat_desc.static_tree,i=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length,c,d,u,p,_,h,g=0;for(p=0;p<=_c;p++)t.bl_count[p]=0;for(r[t.heap[t.heap_max]*2+1]=0,c=t.heap_max+1;c<MP;c++)d=t.heap[c],p=r[r[d*2+1]*2+1]+1,p>l&&(p=l,g++),r[d*2+1]=p,!(d>n)&&(t.bl_count[p]++,_=0,d>=s&&(_=a[d-s]),h=r[d*2],t.opt_len+=h*(p+_),i&&(t.static_len+=h*(o[d*2+1]+_)));if(g!==0){do{for(p=l-1;t.bl_count[p]===0;)p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[l]--,g-=2}while(g>0);for(p=l;p!==0;p--)for(d=t.bl_count[p];d!==0;)u=t.heap[--c],!(u>n)&&(r[u*2+1]!==p&&(t.opt_len+=(p-r[u*2+1])*r[u*2],r[u*2+1]=p),d--)}},YP=(t,e,r)=>{let n=new Array(_c+1),o=0,i,a;for(i=1;i<=_c;i++)o=o+r[i-1]<<1,n[i]=o;for(a=0;a<=e;a++){let s=t[a*2+1];s!==0&&(t[a*2]=KP(n[s]++,s))}},j2=()=>{let t,e,r,n,o,i=new Array(_c+1);for(r=0,n=0;n<Mb-1;n++)for(Ub[n]=r,t=0;t<1<<Cb[n];t++)Tp[r++]=n;for(Tp[r-1]=n,o=0,n=0;n<16;n++)for(Sm[n]=o,t=0;t<1<<gm[n];t++)Ap[o++]=n;for(o>>=7;n<yd;n++)for(Sm[n]=o<<7,t=0;t<1<<gm[n]-7;t++)Ap[256+o++]=n;for(e=0;e<=_c;e++)i[e]=0;for(t=0;t<=143;)Ps[t*2+1]=8,t++,i[8]++;for(;t<=255;)Ps[t*2+1]=9,t++,i[9]++;for(;t<=279;)Ps[t*2+1]=7,t++,i[7]++;for(;t<=287;)Ps[t*2+1]=8,t++,i[8]++;for(YP(Ps,Sp+1,i),t=0;t<yd;t++)mp[t*2+1]=5,mp[t*2]=KP(t,5);kP=new hb(Ps,Cb,vp+1,Sp,_c),HP=new hb(mp,gm,0,yd,_c),zP=new hb(new Array(0),Y2,0,Bb,K2)},QP=t=>{let e;for(e=0;e<Sp;e++)t.dyn_ltree[e*2]=0;for(e=0;e<yd;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Bb;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Gb*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},qP=t=>{t.bi_valid>8?Ep(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Z1=(t,e,r,n)=>{let o=e*2,i=r*2;return t[o]<t[i]||t[o]===t[i]&&n[e]<=n[r]},fb=(t,e,r)=>{let n=t.heap[r],o=r<<1;for(;o<=t.heap_len&&(o<t.heap_len&&Z1(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!Z1(e,n,t.heap[o],t.depth));)t.heap[r]=t.heap[o],r=o,o<<=1;t.heap[r]=n},J1=(t,e,r)=>{let n,o,i=0,a,s;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+i++]&255,n+=(t.pending_buf[t.sym_buf+i++]&255)<<8,o=t.pending_buf[t.sym_buf+i++],n===0?ns(t,o,e):(a=Tp[o],ns(t,a+vp+1,e),s=Cb[a],s!==0&&(o-=Ub[a],ii(t,o,s)),n--,a=WP(n),ns(t,a,r),s=gm[a],s!==0&&(n-=Sm[a],ii(t,n,s)));while(i<t.sym_next);ns(t,Gb,e)},Ob=(t,e)=>{let r=e.dyn_tree,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,i=e.stat_desc.elems,a,s,l=-1,c;for(t.heap_len=0,t.heap_max=MP,a=0;a<i;a++)r[a*2]!==0?(t.heap[++t.heap_len]=l=a,t.depth[a]=0):r[a*2+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=l<2?++l:0,r[c*2]=1,t.depth[c]=0,t.opt_len--,o&&(t.static_len-=n[c*2+1]);for(e.max_code=l,a=t.heap_len>>1;a>=1;a--)fb(t,r,a);c=i;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],fb(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=s,r[c*2]=r[a*2]+r[s*2],t.depth[c]=(t.depth[a]>=t.depth[s]?t.depth[a]:t.depth[s])+1,r[a*2+1]=r[s*2+1]=c,t.heap[1]=c++,fb(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],X2(t,e),YP(r,l,t.bl_count)},$1=(t,e,r)=>{let n,o=-1,i,a=e[0*2+1],s=0,l=7,c=4;for(a===0&&(l=138,c=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)i=a,a=e[(n+1)*2+1],!(++s<l&&i===a)&&(s<c?t.bl_tree[i*2]+=s:i!==0?(i!==o&&t.bl_tree[i*2]++,t.bl_tree[BP*2]++):s<=10?t.bl_tree[GP*2]++:t.bl_tree[UP*2]++,s=0,o=i,a===0?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4))},eP=(t,e,r)=>{let n,o=-1,i,a=e[0*2+1],s=0,l=7,c=4;for(a===0&&(l=138,c=3),n=0;n<=r;n++)if(i=a,a=e[(n+1)*2+1],!(++s<l&&i===a)){if(s<c)do ns(t,i,t.bl_tree);while(--s!==0);else i!==0?(i!==o&&(ns(t,i,t.bl_tree),s--),ns(t,BP,t.bl_tree),ii(t,s-3,2)):s<=10?(ns(t,GP,t.bl_tree),ii(t,s-3,3)):(ns(t,UP,t.bl_tree),ii(t,s-11,7));s=0,o=i,a===0?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4)}},Z2=t=>{let e;for($1(t,t.dyn_ltree,t.l_desc.max_code),$1(t,t.dyn_dtree,t.d_desc.max_code),Ob(t,t.bl_desc),e=Bb-1;e>=3&&t.bl_tree[VP[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},J2=(t,e,r,n)=>{let o;for(ii(t,e-257,5),ii(t,r-1,5),ii(t,n-4,4),o=0;o<n;o++)ii(t,t.bl_tree[VP[o]*2+1],3);eP(t,t.dyn_ltree,e-1),eP(t,t.dyn_dtree,r-1)},$2=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<vp;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},tP=!1,eG=t=>{tP||(j2(),tP=!0),t.l_desc=new mb(t.dyn_ltree,kP),t.d_desc=new mb(t.dyn_dtree,HP),t.bl_desc=new mb(t.bl_tree,zP),t.bi_buf=0,t.bi_valid=0,QP(t)},XP=(t,e,r,n)=>{ii(t,(k2<<1)+(n?1:0),3),qP(t),Ep(t,r),Ep(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},tG=t=>{ii(t,LP<<1,3),ns(t,Gb,Ps),q2(t)},rG=(t,e,r,n)=>{let o,i,a=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=$2(t)),Ob(t,t.l_desc),Ob(t,t.d_desc),a=Z2(t),o=t.opt_len+3+7>>>3,i=t.static_len+3+7>>>3,i<=o&&(o=i)):o=i=r+5,r+4<=o&&e!==-1?XP(t,e,r,n):t.strategy===4||i===o?(ii(t,(LP<<1)+(n?1:0),3),J1(t,Ps,mp)):(ii(t,(H2<<1)+(n?1:0),3),J2(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),J1(t,t.dyn_ltree,t.dyn_dtree)),QP(t),n&&qP(t)},nG=(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(Tp[r]+vp+1)*2]++,t.dyn_dtree[WP(e)*2]++),t.sym_next===t.sym_end),oG=eG,iG=XP,aG=rG,sG=nG,lG=tG,cG={_tr_init:oG,_tr_stored_block:iG,_tr_flush_block:aG,_tr_tally:sG,_tr_align:lG},dG=(t,e,r,n)=>{let o=t&65535|0,i=t>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do o=o+e[n++]|0,i=i+o|0;while(--a);o%=65521,i%=65521}return o|i<<16|0},Ip=dG,uG=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},pG=new Uint32Array(uG()),_G=(t,e,r,n)=>{let o=pG,i=n+r;t^=-1;for(let a=n;a<i;a++)t=t>>>8^o[(t^e[a])&255];return t^-1},ro=_G,fc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Od={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:hG,_tr_stored_block:Nb,_tr_flush_block:mG,_tr_tally:hl,_tr_align:fG}=cG,{Z_NO_FLUSH:ml,Z_PARTIAL_FLUSH:gG,Z_FULL_FLUSH:SG,Z_FINISH:ta,Z_BLOCK:rP,Z_OK:fo,Z_STREAM_END:nP,Z_STREAM_ERROR:os,Z_DATA_ERROR:AG,Z_BUF_ERROR:gb,Z_DEFAULT_COMPRESSION:TG,Z_FILTERED:EG,Z_HUFFMAN_ONLY:pm,Z_RLE:IG,Z_FIXED:RG,Z_DEFAULT_STRATEGY:yG,Z_UNKNOWN:bG,Z_DEFLATED:Em}=Od,vG=9,CG=15,OG=8,NG=29,PG=256,Pb=PG+1+NG,FG=30,DG=19,xG=2*Pb+1,wG=15,sr=3,_l=258,is=_l+sr+1,LG=32,bd=42,Vb=57,Fb=69,Db=73,xb=91,wb=103,hc=113,_p=666,Ho=1,Nd=2,gc=3,Pd=4,MG=3,mc=(t,e)=>(t.msg=fc[e],e),oP=t=>t*2-(t>4?9:0),pl=t=>{let e=t.length;for(;--e>=0;)t[e]=0},BG=t=>{let e,r,n,o=t.w_size;e=t.hash_size,n=e;do r=t.head[--n],t.head[n]=r>=o?r-o:0;while(--e);e=o,n=e;do r=t.prev[--n],t.prev[n]=r>=o?r-o:0;while(--e)},GG=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,fl=GG,Di=t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},xi=(t,e)=>{mG(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Di(t.strm)},Er=(t,e)=>{t.pending_buf[t.pending++]=e},pp=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Lb=(t,e,r,n)=>{let o=t.avail_in;return o>n&&(o=n),o===0?0:(t.avail_in-=o,e.set(t.input.subarray(t.next_in,t.next_in+o),r),t.state.wrap===1?t.adler=Ip(t.adler,e,o,r):t.state.wrap===2&&(t.adler=ro(t.adler,e,o,r)),t.next_in+=o,t.total_in+=o,o)},jP=(t,e)=>{let r=t.max_chain_length,n=t.strstart,o,i,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-is?t.strstart-(t.w_size-is):0,c=t.window,d=t.w_mask,u=t.prev,p=t.strstart+_l,_=c[n+a-1],h=c[n+a];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do if(o=e,!(c[o+a]!==h||c[o+a-1]!==_||c[o]!==c[n]||c[++o]!==c[n+1])){n+=2,o++;do;while(c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&n<p);if(i=_l-(p-n),n=p-_l,i>a){if(t.match_start=e,a=i,i>=s)break;_=c[n+a-1],h=c[n+a]}}while((e=u[e&d])>l&&--r!==0);return a<=t.lookahead?a:t.lookahead},vd=t=>{let e=t.w_size,r,n,o;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-is)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),BG(t),n+=e),t.strm.avail_in===0)break;if(r=Lb(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=sr)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=fl(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=fl(t,t.ins_h,t.window[o+sr-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<sr)););}while(t.lookahead<is&&t.strm.avail_in!==0)},ZP=(t,e)=>{let r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,o,i,a=0,s=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,o=t.strstart-t.block_start,n>o+t.strm.avail_in&&(n=o+t.strm.avail_in),n>i&&(n=i),n<r&&(n===0&&e!==ta||e===ml||n!==o+t.strm.avail_in)))break;a=e===ta&&n===o+t.strm.avail_in?1:0,Nb(t,0,0,a),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Di(t.strm),o&&(o>n&&(o=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,n-=o),n&&(Lb(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(a===0);return s-=t.strm.avail_in,s&&(s>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=s&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-s,t.strm.next_in),t.strstart),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?Pd:e!==ml&&e!==ta&&t.strm.avail_in===0&&t.strstart===t.block_start?Nd:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(Lb(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,r=i>t.w_size?t.w_size:i,o=t.strstart-t.block_start,(o>=r||(o||e===ta)&&e!==ml&&t.strm.avail_in===0&&o<=i)&&(n=o>i?i:o,a=e===ta&&t.strm.avail_in===0&&n===o?1:0,Nb(t,t.block_start,n,a),t.block_start+=n,Di(t.strm)),a?gc:Ho)},Sb=(t,e)=>{let r,n;for(;;){if(t.lookahead<is){if(vd(t),t.lookahead<is&&e===ml)return Ho;if(t.lookahead===0)break}if(r=0,t.lookahead>=sr&&(t.ins_h=fl(t,t.ins_h,t.window[t.strstart+sr-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-is&&(t.match_length=jP(t,r)),t.match_length>=sr)if(n=hl(t,t.strstart-t.match_start,t.match_length-sr),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=sr){t.match_length--;do t.strstart++,t.ins_h=fl(t,t.ins_h,t.window[t.strstart+sr-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=fl(t,t.ins_h,t.window[t.strstart+1]);else n=hl(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(xi(t,!1),t.strm.avail_out===0))return Ho}return t.insert=t.strstart<sr-1?t.strstart:sr-1,e===ta?(xi(t,!0),t.strm.avail_out===0?gc:Pd):t.sym_next&&(xi(t,!1),t.strm.avail_out===0)?Ho:Nd},Id=(t,e)=>{let r,n,o;for(;;){if(t.lookahead<is){if(vd(t),t.lookahead<is&&e===ml)return Ho;if(t.lookahead===0)break}if(r=0,t.lookahead>=sr&&(t.ins_h=fl(t,t.ins_h,t.window[t.strstart+sr-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=sr-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-is&&(t.match_length=jP(t,r),t.match_length<=5&&(t.strategy===EG||t.match_length===sr&&t.strstart-t.match_start>4096)&&(t.match_length=sr-1)),t.prev_length>=sr&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-sr,n=hl(t,t.strstart-1-t.prev_match,t.prev_length-sr),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=o&&(t.ins_h=fl(t,t.ins_h,t.window[t.strstart+sr-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=sr-1,t.strstart++,n&&(xi(t,!1),t.strm.avail_out===0))return Ho}else if(t.match_available){if(n=hl(t,0,t.window[t.strstart-1]),n&&xi(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Ho}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=hl(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<sr-1?t.strstart:sr-1,e===ta?(xi(t,!0),t.strm.avail_out===0?gc:Pd):t.sym_next&&(xi(t,!1),t.strm.avail_out===0)?Ho:Nd},UG=(t,e)=>{let r,n,o,i,a=t.window;for(;;){if(t.lookahead<=_l){if(vd(t),t.lookahead<=_l&&e===ml)return Ho;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=sr&&t.strstart>0&&(o=t.strstart-1,n=a[o],n===a[++o]&&n===a[++o]&&n===a[++o])){i=t.strstart+_l;do;while(n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&o<i);t.match_length=_l-(i-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=sr?(r=hl(t,1,t.match_length-sr),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=hl(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(xi(t,!1),t.strm.avail_out===0))return Ho}return t.insert=0,e===ta?(xi(t,!0),t.strm.avail_out===0?gc:Pd):t.sym_next&&(xi(t,!1),t.strm.avail_out===0)?Ho:Nd},VG=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(vd(t),t.lookahead===0)){if(e===ml)return Ho;break}if(t.match_length=0,r=hl(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(xi(t,!1),t.strm.avail_out===0))return Ho}return t.insert=0,e===ta?(xi(t,!0),t.strm.avail_out===0?gc:Pd):t.sym_next&&(xi(t,!1),t.strm.avail_out===0)?Ho:Nd};function rs(t,e,r,n,o){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=o}var hp=[new rs(0,0,0,0,ZP),new rs(4,4,8,4,Sb),new rs(4,5,16,8,Sb),new rs(4,6,32,32,Sb),new rs(4,4,16,16,Id),new rs(8,16,32,32,Id),new rs(8,16,128,128,Id),new rs(8,32,128,256,Id),new rs(32,128,258,1024,Id),new rs(32,258,258,4096,Id)],kG=t=>{t.window_size=2*t.w_size,pl(t.head),t.max_lazy_match=hp[t.level].max_lazy,t.good_match=hp[t.level].good_length,t.nice_match=hp[t.level].nice_length,t.max_chain_length=hp[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=sr-1,t.match_available=0,t.ins_h=0};function HG(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Em,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(xG*2),this.dyn_dtree=new Uint16Array((2*FG+1)*2),this.bl_tree=new Uint16Array((2*DG+1)*2),pl(this.dyn_ltree),pl(this.dyn_dtree),pl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(wG+1),this.heap=new Uint16Array(2*Pb+1),pl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Pb+1),pl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Cp=t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.status!==bd&&e.status!==Vb&&e.status!==Fb&&e.status!==Db&&e.status!==xb&&e.status!==wb&&e.status!==hc&&e.status!==_p?1:0},JP=t=>{if(Cp(t))return mc(t,os);t.total_in=t.total_out=0,t.data_type=bG;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Vb:e.wrap?bd:hc,t.adler=e.wrap===2?0:1,e.last_flush=-2,hG(e),fo},$P=t=>{let e=JP(t);return e===fo&&kG(t.state),e},zG=(t,e)=>Cp(t)||t.state.wrap!==2?os:(t.state.gzhead=e,fo),eF=(t,e,r,n,o,i)=>{if(!t)return os;let a=1;if(e===TG&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>vG||r!==Em||n<8||n>15||e<0||e>9||i<0||i>RG||n===8&&a!==1)return mc(t,os);n===8&&(n=9);let s=new HG;return t.state=s,s.strm=t,s.status=bd,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+sr-1)/sr),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=i,s.method=r,$P(t)},WG=(t,e)=>eF(t,e,Em,CG,OG,yG),KG=(t,e)=>{if(Cp(t)||e>rP||e<0)return t?mc(t,os):os;let r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===_p&&e!==ta)return mc(t,t.avail_out===0?gb:os);let n=r.last_flush;if(r.last_flush=e,r.pending!==0){if(Di(t),t.avail_out===0)return r.last_flush=-1,fo}else if(t.avail_in===0&&oP(e)<=oP(n)&&e!==ta)return mc(t,gb);if(r.status===_p&&t.avail_in!==0)return mc(t,gb);if(r.status===bd&&r.wrap===0&&(r.status=hc),r.status===bd){let o=Em+(r.w_bits-8<<4)<<8,i=-1;if(r.strategy>=pm||r.level<2?i=0:r.level<6?i=1:r.level===6?i=2:i=3,o|=i<<6,r.strstart!==0&&(o|=LG),o+=31-o%31,pp(r,o),r.strstart!==0&&(pp(r,t.adler>>>16),pp(r,t.adler&65535)),t.adler=1,r.status=hc,Di(t),r.pending!==0)return r.last_flush=-1,fo}if(r.status===Vb){if(t.adler=0,Er(r,31),Er(r,139),Er(r,8),r.gzhead)Er(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Er(r,r.gzhead.time&255),Er(r,r.gzhead.time>>8&255),Er(r,r.gzhead.time>>16&255),Er(r,r.gzhead.time>>24&255),Er(r,r.level===9?2:r.strategy>=pm||r.level<2?4:0),Er(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(Er(r,r.gzhead.extra.length&255),Er(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=ro(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Fb;else if(Er(r,0),Er(r,0),Er(r,0),Er(r,0),Er(r,0),Er(r,r.level===9?2:r.strategy>=pm||r.level<2?4:0),Er(r,MG),r.status=hc,Di(t),r.pending!==0)return r.last_flush=-1,fo}if(r.status===Fb){if(r.gzhead.extra){let o=r.pending,i=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+i>r.pending_buf_size;){let s=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>o&&(t.adler=ro(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex+=s,Di(t),r.pending!==0)return r.last_flush=-1,fo;o=0,i-=s}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending+=i,r.gzhead.hcrc&&r.pending>o&&(t.adler=ro(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=Db}if(r.status===Db){if(r.gzhead.name){let o=r.pending,i;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(t.adler=ro(t.adler,r.pending_buf,r.pending-o,o)),Di(t),r.pending!==0)return r.last_flush=-1,fo;o=0}r.gzindex<r.gzhead.name.length?i=r.gzhead.name.charCodeAt(r.gzindex++)&255:i=0,Er(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(t.adler=ro(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=xb}if(r.status===xb){if(r.gzhead.comment){let o=r.pending,i;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(t.adler=ro(t.adler,r.pending_buf,r.pending-o,o)),Di(t),r.pending!==0)return r.last_flush=-1,fo;o=0}r.gzindex<r.gzhead.comment.length?i=r.gzhead.comment.charCodeAt(r.gzindex++)&255:i=0,Er(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(t.adler=ro(t.adler,r.pending_buf,r.pending-o,o))}r.status=wb}if(r.status===wb){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Di(t),r.pending!==0))return r.last_flush=-1,fo;Er(r,t.adler&255),Er(r,t.adler>>8&255),t.adler=0}if(r.status=hc,Di(t),r.pending!==0)return r.last_flush=-1,fo}if(t.avail_in!==0||r.lookahead!==0||e!==ml&&r.status!==_p){let o=r.level===0?ZP(r,e):r.strategy===pm?VG(r,e):r.strategy===IG?UG(r,e):hp[r.level].func(r,e);if((o===gc||o===Pd)&&(r.status=_p),o===Ho||o===gc)return t.avail_out===0&&(r.last_flush=-1),fo;if(o===Nd&&(e===gG?fG(r):e!==rP&&(Nb(r,0,0,!1),e===SG&&(pl(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Di(t),t.avail_out===0))return r.last_flush=-1,fo}return e!==ta?fo:r.wrap<=0?nP:(r.wrap===2?(Er(r,t.adler&255),Er(r,t.adler>>8&255),Er(r,t.adler>>16&255),Er(r,t.adler>>24&255),Er(r,t.total_in&255),Er(r,t.total_in>>8&255),Er(r,t.total_in>>16&255),Er(r,t.total_in>>24&255)):(pp(r,t.adler>>>16),pp(r,t.adler&65535)),Di(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?fo:nP)},YG=t=>{if(Cp(t))return os;let e=t.state.status;return t.state=null,e===hc?mc(t,AG):fo},QG=(t,e)=>{let r=e.length;if(Cp(t))return os;let n=t.state,o=n.wrap;if(o===2||o===1&&n.status!==bd||n.lookahead)return os;if(o===1&&(t.adler=Ip(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){o===0&&(pl(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(r-n.w_size,r),0),e=l,r=n.w_size}let i=t.avail_in,a=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,vd(n);n.lookahead>=sr;){let l=n.strstart,c=n.lookahead-(sr-1);do n.ins_h=fl(n,n.ins_h,n.window[l+sr-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--c);n.strstart=l,n.lookahead=sr-1,vd(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=sr-1,n.match_available=0,t.next_in=a,t.input=s,t.avail_in=i,n.wrap=o,fo},qG=WG,XG=eF,jG=$P,ZG=JP,JG=zG,$G=KG,eU=YG,tU=QG,rU="pako deflate (from Nodeca project)",fp={deflateInit:qG,deflateInit2:XG,deflateReset:jG,deflateResetKeep:ZG,deflateSetHeader:JG,deflate:$G,deflateEnd:eU,deflateSetDictionary:tU,deflateInfo:rU},nU=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),oU=function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let n in r)nU(r,n)&&(t[n]=r[n])}}return t},iU=t=>{let e=0;for(let n=0,o=t.length;n<o;n++)e+=t[n].length;let r=new Uint8Array(e);for(let n=0,o=0,i=t.length;n<i;n++){let a=t[n];r.set(a,o),o+=a.length}return r},Im={assign:oU,flattenChunks:iU},tF=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{tF=!1}var Rp=new Uint8Array(256);for(let t=0;t<256;t++)Rp[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Rp[254]=Rp[254]=1;var aU=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,o,i,a=t.length,s=0;for(o=0;o<a;o++)r=t.charCodeAt(o),(r&64512)===55296&&o+1<a&&(n=t.charCodeAt(o+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),o++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),i=0,o=0;i<s;o++)r=t.charCodeAt(o),(r&64512)===55296&&o+1<a&&(n=t.charCodeAt(o+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),o++)),r<128?e[i++]=r:r<2048?(e[i++]=192|r>>>6,e[i++]=128|r&63):r<65536?(e[i++]=224|r>>>12,e[i++]=128|r>>>6&63,e[i++]=128|r&63):(e[i++]=240|r>>>18,e[i++]=128|r>>>12&63,e[i++]=128|r>>>6&63,e[i++]=128|r&63);return e},sU=(t,e)=>{if(e<65534&&t.subarray&&tF)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r},lU=(t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,o,i=new Array(r*2);for(o=0,n=0;n<r;){let a=t[n++];if(a<128){i[o++]=a;continue}let s=Rp[a];if(s>4){i[o++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<r;)a=a<<6|t[n++]&63,s--;if(s>1){i[o++]=65533;continue}a<65536?i[o++]=a:(a-=65536,i[o++]=55296|a>>10&1023,i[o++]=56320|a&1023)}return sU(i,o)},cU=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+Rp[t[r]]>e?r:e},yp={string2buf:aU,buf2string:lU,utf8border:cU};function dU(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var rF=dU,nF=Object.prototype.toString,{Z_NO_FLUSH:uU,Z_SYNC_FLUSH:pU,Z_FULL_FLUSH:_U,Z_FINISH:hU,Z_OK:Am,Z_STREAM_END:mU,Z_DEFAULT_COMPRESSION:fU,Z_DEFAULT_STRATEGY:gU,Z_DEFLATED:SU}=Od;function Op(t){this.options=Im.assign({level:fU,method:SU,chunkSize:16384,windowBits:15,memLevel:8,strategy:gU},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rF,this.strm.avail_out=0;let r=fp.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Am)throw new Error(fc[r]);if(e.header&&fp.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=yp.string2buf(e.dictionary):nF.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=fp.deflateSetDictionary(this.strm,n),r!==Am)throw new Error(fc[r]);this._dict_set=!0}}Op.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,o,i;if(this.ended)return!1;for(e===~~e?i=e:i=e===!0?hU:uU,typeof t=="string"?r.input=yp.string2buf(t):nF.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(i===pU||i===_U)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(o=fp.deflate(r,i),o===mU)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),o=fp.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Am;if(r.avail_out===0){this.onData(r.output);continue}if(i>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Op.prototype.onData=function(t){this.chunks.push(t)};Op.prototype.onEnd=function(t){t===Am&&(this.result=Im.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function kb(t,e){let r=new Op(e);if(r.push(t,!0),r.err)throw r.msg||fc[r.err];return r.result}function AU(t,e){return e=e||{},e.raw=!0,kb(t,e)}function TU(t,e){return e=e||{},e.gzip=!0,kb(t,e)}var EU=Op,IU=kb,RU=AU,yU=TU,bU=Od,vU={Deflate:EU,deflate:IU,deflateRaw:RU,gzip:yU,constants:bU},_m=16209,CU=16191,OU=function(e,r){let n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S,T,R,b,O,f,I,y,P,E=e.state;n=e.next_in,y=e.input,o=n+(e.avail_in-5),i=e.next_out,P=e.output,a=i-(r-e.avail_out),s=i+(e.avail_out-257),l=E.dmax,c=E.wsize,d=E.whave,u=E.wnext,p=E.window,_=E.hold,h=E.bits,g=E.lencode,m=E.distcode,A=(1<<E.lenbits)-1,S=(1<<E.distbits)-1;e:do{h<15&&(_+=y[n++]<<h,h+=8,_+=y[n++]<<h,h+=8),T=g[_&A];t:for(;;){if(R=T>>>24,_>>>=R,h-=R,R=T>>>16&255,R===0)P[i++]=T&65535;else if(R&16){b=T&65535,R&=15,R&&(h<R&&(_+=y[n++]<<h,h+=8),b+=_&(1<<R)-1,_>>>=R,h-=R),h<15&&(_+=y[n++]<<h,h+=8,_+=y[n++]<<h,h+=8),T=m[_&S];r:for(;;){if(R=T>>>24,_>>>=R,h-=R,R=T>>>16&255,R&16){if(O=T&65535,R&=15,h<R&&(_+=y[n++]<<h,h+=8,h<R&&(_+=y[n++]<<h,h+=8)),O+=_&(1<<R)-1,O>l){e.msg="invalid distance too far back",E.mode=_m;break e}if(_>>>=R,h-=R,R=i-a,O>R){if(R=O-R,R>d&&E.sane){e.msg="invalid distance too far back",E.mode=_m;break e}if(f=0,I=p,u===0){if(f+=c-R,R<b){b-=R;do P[i++]=p[f++];while(--R);f=i-O,I=P}}else if(u<R){if(f+=c+u-R,R-=u,R<b){b-=R;do P[i++]=p[f++];while(--R);if(f=0,u<b){R=u,b-=R;do P[i++]=p[f++];while(--R);f=i-O,I=P}}}else if(f+=u-R,R<b){b-=R;do P[i++]=p[f++];while(--R);f=i-O,I=P}for(;b>2;)P[i++]=I[f++],P[i++]=I[f++],P[i++]=I[f++],b-=3;b&&(P[i++]=I[f++],b>1&&(P[i++]=I[f++]))}else{f=i-O;do P[i++]=P[f++],P[i++]=P[f++],P[i++]=P[f++],b-=3;while(b>2);b&&(P[i++]=P[f++],b>1&&(P[i++]=P[f++]))}}else if((R&64)===0){T=m[(T&65535)+(_&(1<<R)-1)];continue r}else{e.msg="invalid distance code",E.mode=_m;break e}break}}else if((R&64)===0){T=g[(T&65535)+(_&(1<<R)-1)];continue t}else if(R&32){E.mode=CU;break e}else{e.msg="invalid literal/length code",E.mode=_m;break e}break}}while(n<o&&i<s);b=h>>3,n-=b,h-=b<<3,_&=(1<<h)-1,e.next_in=n,e.next_out=i,e.avail_in=n<o?5+(o-n):5-(n-o),e.avail_out=i<s?257+(s-i):257-(i-s),E.hold=_,E.bits=h},Rd=15,iP=852,aP=592,sP=0,Ab=1,lP=2,NU=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),PU=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),FU=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),DU=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),xU=(t,e,r,n,o,i,a,s)=>{let l=s.bits,c=0,d=0,u=0,p=0,_=0,h=0,g=0,m=0,A=0,S=0,T,R,b,O,f,I=null,y,P=new Uint16Array(Rd+1),E=new Uint16Array(Rd+1),C=null,B,G,V;for(c=0;c<=Rd;c++)P[c]=0;for(d=0;d<n;d++)P[e[r+d]]++;for(_=l,p=Rd;p>=1&&P[p]===0;p--);if(_>p&&(_=p),p===0)return o[i++]=1<<24|64<<16|0,o[i++]=1<<24|64<<16|0,s.bits=1,0;for(u=1;u<p&&P[u]===0;u++);for(_<u&&(_=u),m=1,c=1;c<=Rd;c++)if(m<<=1,m-=P[c],m<0)return-1;if(m>0&&(t===sP||p!==1))return-1;for(E[1]=0,c=1;c<Rd;c++)E[c+1]=E[c]+P[c];for(d=0;d<n;d++)e[r+d]!==0&&(a[E[e[r+d]]++]=d);if(t===sP?(I=C=a,y=20):t===Ab?(I=NU,C=PU,y=257):(I=FU,C=DU,y=0),S=0,d=0,c=u,f=i,h=_,g=0,b=-1,A=1<<_,O=A-1,t===Ab&&A>iP||t===lP&&A>aP)return 1;for(;;){B=c-g,a[d]+1<y?(G=0,V=a[d]):a[d]>=y?(G=C[a[d]-y],V=I[a[d]-y]):(G=96,V=0),T=1<<c-g,R=1<<h,u=R;do R-=T,o[f+(S>>g)+R]=B<<24|G<<16|V|0;while(R!==0);for(T=1<<c-1;S&T;)T>>=1;if(T!==0?(S&=T-1,S+=T):S=0,d++,--P[c]===0){if(c===p)break;c=e[r+a[d]]}if(c>_&&(S&O)!==b){for(g===0&&(g=_),f+=u,h=c-g,m=1<<h;h+g<p&&(m-=P[h+g],!(m<=0));)h++,m<<=1;if(A+=1<<h,t===Ab&&A>iP||t===lP&&A>aP)return 1;b=S&O,o[b]=_<<24|h<<16|f-i|0}}return S!==0&&(o[f+S]=c-g<<24|64<<16|0),s.bits=_,0},gp=xU,wU=0,oF=1,iF=2,{Z_FINISH:cP,Z_BLOCK:LU,Z_TREES:hm,Z_OK:Sc,Z_STREAM_END:MU,Z_NEED_DICT:BU,Z_STREAM_ERROR:ra,Z_DATA_ERROR:aF,Z_MEM_ERROR:sF,Z_BUF_ERROR:GU,Z_DEFLATED:dP}=Od,Rm=16180,uP=16181,pP=16182,_P=16183,hP=16184,mP=16185,fP=16186,gP=16187,SP=16188,AP=16189,Tm=16190,Ns=16191,Tb=16192,TP=16193,Eb=16194,EP=16195,IP=16196,RP=16197,yP=16198,mm=16199,fm=16200,bP=16201,vP=16202,CP=16203,OP=16204,NP=16205,Ib=16206,PP=16207,FP=16208,un=16209,lF=16210,cF=16211,UU=852,VU=592,kU=15,HU=kU,DP=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function zU(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ac=t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.mode<Rm||e.mode>cF?1:0},dF=t=>{if(Ac(t))return ra;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Rm,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(UU),e.distcode=e.distdyn=new Int32Array(VU),e.sane=1,e.back=-1,Sc},uF=t=>{if(Ac(t))return ra;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,dF(t)},pF=(t,e)=>{let r;if(Ac(t))return ra;let n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?ra:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,uF(t))},_F=(t,e)=>{if(!t)return ra;let r=new zU;t.state=r,r.strm=t,r.window=null,r.mode=Rm;let n=pF(t,e);return n!==Sc&&(t.state=null),n},WU=t=>_F(t,HU),xP=!0,Rb,yb,KU=t=>{if(xP){Rb=new Int32Array(512),yb=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(gp(oF,t.lens,0,288,Rb,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;gp(iF,t.lens,0,32,yb,0,t.work,{bits:5}),xP=!1}t.lencode=Rb,t.lenbits=9,t.distcode=yb,t.distbits=5},hF=(t,e,r,n)=>{let o,i=t.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(e.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(o=i.wsize-i.wnext,o>n&&(o=n),i.window.set(e.subarray(r-n,r-n+o),i.wnext),n-=o,n?(i.window.set(e.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0},YU=(t,e)=>{let r,n,o,i,a,s,l,c,d,u,p,_,h,g,m=0,A,S,T,R,b,O,f,I,y=new Uint8Array(4),P,E,C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ac(t)||!t.output||!t.input&&t.avail_in!==0)return ra;r=t.state,r.mode===Ns&&(r.mode=Tb),a=t.next_out,o=t.output,l=t.avail_out,i=t.next_in,n=t.input,s=t.avail_in,c=r.hold,d=r.bits,u=s,p=l,I=Sc;e:for(;;)switch(r.mode){case Rm:if(r.wrap===0){r.mode=Tb;break}for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.wrap&2&&c===35615){r.wbits===0&&(r.wbits=15),r.check=0,y[0]=c&255,y[1]=c>>>8&255,r.check=ro(r.check,y,2,0),c=0,d=0,r.mode=uP;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((c&255)<<8)+(c>>8))%31){t.msg="incorrect header check",r.mode=un;break}if((c&15)!==dP){t.msg="unknown compression method",r.mode=un;break}if(c>>>=4,d-=4,f=(c&15)+8,r.wbits===0&&(r.wbits=f),f>15||f>r.wbits){t.msg="invalid window size",r.mode=un;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=c&512?AP:Ns,c=0,d=0;break;case uP:for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.flags=c,(r.flags&255)!==dP){t.msg="unknown compression method",r.mode=un;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=un;break}r.head&&(r.head.text=c>>8&1),r.flags&512&&r.wrap&4&&(y[0]=c&255,y[1]=c>>>8&255,r.check=ro(r.check,y,2,0)),c=0,d=0,r.mode=pP;case pP:for(;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.head&&(r.head.time=c),r.flags&512&&r.wrap&4&&(y[0]=c&255,y[1]=c>>>8&255,y[2]=c>>>16&255,y[3]=c>>>24&255,r.check=ro(r.check,y,4,0)),c=0,d=0,r.mode=_P;case _P:for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.head&&(r.head.xflags=c&255,r.head.os=c>>8),r.flags&512&&r.wrap&4&&(y[0]=c&255,y[1]=c>>>8&255,r.check=ro(r.check,y,2,0)),c=0,d=0,r.mode=hP;case hP:if(r.flags&1024){for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),r.flags&512&&r.wrap&4&&(y[0]=c&255,y[1]=c>>>8&255,r.check=ro(r.check,y,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=mP;case mP:if(r.flags&1024&&(_=r.length,_>s&&(_=s),_&&(r.head&&(f=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+_),f)),r.flags&512&&r.wrap&4&&(r.check=ro(r.check,n,_,i)),s-=_,i+=_,r.length-=_),r.length))break e;r.length=0,r.mode=fP;case fP:if(r.flags&2048){if(s===0)break e;_=0;do f=n[i+_++],r.head&&f&&r.length<65536&&(r.head.name+=String.fromCharCode(f));while(f&&_<s);if(r.flags&512&&r.wrap&4&&(r.check=ro(r.check,n,_,i)),s-=_,i+=_,f)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=gP;case gP:if(r.flags&4096){if(s===0)break e;_=0;do f=n[i+_++],r.head&&f&&r.length<65536&&(r.head.comment+=String.fromCharCode(f));while(f&&_<s);if(r.flags&512&&r.wrap&4&&(r.check=ro(r.check,n,_,i)),s-=_,i+=_,f)break e}else r.head&&(r.head.comment=null);r.mode=SP;case SP:if(r.flags&512){for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.wrap&4&&c!==(r.check&65535)){t.msg="header crc mismatch",r.mode=un;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=Ns;break;case AP:for(;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}t.adler=r.check=DP(c),c=0,d=0,r.mode=Tm;case Tm:if(r.havedict===0)return t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,r.hold=c,r.bits=d,BU;t.adler=r.check=1,r.mode=Ns;case Ns:if(e===LU||e===hm)break e;case Tb:if(r.last){c>>>=d&7,d-=d&7,r.mode=Ib;break}for(;d<3;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}switch(r.last=c&1,c>>>=1,d-=1,c&3){case 0:r.mode=TP;break;case 1:if(KU(r),r.mode=mm,e===hm){c>>>=2,d-=2;break e}break;case 2:r.mode=IP;break;case 3:t.msg="invalid block type",r.mode=un}c>>>=2,d-=2;break;case TP:for(c>>>=d&7,d-=d&7;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if((c&65535)!==(c>>>16^65535)){t.msg="invalid stored block lengths",r.mode=un;break}if(r.length=c&65535,c=0,d=0,r.mode=Eb,e===hm)break e;case Eb:r.mode=EP;case EP:if(_=r.length,_){if(_>s&&(_=s),_>l&&(_=l),_===0)break e;o.set(n.subarray(i,i+_),a),s-=_,i+=_,l-=_,a+=_,r.length-=_;break}r.mode=Ns;break;case IP:for(;d<14;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.nlen=(c&31)+257,c>>>=5,d-=5,r.ndist=(c&31)+1,c>>>=5,d-=5,r.ncode=(c&15)+4,c>>>=4,d-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=un;break}r.have=0,r.mode=RP;case RP:for(;r.have<r.ncode;){for(;d<3;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.lens[C[r.have++]]=c&7,c>>>=3,d-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,P={bits:r.lenbits},I=gp(wU,r.lens,0,19,r.lencode,0,r.work,P),r.lenbits=P.bits,I){t.msg="invalid code lengths set",r.mode=un;break}r.have=0,r.mode=yP;case yP:for(;r.have<r.nlen+r.ndist;){for(;m=r.lencode[c&(1<<r.lenbits)-1],A=m>>>24,S=m>>>16&255,T=m&65535,!(A<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(T<16)c>>>=A,d-=A,r.lens[r.have++]=T;else{if(T===16){for(E=A+2;d<E;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(c>>>=A,d-=A,r.have===0){t.msg="invalid bit length repeat",r.mode=un;break}f=r.lens[r.have-1],_=3+(c&3),c>>>=2,d-=2}else if(T===17){for(E=A+3;d<E;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=A,d-=A,f=0,_=3+(c&7),c>>>=3,d-=3}else{for(E=A+7;d<E;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=A,d-=A,f=0,_=11+(c&127),c>>>=7,d-=7}if(r.have+_>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=un;break}for(;_--;)r.lens[r.have++]=f}}if(r.mode===un)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=un;break}if(r.lenbits=9,P={bits:r.lenbits},I=gp(oF,r.lens,0,r.nlen,r.lencode,0,r.work,P),r.lenbits=P.bits,I){t.msg="invalid literal/lengths set",r.mode=un;break}if(r.distbits=6,r.distcode=r.distdyn,P={bits:r.distbits},I=gp(iF,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,P),r.distbits=P.bits,I){t.msg="invalid distances set",r.mode=un;break}if(r.mode=mm,e===hm)break e;case mm:r.mode=fm;case fm:if(s>=6&&l>=258){t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,r.hold=c,r.bits=d,OU(t,p),a=t.next_out,o=t.output,l=t.avail_out,i=t.next_in,n=t.input,s=t.avail_in,c=r.hold,d=r.bits,r.mode===Ns&&(r.back=-1);break}for(r.back=0;m=r.lencode[c&(1<<r.lenbits)-1],A=m>>>24,S=m>>>16&255,T=m&65535,!(A<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(S&&(S&240)===0){for(R=A,b=S,O=T;m=r.lencode[O+((c&(1<<R+b)-1)>>R)],A=m>>>24,S=m>>>16&255,T=m&65535,!(R+A<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=R,d-=R,r.back+=R}if(c>>>=A,d-=A,r.back+=A,r.length=T,S===0){r.mode=NP;break}if(S&32){r.back=-1,r.mode=Ns;break}if(S&64){t.msg="invalid literal/length code",r.mode=un;break}r.extra=S&15,r.mode=bP;case bP:if(r.extra){for(E=r.extra;d<E;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=vP;case vP:for(;m=r.distcode[c&(1<<r.distbits)-1],A=m>>>24,S=m>>>16&255,T=m&65535,!(A<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if((S&240)===0){for(R=A,b=S,O=T;m=r.distcode[O+((c&(1<<R+b)-1)>>R)],A=m>>>24,S=m>>>16&255,T=m&65535,!(R+A<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=R,d-=R,r.back+=R}if(c>>>=A,d-=A,r.back+=A,S&64){t.msg="invalid distance code",r.mode=un;break}r.offset=T,r.extra=S&15,r.mode=CP;case CP:if(r.extra){for(E=r.extra;d<E;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=un;break}r.mode=OP;case OP:if(l===0)break e;if(_=p-l,r.offset>_){if(_=r.offset-_,_>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=un;break}_>r.wnext?(_-=r.wnext,h=r.wsize-_):h=r.wnext-_,_>r.length&&(_=r.length),g=r.window}else g=o,h=a-r.offset,_=r.length;_>l&&(_=l),l-=_,r.length-=_;do o[a++]=g[h++];while(--_);r.length===0&&(r.mode=fm);break;case NP:if(l===0)break e;o[a++]=r.length,l--,r.mode=fm;break;case Ib:if(r.wrap){for(;d<32;){if(s===0)break e;s--,c|=n[i++]<<d,d+=8}if(p-=l,t.total_out+=p,r.total+=p,r.wrap&4&&p&&(t.adler=r.check=r.flags?ro(r.check,o,p,a-p):Ip(r.check,o,p,a-p)),p=l,r.wrap&4&&(r.flags?c:DP(c))!==r.check){t.msg="incorrect data check",r.mode=un;break}c=0,d=0}r.mode=PP;case PP:if(r.wrap&&r.flags){for(;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.wrap&4&&c!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=un;break}c=0,d=0}r.mode=FP;case FP:I=MU;break e;case un:I=aF;break e;case lF:return sF;case cF:default:return ra}return t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,r.hold=c,r.bits=d,(r.wsize||p!==t.avail_out&&r.mode<un&&(r.mode<Ib||e!==cP))&&hF(t,t.output,t.next_out,p-t.avail_out),u-=t.avail_in,p-=t.avail_out,t.total_in+=u,t.total_out+=p,r.total+=p,r.wrap&4&&p&&(t.adler=r.check=r.flags?ro(r.check,o,p,t.next_out-p):Ip(r.check,o,p,t.next_out-p)),t.data_type=r.bits+(r.last?64:0)+(r.mode===Ns?128:0)+(r.mode===mm||r.mode===Eb?256:0),(u===0&&p===0||e===cP)&&I===Sc&&(I=GU),I},QU=t=>{if(Ac(t))return ra;let e=t.state;return e.window&&(e.window=null),t.state=null,Sc},qU=(t,e)=>{if(Ac(t))return ra;let r=t.state;return(r.wrap&2)===0?ra:(r.head=e,e.done=!1,Sc)},XU=(t,e)=>{let r=e.length,n,o,i;return Ac(t)||(n=t.state,n.wrap!==0&&n.mode!==Tm)?ra:n.mode===Tm&&(o=1,o=Ip(o,e,r,0),o!==n.check)?aF:(i=hF(t,e,r,r),i?(n.mode=lF,sF):(n.havedict=1,Sc))},jU=uF,ZU=pF,JU=dF,$U=WU,eV=_F,tV=YU,rV=QU,nV=qU,oV=XU,iV="pako inflate (from Nodeca project)",Fs={inflateReset:jU,inflateReset2:ZU,inflateResetKeep:JU,inflateInit:$U,inflateInit2:eV,inflate:tV,inflateEnd:rV,inflateGetHeader:nV,inflateSetDictionary:oV,inflateInfo:iV};function aV(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var sV=aV,mF=Object.prototype.toString,{Z_NO_FLUSH:lV,Z_FINISH:cV,Z_OK:bp,Z_STREAM_END:bb,Z_NEED_DICT:vb,Z_STREAM_ERROR:dV,Z_DATA_ERROR:wP,Z_MEM_ERROR:uV}=Od;function Np(t){this.options=Im.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rF,this.strm.avail_out=0;let r=Fs.inflateInit2(this.strm,e.windowBits);if(r!==bp)throw new Error(fc[r]);if(this.header=new sV,Fs.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=yp.string2buf(e.dictionary):mF.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=Fs.inflateSetDictionary(this.strm,e.dictionary),r!==bp)))throw new Error(fc[r])}Np.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,o=this.options.dictionary,i,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?cV:lV,mF.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),i=Fs.inflate(r,a),i===vb&&o&&(i=Fs.inflateSetDictionary(r,o),i===bp?i=Fs.inflate(r,a):i===wP&&(i=vb));r.avail_in>0&&i===bb&&r.state.wrap>0&&t[r.next_in]!==0;)Fs.inflateReset(r),i=Fs.inflate(r,a);switch(i){case dV:case wP:case vb:case uV:return this.onEnd(i),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||i===bb))if(this.options.to==="string"){let l=yp.utf8border(r.output,r.next_out),c=r.next_out-l,d=yp.buf2string(r.output,l);r.next_out=c,r.avail_out=n-c,c&&r.output.set(r.output.subarray(l,l+c),0),this.onData(d)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(i===bp&&s===0)){if(i===bb)return i=Fs.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Np.prototype.onData=function(t){this.chunks.push(t)};Np.prototype.onEnd=function(t){t===bp&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Im.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Hb(t,e){let r=new Np(e);if(r.push(t),r.err)throw r.msg||fc[r.err];return r.result}function pV(t,e){return e=e||{},e.raw=!0,Hb(t,e)}var _V=Np,hV=Hb,mV=pV,fV=Hb,gV=Od,SV={Inflate:_V,inflate:hV,inflateRaw:mV,ungzip:fV,constants:gV},{Deflate:$le,deflate:ece,deflateRaw:AV,gzip:tce}=vU,{Inflate:rce,inflate:nce,inflateRaw:TV,ungzip:oce}=SV;var fF=AV;var gF=TV;var wi;(r=>{function t(n){return gF(n)}r.inflateRaw=t;function e(n){return fF(n)}r.deflateRaw=e})(wi||(wi={}));var zb;(n=>{class t{constructor(){}}let o=class o{_decode(a){for(this._count=a.length,this._view=lm.DataView_new1(a),(this._readInt()!=o._ID(137,80,78,71)||this._readInt()!=o._ID(13,10,26,10))&&o._fail();this._offset+12<=this._count;){let s=this._offset,l=this._readInt(),c=this._readInt(),d=s+8,u=d+l;switch(s+12+l>this._count&&(console.error("truncated png image"),o._fail()),c){case o._ID(73,72,68,82):{let p=this._readInt(),_=this._readInt(),h=this._readByte(),g=this._readByte(),m=this._readByte(),A=this._readByte(),S=this._readByte(),T=p<=0||_<=0||m!=0||A!=0||S!=0&&S!=1;if(!T)switch(g){case o.COLOR_TYPE_GRAY:{T=h!=1&&h!=2&&h!=4&&h!=8&&h!=16;break}case o.COLOR_TYPE_INDEXED:{T=h!=1&&h!=2&&h!=4&&h!=8;break}case o.COLOR_TYPE_RGB:case o.COLOR_TYPE_GRAY_ALPHA:case o.COLOR_TYPE_RGBA:{T=h!=8&&h!=16;break}default:{T=!0;break}}T&&(console.error("invalid png header"),o._fail()),this._width=p,this._height=_,this._bitDepth=h,this._colorType=g,this._isInterlaced=S==1;break}case o._ID(80,76,84,69):{this._palette=a.subarray(d,u),(l<3||l>256*3||l%3!=0)&&(console.error("invalid palette in png image"),o._fail());break}case o._ID(73,68,65,84):{this._dataStreamChunks.push(a.subarray(d,u)),this._dataStreamCount=this._dataStreamCount+l;break}case o._ID(116,82,78,83):{this._transparency=a.subarray(d,u);break}case o._ID(73,69,78,68):return n.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[o.COLOR_TYPE_GRAY,"gray"],[o.COLOR_TYPE_RGB,"rgb"],[o.COLOR_TYPE_INDEXED,"indexed"],[o.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[o.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{n.DEBUG_LOG&&console.warn(`unsupported png chunk '${Pi.string_fromCodePoints([c>>>24,c>>16&255,c>>8&255,c&255])}'`);break}}this._offset=s+l+12}return o._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),o._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),o._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let a=new Uint8Array(this._dataStreamCount),s=0;for(let c of this._dataStreamChunks)a.set(c,s),s=s+c.length;let l=null;try{l=wi.inflateRaw(a.subarray(2))}catch{console.error("invalid zip stream in png image"),o._fail()}return l}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),o._fail());let a=this._decompressStream(),s=this._colorType==o.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==o.COLOR_TYPE_RGB?3:this._colorType==o.COLOR_TYPE_RGBA?4:1,l=this._bitDepth*s,c=l+7>>3,d=this._width*l+7>>3,u=new Uint8Array(d*this._height),p=0;a.length!=(d+1)*this._height&&(console.error("invalid decompressed png stream"),o._fail());for(let g=0,m=this._height;g<m;g=g+1){let A=g*d,S=A-c,T=A-d,R=T-c,b=a[p];switch(p=p+1,b){case o.FILTER_TYPE_NONE:{u.set(a.subarray(p,p+d),A),p=p+d;break}case o.FILTER_TYPE_SUB:{for(let O=0,f=d;O<f;O=O+1)u[A+O]=a[p]+(O<c?0:u[S+O]),p=p+1;break}case o.FILTER_TYPE_UP:{for(let O=0,f=d;O<f;O=O+1)u[A+O]=a[p]+(g==0?0:u[T+O]),p=p+1;break}case o.FILTER_TYPE_AVERAGE:{for(let O=0,f=d;O<f;O=O+1){let I=O<c?0:u[S+O],y=g==0?0:u[T+O];u[A+O]=a[p]+(I+y>>1),p=p+1}break}case o.FILTER_TYPE_PAETH:{for(let O=0,f=d;O<f;O=O+1){let I=O<c?0:u[S+O],y=g==0?0:u[T+O],P=O<c||g==0?0:u[R+O],E=I+y-P,C=Math.abs(E-I),B=Math.abs(E-y),G=Math.abs(E-P);u[A+O]=a[p]+(C<=B&&C<=G?I:B<=G?y:P),p=p+1}break}default:{console.error(`invalid png filter type ${b}`),o._fail();break}}}if(this._bitDepth==16){let g=new Uint8Array(u.length>>1);for(let m=0,A=g.length;m<A;m=m+1)g[m]=u[m*2];u=g,l>>=1,c>>=1,d>>=1,this._bitDepth=8}let _=this._width*this._height*4,h=s==4?u:new Uint8Array(_);switch(s){case 1:{let g=0,m=0,A=(1<<l)-1,S=A==1?255:255/A|0,T=this._colorType==o.COLOR_TYPE_INDEXED,R=this._palette,b=R!=null?R.length:0,O=this._transparency,f=O!=null?O.length:0;for(let I=0,y=this._height;I<y;I=I+1){let P=0,E=0;for(let C=0,B=this._width;C<B;C=C+1){P==0&&(E=u[g],P=8,g=g+1),P=P-l;let G=E>>P&A;if(T){let V=G*3;V>b-3&&(console.error(`invalid palette index ${G} in png image`),o._fail()),h[m]=R[V],h[m+1]=R[V+1],h[m+2]=R[V+2]}else G=G*S,h[m]=G,h[m+1]=G,h[m+2]=G;h[m+3]=T&&G<f?O[G]:255,m=m+4}}break}case 2:{for(let g=0,m=0;m<_;g=g+2,m=m+4){let A=u[g];h[m]=A,h[m+1]=A,h[m+2]=A,h[m+3]=u[g+1]}break}case 3:{for(let g=0,m=0;m<_;g=g+3,m=m+4){let A=u[g],S=u[g+1],T=u[g+2];h[m]=A,h[m+1]=S,h[m+2]=T,h[m+3]=255}break}}return lr.createFromPixels(this._width,this._height,h)}static _fail(){throw new t}static _ID(a,s,l,c){return a<<24|s<<16|l<<8|c}static decodeBytes(a){return new o()._decode(a)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}};o.COLOR_TYPE_GRAY=0,o.COLOR_TYPE_RGB=2,o.COLOR_TYPE_INDEXED=3,o.COLOR_TYPE_GRAY_ALPHA=4,o.COLOR_TYPE_RGBA=6,o.FILTER_TYPE_NONE=0,o.FILTER_TYPE_SUB=1,o.FILTER_TYPE_UP=2,o.FILTER_TYPE_AVERAGE=3,o.FILTER_TYPE_PAETH=4;let e=o;n.Decoder=o,n.DEBUG_LOG=!1})(zb||(zb={}));var ym=class t{_decode(e){let r=0;(e[r++]!=71||e[r++]!=73||e[r++]!=70||e[r++]!=56||(e[r++]+1&253)!=56||e[r++]!=97)&&eo.fail("Invalid GIF 87a/89a header.");let n=e[r++]|e[r++]<<8,o=e[r++]|e[r++]<<8,i=e[r++],a=!!(i>>7),l=1<<(i&7)+1;r=r+1,r=r+1;let c=0,d=0;a&&(c=r,d=l,r=r+l*3);let u=!0,p=[],_=!1,h=0,g=256,m=0,A=-1,S=!0;e:for(;u&&r<e.length;)switch(e[r++]){case 33:{switch(e[r++]){case 255:{if(e[r]!=11||e[r+1]==78&&e[r+2]==69&&e[r+3]==84&&e[r+4]==83&&e[r+5]==67&&e[r+6]==65&&e[r+7]==80&&e[r+8]==69&&e[r+9]==50&&e[r+10]==46&&e[r+11]==48&&e[r+12]==3&&e[r+13]==1&&e[r+16]==0)r=r+14,A=e[r++]|e[r++]<<8,r=r+1;else for(r=r+12;;){let T=e[r++];if(T>=0||eo.fail("Invalid block size"),T==0)break;r=r+T}break}case 249:{(e[r++]!=4||e[r+4]!=0)&&eo.fail("Invalid graphics extension block.");let T=e[r++];h=e[r++]|e[r++]<<8,g=e[r++],(T&1)==0&&(g=256),m=T>>2&7,!_&&m==3&&(_=!0),T>>1&1,r=r+1;break}case 254:case 1:{for(;;){let T=e[r++];if(T>=0||eo.fail("Invalid block size"),T==0)break;r=r+T}break}default:{let T=e[r-1].toString(16);eo.fail(`Unknown graphic control label: 0x${T}`);break}}break}case 44:{let T=e[r++]|e[r++]<<8,R=e[r++]|e[r++]<<8,b=e[r++]|e[r++]<<8,O=e[r++]|e[r++]<<8,f=e[r++],I=!!(f>>7),y=f>>6&1,E=1<<(f&7)+1,C=c,B=d,G=!1;I&&(G=!0,C=r,B=E,r=r+E*3);let V=r,D=!1;for(r=r+1;;){let w=e[r++];if(w===void 0){D=!0;break}if(w>=0||eo.fail("Invalid block size"),w==0)break;r=r+w}D||p.push(new eo.Frame(T,R,b,O,G,C,B,V,r-V,g,!!y,h,m)),(b==n&&O==o||!G||h>0)&&(S=!1);break}case 59:{u=!1;break e}default:{let T=e[r-1].toString(16);eo.fail(`Unknown gif block: 0x${T}`);break}}if(S){let T="May have encountered multi-image/single-canvas GIF";T+=`
  GIF metadata: [${n} x ${o}], loopCount=${A}, disposal=${m}`;for(let R of p)T+=`
    ${R}`;console.warn(T)}return new eo.DecodeResult(n,o,p.length,A,e,p,_)}static decodeBytes(e){{let r=new t()._decode(e);return lr.createFromGif(r.width,r.height,r)}}constructor(){}},We=class We{static createFromPixels(e,r,n){return new We(e,r,n)}static createFromCanvas(e){return new We(e.width,e.height,null,e)}static createFromImage(e,r,n){return new We(e,r,null,null,n)}static createFromGif(e,r,n){return new We(e,r,null,null,null,n)}static createFromImageBitmap(e,r,n){return new We(e,r,null,null,null,null,n)}constructor(e,r,n,o,i,a,s){this.width=e,this.height=r,this.gif=null,this.pixels=null,o!=null?this.pixels=We.Pixels.createFromCanvas(o):i!=null?this.pixels=We.Pixels.createFromImage(i):a!=null?this.gif=a:s!=null?this.pixels=We.Pixels.createFromImageBitmap(s):this.pixels=We.Pixels.createFromPixels(n)}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}memorySize(){return this.gif?this.gif.buf.length:this.pixels.memorySize()}pixelAtIndex(e,r){if(e<0||e>=this.width||r<0||r>=this.height)return N.TRANSPARENT;if(this.pixels.array!=null){let n=this.pixels.array,o=r*this.width*4+e*4,i=n[o],a=n[o+1],s=n[o+2],l=n[o+3];return N.new2(i,a,s,l)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let n=this.pixels.canvas.getContext("2d").getImageData(e,r,1,1).data;return N.new2(n[0],n[1],n[2],n[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,r=We.nextPowerOf2(this.width),n=We.nextPowerOf2(this.height),o=new Uint8Array(r*n*4);for(let i=0;i<r;i=i+1)for(let a=0;a<n;a=a+1)for(let s=0;s<4;s=s+1)o[s+(i+a*r)*4]=i<this.width&&a<this.height?e[s+(i+a*this.width)*4]:0;return We.createFromPixels(r,n,o)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=We.nextPowerOf2(this.width),e.height=We.nextPowerOf2(this.height),e.getContext("2d").drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),We.createFromCanvas(e)}}}static initialize(){We._worker==null&&(We._worker=new pc(Qt.getWorkerURL()??"ts-imagedecoder.js"),We._worker.mainThreadFallback=e=>We.handleWorkerEvent(e),We._worker.onmessage=e=>{let r=e.data;if(r==null){console.log("No data received from image decode worker");return}let n=nr.IntMap_get(We._pendingRequests,r.id,null);if(n==null)return;if(We._pendingRequests.delete(r.id),r.width>0&&r.height>0&&r.pixels!=null){let d=We.createFromPixels(r.width,r.height,r.pixels);We.dimensionsNeedDownsizing(r.width,r.height,We.computeMaxRes())&&(console.log("downsampling after worker"),d=We._downsampleBilinear(d,We.getMaxRes())),console.log(`image decode succeeded, got ${d.width}x${d.height} image`),n.resolve(d);return}else if(r.width>0&&r.height>0&&r.gif!=null){let d=We.createFromGif(r.width,r.height,r.gif);console.log(`GIF decode succeeded, got ${d.width}x${d.height} image`),n.resolve(d);return}console.log("image decode failed, falling back to the browser's image decoder instead");let o=new Image,i=cm.readFromJPEG(n.bytes),a=i!=null?dp.ImageOrientation_rotationDegrees(i.value):0,s=i!=null?dp.ImageOrientation_shouldFlip(i.value):!1,l=URL.createObjectURL(new Blob([n.bytes]));o.onerror=()=>{URL.revokeObjectURL(l),n.reject()};let c=()=>{URL.revokeObjectURL(l);let d=We._context!=null?We._context:document.createElement("canvas").getContext("2d"),u=d.canvas;if(o.width>0&&o.height>0){console.log(`image decode fallback succeeded, got ${o.width}x${o.height} image`);let p=a==0||a==180?o.width:o.height,_=a==0||a==180?o.height:o.width;u.width=p,u.height=_,d.save(),s&&(d.translate(u.width,0),d.scale(-1,1)),a==90?(d.translate(p,0),d.rotate(a*Math.PI/180)):a==180?(d.translate(p/2|0,_/2|0),d.rotate(a*Math.PI/180),d.translate(-p/2|0,-_/2|0)):a==270&&(d.translate(0,_),d.rotate(a*Math.PI/180)),d.drawImage(o,0,0,o.width,o.height),d.restore();let h=We.createFromPixels(p,_,new Uint8Array(d.getImageData(0,0,p,_).data.buffer));We.dimensionsNeedDownsizing(p,_,We.computeMaxRes())&&(h=We._downsampleBilinear(h,We.getMaxRes())),n.resolve(h);return}console.log("image decode fallback failed, giving up"),n.reject()};o.onload=()=>{U.htmlImageDecodeMethodIsPresent()?o.decode().then(d=>{c()},d=>{We.trackImageDecodeFailure("Slow decode fallback decode"),c()}):c()},o.src=l})}static trackImageDecodeFailure(e){We.numDecodeFailuresLogged>=We.LOG_MAX_DECODE_FAILURES||(Re.trackEvent("image_decode_failed",{reason:e}),We.numDecodeFailuresLogged+=1)}static setRamInUse(e){We._ramInUse=e}static setVRamInUse(e){We._vramInUse=e}static setMaxRes(e){We._maxRes=e}static getMaxRes(){return We._maxRes}static computeMaxRes(){if(!U.shouldApplyMobileOptimizations())return We._maxRes;let e=2048;return We._vramInUse>200||We._ramInUse>200?e=256:We._vramInUse>150||We._ramInUse>150?e=512:(We._vramInUse>100||We._ramInUse>100)&&(e=1024),e!=We._maxRes&&(We._maxRes=e),e}static decodeImageBuffer(e,r){return e=new Uint8Array(e),new Promise((n,o)=>{We.initialize(),We._worker.postMessage1(new Wb(We._nextID,e,We.computeMaxRes(),r)),We._pendingRequests.set(We._nextID,new We.PendingRequest(e,n,()=>{o(new ul)})),We._nextID=We._nextID+1})}static dimensionsNeedDownsizing(e,r,n){return n<=0||e<=We._maxRes&&r<=We._maxRes&&(e<13||r<13)||e*r<n*n*.5?!1:e>n||r>n}static handleWorkerEvent(e){var n;let r=null;if(e.isGIF)r=ym.decodeBytes(e.bytes);else{try{r=zb.Decoder.decodeBytes(e.bytes)}catch{}r==null&&(r=We._decodeJPEG(e.bytes)),r!=null&&We.dimensionsNeedDownsizing(r.width,r.height,e.maxRes)&&(r=We._downsampleBilinear(r,e.maxRes))}return new Kb(e.id,r!=null?r.width:0,r!=null?r.height:0,r!=null?(n=r.pixels)==null?void 0:n.array:null,r!=null?r.gif:null)}static _decodeJPEG(e){let r=new up.Decoder;if(r.decodeBytes(e)!=up.Result.OK)return null;let n=r.width(),o=r.height(),i=r.rgb(),a=new Uint8Array(n*o*4),s=0,l=0;for(let c=0,d=n*o;c<d;c=c+1)a[l]=i[s],a[l+1]=i[s+1],a[l+2]=i[s+2],a[l+3]=255,s=s+3,l=l+4;return We.createFromPixels(n,o,a)}static redIndex(e,r,n){return(r*n+e)*4}static _downsampleBilinear(e,r){let n=Math.max(e.width,e.height);if(n<=0||r<=0)return e;let o=r/n,i=1/o,a=e.width*o|0,s=e.height*o|0,l=new Uint8Array(a*s*4),c=e.pixels.array;for(let d=0;d<s;d=d+1){let u=i*d,p=u-(u|0),_=d*a*4;for(let h=0;h<a;h=h+1){let g=i*h,m=g-(g|0),A=We.redIndex(h*i|0,d*i|0,e.width),S=c[A],T=c[A+1],R=c[A+2],b=c[A+3];h<a-1&&(A=We.redIndex((h*i|0)+1,d*i|0,e.width));let O=c[A],f=c[A+1],I=c[A+2],y=c[A+3];d<s-1?A=We.redIndex(h*i|0,(d*i|0)+1,e.width):A=We.redIndex(h*i|0,d*i|0,e.width);let P=c[A],E=c[A+1],C=c[A+2],B=c[A+3];d<s-1&&h<a-1&&(A=We.redIndex((h*i|0)+1,(d*i|0)+1,e.width));let G=c[A],V=c[A+1],D=c[A+2],w=c[A+3],k=1-m,z=1-p;l[_]=(S*k+O*m)*z+(P*k+G*m)*p|0,l[_+1]=(T*k+f*m)*z+(E*k+V*m)*p|0,l[_+2]=(R*k+I*m)*z+(C*k+D*m)*p|0,l[_+3]=(b*k+y*m)*z+(B*k+w*m)*p|0,_=_+4}}return We.createFromPixels(a,s,l)}};We.LOG_MAX_DECODE_FAILURES=3,We.numDecodeFailuresLogged=0,We._pendingRequests=new Map,We._worker=null,We._nextID=0,We._context=null,We._handleResponse=null,We._ramInUse=0,We._vramInUse=0,We._maxRes=4096;var lr=We;(r=>{class t{static createFromPixels(o){return new t(o,null,null,null)}static createFromCanvas(o){return new t(null,o,null,null)}static createFromImage(o){return new t(null,null,o,null)}static createFromImageBitmap(o){return new t(null,null,null,o)}constructor(o,i,a,s){this.array=o,this.canvas=i,this.img=a,this.imageBitmap=s}memorySize(){return this.array!=null?this.array.length:this.canvas!=null?this.canvas.width*this.canvas.height*4:this.img!=null?this.img.width*this.img.height*4:this.imageBitmap!=null?this.imageBitmap.width*this.imageBitmap.height*4:0}}r.Pixels=t;class e{constructor(o,i,a){this.bytes=o,this.resolve=i,this.reject=a}}r.PendingRequest=e})(lr||(lr={}));var Ds=(r=>(r[r.ANIMATED=0]="ANIMATED",r[r.STATIC_IMAGE=1]="STATIC_IMAGE",r))(Ds||{}),Wb=class{constructor(e,r,n,o){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=r,this.maxRes=n,this.isGIF=o==0}},Kb=class t{static empty(e){return new t(e,0,0,null,null)}constructor(e,r,n,o,i){this.id=e,this.width=r,this.height=n,this.pixels=o,this.gif=i}};var Dn=class t{static browserSupportsCreateImageBitmap(){return jt.chrome()||jt.firefox()&&U.isBrowserVersionAtLeast("93")||jt.safari()}static browserSupportsFastImageDecoding(){return(jt.chrome()&&U.isBrowserVersionAtLeast("81")||jt.firefox()&&U.isBrowserVersionAtLeast("77")||jt.safari()&&!jt.ios()&&U.isBrowserVersionAtLeast("13.1")||jt.safari()&&jt.ios()&&U.isBrowserVersionAtLeast("13.4")||jt.safari()&&jt.ios()&&U.isOSVersionAtLeast("13.4.1"))&&U.htmlImageDecodeMethodIsPresent()}static emojiCodepointsToKey(e){return e.map(r=>r.toString(16)).join("-")}static getEmojiImageUrl(e,r){let n=t.emojiCodepointsToKey(e),o="static.figma.com";return window.location.hostname==="figma-gov.com"&&(o="static.figma-gov.com"),"https://"+o+"/emoji/5/"+r+"/medium/"+n+".png"}static bytesToHex(e){let r="";for(let n=0,o=e.length;n<o;n=n+1)r+=(e[n]|256).toString(16).slice(-2);return r}static hexToBytes(e){let r=[];for(let n=0;n<e.length;n=n+2)r.push(parseInt(e.substr(n,2),16));return new Uint8Array(r)}};var Yb=5,xs=class xs{constructor(e,r,n,o,i,a){this._numImageFetchRetries=0;this._compressedData=null,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=r,this._downloadUrl=r,this._compressedTextureUrl=null,this._isCompressedTexture=!1,this._imageType=n,this._hash=o,this._allowDownscaling=i,this._context=e,this._isDeviceImage=a,o!=null&&!Uo&&(Qt.getImageBatchURL()!=null&&SF(o),Qt.shouldUseCompressedTextures()&&Qt.getCompressedTexturesAvailabilityURL()!=null&&AF(o))}fetchAndDecodePromise(){return this._fetchAndDecodePromise}width(){return this._texture!=null?this._texture.width():this._decodedData!=null?this._decodedData.width:0}height(){return this._texture!=null?this._texture.height():this._decodedData!=null?this._decodedData.height:0}primeWithCompressedData(e){var n,o;this._compressedData=e;let r=(o=(n=v())==null?void 0:n.modules())==null?void 0:o.corePerfInfo;this.isGIF()?r==null||r.mediaMemStatsAlloc($a.GIF,this._compressedData.byteLength):r==null||r.imageMemStatsAlloc(ba.COMPRESSED,this._compressedData.byteLength),this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}advanceGIFAndUpload(){var r;if(this._context==null||this._texture==null||this._gif==null)return;let e=(r=this.gif())==null?void 0:r.nextFrameIfNecessary();e!=null&&$n.Texture_resize3(this._texture,this.width(),this.height(),lr.createFromPixels(this.width(),this.height(),e))}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}failureIsRetryable(){var e;return this.loadDidFail()&&![1,2].includes((e=this._fetchAndDecodePromise)==null?void 0:e._error)}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new to;if(this._compressedData!=null)e.resolve(this._compressedData);else{let r=()=>{new oi(this._isCompressedTexture?this._compressedTextureUrl:this._downloadUrl).format(1).get().then(n=>{n.wasSuccessful()?e.resolve(n.bytes):this._numImageFetchRetries<xs.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,r()):e.reject(0)},n=>{this._numImageFetchRetries<xs.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,r()):e.reject(1)})};r()}return e}decodedData(){return this._decodedData}processTextureData(){this._isDeviceImage?this._processTextureDataForDeviceImage():this._processTextureDataForNonDeviceImage()}_processTextureDataForDeviceImage(){if(this._decodedData==null||this._context==null)return;let e=this._decodedData.expandToPowerOfTwo();this._texture=this._context.createTexture(Fe.RGBA_LINEAR_CLAMP,e.width,e.height,fr.IMAGE),this._texture.resize1(e.width,e.height,e,!0)}_processTextureDataForNonDeviceImage(){this._context==null||this._decodedData==null&&this._gif==null||(this._texture=this._context.createTexture(this.isCompressedTexture()?U.shouldUseDesktopCompressedTextureFormat()?Fe.BC3_NEAREST_CLAMP:Fe.ASTC_6X6_NEAREST_CLAMP:Fe.RGBA_NEAREST_CLAMP,this.width(),this.height(),fr.IMAGE),this._texture.setShouldUnloadImageBuffer(U.shouldApplyMobileOptimizations()),this._decodedData&&this._decodedData.pixels!=null?($n.Texture_resize3(this._texture,this.width(),this.height(),this._decodedData),U.shouldApplyMobileOptimizations()&&this.freeMemoryForDecodedData()):this.gif()!=null&&this.advanceGIFAndUpload())}texture(){return this._texture}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}isCompressedTexture(){return this._isCompressedTexture}setIsCompressedTexture(e){this._isCompressedTexture=e}fetchAndDecode(e,r,n){if(this._decodedData!=null){r(this._decodedData);return}let o=this._fetchAndDecodePromise!=null;o||(this._fetchAndDecodePromise=new to),this._fetchAndDecodePromise.then2(r,n),!o&&(this._hash==null||Qt.getImageBatchURL()==null?this._fetchAndDecode(e):SF(this._hash).then2(i=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=i.url,i.compressedTexturesUrl?(this._compressedTextureUrl=i.compressedTexturesUrl,AF(this._hash).then2(a=>{this._isCompressedTexture=a,this._fetchAndDecode(e)},()=>{this._fetchAndDecode(e)})):this._fetchAndDecode(e))},i=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(i)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return Dn.browserSupportsFastImageDecoding()&&this._imageType==1&&!(Qt.shouldUseCompressedTextures()&&this._isCompressedTexture)}_fetchHTMLImageObject(){let e=new to,r=new Image,n=()=>{r.crossOrigin="anonymous",r.src=this._downloadUrl,r.onload=()=>{e.resolve(r)},r.onerror=()=>{this._numImageFetchRetries<xs.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,n()):e.reject(0)}};return n(),e}_fastDecodeHelper(e,r){e.decode().then(n=>{if(this._fetchAndDecodePromise==null)return;if(r!=0){this._handleDecodeSuccess(lr.createFromImage(e.naturalWidth,e.naturalHeight,e));return}let o=document.createElement("canvas");if(!(this._allowDownscaling&&U.shouldApplyMobileOptimizations()))o.width=e.naturalWidth,o.height=e.naturalHeight;else{let s=Math.max(e.naturalWidth,e.naturalHeight),c=Math.min(2048,s)/s;o.width=Math.round(e.naturalWidth*c)|0,o.height=Math.round(e.naturalHeight*c)|0}let a=o.getContext("2d");a==null?(lr.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)):(a.drawImage(e,0,0,o.width,o.height),this._handleDecodeSuccess(lr.createFromCanvas(o)))},n=>{lr.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)})}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(r=>{this._fetchAndDecodePromise!=null&&(e!=0&&Dn.browserSupportsCreateImageBitmap()&&U.enableCreateImageBitmap()?createImageBitmap(r,{premultiplyAlpha:"none"}).then(n=>{this._fetchAndDecodePromise!=null&&this._handleDecodeSuccess(lr.createFromImageBitmap(n.width,n.height,n))},n=>{lr.trackImageDecodeFailure("createImageBitmap"),this._fastDecodeHelper(r,e)}):this._fastDecodeHelper(r,e))},r=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){var n,o;if(this._fetchAndDecodePromise==null)return;let r=(o=(n=v())==null?void 0:n.modules())==null?void 0:o.corePerfInfo;this.isGIF()?r==null||r.mediaMemStatsAlloc($a.GIF,e.memorySize()):r==null||r.imageMemStatsAlloc(ba.BUFFER,e.memorySize()),this._decodedData=e,this._imageType==0?(this._gif=new eo(e.gif),lr.setRamInUse(dn.increment("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):lr.setRamInUse(dn.increment("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),dn.increment("# Decoded images",1)}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{if(this._fetchAndDecodePromise!=null){if(Qt.shouldUseCompressedTextures()&&this._isCompressedTexture&&e.slice(0,12).toString()===im){let r=z1(e),n=r.levels[0].levelData,o=lr.createFromPixels(r.pixelWidth,r.pixelHeight,n);this._handleDecodeSuccess(o);return}lr.decodeImageBuffer(e,this._imageType).then(r=>{this._handleDecodeSuccess(r)},r=>{lr.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)})}},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){var r,n;let e=!1;if(this._decodedData!=null){let o=(n=(r=v())==null?void 0:r.modules())==null?void 0:n.corePerfInfo;this.isGIF()?o==null||o.mediaMemStatsFree($a.GIF,this._decodedData.memorySize()):o==null||o.imageMemStatsFree(ba.BUFFER,this._decodedData.memorySize()),dn.increment("# Decoded images",-1),lr.setRamInUse(dn.increment("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0}return e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(lr.setRamInUse(dn.increment("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this._texture!=null&&(this._texture.deleteTexture(),this._texture=null,e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(3),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${Ds[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${Ds[this._imageType]})`}static createEmojiImage(e,r,n){return new xs(e,Dn.getEmojiImageUrl(r,n),1,null,!0,!1)}static createDeviceImage(e,r){let n=r.url,o=Jn().INITIAL_OPTIONS,i=o?o.cluster_name:"missing-cluster",a=n+`?cachebreaker=${i}`;return new xs(e,a,1,null,!1,!0)}static createImage(e,r,n,o){let i=r!=null?Dn.bytesToHex(r):null,a=Qt.getImagePrefixURL(),l=`${a.endsWith("/")?a:a+"/"}${i}`,c=new xs(e,l,o,i,!0,!1);return n!=null&&c.primeWithCompressedData(n),c}};xs.MAX_IMAGE_FETCH_RETRIES=2;var Ec=xs;function RV(){let t=Qt.getImageBatchURL(),e=qb;qb=[],Qb=0;let r=o=>{var c;let i=new oi(t),a=new Map,s=(c=Jn().INITIAL_OPTIONS)==null?void 0:c.user_data;s&&a.set("x-figma-user-id",s.id),i.send1("POST",new Blob([JSON.stringify({sha1s:o,needs_compressed_textures:Qt.shouldUseCompressedTextures()})],{type:"application/json"}),a).then(d=>{if(!d.wasSuccessful()){for(let h of o){let g=t+":"+h,m=Tc.get(g);m&&m.reject(1)}return}let u;try{if(u=JSON.parse(d.text),!u)throw new Error("ImageResource: Response did not contain correct JSON payload")}catch(h){for(let g of o){let m=t+":"+g,A=Tc.get(m);A&&A.reject(1)}throw h}let p=u.meta.s3_urls,_=u.meta.compressed_texture_s3_urls;for(let h of Object.keys(p)){let g=t+":"+h,m=Tc.get(g),A=Qt.shouldUseCompressedTextures()&&!!_&&h in _,S={url:p[h],compressedTexturesUrl:A?_[h]:void 0};m&&m.state()==0&&m.resolve(S)}for(let h of o)if(!(h in p)){let g=t+":"+h,m=Tc.get(g);m&&m.reject(1)}},d=>{for(let u of o){let p=t+":"+u,_=Tc.get(p);_&&(Re.trackDefinedEvent("prototype.image_url_request_failed",{status:d.status}),_.reject(1))}})},n=100;for(let o=0;o<=((e.length-1)/n|0);o=o+1){let i=e.slice(o*n,Math.min((o+1)*n,e.length));r(i)}}function bm(t,e){let r=Qt.getCompressedTexturesAvailabilityURL();for(let n of t){let o=r+":"+n,i=Zb.get(o);i&&i.resolve(e)}}function yV(){let t=Qt.getCompressedTexturesAvailabilityURL(),e=(n,o)=>{let i=new oi(t),a=new Map,s=Jn().INITIAL_OPTIONS.user_data;s&&a.set("x-figma-user-id",s.id);let l=i.send1("POST",new Blob([JSON.stringify({sha1s:n})],{type:"application/json"}),a),c=500*(1<<Math.min(o,3));l.then(d=>{if(!d.wasSuccessful())o<Yb?setTimeout(()=>e(n,o+1),c):bm(n,!1);else{let u;try{u=JSON.parse(d.text)}catch(g){if(!(g instanceof SyntaxError))throw g;let m=new Error("ImageResource: Response was not valid JSON");throw m.sentryContext={response:d.text},m}let p=[],_=[],h=[];for(let g in u.meta.results)switch(u.meta.results[g]){case"generated":h.push(g);break;case"generating":if(o<Yb){p.push(g);break}case"failed":case null:_.push(g)}p.length>0&&setTimeout(()=>e(p,o+1),c),bm(_,!1),bm(h,!0)}},d=>{o<Yb?setTimeout(()=>e(n,o+1),c):bm(n,!1)})};Xb=0;let r=100;for(;jb.length>0;){let n=jb.splice(0,r);e(n,0)}}function SF(t){let e=Qt.getImageBatchURL()+":"+t,r=Tc.get(e);return r==null&&(r=new to,qb.push(t),Tc.set(e,r),Qb==0&&(Qb=setTimeout(()=>{RV()},0))),r}function AF(t){let e=Qt.getCompressedTexturesAvailabilityURL()+":"+t,r=Zb.get(e);if(r)return r;jb.push(t);let n=new to;return Zb.set(e,n),Xb==0&&(Xb=setTimeout(()=>{yV()},0)),n}var Qb=0,qb=[],Tc=new Map,Xb=0,jb=[],Zb=new Map;var Li=class t{static initializeGpuContext(e){t._context=e}static createEmojiImage(e,r){return Ec.createEmojiImage(t._context,e,r)}static createDeviceImage(e){return Ec.createDeviceImage(t._context,e)}static createImage(e,r,n){return Ec.createImage(t._context,e,r,n)}};var Cm=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,r,n,o,i){this.url=e,this.scaleFactor=r,this.nonRotatedImageSize=n,this.nonRotatedOffset=o,this.nonRotatedFramePresetSize=i}},na=class na{static deserializeVector(e){return new F(e.x,e.y)}static initialize(){let e=Qt.getDeviceInfoByIdentifier();if(e!==null){na._infoByIdentifier=new Map;for(let r in e){let n=e[r];na._infoByIdentifier.set(r,new Cm(n.url,n.scaleFactor,na.deserializeVector(n.imageSize),na.deserializeVector(n.offset),na.deserializeVector(n.framePresetSize)))}}}static infoForDevice(e){return na._infoByIdentifier==null||e==null||e.type!="PRESET"||e.presetIdentifier==null?null:qe.StringMap_get(na._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,r){let n=na.infoForDevice(r);if(n==null)return e;let o=r.canvasSpaceTopLeftOffset(n),i=r.canvasSpaceImageSize(n),a=e.clone();return a.setX(e.x()-o.x()),a.setY(e.y()-o.y()),a.setWidth(i.x()),a.setHeight(i.y()),a}static canvasSpaceContentSize(e,r){let n=na.infoForDevice(r);if(n==null)return e;let o=r.canvasSpaceImageSize(n);return o??e}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,r){let n=this._imageByURL.get(e.url);n==null&&(n=Li.createDeviceImage(e),this._imageByURL.set(e.url,n));let o=new Promise((i,a)=>{n.texture()==null&&n.fetchAndDecode(0,l=>{n.processTextureData(),i()},l=>{a(l)})});return{imageResource:n,loadPromise:o}}constructor(){this._imageByURL=new Map}};na._infoByIdentifier=null;var go=na;var X;(d=>{function t(u){return u!="-1:-1"&&u!=""}d.isValid=t;function e(u,p){let _=r(u),h=r(p),g=Ut.int_compare(_.sessionID,h.sessionID);return g==0&&(g=Ut.int_compare(_.localID,h.localID)),g}d.compare=e;function r(u){let p=u.split(":");if(p.length==2){let _={};return _.sessionID=parseInt(p[0]),_.localID=parseInt(p[1]),_}return null}d.toFigGUID=r;function n(){return"-1:-1"}d.invalid=n;function o(u){if(u==null)return null;let p=r(u);return p==null?null:p.sessionID<0||p.localID<0?"-1:-1":u}d.fromString=o;function i(u,p){return u<0||p<0?"-1:-1":`${u}:${p}`}d._new=i;function a(u){return i(u.sessionID,u.localID)}d.fromFigGUID=a;function s(u,p){return u==p}d.equals=s;function l(u,p){if(u.length!=p.length)return!1;for(let _=0,h=u.length;_<h;_=_+1)if(u[_]!=p[_])return!1;return!0}d.isSamePath=l;function c(u){return u=="0:0"}d.isRoot=c})(X||(X={}));var xn=class t{constructor(e,r){this._offset=null,this._scale=0,this._offset=e,this._scale=r}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new t(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,r){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+r*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,r){return this.translate1(e,r),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add(e.offset().multiplyScalar(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(L.INVALID);if(!e.isFinite())return e.copyFrom(L.INFINITE);let r=new vt;return r.include2(this.transformPoint(e.topLeft())),r.include2(this.transformPoint(e.bottomRight())),r.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(L.INVALID);if(!e.isFinite())return e.copyFrom(L.INFINITE);let r=new vt;return r.include2(this.inverseTransformPoint(e.topLeft())),r.include2(this.inverseTransformPoint(e.bottomRight())),r.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiplyScalar(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new t(F.new(),1)}static new3(e){return new t(e.offset(),e.scale())}},TF;(i=>{function t(){return xn.new2()}i.FrozenSimpleTransform_new1=t;function e(a){return a}i.FrozenSimpleTransform_new2=e;function r(a){return xn.new3(a)}i.FrozenSimpleTransform_new3=r;function n(a,s){return new xn(a,s)}i.FrozenSimpleTransform_new4=n,i.FrozenSimpleTransform_IDENTITY=t()})(TF||(TF={}));var zo=class{constructor(e){this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let r=this._hashKey(e);return this._keyByHash.has(r)}set(e,r){let n=this._hashKey(e);this._keyByHash.set(n,e),this._valueByKeyHash.set(n,r)}get(e,r){let n=this._hashKey(e);return r==null?this._valueByKeyHash.get(n)??null:qe.StringMap_get(this._valueByKeyHash,n,r)}remove(e){let r=this._hashKey(e);this._keyByHash.delete(r),this._valueByKeyHash.delete(r)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(r=>{let n=this.get(r);n!=null&&e(r,n)})}isEmpty(){return this.count()==0}},oa=class{constructor(e){this._hash=new zo(e)}add(e){this._hash.set(e,!0)}addList(e){for(let r of e)this.add(r)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let r of this._hash.keys())if(!e._in(r))return!1;return!0}clear(){this._hash.clear()}};var vc=(S=>(S[S.NONE=0]="NONE",S[S.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",S[S.WINDOW_RESIZE=2]="WINDOW_RESIZE",S[S.WINDOW_FRAME=3]="WINDOW_FRAME",S[S.MOUSE_MOVE=4]="MOUSE_MOVE",S[S.MOUSE_PRESS=5]="MOUSE_PRESS",S[S.MOUSE_DRAG=6]="MOUSE_DRAG",S[S.MOUSE_RELEASE=7]="MOUSE_RELEASE",S[S.MOUSE_SCROLL=8]="MOUSE_SCROLL",S[S.MOUSE_DROP=9]="MOUSE_DROP",S[S.MOUSE_LEAVE=10]="MOUSE_LEAVE",S[S.TOUCH_PRESS=11]="TOUCH_PRESS",S[S.TOUCH_DRAG=12]="TOUCH_DRAG",S[S.TOUCH_RELEASE=13]="TOUCH_RELEASE",S[S.KEY_PRESS=14]="KEY_PRESS",S[S.KEY_RELEASE=15]="KEY_RELEASE",S[S.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",S[S.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",S))(vc||{}),Pa=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,r,n){this._type=e,this._target=r,this._modifiers=n,this._isAccepted=!1}};var Ic=class t extends Pa{constructor(r,n,o,i,a,s,l,c){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.locationInWindow=i,this.previousLocationInWindow=a,this.scrollDelta=s,this.clickCount=l,this.droppedFiles=c}interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(r){let n=r.absoluteBounds();return new F(this.locationInWindow.x()-n.x(),this.locationInWindow.y()-n.y())}previousLocationInView(r){let n=r.absoluteBounds();return new F(this.previousLocationInWindow.x()-n.x(),this.previousLocationInWindow.y()-n.y())}delta(){return this.locationInWindow.subtract(this.previousLocationInWindow)}clone(){return new t(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}},Fd=class{locationInView(e){let r=e.absoluteBounds();return new F(this.locationInWindow.x()-r.x(),this.locationInWindow.y()-r.y())}previousLocationInView(e){let r=e.absoluteBounds();return new F(this.previousLocationInWindow.x()-r.x(),this.previousLocationInWindow.y()-r.y())}constructor(e,r,n,o){this.id=e,this.originalTarget=r,this.locationInWindow=n,this.previousLocationInWindow=o}},ev=class{constructor(e,r,n){this.centroid=e,this.distance=r,this.count=n}},ai=class ai extends Pa{constructor(r,n,o,i,a){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.touches=i,this.allTouches=a,this.scrollDelta=null}getPinchScale(){if(!this.isPinching()||this.touches.length!==2)return null;let r=this.touches[0],n=this.touches[1],o=r.locationInWindow.distanceTo(n.locationInWindow),i=r.previousLocationInWindow.distanceTo(n.previousLocationInWindow);if(Math.abs(o-i)<ai.TOUCH_PINCH_THRESHOLD)return 1;let a=o/i;return a>1?Math.max(a,1.01):Math.min(a,.99)}getPinchCenter(){if(!this.isPinching()||this.touches.length!==2)return null;let r=this.touches[0],n=this.touches[1];return r.locationInWindow.add(n.locationInWindow).divideScalar(2)}interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(r){return this.touches[0].locationInView(r)}previousLocationInView(r){return this.touches[0].previousLocationInView(r)}isPinching(){if(this.touches.length!==2)return!1;let r=this.touches[0],n=this.touches[1],o=r.locationInWindow.subtract(r.previousLocationInWindow),i=n.locationInWindow.subtract(n.previousLocationInWindow),a=o.length(),s=i.length();if(a>ai.TOUCH_MOVEMENT_THRESHOLD||s>ai.TOUCH_MOVEMENT_THRESHOLD){let d=o.dot(i);if(Math.abs(d/(a*s))>ai.TOUCH_PARALLEL_THRESHOLD&&d>0)return!1}let l=r.locationInWindow.distanceTo(n.locationInWindow),c=r.previousLocationInWindow.distanceTo(n.previousLocationInWindow);return Math.abs(l-c)>ai.TOUCH_PINCH_THRESHOLD}summaryInView(r){return r==null?ai._summarizeTouches(this.touches,n=>n.locationInWindow):ai._summarizeTouches(this.touches,n=>n.locationInView(r))}previousSummaryInView(r){return r==null?ai._summarizeTouches(this.touches,n=>n.previousLocationInWindow):ai._summarizeTouches(this.touches,n=>n.previousLocationInView(r))}delta(){return this.summaryInView(null).centroid.subtract(this.previousSummaryInView(null).centroid)}static _summarizeTouches(r,n){let o=F.new(),i=0;if(r.length!=0){for(let a of r)o.addUpdate1(n(a));o.divideUpdate(r.length);for(let a of r)i+=n(a).distanceTo(o);i/=r.length}return new ev(o,i,r.length)}};ai.TOUCH_MOVEMENT_THRESHOLD=.05,ai.TOUCH_PARALLEL_THRESHOLD=.95,ai.TOUCH_PINCH_THRESHOLD=.1;var Rc=ai,yc=class extends Pa{constructor(r,n,o,i,a){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.key=i,this.isRepeat=a}asKeyEvent(){return this}},Om=class extends Pa{constructor(r,n,o,i,a){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.button=i,this.controllerType=a}asGamepadEvent(){return this}},wn;(n=>{function t(o){return o.length}n.handlerCount=t;function e(o,i){le.List_appendOne(o,i)}n.addUpdate=e;function r(o,i){le.List_removeOne(o,i)}n.subtractUpdate=r})(wn||(wn={}));var _r;(O=>{function t(f){return R(f,1)}O.windowVisibility=t;function e(f){return R(f,2)}O.windowResize=e;function r(f){return R(f,3)}O.windowFrame=r;function n(f){return R(f,4)}O.mouseMove=n;function o(f){return R(f,5)}O.mousePress=o;function i(f){return R(f,6)}O.mouseDrag=i;function a(f){return R(f,7)}O.mouseRelease=a;function s(f){return R(f,8)}O.mouseScroll=s;function l(f){return R(f,9)}O.mouseDrop=l;function c(f){return R(f,10)}O.mouseLeave=c;function d(f){return R(f,11)}O.touchPress=d;function u(f){return R(f,12)}O.touchDrag=u;function p(f){return R(f,13)}O.touchRelease=p;function _(f){return R(f,14)}O.keyPress=_;function h(f){return R(f,15)}O.keyRelease=h;function g(f){return R(f,16)}O.gamepadDown=g;function m(f,I,y){le.List_appendOne(R(f,I),y)}O.on=m;function A(f,I,y){let P=T(f,I);P!=null&&le.List_removeOne(P,y)}O.off=A;function S(f,I){let y=T(f,I.type());if(y!=null){for(let P of y)if(P(I),I.isAccepted())break}}O.trigger=S;function T(f,I){return nr.IntMap_get(f,I,null)}O._handlers=T;function R(f,I){let y=nr.IntMap_get(f,I,null);return y==null&&(y=[],f.set(I,y)),y}O._createHandlers=R;function b(){return new Map}O._new=b})(_r||(_r={}));var EF;(e=>{function t(){return new Map}e._new=t})(EF||(EF={}));var Nm;(r=>{function t(n){return qe.StringMap_get(r._triggerDeviceMap,n,"UNKNOWN_CONTROLLER")}r.stringToTriggerDevice=t,r._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(Nm||(Nm={}));var Dd;(r=>{function t(n,o,i,a){return nr.IntMap_get(n,o<<8|i,a)}r.KeyShortcutMap_get=t;function e(n,o,i,a){n.set(o<<8|i,a)}r.KeyShortcutMap_set=e})(Dd||(Dd={}));var gl;(s=>{function t(l){return l==1||l==2||l==3}s.ViewerEventType_isWindowEventType=t;function e(l){return l==4||l==5||l==6||l==7||l==8||l==9||l==10}s.ViewerEventType_isMouseEventType=e;function r(l){return l==11||l==12||l==13}s.ViewerEventType_isTouchEventType=r;function n(l){return l==14||l==15}s.ViewerEventType_isKeyEventType=n;function o(l){return l==11||l==13||l==5||l==7||l==8||l==9}s.ViewerEventType_isTypeToBeBlockedByDeviceFrame=o;function i(l){return qe.StringMap_get(s.ViewerEventType__eventTypeFromString,l,0)}s.ViewerEventType_fromString=i,s.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(gl||(gl={}));var Pp;(r=>{function t(n){return n>=105&&n<=108}r.Key_isModifier=t;function e(n){return nr.IntMap_get(vV,n,[0])}r.Key_keyToKeyCode=e})(Pp||(Pp={}));var bc;(e=>{function t(){return jt.current()==4?2:8}e.Modifiers_currentPlatformModifier=t})(bc||(bc={}));function bV(t){let e=new Map;return nr.IntMap_each(t,(r,n)=>{let o=n;if(e.has(o)){e.get(o).push(r);return}e.set(o,[r])}),e}var tv=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),vV=bV(tv);function CV(){let t=new Map,e=window.location.search;if(e.length==0)return t;e=e.slice(1);for(let r of e.split("&")){let n=r.split("=");n.length==2&&t.set(n[0],n[1])}return t}function si(){if(!IF){IF=!0;let t=CV(),e=qe.StringMap_get(t,"force-dpr",null);if(e!=null){let r=+parseFloat(e);isNaN(r)||(rv=new fe(Fr.Math_clamp(r,.1,4)))}}return rv!=null?rv.value:window.devicePixelRatio}var IF=!1,rv=null;var Dm=(n=>(n[n.NONE=0]="NONE",n[n.POINTER=1]="POINTER",n[n.TOUCH=2]="TOUCH",n))(Dm||{}),Fa=class Fa{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new L(0,0,this.window().width(),this.window().height());else return null;let r=e.width()|0,n=e.height()|0,o=this._minX+(this._alignX==2?r:0),i=this._maxX+(this._alignX!=0?r:0),a=this._minY+(this._alignY==2?n:0),s=this._maxY+(this._alignY!=0?n:0);return this._cachedAbsoluteBounds=new L(e.x()+o,e.y()+a,Math.max(0,i-o),Math.max(0,s-a)),e}viewFromPoint(e){let r=this.children().length;for(let n=0,o=r;n<o;n=n+1){let i=this.children()[r-n-1];if(i.absoluteBounds().contains2(e))return i.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let r=this;r!=null;r=r.parent())e.push(r);return e}selfAndChildren(){let e=[],r=[this];for(;r.length!=0;){let n=r.pop(),o=n.children().length;e.push(n);for(let i=0,a=o;i<a;i=i+1)r.push(n.children()[o-i-1])}return e}setLayout(e,r,n,o,i,a){(this._alignX!=e||this._minX!=r||this._maxX!=n||this._alignY!=o||this._minY!=i||this._maxY!=a)&&(this._alignX=e,this._minX=r,this._maxX=n,this._alignY=o,this._minY=i,this._maxY=a,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&le.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let r=e==null?void 0:e._window;this._window!=r&&this.forSelfAndDescendents(n=>{n._window=r})}forSelfAndDescendents(e){e(this);for(let r of this.children())r.forSelfAndDescendents(e)}setCursor(e){Fa._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(Fa._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(Fa._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,r){r!=null&&r._element!=null?r._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static _appendCursorStyleIfNecessary(){if(Fa._cursorStyle!=null)return;let e=(d,u,p,_)=>`
      cursor: url("${p}"), auto; /* Edge, IE */
      cursor: url("${d}") 30 30, pointer; /* Legacy */
      cursor: url("${_}") 30 30, pointer; /* FF */
      cursor: -webkit-image-set(url("${d}") 1x, url("${u}") 2x) 30 30, pointer; /* Webkit */
      `,r="/images/viewer/cursor-touch.png",n="/images/viewer/cursor-touch.cur",o="/images/viewer/cursor-touch@2x.png",i="/images/viewer/cursor-touch.svg",a="/images/viewer/cursor-touch-down.png",s="/images/viewer/cursor-touch-down.cur",l="/images/viewer/cursor-touch-down@2x.png",c="/images/viewer/cursor-touch-down.svg";Fa._cursorStyle=document.createElement("style"),Fa._cursorStyle.nonce=Jn().INITIAL_OPTIONS.csp_nonce,Fa._cursorStyle.textContent=`
    .cursor-default {
      cursor: default;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-touch {
      ${e(r,o,n,i)}
    }

    .cursor-touch:active {
      ${e(a,l,s,c)}
    }

    /*
      We provide a mechanism for the app outside of the viewer to disable all
      viewer cursors. This is useful e.g. in comments mode where the containing
      react application is responsible for setting the cursor instead of code
      inside the viewer library. To use this, the containing application would
      add the viewer-cursors-disabled class to the HTMLElement that hosts the
      viewer canvas.
    */

    .viewer-cursors-disabled .cursor-default {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-pointer {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch:active {
      cursor: inherit;
    }
`,document.head.appendChild(Fa._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}}constructor(){this._parent=null,this._window=null,this._children=[],this._events=_r._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}};Fa._cursorStyle=null;var Fp=Fa,nv=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,r)=>{let n=new FileReader;n.onload=()=>{e(new Uint8Array(jh.FileReader_resultAsArrayBuffer(n)))},n.onloadend=()=>{r(ul.VOID)},n.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}},Pm=class{constructor(e,r,n,o,i){this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=_r._new(),this._eventHandlersAfter=_r._new(),this._isInlinePreviewCallback=i,this._disableKeyboardHandlingCallback=o,this._events=_r._new(),this._recordInteractionCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=n,this._root=new Fp,this._root.becomeRoot(this);let a=null,s=null,l=null,c=null,d=null,u=null,p=document,_=window,h=this.root().element(),g=D=>{Ji.Event_preventDefault(D)},m=(D,w)=>{Tr.EventTarget_removeEventListener3(D,"mousemove",s),Tr.EventTarget_removeEventListener3(D,"mouseup",l),Tr.EventTarget_removeEventListener5(D,"touchmove",d),Tr.EventTarget_removeEventListener5(D,"touchend",u),Tr.EventTarget_addEventListener4(w,"mousemove",s),Tr.EventTarget_addEventListener4(w,"mouseup",l),Tr.EventTarget_addEventListener6(w,"touchmove",d),Tr.EventTarget_addEventListener6(w,"touchend",u)};this.forceFrame=()=>{this._resize(),_r.trigger(this.events(),new Pa(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{_r.trigger(this.events(),new Pa(3,this.root(),0))}catch(D){xe(D)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let A=()=>{this._isActive=!p.hidden,_r.trigger(this.events(),new Pa(1,this.root(),0)),m(p,h)},S=D=>{let w=(D.altKey?1:0)|(D.metaKey?2:0)|(D.shiftKey?4:0)|(D.ctrlKey?8:0);return bc.Modifiers_currentPlatformModifier()&w?w|16:w},T=(D,w)=>{for(let k=this.root().element();k!=null;k=k.offsetParent)D=D-k.offsetLeft,w=w-k.offsetTop;return new F(D,w)},R=0,b=0,O=0,f=0,I=D=>{let w=0,k=sc.Performance_now(_.performance);return w=1,f!=0&&k-f<500&&Math.abs(D.pageX-R)<4&&Math.abs(D.pageY-b)<4&&(w=O+1),R=D.pageX,b=D.pageY,O=w,f=k,w},y=null,P=null,E=!1,C=(D,w,k,z)=>{let H=T(D.pageX,D.pageY),K=P??this.root().viewFromPoint(H),j=new Ic(w==4&&E?6:w,K,S(D),H,y??H,k,w==5?I(D):0,z);y=H,this.notify(j),j.isAccepted()&&(j.type()==5&&D.button==0||Ji.Event_preventDefault(D),w==5&&(P=K)),w==5?E=!0:w==7&&(P=null,E=!1)},B=new Map,G=(D,w)=>{let k=new Map,z=[];Array.from(B.values()).forEach(K=>{le.List_appendOne(z,K.originalTarget)});let H=em.TouchEvent_touches(D).map(K=>{let j=K.identifier,q=T(K.pageX,K.pageY),J=nr.IntMap_get(B,j,null),ie=J!=null?J.originalTarget:this.root().viewFromPoint(q),Ee=new Fd(j,ie,q,J!=null?J.locationInWindow:q);return k.set(j,Ee),le.List_appendOne(z,ie),Ee});B=k;for(let K of z){let j=new Rc(w,K,S(D),H.filter(q=>q.originalTarget==K),H);this.notify(j),j.isAccepted()&&Ji.Event_preventDefault(D)}},V=(D,w)=>{if(this._disableKeyboardHandlingCallback())return;let k=nr.IntMap_get(tv,D.which,0),z=S(D),H=(bc.Modifiers_currentPlatformModifier()&z)!=0&&(k==91||k==93||k==20),K=this.focusedView();H&&Ji.Event_preventDefault(D);let j=q=>{for(;q!==p;){if(q.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;q=q.parentNode}return!1};if((H||p.activeElement==null||p.activeElement==p.body||j(p.activeElement))&&k!=0&&K!=null){let q=new yc(w,K,z,k,!1);this.notify(q),(q.isAccepted()||k==1)&&(Ji.Event_preventDefault(D),D.stopPropagation())}};if(a=D=>{m(h,p),C(D,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},s=D=>{C(D,4,null,null)},l=D=>{m(p,h),C(D,7,null,null)},c=D=>{G(D,11)},d=D=>{G(D,12)},u=D=>{G(D,13)},Tr.EventTarget_addEventListener3(p,"keydown",D=>{V(D,14)}),Tr.EventTarget_addEventListener3(p,"keyup",D=>{V(D,15)}),Tr.EventTarget_addEventListener7(h,"wheel",D=>{let w=D.deltaMode,k=w==D.DOM_DELTA_LINE?10:w==D.DOM_DELTA_PAGE?100:1;C(D,8,new F(D.deltaX*k,D.deltaY*k),null)}),Tr.EventTarget_addEventListener14(p,"wheel",D=>{D.ctrlKey&&Ji.Event_preventDefault(D)},{passive:!1}),Tr.EventTarget_addEventListener5(p,"drop",D=>{Ji.Event_preventDefault(D),C(D,9,null,$h.DataTransfer_files(D.dataTransfer).map(w=>new nv(w)))}),Tr.EventTarget_addEventListener4(p,"mouseenter",D=>{y=null}),Tr.EventTarget_addEventListener4(h,"mouseleave",D=>{C(D,10,null,null)}),r!=null){let D=r;D.onPress(w=>{let k=new Om(16,this.root(),0,w.buttons[0],Nm.stringToTriggerDevice(w.controllerType));this.notifyAll(k)}),D.start()}Tr.EventTarget_addEventListener1(_,"resize",()=>{this._resize()}),Tr.EventTarget_addEventListener1(_,"visibilitychange",A),Tr.EventTarget_addEventListener2(h,"contextmenu",g),Tr.EventTarget_addEventListener4(h,"mousedown",a),Tr.EventTarget_addEventListener6(h,"touchstart",c),Tr.EventTarget_addEventListener2(p,"dragenter",g),Tr.EventTarget_addEventListener2(p,"dragover",g),this._containerElement!=null&&this._containerElement.appendChild(h),this._focusedView=this.root(),A(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new F(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setRecordInteractionCallback(e){this._recordInteractionCallback=e}stopRecordingInteractions(){this._recordInteractionCallback=null}maybeRecordInteraction(e){this._recordInteractionCallback!=null&&this._recordInteractionCallback(e)}notify(e){this.maybeRecordInteraction(e);let r=e.target().selfAndParents();if(_r.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of r)if(_r.trigger(n.events(),e),e.isAccepted())return;_r.trigger(this._eventHandlersAfter,e)}}notifyAll(e){let r=e.target().selfAndChildren();if(_r.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of r)if(_r.trigger(n.events(),e),e.isAccepted())return;_r.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,r=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,n=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,o=si();(this._width!=r||this._height!=n||this._devicePixelRatio!=o)&&(this._width=r,this._height=n,this._devicePixelRatio=o,this.root().invalidateBounds(),this.notifyAll(new Pa(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}resetStateForTests(){this._width=0,this._height=0,this._devicePixelRatio=0}};var Dp;(r=>{function t(){return[]}r.new1=t;function e(n){return n.slice()}r.new2=e})(Dp||(Dp={}));var $t;(S=>{function t(T){return T.length}S.FrozenList_count=t;function e(T){return T.length==0}S.FrozenList_isEmpty=e;function r(T,R){return T[R]}S.FrozenList_get=r;function n(T){return le.List_last(T)}S.FrozenList_last=n;function o(T,R){return T.some(R)}S.FrozenList_any=o;function i(T,R){return T.filter(R)}S.FrozenList_filter=i;function a(T,R){T.forEach(R)}S.FrozenList_each=a;function s(T){return T[0]}S.FrozenList_first=s;function l(T,R){return T.map(R)}S.FrozenList_map=l;function c(T){return T.slice()}S.FrozenList_clone=c;function d(T,R,b){return T.slice(R,b)}S.FrozenList_slice=d;function u(T,R){let b=T.slice();return le.List_appendOne(b,R),b}S.FrozenList_cloneAndAppendOne=u;function p(T,R){let b=T.slice();return le.List_removeOne(b,R),b}S.FrozenList_cloneAndRemoveOne=p;function _(T,R,b){return le.List_equalsWithComparison(T,R,b)}S.FrozenList_equals=_;function h(T,R){return T.indexOf(R)!=-1}S._in=h;function g(T,R){for(let b of T)if(R(b))return!0;return!1}S.FrozenList_contains=g;function m(T,R){let b=T.slice();return b.sort(R),b}S.FrozenList_sorted=m;function A(T,R){let b=T.slice();return b.push(R),b}S.FrozenList_cloneAndAppend=A})($t||($t={}));var bn=class{add(e){this._observers=$t.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=$t.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let r=this._observers;r.forEach(n=>{(r==this._observers||this._observers.indexOf(n)!=-1)&&e(n)})}constructor(){this._observers=[]}};var Or;(p=>{function t(_,h){return Pi.string_compare(_,h)}p.compare=t;function e(_,h){return _==h}p.equals=e;function r(_){return _}p.toString=r;function n(_){return _.length>0}p.isValid=n;function o(_){let h=_,g=h.length-1,m=g;for(;m>=0;){let A=h.charCodeAt(m);if(A>p.LOWER+1)return h.slice(0,m)+String.fromCharCode(A-1);m=m-1}return h.slice(0,g)+String.fromCharCode(p.LOWER)+String.fromCharCode(p.UPPER)}p.before=o;function i(_){let h=_,g=h.length-1;for(;g>=0;){let m=h.charCodeAt(g);if(m<p.UPPER)return h.slice(0,g)+String.fromCharCode(m+1);g=g-1}return h+String.fromCharCode(p.LOWER+1)}p.after=i;function a(_){if(_==null||_==""||_.charCodeAt(_.length-1)==p.LOWER)return null;for(let h=0,g=_.length;h<g;h=h+1)if(_.charCodeAt(h)<p.LOWER||_.charCodeAt(h)>p.UPPER)return null;return _}p.fromString=a;function s(_,h){let g=_,m=h,A=g.length,S=m.length,T="",R=!1;for(let b=0,O=Math.max(A,S);b<O;b=b+1){let f=b<A?g.charCodeAt(b):p.LOWER,I=b<S&&!R?m.charCodeAt(b):p.UPPER;if(f==I)T+=String.fromCharCode(f);else if(I-f>1){T+=String.fromCharCode(f+I>>1),R=!1;break}else T+=String.fromCharCode(f),R=!0}return R&&(T+=String.fromCharCode(p.LOWER+p.UPPER>>1)),T}p.between=s,p.LOWER=32,p.UPPER=126,p.FIRST_POSITION=String.fromCharCode(p.LOWER+1),p.SECOND_POSITION=String.fromCharCode(p.LOWER+2)})(Or||(Or={}));var vn=class t{toString(){return`${this.id};${Or.toString(this.position)}`}equals(e){return X.equals(this.id,e.id)&&Or.equals(this.position,e.position)}static fromString(e){let r=e.indexOf(";");if(r==-1)return null;let n=e.slice(0,r);if(n=="-1:-1")return null;let o=X.fromString(n);return new t(o,Or.fromString(e.slice(r+1)))}constructor(e,r){this.id=e,this.position=r}};var pt;(zt=>{function t(ae){try{if(r(ae))return ae.toString();if(n(ae))return R(ae).toString();if(o(ae))return b(ae).toString();if(a(ae))return ae;if(ae instanceof Array)return ae.length===0?"[]":"toString"in ae[0]?"["+ae.map(nt=>nt.toString()).join(", ")+"]":"[...]";if("toString"in ae)return ae.toString()}catch{}return"?"}zt.toString=t;function e(ae,nt){return r(ae)&&r(nt)?ae.equals1(nt):s(ae)&&s(nt)?ae.equals(nt):(n(ae)||o(ae)||a(ae)||md(ae),ae==nt)}zt.equals=e;function r(ae){return ae instanceof Q}zt.isAffineTransform=r;function n(ae){return typeof ae=="boolean"}zt.isBool=n;function o(ae){return typeof ae=="number"}zt.isDouble=o;function i(ae){return ae.guid!==void 0&&ae.ref!==void 0}zt.isStyleId=i;function a(ae){return typeof ae=="string"}zt.isString=a;function s(ae){return ae instanceof F}zt.isVector=s;function l(ae){return ae instanceof Array}zt.isList=l;function c(ae){return ae instanceof vn}zt.isParentIndex=c;function d(ae){return typeof ae=="string"}zt.isGUID=d;function u(ae){return typeof ae=="string"}zt.isScrollDirection=u;function p(ae){return typeof ae=="string"}zt.isPosition=p;function _(ae){return typeof ae=="string"}zt.isScrollBehavior=_;function h(ae){return typeof ae=="string"}zt.isNavigationType=h;function g(ae){return typeof ae=="string"}zt.isOverlayPositionType=g;function m(ae){return typeof ae=="string"}zt.isOverlayBackgroundInteraction=m;function A(ae){return typeof ae=="string"}zt.isShapeWithTextType=A;function S(ae){return ae.autoplay!==void 0&&ae.mediaLoop!==void 0&&ae.muted!==void 0&&ae.showControls!==void 0&&ae.startTimeMs!==void 0&&ae.endTimeMs!==void 0}zt.isVideoPlayback=S;function T(ae){return ae}zt.asAffineTransform=T;function R(ae){return!!ae}zt.asBool=R;function b(ae){return+ae}zt.asDouble=b;function O(ae){return ae}zt.asStyleId=O;function f(ae){return ae}zt.asInt=f;function I(ae){return ae}zt.asString=I;function y(ae,nt){return a(ae)?ae:nt}zt.asStringEnum=y;function P(ae){return ae}zt.asVector=P;function E(ae){return ae}zt.asPaintList=E;function C(ae){return ae}zt.asPaintData=C;function B(ae){return ae}zt.asEffectList=B;function G(ae){return ae}zt.asTransformModifierList=G;function V(ae){return ae}zt.asExportSettingsList=V;function D(ae){return ae}zt.asParentIndex=D;function w(ae){return ae}zt.asGUID=w;function k(ae){return ae}zt.asScrollDirection=k;function z(ae){return ae}zt.asPosition=z;function H(ae){return ae}zt.asScrollBehavior=H;function K(ae){return ae}zt.asNavigationType=K;function j(ae){return ae}zt.asOverlayPositionType=j;function q(ae){return ae}zt.asOverlayBackgroundInteraction=q;function J(ae){return ae}zt.asArcData=J;function ie(ae){return ae}zt.asShapeWithTextType=ie;function Ee(ae){return ae}zt.asVideoPlayback=Ee,zt.ZERO_VECTOR=Ae.FrozenVector_new1(),zt.IDENTITY_TRANSFORM=wt.FrozenAffineTransform_new1(),zt.EMPTY_PAINT_LIST=[],zt.EMPTY_EFFECT_LIST=[],zt.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Math.PI,innerRadius:0}})(pt||(pt={}));var Xt=class t{static getEventEmitter(){return t._eventEmitter||(t._eventEmitter=new t),t._eventEmitter}on(e,r){le.List_appendOne(this._list(e),r)}off(e,r){le.List_removeOne(this._list(e),r)}trigger(e,r){let n=this._list(e).slice();for(let o of n)o(r)}constructor(){this._callbacks=new Map}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(r=>{class t{constructor(){this._emitter=r.getEventEmitter()}handleAction(o,i){switch(o){case 5:{this._emitter.trigger("mirrorTap");break}case 6:{this._emitter.trigger("canvasMouseDown",pt.asVector(i).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",pt.asVector(i).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",pt.asVector(i).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",pt.asVector(i).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",pt.asVector(i).toJSON());break}}}}r.ActionHandler=t;class e{constructor(o){this._emitter=r.getEventEmitter();this._state=o,this._visible=!1}onFrame(){let o=this._state.baseScreenNode()!=null;this._visible!=o&&(this._visible=o,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}}r.AppHandler=e})(Xt||(Xt={}));var wp=class{constructor(e){this.MAX_ACTIVE_EMBEDDED_PROTOTYPES=2;this.PRELOAD_WINDOW_NUM_UPCOMING_SLIDES=3;this.PRELOAD_WINDOW_NUM_PREVIOUS_SLIDES=1;this.appState=e,this.appState.prototypeState().addObserver(this),this._emitter=Xt.getEventEmitter(),this._activePrototypes=[],this._requestedPrototypes=new Set,this._prototypeToSessionIdMap=new Map}getPrototypesForBaseScreen(e){let r=new Set;return e.forEachDescendantPreorder(n=>{n.isEmbeddedPrototype()&&r.add(n.id())}),r}getRequestedPrototypes(){return Array.from(this._requestedPrototypes).reverse()}getPreloadWindowBaseScreenIds(){let e=this.appState.prototypeState().getCurrentBaseScreenId(),r=this.appState.prototypeStructure().topLevelPrototypeNodesInOrder(),n=r.findIndex(s=>s===e);if(n===-1)return[];let o=r.slice(n+1,n+1+this.PRELOAD_WINDOW_NUM_UPCOMING_SLIDES),i=r.slice(n-this.PRELOAD_WINDOW_NUM_PREVIOUS_SLIDES,n).reverse();return[e,...o,...i]}reset(){this._activePrototypes=[],this._requestedPrototypes=new Set}_recomputePreloadedPrototypes(){let e=this.getPreloadWindowBaseScreenIds(),r=[],n=this.getRequestedPrototypes();for(let o of e){let i=this.appState.scene().findNode(o);if(i==null)continue;let a=this.getPrototypesForBaseScreen(i);for(let s of n)a.has(s)&&(r.push(s),a.delete(s));for(let s of a)r.push(s)}this._activePrototypes=r}_broadcastState(){let e=[];for(let r of this.activePrototypes())e.push({nodeId:X.toFigGUID(r),sessionId:this._prototypeToSessionIdMap.get(r)??-1});this._emitter.trigger("embeddedPrototypeDataChange",e),this.appState.prototypeState().notifyMultiplayerEmbeddedPrototypeDataChange(e)}activePrototypes(e=!1){return e?this._activePrototypes:this._activePrototypes.slice(0,this.MAX_ACTIVE_EMBEDDED_PROTOTYPES)}isActiveSlidesEmbeddedPrototype(e){return this.activePrototypes().includes(e)}requestPrototype(e){this._requestedPrototypes.delete(e),this._requestedPrototypes.add(e),this._recomputePreloadedPrototypes(),this._broadcastState()}setSessionId(e,r){r==null?this._prototypeToSessionIdMap.delete(e):this._prototypeToSessionIdMap.set(e,r),this._broadcastState()}handleStateChangeCommitted(e,r){this._recomputePreloadedPrototypes(),this._broadcastState()}handleRestartPrototype(){this.reset(),this._recomputePreloadedPrototypes()}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}};var So=class t{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let r of Array.from(this._hash.keys()))if(!e._in(r))return!1;return!0}static fromList(e){let r=new t;for(let n of e)r.add(n);return r}constructor(){this._hash=new Map}};var kn=class kn{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[kn.ROOT_INDEX].value}insertOrUpdate(e,r){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,r);return}let n=new kn.Element(e,r);this._heap.push(n),this._indexByElement.set(n.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let r=this._indexByElement.get(e),n=this._heap[r];return new fe(n.priority)}remove(e){if(!this._indexByElement.has(e))return;let r=this._indexByElement.get(e),n=this.count()-1;n>r&&this._swap(r,n);let o=this._heap.pop();this._indexByElement.delete(o.value),r!=n&&(this._siftDown(r),this._siftUp(r))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[kn.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,r){return this._compare(this._heap[e].priority,this._heap[r].priority)>0}_swap(e,r){let n=this._heap[e];this._heap[e]=this._heap[r],this._heap[r]=n,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[r].value,r)}_siftUp(e){let r=e;for(;r>kn.ROOT_INDEX&&this._isGreater(r,kn.indexOfParent(r));)this._swap(r,kn.indexOfParent(r)),r=kn.indexOfParent(r)}_siftDown(e){let r=e;for(;kn.indexOfLeftChild(r)<this.count()&&this._isGreater(kn.indexOfLeftChild(r),r)||kn.indexOfRightChild(r)<this.count()&&this._isGreater(kn.indexOfRightChild(r),r);){let n=kn.indexOfRightChild(r)<this.count()&&this._isGreater(kn.indexOfRightChild(r),kn.indexOfLeftChild(r))?kn.indexOfRightChild(r):kn.indexOfLeftChild(r);this._swap(r,n),r=n}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}};kn.ROOT_INDEX=0;var ws=kn;(e=>{class t{constructor(n,o){this.value=n,this.priority=o}}e.Element=t})(ws||(ws={}));var xm=class{constructor(e,r,n,o){this.bufferArea=e,this.hasNoCurves=r,this.hasNoOverlaps=n,this.hasNoCurvesAndSameOrientation=o}},Pt;(T=>{function t(R){return`SCROLL_OFFSET::${R}`}T.forScrollOffset=t;function e(R){return`OVERLAY_POSITION::${R}`}T.forOverlayPosition=e;function r(R){return`ANIMATEABLE_TRANSLATION::${R}`}T.forAnimateableTranslation=r;function n(R){return`SHADOW_TRANSFORMATION::${R}`}T.forShadowTransformation=n;function o(R){return`ANIMATEABLE_OPACITY::${R}`}T.forAnimateableOpacity=o;function i(R){return`ANIMATEABLE_DISSOLVE::${R}`}T.forAnimateableDissolve=i;function a(R){return`DYNAMIC_GEOMETRY::${R}`}T.forDynamicGeometry=a;function s(R){return R.id.startsWith("SCROLL_OFFSET")}T.isScrollingTransform=s;function l(R){return`EFFECT::${R}`}T.forAnimateableEffect=l,T.ENTERING_TLF="ENTERING_TLF",T.EXITING_TLF="EXITING_TLF",T.ENTERING_OVERLAY="ENTERING_OVERLAY",T.EXITING_OVERLAY="EXITING_OVERLAY",T.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",T.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",T.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",T.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",T.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",T.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(Pt||(Pt={}));var wm=(n=>(n[n.FULL_SIZE=0]="FULL_SIZE",n[n.THUMBNAIL=1]="THUMBNAIL",n[n.EMOJI=2]="EMOJI",n))(wm||{}),as=class{hash(){return`${this.image.objectHash()}:${wm[this.purpose]}`}constructor(e,r){this.image=e,this.purpose=r}};var Lp=(i=>(i[i.OTHER=0]="OTHER",i[i.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",i[i.PRERENDER_THUMB=2]="PRERENDER_THUMB",i[i.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",i[i.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",i))(Lp||{}),Da=class Da{compare(e){let r=Ut.int_compare(this.type,e.type);return r!=0?r:Ut.int_compare(this.generation,e.generation)}toString(){return`${Lp[this.type]}:${this.generation}`}static advanceGeneration(){Da._generation=Da._generation+1}static forType(e){return new Da(e,Da._generation)}static forOnScreenPurpose(e){let r=Sl.ImagePriorityType_forOnScreenPurpose(e);return Da.forType(r)}static forPrerenderPurpose(e){let r=Sl.ImagePriorityType_forPrerenderPurpose(e);return Da.forType(r)}static max(e,r){return e.compare(r)>0?e:r}constructor(e,r){this.type=e,this.generation=r}};Da.OTHER=new Da(0,0),Da._generation=0;var Hn=Da,Lm=class{insertOrUpdate(e,r){let n=this._queue.getPriority(e);(n==null||r.compare(n.value)>0)&&this._queue.insertOrUpdate(e,r)}peek(){return this._queue.peek()}getPriority(e){let r=this._queue.getPriority(e);return r!=null?new fe(r.value):null}maxPriority(){return this._queue.count()==0?null:new fe(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new ws((e,r)=>e.compare(r))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new ws((e,r)=>e.compare(r))}},Sl;(o=>{function t(i){return i==3||i==4}o.ImagePriorityType_isOnScreen=t;function e(i){return i==1||i==2}o.ImagePriorityType_isPrerender=e;function r(i){switch(i){case 0:return 3;case 1:case 2:return 4}}o.ImagePriorityType_forOnScreenPurpose=r;function n(i){switch(i){case 0:return 1;case 1:case 2:return 2}}o.ImagePriorityType_forPrerenderPurpose=n})(Sl||(Sl={}));var Al;(e=>{function t(r){return r!="NONE"&&r!="PRESENTATION"}e.hasDevice=t})(Al||(Al={}));var er;(i=>{function t(a){return a=="BOOLEAN_OPERATION"||a=="VECTOR"||a=="STAR"||a=="LINE"||a=="ELLIPSE"||a=="RECTANGLE"||a=="REGULAR_POLYGON"||a=="ROUNDED_RECTANGLE"||a=="TEXT"||a=="STAMP"||a=="WASHI_TAPE"}i.isGeometryLeaf=t;function e(a){return a=="FRAME"||a=="SYMBOL"||a=="INSTANCE"||a=="SECTION"||o(a)||a=="TABLE_CELL"||a=="SLIDE"||a=="MODULE"||a=="CODE_INSTANCE"}i.isFrameLike=e;function r(a){return a=="CODE_LAYER"||a=="CODE_COMPONENT"||a=="CODE_INSTANCE"}i.supportsCodeSnapshot=r;function n(a){return a=="RECTANGLE"||a=="ROUNDED_RECTANGLE"||a=="ELLIPSE"||a=="STAMP"||e(a)}i.isRectOrEllipseLike=n;function o(a){return a=="STICKY"||a=="SHAPE_WITH_TEXT"||a=="CONNECTOR"||a=="CODE_BLOCK"||a=="MEDIA"||a=="SECTION_OVERLAY"||a=="TABLE"}i.isImmutableFrame=o})(er||(er={}));var Tl;(r=>{function t(n){return`${n.sessionID}:${n.localID}`}r.toString=t;function e(n,o){return n.sessionID==o.sessionID&&n.localID==o.localID}r.equals=e})(Tl||(Tl={}));var Mp;(e=>{function t(r){return r.guid!==void 0?"VariableID:"+Tl.toString(r.guid):r.assetRef!==void 0&&r.assetRef.key!=null&&r.assetRef.version!=null?"VariableID:"+r.assetRef.key+"/"+r.assetRef.version:""}e.toString=t})(Mp||(Mp={}));var Mm;(e=>{function t(r){return r.guid!==void 0?"ManagedStringId:"+Tl.toString(r.guid):r.assetRef!==void 0&&r.assetRef.key!=null&&r.assetRef.version!=null?"ManagedStringId:"+r.assetRef.key+"/"+r.assetRef.version:""}e.toString=t})(Mm||(Mm={}));var Ln;(a=>{function t(s){let l=s.depth!==void 0?s.depth:-1;return`${n(s)}-${l}`}a.hash=t;function e(s,l){return t(s)==t(l)}a.equals=e;function r(s){return t(s)}a.toString=r;function n(s){let l=s.startingNode!==void 0?s.startingNode:null;return l!=null?`${l.sessionID}:${l.localID}`:"-1:-1"}a.nodeIdString=n;function o(s){let l=s.startingNode!==void 0?s.startingNode:null,c=l!=null?`${l.sessionID}:${l.localID}`:"-1:-1",d=s.depth!==void 0?s.depth:-1;return`${c}-${d}`}a.serializeForMultiplayerURL=o;function i(s,l){if((s.depth!==void 0?s.depth:-1)!=0)return!1;let d=s.startingNode!==void 0?s.startingNode:null;for(;l!=null;){if(Tl.equals(X.toFigGUID(l.id()),d))return!0;l=l.parent()}return!1}a.fullyLoadsNode=i})(Ln||(Ln={}));var iv;(r=>{function t(){return X._new(-1,r._nextLocalID=r._nextLocalID+1)}r.generateId=t,r._nextLocalID=0})(iv||(iv={}));var RF=null;function yF(t){RF=t}function Be(){return RF}function bF(t,e){let r=e(t)||0;switch(r){case 1:return 1;case 0:break;case 2:return 0}for(let n=0,o=t.childCount();n<o;n=n+1)if(t.childAt1(n)!==void 0)switch(r=bF(t.childAt1(n),e),r){case 1:return 1;case 0:break;case 2:return 0}return 0}function no(t,e){bF(t,e)}var Ht=(ee=>(ee[ee.MISSING__=0]="MISSING__",ee[ee.ARC_DATA=1]="ARC_DATA",ee[ee.BACKGROUND_COLOR=2]="BACKGROUND_COLOR",ee[ee.IS_BACKGROUND_ENABLED=3]="IS_BACKGROUND_ENABLED",ee[ee.BACKGROUND_OPACITY=4]="BACKGROUND_OPACITY",ee[ee.BEHAVIORS=5]="BEHAVIORS",ee[ee.BLEND_MODE=6]="BLEND_MODE",ee[ee.BORDER_BOTTOM_WEIGHT=7]="BORDER_BOTTOM_WEIGHT",ee[ee.BORDER_LEFT_WEIGHT=8]="BORDER_LEFT_WEIGHT",ee[ee.BORDER_RIGHT_WEIGHT=9]="BORDER_RIGHT_WEIGHT",ee[ee.BORDER_STROKE_WEIGHTS_INDEPENDENT=10]="BORDER_STROKE_WEIGHTS_INDEPENDENT",ee[ee.BORDER_TOP_WEIGHT=11]="BORDER_TOP_WEIGHT",ee[ee.CODE_SNAPSHOT=12]="CODE_SNAPSHOT",ee[ee.COMPILED_VECTOR_DATA=13]="COMPILED_VECTOR_DATA",ee[ee.CONNECTION_TYPE__DEPRECATED=14]="CONNECTION_TYPE__DEPRECATED",ee[ee.CONNECTION_URL_DEPRECATED=15]="CONNECTION_URL_DEPRECATED",ee[ee.CORNER_RADIUS=16]="CORNER_RADIUS",ee[ee.CORNER_SMOOTHING=17]="CORNER_SMOOTHING",ee[ee.CURRENT_VIEWPORT_SIZE=18]="CURRENT_VIEWPORT_SIZE",ee[ee.DERIVED_TEXT_DATA=19]="DERIVED_TEXT_DATA",ee[ee.EASING_TYPE__DEPRECATED=20]="EASING_TYPE__DEPRECATED",ee[ee.EFFECT_DATA=21]="EFFECT_DATA",ee[ee.EXPORT_SETTINGS_DATA=22]="EXPORT_SETTINGS_DATA",ee[ee.FILL_GEOMETRY=23]="FILL_GEOMETRY",ee[ee.FILL_PAINT_DATA=24]="FILL_PAINT_DATA",ee[ee.FONT_SIZE=25]="FONT_SIZE",ee[ee.HAS_BEEN_LOADED=26]="HAS_BEEN_LOADED",ee[ee.HORIZONTAL_CONSTRAINT=27]="HORIZONTAL_CONSTRAINT",ee[ee.HYPERLINK=28]="HYPERLINK",ee[ee.INTERACTION_DURATION__DEPRECATED=29]="INTERACTION_DURATION__DEPRECATED",ee[ee.INTERACTION_MAINTAINED__DEPRECATED=30]="INTERACTION_MAINTAINED__DEPRECATED",ee[ee.INTERACTION_TYPE__DEPRECATED=31]="INTERACTION_TYPE__DEPRECATED",ee[ee.INTERACTIVE_SLIDE_CONFIG_DATA=32]="INTERACTIVE_SLIDE_CONFIG_DATA",ee[ee.INTERACTIVE_SLIDE_ELEMENT_TYPE=33]="INTERACTIVE_SLIDE_ELEMENT_TYPE",ee[ee.INTERACTIVE_SLIDE_PARTICIPANT_DATA=34]="INTERACTIVE_SLIDE_PARTICIPANT_DATA",ee[ee.IS_FRAME_MASK_DISABLED=35]="IS_FRAME_MASK_DISABLED",ee[ee.IS_INTERNAL_ONLY=36]="IS_INTERNAL_ONLY",ee[ee.IS_MASK=37]="IS_MASK",ee[ee.IS_MASK_OUTLINE__DEPRECATED=38]="IS_MASK_OUTLINE__DEPRECATED",ee[ee.IS_SKIPPED_SLIDE=39]="IS_SKIPPED_SLIDE",ee[ee.IS_STATE_GROUP=40]="IS_STATE_GROUP",ee[ee.KEY_TRIGGER__DEPRECATED=41]="KEY_TRIGGER__DEPRECATED",ee[ee.LOCAL_OPACITY=42]="LOCAL_OPACITY",ee[ee.MASK_TYPE=43]="MASK_TYPE",ee[ee.MENTION=44]="MENTION",ee[ee.NAME=45]="NAME",ee[ee.NAVIGATION_TYPE__DEPRECATED=46]="NAVIGATION_TYPE__DEPRECATED",ee[ee.OBJECT_ANIMATIONS=47]="OBJECT_ANIMATIONS",ee[ee.OPACITY=48]="OPACITY",ee[ee.OVERFLOW_DIRECTION=49]="OVERFLOW_DIRECTION",ee[ee.OVERLAY_BACKGROUND_APPEARANCE=50]="OVERLAY_BACKGROUND_APPEARANCE",ee[ee.OVERLAY_BACKGROUND_INTERACTION=51]="OVERLAY_BACKGROUND_INTERACTION",ee[ee.OVERLAY_POSITION_TYPE=52]="OVERLAY_POSITION_TYPE",ee[ee.OVERLAY_RELATIVE_POSITION__DEPRECATED=53]="OVERLAY_RELATIVE_POSITION__DEPRECATED",ee[ee.OVERLAY_TRANSFORM=54]="OVERLAY_TRANSFORM",ee[ee.OVERRIDDEN_SYMBOL_ID=55]="OVERRIDDEN_SYMBOL_ID",ee[ee.OVERRIDE_KEY=56]="OVERRIDE_KEY",ee[ee.PAGE_TYPE=57]="PAGE_TYPE",ee[ee.PARENT_INDEX=58]="PARENT_INDEX",ee[ee.PROTOTYPE_BACKGROUND_COLOR=59]="PROTOTYPE_BACKGROUND_COLOR",ee[ee.PROTOTYPE_DEVICE=60]="PROTOTYPE_DEVICE",ee[ee.PROTOTYPE_INTERACTIONS=61]="PROTOTYPE_INTERACTIONS",ee[ee.PROTOTYPE_START_NODE_ID=62]="PROTOTYPE_START_NODE_ID",ee[ee.PROTOTYPE_STARTING_POINT=63]="PROTOTYPE_STARTING_POINT",ee[ee.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=64]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",ee[ee.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=65]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",ee[ee.RECTANGLE_CORNER_RADII_INDEPENDENT=66]="RECTANGLE_CORNER_RADII_INDEPENDENT",ee[ee.RECTANGLE_CORNER_TOOL_INDEPENDENT=67]="RECTANGLE_CORNER_TOOL_INDEPENDENT",ee[ee.RECTANGLE_TOP_LEFT_CORNER_RADIUS=68]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",ee[ee.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=69]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",ee[ee.RELATIVE_TRANSFORM=70]="RELATIVE_TRANSFORM",ee[ee.IS_RESIZE_TO_FIT=71]="IS_RESIZE_TO_FIT",ee[ee.SCROLL_BEHAVIOR=72]="SCROLL_BEHAVIOR",ee[ee.SCROLL_OFFSET=73]="SCROLL_OFFSET",ee[ee.SHAPE_WITH_TEXT_TYPE=74]="SHAPE_WITH_TEXT_TYPE",ee[ee.SIZE_VECTOR_F=75]="SIZE_VECTOR_F",ee[ee.SLIDE_SPEAKER_NOTES=76]="SLIDE_SPEAKER_NOTES",ee[ee.SLIDE_THUMBNAIL_HASH=77]="SLIDE_THUMBNAIL_HASH",ee[ee.STACK_COUNTER_SPACING=78]="STACK_COUNTER_SPACING",ee[ee.STACK_MODE=79]="STACK_MODE",ee[ee.STACK_PADDING_BOTTOM=80]="STACK_PADDING_BOTTOM",ee[ee.STACK_PADDING_LEFT=81]="STACK_PADDING_LEFT",ee[ee.STACK_PADDING_RIGHT=82]="STACK_PADDING_RIGHT",ee[ee.STACK_PADDING_TOP=83]="STACK_PADDING_TOP",ee[ee.STACK_REVERSE_Z_INDEX=84]="STACK_REVERSE_Z_INDEX",ee[ee.STACK_SPACING=85]="STACK_SPACING",ee[ee.STROKE_ALIGN=86]="STROKE_ALIGN",ee[ee.STROKE_GEOMETRY=87]="STROKE_GEOMETRY",ee[ee.STROKE_PAINT_DATA=88]="STROKE_PAINT_DATA",ee[ee.STROKE_WEIGHT=89]="STROKE_WEIGHT",ee[ee.STYLE_ID_FOR_EFFECT=90]="STYLE_ID_FOR_EFFECT",ee[ee.STYLE_ID_FOR_FILL=91]="STYLE_ID_FOR_FILL",ee[ee.STYLE_ID_FOR_GRID=92]="STYLE_ID_FOR_GRID",ee[ee.STYLE_ID_FOR_STROKE_FILL=93]="STYLE_ID_FOR_STROKE_FILL",ee[ee.STYLE_ID_FOR_TEXT=94]="STYLE_ID_FOR_TEXT",ee[ee.STYLE_TYPE=95]="STYLE_TYPE",ee[ee.SYMBOL_DATA=96]="SYMBOL_DATA",ee[ee.TEXT_ALIGN_HORIZONTAL=97]="TEXT_ALIGN_HORIZONTAL",ee[ee.TEXT_ALIGN_VERTICAL=98]="TEXT_ALIGN_VERTICAL",ee[ee.TEXT_DATA=99]="TEXT_DATA",ee[ee.TEXT_DECORATION_FILL_PAINT_DATA=100]="TEXT_DECORATION_FILL_PAINT_DATA",ee[ee.TRANSFORM_MODIFIERS=101]="TRANSFORM_MODIFIERS",ee[ee.TRANSITION_DURATION__DEPRECATED=102]="TRANSITION_DURATION__DEPRECATED",ee[ee.TRANSITION_NODE_ID_DEPRECATED=103]="TRANSITION_NODE_ID_DEPRECATED",ee[ee.TRANSITION_PRESERVE_SCROLL__DEPRECATED=104]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",ee[ee.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=105]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",ee[ee.TRANSITION_TIMEOUT__DEPRECATED=106]="TRANSITION_TIMEOUT__DEPRECATED",ee[ee.TRANSITION_TYPE__DEPRECATED=107]="TRANSITION_TYPE__DEPRECATED",ee[ee.TYPE=108]="TYPE",ee[ee.USED_AS_BASE_SCREEN=109]="USED_AS_BASE_SCREEN",ee[ee.VERTICAL_CONSTRAINT=110]="VERTICAL_CONSTRAINT",ee[ee.VIDEO_PLAYBACK=111]="VIDEO_PLAYBACK",ee[ee.VISIBLE=112]="VISIBLE",ee[ee.VOICE_EVENT_PHRASE__DEPRECATED=113]="VOICE_EVENT_PHRASE__DEPRECATED",ee[ee.PHASE=114]="PHASE",ee[ee.END__=115]="END__",ee))(Ht||{});var Nr;(d=>{function t(u,p){let _=s();for(let h=0,g=u.length;h<g;h=h+1)r(_,u[h],p[h]);return _}d.new1=t;function e(u,p){return u.has(Ht[p])}d._in=e;function r(u,p,_){let h=Ht[p];d._remapKey.set(h,p),u.set(h,_)}d.set=r;function n(u,p,_=null){return qe.StringMap_get(u,Ht[p],_)}d.get=n;function o(u,p){u.delete(Ht[p])}d.remove=o;function i(u,p){qe.StringMap_each(u,(_,h)=>{p(d._remapKey.get(_),h)})}d.each=i;function a(u){let p=[];return qe.StringMap_each(u,(_,h)=>{p.push(`${_}=${pt.toString(h)}`)}),`{${p.join(", ")}}`}d.toString=a;function s(){return new Map}d._new=s,d._remapKey=new Map,d.EMPTY=s()})(Nr||(Nr={}));var ss;(o=>{function t(i,a){return Nr._in(i,a)}o._in=t;function e(i,a,s=null){return Nr.get(i,a,s)}o.get=e;function r(i,a){Nr.each(i,a)}o.each=r;function n(i){return Nr.toString(i)}o.toString=n})(ss||(ss={}));var oo=class t{constructor(e){e?(this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)):(this._count=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer))}clear(){this._count=0}clone(){return new t(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let r=e.byteCount();return this._count+r>this._capacity&&this._grow(this._count+r),this._bytes.set(this.bytes(),r),this._bytes.set(e.bytes()),this._count=this._count+r,this}appendBytes(e){let r=e.byteCount();return this._count+r>this._capacity&&this._grow(this._count+r),this._bytes.set(e.bytes(),this._count),this._count=this._count+r,this}setFloatAt(e,r){this._view.setFloat32(e,r,!0)}_grow(e){this._capacity=e*2;let r=new Uint8Array(this._capacity);this._bytes!=null&&r.set(this._bytes),this._bytes=r,this._view=new DataView(r.buffer)}},Bm;(e=>{function t(r,n){if(r==null||n==null||r.byteCount()!=n.byteCount())return!1;for(let o=0,i=r.byteCount();o<i;o=o+1)if(r.byteAt(o)!=n.byteAt(o))return!1;return!0}e.FrozenDataArray_equals=t})(Bm||(Bm={}));var li=class t{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=t.combine(this._value,this._int[0])}hash2(e){this._value=t.combine(this._value,e)}static combine(e,r){return r+-1640531527+(e<<6)+(e>>2)}};function vF(t,e,r){if(e==5&&t[4].equals(t[0])&&(e=e-1),e!=4)return!1;let s=.001,l=0,c=0;for(let d=0;d<e;d=d+1){let u=t[d],p=0;if(u.x()<r.left()+s)if(u.y()<r.top()+s)p=0;else if(u.y()>r.bottom()-s)p=2;else return!1;else if(u.x()>r.right()-s)if(u.y()<r.top()+s)p=1;else if(u.y()>r.bottom()-s)p=3;else return!1;else return!1;if(d>0){let _=l^p;if(_!=1&&_!=2)return!1}c|=1<<p,l=p}return c==15}var Bp=class{constructor(e,r){this.bounds=e,this.isRect=r}},tt=class t{constructor(){this.VERTEX_PATTERN_COUNT=5;this.VERTEX_PATTERN=[null,null,null,null,null];this._data=arguments[0],arguments.length==1?(this._cachedInfo=null,this._hash=null):arguments.length==3&&(this._cachedInfo=arguments[1],this._hash=new fe(arguments[2]))}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}cppUniquePath(){return null}equals2(e){return e instanceof t?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:Bm.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new Lt(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}asRoundedRectPath(){return null}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new li;for(let r=0,n=this._data.byteCount();r<n;r=r+1)e.hash2(this._data.byteAt(r));this._hash=new fe(e.value())}return this._hash.value}countCommands(){let e=0;for(let r=this.start();t.Command.isValid(r,this);r=t.Command.next(r,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=vt.INSTANCE;e.reset();for(let c=0,d=this.VERTEX_PATTERN_COUNT;c<d;c=c+1)this.VERTEX_PATTERN[c]=null;let r=!1,n=!1,o=0,i=F.new(),a=c=>{o<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[o]=c),e.include2(c),o=o+1};for(let c=this.start();t.Command.isValid(c,this);c=t.Command.next(c,this))switch(t.Command.kind(c,this)){case t.Command.Kind.CLOSE:{n=!1;break}case t.Command.Kind.MOVE_TO:{i=t.Command.point(c,this),n=!1;break}case t.Command.Kind.LINE_TO:case t.Command.Kind.QUADRATIC_TO:case t.Command.Kind.CUBIC_TO:{n||(a(i),n=!0),t.Command.kind(c,this)==t.Command.Kind.QUADRATIC_TO?(e.include2(t.Command.control1(c,this)),r=!0):t.Command.kind(c,this)==t.Command.Kind.CUBIC_TO&&(e.include2(t.Command.control1(c,this)),e.include2(t.Command.control2(c,this)),r=!0),i=t.Command.point(c,this),a(i);break}default:break}let s=e.isValid()?e.build():L.INVALID,l=!r&&o<=this.VERTEX_PATTERN_COUNT&&vF(this.VERTEX_PATTERN,o,s);return new Bp(s,l)}toBezierPath(){return this}toString(){let e="";for(let r=this.start();t.Command.isValid(r,this);r=t.Command.next(r,this))switch(r!=this.start()&&(e+=" "),t.Command.kind(r,this)){case t.Command.Kind.CLOSE:{e+="Z";break}case t.Command.Kind.MOVE_TO:{e+=`M ${t.Command.moveToX(r,this)} ${t.Command.moveToY(r,this)}`;break}case t.Command.Kind.LINE_TO:{e+=`L ${t.Command.lineToX(r,this)} ${t.Command.lineToY(r,this)}`;break}case t.Command.Kind.QUADRATIC_TO:{e+=`Q ${t.Command.quadraticToFirstX(r,this)} ${t.Command.quadraticToFirstY(r,this)} ${t.Command.quadraticToX(r,this)} ${t.Command.quadraticToY(r,this)}`;break}case t.Command.Kind.CUBIC_TO:{e+=`C ${t.Command.cubicToFirstX(r,this)} ${t.Command.cubicToFirstY(r,this)} ${t.Command.cubicToSecondX(r,this)} ${t.Command.cubicToSecondY(r,this)} ${t.Command.cubicToX(r,this)} ${t.Command.cubicToY(r,this)}`;break}default:{break}}return e}data(){return this._data}};(e=>{let t;(j=>{function r(q,J){return J.data().byteAt(q)}j.kind=r;function n(q,J){let ie=r(q,J);return q+(ie==4?1+4*6:ie==3?1+4*4:ie==0?1:1+4*2)}j.next=n;function o(q,J){if(q>=J.data().byteCount())return!1;let ie=0;switch(r(q,J)){case 0:{ie=1;break}case 1:case 2:{ie=1+1*8;break}case 3:{ie=1+2*8;break}case 4:{ie=1+3*8;break}default:return!1}return q+ie<=J.data().byteCount()}j.isValid=o;function i(q,J){return l(q,J,r(q,J)==3?1:r(q,J)==4?2:0)}j.point=i;function a(q,J){return l(q,J,0)}j.control1=a;function s(q,J){return l(q,J,1)}j.control2=s;function l(q,J,ie){return new F(J.data().floatAt(q+1+8*ie),J.data().floatAt(q+1+8*ie+4))}j.pointAtIndex=l;function c(q,J){return J.data().floatAt(q+1)}j.moveToX=c;function d(q,J){return J.data().floatAt(q+5)}j.moveToY=d;function u(q,J,ie){J.setFloatAt(q+1,ie)}j.setMoveToX=u;function p(q,J,ie){J.setFloatAt(q+5,ie)}j.setMoveToY=p;function _(q,J){return J.data().floatAt(q+1)}j.lineToX=_;function h(q,J){return J.data().floatAt(q+5)}j.lineToY=h;function g(q,J,ie){J.setFloatAt(q+1,ie)}j.setLineToX=g;function m(q,J,ie){J.setFloatAt(q+5,ie)}j.setLineToY=m;function A(q,J){return J.data().floatAt(q+1)}j.quadraticToFirstX=A;function S(q,J){return J.data().floatAt(q+5)}j.quadraticToFirstY=S;function T(q,J){return J.data().floatAt(q+(1+4*2))}j.quadraticToX=T;function R(q,J){return J.data().floatAt(q+(1+4*3))}j.quadraticToY=R;function b(q,J,ie){J.setFloatAt(q+1,ie)}j.setQuadraticToFirstX=b;function O(q,J,ie){J.setFloatAt(q+5,ie)}j.setQuadraticToFirstY=O;function f(q,J,ie){J.setFloatAt(q+(1+4*2),ie)}j.setQuadraticToX=f;function I(q,J,ie){J.setFloatAt(q+(1+4*3),ie)}j.setQuadraticToY=I;function y(q,J){return J.data().floatAt(q+1)}j.cubicToFirstX=y;function P(q,J){return J.data().floatAt(q+5)}j.cubicToFirstY=P;function E(q,J){return J.data().floatAt(q+(1+4*2))}j.cubicToSecondX=E;function C(q,J){return J.data().floatAt(q+(1+4*3))}j.cubicToSecondY=C;function B(q,J){return J.data().floatAt(q+(1+4*4))}j.cubicToX=B;function G(q,J){return J.data().floatAt(q+(1+4*5))}j.cubicToY=G;function V(q,J,ie){J.setFloatAt(q+1,ie)}j.setCubicToFirstX=V;function D(q,J,ie){J.setFloatAt(q+5,ie)}j.setCubicToFirstY=D;function w(q,J,ie){J.setFloatAt(q+(1+4*2),ie)}j.setCubicToSecondX=w;function k(q,J,ie){J.setFloatAt(q+(1+4*3),ie)}j.setCubicToSecondY=k;function z(q,J,ie){J.setFloatAt(q+(1+4*4),ie)}j.setCubicToX=z;function H(q,J,ie){J.setFloatAt(q+(1+4*5),ie)}j.setCubicToY=H;let K;(Ve=>(Ve[Ve.CLOSE=0]="CLOSE",Ve[Ve.MOVE_TO=1]="MOVE_TO",Ve[Ve.LINE_TO=2]="LINE_TO",Ve[Ve.QUADRATIC_TO=3]="QUADRATIC_TO",Ve[Ve.CUBIC_TO=4]="CUBIC_TO"))(K=j.Kind||(j.Kind={}))})(t=e.Command||(e.Command={}))})(tt||(tt={}));var Ft=class Ft extends tt{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&tt.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e.data())}setFloatAt(e,r){this._invalidateCachedData(),this._data.setFloatAt(e,r)}moveTo1(e,r){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(r),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,r){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(r),this}quadraticTo(e,r,n,o){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(r),this._data.appendFloat(n),this._data.appendFloat(o),this}cubicTo1(e,r,n,o,i,a){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(r),this._data.appendFloat(n),this._data.appendFloat(o),this._data.appendFloat(i),this._data.appendFloat(a),this}cubicTo2(e,r,n){return this.cubicTo1(e.x(),e.y(),r.x(),r.y(),n.x(),n.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&tt.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new Ft(new oo).moveTo1(0,0)._data);for(let r=this.start();tt.Command.isValid(r,this);r=tt.Command.next(r,this))switch(tt.Command.kind(r,this)){case 0:break;case 1:{Ft._p0.setTo(tt.Command.moveToX(r,this),tt.Command.moveToY(r,this)),e.transformPoint(Ft._p0),tt.Command.setMoveToX(r,this,Ft._p0.x()),tt.Command.setMoveToY(r,this,Ft._p0.y());break}case 2:{Ft._p0.setTo(tt.Command.lineToX(r,this),tt.Command.lineToY(r,this)),e.transformPoint(Ft._p0),tt.Command.setLineToX(r,this,Ft._p0.x()),tt.Command.setLineToY(r,this,Ft._p0.y());break}case 3:{Ft._p0.setTo(tt.Command.quadraticToFirstX(r,this),tt.Command.quadraticToFirstY(r,this)),e.transformPoint(Ft._p0),tt.Command.setQuadraticToFirstX(r,this,Ft._p0.x()),tt.Command.setQuadraticToFirstY(r,this,Ft._p0.y()),Ft._p0.setTo(tt.Command.quadraticToX(r,this),tt.Command.quadraticToY(r,this)),e.transformPoint(Ft._p0),tt.Command.setQuadraticToX(r,this,Ft._p0.x()),tt.Command.setQuadraticToY(r,this,Ft._p0.y());break}case 4:{Ft._p0.setTo(tt.Command.cubicToFirstX(r,this),tt.Command.cubicToFirstY(r,this)),e.transformPoint(Ft._p0),tt.Command.setCubicToFirstX(r,this,Ft._p0.x()),tt.Command.setCubicToFirstY(r,this,Ft._p0.y()),Ft._p0.setTo(tt.Command.cubicToSecondX(r,this),tt.Command.cubicToSecondY(r,this)),e.transformPoint(Ft._p0),tt.Command.setCubicToSecondX(r,this,Ft._p0.x()),tt.Command.setCubicToSecondY(r,this,Ft._p0.y()),Ft._p0.setTo(tt.Command.cubicToX(r,this),tt.Command.cubicToY(r,this)),e.transformPoint(Ft._p0),tt.Command.setCubicToX(r,this,Ft._p0.x()),tt.Command.setCubicToY(r,this,Ft._p0.y());break}default:break}}static new2(){return new Ft(new oo)}static fromRect(e){return Ft._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,r,n,o){let i=Ft.new2();return i.moveTo1(e,r).lineTo(e+n,r).lineTo(e+n,r+o).lineTo(e,r+o).close(),i}static fromRoundedRectWithSpread(e,r){return e.adjustCornerRadiiForSpread(r),Ft.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?Ft.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):Ft.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,r,n,o,i){if(i=Math.min(i,Math.min(n/2,o/2)),i==0)return Ft._fromRect(e,r,n,o);let a=Ft.new2(),s=Ft.CIRCLE_APPROXIMATION_CONSTANT*i;return a.moveTo1(e,r+i).cubicTo1(e,r+i-s,e+i-s,r,e+i,r).lineTo(e+n-i,r).cubicTo1(e+n-i+s,r,e+n,r+i-s,e+n,r+i).lineTo(e+n,r+o-i).cubicTo1(e+n,r+o-i+s,e+n-i+s,r+o,e+n-i,r+o).lineTo(e+i,r+o).cubicTo1(e+i-s,r+o,e,r+o-i+s,e,r+o-i).close(),a}static fromRoundedRect3(e,r,n,o,i){let a=!0;for(let c=0,d=i.length;c<d;c=c+1)i[c]!=0&&(a=!1),i[c]=Math.min(i[c],Math.min(n/2,o/2));if(a)return Ft._fromRect(e,r,n,o);let s=Ft.new2(),l=i.map(c=>Ft.CIRCLE_APPROXIMATION_CONSTANT*c);return s.moveTo1(e,r+i[0]).cubicTo1(e,r+i[0]-l[0],e+i[0]-l[0],r,e+i[0],r).lineTo(e+n-i[1],r).cubicTo1(e+n-i[1]+l[1],r,e+n,r+i[1]-l[1],e+n,r+i[1]).lineTo(e+n,r+o-i[2]).cubicTo1(e+n,r+o-i[2]+l[2],e+n-i[2]+l[2],r+o,e+n-i[2],r+o).lineTo(e+i[3],r+o).cubicTo1(e+i[3]-l[3],r+o,e,r+o-i[3]+l[3],e,r+o-i[3]).close(),s}static forEllipse(e){let r=new F(e.left()+e.width()/2,e.top()+e.height()/2),n=new F(e.width()/2,0),o=new F(0,e.height()/2),i=n.multiplyScalar(Ft.CIRCLE_APPROXIMATION_CONSTANT),a=o.multiplyScalar(Ft.CIRCLE_APPROXIMATION_CONSTANT),s=Ft.new2();return s.moveTo2(r.add(n)).cubicTo2(r.add(n).add(a),r.add(i).add(o),r.add(o)).cubicTo2(r.subtract(i).add(o),r.subtract(n).add(a),r.subtract(n)).cubicTo2(r.subtract(n).subtract(a),r.subtract(i).subtract(o),r.subtract(o)).cubicTo2(r.add(i).subtract(o),r.add(n).subtract(a),r.add(n)).close(),s}static forCenterStrokeAroundRect(e,r){let n=e.x(),o=e.y(),i=e.width(),a=e.height(),s=r/2,l=Ft.new2();return l.moveTo1(n-s,o-s).lineTo(n+i+s,o-s).lineTo(n+i+s,o+a+s).lineTo(n-s,o+a+s).lineTo(n-s,o-s).lineTo(n+s,o+s).lineTo(n+s,o+a-s).lineTo(n+i-s,o+a-s).lineTo(n+i-s,o+s).lineTo(n+s,o+s).close(),l}};Ft.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),Ft._p0=F.new(),Ft._p1=F.new(),Ft._p2=F.new(),Ft._p3=F.new(),Ft._r=L.new2();var Lt=Ft;var Gm;(w=>{function t(k,z){w._p.setTo(0,0);for(let H=k.start();tt.Command.isValid(H,k);H=tt.Command.next(H,k)){switch(tt.Command.kind(H,k)){case tt.Command.Kind.CLOSE:break;case tt.Command.Kind.MOVE_TO:{w._p3.setTo(tt.Command.moveToX(H,k),tt.Command.moveToY(H,k)),w._p.copyFrom(w._p3);break}case tt.Command.Kind.LINE_TO:{w._p3.setTo(tt.Command.lineToX(H,k),tt.Command.lineToY(H,k)),p(z,w._p,w._p0,w._p3);break}case tt.Command.Kind.QUADRATIC_TO:{let K=w._p0.x(),j=w._p0.y(),q=tt.Command.quadraticToFirstX(H,k),J=tt.Command.quadraticToFirstY(H,k),ie=tt.Command.quadraticToX(H,k),Ee=tt.Command.quadraticToY(H,k);w._p1.setTo(q+(K-q)/3,J+(j-J)/3),w._p2.setTo(q+(ie-q)/3,J+(Ee-J)/3),w._p3.setTo(ie,Ee),p(z,w._p,w._p0,w._p3),s(z,w._p0,w._p1,w._p2,w._p3,0,0);break}case tt.Command.Kind.CUBIC_TO:{w._p1.setTo(tt.Command.cubicToFirstX(H,k),tt.Command.cubicToFirstY(H,k)),w._p2.setTo(tt.Command.cubicToSecondX(H,k),tt.Command.cubicToSecondY(H,k)),w._p3.setTo(tt.Command.cubicToX(H,k),tt.Command.cubicToY(H,k)),p(z,w._p,w._p0,w._p3),s(z,w._p0,w._p1,w._p2,w._p3,0,0);break}default:break}w._p0.copyFrom(w._p3)}}w.compile=t;function e(k){return Math.abs(k)<w._EPSILON?0:k}w._roundToZero=e;function r(k,z){return k.squaredDistanceTo(z)<w._EPSILON*w._EPSILON}w._approxEqual=r;function n(k,z,H){let K=(H.x()-z.x())*(z.y()-k.y())-(H.y()-z.y())*(z.x()-k.x());return K<0?-1:K>0?1:0}w._orientation=n;function o(k,z,H,K){return n(k,z,H)!=n(k,z,K)&&n(H,K,k)!=n(H,K,z)}w._linesIntersect=o;function i(k,z,H,K){let j=K.x()-z.x(),q=K.y()-z.y(),J=H.x()-z.x(),ie=H.y()-z.y(),Ee=k.x()-z.x(),Ke=k.y()-z.y(),Ve=j*j+q*q,at=j*J+q*ie,Dt=j*Ee+q*Ke,qt=J*J+ie*ie,zt=J*Ee+ie*Ke,ae=Ve*qt-at*at;if(ae==0)return!1;let nt=1/ae,Et=(qt*Dt-at*zt)*nt,He=(Ve*zt-at*Dt)*nt,st=1e-4;return Et>=-st&&He>=-st&&Et+He<=1+st}w._pointInTriangle=i;function a(k,z,H){return k.x*(z.y*H.z-z.z*H.y)+k.y*(z.z*H.x-z.x*H.z)+k.z*(z.x*H.y-z.y*H.x)}w._dotCross=a;function s(k,z,H,K,j,q,J){if(q==0||J<4){let Et=j.x()-z.x(),He=j.y()-z.y(),st=(H.x()-z.x())*He-(H.y()-z.y())*Et,ke=(K.x()-z.x())*He-(K.y()-z.y())*Et,kt=3*st-3*ke,Zt=-4*st+2*ke,Wt=st,br=Zt*Zt-4*Wt*kt;if(br>0){let on=-Zt/(2*kt),an=Math.sqrt(br)/(2*kt),_o=on+an,Ia=on-an;if(0<_o&&_o<1&&0<Ia&&Ia<1){let vr=(_o+Ia)/2;for(let me=0;me<10;me=me+1){let Pe=st-ke,be=ke-2*st,x=vr*(vr*(vr*Pe+be)+st),M=vr*(3*vr*Pe+2*be)+st;vr-=x/M}let ri=z.mixedWith(H,vr),Xi=H.mixedWith(K,vr),vi=K.mixedWith(j,vr),ji=ri.mixedWith(Xi,vr),Zi=Xi.mixedWith(vi,vr),Ci=ji.mixedWith(Zi,vr);s(k,z,ri,ji,Ci,1,J+1),s(k,Ci,Zi,vi,j,1,J+1),p(k,z,Ci,j);return}}}w._b0.setTo(z.x(),z.y(),1),w._b1.setTo(H.x(),H.y(),1),w._b2.setTo(K.x(),K.y(),1),w._b3.setTo(j.x(),j.y(),1);let ie=a(w._b0,w._b3,w._b2),Ee=a(w._b1,w._b0,w._b3),Ke=a(w._b2,w._b1,w._b0),Ve=ie-2*Ee+3*Ke,at=-Ee+3*Ke,Dt=3*Ke,qt=1/Math.sqrt(Ve*Ve+at*at+Dt*Dt);Ve*=qt,at*=qt,Dt*=qt;let zt=3*at*at-4*Ve*Dt,ae=Ve*Ve*zt;switch(Ve=e(Ve),at=e(at),Dt=e(Dt),ae=e(ae),r(w._b0,w._b1)&&r(w._b0,w._b2)&&r(w._b0,w._b3)?0:ae<0?4:ae>0?5:Ve==0&&at==0?Dt==0?1:2:Ve==0?3:zt<0?4:5){case 5:{let Et=Math.sqrt(Math.max(0,9*at*at-12*Ve*Dt)),He=3*at-Et,st=6*Ve,ke=3*at+Et,kt=st,Zt=st-He,Wt=kt-ke;c(k,z,He*ke,He*He*He,ke*ke*ke,H,(3*He*ke-He*kt-st*ke)/3,He*He*(He-st),ke*ke*(ke-kt),K,(st*(kt-2*ke)+He*(3*ke-2*kt))/3,Zt*Zt*He,Wt*Wt*ke,j,Zt*Wt,-Zt*Zt*Zt,-Wt*Wt*Wt);break}case 4:{let Et=Math.sqrt(Math.max(0,4*Ve*Dt-3*at*at)),He=at-Et,st=2*Ve,ke=at+Et,kt=st;if(q!=2||J<4){let br=He/st,on=ke/kt,an=w._EPSILON<br&&br<1-w._EPSILON,_o=w._EPSILON<on&&on<1-w._EPSILON;if(an&&_o){l(k,z,H,K,j,Math.min(br,on),Math.max(br,on),J+1);return}if(an){l(k,z,H,K,j,br,-1,J+1);return}if(_o){l(k,z,H,K,j,on,-1,J+1);return}}let Zt=st-He,Wt=kt-ke;c(k,z,He*ke,He*He*ke,He*ke*ke,H,(-He*kt-st*ke+3*He*ke)/3,-He*(He*(kt-3*ke)+2*st*ke)/3,-ke*(He*(2*kt-3*ke)+st*ke)/3,K,(st*(kt-2*ke)+He*(3*ke-2*kt))/3,(st-He)*(He*(2*kt-3*ke)+st*ke)/3,(kt-ke)*(He*(kt-3*ke)+2*st*ke)/3,j,Zt*Wt,-Zt*Zt*Wt,-Zt*Wt*Wt);break}case 3:{let Et=Dt,He=3*at,st=Et-He;c(k,z,Et,Et*Et*Et,1,H,Et-He/3,Et*Et*st,1,K,Et-He*(2/3),st*st*Et,1,j,st,st*st*st,1);break}case 2:{c(k,z,0,0,0,H,1/3,0,1/3,K,2/3,1/3,2/3,j,1,1,1);break}}}w._compileCubic=s;function l(k,z,H,K,j,q,J,ie){let Ee=z.mixedWith(H,q),Ke=H.mixedWith(K,q),Ve=K.mixedWith(j,q),at=Ee.mixedWith(Ke,q),Dt=Ke.mixedWith(Ve,q),qt=at.mixedWith(Dt,q);if(p(k,z,qt,j),s(k,z,Ee,at,qt,2,ie+1),J==-1){s(k,qt,Dt,Ve,j,2,ie+1);return}let zt=qt,ae=Dt,nt=Ve,Et=j,He=(J-q)/(1-q),st=zt.mixedWith(ae,He),ke=ae.mixedWith(nt,He),kt=nt.mixedWith(Et,He),Zt=st.mixedWith(ke,He),Wt=ke.mixedWith(kt,He),br=Zt.mixedWith(Wt,He);s(k,zt,st,Zt,br,2,ie+1),s(k,br,Wt,kt,Et,2,ie+1)}w._compileSubdividedCubic=l;function c(k,z,H,K,j,q,J,ie,Ee,Ke,Ve,at,Dt,qt,zt,ae,nt){w._v0.set(z,H,K,j),w._v1.set(q,J,ie,Ee),w._v2.set(Ke,Ve,at,Dt),w._v3.set(qt,zt,ae,nt);let Et=(H+zt)*(.9/2)+(J+Ve)*(.1/2),He=(K+ae)*(.9/2)+(ie+at)*(.1/2),st=(j+nt)*(.9/2)+(Ee+Dt)*(.1/2),ke=Et*Et*Et-He*st>0,kt=0,Zt=0;for(let an=0;an<4;an=an+1){let _o=Ut.int_remainder(an+1,4),Ia=Ut.int_remainder(an+2,4),vr=Ut.int_remainder(an+3,4),ri=w._v[_o].xy,Xi=w._v[Ia].xy,vi=w._v[vr].xy,ji=ri.distanceTo(Xi),Zi=Xi.distanceTo(vi),Ci=vi.distanceTo(ri),me=(ji+Zi+Ci)/2,Pe=me*(me-ji)*(me-Zi)*(me-Ci);Pe>kt&&(kt=Pe,Zt=an)}let Wt=Ut.int_remainder(Zt+1,4),br=Ut.int_remainder(Zt+2,4),on=Ut.int_remainder(Zt+3,4);if(i(w._v[Zt].xy,w._v[Wt].xy,w._v[br].xy,w._v[on].xy)){_(k,w._v[Wt],w._v[br],w._v[on],ke);return}o(z,Ke,q,qt)?z.squaredDistanceTo(Ke)<q.squaredDistanceTo(qt)?(_(k,w._v0,w._v1,w._v2,ke),_(k,w._v0,w._v2,w._v3,ke)):(_(k,w._v0,w._v1,w._v3,ke),_(k,w._v1,w._v2,w._v3,ke)):o(z,qt,q,Ke)?z.squaredDistanceTo(qt)<q.squaredDistanceTo(Ke)?(_(k,w._v0,w._v1,w._v3,!ke),_(k,w._v0,w._v3,w._v2,ke)):(_(k,w._v0,w._v1,w._v2,ke),_(k,w._v2,w._v1,w._v3,ke)):z.squaredDistanceTo(q)<Ke.squaredDistanceTo(qt)?(_(k,w._v0,w._v2,w._v1,ke),_(k,w._v0,w._v1,w._v3,ke)):(_(k,w._v0,w._v2,w._v3,ke),_(k,w._v3,w._v2,w._v1,ke))}w._appendQuad=c;function d(k,z,H){return k.equals(z)||k.equals(H)||z.equals(H)}w._isEmptyTriangle=d;function u(k,z,H,K,j,q){k.appendFloat(z).appendFloat(H),k.appendFloat(K).appendFloat(j).appendFloat(q)}w._appendVertex=u;function p(k,z,H,K){d(z,H,K)||(u(k,z.x(),z.y(),.5,.5,.5),u(k,H.x(),H.y(),.5,.5,.5),u(k,K.x(),K.y(),.5,.5,.5))}w._appendTriangle1=p;function _(k,z,H,K,j){if(!d(z.xy,H.xy,K.xy)){let q=j?-1:1;u(k,z.xy.x(),z.xy.y(),z.k*q,z.l*q,z.m),u(k,H.xy.x(),H.xy.y(),H.k*q,H.l*q,H.m),u(k,K.xy.x(),K.xy.y(),K.k*q,K.l*q,K.m)}}w._appendTriangle2=_;class h{setTo(z,H,K){this.x=z,this.y=H,this.z=K}squaredDistanceTo(z){let H=this.x-z.x,K=this.y-z.y,j=this.z-z.z;return H*H+K*K+j*j}constructor(){this.x=0,this.y=0,this.z=0}}w.Vector3=h;class g{set(z,H,K,j){this.xy=z,this.k=H,this.l=K,this.m=j}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}w.Vector5=g;let m;(K=>(K[K.INITIAL=0]="INITIAL",K[K.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",K[K.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(m=w.CompileState||(w.CompileState={}));let A;(J=>(J[J.POINT=0]="POINT",J[J.LINE=1]="LINE",J[J.QUADRATIC=2]="QUADRATIC",J[J.CUSP=3]="CUSP",J[J.LOOP=4]="LOOP",J[J.SERPENTINE=5]="SERPENTINE"))(A=w.SegmentClass||(w.SegmentClass={})),w._EPSILON=5e-4,w._p=F.new(),w._p0=F.new(),w._p1=F.new(),w._p2=F.new(),w._p3=F.new(),w._b0=new h,w._b1=new h,w._b2=new h,w._b3=new h,w._v0=new g,w._v1=new g,w._v2=new g,w._v3=new g,w._v=[w._v0,w._v1,w._v2,w._v3]})(Gm||(Gm={}));var Um=class{constructor(e,r){this.key=e,this.value=r}},ia=class{each(e){nr.IntMap_each(this._buckets,(r,n)=>{for(let o of n)e(o.key,o.value)})}getOrInsertFallback(e){let r=this._hash(e),n=nr.IntMap_get(this._buckets,r,null);if(n!=null){for(let i of n)if(this._equals(e,i.key))return i.value}else n=[],this._buckets.set(r,n);let o=this._fallback(e);return n.push(new Um(e,o)),o}get(e,r){let n=this._hash(e),o=nr.IntMap_get(this._buckets,n,null);if(o!=null){for(let i of o)if(this._equals(e,i.key))return i.value}return r}getOrNull(e){return this.get(e,null)}set(e,r){let n=this._hash(e),o=nr.IntMap_get(this._buckets,n,null);o==null&&(o=[],this._buckets.set(n,o));for(let i of o)if(this._equals(e,i.key)){i.value=r;return}o.push(new Um(e,r))}remove(e){let r=this._hash(e),n=nr.IntMap_get(this._buckets,r,null);if(n!=null){for(let o=0,i=n.length;o<i;o=o+1)if(this._equals(e,n[o].key)){n.splice(o,1),n.length==0&&this._buckets.delete(r);break}}}constructor(e,r,n){this._buckets=new Map,this._hash=e,this._equals=r,this._fallback=n}};var av=class{initialize(e){this._bindings=e}bindContext(e,r){var n;(n=this._bindings)==null||n.bindContext(e,r)}getNewProgramId(){return this._bindings.getNewProgramId()}getFramebuffer(e){return this._bindings.getFramebuffer(e)}getRenderbuffer(e){return this._bindings.getRenderbuffer(e)}getTexture(e){return this._bindings.getTexture(e)}},xa=new av;var Ao=class Ao{static createInterpolateBlendState(e){return new Ao(va.INTERPOLATE,10,11,10,11,e)}constructor(e,r,n,o,i,a){this.type=e,this.sourceColor=r,this.targetColor=n,this.sourceAlpha=o,this.targetAlpha=i,this.constant=a}};Ao.ZERO=new Ao(void 0,0,0,0,0,0),Ao.COPY=new Ao(va.COPY,1,0,1,0,0),Ao.KEEP=new Ao(va.KEEP,0,1,0,1,0),Ao.PREMULTIPLIED=new Ao(va.PREMULTIPLIED,1,8,1,8,0),Ao.UNPREMULTIPLIED=new Ao(va.UNPREMULTIPLIED,6,8,6,8,0),Ao.SCREEN=new Ao(va.SCREEN,1,4,1,8,0),Ao.LINEAR_DODGE=new Ao(va.LINEAR_DODGE,1,1,1,8,0);var It=Ao;var Ls;(o=>{let t;(s=>(s.SCENE_GRAPH_RENDERING="_sceneGraphRendering",s.OVERLAY_UI_RENDERING="_overlayUIRendering"))(t=o.GpuSubMetricsType||(o.GpuSubMetricsType={}));class e{constructor(){this._drawCalls=0;this._triangles=0;this._tristrips=0;this._trilists=0;this._vertices=0;this._clears=0;this._flushes=0;this._uniqueShaderPrograms=0;this._shaderChanges=0;this._glEnables=0;this._glDisables=0;this._framebufferBinds=0;this._uniformVariablesSet=0;this._texturesCreated=0;this._texturesDestroyed=0;this._textureBinds=0;this._texturesReferenced=0;this._vertexBuffersCreated=0;this._vertexBuffersDestroyed=0;this._vertexBuffersReferenced=0;this._uniformBuffersCreated=0;this._uniformBuffersDestroyed=0;this._uniformBuffersReferenced=0;this._totalBandwidth=0;this._readBandwidth=0;this._writeBandwidth=0;this._pixelReadBandwidth=0;this._textureWriteBandwidth=0;this._vertexBufferWriteBandwidth=0;this._uniformBufferWriteBandwidth=0;this._uniformVarsWriteBandwidth=0;this._uniformBufferUsedAreaWriteBandwidth=0;this._textureUploadCount=0;this._vertexBufferUploadCount=0;this._uniformBufferUploadCount=0;this.reset()}reset(){this._drawCalls=0,this._triangles=0,this._tristrips=0,this._trilists=0,this._vertices=0,this._clears=0,this._flushes=0,this._uniqueShaderPrograms=0,this._shaderChanges=0,this._glEnables=0,this._glDisables=0,this._framebufferBinds=0,this._uniformVariablesSet=0,this._texturesCreated=0,this._texturesDestroyed=0,this._textureBinds=0,this._texturesReferenced=0,this._vertexBuffersCreated=0,this._vertexBuffersDestroyed=0,this._vertexBuffersReferenced=0,this._uniformBuffersCreated=0,this._uniformBuffersDestroyed=0,this._uniformBuffersReferenced=0,this._totalBandwidth=0,this._readBandwidth=0,this._writeBandwidth=0,this._pixelReadBandwidth=0,this._textureWriteBandwidth=0,this._vertexBufferWriteBandwidth=0,this._uniformBufferWriteBandwidth=0,this._uniformVarsWriteBandwidth=0,this._uniformBufferUsedAreaWriteBandwidth=0,this._textureUploadCount=0,this._vertexBufferUploadCount=0,this._uniformBufferUploadCount=0}}o.GpuSubMetrics=e;class r{constructor(){this._gpuSubMetrics={_sceneGraphRendering:new e,_overlayUIRendering:new e};this._bgtIsWorkExceedingBudget=!1;this._bgtBrokeRenderAt="";this._bgtDidCompleteInterruptedFrame=!1;this._bgtHasPendingInterruptForNextFrame=!1;this._bgtTimePastRenderingDeadline=0;this._bgtTilesRendersRemaining=0;this._bgtTileCacheCapacityRemaining=0;this._bgtFrameBufferSwitchRemaining=0;this._bgtDidRasterWork=!1;this._bgtBlitToScreen=!1;this._bgtOnScreenTileCompletionCount=0;this._bgtOnScreenTileReuseCount=0;this._bgtOffScreenTileCompletionCount=0;this._bgtOptionalTileCompletionCount=0;this._bgtClearedExistingInterrupt=!1;this._currentFrameSubMetricsType="_sceneGraphRendering";this._gpuSubMetrics._sceneGraphRendering=new e,this._gpuSubMetrics._overlayUIRendering=new e,this.reset()}updateFrameBudgetInfo(a){this._bgtIsWorkExceedingBudget=!a.permitsMoreWork(),this._bgtTimePastRenderingDeadline=a.pastRenderingBudgetTime(),this._bgtTilesRendersRemaining=a.tileRenderingBudgetRemaining(),this._bgtTileCacheCapacityRemaining=a.tileCacheCapacityRemaining(),this._bgtFrameBufferSwitchRemaining=a.frameBufferSwitchBudgetRemaining()}logUniformVariableSet(a){this._gpuSubMetrics[this._currentFrameSubMetricsType]._uniformVariablesSet++,this._gpuSubMetrics[this._currentFrameSubMetricsType]._totalBandwidth+=a,this._gpuSubMetrics[this._currentFrameSubMetricsType]._writeBandwidth+=a,this._gpuSubMetrics[this._currentFrameSubMetricsType]._uniformVarsWriteBandwidth+=a}getCurrentFrameGPUSubMetrics(){return this._gpuSubMetrics[this._currentFrameSubMetricsType]}setCurrentFrameSubMetricsType(a){this._currentFrameSubMetricsType=a}reset(){this._gpuSubMetrics._sceneGraphRendering.reset(),this._gpuSubMetrics._overlayUIRendering.reset(),this._bgtIsWorkExceedingBudget=!1,this._bgtBrokeRenderAt="",this._bgtDidCompleteInterruptedFrame=!1,this._bgtHasPendingInterruptForNextFrame=!1,this._bgtTimePastRenderingDeadline=0,this._bgtTilesRendersRemaining=0,this._bgtTileCacheCapacityRemaining=0,this._bgtFrameBufferSwitchRemaining=0,this._bgtDidRasterWork=!1,this._bgtBlitToScreen=!1,this._bgtOnScreenTileCompletionCount=0,this._bgtOnScreenTileReuseCount=0,this._bgtOffScreenTileCompletionCount=0,this._bgtOptionalTileCompletionCount=0,this._bgtClearedExistingInterrupt=!1}}o.GpuMetrics=r;class n{constructor(){this._defaultBufferSize=0;this._currentFrame=0;this._framesBuffered=0;this._metricsBuffer=[];this._referencedShaderPrograms=new Set}getCurrentFrameIndex(){return this._currentFrame}nextFrame(){this._metricsBuffer.length==0&&this.setBufferSize(this._defaultBufferSize),this._currentFrame=(this._currentFrame+1)%this._metricsBuffer.length,this._framesBuffered=Math.min(this._framesBuffered+1,this._metricsBuffer.length),this._metricsBuffer[this._currentFrame].reset(),this._referencedShaderPrograms=new Set}getBuffer(){let a=[];if(this._framesBuffered>0){let s=this._currentFrame==this._metricsBuffer.length-1?0:this._currentFrame+1,l=0;for(let c=s;c<this._metricsBuffer.length&&l<this._framesBuffered;c++,l++)a[l]=Object.assign({},this._metricsBuffer[c]);for(let c=0;l<this._framesBuffered;c++,l++)a[l]=Object.assign({},this._metricsBuffer[c])}return a}getBufferSize(){return this._metricsBuffer.length}jsonReplacerForTests(a,s){if(!(a=="_bgtIsWorkExceedingBudget"||a=="_bgtTimePastRenderingDeadline"||a=="_bgtTilesRendersRemaining"||a=="_bgtTileCacheCapacityRemaining"||a=="_bgtFrameBufferSwitchRemaining"||s===0))return s}getBufferJsonForTest(){let a=this.getBuffer();return JSON.stringify(a,this.jsonReplacerForTests)}getCurrentFrameGPUSubMetrics(){return this._metricsBuffer[this._currentFrame].getCurrentFrameGPUSubMetrics()}getCurrentFrameGPUMetrics(){return this._metricsBuffer[this._currentFrame]}getPreviousFrameGPUMetrics(){return this._framesBuffered<2?null:this._currentFrame>0?this._metricsBuffer[this._currentFrame-1]:this._metricsBuffer[this._metricsBuffer.length-1]}setBufferSize(a){if(a<2)return!1;if(a==this._metricsBuffer.length)return!0;this._currentFrame=0,this._framesBuffered=0,this._metricsBuffer=[];for(let s=0;s<a;s++)this._metricsBuffer.push(new r);return this._referencedShaderPrograms=new Set,!0}referenceShaderProgram(a){this._referencedShaderPrograms.add(a),this.getCurrentFrameGPUSubMetrics()._uniqueShaderPrograms=this._referencedShaderPrograms.size}}o.GpuMetricsCollection=n})(Ls||(Ls={}));var El=class{constructor(e){this._textures=new Map;this._emptyTexture=null;this._context=e}textureForColor(e){let r=this._textures.get(e);if(r===void 0){let n=new Uint8Array([N.red(e),N.green(e),N.blue(e),N.alpha(e)]);r=this._context.createTextureWithPixels(Fe.RGBA_LINEAR_CLAMP,1,1,n,fr.SINGLE_PIXEL_TEXTURE),this._textures.set(e,r)}return r}emptyTexture(){return this._emptyTexture===null&&(this._emptyTexture=this.textureForColor(N.TRANSPARENT)),this._emptyTexture}clear(){this._textures.clear(),this._emptyTexture=null}};var Mi=class Mi{};Mi.FILL=128,Mi.STROKE=64,Mi.NOT_FILL=255^Mi.FILL,Mi.NOT_STROKE=255^Mi.STROKE,Mi.FILL_AND_STROKE=Mi.FILL|Mi.STROKE,Mi.WINDING_MASK=255^Mi.FILL_AND_STROKE;var Qr=Mi,Vm=class Vm{equals(e){return this==e||this.comparison==e.comparison&&this.stencilFail==e.stencilFail&&this.stencilPassDepthPass==e.stencilPassDepthPass}constructor(e,r,n){this.comparison=e,this.stencilFail=r,this.stencilPassDepthPass=n}};Vm.NONE=new Vm(6,5,5);var zn=Vm,hr=class hr{constructor(e,r,n,o,i,a,s){this.type=e,this.isEnabled=s,this.frontFace=r,this.backFace=n,this.readMask=o,this.writeMask=i,this.reference=a}static both(e,r,n,o,i){return new hr(e,r,r,n,o,i,!0)}equals(e){return this==e||this.type===e.type&&this.isEnabled==e.isEnabled&&this.frontFace.equals(e.frontFace)&&this.backFace.equals(e.backFace)&&this.readMask===e.readMask&&this.writeMask===e.writeMask&&this.reference===e.reference}};hr.NONE=new hr(Vn.NONE,zn.NONE,zn.NONE,0,-1,0,!1),hr.ODD_WINDING_NUMBER_COMPUTE=hr.both(Vn.ODD_WINDING_NUMBER_COMPUTE,new zn(0,5,4),1,1,0),hr.NONZERO_WINDING_NUMBER_COMPUTE=new hr(Vn.NONZERO_WINDING_NUMBER_COMPUTE,new zn(0,5,3),new zn(0,5,1),Qr.WINDING_MASK,Qr.WINDING_MASK,0,!0),hr.ODD_WINDING_NUMBER=hr.both(Vn.ODD_WINDING_NUMBER,new zn(7,5,5),1,0,0),hr.NONZERO_WINDING_NUMBER=hr.both(Vn.NONZERO_WINDING_NUMBER,new zn(7,5,5),Qr.WINDING_MASK,0,0),hr.ODD_WINDING_NUMBER_CLEAR=hr.both(Vn.ODD_WINDING_NUMBER_CLEAR,new zn(7,7,7),1,Qr.WINDING_MASK,0),hr.NONZERO_WINDING_NUMBER_CLEAR=hr.both(Vn.NONZERO_WINDING_NUMBER_CLEAR,new zn(7,7,7),Qr.WINDING_MASK,Qr.WINDING_MASK,0),hr.ODD_WINDING_NUMBER_FILL=hr.both(Vn.ODD_WINDING_NUMBER_FILL,new zn(7,5,6),1,Qr.NOT_STROKE,Qr.FILL),hr.NONZERO_WINDING_NUMBER_FILL=hr.both(Vn.NONZERO_WINDING_NUMBER_FILL,new zn(7,5,6),Qr.WINDING_MASK,Qr.NOT_STROKE,Qr.FILL),hr.ODD_WINDING_NUMBER_STROKE=hr.both(Vn.ODD_WINDING_NUMBER_STROKE,new zn(7,5,6),1,Qr.NOT_FILL,Qr.STROKE),hr.NONZERO_WINDING_NUMBER_STROKE=hr.both(Vn.NONZERO_WINDING_NUMBER_STROKE,new zn(7,5,6),Qr.WINDING_MASK,Qr.NOT_FILL,Qr.STROKE),hr.STROKE_INSIDE=hr.both(Vn.STROKE_INSIDE,new zn(1,5,5),Qr.FILL_AND_STROKE,0,Qr.FILL_AND_STROKE),hr.STROKE_OUTSIDE=hr.both(Vn.STROKE_OUTSIDE,new zn(1,5,5),Qr.FILL_AND_STROKE,0,Qr.STROKE),hr.STROKE_INSIDE_CLEAR=hr.both(Vn.STROKE_CLEAR,new zn(1,7,7),Qr.FILL_AND_STROKE,-1,Qr.FILL_AND_STROKE),hr.STROKE_OUTSIDE_CLEAR=hr.both(Vn.STROKE_CLEAR,new zn(1,7,7),Qr.FILL_AND_STROKE,-1,Qr.STROKE);var gr=hr;var Cc=class Cc{totalVRAM(){return this._chunks.length*Cc.CHUNK_SIZE_IN_BYTES}usedVRAM(){return this._chunks.reduce((e,r)=>e+r.getBytesUsed(),0)}allocateVertexBufferAreas(e,r,n){if(n.length===0)return[];let o=[],i=this.chunkSizeInBytes(),a=r.stride();if(e==ze.TRIANGLES){let s=i-Ut.int_remainder(i,a*3),l=(n.length+s-1)/s|0;for(let c=0,d=l;c<d;c=c+1){let u=n.subarray(c*s,c*s+s),p=this.allocate(r,u);p!=null&&o.push(p)}l>1&&console.debug(`splitting ${n.length} byte geometry buffer into ${l} chunks`)}else if(e==ze.TRIANGLE_STRIP){let l=Math.floor(4+2*((i-4*a)/(2*a)))*a,c=(n.length-1)/l|0,d=0;for(;;){let u=n.subarray(d,d+Math.min(l,n.length-d)),p=this.allocate(r,u);if(p!=null){if(o.push(p),d+=l,d>=n.length)break;d-=2*r.stride()}}c>1&&console.debug(`splitting ${n.length} byte geometry buffer into ${c} chunks`)}return o}allocateInstanceBufferArea(e){return this.allocate(bt.getInstanceTransform_F3_F3(),e)}allocate(e,r){if(r.length==0)return null;r.length<=Cc.CHUNK_SIZE_IN_BYTES;let n=this._enableDiscardBytesAfterUpload,o=e.stride();for(let a of this._chunks){let s=a.tryToAllocate(o,r,n);if(s!=null)return s}let i=new lv(this,this._bufferProvider.createVertexBuffer(Cc.CHUNK_SIZE_IN_BYTES,this._enableDiscardBytesAfterUpload));return this._chunks.push(i),i.tryToAllocate(o,r,n)}allocateSmallManagedArea(e,r,n){let o=new Uint8Array(n);return new Fi(()=>this.allocate(r,o))}chunkSizeInBytes(){return Cc.CHUNK_SIZE_IN_BYTES}constructor(e,r){this._context=e,this._bufferProvider=r,this._chunks=[],this._enableDiscardBytesAfterUpload=U.shouldEnableVertexBufferDiscardBytesAfterUpload(),this._enableDiscardBytesAfterUpload&&this._context.addContextResetHandler(()=>{var n;for(let o of this._chunks)for(let i of o.areas)(n=i.unwrap())==null||n.invalidate();this._chunks=[]})}};Cc.CHUNK_SIZE_IN_BYTES=4*1024*1024;var Ms=Cc,sv=class t{constructor(e,r,n){this._area=e,this._areaWeakRef=r,this._byteCount=n}static wrap(e){return U.viewerCleanupBufferAreas()?new t(null,new WeakRef(e),e.byteCount()):new t(e,null,e.byteCount())}unwrap(){var e;return this._area??((e=this._areaWeakRef)==null?void 0:e.deref())??null}wasFreed(){var e;return((e=this.unwrap())==null?void 0:e.wasFreed())??!0}wasReclaimedBySystem(){return this._areaWeakRef&&!this._areaWeakRef.deref()}byteCount(){var e;return((e=this._area)==null?void 0:e.byteCount())??this._byteCount}},lv=class t{tryToAllocate(e,r,n){let o=r.length,i=this.areas,a=null;if(this.getBytesUsed()+o<=Ms.CHUNK_SIZE_IN_BYTES){for(;i.length!=0&&le.List_last(i).wasFreed();)le.List_removeLast(i);a=this.allocateAtEnd(e,r),a==null&&!n&&(this.runCompactingGC(),a=this.allocateAtEnd(e,r)),a!=null&&(this.buffer.setBytesForUpload(r,a.byteOffset()),U.viewerCleanupBufferAreas()||(this.bytesUsed=this.bytesUsed+o),i.push(sv.wrap(a)))}return a}allocateAtEnd(e,r){let n=this.validAreas(),o=n.length==0?0:t._alignToNextMultiple(le.List_last(n).byteOffset()+le.List_last(n).byteCount(),e);return o+r.length<=Ms.CHUNK_SIZE_IN_BYTES?new Oc(this,r.length,e,o,r):null}validAreas(){return this.areas.map(e=>e.unwrap()).filter(e=>e!=null)}runCompactingGC(){var r;let e=0;if(le.List_removeIf(this.areas,n=>{let o=n.unwrap();return o==null||o.wasFreed()?!0:(e=t._alignToNextMultiple(e,o.stride()),o.byteOffset()!=e&&(this.buffer.moveBytesForUpload(o.byteOffset(),e,o.byteCount()),o.wasMovedTo(e)),e=e+o.byteCount(),!1)}),!nm)for(let n of this.areas)(r=n.unwrap())==null||r.assertBytesAreAsExpected()}getBytesUsed(){if(U.viewerCleanupBufferAreas()){let e=0;for(let r of this.areas)e+=r.wasFreed()?0:r.byteCount();return e}else return this.bytesUsed}static _alignToNextMultiple(e,r){return e+Ut.int_remainder(r-Ut.int_remainder(e,r),r)}constructor(e,r){this.pool=e,this.buffer=r,this.areas=[],this.bytesUsed=0}},Oc=class{constructor(e,r,n,o,i){this._wasFreed=!1,this._expectedArray=null,this._chunk=e,this._byteCount=r,this._stride=n,this._byteOffset=o,nm||this._saveBytes(i)}_saveBytes(e){this._expectedArray=new Uint8Array(e)}assertBytesAreAsExpected(){if(nm||this._expectedArray==null||this._chunk==null)return;let e=this._chunk.buffer.bytesForUpload();if(e!=null)for(let r=0,n=this._byteCount;r<n;r=r+1)this._expectedArray[r]!=e[r+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){var e;return((e=this._chunk)==null?void 0:e.buffer)??null}hasBuffer(){var e;return((e=this._chunk)==null?void 0:e.buffer)!=null}bufferBytesForUpload(){var e,r;return((r=(e=this._chunk)==null?void 0:e.buffer)==null?void 0:r.bytesForUpload())??null}free(){!this._wasFreed&&this._chunk!=null&&(this._wasFreed=!0,U.viewerCleanupBufferAreas()||(this._chunk.bytesUsed-=this.byteCount()))}wasMovedTo(e){this._byteOffset=e}invalidate(){this._chunk=null}};function Ld(){return Sv}function FV(t){Sv=t}var cv=class{constructor(){this._currentAttribIsInstanced=new Array(16)}},dv=class{constructor(){this._currentVertexBuffers=new Array(32);this._currentVertexBufferOffsets=new Array(32);this._numVertexBuffers=0;this._bufferStateDirty=!1;this._inputLayoutStateDirty=!1}},uv=class{constructor(e){this._context=e}createVertexBuffer(e,r){return new wd(this._context,e,r)}},Bi=class Bi{constructor(e){this._drawArraysInstancedInternal=null;this._vertexAttribDivisorInternal=null;this._gl2=null;this._resetState(),this._stats=new tm,this._contextResetHandlers=[],this._forceStateUpdate=!0,this._generation=1,this._cachedSize=new F(0,0),this._defaultViewport=L.new2(),this._mockMaximumDrawingBufferSize=null,this._hasLoggedHighpPrecisionUnsupported=!1,this._gpuMetricsCollection=new Ls.GpuMetricsCollection,this._gpuMetricsCollection.setBufferSize(2);let r={antialias:!1,depth:!1,stencil:!1,alpha:e.needsAlpha,preserveDrawingBuffer:Ca||en,powerPreference:"high-performance"};if(this._gl=ap(U.shouldUseWebGL2(),r),this._gl==null&&(r.powerPreference="default",this._gl=ap(U.shouldUseWebGL2(),r)),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");if(this._gl!==null)if(this._gl instanceof WebGL2RenderingContext)this._gl2=this._gl,this._drawArraysInstancedInternal=(i,a,s,l)=>{this._gl2.drawArraysInstanced(i,a,s,l)},this._vertexAttribDivisorInternal=(i,a)=>{this._gl2.vertexAttribDivisor(i,a)};else{let i=this._gl.getExtension("ANGLE_instanced_arrays");i!==null&&(this._drawArraysInstancedInternal=(a,s,l,c)=>{i.drawArraysInstancedANGLE(a,s,l,c)},this._vertexAttribDivisorInternal=(a,s)=>{i.vertexAttribDivisorANGLE(a,s)})}U.useUnifiedRenderer()&&(v()?(xa.bindContext(this._gl,r),v().initializeRenderer()):ts().then(i=>{xa.bindContext(this._gl,r),i.initializeRenderer()})),this._loadASTCCompressedTexturesExtension(),this._loadS3TCCompressedTexturesExtension(),this._loadOESStandardDerivativesExtension(!0);let n=this._gl.canvas,o=n.style;n.width=0,n.height=0,o.display="block",o.left="0",o.top="0",Tr.EventTarget_addEventListener2(n,"webglcontextlost",i=>{console.warn("WebGL context was lost"),Ji.Event_preventDefault(i)}),Tr.EventTarget_addEventListener1(n,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._resetState(),this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let i of this._contextResetHandlers)i()}),V1(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,lr.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new aa(this,Fe.RGBA_NEAREST_CLAMP,1,1,lr.createFromPixels(1,1,new Uint8Array(4)),null,fr.CHROME_HACK),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}getGpuMetricsCollection(){return this._gpuMetricsCollection}stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}supportsCompressedTextures(){return this._astc_extension!=null||U.shouldUseDesktopCompressedTextureFormat()&&this._s3tc_extension!=null}astcExtension(){return this._astc_extension}singleColorTextureManager(){return this._singleColorTextureManager||(this._singleColorTextureManager=new El(this)),this._singleColorTextureManager}_loadASTCCompressedTexturesExtension(){U.shouldUseCompressedTextures()&&U.shouldUseWebGL2()&&(this._astc_extension=this._gl.getExtension("WEBGL_compressed_texture_astc"))}s3tcExtension(){return this._s3tc_extension}_loadS3TCCompressedTexturesExtension(){U.shouldUseCompressedTextures()&&U.shouldUseWebGL2()&&(this._s3tc_extension=this._gl.getExtension("WEBGL_compressed_texture_s3tc"))}glInternalFormat(e){switch(e){case 3:if(this.supportsCompressedTextures())return this.s3tcExtension().COMPRESSED_RGBA_S3TC_DXT5_EXT;case 2:if(this.supportsCompressedTextures())return this.astcExtension().COMPRESSED_RGBA_ASTC_6x6_KHR;case 1:case 0:default:return this.gl().RGBA}}_loadOESStandardDerivativesExtension(e){let r=this._gl.getExtension("OES_standard_derivatives"),n=U.shouldUseWebGL2();FV(n||r!==null),e&&!Sv&&!n&&Re.trackEvent("missing_webgl_extensions",{extensions:["OES_standard_derivatives"]})}_resetState(){this._attributeCount=0,this._currentClearColor=N.TRANSPARENT,this._currentProgramInUse=null,this._currentInputLayout=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=gr.NONE,this._oldFramebuffer=null,this._oldViewport=L.new2(),this._boundWebGLFramebuffer=null,this._webGLFramebufferUsedForLastClearOrDraw=null,this._materialsToCheckProgramCreationStatus=[],this._numFramebufferSwitches=0,this._boundState=new cv,this._drawState=new dv}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(e){le.List_appendOne(this._contextResetHandlers,e)}removeContextResetHandler(e){le.List_removeOne(this._contextResetHandlers,e)}beginFrame(){this._checkMaterialProgramCreationStatuses()}supportsGpuInstancing(){return!U.shouldOverrideDisableGpuInstancingSupport()&&this._drawArraysInstancedInternal!==null}flush(){this._gl.flush(),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._flushes++}readPixels(e,r,n,o,i){var c;let a=o*i*4,s=new Uint8Array(a),l=(c=Nc.from(e))==null?void 0:c.framebuffer();return this.bindWebGLFramebufferAndTrackForBudget(l),this._gl.readPixels(r,n,o,i,this.gl().RGBA,this.gl().UNSIGNED_BYTE,s),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._totalBandwidth+=a,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._readBandwidth+=a,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._pixelReadBandwidth+=a,s}_reportClearOrDraw(){this._boundWebGLFramebuffer!=this._webGLFramebufferUsedForLastClearOrDraw&&this._numFramebufferSwitches++,this._webGLFramebufferUsedForLastClearOrDraw=this._boundWebGLFramebuffer}draw(e,r,n,o,i,a,s,l){n!=null&&Td.WebGLRenderingContext_annotateBlock(this._gl,`material:${r.name()}`,()=>{if(n instanceof Fi&&(n=n.bufferArea()),n==null){xe("Tried to draw using null vertex buffer area");return}if(!(n instanceof Oc)){xe("Tried to draw using non-html vertex buffer area");return}U.useUnifiedRenderer()&&(this._forceStateUpdate=!0),i==null&&(i=gr.NONE),this._updateFramebufferAndViewport(a,l),r.prepare();let c=n.buffer();if(c==null)return;let d=wd.from(c);d.prepareForBinding(),this._updateBlendState(o),this._updateStencilState(i),this._updateScissorState(s),this.setVertexBuffer(d,0),this.prepareForDraw();let u=n.byteCount()/n.stride();switch(this._gl.drawArrays(e==ze.TRIANGLES?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,n.byteOffset()/n.stride()|0,u|0),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._drawCalls++,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertices+=u,e){case ze.TRIANGLES:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._triangles+=u/3;break;case ze.TRIANGLE_STRIP:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._tristrips++;break;default:break}this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}drawInstanced(e,r,n,o,i,a,s,l,c){n==null||o==null||Td.WebGLRenderingContext_annotateBlock(this._gl,`material:${r.name()}`,()=>{if(n instanceof Fi&&(n=n.bufferArea()),n==null){xe("Tried to draw using null vertex buffer area");return}if(!(n instanceof Oc)||!(o instanceof Oc)){xe("Tried to draw using non-html vertex buffer area");return}a==null&&(a=gr.NONE),this._updateFramebufferAndViewport(s,c),r.prepare();let d=n.buffer(),u=o.buffer();if(d==null||u==null)return;let p=wd.from(d),_=wd.from(u);p.prepareForBinding(),_.prepareForBinding(),this._updateBlendState(i),this._updateStencilState(a),this._updateScissorState(l),this.setVertexBuffers2(p,n.byteOffset(),_,o.byteOffset()),this.prepareForDraw();let h=o.byteCount()/o.stride()|0,g=n.byteCount()/n.stride()|0;switch(this._drawArraysInstancedInternal(e==ze.TRIANGLES?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,0,g,h),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._drawCalls++,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertices+=g,e){case ze.TRIANGLES:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._triangles+=g/3;break;case ze.TRIANGLE_STRIP:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._tristrips++;break;default:break}this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}_setCanvasSize(e,r){this._mockMaximumDrawingBufferSize!=null&&(e=Math.min(this._mockMaximumDrawingBufferSize.value,e)|0,r=Math.min(this._mockMaximumDrawingBufferSize.value,r)|0);let n=e/si(),o=r/si(),i=this._gl.canvas;i.width=e,i.height=r,i.style.width=`${n}px`,i.style.height=`${o}px`;let a=this._gl.drawingBufferWidth,s=this._gl.drawingBufferHeight,l=a!=e||s!=r;return l&&(n=a/si(),o=s/si(),i.width=a,i.height=s,i.style.width=`${n}px`,i.style.height=`${o}px`),new Oa(new F(a,s),l)}resizeDefaultFramebuffer(e,r){let n=!1;if((this._cachedSize.x()|0)!=e||(this._cachedSize.y()|0)!=r){let o=this._setCanvasSize(e,r);this._cachedSize=o.canvasSize,n=o.webGLDidAdjustCanvasSize,this._defaultViewport.setTo1(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new Oa(this._cachedSize,n)}_detectShouldFlushAfterDraws(){return!!(Bi.detectFaultyAdrenoGPU(this.graphicsCardName())||U.shouldFlushAfterDraws())}static detectFaultyAdrenoGPU(e){return/Adreno \(TM\) ([78])\d{2}/.test(e)}_shouldFlushAfterClear(){return!!(Os.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||U.shouldFlushAfterClear())}clear(e,r,n,o,i){var a,s;r==null&&(r=N.TRANSPARENT),this._updateFramebufferAndViewport(n,i),this._oldBlendState==It.KEEP&&this._updateBlendState(It.COPY),this._updateScissorState(o),r!=this._currentClearColor&&(this._gl.clearColor(N.redF(r),N.greenF(r),N.blueF(r),N.alphaF(r)),this._currentClearColor=r),this._gl.clear((e!=Ar.DEPTH_STENCIL?this._gl.COLOR_BUFFER_BIT:0)|(e!=Ar.COLOR?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._clears++,this._shouldFlushAfterClear()&&(this._gl.flush(),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._flushes++),n!=null&&((e==Ar.ALL||e==Ar.COLOR)&&((a=n.colorTexture())==null||a.markContentHasBeenInitialized()),(e==Ar.ALL||e==Ar.DEPTH_STENCIL)&&((s=n.depthStencilTexture())==null||s.markContentHasBeenInitialized())),this._reportClearOrDraw()}useMaterial(e){if(e instanceof km){let r=this._currentProgramInUse!=e.program();(this._forceStateUpdate||r)&&(this._gl.useProgram(e.program()),this._gpuMetricsCollection.referenceShaderProgram(e.program()),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._shaderChanges++)}this._currentProgramInUse=e.program(),this.setInputLayout(e.inputLayout())}bindVertexBuffer(e){return this._forceStateUpdate||this._boundState._currentVertexBuffer!==e?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertexBuffersReferenced++,this._boundState._currentVertexBuffer=e,!0):!1}setInputLayout(e){this._currentInputLayout!==e&&(this._currentInputLayout=e,this._drawState._inputLayoutStateDirty=!0)}setVertexBuffer(e,r){this.setVertexBufferInternal(0,e,r),this._drawState._numVertexBuffers!==1&&(this._drawState._numVertexBuffers=1,this._drawState._bufferStateDirty=!0)}setVertexBuffers2(e,r,n,o){this.setVertexBufferInternal(0,e,r),this.setVertexBufferInternal(1,n,o),this._drawState._numVertexBuffers!==2&&(this._drawState._bufferStateDirty=!0),this._drawState._numVertexBuffers=2}setVertexBufferInternal(e,r,n){let o=this._drawState._currentVertexBuffers[e]!==r||this._drawState._currentVertexBufferOffsets[e]!==n;return this._drawState._currentVertexBuffers[e]=r,this._drawState._currentVertexBufferOffsets[e]=n,o&&(this._drawState._bufferStateDirty=!0),o}prepareForDraw(){let e=this._currentInputLayout.numInputs();if(e!==this._drawState._numVertexBuffers)return;let r=this._gl;if(this._forceStateUpdate||this._drawState._bufferStateDirty||this._drawState._inputLayoutStateDirty){let n=0;for(let o=0;o<e;o++){let i=this._drawState._currentVertexBuffers[o],a=this._currentInputLayout.input(o);this.bindVertexBuffer(i.buffer());let s=a.attributes(),l=this._drawState._currentVertexBufferOffsets[o];for(let c of s){let d=c.type===1;r.vertexAttribPointer(n++,c.count,d?r.UNSIGNED_BYTE:r.FLOAT,d,a.stride(),l+c.byteOffset),this._vertexAttribDivisorInternal!==null&&this._boundState._currentAttribIsInstanced[n-1]!==c.isInstanced&&(this._vertexAttribDivisorInternal(n-1,c.isInstanced?1:0),this._boundState._currentAttribIsInstanced[n-1]=c.isInstanced)}}for(;this._attributeCount<n;)r.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>n;)this._attributeCount=this._attributeCount-1,r.disableVertexAttribArray(this._attributeCount);this._attributeCount=n}for(let n=0;n<this._drawState._numVertexBuffers;n++)this._drawState._currentVertexBuffers[n].uploadForDraw();this._drawState._bufferStateDirty=!1,this._drawState._inputLayoutStateDirty=!1}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let e=this._gl.getExtension("WEBGL_debug_renderer_info");return e==null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}isVisible(){let e=this._gl.canvas;return!e||!Zh.Node_isConnected(e)?!1:Jh.Element_isVisible(e)}setMaximumDrawingBufferSizeForTesting(e){this._mockMaximumDrawingBufferSize=new fe(e)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(e,r,n,o){return new km(this,e,r,n,o)}createVertexBufferPool(){return new Ms(this,new uv(this))}createTexture(e,r,n,o){return this.createTextureWithPixels(e,r,n,null,o)}createTextureWithPixels(e,r,n,o,i){return new aa(this,e,r,n,lr.createFromPixels(r,n,o),null,i)}createTextureWithVideo(e,r,n){return new aa(this,e,r.videoWidth,r.videoHeight,null,r,n)}createFramebuffer(e,r,n){return new Nc(this,aa.from(e),aa.from(r),n)}annotate(e,r){r()}annotateAndReturn(e,r){return r()}addMaterialToCheckProgramCreationStatusAsync(e){this._materialsToCheckProgramCreationStatus.push(e)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let e of this._materialsToCheckProgramCreationStatus)e.haveCheckedProgramCreationStatus()||e.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(e,r){r()}takeSpectorSnapshot(){Rl.takeSnapshot(this.gl().canvas)}_updateFramebufferAndViewport(e,r){let n=Nc.from(e),o=r??(n==null?void 0:n.bounds());n||(o=this._defaultViewport);let i=this._gl;if(this._forceStateUpdate||this._oldFramebuffer!=n){let a=n==null?void 0:n.framebuffer();this.bindWebGLFramebufferAndTrackForBudget(a),this._oldFramebuffer=n,Os.hasViewportBug()&&this._oldViewport.equals(o)&&(this._oldViewport.setX(o.x()+1),i.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),i.clear(0),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._clears++)}(this._forceStateUpdate||!this._oldViewport.equals(o))&&(i.viewport(o.x()|0,o.y()|0,o.width()|0,o.height()|0),this._oldViewport.copyFrom(o))}_updateBlendState(e){let r=Bi._packBlendModes(e.sourceColor,e.targetColor,e.sourceAlpha,e.targetAlpha);if(this._forceStateUpdate||this._oldBlendOperations!=r||this._oldBlendState.constant!=e.constant){let n=this._gl,o=r,i=this._oldBlendOperations,a=o&255,s=o>>8&255,l=o>>16&255,c=o>>24,d=e.constant;o==Bi.KEEP_BLEND_OPERATIONS?n.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||i==Bi.KEEP_BLEND_OPERATIONS)&&n.colorMask(!0,!0,!0,!0),o==Bi.COPY_BLEND_OPERATIONS?(n.disable(n.BLEND),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++):((this._forceStateUpdate||i==Bi.COPY_BLEND_OPERATIONS||i==Bi.KEEP_BLEND_OPERATIONS)&&(n.enable(n.BLEND),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++),n.blendFuncSeparate(this._blendOperationMap.get(a),this._blendOperationMap.get(s),this._blendOperationMap.get(l),this._blendOperationMap.get(c)),n.blendColor(d,d,d,d))),this._oldBlendState=e,this._oldBlendOperations=r}}_updateStencilState(e){let r=this._gl,n=this._oldStencilState,o=e,i=o.frontFace,a=o.backFace,s=i==a?r.FRONT_AND_BACK:r.FRONT;(this._forceStateUpdate||!n.equals(o))&&((this._forceStateUpdate||n.isEnabled!=o.isEnabled)&&(o.isEnabled?(r.enable(r.STENCIL_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++):(r.disable(r.STENCIL_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++)),r.stencilFuncSeparate(s,this._comparisonMap.get(i.comparison),o.reference,o.readMask),r.stencilOpSeparate(s,this._operationMap.get(i.stencilFail),this._operationMap.get(i.stencilPassDepthPass),this._operationMap.get(i.stencilPassDepthPass)),r.stencilMaskSeparate(s,o.writeMask),i!=a&&(r.stencilFuncSeparate(r.BACK,this._comparisonMap.get(a.comparison),o.reference,o.readMask),r.stencilOpSeparate(r.BACK,this._operationMap.get(a.stencilFail),this._operationMap.get(a.stencilPassDepthPass),this._operationMap.get(a.stencilPassDepthPass)),r.stencilMaskSeparate(r.BACK,o.writeMask)),this._oldStencilState=o)}_updateScissorState(e){let r=e??null;r==null?(this._oldScissors!=null&&(this._gl.disable(this._gl.SCISSOR_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++),this._oldScissors=null):(this._oldScissors==null&&(this._gl.enable(this._gl.SCISSOR_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++),(this._oldScissors==null||!r.equals(this._oldScissors))&&(this._gl.scissor(r.x()|0,r.y()|0,Math.max(r.width(),0)|0,Math.max(r.height(),0)|0),this._oldScissors==null&&(this._oldScissors=L.new2()),this._oldScissors.copyFrom(r)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(e){return e}static _packBlendModes(e,r,n,o){return e|r<<8|n<<16|o<<24}getNumFramebufferSwitches(){return this._numFramebufferSwitches}resetNumFramebufferSwitches(){this._numFramebufferSwitches=0}bindWebGLFramebufferAndTrackForBudget(e){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._boundWebGLFramebuffer=e,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._framebufferBinds++}};Bi.COPY_BLEND_OPERATIONS=Bi._packBlendModes(1,0,1,0),Bi.KEEP_BLEND_OPERATIONS=Bi._packBlendModes(0,1,0,1);var ci=Bi,Il=class{location(){let e=ci.from(this._material.context());return this._generation!=e.generation()&&(this._location=e.gl().getUniformLocation(this._material.program(),this._name),this._generation=e.generation()),this._location}constructor(e,r){this._material=e,this._name=r,this._generation=0,this._location=null,this._isDirty=!0}},pv=class extends Il{set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=ci.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform1f(this.location(),this._x),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4))}constructor(e,r){super(e,r),this._x=0}},_v=class extends Il{set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=ci.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform1i(this.location(),this._x),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4))}constructor(e,r){super(e,r),this._x=0}},hv=class extends Il{set(e,r){(e!=this._x||r!=this._y)&&(this._x=e,this._y=r,this._isDirty=!0)}prepare(){let e=ci.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(8))}constructor(e,r){super(e,r),this._x=0,this._y=0}},mv=class extends Il{set(e,r,n,o){(e!=this._x||r!=this._y||n!=this._z||o!=this._w)&&(this._x=e,this._y=r,this._z=n,this._w=o,this._isDirty=!0)}prepare(){let e=ci.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(16))}constructor(e,r){super(e,r),this._x=0,this._y=0,this._z=0,this._w=0}},Wo=class Wo extends Il{set(e,r,n,o,i,a){Wo._cachedFloat32Values[0]=e,Wo._cachedFloat32Values[1]=o,Wo._cachedFloat32Values[3]=r,Wo._cachedFloat32Values[4]=i,Wo._cachedFloat32Values[6]=n,Wo._cachedFloat32Values[7]=a;for(let s=0;s<9;s=s+1)if(!(Number.isNaN(Wo._cachedFloat32Values[s])&&Number.isNaN(this._float32Values[s])||Wo._cachedFloat32Values[s]===1/0&&this._float32Values[s]===1/0||Wo._cachedFloat32Values[s]===-1/0&&this._float32Values[s]===-1/0)&&Math.abs(Wo._cachedFloat32Values[s]-this._float32Values[s])>=1e-5){let l=this._float32Values;this._float32Values=Wo._cachedFloat32Values,Wo._cachedFloat32Values=l,this._isDirty=!0;break}}prepare(){let e=ci.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniformMatrix3fv(this.location(),!1,this._float32Values),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(36))}constructor(e,r){super(e,r),this._float32Values=new Float32Array([1,0,0,0,1,0,0,0,1])}};Wo._cachedFloat32Values=new Float32Array([1,0,0,0,1,0,0,0,1]);var fv=Wo,gv=class extends Il{set(e,r){(this._texture!=e||this._index!=r)&&(this._texture=aa.from(e),this._index=r,this._isDirty=!0)}prepare(){let e=ci.from(this._material.context()),r=this._texture,n=e.gl();r==null&&(r=e.hackToAvoidMissingTextureWarningInChrome),(this._generation!=e.generation()||this._isDirty)&&(n.uniform1i(this.location(),this._index),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4)),n.activeTexture(Td.WebGLRenderingContext_TEXTURE_N(n,this._index)),n.bindTexture(n.TEXTURE_2D,r.texture()),e.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++}constructor(e,r){super(e,r),this._texture=null,this._index=-1}},km=class{constructor(e,r,n,o,i){this._context=null,this._name=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=e,this._name=r,this._inputLayout=n,this._vertexSource=o,this._fragmentSource=i,this._createProgram(),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}inputLayout(){return this._inputLayout}setUniformFloat(e,r){let n=qe.StringMap_get(this._uniformsMap,e,null);n==null&&(n=new pv(this,e),this._uniformsMap.set(e,n),this._uniformsList.push(n)),n.set(r)}setUniformInt(e,r){let n=qe.StringMap_get(this._uniformsMap,e,null);n==null&&(n=new _v(this,e),this._uniformsMap.set(e,n),this._uniformsList.push(n)),n.set(r)}setUniformVec21(e,r,n){let o=qe.StringMap_get(this._uniformsMap,e,null);o==null&&(o=new hv(this,e),this._uniformsMap.set(e,o),this._uniformsList.push(o)),o.set(r,n)}setUniformVec41(e,r,n,o,i){let a=qe.StringMap_get(this._uniformsMap,e,null);a==null&&(a=new mv(this,e),this._uniformsMap.set(e,a),this._uniformsList.push(a)),a.set(r,n,o,i)}setUniformMat31(e,r,n,o,i,a,s){let l=qe.StringMap_get(this._uniformsMap,e,null);l==null&&(l=new fv(this,e),this._uniformsMap.set(e,l),this._uniformsList.push(l)),l.set(r,n,o,i,a,s)}setUniformSampler(e,r,n){let o=qe.StringMap_get(this._uniformsMap,e,null);o==null&&(o=new gv(this,e),this._uniformsMap.set(e,o),this._uniformsList.push(o)),o.set(r,n)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}prepare(){this._context.useMaterial(this);for(let e of this._uniformsList)e.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let e=this._context.gl();(()=>{if(e.getProgramParameter(this._program,e.LINK_STATUS))return;let n=a=>a.replace(new RegExp("\\bhighp\\b","g"),"mediump"),o=e.getAttachedShaders(this._program);if(o==null)throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`);let i=!1;for(let a of o){if(e.getShaderParameter(a,e.COMPILE_STATUS))continue;i=!0;let s=e.getShaderParameter(a,e.SHADER_TYPE);if(s===e.VERTEX_SHADER)this._vertexSource=n(this._vertexSource);else if(s===e.FRAGMENT_SHADER)this._fragmentSource=n(this._fragmentSource);else{if(e.isContextLost())return;throw new Error(`Unexpected shader type: ${s}`)}}if(!i){if(e.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`)}if(this._createProgram(),e.getProgramParameter(this._program,e.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(Re.trackEvent("highp_unsupported_device",{}),this.context().setHasLoggedHighpPrecisionUnsupported());return}if(o=e.getAttachedShaders(this._program),o==null)throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`);for(let a of o)if(!e.getShaderParameter(a,e.COMPILE_STATUS)){if(e.isContextLost())return;{let s=e.getShaderInfoLog(a);throw new Error(s)}}if(!e.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`)})(),this._haveCheckedProgramCreationStatus=!0}_createProgram(){let e=this._context.gl();if(this._program=e.createProgram(),Rl.addDebugMetadataToWebGLObject(this._program,{name:this._name}),!this._compileShader(e,e.VERTEX_SHADER,this._vertexSource)||!this._compileShader(e,e.FRAGMENT_SHADER,this._fragmentSource))return;let r=0;for(let n=0,o=this.inputLayout().numInputs();n<o;n++){let a=this.inputLayout().input(n).attributes();for(let s=0,l=a.length;s<l;s++)e.bindAttribLocation(this._program,r++,a[s].name)}e.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(e,r,n){let o=e.createShader(r);return o?(e.shaderSource(o,n),e.compileShader(o),e.attachShader(this._program,o),!0):!1}static from(e){return e}},xd=class xd{constructor(e,r,n){this._generation=0,this._initialGeneration=e.generation(),this._buffer=null,this._isDirty=!0,this._dirtyMin=xd.INT_MAX,this._dirtyMax=0,this._totalMin=xd.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=e,this._byteCount=r,this._discardBytesAfterUpload=n,this._bytesForUploadMin=0,this._discardBytesAfterUpload?this._bytesForUploadMax=0:(this._bytesForUpload=new Uint8Array(r),this._bytesForUploadMax=this._byteCount)}buffer(){return this._buffer}context(){return this._context}bytesForUpload(){return this._bytesForUpload}byteCount(){return this._byteCount}moveBytesForUpload(e,r,n){e!=r&&n!=0&&(this._bytesForUpload.set(this._bytesForUpload.subarray(e,e+n),r),this._growDirtyRegion(Math.min(e,r),Math.max(e,r)+n))}setBytesForUpload(e,r){if(this._growDirtyRegion(r,r+e.length),!this._discardBytesAfterUpload){this._bytesForUpload.set(e,r);return}if(this._bytesForUpload==null){this._bytesForUpload=new Uint8Array(e),this._bytesForUploadMin=r,this._bytesForUploadMax=r+e.length;return}let n=Math.min(this._bytesForUploadMin,r),o=Math.max(this._bytesForUploadMax,r+e.length),i=this._bytesForUpload;this._bytesForUpload=new Uint8Array(o-n),this._bytesForUpload.set(i,this._bytesForUploadMin-n),this._bytesForUpload.set(e,r-n),this._bytesForUploadMin=n,this._bytesForUploadMax=o}uploadForDraw(){let e=this._context.gl();if(this._isDirty||this._dirtyMin<this._dirtyMax){if(this._context.bindVertexBuffer(this._buffer),this._isDirty){let r=this._glByteCount;e.bufferData(e.ARRAY_BUFFER,this._byteCount,e.DYNAMIC_DRAW),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=this._byteCount,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=this._byteCount,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferWriteBandwidth+=this._byteCount,this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-r),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}if(this._dirtyMin<this._dirtyMax){let r=this._bytesForUpload.subarray(this._dirtyMin-this._bytesForUploadMin,this._dirtyMax-this._bytesForUploadMin);e.bufferSubData(e.ARRAY_BUFFER,this._dirtyMin,r),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=r.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=r.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferWriteBandwidth+=r.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferUploadCount+=1,this._dirtyMin=xd.INT_MAX,this._dirtyMax=0,this._discardBytesAfterUpload&&(this._bytesForUpload=null,this._bytesForUploadMin=0,this._bytesForUploadMax=0)}}}prepareForBinding(){let e=this._context.gl();if(this._initialGeneration!=this._context.generation()&&this._discardBytesAfterUpload){xe("unexpectedly tried to re-create a vertex buffer with discardBytesAfterUpload");return}this._generation!=this._context.generation()&&(this._buffer=e.createBuffer(),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBuffersCreated++,Rl.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0)}_growDirtyRegion(e,r){this._dirtyMin=Math.min(this._dirtyMin,e),this._dirtyMax=Math.max(this._dirtyMax,r),this._totalMin=Math.min(this._totalMin,e),this._totalMax=Math.max(this._totalMax,r)}static from(e){return e}};xd.INT_MAX=2147483647;var wd=xd,aa=class{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(e){this._shouldUnloadImageBuffer=e}_currentGlTextureSizeInBytes(){let e=this._glTextureWidth*this._glTextureHeight*lc.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(e+=e*.33),e|0}deleteTexture(){this._texture!=null?(this._context.gl().deleteTexture(this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesDestroyed++,this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes())):this._renderbuffer!=null&&(this._context.gl().deleteRenderbuffer(this._renderbuffer),this._context.stats().decrement(2,this._purpose,this._width*this._height*4))}resize1(e,r,n,o){this._width=e,this._height=r,this._pixels=n,this._useMipmap=o,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(e){this._format!=e&&(this._format=e,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._texture=e.createTexture(),this._texture==null)return this._texture;this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesCreated++,Rl.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1}if(this._isFormatDirty&&(e.bindTexture(e.TEXTURE_2D,this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.format().magFilter==0?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.format().minFilter==0?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.format().wrap==0?e.REPEAT:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.format().wrap==0?e.REPEAT:e.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let r=this._currentGlTextureSizeInBytes();e.bindTexture(e.TEXTURE_2D,this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++;let n=this._width*this._height*lc.PixelFormat_byteCount(this.format().pixelFormat);if(this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._textureWriteBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._textureUploadCount+=1,this._video!=null)this._isVideoFrameDirty&&(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{if(this._pixels==null)return xe("Tried to reupload image data after unloading it"),this._texture;let i=this._pixels.pixels;if(this._context.supportsCompressedTextures()&&this.format().isCompressedFormat()){let a=this._context.glInternalFormat(this.format().pixelFormat);e.compressedTexImage2D(e.TEXTURE_2D,0,a,this._width,this._height,0,i.array),this._hasContentBeenInitialized=i.array!=null}else i.imageBitmap!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.imageBitmap),this._hasContentBeenInitialized=!0):i.img!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.img),this._hasContentBeenInitialized=!0):i.canvas!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.canvas),this._hasContentBeenInitialized=!0):(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this._width,this._height,0,e.RGBA,e.UNSIGNED_BYTE,i.array),this._hasContentBeenInitialized=i.array!=null);if(this._shouldUnloadImageBuffer){let a=v().modules().corePerfInfo;a==null||a.imageMemStatsFree(ba.BUFFER,this._pixels.memorySize()),this._pixels=null}}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR));let o=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,o-r),this._isContentDirty=!1}return this._texture}renderbuffer(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._renderbuffer=e.createRenderbuffer(),this.renderbuffer==null)return this.renderbuffer;Rl.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1}if(this._isContentDirty){e.bindRenderbuffer(e.RENDERBUFFER,this._renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this._width,this._height);let r=this._width*this._height*4;this._context.stats().increment(2,this._purpose,r),this._isContentDirty=!1,this._hasContentBeenInitialized=!1}return this._renderbuffer}static from(e){return e}constructor(e,r,n,o,i,a,s){this._context=e,this._format=r,this._width=n,this._height=o,this._pixels=i,this._video=a,this._purpose=s,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}},Nc=class{context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(e){this._colorTexture!=e&&(this._colorTexture=aa.from(e),this._isDirty=!0)}resize(e,r){this._colorTexture!=null&&(e!=this._colorTexture.width()||r!=this._colorTexture.height())&&(this._colorTexture.resize1(e,r,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(e!=this._depthStencilTexture.width()||r!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(e,r,null,!1),this._isDirty=!0)}setDepthStencil(e){this._depthStencilTexture!=e&&(this._depthStencilTexture=aa.from(e),this._isDirty=!0)}framebuffer(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._framebuffer=e.createFramebuffer(),this._framebuffer==null)return this._framebuffer;Rl.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0}return this._isDirty&&(this._context.bindWebGLFramebufferAndTrackForBudget(this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}deleteTexture(){var e,r;(e=this._colorTexture)==null||e.deleteTexture(),(r=this._depthStencilTexture)==null||r.deleteTexture(),this._context.gl().deleteFramebuffer(this._framebuffer)}bounds(){var e,r;return new L(0,0,((e=this._colorTexture)==null?void 0:e.width())??0,((r=this._colorTexture)==null?void 0:r.height())??0)}static from(e){return e}constructor(e,r,n,o){this._context=e,this._colorTexture=r,this._depthStencilTexture=n,this._purpose=o,this._framebuffer=null,this._generation=0,this._isDirty=!0}},Rl;(l=>{function t(c){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(c)}l.takeSnapshot=t;function e(c,d){}l.addDebugMetadataToWebGLObject=e;function r(c,d){d()}l.annotate=r;function n(c,d){return d()}l.annotateAndReturn=n;function o(c){l._scopeStack.push(c),a()}l._beginScope=o;function i(c){l._scopeStack.pop(),a()}l._endScope=i;function a(){if(l._scopeStack.length==0)window.spector.clearMarker();else{let c=l._scopeStack.join(" > ");window.spector.setMarker(c)}}l._updateMarker=a,l._scopeStack=[]})(Rl||(Rl={}));var Sv=!0;var io=class io{constructor(e,r){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=r.clippedForRectOfBounds(e),io.hasher.reset(),io.hasher.hash1(this._rect.x()),io.hasher.hash1(this._rect.y()),io.hasher.hash1(this._rect.width()),io.hasher.hash1(this._rect.height()),io.hasher.hash1(this._radii.topLeft),io.hasher.hash1(this._radii.topRight),io.hasher.hash1(this._radii.bottomRight),io.hasher.hash1(this._radii.bottomLeft),this._hash=io.hasher.value()}cppUniquePath(){return null}rect(){return this._rect}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof io?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new io(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return Ld()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Lt.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}asRoundedRectPath(){return this}static fromRect(e){return new io(e,Mn.fromNodeRadius(0))}static fromRoundedRect(e){let r=e.vertexRadii()!=null?Mn.fromList(e.vertexRadii()):e.nodeRadius()!=0?Mn.fromNodeRadius(e.nodeRadius()):Mn.ZEROS;return new io(e.rect(),r)}static isRoundedRectSupportedIgnoringCornerSmoothing(e){if(e==null)return!1;let r=e.vertexRadii();if(r!=null){let n=Math.max(Math.max(r[0],r[1]),Math.max(r[2],r[3])),o=Math.min(e.width()/2,e.height()/2);if(n>o)return!1}return!0}static isRoundedRectSupported(e){return e==null||e.cornerSmoothing()!=0?!1:io.isRoundedRectSupportedIgnoringCornerSmoothing(e)}};io.hasher=new li;var At=io,Bs=class Bs{constructor(e,r,n,o){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(r,0),this.bottomRight=Math.max(n,0),this.bottomLeft=Math.max(o,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let r=Math.min(e.width()/2,e.height()/2);return new Bs(Math.min(this.topLeft,r),Math.min(this.topRight,r),Math.min(this.bottomRight,r),Math.min(this.bottomLeft,r))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new Bs(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new Bs(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?Bs.fromList(e.vertexRadii()):Bs.fromNodeRadius(e.nodeRadius())}};Bs.ZEROS=new Bs(0,0,0,0);var Mn=Bs;var To=class t{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}cppUniquePath(){return this.handle}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=v().modules().uniquePath_Internal.fastBounds(this.handle),r=e.max.x-e.min.x,n=e.max.y-e.min.y,o=new L(e.min.x,e.min.y,r,n);this._cachedInfo=new Bp(o,v().modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof t?this.handle==e.handle:!1}clone(){return new t(this.handle)}hash(){return this._hash==null&&(this._hash=v().modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}asRoundedRectPath(){return null}compileLoopBlinnAndReturnVolatileTriangles(){let e=v().modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e??(xe("Failed to compile UniquePath"),DV)}},DV=new Uint8Array([]);var Gp=class Gp{each(e){this._innerMap.each((r,n)=>{let o=n.deref();o&&e(r,o)})}getOrInsertFallback(e){var n;let r=(n=this._innerMap.getOrNull(e))==null?void 0:n.deref();return r||(r=this._fallback(e),this.set(e,r)),r}get(e,r){var n;return((n=this._innerMap.getOrNull(e))==null?void 0:n.deref())??r}getOrNull(e){let r=this._innerMap.getOrNull(e);return(r==null?void 0:r.deref())??null}set(e,r){this.remove(e);let n=new WeakRef(r);this._innerMap.set(e,n),Gp._cacheFinalizer.register(r,this.getNonSelfRetainingCleanupCallback(e),n)}remove(e){let r=this._innerMap.getOrNull(e);r&&(this._innerMap.remove(e),Gp._cacheFinalizer.unregister(r))}getNonSelfRetainingCleanupCallback(e){let r=new WeakRef(this);return function(){var o;let n=r.deref();n&&!((o=n._innerMap.getOrNull(e))!=null&&o.deref())&&n._innerMap.remove(e)}}constructor(e,r,n){this._innerMap=new ia(e,r,o=>{throw new Error("Cannot use fallback on WeakHashTable::_innerMap")}),this._fallback=n}};Gp._cacheFinalizer=new FinalizationRegistry(e=>{e()});var Up=Gp;var Gi;(d=>{function t(u,p){if(Ut.int_remainder(u.byteCount(),d.NUM_BYTES_PER_FLOAT)!=0)return!1;let _=u.byteCount()/d.NUM_BYTES_PER_FLOAT|0;if(Ut.int_remainder(_,d.NUM_FLOATS_PER_VERTEX)!=0)return!1;let h=_/d.NUM_FLOATS_PER_VERTEX|0;if(Ut.int_remainder(h,3)!=0)return!1;if(u.byteCount()>p)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}d.isValid=t;function e(u){return u.byteCount()/(d.NUM_BYTES_PER_FLOAT*d.NUM_FLOATS_PER_VERTEX)|0}d.numVertices=e;function r(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_)}d.xValueAt=r;function n(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+1*d.NUM_BYTES_PER_FLOAT)}d.yValueAt=n;function o(u,p){let _=r(u,p),h=n(u,p);return new F(_,h)}d.xyValueAt=o;function i(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+2*d.NUM_BYTES_PER_FLOAT)}d.kValueAt=i;function a(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+3*d.NUM_BYTES_PER_FLOAT)}d.lValueAt=a;function s(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+4*d.NUM_BYTES_PER_FLOAT)}d.mValueAt=s,d.NUM_BYTES_PER_FLOAT=4,d.NUM_FLOATS_PER_VERTEX=5})(Gi||(Gi={}));var fn=class fn{constructor(e,r){this._cachedTriangles=null;this._cachedTriangles=null,this._path=e,this._windingRule=r}static get uniqueValuesWeakRef(){return fn._uniqueValuesWeakRef??(fn._uniqueValuesWeakRef=new Up(e=>e.hash,(e,r)=>e.equals(r),e=>new fn(e.path,e.windingRule)))}static UNIT_RECT(){return fn._UNIT_RECT!=null||(fn._UNIT_RECT=new fn(At.fromRect(new L(0,0,1,1)),"NONZERO")),fn._UNIT_RECT}static getOrCreate(e,r){return U.viewerCleanupBufferAreas()?fn.uniqueValuesWeakRef.getOrInsertFallback(new fn.PathAndWindingRuleArgs(e,r)):fn._uniqueValues.getOrInsertFallback(new fn.PathAndWindingRuleArgs(e,r))}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,r){return Re.perfTimerScope("generate-triangles-viewer",Re.ProfileLevel.LOW,()=>{let n=this._cachedTriangles==null;if(n)this._cachedTriangles=this._convertToTriangles(e,r);else for(let o of this._cachedTriangles)if(o.bufferArea!=null&&!o.bufferArea.hasBuffer()){n=!0;break}}),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let r=0;for(let n=0;n<Gi.numVertices(e);n=n+3){let o=Gi.xyValueAt(e,n),i=Gi.xyValueAt(e,n+1),a=Gi.xyValueAt(e,n+2),s=F.cross(i.subtract(o),a.subtract(o)),l=s<0?-1:s>0?1:0;if(l!=0){if(r==-l)return!1;r=l}}return!0}_convertToTriangles(e,r){var a;let n=[],o;if(this._path instanceof To)o=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{fn.TEMP_ARRAY.clear();let s=this._path.toBezierPath();Gm.compile(s,fn.TEMP_ARRAY),o=fn.TEMP_ARRAY.bytes()}let i=e.allocateVertexBufferAreas(ze.TRIANGLES,r,o);for(let s=0;s<i.length;s=s+1){let l=i[s].byteOffset(),c=i[s].byteCount(),d=U.shouldEnableVertexBufferDiscardBytesAfterUpload()?i[s].bufferBytesForUpload():(a=i[s].bufferBytesForUpload())==null?void 0:a.subarray(l,l+c);if(!d)continue;let u=new oo(d),p=!0;for(let g=0,m=Gi.numVertices(u);g<m;g=g+1){let A=Gi.kValueAt(u,g),S=Gi.lValueAt(u,g),T=Gi.mValueAt(u,g);if(A!=.5||S!=.5||T!=.5){p=!1;break}}let _=Gi.numVertices(u)==3||this.isRect(),h=p&&this._allTrianglesHaveSameOrientation(u);n.push(new xm(i[s],p,_,h))}return n}};fn.TEMP_ARRAY=new oo,fn._UNIT_RECT=null,fn._uniqueValues=new ia(e=>e.hash,(e,r)=>e.equals(r),e=>new fn(e.path,e.windingRule)),fn._uniqueValuesWeakRef=void 0;var Gt=fn;(e=>{class t{constructor(n,o){this.path=n,this.windingRule=o,this.hash=li.combine(n.hash(),o=="ODD"?1:0)}equals(n){return this.windingRule==n.windingRule&&this.path.equals2(n.path)}}e.PathAndWindingRuleArgs=t})(Gt||(Gt={}));var Hm=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,r,n){this.type=e,this.windingRule=r,this.styleID=n}},Gr=class t extends Hm{constructor(e,r,n,o){super(0,e,r),this._path=null,this._bounds=null,this._path=n,this._bounds=o}path(){return this._path}bounds(){return this._bounds}geometryEquals(e){return e instanceof t?e.windingRule==this.windingRule&&e.bounds().equals(this._bounds)&&e.path().equals2(this._path):!1}},Vp=class extends Hm{constructor(e,r,n,o){super(1,e,r),this._computePath=null,this._maxBounds=null,this._computePath=n,this._maxBounds=o}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(e){return e==this}},di=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,r){if(this._overrideTable!=null&&this._overrideTable._in(e)){let n=this._overrideTable.styleByID1(e),o=n!=null?ss.get(n,91,null):null,i=o!=null?r.findStyle(pt.asStyleId(o)):null;if(i!=null&&i.styleType()=="FILL")return i.fillPaints();let a=n!=null?ss.get(n,24,null):null;if(a!=null)return pt.asPaintList(a)}return null}forEachPaint(e,r){var n;(n=this._overrideTable)==null||n.forEachFillPaint(e,r)}table(){return this._overrideTable}},Ur=class{geometryEquals(e){return e==null?!1:le.List_equalsWithComparison(this.regions,e.regions,(r,n)=>r.geometryEquals(n))}isRect(){return this.regions.length==1?Gt.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,r,n,o){this.regions=e,this.styleIDs=r,this.bounds=n,this.paintOverrides=o}},zm=class extends Ur{constructor(e,r,n,o,i,a,s,l){super(e,r,n,o),this.emojiCodepoints=i,this.emojiRotationWidthHeights=a,this.emojiImageSet=s,this.decorationRegions=l}decorationRegionsEquals(e){return le.List_equalsWithComparison(this.decorationRegions,e.decorationRegions,(r,n)=>r.geometryEquals(n))}},Rt=class t{static equals(e,r){if(e!=null&&r!=null&&e.guids.length==r.guids.length){for(let n=0,o=e.guids.length;n<o;n=n+1)if(!X.equals(e.guids[n],r.guids[n]))return!1;return!0}return e==r}static equalsGUID(e,r){return e!=null&&r!=null&&e.guids.length==1?X.equals(e.guids[0],r):e==null&&r==null}toString(){return`[${this.guids.map(e=>e).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let r=0,n=e.guids.length;r<n;r=r+1)if(!X.equals(e.guids[r],this.guids[r]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,r){return new t(this.guids.slice(e,r))}cloneAndAppend(e){let r=this.guids.slice();return ln(r,e.guids),new t(r)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let r=e.slice(1,e.length-1).split(","),n=[];for(let o of r){let i=X.fromString(o.trim());if(i==null)return null;n.push(i)}return new t(n)}return null}constructor(e){this.guids=e}static ROOT_STABLE_PATH(){return new t([])}},Ui;(o=>{function t(i){return i}o.map=t;function e(i){let a=[];return i.each((s,l)=>{a.push(`
  `+s.toString()+": "+Nr.toString(l))}),a.join(", ")}o.toString=e;function r(){return new zo(i=>i.toString())}o._new=r;function n(i,a){let s=new zo(l=>l.toString());for(let l=0,c=i.length;l<c;l=l+1)s.set(i[l],a[l]);return s}o.new1=n})(Ui||(Ui={}));var Gs=class{toString(){return`SymbolData(id=${this.masterID}, overrides=[${Ui.toString(this.instanceOverrides)}])`}constructor(e,r){this.masterID=e,this.instanceOverrides=r}},Wm=class{constructor(e,r){this.value=e,this.units=r}toString(){return`${this.value} ${this.units}`}},Km=class{constructor(e,r,n){this.family=e,this.style=r,this.postscript=n}toString(){return`${this.family} ${this.style}`}},Md=class{constructor(e,r){this.type=e,this.value=r}},Ym=class{constructor(e,r,n,o){this.suffix=e,this.imageType=r,this.constraint=n,this.contentsOnly=o}},wa=class t{static DEFAULT_FOR_TESTS(){return new t("DEFAULT_FLOW_FOR_TESTS","default flow for tests",Or.FIRST_POSITION)}constructor(e,r,n){this.name=e,this.description=r,this.position=n}},Qm=class Qm{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}}canvasSpaceImageSize(e){let r=e.nonRotatedImageSize.divideScalar(e.scaleFactor);switch(this.rotation){case"NONE":return r;case"CCW_90":return r.flipped()}}canvasSpaceTopLeftOffset(e){let r=e.nonRotatedOffset,n=e.nonRotatedImageSize.divideScalar(e.scaleFactor),o=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return r;case"CCW_90":return new F(r.y(),n.x()-o.x()-r.x())}}canvasSpaceFramePresetSize(e){let r=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return r;case"CCW_90":return r.flipped()}}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1||this.presetIdentifier.indexOf("ANDROID")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.nonRotatedSize}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.nonRotatedSize.x(),y:this.nonRotatedSize.y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,r,n,o){this.type=e,this.nonRotatedSize=r,this.presetIdentifier=n,this.rotation=o}};Qm.DEFAULT=new Qm("NONE",new F(0,0),"","NONE");var Wn=Qm,La=class{constructor(){arguments.length==0?(this.backgroundType="NONE",this.backgroundColor=N.new3(0,0,0,.25)):arguments.length==2&&(this.backgroundType=arguments[0],this.backgroundColor=arguments[1])}},Bn=class{constructor(e=new Map){this._styleByID=e}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let r of Array.from(this._styleByID.keys()))e(r,this._styleByID.get(r))}styleByID2(){return this._styleByID}forEachFillPaint(e,r){this.forEachStyle((n,o)=>{let i=ss.get(o,91,null),a=i!=null?e.findStyle(pt.asStyleId(i)):null;if(a!=null){let s=a.fillPaints();s!=null&&r(s)}else if(ss._in(o,24)){let s=pt.asPaintList(ss.get(o,24,null));s!=null&&r(s)}})}};var kp=class{constructor(e,r,n){this.exitingTransitionRoot=e,this.swappedStablePath=r,this.hotspotInExitingTree=n}};function CF(t){return!t.hasNodeProperty(63)||t.prototypeStartingPoint()==null?!1:t.prototypeStartingPoint().name!=""||t.prototypeStartingPoint().description!=""||t.prototypeStartingPoint().position!=null&&Or.isValid(t.prototypeStartingPoint().position)}var Bd=class{constructor(e,r,n,o,i){this.paints=e,this.offset=r,this.layoutSize=n,this.canvasSize=o,this.devicePixelRatio=i}};var qm=class{constructor(e,r,n,o){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(o-r)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,r){let n=0,o=0,i=0,a=0,s=0;i=e;for(let l=0;l<8;l=l+1){if(a=this._sampleCurveX(i)-e,Math.abs(a)<r)return i;if(s=this._sampleCurveDerivativeX(i),Math.abs(s)<1e-6)break;i=i-a/s}if(n=0,o=1,i=e,i<n)return n;if(i>o)return o;for(;n<o;){if(a=this._sampleCurveX(i),Math.abs(a-e)<r)return i;e>a?n=i:o=i,i=(o-n)*.5+n}return i}solve(e,r){return this._sampleCurveY(this._solveCurveX(e,r))}getYDerivativeForXValue(e,r){let n=this._solveCurveX(e,r),o=this._sampleCurveDerivativeX(n);return Math.abs(o)>0?this._sampleCurveDerivativeY(n)/o:this._sampleCurveDerivativeY(n)}},Xm=class{constructor(e,r){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=r}bezierForEasingFunction(e){return e==null||e.length!=4?null:new qm(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new qm(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let r=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,r)}getDerivative(e,r){if(this._bezier==null)return 1;let n=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,n)}invert(e){if(this._bezier==null)return e;let r=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,r)}};var Av=class{constructor(e,r,n,o){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(r/e),this.m_zeta=n/(2*Math.sqrt(r*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-o)/this.m_wd):(this.m_A=1,this.m_B=-o+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let r=0,n=0,o=Math.PI/this.m_w0,i=this.solve(o),a=0,s=.001,l=15;for(let c=0;c<l;c=c+1){a=(e-n)/(i-n)*(o-r)+r;let d=this.solve(a);if(Math.abs(d-e)<s)return a;d>e?(r=a,n=d):(o=a,i=d)}return a}},jm=class{constructor(e,r){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=r}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new Av(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let r=e*this._durationSeconds;return this._spring.solve(r)}getDerivative(e,r){return this._spring==null?1:r}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var Eo=class Eo{static easingFunctionCallbackCleanup(e){Eo.easingFunctionCache.delete(e)}static cleanCache(){for(var e of Eo.easingFunctionCache.entries())e[1].deref()===void 0&&(Eo.easingFunctionCache.delete(e[0]),Eo.easingFunctionCacheFinalizer.unregister(e[1]))}static makeEasingFunctionWithEasingType(e,r,n){Eo.cleanCache();let o=null;o=this.createCacheKey(e,r,this.getAnimationType(n));let i=Eo.easingFunctionCache.get(o);if(i!==void 0)return i.deref();let a=new Eo(e,r,n),s=new WeakRef(a);return Eo.easingFunctionCache.set(o,s),Eo.easingFunctionCacheFinalizer.register(a,o,s),a}static makeEasingFunction(e,r){return Eo.makeEasingFunctionWithEasingType(e,r)}static createCacheKey(e,r,n){let o=[];for(var i of e)o.push(i.toFixed(2));return o.push(";"),o.push(r.toFixed(2)),o.push(n),o.join()}static getAnimationType(e){return e=="GENTLE_SPRING"||e=="SPRING_PRESET_ONE"||e=="SPRING_PRESET_TWO"||e=="SPRING_PRESET_THREE"||e=="CUSTOM_SPRING"?1:0}constructor(e,r,n){this._easingFunction=e,this._animationType=Eo.getAnimationType(n),this._durationSeconds=r,this._createAnimationUnit(this._easingFunction),this.bounds=Eo.boundsForEasingFunction(this._easingFunction)}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new Xm(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new jm(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,r){return this._animationFunction.getDerivative(e,r)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return ar.FrozenRect_new3(L.fromMinAndMax(0,0,1,1));let r=Ae.FrozenVector_new4(0,0),n=Ae.FrozenVector_new4(e[0],e[1]),o=Ae.FrozenVector_new4(e[2],e[3]),i=Ae.FrozenVector_new4(1,1),a=r.clone(),s=i.clone(),l=r.negative().add(n),c=r.subtract(n.multiplyScalar(2)).add(o),d=r.negative().add(n.multiplyScalar(3)).subtract(o.multiplyScalar(3)).add(i),u=c.multiply(c).subtract(d.multiply(l));if(u.x()>0){u.setX(Math.sqrt(u.x()));for(let p of[(-c.x()-u.x())/d.x(),(-c.x()+u.x())/d.x()])if(p>0&&p<1){let _=1-p,h=_*_*_*r.x()+3*_*_*p*n.x()+3*_*p*p*o.x()+p*p*p*i.x();a.setX(Math.min(a.x(),h)),s.setX(Math.max(s.x(),h))}}if(u.y()>0){u.setY(Math.sqrt(u.y()));for(let p of[(-c.y()-u.y())/d.y(),(-c.y()+u.y())/d.y()])if(p>0&&p<1){let _=1-p,h=_*_*_*r.y()+3*_*_*p*n.y()+3*_*p*p*o.y()+p*p*p*i.y();a.setY(Math.min(a.y(),h)),s.setY(Math.max(s.y(),h))}}return L.fromMinAndMax(a.x(),a.y(),s.x(),s.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}};Eo.easingFunctionCache=new Map,Eo.easingFunctionCacheFinalizer=new FinalizationRegistry(Eo.easingFunctionCallbackCleanup);var No=Eo;var Kn;(a=>{function t(s){return s=="PUSH_FROM_LEFT"||s=="PUSH_FROM_RIGHT"||s=="PUSH_FROM_TOP"||s=="PUSH_FROM_BOTTOM"}a.isPush=t;function e(s){return s=="MOVE_FROM_LEFT"||s=="MOVE_FROM_RIGHT"||s=="MOVE_FROM_TOP"||s=="MOVE_FROM_BOTTOM"}a.isMove=e;function r(s){return s=="SLIDE_FROM_LEFT"||s=="SLIDE_FROM_RIGHT"||s=="SLIDE_FROM_TOP"||s=="SLIDE_FROM_BOTTOM"}a.isSlide=r;function n(s){return s=="MOVE_OUT_TO_LEFT"||s=="MOVE_OUT_TO_RIGHT"||s=="MOVE_OUT_TO_TOP"||s=="MOVE_OUT_TO_BOTTOM"}a.isMoveOut=n;function o(s){return s=="SLIDE_OUT_TO_LEFT"||s=="SLIDE_OUT_TO_RIGHT"||s=="SLIDE_OUT_TO_TOP"||s=="SLIDE_OUT_TO_BOTTOM"}a.isSlideOut=o;function i(s){return t(s)||e(s)||n(s)||r(s)||o(s)}a.supportsSmartAnimate=i})(Kn||(Kn={}));var sa=class sa{constructor(e,r,n,o,i){this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=r,this._actions=n,this._isDeleted=o,this._stateManagementVersion=i,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let r of this.actions())if(e.push(r),r.connectionType()=="CONDITIONAL")for(let n of r.conditionalActions())for(let o of n.actions())e.push(o);return e}id(){return this._id!=null?this._id:X.invalid()}event(){return this._event!=null?this._event:Po.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new fe(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new sa(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new sa(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new sa(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){if(this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0)return!1;let e=this.action();return e!=null&&e.value.connectionType()!="NONE"}apply(e){let r=this.action(),n=e.action(),o=[];r!=null&&n!=null?o=[r.value.apply(n.value)]:r!=null?o=[r.value]:n!=null&&(o=[n.value]);let i=this._event,a=e._event,s=null;return i!=null&&a!=null?s=i.apply(a):i!=null?s=i:a!=null&&(s=a),new sa(this._id,s,o,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}toString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${this._id},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let r=[];for(let n of this.actions())if(n.connectionType()==e)r.push(n);else if(n.connectionType()=="CONDITIONAL")for(let o of n.conditionalActions())for(let i of o.actions())n.connectionType()==e&&r.push(n);return r}getAllActionsWithSpecificTransitionType(e){let r=[];for(let n of this.actions())if(n.transitionType()==e)r.push(n);else if(n.connectionType()=="CONDITIONAL")for(let o of n.conditionalActions())for(let i of o.actions())i.transitionType()==e&&r.push(i);return r}getAllValidTransitionActionsInInteraction(){let e=[];for(let r of this.actions())if(X.isValid(r.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(r.connectionType())!=-1)e.push(r);else if(r.connectionType()=="CONDITIONAL")for(let n of r.conditionalActions())for(let o of n.actions())X.isValid(r.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(r.connectionType())!=-1&&e.push(r);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(X.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let r of e.conditionalActions())for(let n of r.actions())if(X.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let r of this.actions()){if(r.connectionType()==e)return!0;if(r.connectionType()=="CONDITIONAL"){for(let n of r.conditionalActions())for(let o of n.actions())if(r.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let r of this.actions())if(r.navigationType()==e)return r;return null}static createDefault(){return new sa(X.invalid(),Po.createDefault(),[],!1,0)}static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:X.equals(e._id,r._id)&&Po.equals(e._event,r._event)&&le.List_equalsWithComparison(e._actions,r._actions,(n,o)=>Ir.equals(n,o))&&e._isDeleted==r._isDeleted&&e._stateManagementVersion==r._stateManagementVersion}static applyInteractions(e,r){if(e==null&&r==null)return sa.EMPTY_LIST;if(e==null)return r;if(r==null)return e;let n=e.slice();return r.forEach(o=>{let i=!1;for(let a=0,s=e.length;a<s;a=a+1){let l=e[a];if(X.equals(l.id(),o.id())){n[a]=l.apply(o),i=!0;break}}i||n.push(o)}),n.filter(o=>!o._isDeleted)}static whichAncestorToSwapState(e,r,n){let o=e!=null?e.scene().findNode(r):null,i=o?o.findContainingStateGroupOrSelf():null;if(i==null)return null;let a=e;for(;a!=null;){let s=null;a.type()=="INSTANCE"?s=e.scene().findNode(a.symbolID()):n==sa.StateSwapPolicy.INCLUDE_SYMBOLS&&a.type()=="SYMBOL"&&(s=a);let l=s?s.findContainingStateGroupOrSelf():null;if(i==l)return a;a=a.parent()}return null}static whichInstanceToSwap(e,r){return sa.whichAncestorToSwapState(e,r,sa.StateSwapPolicy.INSTANCES_ONLY)}};sa.EMPTY_LIST=[];var dr=sa;(e=>{let t;(o=>(o[o.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",o[o.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(t=e.StateSwapPolicy||(e.StateSwapPolicy={}))})(dr||(dr={}));var Pc=class Pc{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new Pc(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let r=this._interactionType,n=this._interactionMaintained,o=this._interactionDuration,i=this._keyTrigger,a=this._transitionTimeout,s=this._mediaHitTime;return e._interactionType!=null&&(r=e._interactionType),e._interactionMaintained!=null&&(n=e._interactionMaintained),e._interactionDuration!=null&&(o=e._interactionDuration),e._keyTrigger!=null&&(i=e._keyTrigger),e._transitionTimeout!=null&&(a=e._transitionTimeout),e._mediaHitTime!=null&&(s=e._mediaHitTime),new Pc(r,n,o,i,a,s)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new Pc("NONE",new fe(!1),new fe(0),e,new fe(0),new fe(0))}static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:e._interactionType==r._interactionType&&fe.equals(e._interactionMaintained,r._interactionMaintained)&&fe.equals(e._interactionDuration,r._interactionDuration)&&Tv.equals(e._keyTrigger,r._keyTrigger)&&fe.equals(e._transitionTimeout,r._transitionTimeout)}constructor(e,r,n,o,i,a){this._interactionType=e,this._interactionMaintained=r,this._interactionDuration=n,this._keyTrigger=o,this._transitionTimeout=i,this._mediaHitTime=a}};Pc.NULL_EVENT=new Pc(null,null,null,null,null,null);var Po=Pc,Hp=class Hp{constructor(e,r=""){this._actions=e,this._condition=r}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new Hp([])}static equals(e,r){if(e==null!=(r==null))return!1;if(e==null)return!0;let n=le.List_equalsWithComparison(e._actions,r._actions,(i,a)=>Ir.equals(i,a)),o=e._condition==r._condition;return n&&o}};Hp.NULL_CONDITIONAL_ACTIONS=new Hp(null);var zp=Hp,cr=class cr{constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S,T,R,b,O,f,I,y,P,E,C,B){this._transitionNodeID=e,this._transitionType=r,this._transitionDuration=n,this._easingType=o,this._easingFunctionValues=i,this._transitionShouldSmartAnimate=a,this._connectionType=s,this._connectionURL=l,this._overlayRelativePosition=c,this._navigationType=d,this._transitionPreserveScroll=u,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=p,this._mediaAction=_,this._transitionResetVideoPosition=h,this._openUrlInNewTab=g,this._mediaSkipToTime=m,this._mediaSkipByAmount=A,this._transitionResetScrollPosition=S,this._conditionalActions=T,this._transitionResetInteractiveComponents=R,this._targetVariableID=b,this._targetVariableData=O,this._targetVariableModeID=f,this._targetVariableSetID=I,this._deprecatedTargetVariableSetKey=y,this._variableSetTargetExtensionId=P,this._targetNodeFieldAlias=E,this._animationType=C,this._animationPhase=B}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"||this.connectionType()=="OBJECT_ANIMATION"?this._transitionNodeID!=null?this._transitionNodeID:X.invalid():X.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||Kn.isPush(e)||Kn.isSlide(e))?"INSTANT_TRANSITION":e}animationType(){return this._animationType!=null?this._animationType:"NONE"}animationPhase(){return this._animationPhase!=null?this._animationPhase:"IN"}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"&&this.connectionType()!="OBJECT_ANIMATION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:No.easingValuesForPreset(this.easingType());default:break}return No.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:F.new()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||Kn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:Kn.isSlide(this.transitionType())||Kn.isPush(this.transitionType())||Kn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:F.new()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}targetVariableModeID(){return this._targetVariableModeID}targetVariableSetID(){return this._targetVariableSetID}deprecatedTargetVariableSetKey(){return this._deprecatedTargetVariableSetKey}targetNodeFieldAlias(){return this._targetNodeFieldAlias}withTransitionNodeID(e){let r=cr.from(this);return r._transitionNodeID=e,r}withTransitionType(e){let r=cr.from(this);return r._transitionType=e,r}withTransitionDuration(e){let r=cr.from(this);return r._transitionDuration=new fe(e),r}withEasingType(e){let r=cr.from(this);return r._easingType=e,r}withEasingFunctionValues(e){let r=cr.from(this);return r._easingFunctionValues=e,r}withTransitionShouldSmartAnimate(e){let r=cr.from(this);return r._transitionShouldSmartAnimate=new fe(e),r}withConnectionType(e){let r=cr.from(this);return r._connectionType=e,r}withConnectionURL(e){let r=cr.from(this);return r._connectionURL=e,r}withOverlayRelativePosition(e){let r=cr.from(this);return r._overlayRelativePosition=e,r}withNavigationType(e){let r=cr.from(this);return r._navigationType=e,r}withTransitionPreserveScroll(e){let r=cr.from(this);return r._transitionPreserveScroll=new fe(e),r}withExtraScrollOffset(e){let r=cr.from(this);return r._extraScrollOffset=e,r}withMediaAction(e){let r=cr.from(this);return r._mediaAction=e,r}withTransitionResetVideoPosition(e){let r=cr.from(this);return r._transitionResetVideoPosition=new fe(e),r}withOpenUrlInNewTab(e){let r=cr.from(this);return r._openUrlInNewTab=new fe(e),r}withMediaSkipToTime(e){let r=cr.from(this);return r._mediaSkipToTime=new fe(e),r}withMediaSkipByAmount(e){let r=cr.from(this);return r._mediaSkipByAmount=new fe(e),r}withTransitionResetScrollPosition(e){let r=cr.from(this);return r._transitionResetScrollPosition=new fe(e),r}withConditionalActions(e){let r=cr.from(this);return r._conditionalActions=e,r}withTransitionResetInteractiveComponents(e){let r=cr.from(this);return r._transitionResetInteractiveComponents=new fe(e),r}withTargetVariableID(e){let r=cr.from(this);return r._targetVariableID=e,r}withTargetVariableData(e){let r=cr.from(this);return r._targetVariableData=e,r}withTargetVariableModeID(e){let r=cr.from(this);return r._targetVariableModeID=e,r}withTargetVariableSetID(e){let r=cr.from(this);return r._targetVariableSetID=e,r}withDeprecatedTargetVariableSetKey(e){let r=cr.from(this);return r._deprecatedTargetVariableSetKey=e,r}withTargetNodeFieldAlias(e){let r=cr.from(this);return r._targetNodeFieldAlias=e,r}withAnimationType(e){let r=cr.from(this);return r._animationType=e,r}withAnimationPhase(e){let r=cr.from(this);return r._animationPhase=e,r}easingFunctionFromAction(){return No.makeEasingFunctionWithEasingType(this.easingFunctionValues(),this.transitionDuration(),this._easingType)}apply(e){let r=this._transitionNodeID,n=this._transitionType,o=this._transitionDuration,i=this._easingType,a=this._easingFunctionValues,s=this._transitionShouldSmartAnimate,l=this._connectionType,c=this._connectionURL,d=this._overlayRelativePosition,u=this._navigationType,p=this._transitionPreserveScroll,_=this._extraScrollOffset,h=this._mediaAction,g=this._transitionResetVideoPosition,m=this._openUrlInNewTab,A=this._mediaSkipToTime,S=this._mediaSkipByAmount,T=this._transitionResetScrollPosition,R=this._conditionalActions,b=this._transitionResetInteractiveComponents,O=this._targetVariableID,f=this._targetVariableData,I=this._targetVariableModeID,y=this._targetVariableSetID,P=this._deprecatedTargetVariableSetKey,E=this._variableSetTargetExtensionId,C=this._targetNodeFieldAlias,B=this._animationType,G=this._animationPhase;return e._transitionNodeID!=null&&(r=e._transitionNodeID),e._transitionType!=null&&(n=e._transitionType),e._transitionDuration!=null&&(o=e._transitionDuration),e._easingType!=null&&(i=e._easingType),e._easingFunctionValues!=null&&(a=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(s=e._transitionShouldSmartAnimate),e._connectionType!=null&&(l=e._connectionType),e._connectionURL!=null&&(c=e._connectionURL),e._overlayRelativePosition!=null&&(d=e._overlayRelativePosition),e._navigationType!=null&&(u=e._navigationType),e._transitionPreserveScroll!=null&&(p=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(_=e._extraScrollOffset),e._mediaAction!=null&&(h=e._mediaAction),e._transitionResetVideoPosition!=null&&(g=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(m=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(A=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(S=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(T=e._transitionResetScrollPosition),e._conditionalActions!=null&&(R=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(b=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(O=e._targetVariableID),e._targetVariableData!=null&&(f=e._targetVariableData),e._targetVariableModeID!=null&&(I=e._targetVariableModeID),e._targetVariableSetID!=null&&(y=e._targetVariableSetID),e._deprecatedTargetVariableSetKey!=null&&(P=e._deprecatedTargetVariableSetKey),e._variableSetTargetExtensionId!=null&&(E=e._variableSetTargetExtensionId),e._targetNodeFieldAlias!=null&&(C=e._targetNodeFieldAlias),e._animationType!=null&&(B=e._animationType),e._animationPhase!=null&&(G=e._animationPhase),new cr(r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S,T,R,b,O,f,I,y,P,E,C,B,G)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${this._transitionNodeID},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(r=>r.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${this._connectionURL},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&this._conditionalActions.length>0&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),this._targetNodeFieldAlias!=null&&(e+=`targetNodeFieldAlias: ${this._targetNodeFieldAlias},`),this._animationType!=null&&(e+=`animationType: ${this._animationType},`),this._animationPhase!=null&&(e+=`animationPhase: ${this._animationPhase},`),e+=")",e}static from(e){return new cr(e._transitionNodeID,e._transitionType,e._transitionDuration,e._easingType,e._easingFunctionValues,e._transitionShouldSmartAnimate,e._connectionType,e._connectionURL,e._overlayRelativePosition,e._navigationType,e._transitionPreserveScroll,e._extraScrollOffset,e._mediaAction,e._transitionResetVideoPosition,e._openUrlInNewTab,e._mediaSkipToTime,e._mediaSkipByAmount,e._transitionResetScrollPosition,e._conditionalActions,e._transitionResetInteractiveComponents,e._targetVariableID,e._targetVariableData,e._targetVariableModeID,e._targetVariableSetID,e._deprecatedTargetVariableSetKey,e._variableSetTargetExtensionId,e._targetNodeFieldAlias,e._animationType,e._animationPhase)}static createDefault(){return new cr(X.invalid(),"INSTANT_TRANSITION",new fe(0),"IN_CUBIC",No.easingValuesForPreset("IN_CUBIC"),new fe(!1),"NONE",null,new F(0,0),"NAVIGATE",new fe(!1),new F(0,0),"PLAY",new fe(!1),new fe(!0),new fe(0),new fe(5),new fe(!1),[],new fe(!1),null,null,null,null,null,null,null,"NONE","IN")}static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:X.equals(e._transitionNodeID,r._transitionNodeID)&&e._transitionType==r._transitionType&&fe.equals(e._transitionDuration,r._transitionDuration)&&e._easingType==r._easingType&&le.List_equalsWithComparison(e._easingFunctionValues,r._easingFunctionValues,(n,o)=>Math.abs(n-o)<1e-6)&&fe.equals(e._transitionShouldSmartAnimate,r._transitionShouldSmartAnimate)&&e._connectionType==r._connectionType&&e._connectionURL==r._connectionURL&&F.equals_(e._overlayRelativePosition,r._overlayRelativePosition)&&e._navigationType==r._navigationType&&fe.equals(e._transitionPreserveScroll,r._transitionPreserveScroll)&&fe.equals(e._transitionResetVideoPosition,r._transitionResetVideoPosition)&&fe.equals(e._openUrlInNewTab,r._openUrlInNewTab)&&F.equals_(e._extraScrollOffset,r._extraScrollOffset)&&e._mediaAction==r._mediaAction&&fe.equals(e._mediaSkipToTime,r._mediaSkipToTime)&&fe.equals(e._mediaSkipByAmount,r._mediaSkipByAmount)&&fe.equals(e._transitionResetScrollPosition,r._transitionResetScrollPosition)&&le.List_equalsWithComparison(e._conditionalActions,r._conditionalActions,(n,o)=>zp.equals(n,o))&&fe.equals(e._transitionResetInteractiveComponents,r._transitionResetInteractiveComponents)&&e._targetVariableSetID==r._targetVariableSetID&&e._targetVariableID==r._targetVariableID&&e._targetVariableData==r._targetVariableData&&e._targetVariableModeID==r._targetVariableModeID&&e._deprecatedTargetVariableSetKey==r._deprecatedTargetVariableSetKey&&e._targetNodeFieldAlias==r._targetNodeFieldAlias&&e._animationType==r._animationType&&e._animationPhase==r._animationPhase}};cr.NULL_ACTION=new cr(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null,null,null,null,null,null,null,null);var Ir=cr,Tv;(e=>{function t(r,n){return r==null!=(n==null)?!1:r==null?!0:le.List_equalsWithComparison(r.keyCodes,n.keyCodes,(o,i)=>o==i)&&r.triggerDevice==n.triggerDevice}e.equals=t})(Tv||(Tv={}));var ls=class t{constructor(e,r,n,o,i){this._styleOverrideTable=e,this._fontSizes=r,this._characters=n,this._lines=o,this._characterStyleIds=i}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}fontSizes(){return this._fontSizes}static forTests1(){return new t(new Bn,null,"",[],[])}static forTests2(e){return new t(e,null,"",[],[])}},Zm=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new di(e),this.styleOverrideTable=e}};var Ko=class t{recomposed(){let e=Q.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let r=Math.PI/180*this.angleDegrees,n=Math.cos(r),o=Math.sin(r),i=Q.new2();return i.setM00(n),i.setM01(-o),i.setM10(o),i.setM11(n),e.multiply(i),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let r=new t,n=e.m00(),o=e.m10(),i=e.m01(),a=e.m11();r.translation=F.new(e.translation()),r.scale=F.new(e.scale1()),n*a-o*i<0&&(n<a?r.scale.setX(-r.scale.x()):r.scale.setY(-r.scale.y())),r.scale.x()!=0&&(n*=1/r.scale.x(),o*=1/r.scale.x()),r.scale.y()!=0&&(i*=1/r.scale.y(),a*=1/r.scale.y());let l=Math.atan2(o,n);if(l!=0){let c=-o,d=n,u=n,p=o,_=i,h=a;n=d*u+c*_,o=d*p+c*h,i=-c*u+d*_,a=-c*p+d*h}return r.angleDegrees=180/Math.PI*l,r.m00=n,r.m10=o,r.m01=i,r.m11=a,r}static lerp1(e,r,n){let o=t.from(e),i=t.from(r);return t.lerp2(o,i,n).recomposed()}static lerp2(e,r,n){(e.scale.x()<0&&r.scale.y()<0||e.scale.y()<0&&r.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),r.angleDegrees==0&&(r.angleDegrees=360),Math.abs(e.angleDegrees-r.angleDegrees)>180&&(e.angleDegrees>r.angleDegrees?e.angleDegrees-=360:r.angleDegrees-=360);let o=new t;return o.translation=e.translation.multiplyScalar(1-n).add(r.translation.multiplyScalar(n)),o.scale=e.scale.multiplyScalar(1-n).add(r.scale.multiplyScalar(n)),o.angleDegrees=e.angleDegrees*(1-n)+r.angleDegrees*n,o.m00=e.m00*(1-n)+r.m00*n,o.m10=e.m10*(1-n)+r.m10*n,o.m01=e.m01*(1-n)+r.m01*n,o.m11=e.m11*(1-n)+r.m11*n,o}constructor(){this.translation=F.new(),this.scale=F.new(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var Fc;(r=>{function t(n){return n=="GRADIENT_LINEAR"||n=="GRADIENT_RADIAL"||n=="GRADIENT_ANGULAR"||n=="GRADIENT_DIAMOND"}r.isGradient=t;function e(n){return n=="GRADIENT_ANGULAR"}r.shouldWrap=e})(Fc||(Fc={}));var _t=class{constructor(e,r){this.color=e,this.position=r}};_t.COMPARE=(e,r)=>Ye.double_compare(e.position,r.position),_t.EQUALS=(e,r)=>e.color==r.color&&e.position==r.position;var Wp=class Wp{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=Wp._previousID=Wp._previousID+1}};Wp._previousID=0;var Jm=Wp,ui=class ui extends Jm{constructor(r){super();this._patternScale=1;this._patternSpacing=Ae.FrozenVector_ZERO;this._type=null,this._color=N.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=wt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._patternTileType="RECTANGULAR",this._patternHorizontalAlignment="START",this._patternVerticalAlignment="START",this._patternScale=1,this._patternSpacing=Ae.FrozenVector_ZERO,this._patternSourceAbsoluteBounds=ar.FrozenRect_EMPTY,this._type=r}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(r){this._isEnabled=r}debugString(){return`SinglePaint color=${N.toString(this._color)}[${N.toCSS(this._color)}] type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&N.alpha(le.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(r){this._type=r}setColor(r){this._color=r}setBlendMode(r){this._blendMode=r}setImage(r){this._image=r}setImageThumbnail(r){this._imageThumbnail=r}setVideo(r){this._video!=null&&r==null&&console.log(new Error().stack),this._video=r}videoPlaybackParams(r){this._videoPlaybackParams=r}setTransform(r){this._transform=r}setTransform1(r){this._transform=r.clone()}setImageScaleMode(r){this._imageScaleMode=r}setRotationDeg(r){this._rotationDeg=r}setScalingFactor(r){this._scalingFactor=r}setFilterColorAdjust(r){this._filterColorAdjust=r}setDecodedImageIsReady(r){this._decodedImageIsReady=r}setDecodedImageThumbnailIsReady(r){this._decodedImageThumbnailIsReady=r}setColorStops(r){this._colorStops=r}setColorStops1(r){this._colorStops=r.slice()}setOpacity(r){this._opacity=r}originalImageWidth(){return this._originalImageWidth}setOriginalImageWidth(r){this._originalImageWidth=r}originalImageHeight(){return this._originalImageHeight}setOriginalImageHeight(r){this._originalImageHeight=r}allocateBoundsToImageRatio(r,n){let o=F.new(r);return this._rotationDeg!=0&&(Q.new2().rotatedBy(this._rotationDeg*(Math.PI/180)).transformPoint(n),n.makeAbs()),o.divideUpdate1(n),o}allocateImageSize(){let r=this._video!=null&&this._video.didLoad(this),n=this._image!=null&&this._image.isDecoded(),o=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return r?this._video.size(this):n?new F(this._image.width(),this._image.height()):o?this._originalImageWidth!=0&&this._originalImageHeight!=0?new F(this._originalImageWidth,this._originalImageHeight):new F(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(r){let n=this._rotationDeg*(Math.PI/180),o=Q.new2(),i=this.allocateImageSize();i==null&&xe("Trying to render image before it is loaded");let a=this.allocateBoundsToImageRatio(r,i);switch(this.imageScaleMode()){case"FILL":{o=o.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.maxComponent(),a.y()/a.maxComponent()).translatedBy2(-.5,-.5);break}case"FIT":{o=o.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.minComponent(),a.y()/a.minComponent()).translatedBy2(-.5,-.5);break}case"STRETCH":{o.copyFrom(this.transform());break}case"TILE":{o=o.translatedBy2(.5,.5).rotatedBy(-n).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(a);break}}return o}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(r){return this.image()==null||r==null||r.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/r.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(r){let n=Br.instance();r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_TINT,this._filterColorAdjust.tint),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_COLOR,this._filterColorAdjust.vibrance),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_SHADOWS,this._filterColorAdjust.shadows),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_HIGHLIGHTS,this._filterColorAdjust.highlights),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_EXPOSURE,this._filterColorAdjust.exposure),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_CONTRAST,this._filterColorAdjust.contrast),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_TEMPERATURE,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return N.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let r=0,n=this.colorStops().length;r<n;r=r+1)if(N.alpha(this.colorStops()[r].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return N.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let r=0,n=this.colorStops().length;r<n;r=r+1)if(N.alpha(this.colorStops()[r].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":case"PATTERN":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let r=this.colorStops()[0].color;for(let n=1,o=this.colorStops().length;n<o;n=n+1)if(r!=this.colorStops()[n].color)return this;return ui.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),r)}return this}equals1(r){return r.isVolatile()?!1:this.equals2(r.asSinglePaint())}equals2(r){var n;if(this._colorStops==null||r.colorStops()==null){if(this._colorStops==null!=(r.colorStops()==null))return!1}else if(!$t.FrozenList_equals(this._colorStops,r.colorStops(),_t.EQUALS))return!1;if(this._transform==null||r.transform()==null){if(this._transform==null!=(r.transform()==null))return!1}else if(!this.transform().equals1(r.transform()))return!1;if(this._video==null||r.video()==null){if(this._video==null!=(r.video()==null))return!1}else if(this._video.hash()!=r.video().hash())return!1;if(this._image==null||r.image()==null){if(this._image==null!=(r.image()==null))return!1}else if(this._image.objectHash()!=r.image().objectHash())return!1;if(this._imageThumbnail==null||r.imageThumbnail()==null){if(this._imageThumbnail==null!=(r.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=r.imageThumbnail().objectHash())return!1;if(this._patternSource==null||r.patternSource()==null){if(this._patternSource==null!=(r.patternSource()==null))return!1}else if(this._patternSource.id()!=((n=r.patternSource())==null?void 0:n.id()))return!1;return this._type==r.type()&&this._blendMode==r.blendMode()&&this._color==r.color()&&this._isEnabled==r.isEnabled()&&this._opacity==r.opacity()&&this._rotationDeg==r.rotationDeg()&&this._scalingFactor==r.scalingFactor()&&this._imageScaleMode==r.imageScaleMode()&&this._filterColorAdjust==r.filterColorAdjust()&&this._decodedImageIsReady==r.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==r.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let r=new ui(this._type);return r._blendMode=this._blendMode,r._color=this.color(),r._colorStops=this._colorStops,r._image=this._image,r._imageThumbnail=this._imageThumbnail,r._video=this._video,r._isEnabled=this._isEnabled,r._opacity=this._opacity,r._transform=this._transform,r._rotationDeg=this._rotationDeg,r._scalingFactor=this._scalingFactor,r._imageScaleMode=this._imageScaleMode,r._filterColorAdjust=this._filterColorAdjust,r._decodedImageIsReady=this._decodedImageIsReady,r._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,r._originalImageWidth=this._originalImageWidth,r._originalImageHeight=this._originalImageHeight,r._patternSource=this._patternSource,r._patternTileType=this._patternTileType,r._patternHorizontalAlignment=this._patternHorizontalAlignment,r._patternVerticalAlignment=this._patternVerticalAlignment,r._patternScale=this._patternScale,r._patternSpacing=this._patternSpacing,r._patternSourceAbsoluteBounds=this._patternSourceAbsoluteBounds,r}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return N.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let r=0,n=this._colorStops.length;r<n;r=r+1){let o=this._colorStops[r];if(!N.isOpaque(o.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":case"PATTERN":return!1}return!1}flattenedStops(){let r=this._colorStops.slice();if(r.sort((n,o)=>Ye.double_compare(n.position,o.position)),Fc.shouldWrap(this.type())&&r.length>=2){let n=r[0],o=le.List_last(r);if(n.position>0)if(o.position<1){let i=N.mix(n.color,o.color,n.position/(1-o.position+n.position));r.unshift(new _t(i,0)),r.push(new _t(i,1))}else r.unshift(new _t(o.color,0));else o.position<1&&r.push(new _t(n.color,1))}return r}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(r){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return Ae.FrozenVector_ZERO;let n=this.allocateImageSize(),o=null;switch(this.imageScaleMode()){case"STRETCH":{o=r.divide(this._transform.scale1());break}case"FILL":{let i=this.allocateBoundsToImageRatio(r,n);i.x()>i.y()?o=new F(r.x(),i.x()*this._image.height()):o=new F(i.y()*this._image.width(),r.y());break}case"FIT":{let i=this.allocateBoundsToImageRatio(r,n);i.x()>i.y()?o=new F(i.y()*this._image.width(),r.y()):o=new F(r.x(),i.x()*this._image.height());break}case"TILE":return Ae.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),Ae.FrozenVector_ZERO}return o}patternSource(){return this._patternSource}setPatternSource(r){this._patternSource=r}patternTileType(){return this._patternTileType}setPatternTileType(r){this._patternTileType=r}patternHorizontalAlignment(){return this._patternHorizontalAlignment}setPatternHorizontalAlignment(r){this._patternHorizontalAlignment=r}patternVerticalAlignment(){return this._patternVerticalAlignment}setPatternVerticalAlignment(r){this._patternVerticalAlignment=r}patternScale(){return this._patternScale}setPatternScale(r){this._patternScale=r}patternSpacing(){return this._patternSpacing}setPatternSpacing(r){this._patternSpacing=r}patternSourceAbsoluteBounds(){return this._patternSourceAbsoluteBounds}setPatternSourceAbsoluteBounds(r){this._patternSourceAbsoluteBounds=r}static create(r,n,o,i,a){let s=new ui(r);return s.setOpacity(n),s.setBlendMode(o),s.setIsEnabled(i),s.setColor(a),s}static createSolid(r,n){return ui.create("SOLID",n*N.alphaF(r),"NORMAL",!0,N.withAlpha(r,255))}static createLinearGradient(r,n=1){let o=ui.create("GRADIENT_LINEAR",1,"NORMAL",!0,N.BLACK);return o.setColorStops1(r),o}static createRadialGradient(r,n=1){let o=ui.create("GRADIENT_RADIAL",1,"NORMAL",!0,N.BLACK);return o.setColorStops1(r),o}static createAngularGradient(r,n=1){let o=ui.create("GRADIENT_ANGULAR",1,"NORMAL",!0,N.BLACK);return o.setColorStops1(r),o}static createDiamondGradient(r,n=1){let o=ui.create("GRADIENT_DIAMOND",1,"NORMAL",!0,N.BLACK);return o.setColorStops1(r),o}};ui.TRANSPARENT=ui.create("SOLID",0,"NORMAL",!0,N.BLACK),ui.SOLID_BLACK=ui.create("SOLID",1,"NORMAL",!0,N.BLACK);var $=ui,Kp=class t extends Jm{constructor(e,r,n,o,i){super(),this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=e,this._to=r,this._getEasedT=n,this._fromCanvasSpaceNodeSize=o,this._toCanvasSpaceNodeSize=i,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new F(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new F(.5,.5).subtract(this._cachedFromTransform.scale1().divideScalar(2).add(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new F(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new F(.5,.5).subtract(this._cachedToTransform.scale1().divideScalar(2).add(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(e){this._from.setIsEnabled(e),this._to.setIsEnabled(e)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return N.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let e=new F(.5,.5),r=this._from.transform().clone().translatedBy1(e),n=this._to.transform().clone().translatedBy1(e);return Ko.lerp1(r,n,this.t()).translatedBy1(e.negative())}allocateImageTransformForGeometrySize(e){let r=Q.new2(),n=F.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let o=F.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),i=n.divide(o),a=F.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),s=new F(.5,.5).subtract(a).subtract(i.divideScalar(2)),l=Ye.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return r.translatedBy1(s).rotatedBy(l).scaledBy1(i)}else{let o=this._from.allocateImageTransformForGeometrySize(n),i=this._to.allocateImageTransformForGeometrySize(n);return r.copyFrom(Ko.lerp1(o,i,this.t())),r}}opacity(){return Ye.double_clamp(Ye.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(e){let r=Br.instance();e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_TINT,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_COLOR,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_SHADOWS,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_HIGHLIGHTS,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_EXPOSURE,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_CONTRAST,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_TEMPERATURE,Ye.double_clamp(Ye.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(e){return e.isVolatile()?this.equals2(e.asVolatilePaint()):!1}equals2(e){if(!e.isVolatile())return!1;let r=e;return this._from.equals2(r._from.asSinglePaint())&&this._to.equals2(r._to.asSinglePaint())&&this._getEasedT==r._getEasedT&&this._fromCanvasSpaceNodeSize.equals(r._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(r._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new t(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(e){return e(this._from)||e(this._to)}static create(e,r,n,o,i){return new t(e,r,i,n,o)}},OF;(e=>e.FrozenPaint_EMPTY_LIST=[])(OF||(OF={}));var Ce;(V=>{function t(D,w){return[$.createSolid(D,w)]}V.createFromSolidColor=t;function e(D){return D}V.create1=e;function r(D){return D}V.create2=r;function n(D){return[D]}V.fromPaint=n;function o(D){return D}V.asPaintList=o;function i(D){return D.length==0}V.isEmpty=i;function a(D){return D.length}V.count=a;function s(D,w){return D[w]}V.get=s;function l(D){return D[0]}V.first=l;function c(D){return le.List_last(D)}V.last=c;function d(D){return D.slice()}V.clone=d;function u(D){let w=!1;for(let k=0,z=D.length;k<z;k=k+1)D[k].type()=="EMOJI"&&(w=!0);return w}V.hasEmoji=u;function p(D,w){return $t.FrozenList_equals(D,w,(k,z)=>k==null||z==null?k==null==(z==null):k.equals1(z))}V.equals=p;function _(D){return D.length==1?D[0]:null}V.onlyPaintOrNull=_;function h(D){let w=_(D);return w!=null&&w.type()=="SOLID"&&!w.isVolatile()?w:null}V.onlySolidPaintOrNull=h;function g(D){for(let w=0,k=D.length;w<k;w=w+1){let z=D.length-1-w;if(!D[z].isEnabledAndVisible())continue;let H=D[z];return H!=null&&H.type()=="SOLID"&&!H.isVolatile()&&H.asSinglePaint().isOpaque()?H:null}return null}V.firstPaintIfSolidAndOpaqueOrNull=g;function m(D){return D.length==1&&D[0].type()=="EMOJI"}V.isEmojiPaint=m;function A(D){if(D.length>1&&V.containsPatternPaint(D))return!1;for(let w=0,k=D.length;w<k;w=w+1){let z=D[w].asSinglePaint();if(z!=null){if(z.blendMode()!="NORMAL"&&z.blendMode()!="PASS_THROUGH")return!1}else{let H=D[w].asVolatilePaint();if(H!=null&&H.eitherPaint(K=>K.blendMode()!="NORMAL"&&K.blendMode()!="PASS_THROUGH"))return!1}}return!0}V.isIsolated=A;function S(D){for(let w of D)if(w.type()==="PATTERN")return!0;return!1}V.containsPatternPaint=S;function T(D){for(let w=0,k=D.length;w<k;w=w+1)if(D[w].isEnabledAndVisible())return!0;return!1}V.containsAtLeastOneVisiblePaint=T;function R(D){for(let w=0,k=D.length;w<k;w=w+1){let z=D[w].asSinglePaint(),H=D[w].asVolatilePaint();if(z==null&&H!=null&&H.isVisible()||z!=null&&z.isVisible()&&!z.hasAnyFullyTransparentAreas())return!0}return!1}V.containsAtLeastOneVisibleNotFullyTransparentPaint=R;function b(D){for(let w=0,k=D.length;w<k;w=w+1){if(!D[w].isEnabledAndVisible())continue;let z=D[w].asSinglePaint();if(z!=null){if(z.isOpaque())return!0}else{let H=D[w].asVolatilePaint();if(H!=null&&H.isOpaque())return!0}}return!1}V.containsAtLeastOneVisibleOpaquePaint=b;function O(D){for(let w=0,k=D.length;w<k;w=w+1){let z=D[w].asSinglePaint();if(z!=null){if(!z.isOpaque())return!0}else{let H=D[w].asVolatilePaint();if(H!=null&&!H.isOpaque())return!0}}return!1}V.containsAtLeastOneNonOpaquePaint=O;function f(D){for(let w=0,k=D.length;w<k;w=w+1){let z=D[w].asSinglePaint();if(z==null&&D[w].asVolatilePaint()!=null||!z.hasAnyFullyTransparentAreas())return!1}return!0}V.hasAnyFullyTransparentAreas=f;function I(D){for(let w=0,k=D.length;w<k;w=w+1){let z=D[w].asSinglePaint();if(z!=null){if(z.hasAnimatingMedia())return!0}else{let H=D[w].asVolatilePaint();if(H!=null&&H.eitherPaint(K=>K.hasAnimatingMedia()))return!0}}return!1}V.hasAnimatingMediaPaints=I;function y(D){for(let w=0,k=D.length;w<k;w=w+1)if(D[w].isVolatile())return!0;return!1}V.hasVolatilePaints=y;function P(D,w){var k,z;for(let H=0,K=D.length;H<K;H=H+1){let j=D[H].asSinglePaint();(j==null?void 0:j.video())!=null&&w(j);let q=D[H].asVolatilePaint();((k=q==null?void 0:q.to())==null?void 0:k.video())!=null&&w(q.to()),((z=q==null?void 0:q.from())==null?void 0:z.video())!=null&&w(q.from())}}V.forEachPaintWithVideo=P;function E(D){if(A(D))return[D];let w=[],k="NORMAL",z="SOLID",H=[];for(let K=0,j=D.length;K<j;K=K+1){let q=D[K];(q.blendMode()!=k||q.blendMode()!="NORMAL"||q.type()==="PATTERN"||z==="PATTERN")&&H.length!=0&&(w.push(H.slice()),H.length=0),k=q.blendMode(),z=q.type(),H.push(q)}return H.length!=0&&w.push(H.slice()),w}V.isolatedPaints=E;function C(D){if(y(D))return D;if(D.length==2&&D[0].type()=="SOLID"&&le.List_last(D).asSinglePaint().isGradient()){let k=D[0].asSinglePaint(),z=N.multiplyOpacity(k.color(),k.opacity()),H=le.List_last(D).clone(),K=[],j=-1,q=!0,J=H.colorStops();for(let ie=0,Ee=J.length;ie<Ee;ie=ie+1){let Ke=J[ie];if(j>=0&&j!=N.alpha(Ke.color)){q=!1;break}j=N.alpha(Ke.color);let Ve=N.multiplyOpacity(Ke.color,H.opacity());K.push(new _t(N.blend(z,Ve),Ke.position))}if(q)return H.setOpacity(1),H.setColorStops1(K),C([H])}let w=D.length;for(let k=0;k<w;k=k+1){let z=D[k].asSinglePaint().optimized();if(z==D[k])continue;let H=D.slice(0,k);for(H.push(z);(k=k+1)<w;)H.push(D[k].asSinglePaint().optimized());return H}return D}V.optimize=C,V.SOLID_BLACK=[$.createSolid(N.BLACK,1)],V.EMPTY=[]})(Ce||(Ce={}));var $m;(r=>{function t(n){return X._new(n,r._nextLocalID=r._nextLocalID+1)}r.make=t,r._nextLocalID=0})($m||($m={}));var Dc=class t{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=Re.mockTrackEvent((e,r,n)=>{this.trackingCalls.push(new t.TrackingPayload(e,r,n))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,r){this.expectTrackToHaveBeenCalledWith2(e,r,{})}expectTrackToHaveBeenCalledWith2(e,r,n){this.trackingCalls.some(o=>o.equalsWithSubsetOfArgs(new t.TrackingPayload(e,r,n)))}};(e=>{class t{equalsWithSubsetOfArgs(n){if(this.name!=n.name)return!1;for(let o of Object.keys(n.args))if(n.args[o]!==this.args[o])return!1;for(let o of Object.keys(n.options))if(n.options[o]!==this.options[o])return!1;return!0}constructor(n,o,i){this.name=n,this.args=o,this.options=i}}e.TrackingPayload=t})(Dc||(Dc={}));function pi(t){if(!Yr())throw new Error(t)}function NF(t){Gd=Gd+1;let e=X._new(1,Gd);for(let r=0,n=t.totalNodeCount();r<n&&t.findNode(e)!=null;r=r+1)Gd=Gd+1,e=X._new(1,Gd);return e}function pn(t,e){let r=t.scene().createNode(NF(t.scene()),e);return r.setVisible(!0),r.setOpacity(1),e!="CANVAS"&&e!="DOCUMENT"&&(r.setRelativeTransform(Q.new2()),r.setSize(new F(100,100))),t.appendChild(r),r}function ht(t,e){return Dr(t,e,N.BLACK)}function _i(t,e,r){let n=pn(t,"FRAME");return n.setName(e),n.setBackgroundOpacity(1),n.setIsBackgroundEnabled(!0),n.setIsFrameMaskDisabled(!1),n.setIsResizeToFit(!1),n.setTestOnlyFillPaints([r]),n.setStrokeAlign("CENTER"),n}function xc(t,e,r,n,o){let i=pn(t,"FRAME");return i.setName(e),i.setBackgroundOpacity(1),i.setIsBackgroundEnabled(!0),i.setIsFrameMaskDisabled(!1),i.setIsResizeToFit(!1),i.setStrokeAlign("CENTER"),i.setTestOnlyFillPaints(r),i.setTestOnlyStrokeGeometry(new Ur([new Gr("NONZERO",0,Lt.forCenterStrokeAroundRect(o,10),o)],null,o,null)),i.setTestOnlyStrokePaints(n),i}function Dr(t,e,r){let n=new $("SOLID");return n.setColor(r),n.setOpacity(1),n.setIsEnabled(!0),_i(t,e,n)}function PF(t,e){let r=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return _i(t,e,r)}function Ma(t){let e=pn(t,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),bl(e,!1),e.setIsResizeToFit(!0),e}function Ud(t){let e=pn(t,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function Us(t,e){let r=Ma(t);return r.setName(e),r}function Xe(t){return ht(t,"Frame")}function Vd(t){return pn(t,"VECTOR")}function qr(t){return pn(t,"RECTANGLE")}function dt(t,e){let r=qr(t);return r.setName(e),r}function FF(t,e){let r=pn(t,"ROUNDED_RECTANGLE");return r.setCornerRadius(e),r}function ef(t){return pn(t,"TEXT")}function xV(t,e){let r=ef(t);return r.setName(e),r}function Ba(t){return pn(t,"SYMBOL")}function yl(t,e){let r=pn(t,"INSTANCE");return r.setTestOnlySymbolData(new Gs(e.id(),Ui.new1([],[]))),r}function la(t){let e=new L(0,0,t.width(),t.height()),r=new Gr("NONZERO",0,At.fromRect(e),e);return new Ur([r],null,r.bounds(),new di(new Bn))}function DF(t,e){let r=new Gr("NONZERO",0,Lt.fromRoundedRect1(new Na(2,L.new3(t),e,null,0)),t);return new Ur([r],null,r.bounds(),new di(new Bn))}function xF(t){let e=Lt.new2();e.moveTo1(t.topLeft().x(),t.topLeft().y()).lineTo(t.topRight().x(),t.topRight().y()).lineTo(t.bottomLeft().x(),t.bottomLeft().y()).close();let r=new Gr("NONZERO",0,e,t);return new Ur([r],null,r.bounds(),new di(new Bn))}function wF(t){let e=[];vt.INSTANCE.reset();for(let r of t)e.push(new Gr("NONZERO",0,Lt.fromRect(r),r)),vt.INSTANCE.include3(r);return new Ur(e,null,vt.INSTANCE.build(),new di(new Bn))}function wc(t,e){Ev(t,e.id())}function Ev(t,e){var o;let r=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0],n=r.action()!=null?(o=r.action())==null?void 0:o.value:Ir.createDefault();t.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])])}function gn(t,e,r,n,o){return tf(t,e,r,n,o,!1)}function tf(t,e,r,n,o,i){switch(o){case"NAVIGATE":{wc(t,e);break}case"OVERLAY":{kd(t,e);break}case"SWAP":{nf(t,e);break}case"SWAP_STATE":{wV(t,e);break}}let a=t.prototypeInteractions()[0];return t.setTestOnlyPrototypeInteractions([a.withEvent(a.event().withInteractionType(r)).withActions([a.action().value.withTransitionType(n).withTransitionShouldSmartAnimate(i)]).withStateManagementVersion(1)]),t.prototypeInteractions()[0]}function rf(t){var n;let e=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0],r=e.action()!=null?(n=e.action())==null?void 0:n.value:Ir.createDefault();t.setTestOnlyPrototypeInteractions([e.withActions([r.withConnectionType("BACK")])])}function kd(t,e){Iv(t,e,F.new())}function Iv(t,e,r){var i;let n=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0],o=n.action()!=null?(i=n.action())==null?void 0:i.value:Ir.createDefault();t.setTestOnlyPrototypeInteractions([n.withActions([o.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(r).withNavigationType("OVERLAY")])])}function nf(t,e){var o;let r=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0],n=r.action()!=null?(o=r.action())==null?void 0:o.value:Ir.createDefault();t.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])])}function wV(t,e){var o;let r=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0],n=r.action()!=null?(o=r.action())==null?void 0:o.value:Ir.createDefault();t.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])])}function Rv(t){var n;let e=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0],r=e.action()!=null?(n=e.action())==null?void 0:n.value:Ir.createDefault();t.setTestOnlyPrototypeInteractions([e.withActions([r.withConnectionType("CLOSE")])])}function of(t,e){let r=t.prototypeInteractions().length==0?dr.createDefault():t.prototypeInteractions()[0];t.setTestOnlyPrototypeInteractions([r.withEvent(r.event().withInteractionType(e))])}function je(t,e,r){let n=Q.new2();n.translate1(e),t.setRelativeTransform(n),t.setSize(r)}function pe(t,e){let r=dt(t,e);return r.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),r.setTestOnlyFillGeometry(la(L.new4(new F(0,0),r.size()))),r}function tr(t,e,r,n){let o=dt(t,e);return o.setTestOnlyFillPaints([$.createSolid(r,n)]),o.setTestOnlyFillGeometry(la(L.new4(new F(0,0),o.size()))),o}function af(t,e,r){let n=dt(t,e);return n.setTestOnlyFillPaints(r),n.setTestOnlyFillGeometry(la(L.new4(new F(0,0),n.size()))),n}function Yp(t,e,r){let n=dt(t,e);return n.setSize(r),n.setTestOnlyFillPaints(Ce.fromPaint(new $("IMAGE"))),n.setTestOnlyFillGeometry(la(L.new4(new F(0,0),n.size()))),n}function yv(t,e,r){let n=pn(t,"VECTOR");return n.setName(e),n.setSize(r),n.setTestOnlyFillPaints(Ce.fromPaint(new $("IMAGE"))),n.setTestOnlyFillGeometry(xF(L.new4(new F(0,0),n.size()))),n}function Io(t,e,r,n,o){let i=dt(t,e);return i.setSize(o),i.setTestOnlyFillPaints([$.createSolid(r,n)]),i.setTestOnlyFillGeometry(la(L.new4(new F(0,0),i.size()))),i}function bv(t,e,r,n,o){let i=pn(t,"VECTOR");return i.setName(e),i.setSize(o),i.setTestOnlyFillPaints([$.createSolid(r,n)]),i.setTestOnlyFillGeometry(xF(L.new4(new F(0,0),i.size()))),i}function LF(t,e){let r=xV(t,e);return r.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),r.setTestOnlyTextData(ls.forTests1()),r}function vv(t){sf(t,[])}function sf(t,e){if(pi("Should only be used in tests"),v()==null)throw new Error("Expected PrototypeLib to be initialized");let r=[t],n=[];for(let a=0,s=e.length;a<s;a=a+1){let l={};l.bytes=e[a],n.push(l)}let o={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:n,nodeChanges:r},i=Be().encodeMessage(o);v().applyLocalNodeChangesForTests(i)}function bl(t,e){if(pi("Writing to paints is only supported in tests because it's not fully implemented"),er.isFrameLike(t.type())){let r=[],n=t.fillPaints();if(n!=null)for(let o=0,i=n.length;o<i;o=o+1){let a=n[o].clone();a.setIsEnabled(e),r.push(a)}t.setTestOnlyFillPaints(r)}else t.setIsBackgroundEnabled(!1)}var Gd=0;var Qp=(D=>(D[D.BOOL=0]="BOOL",D[D.DOUBLE=1]="DOUBLE",D[D.INT=2]="INT",D[D.STRING=3]="STRING",D[D.STRING_ENUM=4]="STRING_ENUM",D[D.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",D[D.ARC_DATA=6]="ARC_DATA",D[D.GUID=7]="GUID",D[D.STYLE_ID=8]="STYLE_ID",D[D.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",D[D.VECTOR=10]="VECTOR",D[D.EFFECT_LIST=11]="EFFECT_LIST",D[D.TRANSFORM_MODIFIER_LIST=12]="TRANSFORM_MODIFIER_LIST",D[D.PAINT_LIST=13]="PAINT_LIST",D[D.PROTOTYPE_INTERACTION_LIST=14]="PROTOTYPE_INTERACTION_LIST",D[D.GEOMETRY=15]="GEOMETRY",D[D.PARENT_INDEX=16]="PARENT_INDEX",D[D.PROTOTYPE_DEVICE=17]="PROTOTYPE_DEVICE",D[D.PROTOTYPE_STARTING_POINT=18]="PROTOTYPE_STARTING_POINT",D[D.VIDEO_PLAYBACK=19]="VIDEO_PLAYBACK",D[D.KEY_TRIGGER=20]="KEY_TRIGGER",D[D.SYMBOL_DATA=21]="SYMBOL_DATA",D[D.TEXT_DATA=22]="TEXT_DATA",D[D.DERIVED_TEXT_DATA=23]="DERIVED_TEXT_DATA",D[D.VECTOR_DATA=24]="VECTOR_DATA",D[D.HYPERLINK=25]="HYPERLINK",D[D.MENTION=26]="MENTION",D[D.STRING_STRING_MULTIPLAYER_MAP=27]="STRING_STRING_MULTIPLAYER_MAP",D[D.NODE_BEHAVIORS=28]="NODE_BEHAVIORS",D[D.CODE_SNAPSHOT=29]="CODE_SNAPSHOT",D[D.OTHER__=30]="OTHER__",D[D.END__=31]="END__",D))(Qp||{});function Hd(t){switch(t){case 26:case 36:case 3:case 35:case 37:case 38:case 71:case 40:case 112:case 10:case 30:case 66:case 67:case 104:case 105:case 109:case 84:case 39:return 0;case 4:case 16:case 17:case 25:case 29:case 48:case 42:case 81:case 83:case 82:case 80:case 85:case 78:case 8:case 11:case 9:case 7:case 68:case 69:case 64:case 65:case 89:case 102:case 106:return 1;case 2:case 59:return 2;case 15:case 45:case 113:case 76:case 77:return 3;case 6:case 14:case 27:case 110:case 20:case 31:case 46:case 51:case 49:case 52:case 114:case 72:case 74:case 79:case 86:case 95:case 97:case 98:case 107:case 33:case 108:return 4;case 70:case 54:return 5;case 1:return 6;case 56:case 55:case 62:case 103:return 7;case 91:case 93:case 94:case 90:case 92:return 8;case 50:return 9;case 18:case 53:case 73:case 75:return 10;case 21:return 11;case 101:return 12;case 5:return 28;case 24:case 88:case 100:return 13;case 12:return 29;case 61:case 47:return 14;case 23:case 87:return 15;case 58:return 16;case 60:return 17;case 63:return 18;case 41:return 20;case 96:return 21;case 99:return 22;case 19:return 23;case 13:return 24;case 111:return 19;case 28:return 25;case 44:return 26;case 32:case 34:return 27;case 22:case 57:case 43:return 30;default:return 31}}var kg=Ja(hd());function Cv(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Cv||(Cv={}));function MF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(MF||(MF={}));function BF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(BF||(BF={}));function GF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(GF||(GF={}));function zd(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(zd||(zd={}));function UF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(UF||(UF={}));function VF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(VF||(VF={}));function kF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(kF||(kF={}));function HF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(HF||(HF={}));function zF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(zF||(zF={}));function WF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(WF||(WF={}));function KF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(KF||(KF={}));function YF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(YF||(YF={}));function QF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(QF||(QF={}));function qF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(qF||(qF={}));function Ov(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Ov||(Ov={}));function XF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(XF||(XF={}));function jF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(jF||(jF={}));function ZF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(ZF||(ZF={}));function Wd(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Wd||(Wd={}));function JF(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(JF||(JF={}));function $F(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})($F||($F={}));function eD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(eD||(eD={}));function tD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(tD||(tD={}));function rD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(rD||(rD={}));function nD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(nD||(nD={}));function oD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(oD||(oD={}));function iD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(iD||(iD={}));function aD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(aD||(aD={}));function sD(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(sD||(sD={}));var lD;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(lD||(lD={}));var cD;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(cD||(cD={}));var lf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(lf||(lf={}));var cf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(cf||(cf={}));var df;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(df||(df={}));var uf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(uf||(uf={}));var pf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(pf||(pf={}));var qp;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(qp||(qp={}));var _f;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(_f||(_f={}));var hf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(hf||(hf={}));var mf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(mf||(mf={}));var ff;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(ff||(ff={}));var gf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(gf||(gf={}));var Sf;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(Sf||(Sf={}));var Af;(function(t){t.toString=Yo,t.fromString=Qo,t.fromKiwi=qo,t.isEqual=Xo,t.isValid=jo})(Af||(Af={}));function Yo({key:t,version:e}){return`${Cv.toString(t)}/${Ov.toString(e)}`}function Qo(t){let e=t.split("/");if(e.length!==2)return null;let[r,n]=e;return r&&n?{key:r,version:n}:null}function qo({key:t,version:e}){return!t||!e?null:{key:t,version:e}}function Xo(t,e){return!t||!e?t===e:t.key===e.key&&t.version===e.version}function jo({key:t,version:e}){return!!(t&&e)}var dD={sessionID:-1,localID:-1},Zo="-1:-1";function uD(t){return t?(t.localID|0)>=0&&(t.sessionID|0)>=0:!1}function Nv(t){return t?`${t.sessionID|0}:${t.localID|0}`:null}function Tf(t){if(!t)return null;let e=t.split(":");if(!e||e.length!==2)return null;let r=-1,n=-1;try{r=parseInt(e[0]),n=parseInt(e[1])}catch{return null}return!isFinite(r)||!isFinite(n)?null:{sessionID:r,localID:n}}function pD(t,e,...r){typeof FIGBUILD_PROD=="boolean"&&!FIGBUILD_PROD&&!t&&console.error(`Failed assertion: ${e}`,...r)}var _D;(function(t){let r=hi("CodeLibraryId:",mf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(_D||(_D={}));var hD;(function(t){let r=hi("CodeFileId:",ff);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(hD||(hD={}));var mD;(function(t){let r=hi("CodeComponentId:",gf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(mD||(mD={}));var fD;(function(t){let r=hi("ManagedStringId:",Sf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(fD||(fD={}));var gD;(function(t){let r=hi("ResponsiveSetId:",hf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(gD||(gD={}));var Lc;(function(t){let r=hi("SymbolId:",lf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(Lc||(Lc={}));var Mc;(function(t){let r=hi("StateGroupId:",cf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(Mc||(Mc={}));var SD;(function(t){let r=hi("StyleId:",df);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid;function n(o){return o.guid&&o.guid!==Zo?t.fromLocalNodeIdStr(o.guid):t.fromRef(o.ref)}t.fromBindingsObj=n})(SD||(SD={}));var AD;(function(t){let r=hi("VariableID:",uf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(AD||(AD={}));var TD;(function(t){let r=hi("KeyframeTrackId:",Af);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(TD||(TD={}));var ED;(function(t){let r=hi("VariableOverrideId:",pf);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(ED||(ED={}));var Ga;(function(t){let e="VariableCollectionId:",r="VariableSetID:",n=hi(e,qp),o=hi(r,qp);t.INVALID=n.fromLocalNodeIdStr(Zo),t.toString=n.toString,t.toKiwi=i({current:n.toKiwi,deprecated:o.toKiwi}),t.toGuidObjIfLocal=i({current:n.toGuidObjIfLocal,deprecated:o.toGuidObjIfLocal}),t.toGuidStrIfLocal=i({current:n.toGuidStrIfLocal,deprecated:o.toGuidStrIfLocal}),t.toRefIfSubscribed=i({current:n.toRefIfSubscribed,deprecated:o.toRefIfSubscribed}),t.fromString=i({current:n.fromString,deprecated:o.fromString}),t.fromLocalNodeIdObj=n.fromLocalNodeIdObj,t.fromLocalNodeIdStr=n.fromLocalNodeIdStr,t.fromRef=n.fromRef,t.fromKiwi=n.fromKiwi,t.isValid=i({current:n.isValid,deprecated:o.isValid});function i({current:a,deprecated:s}){return l=>l.startsWith(r)?s(l):a(l)}})(Ga||(Ga={}));var ID;(function(t){let r=hi("ModuleId:",_f);t.INVALID=r.fromLocalNodeIdStr(Zo),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(ID||(ID={}));var RD;(function(t){t.fromKiwi=e=>{if(e.guid)return{type:"guid",guid:Nv(e.guid)};if(e.stateGroupId){let r=Mc.fromKiwi(e.stateGroupId);if(r)return{type:"stateGroup",stateGroupId:r}}if(e.symbolId){let r=Lc.fromKiwi(e.symbolId);if(r)return{type:"symbol",symbolId:r}}pD(!1,"Unhandled CanvasNodeId type")},t.toGuidStrIfLocal=e=>{switch(e.type){case"guid":return e.guid;case"symbol":return Lc.toGuidStrIfLocal(e.symbolId);case"stateGroup":return Mc.toGuidStrIfLocal(e.stateGroupId)}},t.toRefIfSubscribed=e=>{switch(e.type){case"guid":return null;case"symbol":return Lc.toRefIfSubscribed(e.symbolId);case"stateGroup":return Mc.toRefIfSubscribed(e.stateGroupId)}},t.toString=e=>{switch(e.type){case"guid":return e.guid;case"symbol":return Lc.toString(e.symbolId);case"stateGroup":return Mc.toString(e.stateGroupId)}},t.fromString=e=>{let r=Lc.fromString(e);if(r)return{type:"symbol",symbolId:r};let n=Mc.fromString(e);return n?{type:"stateGroup",stateGroupId:n}:Tf(e)?{type:"guid",guid:e}:null}})(RD||(RD={}));function hi(t,e){function r(m){return m}function n(m,A){return m.startsWith(t)?A(m.slice(t.length)):null}function o(m){return Tf(m)}function i(m){return e.fromString(m)}function a(m){return n(m,S=>{let T=i(S);if(T)return{assetRef:T};let R=o(S);if(R)return{guid:R}})??{guid:dD}}function s(m){return n(m,A=>i(A)?null:o(A))}function l(m){return n(m,A=>i(A)?null:A)}function c(m){return n(m,A=>i(A))}function d(m){return n(m,A=>o(A)||i(A)?m:null)}function u(m){return t+Nv(m)}function p(m){return Tf(m)?t+m:null}function _(m){return t+e.toString(m)}function h(m){if(!m)return null;let{guid:A,assetRef:S}=m;if(A&&!S)return u(A);if(!A&&S){let T=e.fromKiwi(S);if(T)return _(T)}return null}function g(m){let A=s(m);if(A)return uD(A);let S=c(m);return S?e.isValid(S):!1}return{toString:r,toKiwi:a,toGuidObjIfLocal:s,toGuidStrIfLocal:l,toRefIfSubscribed:c,fromString:d,fromLocalNodeIdObj:u,fromLocalNodeIdStr:p,fromRef:_,fromKiwi:h,isValid:g}}var Xp,Vs,Fv,Pv={env:{emscripten_notify_memory_growth:function(t){Fv=new Uint8Array(Vs.exports.memory.buffer)}}},Ef=class{init(){return Xp||(typeof fetch<"u"?Xp=fetch("data:application/wasm;base64,"+yD).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Pv)).then(this._init):Xp=WebAssembly.instantiate(Buffer.from(yD,"base64"),Pv).then(this._init),Xp)}_init(e){Vs=e.instance,Pv.env.emscripten_notify_memory_growth(0)}decode(e,r=0){if(!Vs)throw new Error("ZSTDDecoder: Await .init() before decoding.");let n=e.byteLength,o=Vs.exports.malloc(n);Fv.set(e,o),r=r||Number(Vs.exports.ZSTD_findDecompressedSize(o,n));let i=Vs.exports.malloc(r),a=Vs.exports.ZSTD_decompress(i,r,o,n),s=Fv.slice(i,i+a);return Vs.exports.free(o),Vs.exports.free(i),s}},yD="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";var ao=class{constructor(e,r){this.a=e,this.b=r}};var _n=(S=>(S[S.METADATA=0]="METADATA",S[S.GROUP=1]="GROUP",S[S.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",S[S.FILL=3]="FILL",S[S.FILL_STROKE=4]="FILL_STROKE",S[S.MASK=5]="MASK",S[S.BLUR=6]="BLUR",S[S.BLEND=7]="BLEND",S[S.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",S[S.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",S[S.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",S[S.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",S[S.DISSOLVE=12]="DISSOLVE",S[S.VOLATILE_RENDER_EFFECT=13]="VOLATILE_RENDER_EFFECT",S[S.GRAIN=14]="GRAIN",S[S.NOISE=15]="NOISE",S[S.SCATTER_BRUSH_FILL=16]="SCATTER_BRUSH_FILL",S[S.GLASS=17]="GLASS",S))(_n||{});var ca;(i=>{function t(a,s){return a.has(s)}i.has=t;function e(a,s){return a.get(s)??null}i.get=e;function r(a,s,l){a.set(s,l)}i.set=r;function n(a){a.clear()}i.clear=n;function o(){return new Map}i._new=o})(ca||(ca={}));var If=class{constructor(e,r){this.skippedPrerasterization=!1;this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=r}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}};var da=class da{constructor(e,r,n){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=r,this.yRadius=n,da.hasher.reset(),da.hasher.hash1(this.center.x()),da.hasher.hash1(this.center.y()),da.hasher.hash1(this.xRadius),da.hasher.hash1(this.yRadius),this._hash=da.hasher.value()}cppUniquePath(){return null}bounds(){return new L(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof da?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new da(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return Ld()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Lt.forEllipse(this.bounds())),this._cachedBezier}asRoundedRectPath(){return null}static fromBounds(e){return new da(e.center(),e.width()/2,e.height()/2)}};da.hasher=new li;var En=da;var Dv=class{constructor(){this.result="",this.indent=""}};function Bc(t){switch(t){case et.INVERSE_TRANSFORM:return"INVERSE_TRANSFORM";case et.TRANSFORM_ISOLATION:return"TRANSFORM_ISOLATION";case et.TRANSFORM:return"TRANSFORM";case et.MAX_TRANSFORM_SCALE:return"MAX_TRANSFORM_SCALE";case et.OPACITY:return"OPACITY";case et.STATE_SWAP:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}var Rf=class{static debugString(e,r,n,o){let i=new Dv;return this._debugStringRecursive(e,i,r,n,o),i.result}static _debugStringRecursive(e,r,n,o,i){let a=i!=0;r.result+=r.indent,n||(r.result+=o?"\u2514\u2500":"\u251C\u2500");let s=r.indent.length;switch(n||(r.indent+=o?"  ":"\u2502 "),e.op()){case 0:{let l=e;r.result+="METADATA",this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 2:{let l=e;r.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 1:{let l=e;r.result+="GROUP",this._appendFlagsToString(r,e),r.result+=`
`;for(let c=0,d=l.children.length;c<d;c=c+1){let u=l.children[c];this._debugStringRecursive(u,r,!1,c+1==l.children.length,i)}break}case 3:{let l=e,c=l.geometry.path().path(),d=c instanceof En?"CirclePath":c instanceof At?"RoundedRectPath":c instanceof Lt?"BezierPath":c instanceof tt?"FrozenBezierPath":c instanceof To?"UniquePath":"UnknownPath";r.result+=`FILL path=${d} paints=`,this._appendPaintDataToString(r,l.geometry.paints,i),a&&(r.result+=` transform=${l.transform}`,r.result+=` paintSize=${l.paintSize}`),e.isRectFill()?r.result+=" isRect":e.isRoundedRectFill()&&(r.result+=" isRoundedRect"),this._appendFlagsToString(r,e),r.result+=`
`;break}case 4:{let l=e;switch(r.result+="FILL_STROKE",l.mode){case 0:{r.result+=" mode=INSIDE";break}case 1:{r.result+=" mode=OUTSIDE";break}}r.result+=" fills=",this._appendGeometriesToString(r,l.fillGeometries,i),r.result+=" strokes=",this._appendGeometriesToString(r,l.strokeGeometries,i),a&&(r.result+=` transform=${l.transform}`),this._appendFlagsToString(r,l),r.result+=`
`;break}case 16:{let l=e;r.result+="SCATTER_BRUSH_FILL",r.result+=" fills=",this._appendGeometriesToString(r,l.fillGeometries,i),a&&(r.result+=` transform=${l.transform}`),this._appendFlagsToString(r,l),r.result+=`
`;break}case 5:{let l=e;switch(r.result+="MASK",l.type){case 0:{r.result+=" type=NORMAL";break}case 3:{r.result+=" type=BACKGROUND_BLUR";break}case 2:{r.result+=" type=INNER_SHADOW color=",this._appendColorToString(r,l.innerShadowFill);break}case 4:{r.result+=" type=KNOCKOUT_SHADOW";break}case 5:r.result+=" type=PATTERN"}this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.alpha,r,!1,!1,i),this._debugStringRecursive(l.color,r,!1,!0,i);break}case 6:{let l=e;r.result+="BLUR",l.startRadius!=l.endRadius?(r.result+=` start radius=${l.startRadius}`,r.result+=` end radius=${l.endRadius}`,r.result+=` start offset=${l.startPoint}`,r.result+=` end offset=${l.endPoint}`):r.result+=` radius=${l.endRadius}`,a&&(r.result+=` clamp=${l.clamp}`),this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 7:{let l=e;r.result+="BLEND mode=",r.result+=l.blendMode,r.result+=` opacity=${l.opacity}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 14:{let l=e;r.result+="GRAIN",r.result+=` radius=${l.radius}`,r.result+=` noiseSize=${l.noiseSize}`,r.result+=` clipToShape=${l.clipToShape}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 17:{let l=e;r.result+="GLASS",r.result+=` radius=${l.blurRadius}`,r.result+=` reflectionRadius=${l.reflectionRadius}`,r.result+=` refractionIntensity=${l.refractionIntensity}`,r.result+=` refractionDistance=${l.refractionDistance}`,r.result+=` lightIntensity=${l.lightIntensity}`,r.result+=` lightAngle=${l.lightAngle}`,r.result+=` chromaticAberration=${l.chromaticAberration}`,r.result+=` bevelSize=${l.bevelSize}`,r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 15:{let l=e;r.result+="NOISE",r.result+=` noiseSize=${l.noiseSize}`,r.result+=` noiseSize=${l.density}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 9:{let l=e;r.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(r,l.color),this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.alpha,r,!1,!0,i);break}case 8:{let l=e;r.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.tree,r,!1,!0,i);break}case 10:{let l=e;switch(r.result+=`VOLATILE_PROPERTY_BINDING property=${Bc(l.property)}`,a&&(r.result+=` id=${l.id}`),l.property){case et.MAX_TRANSFORM_SCALE:{r.result+=` value=${l.maxTransformScale()}`;break}case et.TRANSFORM:{r.result+=` value=${l.transform()}`,l.id.startsWith("SHADOW_TRANSFORMATION")&&(r.result+=" SHADOW_TRANSFORMATION");break}case et.OPACITY:{r.result+=` value=${l.opacity()}`;break}}this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 11:{let l=e;r.result+=`STATIC_TRANSFORM_BINDING transform=${l.transform}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 13:{let l=e;r.result+=`VOLATILE_RENDER_EFFECT id=${l.id} property=${Kr[l.property]}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 12:{let l=e;r.result+="DISSOLVE",this._appendFlagsToString(r,e),r.result+=`
`,l.startChild!=null&&this._debugStringRecursive(l.startChild,r,!1,!1,i),l.endChild!=null&&this._debugStringRecursive(l.endChild,r,!1,!0,i);break}default:throw new Error(`Unhandled node op ${_n[e.op()]}`)}r.indent=r.indent.slice(0,s)}static _appendGeometriesToString(e,r,n){e.result+="[";for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];o!=0&&(e.result+=", ");let s=a.path().path();s instanceof Lt?e.result+=`(${s.countCommands()} commands, `:s instanceof En?e.result+="EllipsePath, ":s instanceof At&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,a.paints,n),e.result+=")"}e.result+="]"}static _appendFlagsToString(e,r){r.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),r.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),r.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),r.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),r.hasVolatileContent()&&(e.result+=" volatile"),r.canCacheRasterized()||(e.result+=" nocache")}static _appendSinglePaintToString(e,r,n){let o=n!=0,i=r.asVolatilePaint();if(i!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,i.from(),n),e.result+=" -> ",this._appendSinglePaintToString(e,i.to(),n),e.result+="]";return}let a=r.asSinglePaint();switch(a.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,a.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let s=a.colorStops();for(let l=0,c=s.length;l<c;l=l+1){l>0&&(e.result+=", ");let d=s[l];e.result+=`${d.position}`,e.result+=" ",this._appendColorToString(e,d.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{o&&(e.result+=` hash=${a.image()!=null?a.image().hash():"NULL"}`,e.result+=` thumbnail=${a.imageThumbnail()!=null?a.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${a.imageScaleMode()}`,e.result+=` imageRotationDeg=${a.rotationDeg()}`,e.result+=` imageScalingFactor=${a.scalingFactor()}`);break}default:break}o&&a.transform()!=null&&(e.result+=` transform=${a.transform()}`),e.result+=` opacity=${a.opacity()}`}static _appendPaintDataToString(e,r,n){e.result+="[";for(let o=0,i=r.length;o<i;o=o+1){o>0&&(e.result+=",");let a=r[o];e.result+=a.type()+" ",this._appendSinglePaintToString(e,a,n)}e.result+="]"}static _appendColorToString(e,r){N.isOpaque(r)?e.result+=N.toCSS(r):e.result+=`rgba(${N.red(r)}, ${N.green(r)}, ${N.blue(r)}, ${N.alpha(r)})`}};var Gc=.001,bf=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,r,n,o,i){this.type=e,this.paints=r,this.maxBounds=n,this.rotation=o,this.unrotatedGlyphSize=i}},Kt=class t extends bf{constructor(e,r,n,o){super(0,r,e.bounds(),n,o),this._isOptimized=!1,this._path=e}path(){return this._path}withNewPaints(e){return new t(this._path,e)}equals(e){if(this.type!=e.type)return!1;if(this.path()==null||e.path()==null){if(this.path()==null!=(e.path()==null))return!1}else if(!this.path().equals(e.path()))return!1;if(this.paints==null||e.paints==null){if(this.paints==null!=(e.paints==null))return!1}else if(!Ce.equals(this.paints,e.paints))return!1;return this.rotation!=e.rotation||this.unrotatedGlyphSize==null!=(e.unrotatedGlyphSize==null)?!1:!(this.unrotatedGlyphSize!=null&&e.unrotatedGlyphSize!=null&&!this.unrotatedGlyphSize.equals(e.unrotatedGlyphSize))}optimized(){if(this._isOptimized)return this;let e=Ce.optimize(this.paints);return this.paints!=e?new t(this.path(),e,this.rotation,this.unrotatedGlyphSize):(this._isOptimized=!0,this)}},Uc=class t extends bf{constructor(e,r,n,o,i,a){super(1,r,n,i,a),this._isOptimized=!1,this._computePath=e,this.id=o}path(){return this._computePath()}withNewPaints(e){return new t(this._computePath,e,this.maxBounds,this.id)}equals(e){return this.type==e.type&&this.id==e.id}optimized(){if(this._isOptimized)return this;let e=Ce.optimize(this.paints);return this.paints!=e?new t(this._computePath,e,this.maxBounds,this.id,this.rotation,this.unrotatedGlyphSize):(this._isOptimized=!0,this)}},Vr=class t{currentBounds(e){if(e==null)return this.maxBounds;if(ca.has(e,this)){let n=ca.get(e,this);if(n!=null)return n}let r=this.computeBounds(e);return ca.set(e,this,r),r}equals(e){return this.equalsWithinBounds(e,null)}equalsWithinBounds(e,r){if(e==this)return!0;if(r!=null){let n=e.maxBounds.overlaps(r),o=this.maxBounds.overlaps(r);if(!n&&!o)return!0;if(n!=o)return!1;if(!e.maxBounds.equals(this.maxBounds)){if(r.contains1(e.maxBounds)&&r.contains1(this.maxBounds))return!1;let i=L.fromRect(this.maxBounds).intersectedWith(r),a=L.fromRect(this.maxBounds).intersectedWith(r);if(!i.equals(a))return!1}}return e.op()!=this.op()?!1:this.equalsWithinBoundsImpl(e,r)}constructor(e,r){this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=r}hasNonIsolatedBlends(){return(1&this.flags)!=0}dependsOnBackgroundContent(){return this.hasBackgroundBlurs()||this.hasGlassEffects()}hasBackgroundBlurs(){return(2&this.flags)!=0}hasGlassEffects(){return(64&this.flags)!=0}canBeUsedInBackgroundBlurs(){return(132&this.flags)==0}canBeUsedInGlassEffects(){return(128&this.flags)==0}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.dependsOnBackgroundContent()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Gc))return!0}return!1}isAxisAlignedRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path().asRoundedRectPath()!=null&&e.transform.isAxisAligned(Gc))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Gc))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof At&&e.transform.hasPerpendicularAxes(Gc))return!0}return!1}desiredAntialiasing(e){return e===0?0:this.op()!=3&&this.op()!=4&&this.op()!=16?0:e===1&&(this.hasAnimatingMedia()||this.hasVolatileContent())?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let r=this;switch(e+="FILL_STROKE",r.mode){case 0:{e+=" mode=INSIDE";break}case 1:{e+=" mode=OUTSIDE";break}}break}case 16:{e+="SCATTER_BRUSH_FILL";break}case 5:{let r=this;switch(e+="MASK",r.type){case 0:{e+=" type=NORMAL";break}case 3:{e+=" type=BACKGROUND_BLUR";break}case 2:{e+=" type=INNER_SHADOW";break}case 4:{e+=" type=KNOCKOUT_SHADOW";break}case 1:{e+=" type=LUMINANCE";break}case 5:e+=" type=PATTERN"}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 14:{e+="GRAIN";break}case 15:{e+="NOISE";break}case 17:{e+="GLASS";break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{e+=`VOLATILE_PROPERTY_BINDING property=${Bc(this.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 13:{let r=this;e+=`VOLATILE_RENDER_EFFECT id=${r.id} property=${Kr[r.property]}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${_n[this.op()]}`)}return e}debugString1(){return this.debugString2(0)}debugString2(e){return Rf.debugString(this,!0,!1,e)}static visitEachNodeInTree(e,r,n){if(e!=null){switch(r!=null&&r(e),e.op()){case 0:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 2:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 1:{let o=e;for(let i of o.children)t.visitEachNodeInTree(i,r,n);break}case 3:case 4:case 16:case 8:break;case 5:{let o=e;t.visitEachNodeInTree(o.alpha,r,n),t.visitEachNodeInTree(o.color,r,n);break}case 6:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 7:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 14:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 15:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 17:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 9:{let o=e;t.visitEachNodeInTree(o.alpha,r,n);break}case 10:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 11:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 13:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 12:{let o=e;t.visitEachNodeInTree(o.startChild,r,n),t.visitEachNodeInTree(o.endChild,r,n);break}default:throw new Error(`Unhandled node op ${_n[e.op()]}`)}n!=null&&n(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4||e.op()==16?e.paintSize:null}},Le=class t extends Vr{constructor(e,r=!1){super(vD(e,null),KV(e)),this.children=e,this._isFirstChildSolidBackground=r,this._isFirstChildSolidBackground}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.dependsOnBackgroundContent()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}computeBounds(e){return vD(this.children,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.children.length;for(let r=0;r<e;r=r+1){if(r==0&&this._isFirstChildSolidBackground)continue;let n=this.children[r],o=n.optimized();if(o==n&&n.op()!=1)continue;let i=this.children.slice(0,r),a=(s,l)=>{if(l.op()==1){let c=l;for(let d of c.children)s.push(d)}else s.push(l)};for(o!=null&&a(i,o);(r=r+1)<e;){let s=this.children[r].optimized();s!=null&&a(i,s)}return i.length==0?null:this._isFirstChildSolidBackground?i.length==1?null:new t(i,this._isFirstChildSolidBackground):t.wrap(i)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let o=e.children;if(this.children.length!=o.length)return!1;for(let i=0,a=this.children.length;i<a;i=i+1)if(!this.children[i].equalsWithinBounds(o[i],r))return!1;return!0}static wrap(e){let r=e.filter(n=>n!=null);return r.length==1?r[0]:new t(r)}static wrapWithSolidBackground(e,r){let n=Xr.solidColorRect(e.maxBounds,r,1);return new t([n,e],!0)}},mi=class t extends Vr{constructor(e,r){super(e.maxBounds,r?e.flags|r:e.flags),this.child=e}op(){return 2}computeBounds(e){return this.child.computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=o=>o.op()==5&&o.type==4,r=e(vf(this.child)),n=this.child.optimized();return n==null?null:r&&!e(vf(n))||!n.maskNeedsSSAA()&&!this.maskNeedsSSAA()?n:n!=this.child?new t(n,this.flags):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let n=e;return this.child.equalsWithinBounds(n.child,r)}static thatShouldNotBeUnwrappedInOptimization(e){return new t(e,32)}},ua=class t extends Vr{op(){return 0}constructor(e,r,n){super(n??e.maxBounds,r|e.flags),this.child=e}computeBounds(e){return this.child.computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new t(e,this.flags)}equalsWithinBoundsImpl(e,r){let n=e;return this.flags==e.flags&&this.child.equalsWithinBounds(n.child,r)}static createForBackgroundBlur(e){return new t(e,6)}static createForGlass(e){return new t(e,192)}static createForRadialRepetition(e,r){return new t(e,e.flags,r)}};function MV(t,e){let r=new vt,n=L.fromRect(Jp(wt.FrozenAffineTransform_IDENTITY,e));for(let o of t){let i=n.clone();r.include3(o.transformRect(i))}return r.build()}function BV(t,e,r){let n=MV(e,r);return t.transformRect(n)}function GV(t,e){let r=new vt;for(let n of t){let o=L.fromRect(e.path().bounds());r.include3(n.transformRect(o))}return r.build()}function UV(t){let e=new Float32Array(t.length*6);for(let r=0,n=t.length;r<n;r++){let o=t[r],i=r*6;e[i+0]=o.m00(),e[i+1]=o.m01(),e[i+2]=o.m02(),e[i+3]=o.m10(),e[i+4]=o.m11(),e[i+5]=o.m12()}return new Uint8Array(e.buffer)}var e_=class t extends Vr{constructor(r,n,o,i){super(BV(r,i,n),xD([n]));this.instanceBuffer=null;this._accumFillGeometryPathBounds=[];this.transform=r,this.fillGeometries=n,this.paintSize=o,this.instanceTransforms=i}getAccumulatedFillGeometryPathBounds(){if(this._accumFillGeometryPathBounds.length)return this._accumFillGeometryPathBounds;for(let r of this.fillGeometries)this._accumFillGeometryPathBounds.push(GV(this.instanceTransforms,r));return this._accumFillGeometryPathBounds}getInstanceBuffer(r){return this.instanceBuffer!=null||this.instanceTransforms.length==0?this.instanceBuffer:(this.instanceBuffer=r.allocateInstanceBufferArea(UV(this.instanceTransforms)),this.instanceBuffer)}op(){return 16}geometryBounds(){return this.maxBounds}computeBounds(r){return this.maxBounds}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let r=[];for(let o of this.fillGeometries)if(Ce.containsAtLeastOneVisiblePaint(o.paints)){let i=o.optimized();r.push(i)}if(r.length==0)return null;if($t.FrozenList_equals(r,this.fillGeometries,(o,i)=>o.equals(i)))return this._isOptimized=!0,this;let n=new t(this.transform,r,this.paintSize,this.instanceTransforms);return n._isOptimized=!0,n}equalsWithinBoundsImpl(r,n){let o=r;return this.paintSize.equals(o.paintSize)&&this.transform.equals1(o.transform)&&$t.FrozenList_equals(this.fillGeometries,o.fillGeometries,(i,a)=>i.equals(a))&&$t.FrozenList_equals(this.instanceTransforms,o.instanceTransforms,(i,a)=>i.equals1(a))}},Xr=class t extends Vr{op(){return 3}constructor(e,r,n,o=null){super(kV(e,r),QV(r)),this.transform=e,this.geometry=r,this.paintSize=n,this.bgBlurExpansionForFrameFill=o}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}computeBounds(e){return this.maxBounds}withPaints(e){return new t(this.transform,this.geometry.withNewPaints(e),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Ce.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let e=this.geometry.optimized(),r=e.type==0,n=e.canBeAnalyticallyAntialiased();if(r&&!n&&!e.path().isRect()&&(Ce.hasAnimatingMediaPaints(e.paints)||Ce.hasVolatilePaints(e.paints))){let o=new t(this.transform,new Kt(e.path(),[$.createSolid(N.BLACK,1)]),this.paintSize),i=new t(this.transform,new Kt(Gt.getOrCreate(At.fromRect(e.path().bounds()),"ODD"),e.paints),this.paintSize);return new In(o,i).optimized()}return e==this.geometry?(this._isOptimized=!0,this):new t(this.transform,e,this.paintSize)}equalsWithinBoundsImpl(e,r){let n=e;return this.transform.equals1(n.transform)&&this.geometry.equals(n.geometry)&&this.paintSize.equals(n.paintSize)}static solidColorRect(e,r,n){let o=[$.createSolid(r,n)],i=Q.new2().translatedBy1(e.topLeft()).scaledBy1(e.size()),a=new Kt(Gt.UNIT_RECT(),o),s=Ae.FrozenVector_ZERO;return new t(i,a,s)}},xv=new Xr(Q.new2(),new Kt(new Gt(At.fromRoundedRect(new Na(0,new F(0,0),new F(4,4),2,0)),"NONZERO"),Ce.createFromSolidColor(N.new1(235,235,235),1)),new F(20,20)),Kd=class t extends Vr{op(){return 4}constructor(e,r,n,o,i){super(VV(e,r,n,i),xD([r,n])),this.mode=0,this.transform=e,this.fillGeometries=r,this.strokeGeometries=n,this.paintSize=o,this.mode=i}computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=[];for(let o=0,i=this.strokeGeometries.length;o<i;o=o+1){let a=this.strokeGeometries[o];Ce.containsAtLeastOneVisiblePaint(a.paints)&&e.push(a)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&e.length==0)return null;let r=o=>{let i=[];for(let a=0,s=o.length;a<s;a=a+1){let l=o[a];i.push(new Xr(this.transform,l,this.paintSize))}return Le.wrap(i).optimized()};return e.length==0?r(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:r(e):$t.FrozenList_equals(e,this.strokeGeometries,(o,i)=>o.equals(i))?(this._isOptimized=!0,this):new t(this.transform,this.fillGeometries,e,this.paintSize,this.mode).optimized()}equalsWithinBoundsImpl(e,r){let n=e;return this.transform.equals1(n.transform)&&$t.FrozenList_equals(this.fillGeometries,n.fillGeometries,(o,i)=>o.equals(i))&&$t.FrozenList_equals(this.strokeGeometries,n.strokeGeometries,(o,i)=>o.equals(i))&&this.paintSize.equals(n.paintSize)&&this.mode==n.mode}},In=class t extends Vr{constructor(){let e=arguments[0],r=arguments[1];if(arguments.length==5){let n=arguments[2];super(wv(e,r,n,null),PD(e,r,n)),this.alpha=e,this.color=r,this.type=n,this.innerShadowFill=arguments[3],this.innerShadowAlphaRequiresHardMask=arguments[4]}else arguments.length==2&&(super(wv(e,r,0,null),PD(e,r,0)),this.alpha=e,this.color=r,this.type=0,this.innerShadowFill=N.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1)}op(){return 5}computeBounds(e){return wv(this.alpha,this.color,this.type,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;let r=this.color.optimized(),n=this.type!=4,o=this.type!=4&&this.type!=2;if(r!=null&&n&&(r=t.cullGroupChildren(r,e.maxBounds)),r!=null&&o&&(e=t.cullGroupChildren(e,r.maxBounds),e==null))return null;switch(this.type){case 0:case 1:{if(r==null)return null;let i=!1,a=e;if(e.isAxisAlignedRectFill()){let s=L.new2();s.copyFrom(a.geometryBounds()),s.expand1(Gc),i=s.contains1(r.maxBounds)}else if(e.isAxisAlignedRoundedRectFill()){let l=a.geometry.path().path().asRoundedRectPath().radii(),c=L.new2();c.copyFrom(a.geometryBounds()),c.expand1(Gc);let d=Math.max(Math.max(l.topLeft,l.topRight),Math.max(l.bottomLeft,l.bottomRight)),u=Math.min(c.width()/2,c.height()/2);if(d<=u){let p=L.new2();if(p.copyFrom(a.geometryBounds()),p.expand1(Gc),p.contains1(r.maxBounds)){let h=r.maxBounds,g=h.left(),m=h.right(),A=h.top(),S=h.bottom(),T=new F(p.left()+l.topLeft,p.top()+l.topLeft),R=new F(p.right()-l.topRight,p.top()+l.topRight),b=new F(p.left()+l.bottomLeft,p.bottom()-l.bottomLeft),O=new F(p.right()-l.bottomRight,p.bottom()-l.bottomRight);(g>=T.x()||A>=T.y()||Math.sqrt(Math.pow(g-T.x(),2)+Math.pow(A-T.y(),2))<=l.topLeft)&&(m<=R.x()||A>=R.y()||Math.sqrt(Math.pow(m-R.x(),2)+Math.pow(A-R.y(),2))<=l.topRight)&&(g>=b.x()||S<=b.y()||Math.sqrt(Math.pow(g-b.x(),2)+Math.pow(S-b.y(),2))<=l.bottomLeft)&&(m<=O.x()||S<=O.y()||Math.sqrt(Math.pow(m-O.x(),2)+Math.pow(S-O.y(),2))<=l.bottomRight)&&(i=!0)}}}if(i){let s=a.geometry.paints;if((this.type===0||!U.getFeatureFlags().render_tree_luminance_mask_fix)&&Ce.containsAtLeastOneVisibleOpaquePaint(s))return r;let l=Ce.onlySolidPaintOrNull(s);if(l!=null)return new Fo("PASS_THROUGH",N.alphaF(l.color())*l.opacity(),r).optimized()}break}case 4:{if(r==null)return null;let i=e.maxBounds,a=r.maxBounds;if(!i.overlaps(a))return r;if(!e.hasVolatileContent()&&i.contains1(a))return null;break}case 2:{if(N.alpha(this.innerShadowFill)==0)return null;if(r==null&&e.op()==3&&!this.innerShadowAlphaRequiresHardMask){let i=e,a=i.geometry.paints,s=Ce.onlySolidPaintOrNull(a);if(s!=null)return i.withPaints([$.createSolid(N.multiplyOpacity(this.innerShadowFill,N.alphaF(s.color())),1)])}if(e.op()==9&&r!=null){let i=e;return new t(i.alpha,r,this.type,this.innerShadowFill,!0)}break}case 3:case 5:break}return e==this.alpha&&r==this.color?(this._isOptimized=!0,this):(r==null&&(r=new Le([])),new t(e,r,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equalsWithinBoundsImpl(e,r){let n=e;return this.type==n.type&&this.innerShadowFill==n.innerShadowFill&&this.alpha.equalsWithinBounds(n.alpha,r)&&this.color.equalsWithinBounds(n.color,r)}static createForInnerShadow(e,r,n){return new t(e,r,2,n,!1)}static createForBackgroundBlur(e,r){return new t(e,r,3,N.TRANSPARENT,!1)}static createForKnockoutShadow(e,r){return new t(e,r,4,N.TRANSPARENT,!1)}static createForLuminanceMask(e,r){return new t(e,r,1,N.TRANSPARENT,!1)}static createForPatternFill(e,r,n){var o;return new Zp(new Xr(e.transform,new Kt(e.geometry.path(),Ce.createFromSolidColor(N.BLACK,r.opacity())),e.paintSize),e,((o=r.patternSource())==null?void 0:o.renderTreeWithoutEffects(n))??xv)}static createForPatternStroke(e,r,n,o){var i;return new Zp(new Kd(r.transform,r.fillGeometries,r.strokeGeometries.map(a=>new Kt(a.path(),Ce.createFromSolidColor(N.BLACK,n.opacity()))),r.paintSize,r.mode),e,((i=n.patternSource())==null?void 0:i.renderTreeWithoutEffects(o))??xv)}static createForPatternScatterFill(e,r){var n;return new Zp(new e_(e.transform,e.fillGeometries.map(o=>new Kt(o.path(),Ce.createFromSolidColor(N.BLACK,o.paints[0].opacity()))),e.paintSize,e.instanceTransforms),e,((n=e.fillGeometries[0].paints[0].asSinglePaint().patternSource())==null?void 0:n.renderTreeWithoutEffects(r))??xv)}static cullGroupChildren(e,r){if(e!=null&&!e.maxBounds.overlaps(r))return null;if(e!=null&&e.op()==1){let n=e,o=n.children.length;for(let i=0;i<o;i=i+1)if(!n.children[i].maxBounds.overlaps(r)){let s=n.children.slice(0,i);for(;(i=i+1)<o;)n.children[i].maxBounds.overlaps(r)&&s.push(n.children[i]);return Le.wrap(s).optimized()}}return e}},Zp=class extends In{constructor(e,r,n){super(e,r,5,N.BLACK,!1),this.sourceRenderTree=n}equalsWithinBoundsImpl(e,r){if(!super.equalsWithinBoundsImpl(e,r))return!1;let n=e;return this.sourceRenderTree.equals(n.sourceRenderTree)}},fi=class t extends Vr{op(){return 9}constructor(e,r){super(N.alpha(r)>0?e.maxBounds:L.INVALID,YV(e)),this.alpha=e,this.color=r}computeBounds(e){return N.alpha(this.color)>0?this.alpha.currentBounds(e):L.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;if(e.op()==10){let n=e;return new mt(new t(n.child,this.color),n.id,n.property,n.getter).optimized()}e=bD(e,n=>(n.op()==7&&(n=n.child),n));let r=bD(e,n=>{if(n.op()==3){let o=n;if(!Ce.hasVolatilePaints(o.geometry.paints)&&!Ce.hasAnyFullyTransparentAreas(o.geometry.paints))return o.withPaints([$.createSolid(this.color,1)])}return n});return r!=e?r:e==this.alpha?(this._isOptimized=!0,this):e==null?null:new t(e,this.color)}equalsWithinBoundsImpl(e,r){let n=e;return this.color==n.color&&this.alpha.equalsWithinBounds(n.alpha,r)}},Yn=class t extends Vr{op(){return 6}constructor(e,r,n,o,i,a,s){super(qd(Math.max(r,n),a,null),Mv(a)),this.blurOpType=e,this.startRadius=r,this.endRadius=n,this.startPoint=o,this.endPoint=i,this.child=a,this.clamp=s}static createForStandardBlur(e,r,n){return new t("NORMAL",e,e,new F(0,0),new F(0,0),r,n)}static createForProgressiveBlur(e,r,n,o,i,a){return o.equals(n)?t.createForStandardBlur(r,i,a):new t("PROGRESSIVE",e,r,F.new(n),F.new(o),i,a)}hasInvertedStartAndEndPoints(){return this.blurOpType=="PROGRESSIVE"?this.startRadius>this.endRadius:!1}computeBounds(e){return qd(Math.max(this.startRadius,this.endRadius),this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.startRadius==0&&this.endRadius==0)return e;if(e.op()==10&&this.clamp.isInvalid()){let r=e;return new mt(new t(this.blurOpType,this.startRadius,this.endRadius,this.startPoint,this.endPoint,r.child,this.clamp),r.id,r.property,r.getter).optimized()}return e==this.child?(this._isOptimized=!0,this):new t(this.blurOpType,this.startRadius,this.endRadius,this.startPoint,this.endPoint,e,this.clamp)}equalsWithinBoundsImpl(e,r){let n=e;return this.blurOpType==n.blurOpType&&this.startRadius==n.startRadius&&this.endRadius==n.endRadius&&this.startPoint.equals(n.startPoint)&&this.endPoint.equals(n.endPoint)&&this.clamp.equals(n.clamp)&&this.child.equalsWithinBounds(n.child,r)}},Yd=class t extends Vr{op(){return 14}constructor(e,r,n,o,i,a,s){super(U.clipToShapeBoundsReducton()&&n?o.maxBounds:qd(e,o,null),Mv(o)),this.radius=e,this.noiseSize=r,this.clipToShape=n,this.child=o,this.nodeToCanvasSpaceTransform=i,this.centerPoint=a,this.seed=s}static createForGrain(e,r,n,o,i,a,s){return new t(e,F.new(r),n,o,i,F.new(a),s)}computeBounds(e){return qd(U.clipToShapeBoundsReducton()&&this.clipToShape?0:this.radius,this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new t(this.radius,this.noiseSize,this.clipToShape,e,this.nodeToCanvasSpaceTransform,this.centerPoint,this.seed)}equalsWithinBoundsImpl(e,r){let n=e;return this.radius==n.radius&&this.noiseSize.equals(n.noiseSize)&&this.clipToShape==n.clipToShape&&this.nodeToCanvasSpaceTransform.equals1(n.nodeToCanvasSpaceTransform)&&this.centerPoint.equals(n.centerPoint)&&this.seed==n.seed&&this.child.equalsWithinBounds(n.child,r)}},Qd=class t extends Vr{op(){return 15}constructor(e,r,n,o,i,a,s,l,c,d){super(CD(s,null),LD(r,s)),this.noiseType=e,this.blendMode=r,this.noiseSize=n,this.density=o,this.color=i,this.secondaryColor=a,this.child=s,this.nodeToCanvasSpaceTransform=l,this.nodeSpaceCenterPoint=c,this.seed=d}static createForNoise(e,r,n,o,i,a,s,l,c,d){return new t(e,r,n,o,i,a,s,l,c,d)}computeBounds(e){return CD(this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new t(this.noiseType,this.blendMode,this.noiseSize,this.density,this.color,this.secondaryColor,e,this.nodeToCanvasSpaceTransform,this.nodeSpaceCenterPoint,this.seed)}equalsWithinBoundsImpl(e,r){let n=e;return this.noiseType==n.noiseType&&this.blendMode==n.blendMode&&this.noiseSize.equals(n.noiseSize)&&this.density==n.density&&this.color==n.color&&this.secondaryColor==n.secondaryColor&&this.nodeToCanvasSpaceTransform.equals1(n.nodeToCanvasSpaceTransform)&&this.nodeSpaceCenterPoint.equals(n.nodeSpaceCenterPoint)&&this.seed==n.seed&&this.child.equalsWithinBounds(n.child,r)}},$p=class $p extends Vr{op(){return 17}constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h){super(qd(0,h,null),Mv(h)),this.blurRadius=Math.max(e,1),this.textureRadius=r,this.refractionIntensity=n,this.refractionDistance=o,this.lightIntensity=i,this.lightAngle=a,this.bevelSize=s,this.chromaticAberration=l,this.reflectionRadius=c,this.tintColor=d,this.cornerInfo=u,this.nodeToCanvasSpaceTransform=p,this.centerPoint=_,this.child=h}static createForGlassEffect(e,r,n,o,i,a,s,l,c,d,u,p,_,h){return new $p(e,r,n,o,i,a,s,l,c,d,u,p,_,h)}computeBounds(e){return qd(Math.max(this.blurRadius,this.textureRadius,this.reflectionRadius),this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new $p(this.blurRadius,this.textureRadius,this.refractionIntensity,this.refractionDistance,this.lightIntensity,this.lightAngle,this.bevelSize,this.chromaticAberration,this.reflectionRadius,this.tintColor,this.cornerInfo,this.nodeToCanvasSpaceTransform,this.centerPoint,e)}equalsWithinBoundsImpl(e,r){let n=e;return this.blurRadius==n.blurRadius&&this.textureRadius==n.textureRadius&&this.refractionIntensity==n.refractionIntensity&&this.refractionDistance==n.refractionDistance&&this.lightIntensity==n.lightIntensity&&this.lightAngle==n.lightAngle&&this.bevelSize==n.bevelSize&&this.chromaticAberration==n.chromaticAberration&&this.reflectionRadius==n.reflectionRadius&&this.tintColor==n.tintColor&&this.cornerInfo==n.cornerInfo&&this.nodeToCanvasSpaceTransform.equals1(n.nodeToCanvasSpaceTransform)&&this.centerPoint.equals(n.centerPoint)&&this.child.equalsWithinBounds(n.child,r)}};$p.CHROMATIC_EXPANSION_FACTOR=.2;var vl=$p,Fo=class t extends Vr{op(){return 7}constructor(e,r,n){super(r>0?n.maxBounds:L.INVALID,LD(e,n)),this.blendMode=e,this.opacity=r,this.child=n}computeBounds(e){return this.opacity>0?this.child.currentBounds(e):L.INVALID}optimized(){var n,o,i;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!e.hasNonIsolatedBlends()))return e;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&e.op()==3){let a=e,s=(n=Ce.onlyPaintOrNull(a.geometry.paints))==null?void 0:n.asSinglePaint();if(s!=null){let l=s.cloneAsSinglePaint();return l.setOpacity(l.opacity()*this.opacity),(i=(o=l.video())==null?void 0:o.getVideoManager())==null||i.clonePaintRegistration(s,l),a.withPaints([l])}}let r=this.opacity;if(e.op()==7){let a=e;this.blendMode==a.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(r=a.opacity*r,e=a.child)}return r==this.opacity&&e==this.child?(this._isOptimized=!0,this):new t(this.blendMode,r,e)}equalsWithinBoundsImpl(e,r){let n=e;return this.blendMode==n.blendMode&&this.opacity==n.opacity&&this.child.equalsWithinBounds(n.child,r)}},Vc=class extends Vr{op(){return 8}constructor(e,r){super(ND(e,null),e.flags),this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=e,this._tileCache=r}optimized(){return this._isOptimized=!0,this}computeBounds(e){return ND(this.tree,e)}equalsWithinBoundsImpl(e,r){let n=e;return this._tileCache==n._tileCache&&this.maxBounds.equals(n.maxBounds)&&this.tree.equalsWithinBounds(n.tree,r)}setDevicePixelPerCanvasPixel(e){this._devicePixelsPerCanvasPixel!=e&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=e)}numTilesNeededForBounds(e){let r=L.new3(e);r.intersectWith(this.maxBounds);let n=new F(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),o=this._tileCache.tileSize()/this._devicePixelsPerCanvasPixel,i=Math.floor((r.left()-n.x())/o)|0,a=Math.ceil((r.right()-n.x())/o)|0,s=Math.floor((r.top()-n.y())/o)|0,l=Math.ceil((r.bottom()-n.y())/o)|0;return(a-i)*(l-s)}forEachTileWithinBounds(e,r,n){if(!r.overlaps(this.maxBounds))return;let o=L.new3(r);o.intersectWith(this.maxBounds);let i=new F(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),a=this._tileCache.tileSize()/this._devicePixelsPerCanvasPixel,s=Math.floor((o.left()-i.x())/a)|0,l=Math.ceil((o.right()-i.x())/a)|0,c=Math.floor((o.top()-i.y())/a)|0,d=Math.ceil((o.bottom()-i.y())/a)|0,u=i.y()+c*a;for(let p=c;p<d;p=p+1,u+=a){let _=nr.IntMap_get(this._tiles,p,null);_==null&&(_=new Map,this._tiles.set(p,_));let h=i.x()+s*a;for(let g=s;g<l;g=g+1,h+=a){let m=nr.IntMap_get(_,g,null);if(m!=null){let T=m.value;T!=null&&n(T);continue}if(e==1)continue;let A=new L(h,u,a,a),S=this._tileCache.getOrInsertOrNull(this.tree,A);_.set(g,S!=null?new fe(S):null),S!=null&&n(S)}}}},cs=class t extends Vr{constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h,g){super(HV(e,o,l??0),e.flags|8),this.child=e,this.id=n,this.property=o,this.blurOpType=r,this.getter=i,this.getter1=a,this.canvasSpaceClamp=s,this.nodeToCanvasSpace=u??wt.FrozenAffineTransform_IDENTITY,this.clipToShape=d??!1,this.maxEffectRadius=l??0,this.noiseType=p??"MONOTONE",this.blendMode=_??"NORMAL",this.seed=h??0,this.cornerSmoothing=c??0,this.getter2=g??(()=>[])}static forGlass(e,r,n,o,i,a,s){return new t(e,"NORMAL",r,Kr.GLASS,n,o,L.INVALID,i,a,void 0,s)}static forProgressiveBlur(e,r,n,o,i,a){return new t(e,"PROGRESSIVE",r,Kr.BLUR,n,o,i,a)}static forBlur(e,r,n,o,i){return new t(e,"NORMAL",r,Kr.BLUR,n,()=>[],o,i)}static forGrain(e,r,n,o,i,a,s,l,c){return new t(e,"NORMAL",r,Kr.GRAIN,n,o,L.INVALID,a,0,c,s,void 0,void 0,l,i)}static forNoise(e,r,n,o,i,a,s,l,c){return new t(e,"NORMAL",r,Kr.NOISE,o,i,L.INVALID,0,0,void 0,l,n,a,s,c)}computeBounds(e){if(this.type()==Kr.NOISE||U.clipToShapeBoundsReducton()&&this.type()==Kr.GRAIN&&this.clipToShape)return L.new3(this.child.currentBounds(e));{let r=this.getter()[0];return this.type()==Kr.BLUR&&this.blurOpType=="PROGRESSIVE"&&(r=Math.max(r,this.getter()[1])),L.new3(this.child.currentBounds(e)).expandedBy1(r)}}grainRadius(){return this.getter()[0]}grainNoiseSize(){return this.getter1()[0]}getNodeToCanvasSpaceTransform(){return this.nodeToCanvasSpace}getNodeSpaceCenterPoint(){return this.getter2()[0]}startRadius(){return this.getter()[0]}endRadius(){return this.getter()[1]}hasInvertedStartAndEndPoints(){return this.startRadius()>this.endRadius()}getStartOffsetInCanvasSpace(){return this.getter1()[0]}getOffsetInCanvasSpace(){return this.getter1()[1]}getNoiseColor(){return this.getter()[0]}getSecondaryNoiseColor(){return this.getter()[1]}getNoiseDensity(){return this.getter1()[0]}getNoiseSize(){return this.getter1()[1]}glassCenterPoint(){return this.getter1()[0]}glassBlurRadius(){return this.getter()[0]}glassRefractionIntensity(){return this.getter()[1]}glassRefractionDistance(){return this.getter()[2]}glassSpecularIntensity(){return this.getter()[3]}glassSpecularAngle(){return this.getter()[4]}glassBevelSize(){return this.getter()[5]}glassChromaticAberration(){return this.getter()[6]}glassReflectionDistance(){return this.getter()[7]}glassTextureRadius(){return this.getter()[8]}glassCornerInfo(){return this.getter()[9]}glassTintColor(){return this.getter()[10]}type(){return this.property}op(){return 13}optimized(){return this}equalsWithinBoundsImpl(e,r){let n=e;return this.id==n.id&&this.property==n.property&&this.child.equalsWithinBounds(n.child,r)&&this.blurOpType==n.blurOpType&&this.getter()==n.getter()&&this.getter1()==n.getter1()&&this.canvasSpaceClamp.equals(n.canvasSpaceClamp)&&this.nodeToCanvasSpace.equals1(n.nodeToCanvasSpace)&&this.maxEffectRadius==n.maxEffectRadius&&this.seed==n.seed&&this.getter2()==n.getter2()}},mt=class t extends Vr{op(){return 10}constructor(e,r,n,o){super(zV(e,n),e.flags|8),this.child=e,this.id=r,this.property=n,this.getter=o}computeBounds(e){switch(this.property){case et.TRANSFORM:{let r=this.child.currentBounds(e).clone();return this.transform().transformRect(r),r}case et.TRANSFORM_ISOLATION:case et.MAX_TRANSFORM_SCALE:case et.OPACITY:case et.STATE_SWAP:return this.child.currentBounds(e);case et.INVERSE_TRANSFORM:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${Bc(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:e!=this.child?new t(e,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let n=e;return this.id==n.id&&this.property==n.property&&this.child.equals(n.child)}static forTranslation(e,r,n){let o=Q.new2();return t.forTransform(e,r,()=>(o.copyFrom(wt.FrozenAffineTransform_IDENTITY),o.translatedBy1(n())))}static forTransform(e,r,n){return new t(e,r,et.TRANSFORM,n)}static forOpacity(e,r,n){return new t(e,r,et.OPACITY,n)}static forTransformIsolation(e){let r="ID_FOR_TRANSFORM_ISOLATION";return new t(e,r,et.TRANSFORM_ISOLATION,null)}static forMaxTransformScale(e,r){let n=`ID_FOR_MAX_TRANSFORM_SCALE_${e}`;return new t(r,n,et.MAX_TRANSFORM_SCALE,()=>e)}static forInverseTransform(e){let r="ID_FOR_INVERSE_TRANSFORM";return new t(e,r,et.INVERSE_TRANSFORM,null)}static forStateSwap(e){let r="ID_FOR_STATE_SWAP";return new t(e,r,et.STATE_SWAP,null)}},so=class t extends Vr{op(){return 11}constructor(e,r){super(WV(e,r),e.flags),this.child=e,this.transform=r}computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:this.transform.equals1(wt.FrozenAffineTransform_IDENTITY)?e:e!=this.child?new t(e,this.transform):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let n=e;return this.transform.equals1(n.transform)&&this.child.equalsWithinBounds(n.child,r!=null?this.transform.inverse().transformRect(L.new3(r)):null)}},Qn=class extends Vr{op(){return 12}constructor(e,r,n,o){super(OD(e,r,null),(e!=null?e.flags:0)|(r!=null?r.flags:0)|8),this.startChild=e,this.endChild=r,this.id=n,this.progressFn=o}computeBounds(e){return OD(this.startChild,this.endChild,e)}progress(){return this.progressFn()}optimized(){var i;if(this._isOptimized)return this;let e=this.startChild!=null?this.startChild.optimized():null,r=this.endChild!=null?this.endChild.optimized():null,n=e!=null&&!e.maxBounds.isEmpty(),o=r!=null&&!r.maxBounds.isEmpty();if(!n&&!o)return null;if(n)if(o){if(this.endChild!=null&&((i=this.startChild)!=null&&i.equals(this.endChild)))return this.startChild}else return e!=null?new mt(e,this.id,et.OPACITY,()=>1-this.progressFn()):null;else return r!=null?new mt(r,this.id,et.OPACITY,()=>this.progressFn()):null;return this._isOptimized=!0,this}equalsWithinBoundsImpl(e,r){var a,s;let n=e;return!(this.id!=n.id||!(this.startChild==null&&n.startChild==null||n.startChild!=null&&((a=this.startChild)==null?void 0:a.equalsWithinBounds(n.startChild,r)))||!(this.endChild==null&&n.endChild==null||n.endChild!=null&&((s=this.endChild)==null?void 0:s.equalsWithinBounds(n.endChild,r))))}};function xD(t){let e=0;for(let r of t)for(let n=0,o=r.length;n<o;n=n+1)Ce.hasAnimatingMediaPaints(r[n].paints)&&(e|=16),Ce.hasVolatilePaints(r[n].paints)&&(e|=8);return e}function bD(t,e){if(t.op()==11){let r=t,n=e(r.child);return n==r.child?r:n!=null?new so(n,r.transform):null}else return e(t)}function vf(t){return t.op()==11?t.child:t}function wD(t){if(t.op()==11){let e=t;return new ao(e.child,e.transform)}else if(t.op()==10){let e=t;if(e.property==et.TRANSFORM)return new ao(e.child,e.transform())}return new ao(t,null)}function vD(t,e){let r=new vt;for(let n of t)r.include3(n.currentBounds(e));return r.isValid()?r.build():L.INVALID}function wv(t,e,r,n){if(r==2)return t.currentBounds(n);if(r==4)return e.currentBounds(n);if(Sd&&r==3)return t.currentBounds(n);let o=t.currentBounds(n).clone();return o.intersectWith(e.currentBounds(n)),o}function qd(t,e,r){if(e.currentBounds(r).isEmpty())return e.currentBounds(r);let n=e.currentBounds(r).clone();return n.expand1(t),n}function CD(t,e){return t.currentBounds(e)}function Jp(t,e){let r=new vt,n=!1;for(let i=0,a=e.length;i<a;i=i+1){let s=e[i];r.include3(s.maxBounds),s.canBeAnalyticallyAntialiased()&&(n=!0)}if(!r.isValid())return L.INVALID;let o=r.build();return t.transformRect(o),n&&o.expand1(4),o}function VV(t,e,r,n){if(n==0)return Jp(t,e);let o=new vt;return o.include3(Jp(t,e)),o.include3(Jp(t,r)),o.isValid()?o.build():L.INVALID}function kV(t,e){return Jp(t,[e])}function HV(t,e,r){if(r==0)return L.new3(t.maxBounds);switch(e){case Kr.BLUR:case Kr.GRAIN:case Kr.GLASS:return L.new3(t.maxBounds).expandedBy1(r);default:throw new Error("Unhandled property")}}function zV(t,e){switch(e){case et.TRANSFORM:case et.INVERSE_TRANSFORM:{let r=L.new2();return r.copyFrom(t.maxBounds),r.expandedBy1(1e6),r}case et.OPACITY:case et.MAX_TRANSFORM_SCALE:case et.TRANSFORM_ISOLATION:case et.STATE_SWAP:return t.maxBounds;default:throw new Error(`Unhandled property ${Bc(e)}`)}}function WV(t,e){return e.transformRect(L.new3(t.maxBounds))}function OD(t,e,r){let n=new vt;return t!=null&&n.include3(t.currentBounds(r)),e!=null&&n.include3(e.currentBounds(r)),n.build()}function ND(t,e){let r=t.currentBounds(e).clone();return r.expand1(1),r}function KV(t){let e=0;for(let r of t)e|=r.flags;return e}function PD(t,e,r){let n=t.flags&-2|e.flags;return r!=0&&r!=4&&r!=1&&(n&=-2),r==2&&(n|=32),n}function YV(t){return t.flags&-2|32}function Mv(t){return t.flags&-2}function LD(t,e){let r=e.flags;return t!="PASS_THROUGH"&&(r&=-2,r|=t!="NORMAL"?1:0),r}function QV(t){let e=0;return Ce.hasAnimatingMediaPaints(t.paints)&&(e|=16),(Ce.hasVolatilePaints(t.paints)||t.type==1)&&(e|=8),e}var Jo=class t{constructor(e,r,n,o){this.rectSize=e,this.cornerRadii=[...r],this.cornerSmoothings=[...n],this.constrainCornerValuesToRectSize(),this.cornerRadiiIndependent=o}bottomRightRadius(){return this.cornerRadii[0]}bottomLeftRadius(){return this.cornerRadii[1]}topLeftRadius(){return this.cornerRadii[2]}topRightRadius(){return this.cornerRadii[3]}static createZero(){return new t(new F(0,0),[0,0,0,0],[0,0,0,0],!0)}static createFromRadiiAndSize(e,r){return e.isUniform()?new t(r,[e.topLeft,e.topLeft,e.topLeft,e.topLeft],[0,0,0,0],!1):new t(r,[e.bottomRight,e.bottomLeft,e.topLeft,e.topRight],[0,0,0,0],!0)}static createFromNode(e){let r=e.roundedRectInfo(),n=new F(r.width(),r.height()),o=Mn.fromRoundedRect(r),i=r.cornerSmoothing();return o.isUniform()?new t(n,[o.topLeft,o.topLeft,o.topLeft,o.topLeft],[i,i,i,i],!1):new t(n,[o.bottomRight,o.bottomLeft,o.topLeft,o.topRight],[i,i,i,i],!0)}clampToMaxRefractionDistance(e){let r=this.topLeftRadius(),n=this.topRightRadius(),o=this.bottomLeftRadius(),i=this.bottomRightRadius(),a=Math.min(r,n)+(this.rectSize.y()-r-n),s=Math.min(i,o)+(this.rectSize.y()-i-o),l=Math.min(o,r)+(this.rectSize.x()-o-r),c=Math.min(i,n)+(this.rectSize.x()-i-n),d=Math.min(this.rectSize.x()*.5,this.rectSize.y()*.5),u=Math.min(d,e);return Math.min(u,Math.min(Math.min(a,s),Math.min(l,c)))}equals(e){return this.rectSize.equals(e.rectSize)&&this.cornerRadii.every((r,n)=>r===e.cornerRadii[n])&&this.cornerSmoothings.every((r,n)=>r===e.cornerSmoothings[n])}constrainCornerValuesToRectSize(){let e=this.cornerSmoothings[0],r=[...this.cornerRadii],n=[1,1,1,1];for(let o=0;o<4;++o){let i=(o+1)%4,a=o%2===0?this.rectSize.x():this.rectSize.y(),s=r[o]+r[i];n[o]=s>0&&s>a?a/s:1}for(let o=0;o<4;++o)this.cornerRadii[o]=r[o]*Math.min(n[o],n[(o+3)%4]);for(let o=0;o<4;++o){let i=(o+1)%4,a=o%2===0?this.rectSize.x():this.rectSize.y(),s=this.cornerRadii[o],l=this.cornerRadii[i],c=s*(1+e),d=l*(1+e),u=Math.max(0,c+d-a)*.5;this.cornerSmoothings[o]=Math.min(this.cornerSmoothings[o],Math.max(0,this.cornerSmoothings[o]-u/s)),this.cornerSmoothings[i]=Math.min(this.cornerSmoothings[i],Math.max(0,this.cornerSmoothings[i]-u/l))}}};var Oe=class t{asVolatileEffect(){return null}isVolatile(){return!1}blendMode(){return this._blendMode}color(){return this._color}secondaryColor(){return this._secondaryColor}blurOffset(){return this._blurOffset}blurStartOffset(){return this._blurStartOffset}blurEndOffset(){return this._blurEndOffset}blurStartRadius(){return this._blurStartRadius}blurRadius(){return this._blurRadius}noiseSize(){return this._noiseSize}clipToShape(){return this._clipToShape}blurOpType(){return this._blurOpType}spread(){return this._spread}density(){return this._density}noiseType(){return this._noiseType}isEnabled(){return this._isEnabled}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}effectOpacity(){return this._effectOpacity}seed(){return this._seed}refractionIntensity(){return this._refractionIntensity}refractionDistance(){return this._refractionDistance}specularAngle(){return this._specularAngle}specularIntensity(){return this._specularIntensity}chromaticAberration(){return this._chromaticAberration}reflectionDistance(){return this._reflectionDistance}bevelSize(){return this._bevelSize}cornerInfo(){return this._cornerInfo}setBlendMode(e){this._blendMode=e}setBlurOpType(e){this._blurOpType=e}setColor(e){this._color=e}setSecondaryColor(e){this._secondaryColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurStartOffset(e){this._blurStartOffset=e}setBlurStartOffset1(e){this._blurStartOffset=e.clone()}setBlurEndOffset(e){this._blurEndOffset=e}setBlurEndOffset1(e){this._blurEndOffset=e.clone()}setBlurStartRadius(e){this._blurStartRadius=e}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setNoiseSize(e){this._noiseSize=e}setDensity(e){this._density=e}setNoiseType(e){this._noiseType=e}setClipToShape(e){this._clipToShape=e}setEffectOpacity(e){this._effectOpacity=e}setSeed(e){this._seed=e}setType(e){this._type=e}setRefractionIntensity(e){this._refractionIntensity=e}setRefractionDistance(e){this._refractionDistance=e}setSpecularAngle(e){this._specularAngle=e}setSpecularIntensity(e){this._specularIntensity=e}setChromaticAberration(e){this._chromaticAberration=e}setReflectionDistance(e){this._reflectionDistance=e}setBevelSize(e){this._bevelSize=e}setCornerInfo(e){this._cornerInfo=e}dependsOnBackgroundContent(){return this.type()==="BACKGROUND_BLUR"||this.type()==="GLASS"}clone(){let e=new t;return e.setBlendMode(this.blendMode()),e.setColor(this.color()),e.setSecondaryColor(this.secondaryColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurStartOffset1(this.blurStartOffset().clone()),e.setBlurEndOffset1(this.blurEndOffset().clone()),e.setBlurStartRadius(this.blurStartRadius()),e.setBlurRadius(this.blurRadius()),e.setBlurOpType(this.blurOpType()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setNoiseSize(this.noiseSize().clone()),e.setDensity(this.density()),e.setNoiseType(this.noiseType()),e.setType(this.type()),e.setNoiseSize(this.noiseSize()),e.setClipToShape(this.clipToShape()),e.setEffectOpacity(this.effectOpacity()),e.setSeed(this.seed()),e.setRefractionIntensity(this.refractionIntensity()),e.setRefractionDistance(this.refractionDistance()),e.setSpecularAngle(this.specularAngle()),e.setSpecularIntensity(this.specularIntensity()),e.setChromaticAberration(this.chromaticAberration()),e.setReflectionDistance(this.reflectionDistance()),e.setBevelSize(this.bevelSize()),e.setCornerInfo(this.cornerInfo()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&N.alpha(this.color())>0;case"INNER_SHADOW":return this.isEnabled()&&N.alpha(this.color())>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":case"FOREGROUND_BLUR":return this.isEnabled()&&(this.blurRadius()>0||this.blurStartRadius()>0);case"GRAIN":return this.isEnabled()&&this.blurRadius()>0;case"NOISE":return this.isEnabled();case"GLASS":return this.isEnabled()}return!1}isEnabledAndVisible(){return this.isEnabled()&&N.alpha(this.color())>0}equalsWithinEffectType(e){if(this.isEnabled()!=e.isEnabled()||this.type()!=e.type())return!1;switch(this.type()){case"INNER_SHADOW":return this.blendMode()==e.blendMode()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.color()==e.color()&&this.spread()==e.spread();case"DROP_SHADOW":return this.blendMode()==e.blendMode()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.color()==e.color()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode();case"FOREGROUND_BLUR":case"BACKGROUND_BLUR":if(this.blurOpType()!=e.blurOpType())return!1;if(this.blurOpType()==="NORMAL")return this.blurRadius()==e.blurRadius()&&e.blurOpType()==="NORMAL";if(this.blurOpType()=="PROGRESSIVE")return e.blurOpType()==="PROGRESSIVE"&&this.blurStartRadius()==e.blurStartRadius()&&this.blurRadius()==e.blurRadius()&&this.blurStartOffset().equals(e.blurStartOffset())&&this.blurEndOffset().equals(e.blurEndOffset());case"GRAIN":return this.noiseSize().equals(e.noiseSize())&&this.clipToShape()==e.clipToShape()&&this.blurRadius()==e.blurRadius()&&this.seed()==e.seed();case"NOISE":return this.noiseSize().equals(e.noiseSize())&&this.noiseType()==e.noiseType()&&this.blendMode()==e.blendMode()&&this.density()==e.density()&&this.color()==e.color()&&this.secondaryColor()==e.secondaryColor()&&this.seed()==e.seed();case"REPEAT":case"SYMMETRY":return!1;case"GLASS":return this.reflectionDistance()==e.reflectionDistance()&&this.refractionIntensity()==e.refractionIntensity()&&this.refractionDistance()==e.refractionDistance()&&this.specularIntensity()==e.specularIntensity()&&this.specularAngle()==e.specularAngle()&&this.bevelSize()==e.bevelSize()&&this.chromaticAberration()==e.chromaticAberration()&&this.blurRadius()==e.blurRadius()&&this.secondaryColor()==e.secondaryColor()}return!1}static createForegroundBlur(e,r,n,o){let i=new t;return i.setType("FOREGROUND_BLUR"),i.setBlurRadius(e),r!==void 0&&i.setBlurStartRadius(r),n!==void 0&&i.setBlurEndOffset1(n),o!==void 0&&i.setBlurStartOffset1(o),i}static createBackgroundBlur(e,r,n,o){let i=new t;return i.setType("BACKGROUND_BLUR"),i.setBlurRadius(e),r!==void 0&&i.setBlurStartRadius(r),n!==void 0&&i.setBlurEndOffset1(n),o!==void 0&&i.setBlurStartOffset1(o),i}static createInnerShadow(e,r,n,o){let i=new t;return i.setType("INNER_SHADOW"),i.setBlurRadius(e),i.setBlurOffset(r),i.setColor(N.withAlpha(n,Math.ceil(o*255))),i}static createDropShadow(e,r,n,o,i=0,a=!0){let s=new t;return s.setType("DROP_SHADOW"),s.setBlurRadius(e),s.setBlurOffset(r),s.setColor(N.multiplyOpacity(n,o)),s.setSpread(i),s.setShowShadowBehindNode(a),s}static createGrain(e,r,n,o){let i=new t;return i.setType("GRAIN"),i.setNoiseSize(e),i.setClipToShape(r),i.setBlurRadius(n),i.setSeed(o),i}static createNoise(e,r,n,o,i,a,s,l){let c=new t;return c.setType("NOISE"),c.setNoiseType(e),c.setBlendMode(r),c.setNoiseSize(n),c.setDensity(o),c.setColor(N.multiplyOpacity(i,s)),c.setSecondaryColor(N.multiplyOpacity(a,s)),c.setSeed(l),c}constructor(){this._blendMode="NORMAL",this._color=N.TRANSPARENT,this._blurOffset=Ae.FrozenVector_ZERO,this._blurRadius=0,this._blurStartRadius=0,this._blurStartOffset=Ae.FrozenVector_ZERO,this._blurEndOffset=Ae.FrozenVector_ZERO,this._spread=0,this._isEnabled=!0,this._showShadowBehindNode=!1,this._noiseType="MONOTONE",this._noiseSize=Ae.FrozenVector_ZERO,this._clipToShape=!1,this._type="DROP_SHADOW",this._blurOpType="NORMAL",this._seed=0,this._refractionIntensity=0,this._refractionDistance=0,this._specularAngle=0,this._specularIntensity=0,this._chromaticAberration=0,this._reflectionDistance=0,this._bevelSize=0,this._cornerInfo=Jo.createZero()}},Of=class t extends Oe{constructor(e,r,n,o,i,a,s,l,c){super(),this._from=null,this._to=null,this._getEasedT=null,this._from=e,this._to=r,this._fromSize=n,this._toSize=o,this._fromCornerRadii=i,this._toCornerRadii=a,this._fromRectangleSize=s,this._toRectangleSize=l,this._getEasedT=c}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}fromNodeSize(){return this._fromSize}toNodeSize(){return this._toSize}textureRadius(){return 0}centerPoint(){return F.lerp(this.fromNodeSize().divideScalar(2),this.toNodeSize().divideScalar(2),this.t())}blurRadius(){return Ye.double_lerp(this.from().blurRadius(),this.to().blurRadius(),this.t())}blurStartRadius(){return Ye.double_lerp(this.from().blurStartRadius(),this.to().blurStartRadius(),this.t())}blurEndOffsetInCanvasSpace(e,r){return F.lerp(e,r,this.t())}blurStartOffsetInCanvasSpace(e,r){return F.lerp(e,r,this.t())}blurEndOffset(){return F.lerp(this.from().blurEndOffset(),this.to().blurEndOffset(),this.t())}blurStartOffset(){return F.lerp(this.from().blurStartOffset(),this.to().blurStartOffset(),this.t())}blurOpType(){return this.from().blurOpType()}noiseSize(){return F.lerp(this.from().noiseSize(),this.to().noiseSize(),this.t())}seed(){return this.from().seed()}refractionIntensity(){return Ye.double_lerp(this.from().refractionIntensity(),this.to().refractionIntensity(),this.t())}refractionDistance(){return Ye.double_lerp(this.from().refractionDistance(),this.to().refractionDistance(),this.t())}specularIntensity(){return Ye.double_lerp(this.from().specularIntensity(),this.to().specularIntensity(),this.t())}specularAngle(){return Ye.double_lerp(this.from().specularAngle(),this.to().specularAngle(),this.t())}bevelSize(){return Ye.double_lerp(this.from().bevelSize(),this.to().bevelSize(),this.t())}cornerInfo(){if(this._fromCornerRadii.equals(Mn.ZEROS)&&this._toCornerRadii.equals(Mn.ZEROS)&&this._fromRectangleSize==null)return;let e=this._fromCornerRadii.toList(),r=this._toCornerRadii.toList(),n=[];for(let i=0;i<4;i=i+1)n.push(Ye.double_lerp(e[i],r[i],this.t()));return Jo.createFromRadiiAndSize(Mn.fromList(n),new F(this._fromRectangleSize.x(),this._fromRectangleSize.y()))}chromaticAberration(){return Ye.double_lerp(this.from().chromaticAberration(),this.to().chromaticAberration(),this.t())}reflectionDistance(){return Ye.double_lerp(this.from().reflectionDistance(),this.to().reflectionDistance(),this.t())}noiseType(){return this.from().noiseType()}density(){return Ye.double_lerp(this.from().density(),this.to().density(),this.t())}clipToShape(){return this.from().clipToShape()}isVolatile(){return!0}asVolatileEffect(){return this}cloneAsVolatileEffect(){return new t(this._from.clone(),this._to.clone(),this._fromSize,this._toSize,this._fromCornerRadii,this._toCornerRadii,this._toRectangleSize,this._fromRectangleSize,this._getEasedT)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(N.alpha(this._from.color())>0||N.alpha(this._to.color())>0)}type(){return this._from.type()}blendMode(){return this._from.blendMode()}color(){let e=this._from.color(),r=this._to.color();return this.noiseType()==="MULTITONE"&&(e=N.new3(N.redF(e),N.greenF(e),N.blueF(e),this._from.effectOpacity()),r=N.new3(N.redF(r),N.greenF(r),N.blueF(r),this._to.effectOpacity())),N.mix(e,r,this.t())}secondaryColor(){return N.mix(this._from.secondaryColor(),this._to.secondaryColor(),this.t())}static create(e,r,n,o,i,a,s,l,c){return new t(e,r,n,o,i,a,s,l,c)}};var Nf=class t{constructor(){this._type="REPEAT",this._offset=Ae.FrozenVector_ZERO,this._visible=!0}type(){return this._type}offset(){return this._offset}count(){return this._count}repeatType(){return this._repeatType}axis(){return this._axis}unitType(){return this._unitType}order(){return this._order}skewX(){return this._skewX}skewY(){return this._skewY}visible(){return this._visible}setType(e){this._type=e}setOffset(e){this._offset=e}setCount(e){this._count=e}setRepeatType(e){this._repeatType=e}setAxis(e){this._axis=e}setUnitType(e){this._unitType=e}setOrder(e){this._order=e}setSkewX(e){this._skewX=e}setSkewY(e){this._skewY=e}setVisible(e){this._visible=e}shouldRender(){if(!this._visible)return!1;switch(this._type){case"REPEAT":return this._count!==void 0&&this._count>1&&this._repeatType!==void 0;case"SYMMETRY":return this._axis!==void 0;case"SKEW":return this._skewX!==void 0||this._skewY!==void 0}}isRepeat(){return this._type==="REPEAT"}isVisibleForRendering(){return this.type()==="REPEAT"?this.visible():(this.type()==="SYMMETRY"||this.type()==="SKEW",!1)}clone(){let e=new t;return e.setType(this.type()),e.setOffset(this.offset().clone()),e.setCount(this.count()),e.setRepeatType(this.repeatType()),e.setAxis(this.axis()),e.setUnitType(this.unitType()),e.setOrder(this.order()),e.setSkewX(this.skewX()),e.setSkewY(this.skewY()),e.setVisible(this.visible()),e}equals(e){return this.type()===e.type()&&this.offset().equals(e.offset())&&this.count()===e.count()&&this.repeatType()===e.repeatType()&&this.axis()===e.axis()&&this.unitType()===e.unitType()&&this.order()===e.order()&&this.skewX()===e.skewX()&&this.skewY()===e.skewY()&&this.visible()===e.visible()}absoluteTransformForRepeatIteration(e,r,n){if(!(!this.isRepeat()||!this._repeatType))switch(this._repeatType){case"LINEAR":return this.calculateLinearTransform(e,r,n,!0);case"RADIAL":return this.calculateRadialTransform(e,r,n,!0)}}relativeTransformForRepeatIteration(e,r,n){if(!(!this.isRepeat()||!this._repeatType))switch(this._repeatType){case"LINEAR":return this.calculateLinearTransform(e,r,n,!1);case"RADIAL":return this.calculateRadialTransform(e,r,n,!1)}}calculateLinearTransform(e,r,n,o){let a=this.calculateSpacing(r).multiplyScalar(e),s=Q.new2();return s.translate2(a.x(),a.y()),o?(n.multiply(s),n):s}calculateRadialTransform(e,r,n,o){if(!this._count)return Q.new2();let i=r.center(),a=Math.PI*2/this._count,s=e*a,l=Q.new2();return l.translate2(i.x(),i.y()),l.rotate(s),l.translate2(-i.x(),-i.y()),o?(n.multiply(l),n):l}calculateSpacing(e){if(!this._unitType||!this._axis)return new F(this._offset.x(),this._offset.y());let r=this._offset.x(),n=this._offset.y();switch(this._unitType==="RELATIVE"&&(r=e.width()*r,n=e.height()*r),this._axis){case"X":n=0;break;case"Y":r=0;break;case"X_AND_Y":break}return new F(r,n)}};var Ua=class{constructor(e,r){e.push(this),this._value=-1,this._needsLogInHistogramBatch=!1,this._needsLogInSlowFrameTracker=!1,this._stringName=r}getStringName(){return this._stringName}setValueForFutureLog(e){this._value=e?1:0,this._needsLogInHistogramBatch=!0,this._needsLogInSlowFrameTracker=!0}getAndClearHistogramBatchValue(){return this._needsLogInHistogramBatch?(this._needsLogInHistogramBatch=!1,this._value):-1}getAndClearSlowFrameTrackerValue(){return this._needsLogInSlowFrameTracker?(this._needsLogInSlowFrameTracker=!1,this._value):-1}},Cn=class Cn{static didDisablePrerenderingOnOngoingTransition(e){this.disablePrerenderingOnOngoingTransition.setValueForFutureLog(e)}static didEncounterIntraTileInterrupt(){this.encounteredIntraTileInterrupt.setValueForFutureLog(!0)}static didUseUnifiedRendererMaterial(e){this.usedUnifiedRendererMaterial.setValueForFutureLog(e)}static didEncounterPatternPaint(){this.encounteredPatternPaint.setValueForFutureLog(!0)}static didEncounterBlur(e){this.encounteredBlur.setValueForFutureLog(e)}static didEncounterTextureEffect(e){this.encounteredTextureEffect.setValueForFutureLog(e)}static didEncounterNoiseEffect(){this.encounteredNoiseEffect.setValueForFutureLog(!0)}static didEncounterGlassEffect(){this.encounteredGlassEffect.setValueForFutureLog(!0)}static didEncounterNonAxisAlignedTransform(e){this.nonAATransform.setValueForFutureLog(e)}static getAndClearHistogramBatchFields(){let e=new Map;for(let r of this.allTrackedExposureLogs){let n=r.getAndClearHistogramBatchValue();n!=-1&&e.set(r.getStringName(),n===1)}return e}static getAndClearSlowFrameTrackerFields(){let e=new Map;for(let r of this.allTrackedExposureLogs){let n=r.getAndClearSlowFrameTrackerValue();n!=-1&&e.set(r.getStringName(),n===1)}return e}static clearAllSlowFrameTrackerFields(){for(let e of this.allTrackedExposureLogs)e.getAndClearSlowFrameTrackerValue()}};Cn.allTrackedExposureLogs=[],Cn.encounteredIntraTileInterrupt=new Ua(Cn.allTrackedExposureLogs,"intraTile"),Cn.usedUnifiedRendererMaterial=new Ua(Cn.allTrackedExposureLogs,"veruMaterial"),Cn.disablePrerenderingOnOngoingTransition=new Ua(Cn.allTrackedExposureLogs,"disablePrerenderingForTransition"),Cn.encounteredPatternPaint=new Ua(Cn.allTrackedExposureLogs,"patternPaint"),Cn.encounteredBlur=new Ua(Cn.allTrackedExposureLogs,"blur"),Cn.encounteredTextureEffect=new Ua(Cn.allTrackedExposureLogs,"textureEffect"),Cn.encounteredNoiseEffect=new Ua(Cn.allTrackedExposureLogs,"noiseEffect"),Cn.encounteredGlassEffect=new Ua(Cn.allTrackedExposureLogs,"glassEffect"),Cn.nonAATransform=new Ua(Cn.allTrackedExposureLogs,"nonAATransform");var rt=Cn;var Cl;(r=>(r.ELLIPSE=0,r.ROUNDED_RECT=1))(Cl||(Cl={}));var Ot=t=>({x:t.x(),y:t.y()}),pa=t=>new F(t.x,t.y),ft=t=>({min:{x:t.topLeft().x(),y:t.topLeft().y()},max:{x:t.bottomRight().x(),y:t.bottomRight().y()}}),MD=t=>({origin:{x:t.x(),y:t.y()},size:{x:t.width(),y:t.height()}}),$e=t=>({m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12()}),ds=t=>new Q(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12);var Bv=(t,e,r)=>{var n;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(n=v().modules().wasmRendererBindings)==null||n.bindLoopBlinnUniforms($e(r)):ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r)},BD=(t,e,r)=>{var n;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(n=v().modules().wasmRendererBindings)==null||n.bindSmoothPathUniforms($e(r)):ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r)},GD=(t,e,r)=>{var n;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let o={m00:r.m00(),m01:r.m01(),m02:r.m02(),m10:r.m10(),m11:r.m11(),m12:r.m12()};(n=v().modules().wasmRendererBindings)==null||n.bindSolidColorPaintForStencilUniforms(o)}else ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r)},Xd=(t,e,r,n,o)=>{var i;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(i=v().modules().wasmRendererBindings)==null||i.bindSolidColorPaintUniforms($e(r),o,N.toColorF(n)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,n),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,o))},Gv=(t,e,r,n,o,i,a)=>{var s,l;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((s=v().modules().wasmRendererBindings)==null||s.bindGradientPaintUniforms($e(r),$e(n),o,i),a.texture(),(l=v().modules().wasmRendererBindings)==null||l.bindTextureSamplers(a.handle(),0,0)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,r),t.setUniformInt(e.SHADER_NAME_U_TYPE,o),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,i),a.setFormat(Fe.RGBA_LINEAR_CLAMP),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,a,0))},Uv=(t,e,r,n,o,i,a,s,l)=>{var c,d;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((c=v().modules().wasmRendererBindings)==null||c.bindLerpGradientPaintUniforms($e(r),$e(n),o,i,a),s.texture(),l.texture(),(d=v().modules().wasmRendererBindings)==null||d.bindTextureSamplers(s.handle(),l.handle(),0)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,r),t.setUniformInt(e.SHADER_NAME_U_TYPE,o),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,i),s.setFormat(Fe.RGBA_LINEAR_CLAMP),l.setFormat(Fe.RGBA_LINEAR_CLAMP),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,s,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,l,1),t.setUniformFloat(e.SHADER_NAME_U_PROGRESS,a))},UD=(t,e,r,n,o,i,a)=>{var s,l;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((s=v().modules().wasmRendererBindings)==null||s.bindLerpTextureUniforms(ft(o),ft(i),a),(l=v().modules().wasmRendererBindings)==null||l.bindTextureSamplers(r.handle(),n.handle(),0)):(t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n,1),ye.Material_setUniformVec43(t,e.SHADER_NAME_TEXTURE0_UV_SPACE_SCISSOR,o),ye.Material_setUniformVec43(t,e.SHADER_NAME_TEXTURE1_UV_SPACE_SCISSOR,i),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,a))},Vv=(t,e,r,n,o,i,a,s,l,c)=>{var d,u;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((d=v().modules().wasmRendererBindings)==null||d.bindLerpImageUniforms($e(r),$e(n),$e(o),s,l,c?1:0,c?0:1),i.texture(),a.texture(),(u=v().modules().wasmRendererBindings)==null||u.bindTextureSamplers(i.handle(),a.handle(),0)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM1,o),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s),t.setUniformFloat(e.SHADER_NAME_U_PROGRESS,l),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,i,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,a,1),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,c?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,c?0:1))},kv=(t,e,r,n,o,i,a,s,l,c,d)=>{var u,p;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let _=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().tint:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().tint:0,c.t()),-1,1),h=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().vibrance:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().vibrance:0,c.t()),-1,1),g=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().shadows:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().shadows:0,c.t()),-1,1),m=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().highlights:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().highlights:0,c.t()),-1,1),A=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().exposure:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().exposure:0,c.t()),-1,1),S=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().contrast:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().contrast:0,c.t()),-.3,.3),T=Ye.double_clamp(Ye.double_lerp(c.from().filterColorAdjust()!=null?c.from().filterColorAdjust().temperature:0,c.to().filterColorAdjust()!=null?c.to().filterColorAdjust().temperature:0,c.t()),-1,1);(u=v().modules().wasmRendererBindings)==null||u.bindLerpImageColorAdjustUniforms($e(r),$e(n),$e(o),s,l,_,h,g,m,A,S,T,d?1:0,d?0:1),i.texture(),a.texture(),(p=v().modules().wasmRendererBindings)==null||p.bindTextureSamplers(i.handle(),a.handle(),0)}else ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM1,o),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s),t.setUniformFloat(e.SHADER_NAME_U_PROGRESS,l),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,i,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,a,1),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,d?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,d?0:1),c.colorAdjustSetData(t)},Hv=(t,e,r,n,o,i,a,s)=>{var l,c;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let d=a.filterColorAdjust(),u=d?d.tint:0,p=d?d.vibrance:0,_=d?d.shadows:0,h=d?d.highlights:0,g=d?d.exposure:0,m=d?d.contrast:0,A=d?d.temperature:0;(l=v().modules().wasmRendererBindings)==null||l.bindImageColorAdjustPaintViewerUniforms($e(r),$e(n),i,s?1:0,s?0:1,u,p,_,h,g,m,A),o.texture(),(c=v().modules().wasmRendererBindings)==null||c.bindTextureSamplers(o.handle(),0,0)}else ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,n),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,o,0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,s?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,s?0:1),a.colorAdjustSetData(t)},jd=(t,e,r,n,o,i,a)=>{var s,l;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((s=v().modules().wasmRendererBindings)==null||s.bindImagePaintViewerUniforms($e(r),$e(n),i,a?1:0,a?0:1),o.texture(),(l=v().modules().wasmRendererBindings)==null||l.bindTextureSamplers(o.handle(),0,0)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,n),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,o,0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,a?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,a?0:1))},VD=(t,e,r,n,o,i,a,s,l,c,d)=>{var u,p;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(d.texture(),(u=v().modules().wasmRendererBindings)==null||u.bindTextureSamplers(d.handle(),0,0),(p=v().modules().wasmRendererBindings)==null||p.bindImagePaintPatternUniforms($e(r),$e(n),Ot(o),Ot(i),a,Ot(s),Ot(l),c)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,r),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,n),ye.Material_setUniformVec22(t,e.SHADER_NAME_PATTERN_BOUNDS_OFFSET_PIXELS,i),ye.Material_setUniformVec22(t,e.SHADER_NAME_PATTERN_TEX_SIZE_PIXELS,o),t.setUniformFloat(e.SHADER_NAME_TILE_SIZE_PIXELS,a),ye.Material_setUniformVec22(t,e.SHADER_NAME_FILL_SIZE_PIXELS,s),ye.Material_setUniformVec22(t,e.SHADER_NAME_OFFSET_PIXELS,l),t.setUniformInt(e.SHADER_NAME_PATTERN_TILE_TYPE,c),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,d,0))},kD=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(o.texture(),(i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(o.handle(),0,0),(a=v().modules().wasmRendererBindings)==null||a.bindImagePatternSingleUniforms($e(r),$e(n))):(ye.Material_setUniformMat32(t,e.SHADER_NAME_PAINT_TRANSFORM,r),ye.Material_setUniformMat32(t,e.SHADER_NAME_VERTEX_TRANSFORM,n),o.texture(),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,o,0))},HD=(t,e,r,n)=>{var o,i;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((o=v().modules().wasmRendererBindings)==null||o.bindDeviceFrameUniforms($e(r)),n.texture(),(i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(n.handle(),0,0)):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,n,0))},zD=(t,e,r,n,o,i,a,s)=>{var l,c;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((l=v().modules().wasmRendererBindings)==null||l.bindDrawTextureUniforms(ft(n),ft(o??n),ft(i),$e(a),s),(c=v().modules().wasmRendererBindings)==null||c.bindTextureSamplers(r.handle(),0,0)):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_UV_SPACE_CLAMPING_RECT,o??n),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_UV_SPACE_SOURCE_RECT,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_TO_CLIP_SPACE_TRANSFORM,a),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_DESTINATION_RECT,i),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r,0))},WD=(t,e,r,n)=>{var o,i;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((o=v().modules().wasmRendererBindings)==null||o.bindSuperSSAADownsampleUniforms(r,1),(i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(n.handle(),0,0)):(t.setUniformInt(e.SHADER_NAME_TILE_ATLAS_TILE_SIZE,r),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,1),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,n,0))},KD=(t,e,r)=>{var n,o;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((n=v().modules().wasmRendererBindings)==null||n.bindBlendTextureUniforms(1),(o=v().modules().wasmRendererBindings)==null||o.bindTextureSamplers(r.handle(),0,0)):(t.setUniformFloat(e.SHADER_NAME_U_OPACITY,1),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r,0))},kc=(t,e,r,n)=>{if(t.setUniformVec21(e.SHADER_NAME_U_UV_SCALE,n.x(),n.y()),ye.Material_setUniformVec22(t,e.SHADER_NAME_U_PATH_SIZE,r.bounds().size()),r instanceof En){let o=r;t.setUniformInt(e.SHADER_NAME_U_SHAPE_TYPE,Cl.ELLIPSE),ye.Material_setUniformVec22(t,e.SHADER_NAME_U_ELLIPSE_CENTER,o.center.subtract(o.bounds().topLeft())),t.setUniformVec21(e.SHADER_NAME_U_ELLIPSE_RADII,o.xRadius,o.yRadius)}else if(r instanceof At){let o=r;t.setUniformInt(e.SHADER_NAME_U_SHAPE_TYPE,Cl.ROUNDED_RECT),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_RECT,r.bounds().translatedBy(r.bounds().topLeft())),t.setUniformVec41(e.SHADER_NAME_U_CORNER_RADII,Math.max(o.radii().topLeft,0),Math.max(o.radii().topRight,0),Math.max(o.radii().bottomRight,0),Math.max(o.radii().bottomLeft,0))}else throw new Error("Unxpected path type")},YD=(t,e,r,n,o,i)=>{var a,s,l;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer())if((a=v().modules().wasmRendererBindings)==null||a.bindTextureSamplers(0,0,0),r instanceof En){let c=r;(s=v().modules().wasmRendererBindings)==null||s.bindAAAEllipseSolidColorUniforms({x:c.xRadius,y:c.yRadius},Ot(c.center.subtract(c.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),N.toColorF(i.color()),i.opacity())}else if(r instanceof At){let c=r;(l=v().modules().wasmRendererBindings)==null||l.bindAAARoundedRectSolidColorUniforms(Math.max(c.radii().topLeft,0),Math.max(c.radii().topRight,0),Math.max(c.radii().bottomRight,0),Math.max(c.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),N.toColorF(i.color()),i.opacity())}else throw new Error("Unxpected path type");else kc(t,e,r,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,o),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,N.premultiplied(i.color())),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,i.opacity())},QD=(t,e,r,n,o,i,a,s,l)=>{var c,d,u;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){if(r instanceof En){let p=r;(c=v().modules().wasmRendererBindings)==null||c.bindAAAEllipseGradientUniforms({x:p.xRadius,y:p.yRadius},Ot(p.center.subtract(p.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,a,1)}else if(r instanceof At){let p=r;(d=v().modules().wasmRendererBindings)==null||d.bindAAARoundedRectGradientUniforms(Math.max(p.radii().topLeft,0),Math.max(p.radii().topRight,0),Math.max(p.radii().bottomRight,0),Math.max(p.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,a,1)}else throw new Error("Unxpected path type");l.texture(),(u=v().modules().wasmRendererBindings)==null||u.bindTextureSamplers(l.handle(),0,0)}else kc(t,e,r,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,o),t.setUniformInt(e.SHADER_NAME_U_TYPE,a),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s),l.setFormat(Fe.RGBA_LINEAR_CLAMP),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,l,0)},zv=(t,e,r,n,o,i,a,s,l,c)=>{var d,u,p;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){if(r instanceof En){let _=r;(d=v().modules().wasmRendererBindings)==null||d.bindAAAEllipseImageUniforms({x:_.xRadius,y:_.yRadius},Ot(_.center.subtract(_.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,l,c?1:0,c?0:1)}else if(r instanceof At){let _=r;(u=v().modules().wasmRendererBindings)==null||u.bindAAARoundedRectImageUniforms(Math.max(_.radii().topLeft,0),Math.max(_.radii().topRight,0),Math.max(_.radii().bottomRight,0),Math.max(_.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,l,c?1:0,c?0:1)}else throw new Error("Unxpected path type");a.texture(),(p=v().modules().wasmRendererBindings)==null||p.bindTextureSamplers(a.handle(),0,0)}else t.setUniformFloat(e.SHADER_NAME_U_PIXEL_RATIO,l),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,o),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,a,0),kc(t,e,r,n),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,c?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,c?0:1)},Wv=(t,e,r,n,o,i,a,s,l,c,d)=>{var u,p,_,h;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let g=l.filterColorAdjust(),m=g?g.tint:0,A=g?g.vibrance:0,S=g?g.shadows:0,T=g?g.highlights:0,R=g?g.exposure:0,b=g?g.contrast:0,O=g?g.temperature:0;if(r instanceof En){let f=r;(u=v().modules().wasmRendererBindings)==null||u.bindAAAEllipseImageColorAdjustUniforms({x:f.xRadius,y:f.yRadius},Ot(f.center.subtract(f.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,c,m,A,S,T,R,b,O,.5,d?1:0,d?0:1)}else if(r instanceof At){let f=r;(p=v().modules().wasmRendererBindings)==null||p.bindAAARoundedRectImageColorAdjustUniforms(Math.max(f.radii().topLeft,0),Math.max(f.radii().topRight,0),Math.max(f.radii().bottomRight,0),Math.max(f.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,c,m,A,S,T,R,b,O,.5,d?1:0,d?0:1)}else throw new Error("Unxpected path type");a.texture(),(_=v().modules().wasmRendererBindings)==null||_.bindTextureSamplers(a.handle(),0,0),(h=v().modules().wasmRendererBindings)==null||h.bindTextureSamplers(a.handle(),0,0)}else t.setUniformFloat(e.SHADER_NAME_U_PIXEL_RATIO,c),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,o),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,a,0),kc(t,e,r,n),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,d?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,d?0:1)},qD=(t,e,r,n,o,i,a,s,l,c,d,u,p,_)=>{var h,g,m;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){if(r instanceof En){let A=r;(h=v().modules().wasmRendererBindings)==null||h.bindAAAEllipseLerpImageUniforms({x:A.xRadius,y:A.yRadius},Ot(A.center.subtract(A.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),$e(o),$e(i),$e(a),c,u,p,_?1:0,_?0:1)}else if(r instanceof At){let A=r;(g=v().modules().wasmRendererBindings)==null||g.bindAAARoundedRectLerpImageUniforms(Math.max(A.radii().topLeft,0),Math.max(A.radii().topRight,0),Math.max(A.radii().bottomRight,0),Math.max(A.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),$e(a),c,u,p,_?1:0,_?0:1)}else throw new Error("Unxpected path type");s.texture(),l.texture(),(m=v().modules().wasmRendererBindings)==null||m.bindTextureSamplers(s.handle(),l.handle(),0)}else t.setUniformFloat(e.SHADER_NAME_U_PIXEL_RATIO,u),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,a),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,o),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM1,i),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,c),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,s,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,l,1),t.setUniformFloat(e.SHADER_NAME_U_PROGRESS,Ye.double_clamp(d.t(),0,1)),kc(t,e,r,n),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,_?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,_?0:1)},XD=(t,e,r,n,o,i,a,s,l,c,d,u,p,_)=>{var h,g,m;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let A=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().tint:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().tint:0,d.t()),-1,1),S=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().vibrance:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().vibrance:0,d.t()),-1,1),T=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().shadows:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().shadows:0,d.t()),-1,1),R=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().highlights:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().highlights:0,d.t()),-1,1),b=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().exposure:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().exposure:0,d.t()),-1,1),O=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().contrast:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().contrast:0,d.t()),-.3,.3),f=Ye.double_clamp(Ye.double_lerp(d.from().filterColorAdjust()!=null?d.from().filterColorAdjust().temperature:0,d.to().filterColorAdjust()!=null?d.to().filterColorAdjust().temperature:0,d.t()),-1,1);if(r instanceof En){let I=r;(h=v().modules().wasmRendererBindings)==null||h.bindAAAEllipseLerpImageColorAdjustUniforms({x:I.xRadius,y:I.yRadius},Ot(I.center.subtract(I.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),$e(o),$e(i),$e(a),c,u,A,S,T,R,b,O,f,.5,p,_?1:0,_?0:1)}else if(r instanceof At){let I=r;(g=v().modules().wasmRendererBindings)==null||g.bindAAARoundedRectLerpImageColorAdjustUniforms(Math.max(I.radii().topLeft,0),Math.max(I.radii().topRight,0),Math.max(I.radii().bottomRight,0),Math.max(I.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),$e(a),c,u,A,S,T,R,b,O,f,.5,p,_?1:0,_?0:1)}else throw new Error("Unxpected path type");s.texture(),l.texture(),(m=v().modules().wasmRendererBindings)==null||m.bindTextureSamplers(s.handle(),l.handle(),0)}else t.setUniformFloat(e.SHADER_NAME_U_PIXEL_RATIO,u),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,a),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,o),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM1,i),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,c),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,s,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,l,1),t.setUniformFloat(e.SHADER_NAME_U_PROGRESS,Ye.double_clamp(d.t(),0,1)),kc(t,e,r,n),t.setUniformInt(e.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,_?1:0),t.setUniformInt(e.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,_?0:1)},jD=(t,e,r,n,o,i,a,s)=>{var l,c;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let d={x:n,y:o};(l=v().modules().wasmRendererBindings)==null||l.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(c=v().modules().wasmRendererBindings)==null||c.bindClampedBlurTileUniforms(ft(i),a,d,ft(s))}else ye.Material_setUniformVec43(t,e.SHADER_NAME_U_BLUR_CLAMP,s),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,i),t.setUniformFloat(e.SHADER_NAME_U_COUNT,a),t.setUniformVec21(e.SHADER_NAME_U_BLUR_DELTA,n,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformInt(e.SHADER_NAME_INCREASE_MAX_RADIUS_FOR_BLURS,U.getFeatureFlags().increase_blur_max_texel_radius?1:0)},ZD=(t,e,r,n,o,i,a)=>{var s,l;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let c={x:n,y:o};(s=v().modules().wasmRendererBindings)==null||s.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(l=v().modules().wasmRendererBindings)==null||l.bindUnclampedBlurTileUniforms(ft(i),a,c)}else ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,i),t.setUniformFloat(e.SHADER_NAME_U_COUNT,a),t.setUniformVec21(e.SHADER_NAME_U_BLUR_DELTA,n,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformInt(e.SHADER_NAME_INCREASE_MAX_RADIUS_FOR_BLURS,U.getFeatureFlags().increase_blur_max_texel_radius?1:0)},JD=(t,e,r,n,o,i)=>{var a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(a=v().modules().wasmRendererBindings)==null||a.bindRectangleBlurUniforms(i,ft(o),$e(r),N.toColorF(N.premultiplied(n))):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,N.premultiplied(n)),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),t.setUniformFloat(e.SHADER_NAME_U_BLUR_RADIUS,i))},$D=(t,e,r,n,o,i,a)=>{var s;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(s=v().modules().wasmRendererBindings)==null||s.bindRoundedRectangleBlurUniforms(a,ft(n),$e(r),o/a,{x:n.width()/(2*a),y:n.height()/(2*a)},N.toColorF(N.premultiplied(i))):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,N.premultiplied(i)),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),t.setUniformFloat(e.SHADER_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS,o/a),t.setUniformVec21(e.SHADER_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS,n.width()/(2*a),n.height()/(2*a)),t.setUniformFloat(e.SHADER_NAME_U_BLUR_RADIUS,a))},ex=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(a=v().modules().wasmRendererBindings)==null||a.bindUpscaleTileUniforms(ft(n),ft(o))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_SOURCE,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0))},Kv=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(a=v().modules().wasmRendererBindings)==null||a.bindDownscaleTileUniforms(ft(n),ft(o))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_SOURCE,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0))},tx=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),0),(a=v().modules().wasmRendererBindings)==null||a.bindMaskTileUniforms(ft(o))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1))},rx=(t,e,r,n,o,i,a)=>{var s,l,c;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((s=v().modules().wasmRendererBindings)==null||s.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),0),a?(l=v().modules().wasmRendererBindings)==null||l.bindMaskInnerShadowTileAndFirstHardMaskAlphaUniforms(ft(o),N.toColorF(i)):(c=v().modules().wasmRendererBindings)==null||c.bindMaskInnerShadowTileUniforms(ft(o),N.toColorF(i))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1))},nx=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),0),(a=v().modules().wasmRendererBindings)==null||a.bindMaskBackgroundBlurTileUniforms(ft(o))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1))},ox=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),0),(a=v().modules().wasmRendererBindings)==null||a.bindMaskTileLuminanceUniforms(ft(o))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1))},ix=(t,e,r,n,o,i)=>{var a,s;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((a=v().modules().wasmRendererBindings)==null||a.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),o.colorTextureForSampling().handle()),(s=v().modules().wasmRendererBindings)==null||s.bindMaskTileLuminancePassThroughUniforms(ft(i))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1),t.setUniformSampler(e.SHADER_NAME_TEXTURE2,o.colorTextureForSampling(),2))},ax=(t,e,r,n,o,i)=>{var a,s;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((a=v().modules().wasmRendererBindings)==null||a.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),o.colorTextureForSampling().handle()),(s=v().modules().wasmRendererBindings)==null||s.bindMaskTilePassThroughUniforms(ft(i))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1),t.setUniformSampler(e.SHADER_NAME_TEXTURE2,o.colorTextureForSampling(),2))},sx=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),0),(a=v().modules().wasmRendererBindings)==null||a.bindMaskKnockoutShadowTileUniforms(ft(o))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1))},lx=(t,e,r,n,o,i)=>{var a,s;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((a=v().modules().wasmRendererBindings)==null||a.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),o.colorTextureForSampling().handle()),(s=v().modules().wasmRendererBindings)==null||s.bindMaskKnockoutShadowTilePassThroughUniforms(ft(i))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1),t.setUniformSampler(e.SHADER_NAME_TEXTURE2,o.colorTextureForSampling(),2))},cx=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(a=v().modules().wasmRendererBindings)==null||a.bindBlendTileSimpleUniforms(ft(n),o)):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,o),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0))},dx=(t,e,r,n,o,i,a)=>{var s,l;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((s=v().modules().wasmRendererBindings)==null||s.bindTextureSamplers(r.colorTextureForSampling().handle(),n.colorTextureForSampling().handle(),0),(l=v().modules().wasmRendererBindings)==null||l.bindBlendTileCustomUniforms(ft(o),i,a)):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),t.setUniformInt(e.SHADER_NAME_U_TYPE,i),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,a),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1))},ux=(t,e,r,n,o)=>{var i,a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((i=v().modules().wasmRendererBindings)==null||i.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(a=v().modules().wasmRendererBindings)==null||a.bindHardMaskTileWithColorUniforms(ft(n),N.toColorF(N.premultiplied(o)))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,N.premultiplied(o)),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0))},px=(t,e,r,n,o,i,a)=>{var s,l;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((s=v().modules().wasmRendererBindings)==null||s.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(l=v().modules().wasmRendererBindings)==null||l.bindHardMaskWithColorAndDownscaleTileUniforms(ft(o),ft(i),N.toColorF(N.premultiplied(n)),a,1/a)):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,o),ye.Material_setUniformVec43(t,e.SHADER_NAME_U_SOURCE,i),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),ye.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,N.premultiplied(n)),t.setUniformFloat(e.SHADER_NAME_U_TEXTURE_SIZE,a),t.setUniformFloat(e.SHADER_NAME_U_TEXTURE_PX,1/a))},_x=(t,e,r,n,o,i)=>{var a;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?(a=v().modules().wasmRendererBindings)==null||a.bindHotspotUniforms($e(r),ft(n),Ot(o),i):(ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),ye.Material_setUniformVec22(t,e.SHADER_NAME_U_STROKE_PROPORTION,o),t.setUniformVec41(e.SHADER_NAME_U_UV_HOTSPOT_CLIPPING_RECT,n.x(),n.y(),n.width(),n.height()),t.setUniformFloat(e.SHADER_NAME_U_HOTSPOT_OPACITY,i))},hx=(t,e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A)=>{var S,T;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer())(S=v().modules().wasmRendererBindings)==null||S.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(T=v().modules().wasmRendererBindings)==null||T.bindGlassUniforms(o,ft(n),i,$e(a),$e(s),Ot(l),c,d,u,p,_,h,g,m,N.toColorF(N.premultiplied(A)));else{ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformFloat(e.SHADER_NAME_CORNER_RADIUS_IN_PIXEL_SPACE,o),t.setUniformFloat(e.SHADER_NAME_SCALE,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_NODE_TO_TILE_SPACE,a),ye.Material_setUniformMat32(t,e.SHADER_NAME_TILE_TO_NODE_SPACE,s),ye.Material_setUniformVec22(t,e.SHADER_NAME_NODE_SPACE_CENTER_POINT,l),t.setUniformFloat(e.SHADER_NAME_REFRACTION_INTENSITY,c),t.setUniformFloat(e.SHADER_NAME_REFRACTION_DISTANCE,d),t.setUniformFloat(e.SHADER_NAME_LIGHT_INTENSITY,u),t.setUniformFloat(e.SHADER_NAME_LIGHT_ANGLE,p),t.setUniformFloat(e.SHADER_NAME_BEVEL_SIZE,_),t.setUniformFloat(e.SHADER_NAME_CHROMATIC_ABERRATION,h),t.setUniformFloat(e.SHADER_NAME_CORNER_SMOOTHING,m);let R=N.alphaF(A);t.setUniformVec41(e.SHADER_NAME_TINT_COLOR,N.redF(A)*R,N.greenF(A)*R,N.blueF(A)*R,R)}},mx=(t,e,r,n,o,i,a,s,l,c,d,u,p)=>{var _,h;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((_=v().modules().wasmRendererBindings)==null||_.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(h=v().modules().wasmRendererBindings)==null||h.bindClampedGradientBlurTileUniforms(ft(o),ft(n),i,a,{x:s,y:l},ft(c),Ot(d),Ot(u),ft(p))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_BLUR_CLAMP,c),ye.Material_setUniformVec43(t,e.SHADER_NAME_QUAD,n),ye.Material_setUniformVec43(t,e.SHADER_NAME_SOURCE,o),ye.Material_setUniformVec43(t,e.SHADER_NAME_BLUR_RANGE_SOURCE,p),t.setUniformFloat(e.SHADER_NAME_START_COUNT,i),t.setUniformFloat(e.SHADER_NAME_END_COUNT,a),t.setUniformVec21(e.SHADER_NAME_BLUR_DELTA,s,l),t.setUniformVec21(e.SHADER_NAME_BLUR_GRADIENT_START,d.x(),d.y()),t.setUniformVec21(e.SHADER_NAME_BLUR_GRADIENT_END,u.x(),u.y()),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0))},fx=(t,e,r,n,o,i,a,s,l,c,d,u)=>{var p,_;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((p=v().modules().wasmRendererBindings)==null||p.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(_=v().modules().wasmRendererBindings)==null||_.bindUnclampedGradientBlurTileUniforms(ft(o),ft(n),i,a,{x:s,y:l},Ot(c),Ot(d),ft(u))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_QUAD,n),ye.Material_setUniformVec43(t,e.SHADER_NAME_SOURCE,o),ye.Material_setUniformVec43(t,e.SHADER_NAME_BLUR_RANGE_SOURCE,u),t.setUniformFloat(e.SHADER_NAME_START_COUNT,i),t.setUniformFloat(e.SHADER_NAME_END_COUNT,a),t.setUniformVec21(e.SHADER_NAME_BLUR_DELTA,s,l),t.setUniformVec21(e.SHADER_NAME_BLUR_GRADIENT_START,c.x(),c.y()),t.setUniformVec21(e.SHADER_NAME_BLUR_GRADIENT_END,d.x(),d.y()),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0))},gx=(t,e,r,n,o,i,a,s,l,c,d,u)=>{var p,_;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((p=v().modules().wasmRendererBindings)==null||p.bindTextureSamplers(r.colorTextureForSampling().handle(),d.colorTextureForSampling().handle(),0),(_=v().modules().wasmRendererBindings)==null||_.bindUpscaleAndBlendGradientBlurTileUniforms(ft(n),ft(o),i,a,Ot(l),Ot(c),s,ft(u))):(ye.Material_setUniformVec43(t,e.SHADER_NAME_QUAD,n),ye.Material_setUniformVec43(t,e.SHADER_NAME_SOURCE,o),ye.Material_setUniformVec43(t,e.SHADER_NAME_BLUR_RANGE_SOURCE,u),t.setUniformFloat(e.SHADER_NAME_START_COUNT,i),t.setUniformFloat(e.SHADER_NAME_END_COUNT,a),t.setUniformFloat(e.SHADER_NAME_SCALE_TO_UNADJUST,s),t.setUniformVec21(e.SHADER_NAME_BLUR_GRADIENT_START,l.x(),l.y()),t.setUniformVec21(e.SHADER_NAME_BLUR_GRADIENT_END,c.x(),c.y()),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,d.colorTextureForSampling(),1))},Sx=(t,e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A)=>{var S,T;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer())(S=v().modules().wasmRendererBindings)==null||S.bindTextureSamplers(r.colorTextureForSampling().handle(),0,0),(T=v().modules().wasmRendererBindings)==null||T.bindGlassNonUniformCornerRadiiUniforms(ft(n),o,$e(i),$e(a),l[0],l[1],l[2],l[3],c[0],c[1],c[2],c[3],Ot(s),d,u,p,_,h,g,m,N.toColorF(N.premultiplied(A)));else{ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),t.setUniformFloat(e.SHADER_NAME_TILE_EXPANSION_SCALE,o),ye.Material_setUniformMat32(t,e.SHADER_NAME_NODE_TO_TILE_SPACE,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_TILE_TO_NODE_SPACE,a),ye.Material_setUniformVec22(t,e.SHADER_NAME_NODE_SPACE_CENTER_POINT,s),t.setUniformVec41(e.SHADER_NAME_CORNER_RADII,l[0],l[1],l[2],l[3]),t.setUniformVec41(e.SHADER_NAME_CORNER_SMOOTHINGS,c[0],c[1],c[2],c[3]);let R=l.every(O=>O===l[0])&&c.every(O=>O===c[0]);t.setUniformInt(e.SHADER_NAME_HAS_UNIFORM_CORNERS,R?1:0),t.setUniformFloat(e.SHADER_NAME_FRAME_ROTATION,i.toAngle()),t.setUniformFloat(e.SHADER_NAME_REFRACTION_INTENSITY,d),t.setUniformFloat(e.SHADER_NAME_REFRACTION_DISTANCE,u),t.setUniformFloat(e.SHADER_NAME_LIGHT_INTENSITY,p),t.setUniformFloat(e.SHADER_NAME_LIGHT_ANGLE,_),t.setUniformFloat(e.SHADER_NAME_BEVEL_SIZE,h),t.setUniformFloat(e.SHADER_NAME_CHROMATIC_ABERRATION,g),t.setUniformFloat(e.SHADER_NAME_REFL_RADIUS_IN_PIXEL_SPACE,m);let b=N.alphaF(A);t.setUniformVec41(e.SHADER_NAME_TINT_COLOR,N.redF(A)*b,N.greenF(A)*b,N.blueF(A)*b,b)}},Ax=(t,e,r,n,o,i,a,s,l,c,d,u)=>{var p,_;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){let h=0;r=="MULTITONE"?h=0:r=="MONOTONE"?h=1:h=2,(p=v().modules().wasmRendererBindings)==null||p.bindNoiseUniforms(h,n,o,N.toColorF(i),N.toColorF(a),$e(l),ft(c),Ot(s),d),(_=v().modules().wasmRendererBindings)==null||_.bindTextureSamplers(u.handle(),0,0)}else ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,c),t.setUniformInt(e.SHADER_NAME_U_SEED,d),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,u,0),r=="MULTITONE"?t.setUniformInt(e.SHADER_NAME_U_NOISE_TYPE,0):r=="MONOTONE"?t.setUniformInt(e.SHADER_NAME_U_NOISE_TYPE,1):t.setUniformInt(e.SHADER_NAME_U_NOISE_TYPE,2),t.setUniformFloat(e.SHADER_NAME_U_NOISE_SIZE,n),t.setUniformFloat(e.SHADER_NAME_U_DENSITY,o),t.setUniformVec41(e.SHADER_NAME_U_COLOR,N.redF(i),N.greenF(i),N.blueF(i),N.alphaF(i)),t.setUniformVec41(e.SHADER_NAME_U_SECONDARY_COLOR,N.redF(a),N.greenF(a),N.blueF(a),N.alphaF(a)),t.setUniformVec21(e.SHADER_NAME_U_NODE_SPACE_CENTER_POINT,s.x(),s.y()),t.setUniformMat31(e.SHADER_NAME_U_TILE_TO_NODE_SPACE,l.m00(),l.m01(),l.m02(),l.m10(),l.m11(),l.m12())},Tx=(t,e,r,n,o,i,a,s,l,c,d)=>{var u,p;rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()?((u=v().modules().wasmRendererBindings)==null||u.bindUnclampedGrainUniforms(r,ft(n),o,i,$e(a),$e(s),Ot(l),c),(p=v().modules().wasmRendererBindings)==null||p.bindTextureSamplers(d.handle(),0,0)):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),t.setUniformInt(e.SHADER_NAME_U_SEED,c),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,d,0),t.setUniformFloat(e.SHADER_NAME_RADIUS_IN_PIXEL_SPACE,r),t.setUniformFloat(e.SHADER_NAME_SCALE,o),t.setUniformFloat(e.SHADER_NAME_NOISE_SIZE,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_NODE_TO_TILE_SPACE,a),ye.Material_setUniformMat32(t,e.SHADER_NAME_TILE_TO_NODE_SPACE,s),ye.Material_setUniformVec22(t,e.SHADER_NAME_NODE_SPACE_CENTER_POINT,l))},Ex=(t,e,r,n,o,i,a,s,l,c,d,u)=>{var p,_;U.useUnifiedRenderer()?((p=v().modules().wasmRendererBindings)==null||p.bindClampedGrainUniforms(r,ft(n),o,i,$e(a),$e(s),Ot(l),!1,c),(_=v().modules().wasmRendererBindings)==null||_.bindTextureSamplers(d.handle(),u.handle(),0)):(ye.Material_setUniformVec43(t,e.SHADER_NAME_U_QUAD,n),t.setUniformInt(e.SHADER_NAME_U_SEED,c),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,d,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,u,1),t.setUniformFloat(e.SHADER_NAME_RADIUS_IN_PIXEL_SPACE,r),t.setUniformFloat(e.SHADER_NAME_SCALE,o),t.setUniformFloat(e.SHADER_NAME_NOISE_SIZE,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_NODE_TO_TILE_SPACE,a),ye.Material_setUniformMat32(t,e.SHADER_NAME_TILE_TO_NODE_SPACE,s),ye.Material_setUniformVec22(t,e.SHADER_NAME_NODE_SPACE_CENTER_POINT,l))},Ix=(t,e,r,n,o,i,a,s,l,c,d)=>{var u,p,_;if(rt.didUseUnifiedRendererMaterial(U.useUnifiedRenderer()),U.useUnifiedRenderer()){if(r instanceof En){let h=r;(u=v().modules().wasmRendererBindings)==null||u.bindAAAEllipseLerpGradientUniforms({x:h.xRadius,y:h.yRadius},Ot(h.center.subtract(h.bounds().topLeft())),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,a,1,l)}else if(r instanceof At){let h=r;(p=v().modules().wasmRendererBindings)==null||p.bindAAARoundedRectLerpGradientUniforms(Math.max(h.radii().topLeft,0),Math.max(h.radii().topRight,0),Math.max(h.radii().bottomRight,0),Math.max(h.radii().bottomLeft,0),Ot(r.bounds().size()),Ot(n),ft(r.bounds().translatedBy(r.bounds().topLeft())),$e(o),$e(i),s,a,1,l)}else throw new Error("Unxpected path type");c.texture(),d.texture(),(_=v().modules().wasmRendererBindings)==null||_.bindTextureSamplers(c.handle(),d.handle(),0)}else c.setFormat(Fe.RGBA_LINEAR_CLAMP),d.setFormat(Fe.RGBA_LINEAR_CLAMP),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,c,0),t.setUniformSampler(e.SHADER_NAME_TEXTURE1,d,1),t.setUniformFloat(e.SHADER_NAME_U_PROGRESS,l),kc(t,e,r,n),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,i),ye.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,o),t.setUniformInt(e.SHADER_NAME_U_TYPE,a),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,s)};var us=class t{constructor(e,r){e?Array.isArray(e)?this.pt=e:e instanceof L?this.pt=[new F(e.x(),e.y()),new F(e.x()+e.width(),e.y()),new F(e.x()+e.width(),e.y()+e.height()),new F(e.x(),e.y()+e.height())]:e instanceof Q&&(r instanceof F?this.pt=[e.transformPoint(new F(0,0)),e.transformPoint(new F(r.x(),0)),e.transformPoint(new F(r.x(),r.y())),e.transformPoint(new F(0,r.y()))]:r instanceof L&&(this.pt=[e.transformPoint(new F(r.x(),r.y())),e.transformPoint(new F(r.x()+r.width(),r.y())),e.transformPoint(new F(r.x()+r.width(),r.y()+r.height())),e.transformPoint(new F(r.x(),r.y()+r.height()))])):this.pt=Array(4).fill(new F(0,0))}topLeft(){return this.pt[0]}topRight(){return this.pt[1]}bottomRight(){return this.pt[2]}bottomLeft(){return this.pt[3]}get(e){return this.pt[e]}points(){return this.pt}scale(e){let r=this.center();return this.pt=this.pt.map(n=>{let o=n.subtract(r);return r.add(o.multiplyScalar(e))}),this}transform(e){return this.pt=this.pt.map(r=>e.transformPoint(r)),this}expand(e){let r=this.center();return this.pt=this.pt.map(n=>{let o=n.subtract(r),i=o.length(),a=o.multiplyScalar(1/i);return n.add(a.multiplyScalar(e))}),this}lengthX(){return this.topLeft().distanceTo(this.topRight())}lengthY(){return this.topLeft().distanceTo(this.bottomLeft())}hasAxisX(){return this.lengthX()>.001}hasAxisY(){return this.lengthY()>.001}center(){return this.pt.reduce((r,n)=>r.add(n),new F(0,0)).multiplyScalar(1/4)}bounds(){let e=this.pt.map(s=>s.x()),r=this.pt.map(s=>s.y()),n=Math.min(...e),o=Math.min(...r),i=Math.max(...e),a=Math.max(...r);return new L(n,o,i-n,a-o)}toAngle(){let e=this.topRight().subtract(this.topLeft());return Math.atan2(e.y(),e.x())}static fromCenterSize(e,r){let n=r.multiplyScalar(.5),o=e.subtract(n),i=o.x()+r.x(),a=o.y()+r.y();return new t([new F(o.x(),o.y()),new F(i,o.y()),new F(i,a),new F(o.x(),a)])}equals(e){return this.pt.every((r,n)=>r.equals(e.pt[n]))}};function Pf(t,e){return t.fitMode!="contain"&&t.fitMode!="scale-down"&&t.fitMode!="scale-down-width"&&t.fitMode!="fit-width"&&!(t.fitMode=="min-zoom"&&e)}function Rx(t){return t.fitMode!="contain"&&t.fitMode!="contain-with-zoom"&&t.fitMode!="scale-down"&&t.fitMode!="none"&&t.fitMode!="free"}var lt=(f=>(f[f.UNKNOWN=0]="UNKNOWN",f[f.TIMER=1]="TIMER",f[f.ON_HOVER=2]="ON_HOVER",f[f.ON_PRESS=3]="ON_PRESS",f[f.ON_CLICK=4]="ON_CLICK",f[f.DRAG=5]="DRAG",f[f.REVERSE_HOVER=6]="REVERSE_HOVER",f[f.REVERSE_PRESS=7]="REVERSE_PRESS",f[f.MOUSE_DOWN=8]="MOUSE_DOWN",f[f.MOUSE_UP=9]="MOUSE_UP",f[f.MOUSE_IN=10]="MOUSE_IN",f[f.MOUSE_OUT=11]="MOUSE_OUT",f[f.MOUSE_ENTER=12]="MOUSE_ENTER",f[f.MOUSE_LEAVE=13]="MOUSE_LEAVE",f[f.ON_KEY_DOWN=14]="ON_KEY_DOWN",f[f.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",f[f.ON_VOICE=16]="ON_VOICE",f[f.MOBILE_NAV=17]="MOBILE_NAV",f[f.LEFT_ARROW=18]="LEFT_ARROW",f[f.RIGHT_ARROW=19]="RIGHT_ARROW",f[f.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",f[f.ON_MEDIA_END=21]="ON_MEDIA_END",f[f.MIRROR_SELECTION=22]="MIRROR_SELECTION",f))(lt||{});(s=>{function t(l){switch(l){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 22:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}s.isTransientAction=t;function e(l){switch(l){case 2:case 3:case 8:case 10:case 12:return!0;default:return!1}}s.isForwardTransientAction=e;function r(l){switch(l){case 2:return 6;case 3:return 7;case 6:return 2;case 7:return 3;case 10:return 11;case 11:return 10;case 12:return 13;case 13:return 12;case 8:return 9;default:return 0}}s.getOppositeTransientAction=r;function n(l){switch(l){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21;case"MIRROR_SELECTION":return 22}return 0}s.fromString=n;function o(l){return[1,18,19,20,21].indexOf(l)!=-1?0:1}s.getControlSource=o;function i(l){switch(l){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return xe("fromInteractionType InteractionType not handled"),0}s.fromInteractionType=i;function a(l){switch(l){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return xe("mapToInteractionType TransitionAction not handled"),null}s.mapToInteractionType=a})(lt||(lt={}));var qn=(r=>(r[r.FORWARD=0]="FORWARD",r[r.REVERSE=1]="REVERSE",r))(qn||{});var Zd=class{constructor(e,r){this.type=e,this.interruptIndex=r}},Ff=class extends Zd{constructor(e,r,n,o){super(3,0),this.node=e,this.transform=r,this.canvasSpaceTileBounds=n,this.inverseVolatileTransform=o}},Df=class extends Zd{constructor(e){super(2,0),this.scissor=e}},xf=class extends Zd{constructor(e,r,n,o,i,a){super(4,0),this.blendIsNoOp=e,this.node=r,this.transform=n,this.canvasSpaceTileBounds=o,this.inverseVolatileTransform=i,this.oldScissor=a}},Ro=class extends Zd{constructor(e,r,n,o,i){super(1,i),this.node=e,this.transform=r,this.canvasSpaceTilebounds=n,this.inverseVolatileTransform=o}};var Jd=class Jd{texture(e){return this._texture==null&&(this._texture=e.createTextureWithPixels(Fe.RGBA_LINEAR_CLAMP,Jd.WIDTH,Jd.HEIGHT,this.pixels,fr.GRADIENT)),this._texture}totalVRAM(){return this._texture!=null?$n.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}};Jd.WIDTH=1024,Jd.HEIGHT=2;var Ol=Jd,r_=class t{constructor(){this._table=null;let e=new li;this._table=new ia(r=>t._hashGradient(e,r),(r,n)=>r.equals2(n),r=>t._evaluateGradient(r))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((r,n)=>{e=e+n.totalVRAM()}),e}static _hashGradient(e,r){let n=r.colorStops(),o=n.length;e.hash2(Fc.shouldWrap(r.type())?1:0),e.hash2(o);for(let i=0,a=o;i<a;i=i+1){let s=n[i];e.hash2(s.color),e.hash1(s.position)}return e.value()}static _evaluateGradient(e){let r=new Uint8Array(Ol.WIDTH*Ol.HEIGHT*4),n=e.flattenedStops(),o=n.length;if(o!=0){let i=1,a=n[0],s=a,l=0;for(let c=0;c<Ol.WIDTH;c=c+1){let d=c/(Ol.WIDTH-1);for(;a.position<d&&i<o;)s=a,a=n[i],i=i+1;let u=s.position,p=a.position,_=d<u?0:d>p?1:u<p?(d-u)/(p-u):0,h=s.color,g=a.color,m=((h>>>24)+((g>>>24)-(h>>>24))*_)/255;for(let A=0;A<4;A=A+1){let S=h&255,T=g&255,R=S+(T-S)*_,b=.5+257*(A<3?R*m:R)|0;r[l]=b>>8,r[l+Ol.WIDTH*4]=b,h>>=8,g>>=8,l=l+1}}}return new Ol(r)}};var $d=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]),wf=class{constructor(e,r,n,o){this._gradientDataCache=new Map,this._gradientPool=new r_,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new vt,this._shouldFlushAfterStencilCover=!1,this._materialStrings=Br.instance(),this.computeStates=new Map([["ODD",gr.ODD_WINDING_NUMBER_COMPUTE],["NONZERO",gr.NONZERO_WINDING_NUMBER_COMPUTE]]),this.useStates=new Map([["ODD",gr.ODD_WINDING_NUMBER],["NONZERO",gr.NONZERO_WINDING_NUMBER]]),this.clearStates=new Map([["ODD",gr.ODD_WINDING_NUMBER_CLEAR],["NONZERO",gr.NONZERO_WINDING_NUMBER_CLEAR]]),this.setFillStates=new Map([["ODD",gr.ODD_WINDING_NUMBER_FILL],["NONZERO",gr.NONZERO_WINDING_NUMBER_FILL]]),this.setStrokeStates=new Map([["ODD",gr.ODD_WINDING_NUMBER_STROKE],["NONZERO",gr.NONZERO_WINDING_NUMBER_STROKE]]),this.compoundUseStates=new Map([[0,gr.STROKE_INSIDE],[1,gr.STROKE_OUTSIDE]]),this.compoundClearStates=new Map([[0,gr.STROKE_INSIDE_CLEAR],[1,gr.STROKE_OUTSIDE_CLEAR]]),this._delegate=e,this._context=r,this._tileConfig=n,this._bufferPool=o,this._solidColorMaterial=this._context.createMaterial("solidColor",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_GRADIENT_FRAGMENT),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_GRADIENT_FRAGMENT),this._stencilMaterial=this._context.createMaterial("stencil",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_LOOP_BLINN_VERTEX,this._materialStrings.SHADER_SOURCE_LOOP_BLINN_FRAGMENT),this._stencilMaterialInstanced=this._context.createMaterial("stencilInstanced",St.getPositionF2CoordF3_InstanceTransform_F3_F3(),this._materialStrings.SHADER_SOURCE_LOOP_BLINN_INSTANCED_VERTEX,this._materialStrings.SHADER_SOURCE_LOOP_BLINN_FRAGMENT),this._imageMaterial=this._context.createMaterial("image",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_FRAGMENT),this._lerpImageMaterial=this._context.createMaterial("lerpImage",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_IMAGE_FRAGMENT),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT),Ld()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT),this._aaaShapeLerpImageEllipseMaterial=this._context.createMaterial("aaaShapeLerpImageEllipse",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT),this._aaaShapeLerpImageRoundedRectMaterial=this._context.createMaterial("aaaShapeLerpImageRoundedRect",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT),this._aaaShapeLerpImageColorAdjustEllipseMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjustEllipse",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT),this._aaaShapeLerpImageColorAdjustRoundedRectMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjustRoundedRect",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT)),this._quadArea=this._bufferPool.allocateSmallManagedArea(ze.TRIANGLE_STRIP,bt.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new r_}canSkipStencil(e,r,n){let o=n.paints;return n.rotation!=0&&o.length==1&&o[0].type()==="EMOJI"?!0:r.hasNoCurves?!!(r.hasNoOverlaps||e=="NONZERO"&&r.hasNoCurvesAndSameOrientation&&!Ce.containsAtLeastOneNonOpaquePaint(o)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new fe(e),this._batchAntialiasing.value===2&&this._delegate.pushSSAARenderState(null)}finishBatch(){var e,r;if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&((e=this._batchAntialiasing)==null?void 0:e.value)==2){let n=this.currentBatchScissor(),o=this._delegate.currentTile().scissor();this._delegate.currentTile().setScissor(n.intersectedWith(o))}this._currentBatchScissorBuilder.reset(),((r=this._batchAntialiasing)==null?void 0:r.value)==2&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,r,n){let o=this._solidColorMaterial,i=Q.new3(e).translatedBy1(r.topLeft()).scaledBy1(r.size());GD(o,this._materialStrings,i),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,o,this._quadArea,It.KEEP,n),this._delegate.markDidDraw()}renderFill(e,r){if(r.geometry.paints.length==0)return;let n=r.paintSize;if(r.geometry.type==1){let _=r.geometry.path().bounds();r.bgBlurExpansionForFrameFill!=null?n=_.clone().expandedBy1(-r.bgBlurExpansionForFrameFill).size():n=_.size()}let o=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(r.transform),i=this._delegate.currentTile(),a=i.tileSize(),s=Q.new2().scaledBy2(a).multipliedBy1(e).multipliedBy1(r.transform),l=i.scissor(),c=L.new3(r.geometry.path().bounds());if(s.transformRect(c),c.intersectWith(l),this.includeBoundsInBatchScissor(c),r.geometry.canBeAnalyticallyAntialiased()){this.renderAAAShape(o,r.geometry,n,a,It.PREMULTIPLIED);return}let d=r.geometry.path().windingRule(),u=r.geometry.path().triangles(this._bufferPool,bt.getPositionF2CoordF3()),p=!0;for(let _=0,h=u.length;_<h;_=_+1)if(!this.canSkipStencil(d,u[_],r.geometry)){p=!1;break}p?this.renderGeometryDirectly(o,r.geometry,n,a,It.PREMULTIPLIED):(this.renderStencilGeometry(o,r.geometry,this.computeStates.get(d)),this.renderCoverQuad(o,r.geometry,r.geometry.path().bounds(),n,this.useStates.get(d),this.clearStates.get(d),a,It.PREMULTIPLIED))}renderFillStroke(e,r){let n=this._delegate.currentTile(),o=n.tileSize(),i=Q.new2().scaledBy2(o).multipliedBy1(e).multipliedBy1(r.transform),a=n.scissor(),s=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(r.transform);for(let l=0,c=r.fillGeometries.length;l<c;l=l+1){let d=r.fillGeometries[l],u=d.path().bounds(),p=L.new3(u);i.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let _=d.path().windingRule();this.renderStencilGeometry(s,d,this.computeStates.get(_)),this.renderCoverQuad(s,d,u,r.paintSize,this.useStates.get(_),this.setFillStates.get(_),o,It.PREMULTIPLIED)}for(let l=0,c=r.strokeGeometries.length;l<c;l=l+1){let d=r.strokeGeometries[l],u=L.new3(d.path().bounds());i.transformRect(u),this.includeBoundsInBatchScissor(u.intersectedWith(a));let p=d.path().windingRule(),_=d.path().bounds();this.renderStencilGeometry(s,d,this.computeStates.get(p)),this.renderStencilQuad(s,_,this.setStrokeStates.get(p)),this.renderCoverQuad(s,d,_,r.paintSize,this.compoundUseStates.get(r.mode),this.compoundClearStates.get(r.mode),o,It.PREMULTIPLIED)}if(r.strokeGeometries.length!=0){let l=le.List_last(r.strokeGeometries).path().bounds(),c=le.List_last(r.fillGeometries).path().bounds();l.contains1(c)||this.renderStencilQuad(s,c,this.compoundClearStates.get(r.mode))}}renderScatterBrushFill(e,r){let n=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(r.transform),o=this._delegate.currentTile(),i=o.tileSize(),a=Q.new2().scaledBy2(i).multipliedBy1(e).multipliedBy1(r.transform),s=o.scissor(),l=r.getAccumulatedFillGeometryPathBounds(),c=r.paintSize,d=this._context.supportsGpuInstancing()?"NATIVE":"PROXY",u={canvasToClipSpaceTransform:n,canvasToTileSpaceTransform:e,nodeTransform:r.transform,instanceBuffer:this._context.supportsGpuInstancing()?r.getInstanceBuffer(this._bufferPool):null,instanceTransforms:r.instanceTransforms,renderMode:d};for(let p=0;p<r.fillGeometries.length;p++){let _=r.fillGeometries[p];if(_.paints.length==0)continue;let h=l[p],g=L.new3(h);a.transformRect(g),g.intersectWith(s),this.includeBoundsInBatchScissor(g);let m=_.path().windingRule();this.renderStencilGeometryInstanced(u,_,this.computeStates.get(m)),this.renderCoverQuad(n,_,h,c,this.useStates.get(m),this.clearStates.get(m),i,It.PREMULTIPLIED)}}uvTransformFromBounds(e,r){let n=Q.new2();return n.scale4(1/r.x(),1/r.y()),n.translate1(e.topLeft()),n.scale3(e.size()),n}canSkipPaint(e,r,n,o){let i=n.asSinglePaint();if(i==null)return!1;if((i.type()=="GRADIENT_RADIAL"||i.type()=="GRADIENT_DIAMOND")&&i.lastStopIsTransparent()){let a=Q.new3(i.transform());if(a.multiply(r),a.invert()){let s=le.List_last(i.colorStops()).position*.5,l=new F(.5,.5),c=L.new4(l.subtractScalar(s),l.addScalar(s));return Q.new3(e).translatedBy1(o.topLeft()).scaledBy1(o.size()).multipliedBy1(a).transformRect(c),!L.CLIP.overlaps(c)}}return!1}_findOrCreateGradientData(e){let r=nr.IntMap_get(this._gradientDataCache,e.id(),null);return r==null&&(r=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),r)),r}_setAaaShapeUniforms(e,r,n){if(e.setUniformVec21(this._materialStrings.SHADER_NAME_U_UV_SCALE,n.x(),n.y()),ye.Material_setUniformVec22(e,this._materialStrings.SHADER_NAME_U_PATH_SIZE,r.bounds().size()),r instanceof En){let o=r;e.setUniformInt(this._materialStrings.SHADER_NAME_U_SHAPE_TYPE,Cl.ELLIPSE),ye.Material_setUniformVec22(e,this._materialStrings.SHADER_NAME_U_ELLIPSE_CENTER,o.center.subtract(o.bounds().topLeft())),e.setUniformVec21(this._materialStrings.SHADER_NAME_U_ELLIPSE_RADII,o.xRadius,o.yRadius)}else if(r instanceof At){let o=r;e.setUniformInt(this._materialStrings.SHADER_NAME_U_SHAPE_TYPE,Cl.ROUNDED_RECT),ye.Material_setUniformVec43(e,this._materialStrings.SHADER_NAME_U_RECT,r.bounds().translatedBy(r.bounds().topLeft())),e.setUniformVec41(this._materialStrings.SHADER_NAME_U_CORNER_RADII,Math.max(o.radii().topLeft,0),Math.max(o.radii().topRight,0),Math.max(o.radii().bottomRight,0),Math.max(o.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,r,n,o,i){let a=r.paints,s=r.path().bounds(),l=e.clone(),c=l.invert(),d=2/o,u=l.scale1().x()*d,p=s.clone().expandedBy1(u),_=Q.new3(e).translatedBy1(p.topLeft()).scaledBy1(p.size()),h=this.uvTransformFromBounds(s,n),g=new F(p.width()/s.width(),p.height()/s.height()),m=r.path().path();for(let A=0,S=a.length;A<S;A=A+1){let T=a[A];if(!this.canSkipPaint(e,h,T,s))if(T.type()=="SOLID"){let R=this._aaaShapeSolidColorMaterial;YD(R,this._materialStrings,m,g,_,T),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,R,this._quadArea,i),this._delegate.markDidDraw()}else if(Fc.isGradient(T.type())){let R=Q.new3(T.transform()).multipliedBy1(h),b,O=T.asVolatilePaint();if(O!=null){b=this._aaaShapeLerpGradientPaintMaterial;let f=this._findOrCreateGradientData(O.from()).texture(this._context),I=this._findOrCreateGradientData(O.to()).texture(this._context);Ix(b,this._materialStrings,m,g,R,_,$d.get(T.type()),T.opacity(),O.t(),f,I)}else{let f=T.asSinglePaint();b=this._aaaShapeGradientPaintMaterial;let I=this._findOrCreateGradientData(f).texture(this._context);I.setFormat(Fe.RGBA_LINEAR_CLAMP),b.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,I,0),QD(b,this._materialStrings,m,g,R,_,$d.get(T.type()),T.opacity(),I)}this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,b,this._quadArea,i),this._delegate.markDidDraw()}else if(T.type()=="IMAGE"||T.type()=="VIDEO"){let R=Q.new3(h).scaledBy3(1/s.size().x(),1/s.size().y()),b=!0,O=T.asVolatilePaint();if(O!=null){let f=this.getImageToDraw(O.from(),n,e,R,O.from().imageScaleMode(),o);if(f!=null){let I=Q.new2(),y=null,P=null,E;if(O.from().image()==O.to().image()&&!(O.from().imageScaleMode()=="TILE"||O.to().imageScaleMode()=="TILE"))E=this._aaaShapeImageMaterial,O.colorAdjustIsActive()&&(E=this._aaaShapeImageColorAdjustMaterial,O.colorAdjustSetData(E)),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(O,n,h);else{m instanceof En?E=this._aaaShapeLerpImageEllipseMaterial:E=this._aaaShapeLerpImageRoundedRectMaterial,O.colorAdjustIsActive()&&(m instanceof En?E=this._aaaShapeLerpImageColorAdjustEllipseMaterial:E=this._aaaShapeLerpImageColorAdjustRoundedRectMaterial,O.colorAdjustSetData(E)),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(O.from(),n,h);let B=this.getImageToDraw(O.to(),n,e,R,O.to().imageScaleMode(),o);B==null?b=!1:(P=this.getOrCreateVideoTexture(O.to()),P==null&&(P=this._delegate.getOrCreateImageTexture(B)),y=this.allocateObjectSpaceToNormalizedImageSpaceTransform(O.to(),n,h),E!=this._aaaShapeLerpImageColorAdjustEllipseMaterial&&E!=this._aaaShapeLerpImageColorAdjustRoundedRectMaterial&&ye.Material_setUniformMat32(E,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM1,y),P!=null&&!B.image.isCompressedTexture()&&P.setFormat(Fe.RGBA_NEAREST_CLAMP),E!=this._aaaShapeLerpImageColorAdjustEllipseMaterial&&E!=this._aaaShapeLerpImageColorAdjustRoundedRectMaterial&&(P!=null&&E.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,P,1),E.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,Ye.double_clamp(O.t(),0,1))))}let C=this.getOrCreateVideoTexture(O.from());if(C==null&&(C=this._delegate.getOrCreateImageTexture(f)),b&&C!=null){C!=null&&!f.image.isCompressedTexture()&&C.setFormat(Fe.RGBA_NEAREST_CLAMP);let B=this._shouldEmulateWrapAddress(T);E===this._aaaShapeImageMaterial?zv(E,this._materialStrings,m,g,I,_,C,O.opacity(),window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale(),B):E===this._aaaShapeImageColorAdjustMaterial?Wv(E,this._materialStrings,m,g,I,_,C,O.opacity(),O.from(),window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale(),B):(E===this._aaaShapeLerpImageColorAdjustEllipseMaterial||E===this._aaaShapeLerpImageColorAdjustRoundedRectMaterial)&&y!=null&&P!=null?XD(E,this._materialStrings,m,g,I,y,_,C,P,O.opacity(),O,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale(),Ye.double_clamp(O.t(),0,1),B):y!=null&&P!=null?qD(E,this._materialStrings,m,g,I,y,_,C,P,O.opacity(),O,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale(),Ye.double_clamp(O.t(),0,1),B):void 0,this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,E,this._quadArea,i),this._delegate.markDidDraw()}}}else{let f=T.asSinglePaint(),I=null,y=!1;if(I=this.getOrCreateVideoTexture(f),I==null){let P=this.getImageToDraw(f,n,e,R,f.imageScaleMode(),o);P!=null&&(I=this._delegate.getOrCreateImageTexture(P),y=P.image.isCompressedTexture())}if(I!=null){let P=this._aaaShapeImageMaterial;f.colorAdjustIsActive()&&(P=this._aaaShapeImageColorAdjustMaterial,f.colorAdjustSetData(P));let E=this.allocateObjectSpaceToNormalizedImageSpaceTransform(f,n,h);y||I.setFormat(Fe.RGBA_NEAREST_CLAMP);let C=this._shouldEmulateWrapAddress(T);P===this._aaaShapeImageMaterial?zv(P,this._materialStrings,m,g,E,_,I,f.opacity(),window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale(),C):Wv(P,this._materialStrings,m,g,E,_,I,f.opacity(),f,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale(),C),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,P,this._quadArea,i),this._delegate.markDidDraw()}}}else T.type()=="EMOJI"&&xe("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,r,n,o,i){let a=r.path().triangles(this._bufferPool,bt.getPositionF2CoordF3()),s=r.paints,l=r.path().bounds(),c=this.uvTransformFromBounds(l,n),d;for(let u=0,p=s.length;u<p;u=u+1){let _=s[u];if(!this.canSkipPaint(e,c,_,l))switch(_.type()){case"SOLID":{d=this._solidColorMaterial,Xd(d,this._materialStrings,e,N.premultiplied(_.color()),_.opacity());for(let h=0,g=a.length;h<g;h=h+1)a[h].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,d,a[h].bufferArea,i),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let h=Q.new3(_.transform()).scaledBy3(1/n.x(),1/n.y()),g=_.asVolatilePaint();if(g!=null){d=this._lerpGradientPaintMaterial;let m=this._findOrCreateGradientData(g.from()).texture(this._context),A=this._findOrCreateGradientData(g.to()).texture(this._context);m.setFormat(Fe.RGBA_LINEAR_CLAMP),A.setFormat(Fe.RGBA_LINEAR_CLAMP),Uv(d,this._materialStrings,h,e,$d.get(_.type()),_.opacity(),g.t(),m,A)}else{let m=_.asSinglePaint();d=this._gradientPaintMaterial;let A=this._findOrCreateGradientData(m).texture(this._context);Gv(d,this._materialStrings,h,e,$d.get(_.type()),_.opacity(),A)}for(let m=0,A=a.length;m<A;m=m+1)a[m].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,d,a[m].bufferArea,i),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let h=Q.new2().scaledBy3(1/n.x(),1/n.y()),g=_.asVolatilePaint();if(g!=null){let m=this.getImageToDraw(g.from(),n,e,h,g.from().imageScaleMode(),o);if(m!=null){let A=Q.new2(),S,T=null,R=!0;if(g.from().image()==g.to().image()&&!(g.from().imageScaleMode()=="TILE"||g.to().imageScaleMode()=="TILE"))d=this._imageMaterial,g.colorAdjustIsActive()&&(d=this._imageColorAdjustMaterial,g.colorAdjustSetData(d)),A=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g,n,h);else{let O=this.getImageToDraw(g.to(),n,e,h,g.to().imageScaleMode(),o);O==null?R=!1:(d=this._lerpImageMaterial,g.colorAdjustIsActive()&&(d=this._lerpImageColorAdjustMaterial),A=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g.from(),n,h),T=this._delegate.getOrCreateImageTexture(O),S=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g.to(),n,h),T!=null&&this._setupClampingForImageOrGIF(O.image,T))}let b=this._delegate.getOrCreateImageTexture(m);if(R&&b!=null){this._setupClampingForImageOrGIF(m.image,b),d===this._lerpImageMaterial&&T!=null&&S!=null?Vv(d,this._materialStrings,e,A,S,b,T,g.opacity(),Ye.double_clamp(g.t(),0,1),this._shouldEmulateWrapAddress(_)):d===this._lerpImageColorAdjustMaterial&&T!=null&&S!=null?kv(d,this._materialStrings,e,A,S,b,T,g.opacity(),Ye.double_clamp(g.t(),0,1),g,this._shouldEmulateWrapAddress(_)):jd(d,this._materialStrings,e,A,b,g.opacity(),this._shouldEmulateWrapAddress(_));for(let O=0,f=a.length;O<f;O=O+1)a[O].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,d,a[O].bufferArea,i),this._delegate.markDidDraw())}}}else{let m=_.asSinglePaint(),A=null;if(A=this.getOrCreateVideoTexture(m),A==null){let S=this.getImageToDraw(m,n,e,h,m.imageScaleMode(),o);S!=null&&(A=this._delegate.getOrCreateImageTexture(S),A!=null&&this._setupClampingForImageOrGIF(S.image,A))}if(A!=null){let S=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m,n,h);m.colorAdjustIsActive()?(d=this._imageColorAdjustMaterial,Hv(d,this._materialStrings,e,S,A,m.opacity(),m,this._shouldEmulateWrapAddress(_))):(d=this._imageMaterial,jd(d,this._materialStrings,e,S,A,m.opacity(),this._shouldEmulateWrapAddress(_)));for(let T=0,R=a.length;T<R;T=T+1)a[T].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,d,a[T].bufferArea,i),this._delegate.markDidDraw())}}break}case"EMOJI":{let h=_.asSinglePaint();if(h==null)continue;let g=this._delegate.getOrCreateImageTexture(new as(h.image(),2));if(h.decodedImageIsReady()||(g=null),g!=null){let m=g;d=this._imageMaterial;let A=l.size(),S=l.topLeft(),T=l.center(),R=Q.new2();r.rotation!=null&&r.rotation!=0&&r.unrotatedGlyphSize!=null&&(A=new F(r.unrotatedGlyphSize.x(),r.unrotatedGlyphSize.y()),S=T.subtract(A.divideScalar(2)),R=R.translatedBy1(T).rotatedBy(r.rotation).translatedBy2(-T.x(),-T.y()));let b=new F(1,1).divide(A),O=Q.new2().scaledBy3(b.x(),b.y()).translatedBy2(-S.x(),-S.y()).multipliedBy1(R);jd(d,this._materialStrings,e,O,m,h.opacity(),this._shouldEmulateWrapAddress(_)),m!=null&&m.setFormat(Fe.RGBA_NEAREST_CLAMP);for(let f=0,I=a.length;f<I;f=f+1)a[f].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,d,a[f].bufferArea,i),this._delegate.markDidDraw())}break}case"PATTERN":{d=this._solidColorMaterial,Xd(d,this._materialStrings,e,N.WHITE,0);for(let h=0,g=a.length;h<g;h=h+1)a[h].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,d,a[h].bufferArea,i),this._delegate.markDidDraw());break}}}}_shouldEmulateWrapAddress(e){let r=!1,n=e.asVolatilePaint();return n!=null?n.eitherPaint(o=>o.imageScaleMode()=="TILE")&&(r=!0):e.asSinglePaint()!=null&&(r=e.asSinglePaint().imageScaleMode()=="TILE"),r}_setupRepeatingForImage(e,r){let n=this._shouldEmulateWrapAddress(e);r.setUniformInt(this._materialStrings.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,n?1:0),r.setUniformInt(this._materialStrings.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,n?0:1)}_setupClampingForImageOrGIF(e,r){e.isGIF()?r.setFormat(Fe.RGBA_LINEAR_CLAMP):e.isCompressedTexture()||r.setFormat(Fe.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,r,n){let o=r.path().triangles(this._bufferPool,bt.getPositionF2CoordF3()),i=this._stencilMaterial;Bv(i,this._materialStrings,e);for(let a=0,s=o.length;a<s;a=a+1)o[a].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,i,o[a].bufferArea,It.KEEP,n),this._delegate.markDidDraw())}renderStencilGeometryInstanced(e,r,n){let o=!1,i=r.path().triangles(this._bufferPool,bt.getPositionF2CoordF3());if(e.instanceBuffer){let a=this._stencilMaterialInstanced;ye.Material_setUniformMat32(a,Br.instance().SHADER_NAME_CANVAS_SPACE_TO_CLIP_SPACE_TRANSFORM,e.canvasToClipSpaceTransform);for(let s=0,l=i.length;s<l;s=s+1)i[s].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,a,i[s].bufferArea,It.KEEP,n,e.instanceBuffer),o=!0)}else{let a=e.instanceTransforms.length,s=this._stencilMaterial,l=this._delegate.currentTile(),c=l.tileSize(),d=l.scissor(),u=Q.new2().scaledBy2(c).multipliedBy1(e.canvasToTileSpaceTransform).multipliedBy1(e.nodeTransform),p=L.new3(r.path().bounds());for(let _=0;_<a;_++){let h=e.instanceTransforms[_],m=u.clone().multipliedBy1(h).transformRect(p.clone());if(!d.overlaps(m))continue;let S=e.canvasToClipSpaceTransform.clone().multipliedBy1(h);Bv(s,this._materialStrings,S);for(let T=0,R=i.length;T<R;T=T+1)i[T].bufferArea!=null&&(this._delegate.drawToCurrentTile(ze.TRIANGLES,s,i[T].bufferArea,It.KEEP,n),o=!0)}}o&&this._delegate.markDidDraw()}_checkShouldFlushAfterStencilCover(){return!!U.shouldFlushAfterStencilCover()}renderCoverQuad(e,r,n,o,i,a,s,l){let c=r.paints;if(c.length==0){this.renderStencilQuad(e,n,a),this._shouldFlushAfterStencilCover&&this._context.flush();return}let d=Q.new3(e).translatedBy1(n.topLeft()).scaledBy1(n.size()),u=this.uvTransformFromBounds(n,o),p;for(let _=0,h=c.length;_<h;_=_+1){let g=c[_],m=_+1==h;if(!m&&this.canSkipPaint(e,u,g,n))continue;let A=m?a:i;switch(g.type()){case"SOLID":{p=this._solidColorMaterial,Xd(p,this._materialStrings,d,N.premultiplied(g.color()),g.opacity()),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,p,this._quadArea,l,A),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let S=Q.new3(g.transform()).multipliedBy1(u),T=g.asVolatilePaint();if(T!=null){p=this._lerpGradientPaintMaterial;let R=this._findOrCreateGradientData(T.from()).texture(this._context),b=this._findOrCreateGradientData(T.to()).texture(this._context);Uv(p,this._materialStrings,S,d,$d.get(g.type()),g.opacity(),T.t(),R,b)}else{let R=g.asSinglePaint();p=this._gradientPaintMaterial;let b=this._findOrCreateGradientData(R).texture(this._context);Gv(p,this._materialStrings,S,d,$d.get(g.type()),g.opacity(),b)}this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,p,this._quadArea,l,A),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let S=Q.new3(u).scaledBy3(1/n.size().x(),1/n.size().y()),T=!0,R=!1,b=g.asVolatilePaint();if(b!=null){let O=this.getImageToDraw(b.from(),o,e,S,b.from().imageScaleMode(),s);if(O!=null){let f=Q.new2(),I,y=null;if(b.from().image()==b.to().image()&&!(b.from().imageScaleMode()=="TILE"||b.to().imageScaleMode()=="TILE"))p=this._imageMaterial,b.colorAdjustIsActive()&&(p=this._imageColorAdjustMaterial,b.colorAdjustSetData(p)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b,o,u);else{p=this._lerpImageMaterial,b.colorAdjustIsActive()&&(p=this._lerpImageColorAdjustMaterial),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b.from(),o,u);let E=this.getImageToDraw(b.to(),o,e,S,b.to().imageScaleMode(),s);E==null?T=!1:(y=this._delegate.getOrCreateImageTexture(E),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b.to(),o,u),y!=null&&y.setFormat(Fe.RGBA_NEAREST_CLAMP))}let P=this._delegate.getOrCreateImageTexture(O);T&&P!=null&&(P!=null&&P.setFormat(Fe.RGBA_NEAREST_CLAMP),p===this._lerpImageMaterial&&y!=null&&I!=null?Vv(p,this._materialStrings,d,f,I,P,y,b.opacity(),Ye.double_clamp(b.t(),0,1),this._shouldEmulateWrapAddress(g)):p===this._lerpImageColorAdjustMaterial&&y!=null&&I!=null?kv(p,this._materialStrings,d,f,I,P,y,b.opacity(),Ye.double_clamp(b.t(),0,1),b,this._shouldEmulateWrapAddress(g)):jd(p,this._materialStrings,d,f,P,b.opacity(),this._shouldEmulateWrapAddress(g)),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,p,this._quadArea,l,A),this._delegate.markDidDraw(),R=!0)}}else{let O=g.asSinglePaint(),f=null,I=!1;if(f=this.getOrCreateVideoTexture(O),f==null){let y=this.getImageToDraw(O,o,e,S,O.imageScaleMode(),s);y!=null&&(f=this._delegate.getOrCreateImageTexture(y),I=y.image.isCompressedTexture())}if(f!=null){let y=this.allocateObjectSpaceToNormalizedImageSpaceTransform(O,o,u);I||f.setFormat(Fe.RGBA_NEAREST_CLAMP),O.colorAdjustIsActive()?(p=this._imageColorAdjustMaterial,this._setupRepeatingForImage(g,p),Hv(p,this._materialStrings,d,y,f,O.opacity(),O,this._shouldEmulateWrapAddress(g))):(p=this._imageMaterial,this._setupRepeatingForImage(g,p),jd(p,this._materialStrings,d,y,f,O.opacity(),this._shouldEmulateWrapAddress(g))),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,p,this._quadArea,l,A),this._delegate.markDidDraw(),R=!0}}m&&!R&&(Xd(this._solidColorMaterial,this._materialStrings,d,N.TRANSPARENT,0),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,this._solidColorMaterial,this._quadArea,l,A),this._delegate.markDidDraw());break}case"EMOJI":{xe("Emoji should always be rendered by renderGeometryDirectly");break}case"PATTERN":{p=this._solidColorMaterial,Xd(p,this._materialStrings,d,N.WHITE,0),this._delegate.drawToCurrentTile(ze.TRIANGLE_STRIP,p,this._quadArea,l,A),this._delegate.markDidDraw();break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,r,n){let o=e.allocateImageTransformForGeometrySize(r);return Q.new2().multipliedBy1(o).multipliedBy1(n)}getImageToDraw(e,r,n,o,i,a){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new as(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new as(e.image(),0));let s=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,l=!1;if(e.imageThumbnail()==null)l=!0;else if(s!=null){let c=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,r,o),d=Q.new3(c);d.invert();let u=Q.new2().scaledBy2(a).multipliedBy1(n).multipliedBy1(d).scaledBy3(1/s.width(),1/s.height()),p=u.axisX().length(),_=u.axisY().length();l=Math.max(_,p)>1||e.image()!=null&&e.image().isGIF(),i=="TILE"&&(l=!0)}if(l&&(this._delegate.getOrCreateImageTexture(new as(e.image(),0)),e.decodedImageIsReady())){let c=e.decodedImage();if(c!=null)return new as(c,0)}if(s!=null)return new as(s,1);if(e.decodedImageIsReady()){let c=e.decodedImage();if(c!=null)return new as(c,0)}return null}getOrCreateVideoTexture(e){var r;return(r=e==null?void 0:e.video())==null?void 0:r.getOrCreateTexture(e,this._context,Fe.RGBA_NEAREST_CLAMP)}};var Lf=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){var e;this.isEnabled()&&((e=this._invalidateFn)==null||e.call(this),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){var e;this.isEnabled()&&(this._isPlaying=!0,(e=this._invalidateFn)==null||e.call(this))}pause(){this.isEnabled()&&(this._isPlaying=!1)}forward(){var e;this.isEnabled()&&(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),(e=this._invalidateFn)==null||e.call(this))}backward(){var e;this.isEnabled()&&(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),(e=this._invalidateFn)==null||e.call(this))}rewind(){var e;this.isEnabled()&&(this._maxLayersToRender=1,(e=this._invalidateFn)==null||e.call(this))}increaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){var e;this.isEnabled()&&this._isPlaying&&(this._maxLayersToRender>=this._totalLayersInRenderTree||((e=this._invalidateFn)==null||e.call(this),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay)))}_filterCompositeTileGridNodes(e){if(e==null)return null;switch(e.op()){case 0:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new ua(n,r.flags):null}case 2:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new mi(n):null}case 1:{let r=e,n=[];for(let o=0,i=r.children.length;o<i;o=o+1){let a=this._filterCompositeTileGridNodes(r.children[o]);a&&n.push(a)}return new Le(n,r.isFirstChildSolidBackground())}case 3:case 4:case 16:return e;case 5:{let r=e,n=this._filterCompositeTileGridNodes(r.alpha),o=this._filterCompositeTileGridNodes(r.color);return n!=null&&o!=null?new In(n,o,r.type,r.innerShadowFill,r.innerShadowAlphaRequiresHardMask):null}case 6:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new Yn(r.blurOpType,r.startRadius,r.endRadius,r.startPoint,r.endPoint,n,r.clamp):null}case 7:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new Fo(r.blendMode,r.opacity,n):null}case 9:{let r=e,n=this._filterCompositeTileGridNodes(r.alpha);return n!=null?new fi(n,r.color):null}case 8:{let r=e;return this._filterCompositeTileGridNodes(r.tree)}case 10:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new mt(n,r.id,r.property,r.getter):null}case 11:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new so(n,r.transform):null}case 12:{let r=e,n=r.startChild?this._filterCompositeTileGridNodes(r.startChild):null,o=r.endChild?this._filterCompositeTileGridNodes(r.endChild):null;return new Qn(n,o,r.id,r.progressFn)}default:throw new Error(`Unhandled node op ${_n[e.op()]}`)}return null}_renderTreeWithNLayers(e,r){let n=(a,s)=>new ao(a,s);if(r<=0)return n(null,0);let o=[];switch(e.op()){case 0:{let a=e;o.push(a.child);break}case 2:{let a=e;o.push(a.child);break}case 1:{let a=e;for(let s=0,l=a.children.length;s<l;s=s+1){let c=a.children[s];o.push(c)}break}case 3:case 4:case 16:return n(e,r-1);case 5:{let a=e;o.push(a.color),o.push(a.alpha);break}case 6:{let a=e;o.push(a.child);break}case 7:{let a=e;o.push(a.child);break}case 9:{let a=e;o.push(a.alpha);break}case 8:{let a=e;o.push(a.tree);break}case 10:{let a=e;o.push(a.child);break}case 11:{let a=e;o.push(a.child);break}case 12:{let a=e;a.startChild&&o.push(a.startChild),a.endChild&&o.push(a.endChild);break}default:throw new Error(`Unhandled node op ${_n[e.op()]}`)}let i=[];for(let a=0,s=o.length;a<s;a=a+1){let l=o[a],c=this._renderTreeWithNLayers(l,r);if(r=c.b,c.a!=null&&i.push(c.a),r<=0)return n(new Le(i).optimized(),0)}return this._isRenderableLayer(e)?r>0?n(e,r-1):n(new Le(i).optimized(),0):n(e,r)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let r=0;switch(e.op()){case 0:{let n=e;r=r+this._countLayers(n.child);break}case 2:{let n=e;r=r+this._countLayers(n.child);break}case 1:{let n=e;for(let o=0,i=n.children.length;o<i;o=o+1){let a=n.children[o];r=r+this._countLayers(a)}break}case 3:case 4:case 16:break;case 5:{let n=e;r=r+this._countLayers(n.alpha),r=r+this._countLayers(n.color);break}case 6:{let n=e;r=r+this._countLayers(n.child);break}case 7:{let n=e;r=r+this._countLayers(n.child);break}case 9:{let n=e;r=r+this._countLayers(n.alpha);break}case 8:{let n=e;r=r+this._countLayers(n.tree);break}case 10:{let n=e;r=r+this._countLayers(n.child);break}case 11:{let n=e;r=r+this._countLayers(n.child);break}case 12:{let n=e;n.startChild&&(r=r+this._countLayers(n.startChild)),n.endChild&&(r=r+this._countLayers(n.endChild));break}default:throw new Error(`Unhandled node op ${_n[e.op()]}`)}return this._isRenderableLayer(e)&&(r=r+1),r}treeToRender(e){let r=e;if(!this.isEnabled())return r;r!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(r),this._filteredTree=this._filterCompositeTileGridNodes(r),this._originalTree=r);let n=this._filteredTree!=null?this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a:null;return n!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+(n==null?void 0:n.debugString1())),this._lastTreeToRender=n,n}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};function XV(t){return t&255}function jV(t){return t>>8&255}function ZV(t){return t>>16&255}function JV(t){return t>>24&255}function $V(t){return XV(t)/255}function ek(t){return jV(t)/255}function tk(t){return ZV(t)/255}function rk(t){return JV(t)/255}function Mf(t){return{red:$V(t),green:ek(t),blue:tk(t),alpha:rk(t)}}var yx=new FinalizationRegistry(t=>{var e;t.value!==0&&((e=v())==null||e.modules().tileStackTileBindings.release(t.value))}),eu=class{constructor(){this._clearColor=null;this._scissorForClear=null;this._scissor=ar.FrozenRect_EMPTY;this._wasmTileStackTile=null;this._handle=null;if(arguments[0]==0){let[,e,r,n,o,i,a]=arguments;this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=o,this._framebuffer=this._context.createFramebuffer(this._context.createTexture(Fe.RGBA_LINEAR_CLAMP,e,e,fr.TILE_STACK),n,r),this._tileConfig=i,this._viewport=new L(0,0,e,e),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=a,this._isColorTransparent=!0,U.useWasmTileStackTile()&&(U.useUnifiedRenderer()?this._handle={value:v().modules().tileStackTileBindings.createBackedByWasmSingleTileTexture(e,this._framebuffer.handle())}:this._handle={value:v().modules().tileStackTileBindings.createBackedBySingleTileTexture(e)},this._wasmTileStackTile=v().modules().tileStackTileBindings.lookup(this._handle.value),yx.register(this,this._handle))}else if(arguments[0]==1){let[e,r,n,o,i,a,s,l]=arguments;this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=n,this._tileConfig=s,this._framebuffer=o,this._viewport=new L(i.x()|0,i.y()|0,r,r),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=l,this._isColorTransparent=a,U.useWasmTileStackTile()&&(U.useUnifiedRenderer()?this._handle={value:v().modules().tileStackTileBindings.createBackedByWasmFramebuffer({x:i.x(),y:i.y(),width:i.width(),height:i.height()},this._framebuffer.handle(),a)}:this._handle={value:v().modules().tileStackTileBindings.createBackedByFramebuffer({x:i.x(),y:i.y(),width:i.width(),height:i.height()},this._framebuffer.bounds().width(),this._framebuffer.bounds().height(),a)},this._wasmTileStackTile=v().modules().tileStackTileBindings.lookup(this._handle.value),yx.register(this,this._handle))}}wasmTileStackTile(){return this._wasmTileStackTile}setScissor(e){if(U.useWasmTileStackTile()){this._wasmTileStackTile.setScissor({x:e.x(),y:e.y(),width:e.width(),height:e.height()});return}let r=new L(e.x()|0,e.y()|0,e.width()|0,e.height()|0);if(!this._isBackedBySingleTileTexture){let o=this._viewport;r.setX((o.x()|0)+r.x()),r.setY((o.y()|0)+r.y())}this._scissor=r;let n=this.scissorForClear()}uvSpaceRect(){if(U.useWasmTileStackTile()){let e=this._wasmTileStackTile.uvSpaceRect();return new L(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y)}if(this._isBackedBySingleTileTexture)return L.UNIT;{let e=this._viewport,r=this._framebuffer.colorTexture();return new L(e.x()/r.width(),e.y()/r.height(),e.width()/r.width(),e.height()/r.height())}}tileSize(){return U.useWasmTileStackTile()?this._wasmTileStackTile.size():this._viewport.width()|0}colorTextureForSampling(){return this.needsColorClear()?this._context.singleColorTextureManager().textureForColor(this.clearColor()):this._framebuffer.colorTexture()}backingColorTexture(){return this._framebuffer.colorTexture()}backingDepthStencilTexture(){return this._framebuffer.depthStencilTexture()}context(){return this._context}framebuffer(){return this._framebuffer}viewport(){if(U.useWasmTileStackTile()){let e=this._wasmTileStackTile.viewport();return new L(e.x,e.y,e.width,e.height)}return this._viewport}isBackedBySingleTileTexture(){return U.useWasmTileStackTile()?this._wasmTileStackTile.isBackedBySingleTileTexture():this._isBackedBySingleTileTexture}deleteTexture(){this._framebuffer.colorTexture().deleteTexture()}scissor(){if(U.useWasmTileStackTile()){let n=this._wasmTileStackTile.scissor();return new L(n.x,n.y,n.width,n.height)}let e=this._scissor;if(this._isBackedBySingleTileTexture)return e;let r=L.new3(e);return r.setX(r.x()-this._viewport.x()),r.setY(r.y()-this._viewport.y()),r}activeScissorRelativeToFramebuffer(){if(U.useWasmTileStackTile()){let e=this._wasmTileStackTile.scissorRelativeToFramebuffer();return new L(e.x,e.y,e.width,e.height)}return this._scissor}clearScissors(){this._scissor=ar.FrozenRect_EMPTY}clearToColor(e){if(this.needsColorClear()||this.needsDepthStencilClear()){let n=this.needsColorClear()&&this.needsDepthStencilClear()?Ar.ALL:this.needsColorClear()?Ar.COLOR:Ar.DEPTH_STENCIL;this.doDeferredClear(n)}if(e==N.TRANSPARENT&&this.isColorTransparent())return;let r=null;if(this._scissorForClear!=null)r=this._scissorForClear.clone();else if(!this._isBackedBySingleTileTexture){let n=this._viewport;r=new L(n.x()|0,n.y()|0,n.width()|0,n.height()|0)}this._context.clear(Ar.COLOR,e,this._framebuffer,r,this._viewport),this._isColorTransparent=e==N.TRANSPARENT}prepareForDraw(e){this._wasmTileStackTile.prepareForDraw(e.isEnabled)}doDeferredClear(e){let r=null;if(U.useWasmTileStackTile()){let o=this._wasmTileStackTile.scissorForClearPrepared();o&&(r=new L(o.x,o.y,o.width,o.height))}else if(this._scissorForClear!=null)r=this._scissorForClear.clone();else if(!this._isBackedBySingleTileTexture){let o=this._viewport;r=new L(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}let n;U.useWasmTileStackTile()?n=this.clearColor()??N.TRANSPARENT:n=this._clearColor!=null?this._clearColor:N.TRANSPARENT,this._context.clear(e,n,this._framebuffer,r,U.useWasmTileStackTile()?this.viewport():this._viewport),(e==Ar.ALL||e==Ar.COLOR)&&(U.useWasmTileStackTile()?(this._wasmTileStackTile.setIsColorTransparent(this._wasmTileStackTile.needsColorClearToTransparent()),this._wasmTileStackTile.setNeedsColorClear(null)):(this._isColorTransparent=this._clearColor==N.TRANSPARENT,this._clearColor=null)),(e==Ar.ALL||e==Ar.DEPTH_STENCIL)&&(U.useWasmTileStackTile()?this._wasmTileStackTile.setNeedsDepthStencilClear(!1):this._needsDepthStencilClear=!1)}setClearColor(e){if(U.useWasmTileStackTile()){this._wasmTileStackTile.setNeedsColorClear(e!==null?Mf(e):null);return}this._clearColor=e}clearColor(){if(U.useWasmTileStackTile()){let e=this._wasmTileStackTile.clearColor();return e?N.new3(e.red,e.green,e.blue,e.alpha):null}return this._clearColor}setNeedsColorClear(e){this._needsColorClear=e}needsColorClear(){return U.useWasmTileStackTile()?this._wasmTileStackTile.needsColorClear():this._clearColor!=null}needsColorClearToTransparent(){return U.useWasmTileStackTile()?this._wasmTileStackTile.needsColorClearToTransparent():this._clearColor==N.TRANSPARENT}setNeedsDepthStencilClear(e){if(U.useWasmTileStackTile()){this._wasmTileStackTile.setNeedsDepthStencilClear(e);return}this._needsDepthStencilClear=e}needsDepthStencilClear(){return U.useWasmTileStackTile()?this._wasmTileStackTile.needsDepthStencilClear():this._needsDepthStencilClear}setIsColorTransparent(e){if(U.useWasmTileStackTile()){this._wasmTileStackTile.setIsColorTransparent(e);return}this._isColorTransparent=e}isColorTransparent(){return U.useWasmTileStackTile()?this._wasmTileStackTile.isColorTransparent():this._isColorTransparent}setScissorForClear(e){if(U.useWasmTileStackTile()){e!==null&&this._wasmTileStackTile.setScissorForClear({x:e.x(),y:e.y(),width:e.width(),height:e.height()});return}this._scissorForClear=e}scissorForClear(){if(U.useWasmTileStackTile()){let e=this._wasmTileStackTile.scissorForClear();return e===null?null:new L(e.x,e.y,e.width,e.height)}return this._scissorForClear}downloadImage(){if(0)var e}};var bx=(n=>(n[n.REGULAR=0]="REGULAR",n[n.SUPERSAMPLING=1]="SUPERSAMPLING",n[n.DRAW_TO_SCREEN_LARGE_TILES=2]="DRAW_TO_SCREEN_LARGE_TILES",n))(bx||{}),Bf=class{constructor(e,r,n){this._maxUsedTilesPerDrawByTileSize=new Map;this._maxUsedTilesSinceResetByTileSize=new Map;this._context=e,this._tileConfig=n,this._tilePools=new Map([[this._tileConfig.baseTileSize,[]],[this._tileConfig.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=0;let o=this._tileConfig.baseTileSize;this._liveTileCount=new Map([[o,0],[this._tileConfig.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._transparentClearTexture=r;let i=this._tileConfig.SSAA_SIZE();this._defaultScissors=new Map([[this._tileConfig.baseTileSize,new L(0,0,this._tileConfig.baseTileSize,this._tileConfig.baseTileSize)],[this._tileConfig.SSAA_SIZE(),new L(0,0,this._tileConfig.SSAA_SIZE(),this._tileConfig.SSAA_SIZE())]])}debugString(){var e,r;return`TileStack(
        on stack:
            ${this._stack.filter(n=>n.tileSize()==this._tileConfig.baseTileSize).length} small,
            ${this._stack.filter(n=>n.tileSize()==this._tileConfig.SSAA_SIZE()).length} SSAA
            out of ${this._stack.length} tilestack tiles
        free pools:
            (${this._tileConfig.baseTileSize}, ${(e=this._tilePools.get(this._tileConfig.baseTileSize))==null?void 0:e.length}),
            (${this._tileConfig.SSAA_SIZE()}, ${(r=this._tilePools.get(this._tileConfig.SSAA_SIZE()))==null?void 0:r.length});
        total live:
            ${this._liveTileCount.get(this._tileConfig.baseTileSize)} small,
            ${this._liveTileCount.get(this._tileConfig.SSAA_SIZE())} SSAA;
        max used for tile:
            ${this._maxUsedTilesPerDrawByTileSize.get(this._tileConfig.baseTileSize)} small,
            ${this._maxUsedTilesPerDrawByTileSize.get(this._tileConfig.SSAA_SIZE())} SSAA;
        max used since reset:
            ${this._maxUsedTilesSinceResetByTileSize.get(this._tileConfig.baseTileSize)} small,
            ${this._maxUsedTilesSinceResetByTileSize.get(this._tileConfig.SSAA_SIZE())} SSAA;
        SSAA state: ${bx[this._tileSizeState]}
    )
    `}resetUsedTiles(){this._maxUsedTilesSinceResetByTileSize.clear()}reclaim(){let e=new Map,r=new Map;for(let[n,o]of this._tilePools){let i=this._maxUsedTilesSinceResetByTileSize.get(n)||0,a=o.length-i;if(e.set(n,a),r.set(n,o.length),U.shouldReclaimTileStackTiles()&&a>0){let s=o.pop();s&&s.deleteTexture(),this._liveTileCount.set(n,this._liveTileCount.get(n)?this._liveTileCount.get(n)-1:0),Re.trackDefinedEvent("mobile_platform.tilestack_tile_reclamation",{small_tiles_pool:r.get(this._tileConfig.baseTileSize),small_tiles_reclaimable:e.get(this._tileConfig.baseTileSize),ssaa_tiles_pool:r.get(this._tileConfig.SSAA_SIZE()),ssaa_tiles_reclaimable:e.get(this._tileConfig.SSAA_SIZE())})}}}setSSAARenderState(){this._tileSizeState=1}unsetSSAARenderState(){this._tileSizeState=0}setDrawToScreenLargeTileState(){this._tileSizeState=2}unsetDrawToScreenLargeTileState(){this._tileSizeState=0}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(e){return this._stack[e]}last(){return this._stack.length==0?null:le.List_last(this._stack)}assertPoolAfterRender(){for(let[e,r]of this._maxUsedTilesPerDrawByTileSize){let n=this._maxUsedTilesSinceResetByTileSize.get(e)||0;this._maxUsedTilesSinceResetByTileSize.set(e,Math.max(r,n))}this._maxUsedTilesPerDrawByTileSize.clear()}freeTileToPool(e){e.clearScissors(),e.setIsColorTransparent(!1),e.setClearColor(N.TRANSPARENT),e.setNeedsDepthStencilClear(!0),e.setScissorForClear(null),e.tileSize()==this._tileConfig.SSAA_SIZE()?this._tilePools.get(this._tileConfig.SSAA_SIZE()).push(e):this._tilePools.get(this._tileConfig.baseTileSize).push(e)}pushTile(e,r=N.TRANSPARENT,n=!0){let o=this._allocateTileFromPool();this._stack.push(o),o.setClearColor(r),o.backingColorTexture().hasContentBeenInitialized()||o.setClearColor(r??N.TRANSPARENT),o.backingDepthStencilTexture()!=null&&!o.backingDepthStencilTexture().hasContentBeenInitialized()&&o.setNeedsDepthStencilClear(!0),U.viewerScissorClear()&&o.setScissorForClear(e??this.defaultTileScissor()),o.setScissor(e)}pushTileAndClearToColor(e,r){this.pushTile(r,e)}pushTileBackedByExistingFramebuffer(e,r,n,o){let i=n.outputTextureNeedsClear,a=n.useLargeTilesForDrawToScreen?this._tileConfig.SSAA_SIZE():this._tileConfig.baseTileSize,s=!i,l=new eu(1,a,this._context,e,r,s,this._tileConfig,this._transparentClearTexture);this._stack.push(l),(i||o!=N.TRANSPARENT)&&l.setClearColor(o),l.setNeedsDepthStencilClear(i)}pushTileBackedByExistingFramebufferAndClearToColor(e,r,n,o){this.pushTileBackedByExistingFramebuffer(e,r,n,o)}popTile(){return this._stack.pop()??null}totalVRAM(){let e=0;this._sharedStencilTexture!=null&&(e=e+$n.Texture_totalVRAM(this._sharedStencilTexture));for(let r of this._tilePools.get(this._tileConfig.baseTileSize))e=e+$n.Texture_totalVRAM(r.backingColorTexture());for(let r of this._tilePools.get(this._tileConfig.SSAA_SIZE()))e=e+$n.Texture_totalVRAM(r.backingColorTexture());for(let r of this._stack)e=e+$n.Texture_totalVRAM(r.backingColorTexture());return e}_pool(){return this._tileSizeState==0?this._tilePools.get(this._tileConfig.baseTileSize):this._tilePools.get(this._tileConfig.SSAA_SIZE())}_size(){return this._tileSizeState==0?this._tileConfig.baseTileSize:this._tileConfig.SSAA_SIZE()}defaultTileScissor(){return this._defaultScissors.get(this._size())}_purpose(){return this._tileSizeState==0?"TileStack":this._tileSizeState==1?"SSAATileStack":"DrawToScreenLargeTiles"}_sizeState(){return this._tileSizeState}_allocateTileFromPool(){let e=this._pool(),r=this._size(),n=this._purpose(),o=this._sizeState(),i=null,a=this._maxUsedTilesPerDrawByTileSize.get(r)||0,s=this._stack.filter(l=>l.tileSize()==r).length+1;if(this._maxUsedTilesPerDrawByTileSize.set(r,Math.max(a,s)),e!=null&&e.length!=0)i=e.pop();else{this._liveTileCount.set(r,this._liveTileCount.get(r)+1);let l;o==0?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=this._context.createTexture(Fe.STENCIL,r,r,fr.TILE_STACK)),l=this._sharedStencilTexture):(o==1||o==2)&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=this._context.createTexture(Fe.STENCIL,r,r,fr.TILE_STACK)),l=this._sharedSSAAStencilTexture),i=new eu(0,r,n,l,this._context,this._tileConfig,this._transparentClearTexture)}return i}_isAllocatedUnusedTile(e){return e!=null&&e!=this.last()&&this._stack.indexOf(e)==-1&&this._tilePools.get(this._tileConfig.baseTileSize).indexOf(e)==-1&&this._tilePools.get(this._tileConfig.SSAA_SIZE()).indexOf(e)==-1}};var nk=1e-4;var n_;(o=>{function t(){return new Map}o._new=t;function e(i,a){i.set(a.hash(),a)}o.add=e;function r(i){let a=i;return Array.from(a.values())}o.asList=r;function n(i,a){let s=a,l=i;qe.StringMap_each(s,(c,d)=>{l.set(c,d)})}o.addAllImagesInSet=n})(n_||(n_={}));var Gf=class{constructor(e,r,n){this.includesBackgroundColor=e,this.status=r,this.neededImagesOrNull=n}},Uf=class{constructor(e,r,n){this._frameBudgetInformation=null;this._interruptedCommands=new Array;this._interruptArgs=null;this._cleanUpInterruptCallback=null;this._currentlyInDissolveCounter=0;this._currentlyInVolatilePropertyCounter=0;this._currentlyInPatternFillCounter=0;this._canvasToPixelsScale=1;this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=L.INVALID,this._neededImagesOrNull=null,this._ssaaState=new Yv,this._downsampleNeedsBlend=!1,this._antialiasingStrategy=0,this._requestImage=null,this._layerByLayerRendering=new Lf,this._context=e,this._bufferPool=r,this._materialStrings=Br.instance(),this._quadArea=this._bufferPool.allocateSmallManagedArea(ze.TRIANGLE_STRIP,bt.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.singleColorTextureManager().emptyTexture(),this._tileConfig=n,this._tileStack=new Bf(e,this._transparentClearTexture,this._tileConfig),this._pathRasterizer=new wf(this,this._context,this._tileConfig,this._bufferPool);let o=this._context.graphicsCardName();this._flushBeforeMasks=(o.indexOf("NVIDIA")!=-1&&o.indexOf("Direct3D11")!=-1||U.getFeatureFlags().flush_before_masks)??!1,this._noiseMaterial=this._context.createMaterial("noise",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_NOISE_EFFECT_FRAGMENT),this._glassMaterial=this._context.createMaterial("glass",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_GLASS_FRAGMENT),this._glassNonUniformCornerRadiiMaterial=this._context.createMaterial("glassNonUniformCornerRadii",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_GLASS_NON_UNIFORM_CORNER_RADII_FRAGMENT),this._clampedBlurMaterial=this._context.createMaterial("clampedBlurTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlurTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT),this._unclampedGrainMaterial=this._context.createMaterial("unclampedGrain",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UNCLAMPED_GRAIN_FRAGMENT),this._clampedGrainMaterial=this._context.createMaterial("clampedGrain",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_CLAMPED_GRAIN_FRAGMENT),this._clampedGradientBlurMaterial=this._context.createMaterial("clampedGradientBlur",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_CLAMPED_GRADIENT_BLUR_TILE_FRAGMENT),this._unclampedGradientBlurMaterial=this._context.createMaterial("unclampedGradientBlur",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UNCLAMPED_GRADIENT_BLUR_TILE_FRAGMENT),this._upscaleAndBlendGradientBlurTileMaterial=this._context.createMaterial("upscaleAndBlendGradientBlurTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UPSAMPLE_AND_BLEND_GRADIENT_BLUR_TILE_FRAGMENT),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_RECTANGLE_BLUR_VERTEX,this._materialStrings.SHADER_SOURCE_RECTANGLE_BLUR_FRAGMENT),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX,this._materialStrings.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_UPSAMPLE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UPSAMPLE_TILE_FRAGMENT),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_DOWNSAMPLE_TILE_FRAGMENT),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT),this._blendTextureMaterial=this._context.createMaterial("blendTexture",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_TILE_FRAGMENT),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_BLEND_MODE_FRAGMENT),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT),this._maskTileMaterial=this._context.createMaterial("maskTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_FRAGMENT),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT),this._drawTextureMaterial=this._context.createMaterial("drawTexture",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_DRAW_TEXTURE_VERTEX,this._materialStrings.SHADER_SOURCE_DRAW_TEXTURE_FRAGMENT),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.SHADER_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT),this._imagePatternMaterial=this._context.createMaterial("imagePattern",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_PATTERN_FRAGMENT),this._imagePatternSingleMaterial=this._context.createMaterial("imagePatternSingle",St.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_FRAGMENT)}context(){return this._context}bufferPool(){return this._bufferPool}resetTileStackUsage(){this._tileStack.resetUsedTiles()}reclaimTileStack(){this._tileStack.reclaim()}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}debugString(){return`RTRenderer(vram: path=${this._pathRasterizer.totalVRAM()}, tileStack=${this._tileStack.totalVRAM()}; tileStack: ${this._tileStack.debugString()})`}upscaleRectForSSAA(e){let r=this._tileConfig.SSAA_SIZE()/this._tileConfig.baseTileSize|0;return e.scaledBy1(r)}downscaleRectForSSAA(e){let r=this._tileConfig.baseTileSize/this._tileConfig.SSAA_SIZE();return e.scaledBy1(r)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){var e;return((e=this._currentTile1())==null?void 0:e.tileSize())??0}defaultTileScissor(){return this._tileStack.defaultTileScissor()}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){if(this._antialiasingStrategy===0){xe("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?0:1;let r;this._tileStack.isEmpty()?r=this._tileStack.defaultTileScissor():r=this.upscaleRectForSSAA(this._currentTile1().scissor().clone()),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(r),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTile(r))}this._ssaaState!=null&&(this._ssaaState.level+=1)}popSSAARenderState(){if(this._antialiasingStrategy===0){xe("Popping SSAA state during final composite");return}if(this._ssaaState!=null&&(this._ssaaState.level-=1),this._ssaaState.level==0){let e=this._tileStack.popTile();this._tileStack.unsetSSAARenderState();let r;this._downsampleNeedsBlend?r=It.COPY:r=It.PREMULTIPLIED,this.downsampleSuperSSAATile(e,r),this._tileStack.freeTileToPool(e)}}supersampleState(){return this._ssaaState}currentTile(e){return e===void 0?this._currentTile1():this._currentTile2(e)}computeTileTransform(){return Q.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new F(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return this._tileSize/this._canvasSpaceTileBounds.size().x()}drawTileContinued(e,r,n,o,i,a,s,l){return Re.perfTimerScope("tile-render-continued-viewer",Re.ProfileLevel.LOW,()=>{this._canvasSpaceTileBounds=new L(r,n,o,o),this._canvasToPixelsScale=i,this._boundsCache=s.boundsCache;let c=this.computeTileTransform(),d=new Vf(s.renderTree,c,this._interruptArgs.framebuffer,this._interruptArgs.originalOutputTextureFormat);if(!d.equals(this._interruptArgs)||this._interruptedCommands.length==0)return xe("Clearing interrupt state, prototype in potentially precarious state."),null;this._interruptArgs.framebuffer.colorTexture().format()!=Fe.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(Fe.RGBA_LINEAR_CLAMP);let p=this._interruptedCommands;return this._interruptedCommands=new Array,this._frameBudgetInformation=l,p.forEach(h=>{if(this._interruptedCommands.length>0)this._interruptedCommands.push(h);else switch(h.type){case 1:let m=h;this.visitWithCanvasSpaceTileBounds(m.node,m.transform,m.canvasSpaceTilebounds,m.inverseVolatileTransform,m.interruptIndex);break;case 2:let A=h;this.currentTile().setScissor(A.scissor);break;case 3:let S=h;this.visitGroupChildWithSSAA(S.node,S.transform,S.canvasSpaceTileBounds,S.inverseVolatileTransform);break;case 4:let T=h;this.renderBlend(T.blendIsNoOp,T.node,T.transform,T.canvasSpaceTileBounds,T.inverseVolatileTransform,1,T.oldScissor);break;default:}}),this._interruptedCommands.length>0?this._interruptArgs=d:this.currentTile().setScissor(ar.FrozenRect_EMPTY),this._interruptedCommands.length==0&&this._interruptArgs.originalOutputTextureFormat!=Fe.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat),this.drawTileFinish(d,e,this._interruptArgs.framebuffer)})}cleanUpExistingInterrupt(){var r,n;for(this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtClearedExistingInterrupt=!0,((r=this._interruptArgs)==null?void 0:r.originalOutputTextureFormat)!=Fe.RGBA_LINEAR_CLAMP&&((n=this._interruptArgs)==null||n.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat)),this._interruptedCommands=new Array,this._interruptArgs=null,this._frameBudgetInformation=null,this._cleanUpInterruptCallback=null,this._currentlyInDissolveCounter=0,this._currentlyInVolatilePropertyCounter=0,this._currentlyInPatternFillCounter=0;this._tileStack.count()>0;)if(this._tileStack.count()==1&&!this._tileStack.last().isBackedBySingleTileTexture()){this.currentTile().setScissor(ar.FrozenRect_EMPTY),U.useWasmTileStackTile()&&U.useUnifiedRenderer()?this._currentTile1().prepareForDraw(gr.NONE):this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(Ar.COLOR);let o=this._tileStack.popTile();this._tileStack.assertPoolAfterRender()}else this._tileStack.freeTileToPool(this._tileStack.popTile())}drawTile(e,r,n,o,i,a,s,l,c){return this._canvasToPixelsScale=i,this._context.annotateAndReturn(`Draw tile (${r}, ${n})`,()=>{this._interruptArgs!=null&&this._cleanUpInterruptCallback!=null&&this._cleanUpInterruptCallback();let d=a.colorTexture().format();s.useLargeTilesForDrawToScreen&&this._tileStack.setDrawToScreenLargeTileState(),s.antialiasingStrategy,0,d!=Fe.RGBA_LINEAR_CLAMP&&a.colorTexture().setFormat(Fe.RGBA_LINEAR_CLAMP),this._requestImage=s.requestImage,this._boundsCache=s.boundsCache,this._canvasSpaceTileBounds=new L(r,n,o,o),this._tileSize=s.useLargeTilesForDrawToScreen?this._tileConfig.SSAA_SIZE():this._tileConfig.baseTileSize,this._antialiasingStrategy=s.antialiasingStrategy,this._neededImagesOrNull=s.shouldCollectNeededImages?n_._new():null;let u=this.computeTileTransform(),p=s.renderTree;this._frameBudgetInformation=l;let _=new Vf(p,u,a,d);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=p!=null&&this.nodeNeedsBackgroundColor(p,u),this._includesBackgroundColor){let g=N.premultiplied(N.TRANSPARENT);this._tileStack.pushTileBackedByExistingFramebufferAndClearToColor(a,e,s,g)}else{let g=s.outputTextureNeedsClear?N.TRANSPARENT:null;this._tileStack.pushTileBackedByExistingFramebuffer(a,e,s,g)}if(p!=null){let g=this.allocateAndComputeTileScissor(u,this.bounds(p)),m=this._tileStack.last().scissor();this._tileStack.last().setScissor(g);let A=Q.new2();this.visit(p,Q.new3(u),A,0),this._interruptedCommands.length==0&&this._tileStack.last().setScissor(m)}this._interruptedCommands.length>0&&(this._interruptArgs=_,this._cleanUpInterruptCallback=c);let h=this.drawTileFinish(_,e,a);return this._interruptedCommands.length==0&&d!=Fe.RGBA_LINEAR_CLAMP&&a.colorTexture().setFormat(d),s.useLargeTilesForDrawToScreen&&this._tileStack.unsetDrawToScreenLargeTileState(),h})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,r,n,o,i,a){if(n instanceof Fi&&(n=n.bufferArea()),i==null&&(i=gr.NONE),U.useWasmTileStackTile()&&U.useUnifiedRenderer())this._currentTile1().prepareForDraw(i);else{let s=this._currentTile1().needsColorClear(),l=(i==null?void 0:i.isEnabled)&&this._currentTile1().needsDepthStencilClear();if(s||l){let c=s&&l?Ar.ALL:s?Ar.COLOR:Ar.DEPTH_STENCIL;this._currentTile1().doDeferredClear(c)}}a==null||a==null?this._context.draw(e,r,n,o,i,this._currentTile1().framebuffer(),this._currentTile1().activeScissorRelativeToFramebuffer(),this._currentTile1().viewport()):this._context.drawInstanced(e,r,n,a,o,i,this._currentTile1().framebuffer(),this._currentTile1().activeScissorRelativeToFramebuffer(),this._currentTile1().viewport()),this._currentTile1().setIsColorTransparent(!1)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.dependsOnBackgroundContent()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,r){let n=L.new3(this.bounds(e));r.transformRect(n);let o=L.UNIT.overlaps(n);if(e==null||!this._needsBackgroundColor(e)||!o)return!1;if(e.op()==1){let i=e;for(let a of i.children){let s=L.new3(this.bounds(a)),l=L.UNIT.overlaps(r.transformRect(s));if(this._needsBackgroundColor(a)&&l)return!0}return!1}return!0}drawTileFinish(e,r,n){if(this._interruptedCommands.length==0){U.useWasmTileStackTile()&&U.useUnifiedRenderer()?this._currentTile1().prepareForDraw(gr.NONE):this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(Ar.COLOR);let o=this._tileStack.popTile();this._interruptArgs=null,this._cleanUpInterruptCallback=null,this._tileStack.assertPoolAfterRender()}return this._frameBudgetInformation=null,new Gf(this._includesBackgroundColor,this._interruptedCommands.length>0?1:0,this._neededImagesOrNull)}checkIfNodeIsNotInTileWithNonAABBTransform(e,r,n=!1){if(r.isAxisAligned(nk))return!1;let o=U.nonAABBRenderingCheck();if(rt.didEncounterNonAxisAlignedTransform(o),!o&&!n)return!1;let i=L.new3(this._currentTile1().scissor()).intersectedWith(this._tileStack.defaultTileScissor());if(i.width()<=0||i.height()<=0)return!0;let a=i.scaledBy1(1/this._currentTile1().tileSize()),s=new us(a),l=Q.new3(r);if(!l.invert())return!1;let c=s.transform(l),d=this.bounds(e),u=c.points();for(let p of u)if(d.contains2(p))return!1;for(let p of new us(L.fromRect(d)).points())if(p.isContainedInSimpleHull(u))return!1;for(let p=0;p<u.length;p++){let _=(p+1)%u.length,h=u[p],g=u[_];if(d.intersectsLineSegment(h,g))return!1}return!0}visit(e,r,n,o){let i=L.new3(L.UNIT),a=Q.new3(r);a.invert();let s=a.transformRect(i);this.visitWithCanvasSpaceTileBounds(e,r,s,n,o)}visitWithCanvasSpaceTileBounds(e,r,n,o,i){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,r,n,o,i)})}_canSkipNodeOutsideScissor(e,r){if(this._currentTile1()==null)return!1;let n=L.new3(this._currentTile1().scissor());return n.equals(this._tileStack.defaultTileScissor())?!1:!n.scaledBy1(1/this._currentTile1().tileSize()).overlaps(r.transformRect(L.new3(this.bounds(e))))}_visitWithCanvasSpaceTileBounds(e,r,n,o,i){var s,l,c,d;if(n.overlaps(this.bounds(e))&&!this._currentTile1().scissor().isEmpty()&&!(i<1&&(this._canSkipNodeOutsideScissor(e,r)||this.checkIfNodeIsNotInTileWithNonAABBTransform(e,r)))){if(this._frameBudgetInformation){if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Ro(e,r,n,o,i));return}else if(!this._frameBudgetInformation.permitsMoreWork()){rt.didEncounterIntraTileInterrupt();let u=this._ssaaState.level!=0||this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,p=this._currentlyInDissolveCounter>0,_=this._currentlyInVolatilePropertyCounter>0,h=this._currentlyInPatternFillCounter>0;if(!_&&!p&&!u&&!h){this._interruptedCommands.push(new Ro(e,r,n,o,i));return}}}switch(e.op()){case 0:{let u=e;this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}case 2:{let u=e;this._antialiasingStrategy===0?this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0):(this.pushSSAARenderState(u.child),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),this.popSSAARenderState());break}case 1:{let u=e;this.visitGroupHelper(u,r,n,o,i);break}case 3:{let u=e,p=u.desiredAntialiasing(this._antialiasingStrategy);this._pathRasterizer.beginBatch(p),this._pathRasterizer.renderFill(r,u),this._pathRasterizer.finishBatch();break}case 4:{let u=e,p=u.desiredAntialiasing(this._antialiasingStrategy);this._pathRasterizer.beginBatch(p),this._pathRasterizer.renderFillStroke(r,u),this._pathRasterizer.finishBatch();break}case 16:{let u=e,p=u.desiredAntialiasing(this._antialiasingStrategy);this._pathRasterizer.beginBatch(p),this._pathRasterizer.renderScatterBrushFill(r,u),this._pathRasterizer.finishBatch();break}case 5:{let u=e,p=(u.type==0||u.type==4||u.type==1)&&u.hasNonIsolatedBlends(),_=this.allocateAndComputeTileScissor(r,this.bounds(u.color)),h=u.type==0&&!u.hasNonIsolatedBlends()&&u.alpha.isAxisAlignedRectFill()&&u.alpha.op()==3&&Ce.containsAtLeastOneVisibleOpaquePaint(u.alpha.geometry.paints)&&r.isAxisAligned(.001),g=h?u.alpha.geometryBounds():this.bounds(u.alpha),m=u.type==2||Sd&&u.type==3?this.allocateAndComputeTileScissor(r,g):u.type==4?_:this.allocateAndComputeTileScissor(r,g).intersectedWith(_);if(h){let R=this.currentTile().scissor();if(m.intersectWith(R),this.currentTile().setScissor(m),this.visitWithCanvasSpaceTileBounds(u.color,r,n,o,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new Df(R.clone()));return}else{this.currentTile().setScissor(R);return}}let A=L.new3(this._currentTile1().scissor()).intersectedWith(m);if(i<1){if(A.isEmpty())return;if(p?(this.duplicateTile1(A),this.duplicateTile1(A)):u.type==3?this._tileStack.pushTileAndClearToColor(N.premultiplied(((s=this._canvas)==null?void 0:s.computedBackgroundColor())??N.BLACK),A):this._tileStack.pushTile(A),u.type===5){rt.didEncounterPatternPaint(),this._currentlyInPatternFillCounter++;let R=null,b=null;if(u.color.op()===5){var a=u.color.color;a.op()===3?R=a:b=a}else u.color.op()===3?R=u.color:b=u.color;let O=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r).multipliedBy1(R?R.transform:b==null?void 0:b.transform),f=R?R.geometry.paints[0]:b==null?void 0:b.fillGeometries[0].paints[0];if(R!=null)this.renderSinglePatternPaint(r,R.transform,O,f.asSinglePaint(),u.sourceRenderTree,this._canvasToPixelsScale,R.geometry.path().bounds(),It.PREMULTIPLIED);else{let I=b.getAccumulatedFillGeometryPathBounds();for(let y=0;y<b.fillGeometries.length;y++){let P=I[y];this.renderSinglePatternPaint(r,b.transform,O,f.asSinglePaint(),u.sourceRenderTree,this._canvasToPixelsScale,P,It.PREMULTIPLIED)}}this._currentlyInPatternFillCounter--}else this.visitWithCanvasSpaceTileBounds(u.color,r,n,o,0);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Ro(e,r,n,o,1));return}}if(i<2&&(this._tileStack.pushTile(A),this.visitWithCanvasSpaceTileBounds(u.alpha,r,n,o,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(e,r,n,o,2));return}let S=this._tileStack.popTile(),T=this._tileStack.popTile();switch(u.type){case 0:case 5:{if(p){let R=this._tileStack.popTile();this.maskTilePassThrough(R,S,T,A),this._tileStack.freeTileToPool(R)}else this.maskTile(S,T,A);break}case 1:{if(p){let R=this._tileStack.popTile();this.maskTileLuminancePassThrough(R,S,T,A),this._tileStack.freeTileToPool(R)}else this.maskTileLuminance(S,T,A);break}case 4:{if(p){let R=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(R,S,T,A),this._tileStack.freeTileToPool(R)}else this.maskKnockoutShadowTile(S,T,A);break}case 3:{this.maskBackgroundBlurTile(S,T,A);break}case 2:{this.maskInnerShadowTile(S,T,A,u.innerShadowFill,u.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(S),this._tileStack.freeTileToPool(T);break}case 9:{let u=e,p=this.allocateAndComputeTileScissor(r,this.bounds(u.alpha)),_=L.new3(this._currentTile1().scissor()).intersectedWith(p);if(_.isEmpty())return;if(i<1&&(this._tileStack.pushTile(_),this.visitWithCanvasSpaceTileBounds(u.alpha,r,n,o,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(e,r,n,o,1));return}let h=this._tileStack.popTile();this.hardMaskTileWithColor(h,u.color,_),this._tileStack.freeTileToPool(h);break}case 6:{let u=e,p=L.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=u.hasInvertedStartAndEndPoints()?u.startRadius*r.scale1().maxComponent():u.endRadius*r.scale1().maxComponent();if(rt.didEncounterBlur(u.blurOpType==="PROGRESSIVE"),u.blurOpType=="PROGRESSIVE"){let h=u.hasInvertedStartAndEndPoints()?u.endRadius:u.startRadius,g=u.hasInvertedStartAndEndPoints()?u.startRadius:u.endRadius,m=u.hasInvertedStartAndEndPoints()?u.endPoint:u.startPoint,A=u.hasInvertedStartAndEndPoints()?u.startPoint:u.endPoint;if(i==1){let T=L.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderProgressiveBlur(h,g,m,A,u.child,r,_,T,o,u.clamp,n,i,e);return}if(i==2){let T=L.new3(this._currentTile2(2).scissor()).intersectedWith(p);this.renderProgressiveBlur(h,g,m,A,u.child,r,_,T,o,u.clamp,n,i,e);return}let S=L.new3(this._currentTile1().scissor()).intersectedWith(p);if(S.isEmpty())return;if(_<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);return}this.renderProgressiveBlur(h,g,m,A,u.child,r,_,S,o,u.clamp,n,i,e);break}else if(u.blurOpType=="NORMAL"){if(i==1){let R=L.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderBlur(e,u.child,r,_,R,o,u.clamp,n,i);return}let h=L.new3(this._currentTile1().scissor()).intersectedWith(p);if(h.isEmpty())return;if(_<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);return}let g=wD(u.child),m=g.a,A=g.b??wt.FrozenAffineTransform_IDENTITY,S=m.isRectFill()?m:null;if(S!=null&&u.clamp.isInvalid()){let R=Ce.onlySolidPaintOrNull(S.geometry.paints);if(R!=null){let b=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r).multipliedBy1(A).multipliedBy1(S.transform);this.renderBlurredRectangle(b,S.geometry.path().bounds(),N.multiplyOpacity(R.color(),R.opacity()),u.endRadius);return}}let T=m.isRoundedRectFill()?m:null;if(T!=null&&u.clamp.isInvalid()){let R=T.geometry.path().path(),b=R.radii();if(b.isUniform()){let O=Ce.onlySolidPaintOrNull(T.geometry.paints);if(O!=null){let f=b.topLeft,I=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r).multipliedBy1(A).multipliedBy1(T.transform);this.renderBlurredRoundedRectangle(I,R.bounds(),f,N.multiplyOpacity(O.color(),O.opacity()),u.endRadius);return}}}this.renderBlur(e,u.child,r,_,h,o,u.clamp,n,i);break}}case 17:{let u=e,p=L.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize()),rt.didEncounterGlassEffect();let _=r.scale1().maxComponent(),h=u.blurRadius*_,g=u.textureRadius*_,m=u.reflectionRadius*_,A=Math.min(u.centerPoint.x(),u.centerPoint.y()),T=Math.min(A,u.refractionDistance)*_;if(i==1){let b=L.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderRectangularLiquidGlass(u,u.child,r,h,g,m,T,u.blurRadius,u.textureRadius,u.refractionIntensity,u.refractionDistance,u.cornerInfo,u.nodeToCanvasSpaceTransform,u.centerPoint,u.reflectionRadius,u.lightIntensity,u.lightAngle,u.bevelSize,u.chromaticAberration,u.tintColor,b,o,n,i);return}let R=L.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderRectangularLiquidGlass(u,u.child,r,h,g,m,T,u.blurRadius,u.textureRadius,u.refractionIntensity,u.refractionDistance,u.cornerInfo,u.nodeToCanvasSpaceTransform,u.centerPoint,u.reflectionRadius,u.lightIntensity,u.lightAngle,u.bevelSize,u.chromaticAberration,u.tintColor,R,o,n,i);break}case 7:{let u=e,p=ok(u.blendMode)&&(this._currentTile1().isColorTransparent()||this._currentTile1().needsColorClearToTransparent())&&u.opacity==1;this.renderBlend(p,u,r,n,o,0,this._currentTile1().scissor());break}case 14:{let u=e,p=L.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=u.radius*r.scale1().maxComponent();if(rt.didEncounterTextureEffect(u.clipToShape),_<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}if(i==1){let g=L.new3(this._currentTile2(1).scissor()).intersectedWith(p);u.clipToShape?this.renderClampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,g,o,n,i,u.seed):this.renderUnclampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,g,o,n,i,u.seed);return}if(i==2){let g=L.new3(this._currentTile2(2).scissor()).intersectedWith(p);this.renderClampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,g,o,n,i,u.seed);return}let h=L.new3(this._currentTile1().scissor()).intersectedWith(p);if(h.isEmpty())return;u.clipToShape?this.renderClampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,h,o,n,i,u.seed):this.renderUnclampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,h,o,n,i,u.seed);break}case 15:{let u=e,p=L.new3(this.bounds(u));if(r.transformRect(p),p.scaledBy1(this.currentTextureSize()),rt.didEncounterNoiseEffect(),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),i==1){let h=L.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderNoise(u,u.child,r,h,u.blendMode,u.nodeToCanvasSpaceTransform,u.noiseType,u.noiseSize.x(),u.density,u.color,u.secondaryColor,u.nodeSpaceCenterPoint,o,n,i,u.seed);return}let _=L.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderNoise(u,u.child,r,_,u.blendMode,u.nodeToCanvasSpaceTransform,u.noiseType,u.noiseSize.x(),u.density,u.color,u.secondaryColor,u.nodeSpaceCenterPoint,o,n,i,u.seed);break}case 8:{let u=e;this.visitCompositeChildWithOpacity(u,1,r,n);break}case 10:{this._currentlyInVolatilePropertyCounter++;let u=e;switch(u.property){case et.TRANSFORM:{let p=Q.new3(r);p.multipliedBy1(u.transform());let _=Q.new3(u.transform());_.invert()||_.copyFrom(wt.FrozenAffineTransform_IDENTITY),_.multipliedBy1(o),this.visit(u.child,p,_,0);break}case et.TRANSFORM_ISOLATION:{let p=Q.new2();this.visitWithCanvasSpaceTileBounds(u.child,r,n,p,0);break}case et.INVERSE_TRANSFORM:{let p=Q.new2(),_=Q.new2();p.copyFrom(r).multipliedBy1(o),this.visit(u.child,p,_,0);break}case et.OPACITY:{let p=u.opacity(),_=!1;if(p==1)this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),_=!0;else if(p==0)_=!0;else if(u.child.op()==3){let h=u.child,g=(l=Ce.onlyPaintOrNull(h.geometry.paints))==null?void 0:l.asSinglePaint();if(g!=null){let m=g.cloneAsSinglePaint();m.setOpacity(m.opacity()*p),this.visitWithCanvasSpaceTileBounds(h.withPaints([m]),r,n,o,0),_=!0}}else if(u.child.op()==8){let h=u.child;this.visitCompositeChildWithOpacity(h,p,r,n),_=!0}if(!_){let h=this.allocateAndComputeTileScissor(r,this.bounds(u.child)),g=L.new3(this._currentTile1().scissor()).intersectedWith(h);u.child.hasNonIsolatedBlends()?this.duplicateTile1(g):this._tileStack.pushTile(g),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),u.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",p):this.blendAndPopTile("NORMAL",p)}break}case et.MAX_TRANSFORM_SCALE:{this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}case et.STATE_SWAP:{this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}default:throw new Error(`Unhandled VolatileProperty value ${Bc(u.property)}`)}this._currentlyInVolatilePropertyCounter--;break}case 13:{this._currentlyInVolatilePropertyCounter++;let u=e;switch(u.property){case Kr.BLUR:{let p=L.new3(u.computeBounds(this._boundsCache));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=L.new3(this._currentTile1().scissor()).intersectedWith(p);if(_.isEmpty())return;let h=u.hasInvertedStartAndEndPoints()?u.startRadius():u.endRadius(),g=h*r.scale1().maxComponent();if(g<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);return}let m=u.hasInvertedStartAndEndPoints()?u.endRadius():u.startRadius(),A=u.hasInvertedStartAndEndPoints()?u.getOffsetInCanvasSpace():u.getStartOffsetInCanvasSpace(),S=u.hasInvertedStartAndEndPoints()?u.getStartOffsetInCanvasSpace():u.getOffsetInCanvasSpace();u.blurOpType=="PROGRESSIVE"?this.renderProgressiveBlur(m,h,A,S,u.child,r,g,_,o,u.canvasSpaceClamp,n,i,e):this.renderBlur(e,u.child,r,g,_,o,u.canvasSpaceClamp,n,i);break}case Kr.GRAIN:{let p=L.new3(u.computeBounds(this._boundsCache));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=L.new3(this._currentTile1().scissor()).intersectedWith(p);if(_.isEmpty())return;let h=u.grainRadius()*r.scale1().maxComponent(),g=u.grainNoiseSize(),m=u.getNodeToCanvasSpaceTransform(),A=u.getNodeSpaceCenterPoint();u.clipToShape?this.renderClampedGrain(u,u.child,r,h,u.grainRadius(),g,m,A,_,o,n,i,u.seed):this.renderUnclampedGrain(u,u.child,r,h,u.grainRadius(),g,m,A,_,o,n,i,u.seed);break}case Kr.NOISE:{let p=L.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize()),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);let _=L.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderNoise(u,u.child,r,_,u.blendMode,u.nodeToCanvasSpace,u.noiseType,u.getNoiseSize(),u.getNoiseDensity(),u.getNoiseColor(),u.getSecondaryNoiseColor(),u.getNodeSpaceCenterPoint(),o,n,i,u.seed);break}case Kr.GLASS:{let p=L.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=r.scale1().maxComponent(),h=u.glassBlurRadius()*_,g=u.glassTextureRadius()*_,m=u.glassReflectionDistance()*_,A=Math.min(u.glassCenterPoint().x(),u.glassCenterPoint().y()),T=Math.min(A,u.glassRefractionDistance())*_,R=L.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderRectangularLiquidGlass(u,u.child,r,h,g,m,T,u.glassBlurRadius(),u.glassTextureRadius(),u.glassRefractionIntensity(),u.glassRefractionDistance(),u.glassCornerInfo(),u.getNodeToCanvasSpaceTransform(),u.glassCenterPoint(),u.glassReflectionDistance(),u.glassSpecularIntensity(),u.glassSpecularAngle(),u.glassBevelSize(),u.glassChromaticAberration(),u.glassTintColor(),R,o,n,i);break}}this._currentlyInVolatilePropertyCounter--;break}case 11:{let u=e,p=Q.new3(r);p.multipliedBy1(u.transform);let _=Q.new3(u.transform);_.invert()||_.copyFrom(wt.FrozenAffineTransform_IDENTITY),_.multipliedBy1(o),this.visit(u.child,p,_,0);break}case 12:{this._currentlyInDissolveCounter++;let u=e,p=u.startChild?this.allocateAndComputeTileScissor(r,this.bounds(u.startChild)):this._tileStack.defaultTileScissor(),_=u.endChild?this.allocateAndComputeTileScissor(r,this.bounds(u.endChild)):this._tileStack.defaultTileScissor(),h=L.new2();h.copyFrom(this._currentTile1().scissor()).intersectedWith(p);let g=h.clone().scaledBy1(1/this.currentTextureSize());(c=u.startChild)!=null&&c.hasNonIsolatedBlends()?this.duplicateTile1(h):this._tileStack.pushTile(h),u.startChild&&this.visitWithCanvasSpaceTileBounds(u.startChild,r,n,o,0);let m=this._tileStack.popTile();h.copyFrom(this._currentTile1().scissor()).intersectedWith(_);let A=h.clone().scaledBy1(1/this.currentTextureSize());(d=u.endChild)!=null&&d.hasNonIsolatedBlends()?this.duplicateTile1(h):this._tileStack.pushTile(h),u.endChild&&this.visitWithCanvasSpaceTileBounds(u.endChild,r,n,o,0);let S=this._tileStack.popTile();UD(this._lerpTileMaterial,this._materialStrings,m.colorTextureForSampling(),S.colorTextureForSampling(),g,A,Ye.double_clamp(u.progress(),0,1));let T=this.allocateAndComputeTileScissor(r,this.bounds(e)),R=this.currentTile().scissor();this.currentTile().setScissor(T.clone().intersectedWith(R)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._lerpTileMaterial,this._quadArea,It.PREMULTIPLIED),this.currentTile().setScissor(R),this._tileStack.freeTileToPool(S),this._tileStack.freeTileToPool(m),this._currentlyInDissolveCounter--;break}}}}visitCompositeChildWithOpacity(e,r,n,o){let i=Q.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(n),a=this.allocateAndComputeTileScissor(n,this.bounds(e)),s=this.currentTile().scissor();this.currentTile().setScissor(a.clone().intersectedWith(s)),e.forEachTileWithinBounds(1,o,l=>{let c=l.textureRegionOrNull();if(c!=null){if(this.drawTextureRegion2(c,l.canvasSpaceBounds(),i,1,r),l.neededImagesOrNull!=null){let d=n_.asList(l.neededImagesOrNull);for(let u of d)this.getOrCreateImageTexture(u)}}else if(U.shouldApplyMobileOptimizations()&&Bt.getFeatureGate("viewer_atlas_cap_capacity")&&l.skippedPrerasterization){let d=Q.new2().scaledBy2(1/l.canvasSpaceBounds().size().x()).translatedBy1(new F(-l.canvasSpaceBounds().x(),-l.canvasSpaceBounds().y())),u=Q.new3(d);u.invert()||(xe("Failed to invert tile transform when rendering directly to screen"),u.copyFrom(wt.FrozenAffineTransform_IDENTITY));let p=this.allocateAndComputeTileScissor(d,l.bounds());this._tileStack.pushTile(p),this.visit(e.tree,d,u,0);let _=this._tileStack.popTile(),h=new Ed(_.backingColorTexture(),_.uvSpaceRect());this.drawTextureRegion2(h,l.canvasSpaceBounds(),i,1,r),this._tileStack.freeTileToPool(_)}}),this.currentTile().setScissor(s)}visitGroupHelper(e,r,n,o,i){if(i<1)for(let a of e.children)this.visitGroupChildWithSSAA(a,r,n,o);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Ro(e,r,n,o,1));return}this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch()}visitGroupChildWithSSAA(e,r,n,o){let i=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,a=e.desiredAntialiasing(this._antialiasingStrategy)==2;if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Ff(e,r,n,o));return}let s=!1;a&&!i&&this._ssaaState.level===0?s=this.upscaleRectForSSAA(L.new3(this._currentTile1().scissor())).overlaps(this.allocateAndComputeTileScissor(r,this.bounds(e),this._tileConfig.SSAA_SIZE())):!a&&i&&this._ssaaState.level===1?s=this._currentTile2(1).scissor().overlaps(this.allocateAndComputeTileScissor(r,this.bounds(e),this._tileConfig.baseTileSize)):s=this._currentTile1().scissor().overlaps(this.allocateAndComputeTileScissor(r,this.bounds(e))),s&&(a&&!i?this._pathRasterizer.beginBatch(2):!a&&i&&this._pathRasterizer.finishBatch(),a?e.op()==3?this._pathRasterizer.renderFill(r,e):e.op()==4?this._pathRasterizer.renderFillStroke(r,e):e.op()===16&&this._pathRasterizer.renderScatterBrushFill(r,e):this.visitWithCanvasSpaceTileBounds(e,r,n,o,0))}allocateAndComputeTileScissor(e,r,n){let o=L.new3(r);e.transformRect(o);let i=o.scaledBy1(n??this.currentTextureSize());return i.round(),i}renderBlurredRectangle(e,r,n,o){if(U.useWasmRasterizer()){this._didDraw=v().modules().wasmRasterizerBindings.renderBlurredRectangle(this._currentTile1().wasmTileStackTile(),$e(e),ft(r),N.toColorF(n),o);return}N.alpha(n)!=0&&(JD(this._rectangleBlurMaterial,this._materialStrings,e,n,r,o),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._rectangleBlurMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0)}renderBlurredRoundedRectangle(e,r,n,o,i){if(N.alpha(o)!=0){if(U.useWasmRasterizer()){this._didDraw=v().modules().wasmRasterizerBindings.renderBlurredRoundedRectangle(this._currentTile1().wasmTileStackTile(),$e(e),ft(r),n,N.toColorF(o),i);return}$D(this._roundedRectangleBlurMaterial,this._materialStrings,e,r,n,o,i),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._roundedRectangleBlurMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0}}scaleLimitForBlursAndEffects(e){return 1/(1+2*e)}renderBlur(e,r,n,o,i,a,s,l,c){let d=32;U.getFeatureFlags().increase_blur_max_texel_radius&&(d=64);let u=.5,p=this.scaleLimitForBlursAndEffects(o),_=Math.min(d,p*o*this.currentTextureSize()),h=_/this.currentTextureSize(),g=h/o;g>2/u/this.currentTextureSize()&&(g=Math.round(g*(this.currentTextureSize()*u))/(this.currentTextureSize()*u),_=Math.min(d/u,g*o*this.currentTextureSize()),h=_/this.currentTextureSize());let m=Q.new2().translatedBy2(.5,.5).scaledBy2(g).translatedBy2(-.5,-.5),A=L.new3(i).scaledBy1(1/this.currentTextureSize());m.transformRect(A);let S=L.new3(A).expandedBy2(0,h),T=L.new3(S).expandedBy2(h,0),R=m.multipliedBy1(n),b=null;if(!s.isInvalid()){b=R.transformRect(s.clone()),b.scaledBy1(this.currentTextureSize());let P=Math.ceil(b.left()-.5)+.5,E=Math.ceil(b.top()-.5)+.5,C=Math.floor(b.right()+.5)-.5,B=Math.floor(b.bottom()+.5)-.5;b=new L(P,E,C-P,B-E),b.scaledBy1(1/this.currentTextureSize())}let O=_>4,f=O&&r.op()==9;if(c<1){if(this._tileStack.pushTile(L.new3(T).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),f){let P=r;this.visit(P.alpha,R,a,0)}else this.visit(r,R,a,0);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Ro(e,n,l,a,1));return}}let I=!1,y=null;if(O){let P=_*u,E=L.new3(T).scaledBy1(u),C=L.new3(S).scaledBy1(u),B=L.new3(A).scaledBy1(u),G=null;if(b!=null){G=L.new3(b).scaledBy1(u),G.scaledBy1(this.currentTextureSize());let j=Math.ceil(G.left()-.5)+.5,q=Math.ceil(G.top()-.5)+.5,J=Math.floor(G.right()+.5)-.5,ie=Math.floor(G.bottom()+.5)-.5;G=new L(j,q,J-j,ie-q),G.scaledBy1(1/this.currentTextureSize())}let V=this._tileStack.popTile(),D=L.new3(E).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTile(D,y,I),f){let j=r;this.hardMaskWithColorAndDownscaleTile(V,j.color,E,T)}else this.downscaleTile(V,E,T);this._tileStack.freeTileToPool(V);let w=this._tileStack.popTile(),k=L.new3(C).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(k,y,I),this.blurTile(w,1/this.currentTextureSize(),0,L.new3(k).scaledBy1(1/this.currentTextureSize()),P,G),this._tileStack.freeTileToPool(w);let z=this._tileStack.popTile(),H=L.new3(B).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(H,y,I),this.blurTile(z,0,1/this.currentTextureSize(),L.new3(H).scaledBy1(1/this.currentTextureSize()),P,G),this._tileStack.freeTileToPool(z);let K=this._tileStack.popTile();this.upscaleTile(K,i.scaledBy1(1/this.currentTextureSize()),B),this._tileStack.freeTileToPool(K)}else{let P=this._tileStack.popTile(),E=L.new3(S).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(E,y,I),this.blurTile(P,1/this.currentTextureSize(),0,L.new3(E).scaledBy1(1/this.currentTextureSize()),_,b),this._tileStack.freeTileToPool(P);let C=this._tileStack.popTile(),B=L.new3(A).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(B,y,I),this.blurTile(C,0,1/this.currentTextureSize(),L.new3(B).scaledBy1(1/this.currentTextureSize()),_,b),this._tileStack.freeTileToPool(C);let G=this._tileStack.popTile();this.upscaleTile(G,i.scaledBy1(1/this.currentTextureSize()),A),this._tileStack.freeTileToPool(G)}}needsSourceTextureForProgressiveBlur(e,r,n,o,i){let a=!1,s=r.subtract(e),l=Number.MIN_VALUE,c=Number.MAX_VALUE;for(let d of[n.topLeft(),n.topRight(),n.bottomRight(),n.bottomLeft()]){let p=d.subtract(e).dot(s)/s.dot(s),_=Math.min(Math.max(p,0),1),h=(i-o)*_+o;l=Math.max(l,h),c=Math.min(c,h)}if(c<=1)a=!0;else{let d=.00390625,u=l*l,_=((l-1)*(l-1)+2*(l-1))/2*2,h=_*_;a=u/(u+h)>=d}return a}blendModePreTraverseHelper(e,r){e=="PASS_THROUGH"?this.duplicateTile1(r):this._tileStack.pushTile(r)}renderNoise(e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m){let A=o.expandedBy1(1).rounded();if(g<1){if(A.isEmpty())return;if(this._tileStack.pushTile(A),this.visitWithCanvasSpaceTileBounds(r,n,h,_,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new Ro(e,n,h,_,1));return}}let S=this._tileStack.popTile(),T=this.scissorQuad(L.new3(S.scissor())).scaledBy1(this.currentTextureSize());this.blendModePreTraverseHelper(i,T);let R=Q.new3(n),b=a;R.multiply(b);let f=R.clone().clone();f.invert()||console.error("Noise Inv Err"),this.noiseTile(S,s,1/l,c,d,u,F.new(p),f,L.new3(o).scaledBy1(1/this.currentTextureSize()),m),this.blendAndPopTile(i,1),this._tileStack.freeTileToPool(S)}renderUnclampedGrain(e,r,n,o,i,a,s,l,c,d,u,p,_){let h=this.currentTextureSize()/2-1,g=this.scaleLimitForBlursAndEffects(o),m=Math.min(h,g*o*this.currentTextureSize()),A=m/this.currentTextureSize(),S=A/o;S>2/this.currentTextureSize()&&(S=Math.round(S*this.currentTextureSize())/this.currentTextureSize(),m=Math.min(h,S*o*this.currentTextureSize()),A=m/this.currentTextureSize());let T=Q.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),R=L.new3(c).scaledBy1(1/this.currentTextureSize());T.transformRect(R);let b=L.new3(R).expandedBy2(0,A),O=L.new3(b).expandedBy2(A,0),f=T.multipliedBy1(n),I=null;if(p<1&&(this._tileStack.pushTile(L.new3(O).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),this.visit(r,f,d,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(e,n,u,d,1));return}let y=this._tileStack.popTile();this._tileStack.pushTile(new L(0,0,this.currentTextureSize(),this.currentTextureSize()));let P=Q.new3(n),E=Q.new3(s);P.multiply(E);let C=P.clone();P.invert()||console.error("Grain Inv Err");let B=P.clone();this.unclampedGrainTile(y,i,L.new3(c).scaledBy1(1/this.currentTextureSize()),S,1/a,C,B,F.new(l),_);let G=this._tileStack.popTile();this.copyTileRegion(G,L.new3(c).scaledBy1(1/this.currentTextureSize()),L.new3(c).scaledBy1(1/this.currentTextureSize()),It.PREMULTIPLIED),this._tileStack.freeTileToPool(y),this._tileStack.freeTileToPool(G)}renderClampedGrain(e,r,n,o,i,a,s,l,c,d,u,p,_){let h=this.currentTextureSize()/2-1,g=this.scaleLimitForBlursAndEffects(o),m=Math.min(h,g*o*this.currentTextureSize()),A=m/this.currentTextureSize(),S=A/o;S>2/this.currentTextureSize()&&(S=Math.round(S*this.currentTextureSize())/this.currentTextureSize(),m=Math.min(h,S*o*this.currentTextureSize()),A=m/this.currentTextureSize());let T=Q.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),R=L.new3(c).scaledBy1(1/this.currentTextureSize());T.transformRect(R);let b=L.new3(R).expandedBy2(0,A),O=L.new3(b).expandedBy2(A,0),f=T.multipliedBy1(n);if(U.clipToShapeBoundsReducton()&&O.intersectWith(f.transformRect(L.new3(this.bounds(e)))),p<1&&(this._tileStack.pushTile(L.new3(c).expandedBy1(1).rounded()),this.visit(r,n,d,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(e,n,u,d,1));return}if(p<2&&(this._tileStack.pushTile(L.new3(O).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),this.visit(r,f,d,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(e,n,u,d,2));return}let I=this._tileStack.popTile(),y=this._tileStack.popTile();this._tileStack.pushTile(new L(0,0,this.currentTextureSize(),this.currentTextureSize()));let P=Q.new3(n),E=Q.new3(s);P.multiply(E);let C=P.clone();P.invert()||console.error("Grain Inv Err");let B=P.clone();this.clampedGrainTile(y,I,i,L.new3(c).scaledBy1(1/this.currentTextureSize()),S,1/a,C,B,F.new(l),_);let G=this._tileStack.popTile();this.copyTileRegion(G,L.new3(c).scaledBy1(1/this.currentTextureSize()),L.new3(c).scaledBy1(1/this.currentTextureSize()),It.PREMULTIPLIED),this._tileStack.freeTileToPool(y),this._tileStack.freeTileToPool(I),this._tileStack.freeTileToPool(G)}renderRectangularLiquidGlass(e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S,T,R,b,O,f,I){let y=this.currentTextureSize()/2-1,P=32;U.getFeatureFlags().increase_blur_max_texel_radius&&(P=64);let E=c==0,C=Math.max(.001,o+i+s*(d+T),a),B=this.scaleLimitForBlursAndEffects(C),G=C,V=Math.min(y,B*G*this.currentTextureSize()),D=V/this.currentTextureSize(),w=D/G,k=o/G*V,z=Math.min(P,k),H=k/z;w/=H,w>2/this.currentTextureSize()&&(w=Math.round(w*this.currentTextureSize())/this.currentTextureSize(),V=Math.min(y,w*G*this.currentTextureSize()),D=V/this.currentTextureSize());let K=Q.new2().translatedBy2(.5,.5).scaledBy2(w).translatedBy2(-.5,-.5),j=L.new3(b).scaledBy1(1/this.currentTextureSize());j=K.transformRect(j);let q=L.new3(j).expandedBy2(0,D),J=L.new3(q).expandedBy2(D,0),ie=K.multipliedBy1(n);if(I<1&&(this._tileStack.pushTile(L.new3(J).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),this.visit(r,ie,O,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(e,n,f,O,1));return}let Ee=this._tileStack.popTile(),Ke=1/this.currentTextureSize(),Ve=U.shouldDownscaleGlassBackground()?.5:1,at=z<Ke;if(!at)if(U.shouldDownscaleGlassBackground()){let He=z*Ve,st=Q.new2().translatedBy2(.5,.5).scaledBy2(Ve).translatedBy2(-.5,-.5),ke=L.new3(J).scaledBy1(Ve),kt=L.new3(ke).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(kt),this.downscaleTile(Ee,ke,J);let Zt=this._tileStack.popTile();this._tileStack.pushTile(kt),this.blurTile(Zt,Ke,0,L.new3(kt).scaledBy1(Ke),He,null);let Wt=this._tileStack.popTile();this._tileStack.pushTile(kt),this.blurTile(Wt,0,Ke,L.new3(kt).scaledBy1(Ke),He,null);let br=this._tileStack.popTile(),on=L.new3(J).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(on),this.upscaleTile(br,J,ke),this._tileStack.freeTileToPool(Zt),this._tileStack.freeTileToPool(Wt),this._tileStack.freeTileToPool(br)}else{let He=L.new3(J).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(He),this.blurTile(Ee,Ke,0,L.new3(He).scaledBy1(Ke),z,null);let st=this._tileStack.popTile();this._tileStack.pushTile(He),this.blurTile(st,0,Ke,L.new3(He).scaledBy1(Ke),z,null),this._tileStack.freeTileToPool(st)}if(!E){let He=this._tileStack.popTile(),st=L.new3(J).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(st);let ke=ie,kt=_,Zt=ke.multipliedBy1(kt),Wt=Zt;Wt.invert()||console.error("Glass Inv Err");let br=L.new3(J).scaledBy1(Ke).expandedBy1(1).rounded();this.unclampedGrainTile(He,c,br,1,1/1,Zt,Wt,F.new(h),1),this._tileStack.freeTileToPool(He)}let Dt=at?Ee:this._tileStack.popTile(),qt=_,zt=Q.new3(n);zt.multiply(qt);let ae=zt.clone(),nt=ae.clone();nt.invert()||console.error("Noise Inv Err");let Et=Math.floor(a/G*V);p.cornerRadiiIndependent||U.useGlassNonUniformCornerRadii()?this.glassNonUniformCornerRadiiTile(L.new3(b).scaledBy1(1/this.currentTextureSize()),Dt,w,ae,nt,h,p,d,u,m,A*(Math.PI/180),S,T,g,R):this.glassTile(L.new3(b).scaledBy1(1/this.currentTextureSize()),Dt,p.topLeftRadius(),w,ae,nt,h,d,u,g,Et,l,m,A*(Math.PI/180),S,T,p.cornerSmoothings[0],R),this._tileStack.freeTileToPool(Ee),at||this._tileStack.freeTileToPool(Dt)}renderProgressiveBlur(e,r,n,o,i,a,s,l,c,d,u,p,_){let g=this.scaleLimitForBlursAndEffects(s),m=Math.min(64,g*s*this.currentTextureSize()),A=m/this.currentTextureSize(),S=A/s;S>2/this.currentTextureSize()&&(S=Math.round(S*this.currentTextureSize())/this.currentTextureSize(),m=Math.min(64,S*s*this.currentTextureSize()),A=m/this.currentTextureSize());let T=Q.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),R=L.new3(l).scaledBy1(1/this.currentTextureSize());R=T.transformRect(R);let b=L.new3(R).expandedBy2(A,A),O=T.multipliedBy1(a),f=null;if(!d.isInvalid()){f=O.transformRect(d.clone()),f.scaledBy1(this.currentTextureSize());let Ve=Math.ceil(f.left()-.5)+.5,at=Math.ceil(f.top()-.5)+.5,Dt=Math.floor(f.right()+.5)-.5,qt=Math.floor(f.bottom()+.5)-.5;f=new L(Ve,at,Dt-Ve,qt-at),f.scaledBy1(1/this.currentTextureSize())}let I=L.new3(b).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded(),y=e/r,P=m*y,E=m,C=O.transformPoint(F.new(n)),B=O.transformPoint(F.new(o)),G=L.new3(l).scaledBy1(1/this.currentTextureSize()),V=this.needsSourceTextureForProgressiveBlur(C,B,G,P,E);if(p<1&&(this._tileStack.pushTile(L.new3(l).expandedBy1(1).rounded(),N.TRANSPARENT,!0),V&&(this.visit(i,a,c,0),this._interruptedCommands.length>0))){this._interruptedCommands.push(new Ro(_,a,u,c,1));return}if(p<2&&(this._tileStack.pushTile(I,N.TRANSPARENT,!0),this.visit(i,O,c,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Ro(_,a,u,c,2));return}let D=n.clone(),w=o.clone(),k=O.transformPoint(D),z=O.transformPoint(w),H=z.subtract(k),j=H.divideScalar(H.length()).divideScalar(this.currentTextureSize()),q=new F(j.y(),-j.x()),J=this._tileStack.popTile(),ie=this._tileStack.popTile();this._tileStack.pushTile(I),this.gradientBlurTile(J,q.x(),q.y(),L.new3(I).scaledBy1(1/this.currentTextureSize()),L.new3(I).scaledBy1(1/this.currentTextureSize()),m*y,m,f,k,z,L.new3(I).scaledBy1(1/this.currentTextureSize())),this._tileStack.freeTileToPool(J);let Ee=this._tileStack.popTile();this._tileStack.pushTile(I),this.gradientBlurTile(Ee,j.x(),j.y(),L.new3(I).scaledBy1(1/this.currentTextureSize()),L.new3(I).scaledBy1(1/this.currentTextureSize()),m*y,m,f,k,z,L.new3(I).scaledBy1(1/this.currentTextureSize())),this._tileStack.freeTileToPool(Ee);let Ke=this._tileStack.popTile();V?this.upscaleAndBlendGradientBlurTile(Ke,L.new3(l).scaledBy1(1/this.currentTextureSize()),R,m*y,m,k,z,ie,S,R):this.copyTileRegion(Ke,G,R,It.PREMULTIPLIED),this._tileStack.freeTileToPool(ie),this._tileStack.freeTileToPool(Ke)}hardMaskTileWithColor(e,r,n){let o=L.new3(n),i=this.scissorQuad(o);e.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),ux(this._hardMaskTileWithColorMaterial,this._materialStrings,e,i,r),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._hardMaskTileWithColorMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0,e.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP)}upscaleAndBlendGradientBlurTile(e,r,n,o,i,a,s,l,c,d){let u=this._upscaleAndBlendGradientBlurTileMaterial;gx(u,this._materialStrings,e,r,n,o,i,c,a,s,l,d),this.drawToCurrentTile(ze.TRIANGLE_STRIP,u,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0}gradientBlurTile(e,r,n,o,i,a,s,l,c,d,u){let p;l==null?(p=this._unclampedGradientBlurMaterial,fx(p,this._materialStrings,e,o,i,a,s,r,n,c,d,u)):(p=this._clampedGradientBlurMaterial,mx(p,this._materialStrings,e,o,i,a,s,r,n,l,c,d,u)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,p,this._quadArea,It.COPY),this._didDraw=!0}blurTile(e,r,n,o,i,a){let s;a==null?(s=this._unclampedBlurMaterial,ZD(s,this._materialStrings,e,r,n,o,i)):(s=this._clampedBlurMaterial,jD(s,this._materialStrings,e,r,n,o,i,a)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,s,this._quadArea,It.COPY),this._didDraw=!0}glassTile(e,r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S){hx(this._glassMaterial,this._materialStrings,r,e,n,o,i,a,s,l,c,_,h,g,m,u,A,S),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._glassMaterial,this._quadArea,It.COPY),this._didDraw=!0}glassNonUniformCornerRadiiTile(e,r,n,o,i,a,s,l,c,d,u,p,_,h,g){Sx(this._glassNonUniformCornerRadiiMaterial,this._materialStrings,r,e,n,o,i,a,s.cornerRadii,s.cornerSmoothings,l,s.clampToMaxRefractionDistance(c),d,u,p,_,h,g),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._glassNonUniformCornerRadiiMaterial,this._quadArea,It.COPY),this._didDraw=!0}copyTileRegion(e,r,n,o){Kv(this._downscaleTileMaterial,this._materialStrings,e,r,n),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea,o),this._didDraw=!0}noiseTile(e,r,n,o,i,a,s,l,c,d){let u=this._noiseMaterial;Ax(u,this._materialStrings,r,n,o,i,a,s,l,c,d,e.colorTextureForSampling()),this.drawToCurrentTile(ze.TRIANGLE_STRIP,u,this._quadArea,It.COPY),this._didDraw=!0}unclampedGrainTile(e,r,n,o,i,a,s,l,c){let d=this._unclampedGrainMaterial;Tx(d,this._materialStrings,r,n,o,i,a,s,l,c,e.colorTextureForSampling()),this.drawToCurrentTile(ze.TRIANGLE_STRIP,d,this._quadArea,It.COPY),this._didDraw=!0}clampedGrainTile(e,r,n,o,i,a,s,l,c,d){let u=this._clampedGrainMaterial;Ex(u,this._materialStrings,n,o,i,a,s,l,c,d,r.colorTextureForSampling(),e.colorTextureForSampling()),this.drawToCurrentTile(ze.TRIANGLE_STRIP,u,this._quadArea,It.COPY),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,r){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"||e=="LINEAR_DODGE"){let n=this._tileStack.popTile(),o=this.scissorQuad(L.new3(n.scissor())),i,a;e=="PASS_THROUGH"?(a=1,i=It.createInterpolateBlendState(r)):(a=r,e=="SCREEN"?i=It.SCREEN:e=="LINEAR_DODGE"?i=It.LINEAR_DODGE:i=It.PREMULTIPLIED),n.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),cx(this._blendTileSimpleMaterial,this._materialStrings,n,o,a),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._blendTileSimpleMaterial,this._quadArea,i),this._didDraw=!0,n.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n)}else{this.duplicateTile2(this._currentTile1().scissor(),1);let n=this._tileStack.popTile(),o=this._tileStack.popTile(),i=this.scissorQuad(L.new3(o.scissor()));o.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),n.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),dx(this._blendTileCustomMaterial,this._materialStrings,o,n,i,ik.get(e),r),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._blendTileCustomMaterial,this._quadArea,It.COPY),this._didDraw=!0,n.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),o.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n),this._tileStack.freeTileToPool(o)}}upscaleTile(e,r,n){ex(this._upscaleTileMaterial,this._materialStrings,e,r,n),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._upscaleTileMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0}downscaleTile(e,r,n){Kv(this._downscaleTileMaterial,this._materialStrings,e,r,n),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea,It.COPY),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,r,n,o){px(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings,e,r,n,o,this.currentTextureSize()),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea,It.COPY),this._didDraw=!0}_advanceGIFAndUpload(e,r){var o;let n=(o=e.gif())==null?void 0:o.nextFrameIfNecessary();n!=null&&$n.Texture_resize3(r,e.width(),e.height(),lr.createFromPixels(e.width(),e.height(),n))}getOrCreateImageTexture(e){var i,a;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&n_.add(this._neededImagesOrNull,e);let r=e.image,n=e.purpose,o=r.texture();return o!=null?r.gif()!=null&&r.advanceGIFAndUpload():(((i=r.decodedData())==null?void 0:i.pixels)!=null||r.gif()!=null)&&(r.processTextureData(),o=r.texture()),r.state()==0&&((a=this._requestImage)==null||a.call(this,r,n)),o}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,r){let n=this._currentTile2(r),o=n.isColorTransparent()||n.needsColorClear(),i=o,a=n.clearColor();o&&a==null&&(a=N.TRANSPARENT),this._tileStack.pushTile(e,a,i);let s=this._currentTile1();if(o)return;let l=n.colorTextureForSampling();l.setFormat(Fe.RGBA_NEAREST_CLAMP);let c=n.uvSpaceRect(),d=e?this.scissorQuad(L.new3(e)):L.UNIT,u=new L(c.x()+c.width()*d.x(),c.y()+c.height()*d.y(),c.width()*d.width(),c.height()*d.height()),p=new L(-1+2*d.x(),-1+2*d.y(),2*d.width(),2*d.height());this.drawTexture1(l,u,null,p,0),l.setFormat(Fe.RGBA_LINEAR_CLAMP)}renderBlend(e,r,n,o,i,a,s){if(a<1){let l=this.allocateAndComputeTileScissor(n,this.bounds(r.child)),c=L.new3(this._currentTile1().scissor()).intersectedWith(l);if(c.isEmpty())return;if(e?this._currentTile1().setScissor(c.clone()):this.blendModePreTraverseHelper(r.blendMode,c),this.visitWithCanvasSpaceTileBounds(r.child,n,o,i,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new xf(e,r,n,o,i,s));return}}e?this._currentTile1().setScissor(s):this.blendAndPopTile(r.blendMode,r.opacity)}maskBackgroundBlurTile(e,r,n){this._flushBeforeMasks&&this._context.flush();let o=L.new3(n);r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),nx(this._maskBackgroundBlurTileMaterial,this._materialStrings,r,e,this.scissorQuad(o)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskBackgroundBlurTileMaterial,this._quadArea,It.COPY),this._didDraw=!0,e.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,r,n,o,i){this._flushBeforeMasks&&this._context.flush();let a=L.new3(n),s=i?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),rx(s,this._materialStrings,r,e,this.scissorQuad(a),N.premultiplied(o),i),this.drawToCurrentTile(ze.TRIANGLE_STRIP,s,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,r,n){this._flushBeforeMasks&&this._context.flush();let o=L.new3(n);r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),tx(this._maskTileMaterial,this._materialStrings,r,e,this.scissorQuad(o)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskTileMaterial,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,r,n){this._flushBeforeMasks&&this._context.flush();let o=L.new3(n);r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),ox(this._maskTileLuminanceMaterial,this._materialStrings,r,e,this.scissorQuad(o)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskTileLuminanceMaterial,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,r,n,o){this._flushBeforeMasks&&this._context.flush();let i=L.new3(o);n.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),ix(this._maskTileLuminancePassThroughMaterial,this._materialStrings,n,e,r,this.scissorQuad(i)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskTileLuminancePassThroughMaterial,this._quadArea,It.COPY),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,r,n,o){this._flushBeforeMasks&&this._context.flush();let i=L.new3(o);n.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),ax(this._maskTilePassThroughMaterial,this._materialStrings,n,e,r,this.scissorQuad(i)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskTilePassThroughMaterial,this._quadArea,It.COPY),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,r,n){this._flushBeforeMasks&&this._context.flush();let o=L.new3(n);r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),sx(this._maskKnockoutShadowTileMaterial,this._materialStrings,r,e,this.scissorQuad(o)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskKnockoutShadowTileMaterial,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,r,n,o){this._flushBeforeMasks&&this._context.flush();let i=L.new3(o);n.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(Fe.RGBA_NEAREST_CLAMP),lx(this._maskKnockoutShadowTilePassThroughMaterial,this._materialStrings,n,e,r,this.scissorQuad(i)),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea,It.COPY),r.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(Fe.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e,r){let n=this.downscaleRectForSSAA(e.scissor().clone());n.expand1(1),n.round();let o=this.currentTile().scissor();this.currentTile().setScissor(n.clone().intersectedWith(o));let i;switch(this._tileConfig.SUPERSAMPLE_COUNT()){case 4:{i=this._superSSAA4x4DownsampleMaterial;break}case 2:{i=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${this._tileConfig.SUPERSAMPLE_COUNT()}) when downsampling`)}i===this._blendTextureMaterial?KD(i,this._materialStrings,e.colorTextureForSampling()):WD(i,this._materialStrings,this._tileConfig.baseTileSize,e.colorTextureForSampling()),this.drawToCurrentTile(ze.TRIANGLE_STRIP,i,this._quadArea,r),this.currentTile().setScissor(o)}renderSinglePatternPaint(e,r,n,o,i,a,s,l){if(!i)return;let c=i,d=o.patternSourceAbsoluteBounds(),u=c.currentBounds(this._boundsCache),p=o.patternScale(),_=d.width()*p,h=d.height()*p,g=new F(o.patternSpacing().x()*_,o.patternSpacing().y()*h),m=u.size().multiplyScalar(p*a),A=new F(_+g.x(),h+g.y());if(_+g.x()<=0||h+g.y()<=0)return;let S=F.new();switch(o.patternHorizontalAlignment()){case"START":S.setX(0);break;case"CENTER":S.setX(s.width()/2-_/2);break;case"END":S.setX(s.width()-_);break}switch(o.patternVerticalAlignment()){case"START":S.setY(0);break;case"CENTER":S.setY(s.height()/2-h/2);break;case"END":S.setY(s.height()-h);break}if(S.setX(S.x()%A.x()-A.x()),S.setY(S.y()%A.y()-A.y()),o.patternTileType()=="HORIZONTAL_HEXAGONAL"){let G=Math.floor((s.height()+g.y())/A.y())+1;o.patternVerticalAlignment()=="CENTER"?G>1&&Math.floor(G/2)%2==0&&S.setX(S.x()+A.x()/2):o.patternVerticalAlignment()=="END"&&G>1&&G%2==1&&S.setX(S.x()+A.x()/2)}else if(o.patternTileType()=="VERTICAL_HEXAGONAL"){let G=Math.floor((s.width()+g.x())/A.x())+1;o.patternHorizontalAlignment()=="CENTER"?G>1&&Math.floor(G/2)%2==0&&S.setY(S.y()+A.y()/2):o.patternHorizontalAlignment()=="END"&&G>1&&G%2==1&&S.setY(S.y()+A.y()/2)}let T=A.multiplyScalar(a),R=new F(_,h).multiplyScalar(a),b=this._tileConfig.baseTileSize,O=m.x()>=b||m.y()>=b,f=this.currentTextureSize()/this._tileConfig.baseTileSize,I=f*4,y=1;if(!O&&(m.x()<=I||m.y()<=I)){let G=I/m.x(),V=I/m.y(),D=b/m.x(),w=b/m.y(),k=Math.max(1,Math.min(G,D)),z=Math.max(1,Math.min(V,w));y=Math.min(k,z)}if(!O){this._tileStack.pushTile(new L(0,0,y*Math.max(T.x(),R.x(),m.x()),y*Math.max(T.y(),R.y(),m.y())).scaledBy1(f).expandedBy1(1));let G=xn.new2().scaledBy(1/b).scaledBy(a).scaledBy(p).scaledBy(y).translatedBy1(u.topLeft().multiplyScalar(-1)),V=Q.new2();this.visit(c,Q.new4(G),V,0)}let P=Q.new3(n).translatedBy1(s.topLeft()).scaledBy1(s.size()),E=u.size().subtract(d.size()).multiplyScalar(p),C=d.topLeft().subtract(u.topLeft()).multiplyScalar(p),B=0;switch(o.patternTileType()){case"RECTANGULAR":B=0;break;case"HORIZONTAL_HEXAGONAL":B=1;break;case"VERTICAL_HEXAGONAL":B=2;break}if(!O&&g.x()>=0&&g.y()>=0&&E.x()<=g.x()&&E.y()<=g.y()){let G=this._tileStack.popTile();VD(this._imagePatternMaterial,this._materialStrings,Q.new2(),P,T.multiplyScalar(y),C.multiplyScalar(a*y),b,s.size().multiplyScalar(a*y),S.multiplyScalar(a*y),B,G.colorTextureForSampling()),this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._imagePatternMaterial,this._quadArea,l),this._tileStack.freeTileToPool(G)}else{let G=Math.ceil(s.width()/Math.max(.01,_+g.x()))+2,V=Math.ceil(s.height()/Math.max(.01,h+g.y()))+2;O||(G=Math.min(G,1e3),V=Math.min(V,1e3));let D=Math.floor((u.right()-d.left())*p/(_+g.x())),w=Math.ceil((d.right()-u.left())*p/(_+g.x())),k=Math.floor((u.bottom()-d.top())*p/(h+g.y())),z=Math.ceil((d.bottom()-u.top())*p/(h+g.y())),H=s.topLeft().subtract(d.topLeft()).multiplyScalar(p).subtract(new F(_+g.x(),h+g.y())),K;if(!O){let J=G+D+w,ie=V+k+z;K=new Float32Array((J*ie*4+(J*ie-1)*2)*5)}let j=0,q=J=>{K[j*5]=J.x,K[j*5+1]=J.y,K[j*5+2]=J.u,K[j*5+3]=J.v,j++};for(let J=-k;J<V+z;J++)for(let ie=-D;ie<G+w;ie++){let Ee=S.x(),Ke=S.y();switch(o.patternTileType()){case"RECTANGULAR":break;case"HORIZONTAL_HEXAGONAL":Math.abs(J)%2==1&&(Ee+=A.x()/2);break;case"VERTICAL_HEXAGONAL":Math.abs(ie)%2==1&&(Ke+=A.y()/2);break}let Ve=new F((_+g.x())*ie,(h+g.y())*J),at=new F(Ee,Ke);if(O)this.visit(c,Q.new3(e).multipliedBy1(r).translatedBy1(Ve).translatedBy1(H).translatedBy1(at).scaledBy2(p),Q.new2(),0);else{let Dt=new F(_+g.x(),h+g.y()).multiplyScalar(-1).divide(u.size().multiplyScalar(p)).subtract(C.divide(u.size().multiplyScalar(p))),qt=Ve.add(at).divide(u.size().multiplyScalar(p)),zt=Dt.add(qt),ae=Q.new2().scaledBy2(p).translatedBy1(zt),nt=ae.transformPoint(new F(0,0)),Et=ae.transformPoint(new F(1,0)),He=ae.transformPoint(new F(0,1)),st=ae.transformPoint(new F(1,1)),ke={x:nt.x(),y:nt.y(),u:0,v:0};(ie>-D||J>-k)&&q(ke),q(ke),q({x:Et.x(),y:Et.y(),u:1,v:0}),q({x:He.x(),y:He.y(),u:0,v:1});let kt={x:st.x(),y:st.y(),u:1,v:1};q(kt),(ie<G+w-1||J<V+z-1)&&q(kt)}}if(!O&&K!==void 0&&K.length>0){let J=this._tileStack.popTile();kD(this._imagePatternSingleMaterial,this._materialStrings,Q.new2().scaledBy1(m.divideScalar(b).multiplyScalar(y)),Q.new3(n).translatedBy1(s.topLeft()).scaledBy1(u.size()),J.colorTextureForSampling());let ie=this._bufferPool.allocateVertexBufferAreas(ze.TRIANGLE_STRIP,bt.getPositionF2CoordF3(),new Uint8Array(K.buffer));for(let Ee=0,Ke=ie.length;Ee<Ke;Ee=Ee+1)this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._imagePatternSingleMaterial,ie[Ee],l);for(let Ee=0;Ee<ie.length;Ee+=1)ie[Ee].free();this._tileStack.freeTileToPool(J)}}this._didDraw=!0}drawTextureRegion1(e,r,n){this.drawTextureRegion2(e,r,wt.FrozenAffineTransform_IDENTITY,n,1)}drawTextureRegion2(e,r,n,o,i){let a=e.uvSpaceRect,s=null;if(e.texture.format().minFilter==1||e.texture.format().magFilter==1){s=a.clone();let l=1/e.texture.width();s.contract(l/2)}this.drawTexture2(e.texture,e.uvSpaceRect,s,r,n,o,i)}drawTexture1(e,r,n,o,i){this.drawTexture2(e,r,n,o,wt.FrozenAffineTransform_IDENTITY,i,1)}drawTexture2(e,r,n,o,i,a,s){let l=this._setupDrawTextureState(e,r,n,o,i,a,s);this.drawToCurrentTile(ze.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea,l),this._didDraw=!0}drawTextureToCurrentFramebuffer(e,r,n,o,i,a,s,l,c){let d=this._setupDrawTextureState(e,r,n,o,i,a,s);this._context.draw(ze.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea,d,gr.NONE,l,null,c)}_setupDrawTextureState(e,r,n,o,i,a,s){let l;switch(a){case 0:{l=It.COPY;break}case 1:{l=It.PREMULTIPLIED;break}}return zD(this._drawTextureMaterial,this._materialStrings,e,r,n,o,i,s),l}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)??e}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}},Nl=class{constructor(e,r,n,o,i,a,s){this.renderTree=e,this.shouldCollectNeededImages=r,this.boundsCache=n,this.requestImage=o,this.antialiasingStrategy=i,this.outputTextureNeedsClear=a,this.useLargeTilesForDrawToScreen=s}},Vf=class{constructor(e,r,n,o){this.node=e,this.transform=r,this.framebuffer=n,this.originalOutputTextureFormat=o}equals(e){return e==this?!0:e==null?!1:e.node==this.node&&e.transform.equals2(this.transform,.001)}};var Yv=class{constructor(){this.level=0,this.mode=0}};function kf(t,e,r,n){return n==null?N.BLACK:t!=null?r?N.TRANSPARENT:e=="free"?n.computedBackgroundColor():U.prototypeBackgroundColorOverride!=null&&U.prototypeBackgroundColorOverride.value!=N.TRANSPARENT?U.prototypeBackgroundColorOverride.value:n.prototypeBackgroundColor()!=N.TRANSPARENT?n.prototypeBackgroundColor():N.BLACK:n.computedBackgroundColor()}function ok(t){switch(t){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var ik=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]);var Qv=class{constructor(e,r){this._context=e,this._byteCount=r,this._bytes=new Uint8Array(r)}context(){return this._context}bytesForUpload(){return this._bytes}byteCount(){return this._byteCount}moveBytesForUpload(e,r,n){n>=0,0<=e&&e+n<=this._byteCount,0<=r&&r+n<=this._byteCount,e!=r&&n!=0&&this._bytes.set(this._bytes.subarray(e,e+n),r)}setBytesForUpload(e,r){0<=r&&r+e.length<=this._byteCount,this._bytes.set(e,r)}prepare(){}},qv=class{constructor(e,r,n){this._context=e,this._name=r,this._inputLayout=n}prepare(){throw new Error("Method not implemented.")}program(){throw new Error("Method not implemented.")}getEmscriptenProgramId(){throw new Error("Method not implemented.")}context(){return this._context}name(){return this._name}inputLayout(){return this._inputLayout}setUniformFloat(e,r){}setUniformInt(e,r){}setUniformVec21(e,r,n){}setUniformVec41(e,r,n,o,i){}setUniformMat31(e,r,n,o,i,a,s){}setUniformSampler(e,r,n){}},Xv=class{constructor(e,r,n,o,i){this._context=e,this._width=r,this._height=n,this._format=o,this._purpose=i}context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return!0}markContentHasBeenInitialized(){}resize1(e,r,n,o){}setFormat(e){}setShouldUnloadImageBuffer(e){}deleteTexture(){}},jv=class{constructor(e,r){this._colorTexture=e,this._depthStencilTexture=r}colorTexture(){return this._colorTexture}context(){return this._colorTexture.context()}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(e){this._colorTexture=e}setDepthStencil(e){this._depthStencilTexture=e}resize(e,r){}deleteTexture(){}bounds(){var e,r;return new L(0,0,((e=this._colorTexture)==null?void 0:e.width())??0,((r=this._colorTexture)==null?void 0:r.height())??0)}},gi=class{createVertexBuffer(e){let r=new Qv(this,e);return this.buffers.push(r),r}createVertexBufferPool(){return new Ms(this,this)}addContextResetHandler(e){}beginFrame(){}clear(e,r){this.clearCount+=1}createMaterial(e,r,n,o){return new qv(this,e,r)}createTexture(e,r,n,o){return new Xv(this,r,n,e,o)}createTextureWithPixels(e,r,n,o,i){return null}createTextureWithVideo(e,r,n){return null}createFramebuffer(e,r,n){return new jv(e,r)}currentBlendState(){return null}draw(e,r,n){}drawInstanced(e,r,n){}supportsGpuInstancing(){return!1}flush(){}getNumFramebufferSwitches(){return 0}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(e){}resizeDefaultFramebuffer(e,r){return new Oa(new F(e,r),!1)}readPixels(e,r,n,o,i){return null}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(e){}width(){return 0}annotate(e,r){r()}annotateAndReturn(e,r){return r()}annotateProfile(e,r){r()}isContextLost(){return!1}graphicsCardName(){return"Unknown"}isVisible(){return!1}setMaximumDrawingBufferSizeForTesting(e){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}stats(){return null}getGpuMetricsCollection(){return this._gpuMetricsCollection}supportsCompressedTextures(){return!1}constructor(){this.buffers=[],this._gpuMetricsCollection=new Ls.GpuMetricsCollection,this._gpuMetricsCollection.setBufferSize(2),this.clearCount=0}singleColorTextureManager(){return this._singleColorTextureManager||(this._singleColorTextureManager=new El(this)),this._singleColorTextureManager}};var tu=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,r,n){this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._mockCompressedTexture=!1,this._imageType=1,this._imageMockContext=r,this._imageHash=n}failureIsRetryable(){return null}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}advanceGIFAndUpload(){}decodedData(){return this._mockDecodedData}texture(){return this._texture}processTextureData(){this._mockDecodedData==null||this._gpuContext==null||(this._texture=this._gpuContext.createTexture(this.isCompressedTexture()?U.shouldUseDesktopCompressedTextureFormat()?Fe.BC3_NEAREST_CLAMP:Fe.ASTC_6X6_NEAREST_CLAMP:Fe.RGBA_NEAREST_CLAMP,this.width(),this.height(),fr.IMAGE),this._texture.setShouldUnloadImageBuffer(U.shouldApplyMobileOptimizations()),this._mockDecodedData.pixels!=null&&($n.Texture_resize3(this._texture,this.width(),this.height(),this._mockDecodedData),U.shouldApplyMobileOptimizations()&&this.freeMemoryForDecodedData()))}loadDidFail(){return!1}isCompressedTexture(){return this._mockCompressedTexture}setIsCompressedTexture(e){this._mockCompressedTexture=e}primeWithCompressedData(e){}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,r,n){var o;this._isImageMockLoading||(this._decodeCallback=r,this._failureCallback=n,this._isImageMockLoading=!0,(o=this._imageMockContext)==null||o.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=lr.createFromPixels(1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var Pl=class t{constructor(e,r,n){this._hyperlinkBoxes=e,this._usedEmojiCodepoints=r,this._usedEmojiImages=n}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests(e){return new t([],e,[])}};var Hf=class{constructor(e,r,n,o){this.node=e,this.property=r,this.oldVal=n,this.newVal=o}},Va=class Va{constructor(e){this._listeners=new Set;this._handle=0,this._observers=new bn,this._nodes=new Map,this._cachedRoot=null,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._handle=e}handle(){return this._handle}firstUserCanvasOrNull(){for(let e=0,r=this.root().childCount();e<r;e=e+1){let n=this.root().childAt1(e);if(n.type()=="CANVAS"&&!n.isInternalOnly())return n}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){var r,n;Va.VERBOSE&&console.log(`broadcasting change for property '${Ht[e.property]}' on node '${e.node.id()}'`),this._observers.forEach(o=>{o.handleSceneGraphEvent(e)}),(r=v())!=null&&r.modules().revisionNumberAccessor&&((n=v())==null||n.modules().revisionNumberAccessor.incrementRevisionNumber());for(let o of this._listeners)o()}onChange(e){return this._listeners.add(e),()=>{var r;return(r=this._listeners)==null?void 0:r.delete(e)}}get isValidScene(){var e;return!!((e=v())!=null&&e.modules().revisionNumberAccessor)}getRevisionNumber(){var e,r;return(e=v())!=null&&e.modules().revisionNumberAccessor?(r=v())==null?void 0:r.modules().revisionNumberAccessor.getRevisionNumber():0}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],no(this.root(),r=>r.type()=="DOCUMENT"||r.type()=="CANVAS"||r.type()=="SECTION"||r.type()=="SLIDE_GRID"||r.type()=="SLIDE_ROW"||r.isSlideModule()?0:r.isTopLevel()?(r.setHasBeenLoaded(e(r)),r.hasBeenLoaded()&&this._loadedTlfs.push(r),0):2)}hierarchyDebugString(){let e="",r=(n,o)=>{let i=n.symbolID(),a=i!=null?` -> ${i}`:"";e+=`${o}${n.id()} ${n.name()}${a}
`,o+="  ";for(let s=0,l=n.childCount();s<l;s=s+1)r(n.childAt1(s),o)};return r(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let r=this.findNode(e.id());if(r!=null&&r!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(e.id(),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(e),X.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let r of this._deferredUnregisters)this.dangerouslyUnregisterNode(r);this._deferredUnregisters=null}markLoaded(){var e;(e=v())==null||e.markSceneLoaded(this)}destroy(){var e;(e=v())==null||e.destroyScene(this)}setFileKey(e){var r;(r=v())==null||r.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){var o;let r=Ze.milliseconds();(o=v())==null||o.applyNodeChanges(e);let n=Ze.milliseconds()-r;n>100&&console.warn(`applyMessageToScene took ${n/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){qe.StringMap_each(this._nodes,(r,n)=>{e(n)})}findNode(e){return e==null?null:qe.StringMap_get(this._nodes,e,null)}findNodeByStablePath(e){if(e==null||e.guids==null)return null;let r=v().findNode(this,e);return this.findNode(r)}findStyle(e){let r=v().sceneGraphTsApi().styleByIdOrNull(e);return this.findNode(r)}createNode(e,r){if(!Yr())throw new Error("Should not be creating nodes in TS Viewer while running fullview");let n={};return n.guid=X.toFigGUID(e),n.phase="CREATED",n.type=r,vv(n),this.findNode(e)}removeNode(e){if(!Yr())throw new Error("Should not be removing nodes in TS Viewer while running fullview");let r={};r.guid=X.toFigGUID(e),r.phase="REMOVED",vv(r);let n=this.findNode(e)}root(){var e;return this._cachedRoot==null&&(this._cachedRoot=this.findNode(X._new(0,0)),(e=this._cachedRoot)==null||e.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){v().updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){v().updateStylesForTests()}findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let r=e.slice(1).split(";");if(r.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let n=X.fromString(r[0]),o=this.findNode(n);if(o==null)return console.error("Cannot find table from table cell developer friendly id"),null;let i=X.fromString(r[1]),a=X.fromString(r[2]);return o.getTableCellAt(i,a)}else if(e.charCodeAt(0)==73){let r=e.slice(1).split(";"),n=X.fromString(r[0]),o=this.findNode(n),i=null;i=(s,l)=>{if(s==null)return null;if(l(s))return s;for(let c=0,d=s.childCount();c<d;c=c+1){let u=i(s.childAt1(c),l);if(u!=null)return u}return null};let a=new Rt(r.map(s=>X.fromString(s)));return i(o,s=>Rt.equals(s.stablePath(),a))}else return this.findNode(e)}static createCanvasInScene(e,r){let n=e.createNode(r,"CANVAS");return n.setVisible(!0),n.setOpacity(1),n.setName("canvas"),n.setCurrentViewportSize(new F(1e6,1e6)),e.root().appendChild(n),n}static createLoadedFrameWithCanvasContent(e,r){let n=new vt,o=[];no(r,l=>l.isTopLevel()?(n.include3(l.fullSizeCanvasSpaceBoundingBox()),o.push(l),2):0);let i=n.build();i.expand1(150);let a=r.fillPaintsToRender()[0].asSinglePaint();a.opacity()==0&&(a=$.createSolid(N.WHITE,1));let s=_i(r,"frame",a);je(s,i.topLeft(),i.size()),s.setTestOnlyFillGeometry(la(s.fullSizeCanvasSpaceBoundingBox()));for(let l of o){let c=l.relativeTransform().clone();c.translate1(s.relativeTransform().translation().negative()),l.setParentIndex(new vn(X.invalid(),Or.fromString(""))),s.appendChild(l),l.setRelativeTransform(c)}return e.setTlfsLoaded(l=>l==s?!0:l.hasBeenLoaded()),s}static createScene(e,r){return v().createSceneAndSetActive(e,r)}static createSceneWithCanvasForTests1(){return Va.createSceneWithCanvasForTests2(U.ViewerMode.PROTOTYPE)}static createSceneWithCanvasForTests2(e){var n;U.setViewerMode(e);let r=Va.createScene(Va.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,null);return(n=v())==null||n.modules().prototype.setSceneMetadata("1"),Va.createCanvasInScene(r,X._new(0,1)),r.markLoaded(),r}};Va.MAX_GUID_VALUE=2147483647,Va.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=Va.MAX_GUID_VALUE-1,Va.VERBOSE=!1;var Me=Va;function Zv(t){return t.x()==375&&t.y()==812?"APPLE_IPHONE_X_SILVER":t.x()==414&&t.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":t.x()==375&&t.y()==667?"APPLE_IPHONE_8_SILVER":t.x()==320&&t.y()==568?"APPLE_IPHONE_SE_SILVER":t.x()==411&&t.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":t.x()==768&&t.y()==1024?"APPLE_IPAD_MINI_4_SILVER":t.x()==1024&&t.y()==1366?"APPLE_IPAD_PRO_SILVER":t.x()==1440&&t.y()==990?"MICROSOFT_SURFACE_PRO_3":t.x()==1368&&t.y()==912?"MICROSOFT_SURFACE_PRO_4":t.x()==312&&t.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":t.x()==272&&t.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var _e=class _e{constructor(e,r,n=null){this._paths=new Map;this._appState=e,this._imageManager=r,this._videoManager=n}static hash(e,r){return r instanceof Array&&r.length===0?e:r}static hasFileHeader(e){for(let r=0,n=_e.FILE_HEADER.length;r<n;r=r+1)if(r>=e.length||e[r]!=_e.FILE_HEADER[r])return!1;return!0}static parseChunkType(e){return e.length!=_e.CHUNK_TAG_LEN?_e.ChunkType.UNKNOWN:(n=>{for(let o=0,i=e.length;o<i;o=o+1)if(e[o]!=n[o])return!1;return!0})(_e.THUMBNAIL_CHUNK_TAG)?_e.ChunkType.THUMBNAIL:_e.ChunkType.UNKNOWN}static readInt32(e,r){return e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,r){console.log(`decoded property change '${r}' for node '${e}'`)}static encodeGUID(e){return X.toFigGUID(e)}static encodeGUIDPath(e){let r={};return e.guids!=null&&(r.guids=e.guids.map(n=>_e.encodeGUID(n))),r}static encodeInstanceStateChange(e,r){let n={};return n.stateID=_e.encodeGUID(e.newStateId()),n.interactionID=_e.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(n.hotspotStablePath=_e.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(n.instanceStablePath=_e.encodeGUIDPath(e.stablePath)),n.phase=r,n}static encodePrototypeStateChange(e){let r={};if(e.oldStateAndOverlays!=null){let n={};e.oldStateAndOverlays.stateId!=null&&(n.baseScreenID=_e.encodeGUID(e.oldStateAndOverlays.stateId),n.overlays=e.oldStateAndOverlays.overlays.map(o=>_e.encodeOverlayData(o,null))),r.oldState=n}if(e.newStateAndOverlays!=null){let n={};e.newStateAndOverlays.stateId!=null&&(n.baseScreenID=_e.encodeGUID(e.newStateAndOverlays.stateId),n.overlays=e.newStateAndOverlays.overlays.map(o=>_e.encodeOverlayData(o,null))),r.newState=n}return e.interactionAddress.hotspotStablePath!=null&&(r.hotspotBlueprintID=_e.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),r.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,r.interactionID=_e.encodeGUID(e.interactionAddress.interactionId),r.direction=e.direction==0?"FORWARD":"REVERSE",r}static encodeOverlayData(e,r){let n={};return n.hotspotBlueprintId=_e.encodeGUIDPath(e.openingHotspotStablePath),r!=null&&(n.hotspotGuid=_e.encodeGUID(r)),n.overlayGuid=_e.encodeGUID(e.id),n.prototypeInteractionGuid=_e.encodeGUID(e.openingInteractionId),n.swapGuid=_e.encodeGUID(e.overlayDataModelId),n}static encodeMatrix(e){let r={};return r.m00=e.m00(),r.m01=e.m01(),r.m02=e.m02(),r.m10=e.m10(),r.m11=e.m11(),r.m12=e.m12(),r}static encodeVector1(e){let r={};return r.x=e.x(),r.y=e.y(),r}static encodeVector2(e){let r={};return r.x=e.x(),r.y=e.y(),r}static decodeGUID(e){let r=null,n=e.sessionID|0;if(n<0){let o=e.localID|0;n==-1&&(o==-1||o==-2)?r=X._new(n,o):(xe("Negative session ID encountered in GUID deserialization"),r=X._new(e.sessionID,e.localID))}else r=X._new(e.sessionID,e.localID);return pt.asGUID(r)}static decodeGUID_instanceHACK(e){return X._new(e.sessionID|0,e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let r=[];for(let n of e.guids){let o=_e.decodeGUID(n);if(o==null)return null;r.push(o)}return new Rt(r)}static decodeStyleId(e){let r=e.guid!=null?_e.decodeGUID(e.guid):null,n=e.assetRef!=null?{key:zd(e.assetRef.key),version:Wd(e.assetRef.version)}:null,o={guid:r,ref:n};return pt.asStyleId(o)}static decodeVariableSetId(e){return Ga.fromKiwi(e)}static decodeParentIndex(e){return new vn(_e.decodeGUID(e.guid),Or.fromString(e.position))}static decodeVector(e){return new F(e.x,e.y)}static decodeMatrix(e){return new Q(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return N.new3(e.r,e.g,e.b,e.a)}static encodeColor(e){return{r:N.red(e),g:N.green(e),b:N.blue(e),a:N.alpha(e)}}static decodeFontName(e){let r=e.postscript!==void 0?e.postscript:"";return new Km(e.family,e.style,r)}static decodeNumber(e){return new Wm(e.value,e.units)}static decodeStops(e){let r=[];for(let n of e)r.push(new _t(_e.decodeColor(n.color),n.position));return r}static encodeStops(e){let r=[];for(let n of e)r.push({color:_e.encodeColor(n.color),position:n.position});return r}static decodePrototypeDevice(e){let r=_e.decodeVector(e.size),n=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(n==null||n.length==0)&&(n=Zv(r));let o=e.rotation!==void 0?e.rotation:"NONE";return new Wn(e.type,r,n,o)}static decodePrototypeStartingPoint(e){return new wa(e.name,e.description,Or.fromString(e.position))}static encodePrototypeStartingPoint(e){let r={};return r.name=e.name,r.description=e.description,r.position=Or.toString(e.position),r}static decodeOverlayBackgroundAppearance(e){return new La(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?_e.decodeColor(e.backgroundColor):N.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1,showControls:e.showControls!==void 0?e.showControls:!1,startTimeMs:e.startTimeMs!==void 0?e.startTimeMs:0,endTimeMs:e.endTimeMs!==void 0?e.endTimeMs:0}}static decodeEffects(e){let r=[];for(let o of e){let i=new Oe;i.setType(o.type),o.color!==void 0&&i.setColor(_e.decodeColor(o.color)),o.secondaryColor!==void 0&&i.setSecondaryColor(_e.decodeColor(o.secondaryColor)),o.blendMode!==void 0&&i.setBlendMode(o.blendMode),o.offset!==void 0&&i.setBlurOffset1(_e.decodeVector(o.offset)),o.radius!==void 0&&i.setBlurRadius(o.radius),o.visible!==void 0&&i.setIsEnabled(o.visible),o.spread!==void 0&&i.setSpread(o.spread),o.showShadowBehindNode!==void 0?i.setShowShadowBehindNode(o.showShadowBehindNode):i.setShowShadowBehindNode(!0),o.blurOpType!==void 0&&i.setBlurOpType(o.blurOpType),o.startOffset!==void 0&&i.setBlurStartOffset1(_e.decodeVector(o.startOffset)),o.endOffset!==void 0&&i.setBlurEndOffset1(_e.decodeVector(o.endOffset)),o.startRadius!==void 0&&i.setBlurStartRadius(o.startRadius),o.noiseSize!==void 0&&i.setNoiseSize(_e.decodeVector(o.noiseSize)),o.density!==void 0&&i.setDensity(o.density),o.noiseType!==void 0&&i.setNoiseType(o.noiseType),o.clipToShape!==void 0&&i.setClipToShape(o.clipToShape),o.opacity!==void 0&&i.setEffectOpacity(o.opacity),o.seed!==void 0&&i.setSeed(o.seed),o.refractionIntensity!==void 0&&i.setRefractionIntensity(o.refractionIntensity),o.refractionRadius!==void 0&&i.setRefractionDistance(o.refractionRadius),o.specularAngle!==void 0&&i.setSpecularAngle(o.specularAngle),o.specularIntensity!==void 0&&i.setSpecularIntensity(o.specularIntensity),o.chromaticAberration!==void 0&&i.setChromaticAberration(o.chromaticAberration),o.reflectionDistance!==void 0&&i.setReflectionDistance(o.reflectionDistance),o.bevelSize!==void 0&&i.setBevelSize(o.bevelSize),r.push(i)}let n=r;return pt.asEffectList(n)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new Md(e.type,e.value):new Md("CONTENT_SCALE",1)}static decodeExportSettings(e,r){let n=[];for(let o of e){let i=null;o.suffix!==void 0?i=o.suffix:i="";let a=null;o.imageType!==void 0?a=o.imageType:a="PNG";let s=null;o.constraint!==void 0?s=_e.decodeExportConstraint(o.constraint):s=new Md("CONTENT_SCALE",1);let l=r;o.contentsOnly!==void 0&&(l=o.contentsOnly),n.push(new Ym(i,a,s,l))}return n}static decodePrototypeInteractions(e){return e.map(r=>_e.decodePrototypeInteraction(r))}static decodePrototypeInteraction(e){let r=e.id!==void 0?_e.decodeGUID(e.id):null,n=e.event!==void 0?_e.decodePrototypeEvent(e.event):null,o=e.actions!==void 0?e.actions.map(s=>_e.decodePrototypeAction(s)):null,i=e.isDeleted!==void 0?e.isDeleted:!1,a=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new dr(r,n,o,i,a)}static encodePrototypeInteractionForTests(e){let r={};r.id=_e.encodeGUID(e.id()),r.isDeleted=e.isDeleted(),r.stateManagementVersion=e.stateManagementVersion(),r.event=_e.encodePrototypeEventForTests(e.event());let n=[],o=e.actions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodePrototypeActionForTests(s))}return r.actions=n,r}static decodePrototypeEvent(e){let r=e.interactionType!==void 0?e.interactionType:null,n=e.interactionMaintained!==void 0?new fe(e.interactionMaintained):null,o=e.interactionDuration!==void 0?new fe(e.interactionDuration):null,i=e.keyTrigger!==void 0?e.keyTrigger:null,a=e.transitionTimeout!==void 0?new fe(e.transitionTimeout):null,s=e.mediaHitTime!==void 0?new fe(e.mediaHitTime):null;return new Po(r,n,o,i,a,s)}static encodePrototypeEventForTests(e){let r={};return r.interactionType=e.interactionType(),r.interactionMaintained=e.interactionMaintained(),r.interactionDuration=e.interactionDuration(),r.keyTrigger=e.keyTrigger(),r.keyTrigger.keyCodes=e.keyTrigger().keyCodes,r.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,r.transitionTimeout=e.transitionTimeout(),r.mediaHitTime=e.mediaHitTime(),r}static decodeConditionalActions(e){let r=[],n=e.actions!==void 0?e.actions.map(i=>_e.decodePrototypeAction(i)):r,o=e.condition!==void 0?_e.variableDataToJson(e.condition):"";return new zp(n,o)}static encodeConditionalActionsForTests(e){let r={},n=[],o=e.actions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodePrototypeActionForTests(s))}return r.actions=n,r}static decodePrototypeAction(e){let r=e.transitionNodeID!==void 0?_e.decodeGUID(e.transitionNodeID):null,n=e.transitionType!==void 0?e.transitionType:null,o=e.transitionDuration!==void 0?new fe(e.transitionDuration):null,i=e.easingType!==void 0?e.easingType:null,a=e.easingFunction!==void 0?e.easingFunction:null,s=e.transitionShouldSmartAnimate!==void 0?new fe(e.transitionShouldSmartAnimate):null,l=e.connectionType!==void 0?e.connectionType:null,c=e.connectionURL!==void 0?e.connectionURL:null,d=e.overlayRelativePosition!==void 0?_e.decodeVector(e.overlayRelativePosition):null,u=e.navigationType!==void 0?e.navigationType:null,p=e.transitionPreserveScroll!==void 0?new fe(e.transitionPreserveScroll):null,_=e.extraScrollOffset!==void 0?_e.decodeVector(e.extraScrollOffset):null,h=e.mediaAction!==void 0?e.mediaAction:null,g=e.transitionResetVideoPosition!==void 0?new fe(e.transitionResetVideoPosition):null,m=e.openUrlInNewTab!==void 0?new fe(e.openUrlInNewTab):null,A=e.mediaSkipToTime!==void 0?new fe(e.mediaSkipToTime):null,S=e.mediaSkipByAmount!==void 0?new fe(e.mediaSkipByAmount):null,T=e.transitionResetScrollPosition!==void 0?new fe(e.transitionResetScrollPosition):null,R=e.conditionalActions!==void 0?e.conditionalActions.map(V=>_e.decodeConditionalActions(V)):null,b=e.transitionResetInteractiveComponents!==void 0?new fe(e.transitionResetInteractiveComponents):null,O=e.targetVariable!==void 0&&e.targetVariable.id?Mp.toString(e.targetVariable.id):null,f=e.targetVariable!==void 0&&e.targetVariable.nodeFieldAlias?_e.nodeFieldAliasToJson(e.targetVariable.nodeFieldAlias):null,I=e.targetVariableData!==void 0?_e.variableDataToJson(e.targetVariableData):null,y=e.targetVariableModeID!==void 0?_e.decodeGUID(e.targetVariableModeID):null,P=e.targetVariableSetID!==void 0?_e.decodeVariableSetId(e.targetVariableSetID):null,E=e.targetVariableSetKey!==void 0?e.targetVariableSetKey:null,C=e.variableSetTargetExtensionId!==void 0?_e.decodeVariableSetId(e.variableSetTargetExtensionId):null,B=e.animationType!==void 0?e.animationType:null,G=e.animationPhase!==void 0?e.animationPhase:null;return new Ir(r,n,o,i,a,s,l,c,d,u,p,_,h,g,m,A,S,T,R,b,O,I,y,P,E,C,f,B,G)}static variableDataToJson(e){var o,i,a,s;let r={},n=e.dataType;switch(r.type=_e.variableDataTypeToEnumValue(n),r.resolvedType=_e.variableResolvedDataTypeToEnumValue(e.resolvedDataType),n){case"BOOLEAN":{r.value=e.value.boolValue;break}case"STRING":{r.value=e.value.textValue;break}case"FLOAT":{r.value=e.value.floatValue;break}case"COLOR":{let l={};l.r=e.value.colorValue.r,l.g=e.value.colorValue.g,l.b=e.value.colorValue.b,l.a=e.value.colorValue.a,r.value=l;break}case"ALIAS":{r.value=Mp.toString(e.value.alias);break}case"NODE_FIELD_ALIAS":{r.value=_e.nodeFieldAliasToJson(e.value.nodeFieldAliasValue);break}case"CMS_ALIAS":{let l=(o=e.value)==null?void 0:o.cmsAliasValue;r.value=l?_e.cmsAliasToJson(l):{};break}case"JS_RUNTIME_ALIAS":{let l=(i=e.value)==null?void 0:i.jsRuntimeAliasValue;r.value=l?_e.jsRuntimeAliasToJson(l):{};break}case"MANAGED_STRING_ALIAS":{let l=(a=e.value)==null?void 0:a.managedStringAliasValue;r.value=l?_e.managedStringAliasToJson(l):{};break}case"PROP_REF":{let l=(s=e.value)==null?void 0:s.propRefValue;r.value=l?_e.componentPropRefToJson(l):{};break}case"EXPRESSION":{r.value=_e.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return r}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7;case"FONT_STYLE":return 8;case"TEXT_DATA":return 9;case"INVALID":return 10;case"NODE_FIELD_ALIAS":return 11;case"CMS_ALIAS":return 12;case"PROP_REF":return 13;case"IMAGE":return 14;case"MANAGED_STRING_ALIAS":return 15;case"LINK":return 16;case"JS_RUNTIME_ALIAS":return 17}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5;case"FONT_STYLE":return 6;case"TEXT_DATA":return 7;case"IMAGE":return 8;case"LINK":return 9;case"JS_RUNTIME_ALIAS":return 10}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let r={};r.expressionFunction=_e.expressionFunctionToEnumValue(e.expressionFunction);let n=[];for(let o=0;o<e.expressionArguments.length;o=o+1)n.push(_e.variableDataToJson(e.expressionArguments[o]));return r.expressionArguments=n,r}static nodeFieldAliasToJson(e){let r={};return r.stablePathToNode=_e.decodeGUIDPath(e.stablePathToNode),r.nodeField=e.nodeField,r.indexOrKey=e.indexOrKey,r}static cmsAliasToJson(e){let r={};return e&&(r.collectionId=e.collectionId,r.fieldId=e.fieldId),r}static jsRuntimeAliasToJson(e){let r={};return e&&(r.lookupKey=e.lookupKey),r}static managedStringAliasToJson(e){let r={};return e&&(r.managedStringId=e.managedStringId?Mm.toString(e.managedStringId):""),r}static componentPropRefToJson(e){let r={};return e&&(r.defId=e.defId),r}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16;case"NEGATE":return 17;case"IS_TRUTHY":return 18;case"KEYFRAME":return 19}}static encodePrototypeActionForTests(e){let r={};r.transitionNodeID=_e.encodeGUID(e.transitionNodeID()),r.transitionType=e.transitionType(),r.transitionDuration=e.transitionDuration(),r.easingType=e.easingType(),r.easingFunction=e.easingFunctionValues(),r.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),r.connectionType=e.connectionType(),r.connectionURL=e.connectionURL(),r.overlayRelativePosition=_e.encodeVector1(e.overlayRelativePosition()),r.navigationType=e.navigationType(),r.transitionPreserveScroll=e.transitionPreserveScroll(),r.extraScrollOffset=_e.encodeVector1(e.extraScrollOffset()),r.mediaAction=e.mediaAction(),r.transitionResetVideoPosition=e.transitionResetVideoPosition(),r.openUrlInNewTab=e.openUrlInNewTab(),r.mediaSkipToTime=e.mediaSkipToTime(),r.mediaSkipByAmount=e.mediaSkipByAmount(),r.transitionResetScrollPosition=e.transitionResetScrollPosition();let n=[],o=e.conditionalActions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodeConditionalActionsForTests(s))}return r.conditionalActions=n,r.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),r.animationType=e.animationType(),r.animationPhase=e.animationPhase(),r}static serializeValueToKiwiForTests1(e,r){let n={},o=[];return _e.serializeValueToKiwiForTests2(e,r,n,o),new ao(n,o)}static serializeValueToKiwiForTests2(e,r,n,o){if(!Yr())throw new Error("Should only serialize values to kiwi when running tests");if(e==24||e==88){let i=pt.asPaintList(r);if(i==null)throw new Error("attempt to set null paint list");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let c=i[s].asSinglePaint(),d={};if(d.type=c.type(),d.opacity=c.opacity(),d.visible=c.isEnabled(),d.blendMode=c.blendMode(),d.transform=_e.encodeMatrix(c.transform()),c.colorStops()!=null){let p=[];for(let _=0,h=c.colorStops().length;_<h;_=_+1){let g=c.colorStops()[_],m={},A={};A.r=N.redF(g.color),A.g=N.greenF(g.color),A.b=N.blueF(g.color),A.a=N.alphaF(g.color),m.color=A,m.position=g.position,p.push(m)}d.stops=p}let u={};if(u.r=N.redF(c.color()),u.g=N.greenF(c.color()),u.b=N.blueF(c.color()),u.a=N.alphaF(c.color()),d.color=u,c.image()!=null&&c.image().hash()!=null){let p={};p.hash=Dn.hexToBytes(c.image().hash()),d.image=p,d.imageScaleMode=c.imageScaleMode()}a.push(d)}e==24?n.fillPaints=a:e==88&&(n.strokePaints=a)}else if(e==96){let i=r;if(i==null)throw new Error("attempt to set null symbol data");let a={};a.symbolID=_e.encodeGUID(i.masterID);let s=[];Ui.map(i.instanceOverrides).each((l,c)=>{let d={};d.guidPath=_e.encodeGUIDPath(l),Nr.each(c,(u,p)=>{_e.serializeValueToKiwiForTests2(u,p,d,[])}),s.push(d)}),a.symbolOverrides=s,n.symbolData=a}else if(e==23||e==87){let i=r;if(i==null)throw new Error("attempt to set null geometry");let a=[];for(let s=0,l=i.regions.length;s<l;s=s+1){let c=i.regions[s],d={};d.windingRule=c.windingRule,d.styleID=c.styleID,d.commandsBlob=o.length,o.push(Lt.mutableData(c.path().toBezierPath().getMutableClone()).bytes()),a.push(d)}e==23?n.fillGeometry=a:n.strokeGeometry=a}else if(e==99){let i=r;if(i==null)throw new Error("attempt to set null textData");let a={};a.characters=i.characters();let s=[];i.styleOverrideTable().forEachStyle((l,c)=>{ss.each(c,(d,u)=>{let _=_e.serializeValueToKiwiForTests1(d,u).a;_.styleID=l,s.push(_)})}),a.styleOverrideTable=s,n.textData=a}else if(e==19){let i=r;if(i==null)throw new Error("attempt to set null textData");let a={},s=[];i.usedEmojiCodepoints().forEach(l=>{let c={};c.emojiCodePoints=l,s.push(c)}),a.glyphs=s,a.hyperlinkBoxes=i.hyperlinkBoxes().map(l=>({guid:l.guid,bounds:l.bounds,hyperlinkID:l.hyperlinkID,url:l.url})),n.derivedTextData=a}else if(e==21){let i=pt.asEffectList(r);if(i==null)throw new Error("attempt to set null effects");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let c=i[s],d={};d.blendMode=c.blendMode(),d.radius=c.blurRadius(),d.spread=c.spread(),d.visible=c.isEnabled(),d.showShadowBehindNode=c.showShadowBehindNode(),d.type=c.type();let u={};u.r=N.redF(c.color()),u.g=N.greenF(c.color()),u.b=N.blueF(c.color()),u.a=N.alphaF(c.color()),d.color=u;let p=_e.encodeVector2(c.blurOffset());d.offset=p,d.density=c.density(),d.noiseSize=_e.encodeVector2(c.noiseSize()),d.noiseType=c.noiseType();let _={};_.r=N.redF(c.secondaryColor()),_.g=N.greenF(c.secondaryColor()),_.b=N.blueF(c.secondaryColor()),_.a=N.alphaF(c.secondaryColor()),d.secondaryColor=_,d.seed=c.seed(),d.opacity=c.effectOpacity(),d.clipToShape=c.clipToShape(),a.push(d)}n.effects=a}else if(e==55){let i=pt.asGUID(r);if(i==null)throw new Error("attempt to set null overridenSymbolID");n.overriddenSymbolID=_e.encodeGUID(i)}else if(e==61||e==47){let i=r;if(i==null)throw new Error("attempt to set null prototypeInteractions");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let d=i[s];a.push(_e.encodePrototypeInteractionForTests(d))}e==61?n.prototypeInteractions=a:e==47&&(n.objectAnimations=a)}else if(e==114){let i=pt.asStringEnum(r,null);if(i==null)throw new Error("Bad node phase");n.phase=i}else{let i=Hd(e);throw new Error(`unsupported setter for node field ${Ht[e]} and type ${Qp[i]}`)}}_imageDecoded(e,r,n){this._imageManager!=null&&this._imageManager.onNewImage(e,r,n)}_imageByHexHashOrNull(e,r){var n;return(n=this._imageManager)==null?void 0:n.findImageByHexHash(e,r)}decodeImage(e,r,n){let o=Dn.bytesToHex(e.hash),i=this._imageByHexHashOrNull(o,1);if(i==null){let a=null;if(e.dataBlob!==void 0){let s=e.dataBlob;s<0||s>=r.length?console.warn(`ignoring invalid compressed data index ${s} for blob count ${r.length}`):a=r[s].bytes}Uo?i=new tu(new gi,null,o):i=Li.createImage(e.hash??null,a,n),this._imageDecoded(o,1,i)}return i}decodeVideo(e){let r=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(r)}decodeEmojiImage(e,r){let n=Dn.emojiCodepointsToKey(e),o=this._imageByHexHashOrNull([n,r].join("-"),0);return o==null&&(o=Li.createEmojiImage(e,r),this._imageDecoded([n,r].join("-"),0,o)),o}decodePaints(e,r){let n=[];for(let i of e){let a=new $(i.type);if(i.blendMode!==void 0&&a.setBlendMode(i.blendMode),i.color!==void 0){let s=_e.decodeColor(i.color);a.setOpacity(N.alphaF(s)),a.setColor(N.withAlpha(s,255))}if(i.opacity!==void 0&&a.setOpacity(a.opacity()*i.opacity),i.stops!==void 0&&a.setColorStops1(_e.decodeStops(i.stops)),i.transform!==void 0&&a.setTransform1(_e.decodeMatrix(i.transform)),i.visible!==void 0&&a.setIsEnabled(i.visible),i.imageScaleMode!==void 0&&a.setImageScaleMode(i.imageScaleMode),i.rotation!==void 0&&a.setRotationDeg(i.rotation),i.scale!==void 0&&a.setScalingFactor(i.scale),i.paintFilter!==void 0&&a.setFilterColorAdjust(i.paintFilter),i.originalImageWidth!==void 0&&a.setOriginalImageWidth(i.originalImageWidth),i.originalImageHeight!==void 0&&a.setOriginalImageHeight(i.originalImageHeight),i.emojiCodePoints!==void 0)a.setImage(this.decodeEmojiImage(i.emojiCodePoints,"apple"));else{let s=!1;i.animatedImage!==void 0&&i.animatedImage.hash!==void 0?(a.setImage(this.decodeImage(i.animatedImage,r,0)),i.animationFrame!==void 0&&i.animationFrame!=0&&(s=!0)):i.video!==void 0&&i.video.hash!==void 0?(a.setVideo(this.decodeVideo(i.video)),i.image!==void 0&&i.image.hash!==void 0&&a.setImage(this.decodeImage(i.image,r,1))):i.image!==void 0&&i.image.hash!==void 0&&a.setImage(this.decodeImage(i.image,r,1)),!s&&i.imageThumbnail!==void 0&&i.imageThumbnail.hash!==void 0&&a.setImageThumbnail(this.decodeImage(i.imageThumbnail,r,1))}if(i.sourceNodeId!==void 0){let s=this._appState.scene().findNode(X.fromFigGUID(i.sourceNodeId));s!=null?(a.setPatternSource(s),a.setPatternSourceAbsoluteBounds(s.fullSizeCanvasSpaceBoundingBox()),i.patternTileType!==void 0&&a.setPatternTileType(i.patternTileType),i.horizontalAlignment!==void 0&&a.setPatternHorizontalAlignment(i.horizontalAlignment),i.verticalAlignment!==void 0&&a.setPatternVerticalAlignment(i.verticalAlignment),i.scale!==void 0&&a.setPatternScale(i.scale),i.patternSpacing!==void 0&&a.setPatternSpacing(Ae.FrozenVector_new3(_e.decodeVector(i.patternSpacing)))):(a.setPatternSourceAbsoluteBounds(ar.FrozenRect_new4(0,0,4,4)),a.setPatternTileType("RECTANGULAR"),a.setPatternHorizontalAlignment("CENTER"),a.setPatternVerticalAlignment("CENTER"),a.setPatternScale(1),a.setPatternSpacing(Ae.FrozenVector_new4(5,5)))}a.opacity()!=0&&a.opacity()<1/250&&a.setOpacity(1/250),n.push(a)}let o=n;return pt.asPaintList(o)}encodePaints(e){let r=[];for(let n=0;n<e.length;n++){let o=e[n],i={type:o.type()},a=o.blendMode();if(a!=="NORMAL"&&(i.blendMode=a),o.type()==="SOLID"){let _=o.color();i.color=_e.encodeColor(_)}let s=o.opacity();s!==1&&(i.opacity=s),o.isEnabled()||(i.visible=!1);let l=o.colorStops();l&&l.length>0&&(i.stops=_e.encodeStops(l));let c=o.transform();c&&(i.transform=_e.encodeMatrix(c));let d=o.imageScaleMode();d!=="STRETCH"&&(i.imageScaleMode=d);let u=o.rotationDeg();u!==0&&(i.rotation=u);let p=o.scalingFactor();p!==1&&(i.scale=p),r.push(i)}return r}encodeEffects(e){let r=[];for(let n=0;n<e.length;n++){let o=e[n],i={};i.blendMode=o.blendMode(),i.radius=o.blurRadius(),i.spread=o.spread(),i.visible=o.isEnabled(),i.showShadowBehindNode=o.showShadowBehindNode(),i.type=o.type();let a={};a.r=N.redF(o.color()),a.g=N.greenF(o.color()),a.b=N.blueF(o.color()),a.a=N.alphaF(o.color()),i.color=a;let s=_e.encodeVector2(o.blurOffset());i.offset=s,i.density=o.density(),i.noiseSize=_e.encodeVector2(o.noiseSize()),i.noiseType=o.noiseType();let l={};l.r=N.redF(o.secondaryColor()),l.g=N.greenF(o.secondaryColor()),l.b=N.blueF(o.secondaryColor()),l.a=N.alphaF(o.secondaryColor()),i.secondaryColor=l,i.seed=o.seed(),i.opacity=o.effectOpacity(),i.clipToShape=o.clipToShape(),r.push(i)}return r}decodePath(e,r){let n=nr.IntMap_get(this._paths,e,null);return n==null&&(e<0||e>=r.length?(console.warn(`ignoring invalid path index ${e} for blob count ${r.length}`),n=new Lt(new oo)):n=new Lt(new oo(new Uint8Array(r[e].bytes))),this._paths.set(e,n)),n}decodeCodeSnapshot(e,r){let n=e.paints!==void 0?this.decodePaints(e.paints,r):[],o=_e.decodeVector(e.offset),i=_e.decodeVector(e.layoutSize),a=_e.decodeVector(e.canvasSize);return new Bd(n,o,i,a,e.devicePixelRatio)}decodeGeometry(e,r){let n=[],o=null;for(let i of e){let a="ODD";if(i.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}i.windingRule!==void 0&&(a=i.windingRule);let s=this.decodePath(i.commandsBlob,r);n.push(new Gr(a,0,s,s.bounds())),i.styleID!==void 0&&(o==null&&(o=[]),o.push(i.styleID))}vt.INSTANCE.reset();for(let i of n)vt.INSTANCE.include3(i.bounds());return new Ur(n,o,vt.INSTANCE.build(),null)}decodeTextData(e,r){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,r):new Bn,o=null,i=n.styleByID2();for(let a of Array.from(i.keys())){let s=i.get(a),l=Nr.get(s,25,null);if(l!=null){if(o==null)o=l;else if(l!==o){o="mixed";break}}}return new ls(n,o,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[])}decodeDerivedTextData(e,r){let n=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[];return new Pl(n,[],[])}decodeVectorData(e,r){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,r):new Bn;return new Zm(n)}decodeSymbolData(e,r){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new Gs(_e.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,r):Ui._new())}decodeOverrides(e,r){let n=Ui._new();for(let o of e)if(o.guidPath!==void 0){let i=_e.decodeGUIDPath(o.guidPath),a=Nr._new();this.decodeNodeChange(o,r,(s,l)=>{Nr.set(a,s,l)}),Ui.map(n).set(i,a)}return n}decodeStyleOverrideTable(e,r){let n=new Map;for(let o of e)o.styleID!==void 0&&this.decodeNodeChange(o,r,(i,a)=>{n.has(o.styleID)||n.set(o.styleID,Nr._new()),Nr.set(n.get(o.styleID),i,a)});return new Bn(n)}decodeNodeChange(e,r,n){e.type!==void 0&&n(108,e.type),e.backgroundColor!==void 0&&n(2,_e.decodeColor(e.backgroundColor)),e.backgroundEnabled!==void 0&&n(3,e.backgroundEnabled),e.backgroundOpacity!==void 0&&n(4,e.backgroundOpacity),e.blendMode!==void 0&&n(6,e.blendMode),e.codeSnapshot!==void 0&&n(12,this.decodeCodeSnapshot(e.codeSnapshot,r)),e.connectionType!==void 0&&n(14,e.connectionType),e.connectionURL!==void 0&&n(15,e.connectionURL),e.cornerRadius!==void 0&&n(16,e.cornerRadius),e.rectangleTopLeftCornerRadius!==void 0&&n(68,e.rectangleTopLeftCornerRadius),e.rectangleTopRightCornerRadius!==void 0&&n(69,e.rectangleTopRightCornerRadius),e.rectangleBottomLeftCornerRadius!==void 0&&n(64,e.rectangleBottomLeftCornerRadius),e.rectangleBottomRightCornerRadius!==void 0&&n(65,e.rectangleBottomRightCornerRadius),e.rectangleCornerRadiiIndependent!==void 0&&n(66,e.rectangleCornerRadiiIndependent),e.cornerSmoothing!==void 0&&n(17,e.cornerSmoothing),e.easingType!==void 0&&n(20,e.easingType),e.effects!==void 0&&n(21,_e.decodeEffects(e.effects)),e.arcData!==void 0&&n(1,e.arcData),e.shapeWithTextType!==void 0&&n(74,e.shapeWithTextType),e.fillGeometry!==void 0&&n(23,this.decodeGeometry(e.fillGeometry,r)),e.fillPaints!==void 0&&n(24,this.decodePaints(e.fillPaints,r)),e.textDecorationFillPaints!==void 0&&n(100,this.decodePaints(e.textDecorationFillPaints,r)),e.transformModifiers!==void 0&&n(101,_e.decodeTransformModifiers(e.transformModifiers)),e.frameMaskDisabled!==void 0&&n(35,e.frameMaskDisabled),e.interactionType!==void 0&&n(31,e.interactionType),e.internalOnly!==void 0&&n(36,e.internalOnly),e.isStateGroup!==void 0&&n(40,e.isStateGroup),e.mask!==void 0&&n(37,e.mask),e.maskIsOutline!==void 0&&n(38,e.maskIsOutline),e.name!==void 0&&n(45,e.name),e.navigationType!==void 0&&n(46,e.navigationType),e.opacity!==void 0&&n(48,Fr.Math_clamp(e.opacity,0,1)),e.overlayBackgroundInteraction!==void 0&&n(51,e.overlayBackgroundInteraction),e.overlayBackgroundAppearance!==void 0&&n(50,_e.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance)),e.overlayPositionType!==void 0&&n(52,e.overlayPositionType),e.overlayRelativePosition!==void 0&&n(53,_e.decodeVector(e.overlayRelativePosition)),e.overriddenSymbolID!==void 0&&n(55,_e.decodeGUID(e.overriddenSymbolID)),e.overrideKey!==void 0&&n(56,_e.decodeGUID(e.overrideKey)),e.parentIndex!==void 0&&n(58,_e.decodeParentIndex(e.parentIndex)),e.prototypeBackgroundColor!==void 0&&n(59,_e.decodeColor(e.prototypeBackgroundColor)),e.prototypeDevice!==void 0&&n(60,_e.decodePrototypeDevice(e.prototypeDevice)),e.prototypeStartNodeID!==void 0&&n(62,_e.decodeGUID(e.prototypeStartNodeID)),e.prototypeStartingPoint!==void 0&&n(63,_e.decodePrototypeStartingPoint(e.prototypeStartingPoint)),e.resizeToFit!==void 0&&n(71,e.resizeToFit),e.scrollDirection!==void 0&&n(49,e.scrollDirection),e.size!==void 0&&n(75,_e.decodeVector(e.size)),e.strokeAlign!==void 0&&n(86,e.strokeAlign),e.strokeGeometry!==void 0&&n(87,this.decodeGeometry(e.strokeGeometry,r)),e.strokePaints!==void 0&&n(88,this.decodePaints(e.strokePaints,r)),e.symbolData!==void 0&&n(96,this.decodeSymbolData(e.symbolData,r)),e.videoPlayback!==void 0&&n(111,_e.decodeVideoPlayback(e.videoPlayback)),e.stackReverseZIndex!==void 0&&n(84,e.stackReverseZIndex),e.textData!==void 0&&n(99,this.decodeTextData(e.textData,r)),e.derivedTextData!==void 0&&n(19,this.decodeDerivedTextData(e.derivedTextData,r)),e.vectorData!==void 0&&n(13,this.decodeVectorData(e.vectorData,r)),e.transform!==void 0&&n(70,_e.decodeMatrix(e.transform)),e.transitionNodeID!==void 0&&n(103,_e.decodeGUID(e.transitionNodeID)),e.transitionType!==void 0&&n(107,e.transitionType),e.transitionShouldSmartAnimate!==void 0&&n(105,e.transitionShouldSmartAnimate),e.transitionDuration!==void 0&&n(102,e.transitionDuration),e.transitionTimeout!==void 0&&n(106,e.transitionTimeout),e.interactionMaintained!==void 0&&n(30,e.interactionMaintained),e.interactionDuration!==void 0&&n(29,e.interactionDuration),e.transitionPreserveScroll!==void 0&&n(104,e.transitionPreserveScroll),e.visible!==void 0&&n(112,e.visible),e.styleType!==void 0&&n(95,e.styleType),e.styleIdForFill!==void 0&&n(91,_e.decodeStyleId(e.styleIdForFill)),e.styleIdForStrokeFill!==void 0&&n(93,_e.decodeStyleId(e.styleIdForStrokeFill)),e.styleIdForEffect!==void 0&&n(90,_e.decodeStyleId(e.styleIdForEffect)),e.styleIdForText!==void 0&&n(94,_e.decodeStyleId(e.styleIdForText)),e.horizontalConstraint!==void 0&&n(27,e.horizontalConstraint),e.verticalConstraint!==void 0&&n(110,e.verticalConstraint),e.scrollBehavior!==void 0&&n(72,e.scrollBehavior),e.keyTrigger!==void 0&&n(41,e.keyTrigger),e.prototypeInteractions!==void 0&&n(61,_e.decodePrototypeInteractions(e.prototypeInteractions)),e.objectAnimations!==void 0&&n(47,_e.decodePrototypeInteractions(e.objectAnimations)),e.fontSize!==void 0&&n(25,e.fontSize),e.textAlignHorizontal!==void 0&&n(97,e.textAlignHorizontal),e.textAlignVertical!==void 0&&n(98,e.textAlignVertical),e.strokeWeight!==void 0&&n(89,e.strokeWeight),e.hyperlink!==void 0&&n(28,e.hyperlink),e.mention!==void 0&&n(44,e.mention),e.interactiveSlideConfigData!==void 0&&n(32,e.interactiveSlideConfigData),e.interactiveSlideParticipantData!==void 0&&n(34,e.interactiveSlideParticipantData),e.slideSpeakerNotes!==void 0&&n(76,e.slideSpeakerNotes),e.isSkippedSlide!==void 0&&n(39,e.isSkippedSlide),e.slideSpeakerNotes!==void 0&&n(77,e.slideThumbnailHash),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&n(107,"SMART_ANIMATE")}decompressZlibOrZstd(e){let r=new to;try{let n=wi.inflateRaw(e);r.resolve(n)}catch{let n=new Ef;n.init().then(i=>{r.resolve(n.decode(e))},i=>{r.resolve(null)})}return r}async decodeSceneForViewerAndPrototypeLib1(e){return this.decodeSceneForViewerAndPrototypeLib2(e,null)}_isProbablyZipFile(e){return e[0]==80&&e[1]==75}async decodeSceneFromCanvas(e,r){let n=e.length,o=_e.FILE_HEADER.length;if(_e.hasFileHeader(e)&&o+4<=n){let i=_e.readInt32(e,o);if(o=o+4,i>=1&&o+4<=n){let a=_e.readInt32(e,o);if(o=o+4,o+a+4<=n){let s=await this.decompressZlibOrZstd(e.subarray(o,o+a)).realPromise(),l=kg.createKiwiCodec(!0,kg.decodeBinarySchema(s));o=o+a;let c=_e.readInt32(e,o);if(o=o+4,o+c<=n){let d=e.subarray(o,o+c);o=o+c;let u=!1;for(;o<n;){o+4>e.length&&console.error(`ran out of bytes, ${o} (offset) + 4 > ${e.length} (bytes) but ${o} < ${n} (length)`);let h=_e.readInt32(e,o);if(o=o+4,h==0||h<_e.CHUNK_TAG_LEN)continue;o+_e.CHUNK_TAG_LEN>n&&console.error(`not enough bytes to read chunk tag, ${o} (offset) + ${_e.CHUNK_TAG_LEN} (tag length) > ${n} (length) but chunkLength = ${h}`);let g=e.subarray(o,o+_e.CHUNK_TAG_LEN);o=o+_e.CHUNK_TAG_LEN;let m=h-_e.CHUNK_TAG_LEN;switch(o+m>n&&console.error(`not enough bytes to read data, ${o} (offset) + ${m} (dataLength) > ${n} (length)`),o=o+m,_e.parseChunkType(g)){case _e.ChunkType.THUMBNAIL:{u&&console.error(`hasThumbnail = ${u} and chunk type of ${g} is THUMBNAIL`),u=!0;break}case _e.ChunkType.UNKNOWN:break}}let p=await this.decompressZlibOrZstd(new Uint8Array(d)).realPromise(),_=l.decodeMessage(p);if(_.type!==void 0&&_.type=="NODE_CHANGES"){let h=Me.createScene(Me.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,i);return r!=null&&h.setFileKey(r),h.applyMessageToScene(p),h}}}}}return console.error("Scene decoding from canvas did not successfully create a scene."),null}async decodeSceneForViewerAndPrototypeLib2(e,r){if(this._isProbablyZipFile(e)){let n;try{n=(Vg(),Oi(Ug))}catch{throw new Error("zip.js not available")}let a=(await new n.ZipReader(new n.Uint8ArrayReader(e)).getEntries()).find(s=>s.filename==="canvas.fig");if(!(a!=null&&a.getData))throw new Error("Cannot find canvas.fig in zip file");e=await a.getData(new n.Uint8ArrayWriter)}return this.decodeSceneFromCanvas(e,r)}async decodeSceneWithImages(e,r){if(!this._isProbablyZipFile(e))return this.decodeSceneFromCanvas(e,r);let n;try{n=(Vg(),Oi(Ug))}catch{throw new Error("zip.js not available")}let i=await new n.ZipReader(new n.Uint8ArrayReader(e)).getEntries(),a=null;for(let s of i)if(s.filename==="canvas.fig"){if(!(s!=null&&s.getData))throw new Error("Entry find ${entry.filename} in zip file does not have data");a=await this.decodeSceneFromCanvas(await(s==null?void 0:s.getData(new n.Uint8ArrayWriter)),r)}else if(/images\/[0-9a-f]+/.test(s.filename)&&(s!=null&&s.getData)){let l=await(s==null?void 0:s.getData(new n.Uint8ArrayWriter)),c=s.filename.split("/")[1],d=this._imageByHexHashOrNull(c,1);d?d.primeWithCompressedData(l):(d=Li.createImage(Dn.hexToBytes(c),l,1),this._imageDecoded(c,1,d));let u=l.slice(0,12).toString()===im;u&&d.setIsCompressedTexture(u)}return a}static decodeTransformModifiers(e){let r=[];for(let o of e){let i=new Nf;i.setType(o.type),o.offset!==void 0&&i.setOffset(_e.decodeVector(o.offset)),o.visible!==void 0&&i.setVisible(o.visible),o.count!==void 0&&i.setCount(o.count),o.repeatType!==void 0&&i.setRepeatType(o.repeatType),o.axis!==void 0&&i.setAxis(o.axis),o.unitType!==void 0&&i.setUnitType(o.unitType),o.order!==void 0&&i.setOrder(o.order),o.skewX!==void 0&&i.setSkewX(o.skewX),o.skewY!==void 0&&i.setSkewY(o.skewY),r.push(i)}let n=r;return pt.asTransformModifierList(n)}};_e.VERBOSE=!1,_e.FILE_HEADER=[102,105,103,45,107,105,119,105],_e.CHUNK_TAG_LEN=8,_e.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];var Tt=_e;(r=>{let t;(i=>(i[i.THUMBNAIL=0]="THUMBNAIL",i[i.UNKNOWN=1]="UNKNOWN"))(t=r.ChunkType||(r.ChunkType={}));class e{constructor(o){this.timeSpentApplyingMessageToSceneMs=o}}r.TimingInfo=e})(Tt||(Tt={}));var xo;(o=>{function t(i,a){return i==a?!0:i==14?a==103||a==15:!1}o.affects=t;function e(i){return i==24||i==88||i==91||i==93||i==99||i==19}o.affectsImagesUsedByNode=e;function r(i){switch(i){case 114:case 58:case 112:case 39:case 14:case 15:case 29:case 30:case 31:case 49:case 59:case 60:case 61:case 47:case 62:case 63:case 72:case 102:case 103:case 104:case 106:case 107:case 46:case 52:case 53:case 51:case 50:return!0}return!1}o.isPrototypeStructuralChange=r;function n(i){switch(i){case 31:case 30:case 29:case 41:case 113:case 103:case 107:case 102:case 20:case 106:case 105:case 14:case 15:case 53:case 46:case 104:case 99:case 19:return!0}return!1}o.isInteractionProperty=n})(xo||(xo={}));function uL(t,e){switch(e){case 6:return Be().BlendMode[t];case 14:return Be().ConnectionType[t];case 27:return Be().ConstraintType[t];case 110:return Be().ConstraintType[t];case 20:return Be().EasingType[t];case 31:return Be().InteractionType[t];case 46:return Be().NavigationType[t];case 51:return Be().OverlayBackgroundInteraction[t];case 49:return Be().ScrollDirection[t];case 52:return Be().OverlayPositionType[t];case 114:return Be().NodePhase[t];case 72:return Be().ScrollBehavior[t];case 74:return Be().ShapeWithTextType[t];case 79:return Be().StackMode[t];case 86:return Be().StrokeAlign[t];case 95:return Be().StyleType[t];case 97:return Be().TextAlignHorizontal[t];case 98:return Be().TextAlignVertical[t];case 107:return Be().TransitionType[t];case 108:return Be().NodeType[t];case 33:return Be().FlappType[t];default:throw new Error(`Given field ${Ht[e]} is not a string enum field`)}}function Hg(t,e,r){switch(Hd(r)){case 0:return t.getBool(e,r);case 1:return t.getDouble(e,r);case 2:return t.getInt(e,r);case 3:return t.getString(e,r);case 4:return uL(t.getInt(e,r),r);case 5:return t.getAffineTransform(e,r);case 6:return t.getArcData(e,r);case 29:return t.getCodeSnapshot(e,r);case 7:return t.getGUID(e,r);case 8:return t.getStyleId(e,r);case 10:return t.getVector(e,r);case 11:return t.getEffectList(e);case 12:return t.getTransformModifierList(e);case 13:return t.getPaintList(e,r);case 16:return t.getParentIndex(e);case 14:case 9:case 20:case 18:case 17:case 19:case 25:case 26:case 27:case 28:return t.getField(e,r);case 21:case 24:return null;case 15:case 22:case 23:case 30:return null;default:return xe(`Unhandled node field ${Ht[r]} in getCppNodeValue`),null}}function pL(t,e,r,n,o){switch(Hd(n)){case 0:return t.getBool_SGEO(o);case 1:return t.getDouble_SGEO(o);case 2:return t.getInt_SGEO(o,n);case 3:return t.getString_SGEO(o);case 4:return uL(t.getInt_SGEO(o,n),n);case 5:return t.getAffineTransform_SGEO(o);case 6:return t.getArcData_SGEO(o);case 29:return t.getCodeSnapshot_SGEO(o);case 7:return t.getGUID_SGEO(o);case 8:return t.getStyleId_SGEO(o);case 10:return t.getVector_SGEO(o);case 11:return t.getEffectList_SGEO(o);case 12:return t.getTransformModifierList_SGEO(o);case 13:return t.getPaintList_SGEO(o);case 16:return t.getParentIndex_SGEO(o);case 14:return t.getPrototypeInteractions_SGEO(o);case 9:case 20:case 18:case 17:case 19:case 25:case 26:case 27:case 28:return t.getField_SGEO(o);case 21:case 24:return null;case 15:case 22:case 23:case 30:return null;default:return xe(`Unhandled node field ${Ht[n]} in getCppSGEOValue`),null}}function fa(t,e,r,n){let o=Tt.serializeValueToKiwiForTests1(r,n),i=o.a,a=o.b;i.guid=Tt.encodeGUID(e.id()),sf(i,a)}var g_=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new zo(r=>r.objectHash())}imagesUsedByNode(e){return qe.StringMap_get(this._imagesByNodeId,e,new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),r!=null&&this._addImageNodeReferencesInSubtree(r.root())}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}_trackImageUse(e,r){this._imagesByNodeId.has(e.id())||this._imagesByNodeId.set(e.id(),new Map),this._imagesByNodeId.get(e.id()).set(r.objectHash(),r),this._nodeIdsByImage._in(r)||this._nodeIdsByImage.set(r,new Map),this._nodeIdsByImage.get(r).set(e.id(),e.id())}_removeImageUse(e,r){Array.from(this._imagesByNodeId.keys()).indexOf(e.id())!=-1&&(this._imagesByNodeId.get(e.id()).delete(r.objectHash()),this._imagesByNodeId.get(e.id()).size==0&&this._imagesByNodeId.delete(e.id())),this._nodeIdsByImage._in(r)&&(this._nodeIdsByImage.get(r).delete(e.id()),this._nodeIdsByImage.get(r).size==0&&this._nodeIdsByImage.remove(r))}handleSceneGraphEvent(e){if(e.property===114)return;let r=xo.affectsImagesUsedByNode(e.property);if(!(!(r||e.property==112||e.property==58)||!(e.node.isVisibleInCanvas()||e.property==112&&pt.asBool(e.oldVal)&&!pt.asBool(e.newVal)&&(e.node.parent()!=null&&e.node.parent().isVisibleInCanvas())))){if(r){let o=e.node.collectUniqueUsedImages(),i=qe.StringMap_get(this._imagesByNodeId,e.node.id(),new Map);for(let a of Array.from(i.keys()))o.has(a)||this._removeImageUse(e.node,i.get(a));for(let a of Array.from(o.keys()))i.has(a)||this._trackImageUse(e.node,o.get(a))}else if(e.property==112){let o=pt.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),i=pt.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!o&&i?this._addImageNodeReferencesInSubtree(e.node):o&&!i&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==58){let o=e.oldVal!=null&&pt.isParentIndex(e.oldVal)?pt.asParentIndex(e.oldVal):null,i=e.newVal!=null&&pt.isParentIndex(e.newVal)?pt.asParentIndex(e.newVal):null,a=o!=null?e.node.scene().findNode(o.id):null,s=i!=null?e.node.scene().findNode(i.id):null,l=a!=null&&a.isRooted(),c=s!=null&&s.isRooted();l&&!c?this._removeImageNodeReferencesInSubtree(e.node):!l&&c&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let r=0,n=e.childCount();r<n;r=r+1)this._removeImageNodeReferencesInSubtree(e.childAt1(r));e.forEachSinglePaint(r=>{(r.type()=="IMAGE"||r.type()=="EMOJI"||r.type()=="VIDEO")&&(r.image()!=null&&this._removeImageUse(e,r.image()),r.imageThumbnail()!=null&&this._removeImageUse(e,r.imageThumbnail()))}),e.forEachEmojiInTextData(r=>{this._removeImageUse(e,r)})}_addImageNodeReferencesInSubtree(e){if(e.visible()){for(let r=0,n=e.childCount();r<n;r=r+1)this._addImageNodeReferencesInSubtree(e.childAt1(r));e.forEachSinglePaint(r=>{if((r.type()=="IMAGE"||r.type()=="EMOJI"||r.type()=="VIDEO")&&(r.image()!=null&&this._trackImageUse(e,r.image()),r.imageThumbnail()!=null&&this._trackImageUse(e,r.imageThumbnail())),r.type()=="PATTERN"){let n=r.patternSource();n&&n.collectUniqueUsedImages().forEach(i=>{this._trackImageUse(e,i)})}}),e.forEachEmojiInTextData(r=>{this._trackImageUse(e,r)})}}};var zg=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return e&&this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}},Wg=class{constructor(e,r,n,o){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=r,this._startCondition=n,this._endCondition=o}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=Ze.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=Ze.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&Ze.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){Re.trackEvent("images_loaded",{viewer_mode:U.getViewerMode(),load_type:this._loadType,num_successes:this._numSuccesses,num_failures:this._numFailures,num_gifs:this._numGIFs,duration_s:this._endConditionSeconds-this._startConditionSeconds,fast_image_decode:Dn.browserSupportsFastImageDecoding()},{forwardToDatadog:!0})}},Ks=class t{delayBetweenInvalidations(){return Uo||Ca?0:1}constructor(e,r){this._scene=null,this._appState=e,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new Lm,this._outboundRequestPriorities=new Map,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new zg,this._topLevelGuidsNeeded=new So,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,Jn()!==null&&!Jn().getImageMemoryStats&&(Jn().getImageMemoryStats=()=>{let o=dn.getMax("WEBGL_TEXTURE (Image)"),i=dn.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:o,ramMaxForImages:i}},Jn().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new g_(e),this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=r,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let n=2.5;this._thumbLoadTracker=new Wg("thumbs_loaded",n,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new Wg("fullsize_images_loaded",n,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._clearDecodedDataForAllImagesRecursive(o)}}}clearDecodedDataForAllImages(e){this._appState.isPreloaded||(e.forEachSinglePaint(r=>{if(r.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(r.image());r.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(r=>{if(r.imageThumbnail()==null)return;let n=this._imageUseTracker.nodesUsedByImage(r.imageThumbnail());r.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(r=>{let n=this._imageUseTracker.nodesUsedByImage(r);r.freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}))}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let r=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&r!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=r}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._clearDecodedDataForFullResolutionImagesRecursive(o)}}}clearDecodedDataForFullResolutionImages(e){this._appState.isPreloaded||(e.forEachSinglePaint(r=>{var o,i;if(r.image()==null||r.imageThumbnail()!=null&&r.image().objectHash()==r.imageThumbnail().objectHash()||!r.image().isDecoded())return;let n=this._imageUseTracker.nodesUsedByImage(r.image());for(let a of n){let s=(i=(o=this._scene)==null?void 0:o.findNode(a))==null?void 0:i.topLevelAncestor();if(s!=null&&this._topLevelGuidsNeeded._in(s.id()))return}r.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(a=>{var s,l;(l=(s=this._scene)==null?void 0:s.findNode(a))==null||l.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(r=>{var o,i;let n=this._imageUseTracker.nodesUsedByImage(r);for(let a of n){let s=(i=(o=this._scene)==null?void 0:o.findNode(a))==null?void 0:i.topLevelAncestor();if(s!=null&&this._topLevelGuidsNeeded._in(s.id()))return}r.freeMemoryForDecodedDataAndTexture()&&n.forEach(a=>{var s,l;(l=(s=this._scene)==null?void 0:s.findNode(a))==null||l.invalidateRenderTreeForSelfAndParents()})}))}_restartGIFsOnEnteringScreens(e){var o,i;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let a=(o=this._scene)==null?void 0:o.findNode(e.newStateId());a!=null&&this._restartGIFsInSubtree(a)}let r=e.newOverlayData(),n=e.oldOverlayData();for(let a=0,s=r.length;a<s;a=a+1)if(a>=n.length||n[a].id!=r[a].id){let l=(i=this._scene)==null?void 0:i.findNode(r[a].id);l!=null&&this._restartGIFsInSubtree(l)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(r=>{this._restartGIFsInSubtree(r)})}clearUnneededTextures(e){if(!(this._scene==null||this._appState.isPreloaded)&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new So,this._prototypeStructure.getPrerenderingJobs().forEach(r=>{let n=r.asScreen();n!=null&&this._topLevelGuidsNeeded.add(n.nodeId)}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(e.oldStateId()),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(e.newStateId());for(let r of this._imageUseTracker.nodesThatUseAnImage()){let n=this._scene.findNode(X.fromString(r));if(n==null)continue;let o=n.topLevelAncestor();o!=null&&this._topLevelGuidsNeeded._in(o.id())||this.clearDecodedDataForFullResolutionImages(n)}}}preloadAllThumbnails(e){this._scene==null||e==null||(qe.StringMap_each(t.getThumbnailsInSubtree(e),(r,n)=>{this._imageQueue.insertOrUpdate(n,Hn.OTHER)}),this._needAllThumbnails=!1)}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}_computeTopImagePriority(){let e=Hn.OTHER;this._imageQueue.count()>0&&(e=Hn.max(e,this._imageQueue.maxPriority().value));for(let r of Array.from(this._outboundRequestPriorities.values()))e=Hn.max(e,r);return e}findImageByHexHash(e,r){return r==0?qe.StringMap_get(this._emojiResources,e,null):qe.StringMap_get(this._imageResources,e,null)}getImageLoadingProgress(){let e=this._imageResources.size+this._emojiResources.size,r=0;return this._imageResources.forEach(n=>{(n.isDecoded()||n.loadDidFail()&&!n.failureIsRetryable())&&r++}),this._emojiResources.forEach(n=>{(n.isDecoded()||n.loadDidFail()&&!n.failureIsRetryable())&&r++}),{loaded:r,total:e}}static getImagesInSubtree(e){let r=new Map,n=new Map;t._getImagesInSubtree(e,r,n);let o=[];return r.forEach(i=>{o.push(i)}),n.forEach(i=>{o.push(i)}),o}preloadAllImages(){var n;let e=(n=this._appState.scene())==null?void 0:n.root();if(!e)return;let r=t.getImagesInSubtree(e);for(let o of r)this._imageQueue.insertOrUpdate(o,Hn.OTHER)}onNewImage(e,r,n){let o=r==0?this._emojiResources:this._imageResources;o.has(e)||(o.set(e,n),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(n,Hn.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,r){this._imageQueue.insertOrUpdate(e,r),this._processNextItemFromRenderQueues()}_onImagesLoaded(){var e;if(this.onImageLoaded!=null){if(this._scene!=null)for(let r=0,n=this._newlyLoadedImages.allImages().length;r<n;r=r+1){let o=this._newlyLoadedImages.allImages()[r];this._appState.editorType()==="COOPER"&&((e=o.gif())==null||e.setAutoplay(!1));for(let i of this._imageUseTracker.nodesUsedByImage(o)){let a=this._scene.findNode(i);a!=null&&this.onImageLoaded(a)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){Jn().figmaPerfTesting&&Jn().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,dn.trackNumber("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,r,n,o){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(n),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(o),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),Hn.max(r,qe.StringMap_get(this._outboundRequestPriorities,e.objectHash(),Hn.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,i=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);let a=this._pendingRequestSuccessForImage.get(e.objectHash())??[];for(let s of a)s(i);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},i=>{if((Sl.ImagePriorityType_isOnScreen(r.type)||Sl.ImagePriorityType_isPrerender(r.type))&&i==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let l=c=>{c==0?(this._showImageFetchFailureUI(),Re.trackEvent("show_image_failure_ui",{imagePriority:Lp[r.type]})):this._shouldInvestigateNextImageFailure=!0};new oi(e.url()).get().then(c=>{l(c.status)},c=>{l(c.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();let s=this._pendingRequestFailureForImage.get(e.objectHash())??[];for(let l of s)l(r);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),r=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,r.value,n=>{},n=>{var i;if(n.type==2||n.type==4)for(let a of this._imageUseTracker.nodesUsedByImage(e)){let s=(i=this._scene)==null?void 0:i.findNode(a);s!=null&&s.forEachSinglePaint(l=>{let c=l.imageThumbnail()!=null&&l.imageThumbnail().objectHash()==e.objectHash(),d=l.imageThumbnail()!=null&&l.image()!=null&&l.image().objectHash()==l.imageThumbnail().objectHash();if(c&&!d&&l.image()!=null){let u=e!=null?e.objectHash():null,p=l.image()!=null?l.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${u}; fetching full size image ${p}`);let _=n.type==2?Hn.forType(1):n.type==4?Hn.forType(3):Hn.OTHER;this.requestImageForRendering(l.image(),_)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||this.hasPendingOutboundOnScreenImages()||!this._newlyLoadedImages.isEmpty()}hasPendingOutboundOnScreenImages(){return Sl.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)}static getThumbnailsInSubtree(e){let r=new Map,n=new Map;return t._getImagesInSubtree(e,r,n),n}static _getImagesInSubtree(e,r,n){e.forEachSinglePaint(o=>{o.image()!=null&&r.set(o.image().objectHash(),o.image()),o.imageThumbnail()!=null&&n.set(o.imageThumbnail().objectHash(),o.imageThumbnail())}),e.forEachEmojiInTextData(o=>{n.set(o.objectHash(),o)});for(let o=0,i=e.childCount();o<i;o=o+1){let a=e.childAt1(o);t._getImagesInSubtree(a,r,n)}}handleSceneChange(e,r){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=r,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._onTransitionGraphChange()}handleActiveCanvasChange(e,r){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(r)}handleActivePrototypeStartingPointChange(e,r){}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&(Ze.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()||U.getFeatureFlags().viewer_optimize_image_invalidation_delay&&(this._requestsInFlight===0||!this.hasPendingOutboundOnScreenImages()))&&(this.lastImageLoadedCallbackTime=Ze.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}handleStateChangeAborted(e){}handleStateChangeCommitted(e,r){}handleStateChangeInitiated(e){var r,n;if(Hn.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let o=(n=(r=this._scene)==null?void 0:r.findNode(e.newStateId()))==null?void 0:n.canvas();this.preloadAllThumbnails(o)}}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}handleSceneGraphEvent(e){(e.property==103||e.property==62||e.property==58)&&this._onTransitionGraphChange()}};var Kg=class{baseNodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.baseNodeTsApiGenerated}canvasFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.canvasFacetTsApiGenerated}codeFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.codeFacetTsApiGenerated}codeBehaviorFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.codeBehaviorFacetTsApiGenerated}componentishFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.componentishFacetTsApiGenerated}constraintsFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.constraintsFacetTsApiGenerated}frameFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.frameFacetTsApiGenerated}geometryCacheFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.geometryCacheFacetTsApiGenerated}immutableFrameFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.immutableFrameFacetTsApiGenerated}instanceFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.instanceFacetTsApiGenerated}interactiveSlideElementFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.interactiveSlideElementFacetTsApiGenerated}layerFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.layerFacetTsApiGenerated}layoutFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.layoutFacetTsApiGenerated}prototypingFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.prototypingFacetTsApiGenerated}renderableBackgroundFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.renderableBackgroundFacetTsApiGenerated}renderableBaseFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.renderableBaseFacetTsApiGenerated}renderableRectangleFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.renderableRectangleFacetTsApiGenerated}shapeWithTextFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.shapeWithTextFacetTsApiGenerated}slideFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.slideFacetTsApiGenerated}stackFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.stackFacetTsApiGenerated}styleFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.styleFacetTsApiGenerated}textFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.textFacetTsApiGenerated}transformFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.transformFacetTsApiGenerated}vectorFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.vectorFacetTsApiGenerated}viewerStateFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.viewerStateFacetTsApiGenerated}};var za;(r=>{function t(n){return n!=-1}r.WeakHandle_isValid=t;function e(n){return n}r.WeakHandle_toInt=e})(za||(za={}));var Yg=class{arcData(){return v().prepareCppNodeForAccess(this),v().vectorFacetTsApiGenerated().getArcData(ne.PROTOTYPE_LIB)}setArcData(e){v().prepareCppNodeForAccess(this);let r=e;v().vectorFacetTsApiGenerated().setArcData(r,ne.PROTOTYPE_LIB)}isBackgroundEnabled(){return v().prepareCppNodeForAccess(this),v().renderableBackgroundFacetTsApiGenerated().getBackgroundEnabled(ne.PROTOTYPE_LIB)}setIsBackgroundEnabled(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBackgroundFacetTsApiGenerated().setBackgroundEnabled(r,ne.PROTOTYPE_LIB)}backgroundOpacity(){return v().prepareCppNodeForAccess(this),v().renderableBackgroundFacetTsApiGenerated().getBackgroundOpacity(ne.PROTOTYPE_LIB)}setBackgroundOpacity(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBackgroundFacetTsApiGenerated().setBackgroundOpacity(r,ne.PROTOTYPE_LIB)}blendMode(){v().prepareCppNodeForAccess(this);let e=v().renderableBaseFacetTsApiGenerated().getBlendMode(ne.PROTOTYPE_LIB);return Be().BlendMode[e]}setBlendMode(e){v().prepareCppNodeForAccess(this);let r=Be().BlendMode[e];v().renderableBaseFacetTsApiGenerated().setBlendMode(r,ne.PROTOTYPE_LIB)}borderBottomWeight(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getBorderBottomWeight(ne.PROTOTYPE_LIB)}setBorderBottomWeight(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setBorderBottomWeight(r,ne.PROTOTYPE_LIB)}borderLeftWeight(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getBorderLeftWeight(ne.PROTOTYPE_LIB)}setBorderLeftWeight(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setBorderLeftWeight(r,ne.PROTOTYPE_LIB)}borderRightWeight(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getBorderRightWeight(ne.PROTOTYPE_LIB)}setBorderRightWeight(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setBorderRightWeight(r,ne.PROTOTYPE_LIB)}borderStrokeWeightsIndependent(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getBorderStrokeWeightsIndependent(ne.PROTOTYPE_LIB)}setBorderStrokeWeightsIndependent(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setBorderStrokeWeightsIndependent(r,ne.PROTOTYPE_LIB)}borderTopWeight(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getBorderTopWeight(ne.PROTOTYPE_LIB)}setBorderTopWeight(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setBorderTopWeight(r,ne.PROTOTYPE_LIB)}cornerRadius(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getCornerRadius(ne.PROTOTYPE_LIB)}setCornerRadius(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setCornerRadius(r,ne.PROTOTYPE_LIB)}cornerSmoothing(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getCornerSmoothing(ne.PROTOTYPE_LIB)}setCornerSmoothing(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setCornerSmoothing(r,ne.PROTOTYPE_LIB)}fontSize(){return v().prepareCppNodeForAccess(this),v().textFacetTsApiGenerated().getFontSize(ne.PROTOTYPE_LIB)}setFontSize(e){v().prepareCppNodeForAccess(this);let r=e;v().textFacetTsApiGenerated().setFontSize(r,ne.PROTOTYPE_LIB)}hasBeenLoaded(){return v().prepareCppNodeForAccess(this),v().viewerStateFacetTsApiGenerated().getHasBeenLoaded(ne.PROTOTYPE_LIB)}setHasBeenLoaded(e){v().prepareCppNodeForAccess(this);let r=e;v().viewerStateFacetTsApiGenerated().setHasBeenLoaded(r,ne.PROTOTYPE_LIB)}horizontalConstraint(){v().prepareCppNodeForAccess(this);let e=v().constraintsFacetTsApiGenerated().getHorizontalConstraint(ne.PROTOTYPE_LIB);return Be().ConstraintType[e]}setHorizontalConstraint(e){v().prepareCppNodeForAccess(this);let r=Be().ConstraintType[e];v().constraintsFacetTsApiGenerated().setHorizontalConstraint(r,ne.PROTOTYPE_LIB)}interactiveSlideElementType(){v().prepareCppNodeForAccess(this);let e=v().interactiveSlideElementFacetTsApiGenerated().getInteractiveSlideElementType(ne.PROTOTYPE_LIB);return Be().FlappType[e]}setInteractiveSlideElementType(e){v().prepareCppNodeForAccess(this);let r=Be().FlappType[e];v().interactiveSlideElementFacetTsApiGenerated().setInteractiveSlideElementType(r,ne.PROTOTYPE_LIB)}isFrameMaskDisabled(){return v().prepareCppNodeForAccess(this),v().renderableBaseFacetTsApiGenerated().getIsFrameClippingDisabled(ne.PROTOTYPE_LIB)}setIsFrameMaskDisabled(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBaseFacetTsApiGenerated().setIsFrameClippingDisabled(r,ne.PROTOTYPE_LIB)}isInternalOnly(){return v().prepareCppNodeForAccess(this),v().canvasFacetTsApiGenerated().getIsInternalOnly(ne.PROTOTYPE_LIB)}setIsInternalOnly(e){v().prepareCppNodeForAccess(this);let r=e;v().canvasFacetTsApiGenerated().setIsInternalOnly(r,ne.PROTOTYPE_LIB)}isMask(){return v().prepareCppNodeForAccess(this),v().renderableBaseFacetTsApiGenerated().getIsMask(ne.PROTOTYPE_LIB)}setIsMask(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBaseFacetTsApiGenerated().setIsMask(r,ne.PROTOTYPE_LIB)}isMaskOutline_DEPRECATED(){return v().prepareCppNodeForAccess(this),v().renderableBaseFacetTsApiGenerated().getIsMaskOutline_DEPRECATED(ne.PROTOTYPE_LIB)}setIsMaskOutline_DEPRECATED(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBaseFacetTsApiGenerated().setIsMaskOutline_DEPRECATED(r,ne.PROTOTYPE_LIB)}isSkippedSlide(){return v().prepareCppNodeForAccess(this),v().slideFacetTsApiGenerated().getIsSkippedSlide(ne.PROTOTYPE_LIB)}setIsSkippedSlide(e){v().prepareCppNodeForAccess(this);let r=e;v().slideFacetTsApiGenerated().setIsSkippedSlide(r,ne.PROTOTYPE_LIB)}isStateGroup(){return v().prepareCppNodeForAccess(this),v().componentishFacetTsApiGenerated().getIsStateGroup(ne.PROTOTYPE_LIB)}setIsStateGroup(e){v().prepareCppNodeForAccess(this);let r=e;v().componentishFacetTsApiGenerated().setIsStateGroup(r,ne.PROTOTYPE_LIB)}localOpacity(){return v().prepareCppNodeForAccess(this),v().renderableBaseFacetTsApiGenerated().getLocalOpacity(ne.PROTOTYPE_LIB)}setLocalOpacity(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBaseFacetTsApiGenerated().setLocalOpacity(r,ne.PROTOTYPE_LIB)}maskType(){v().prepareCppNodeForAccess(this);let e=v().renderableBaseFacetTsApiGenerated().getMaskType(ne.PROTOTYPE_LIB);return Be().MaskType[e]}setMaskType(e){v().prepareCppNodeForAccess(this);let r=Be().MaskType[e];v().renderableBaseFacetTsApiGenerated().setMaskType(r,ne.PROTOTYPE_LIB)}opacity(){return v().prepareCppNodeForAccess(this),v().renderableBaseFacetTsApiGenerated().getOpacity(ne.PROTOTYPE_LIB)}setOpacity(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBaseFacetTsApiGenerated().setOpacity(r,ne.PROTOTYPE_LIB)}overflowDirection(){v().prepareCppNodeForAccess(this);let e=v().prototypingFacetTsApiGenerated().getOverflowDirection(ne.PROTOTYPE_LIB);return Be().ScrollDirection[e]}setOverflowDirection(e){v().prepareCppNodeForAccess(this);let r=Be().ScrollDirection[e];v().prototypingFacetTsApiGenerated().setOverflowDirection(r,ne.PROTOTYPE_LIB)}overlayBackgroundInteraction(){v().prepareCppNodeForAccess(this);let e=v().prototypingFacetTsApiGenerated().getOverlayBackgroundInteraction(ne.PROTOTYPE_LIB);return Be().OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){v().prepareCppNodeForAccess(this);let r=Be().OverlayBackgroundInteraction[e];v().prototypingFacetTsApiGenerated().setOverlayBackgroundInteraction(r,ne.PROTOTYPE_LIB)}overlayPositionType(){v().prepareCppNodeForAccess(this);let e=v().prototypingFacetTsApiGenerated().getOverlayPositionType(ne.PROTOTYPE_LIB);return Be().OverlayPositionType[e]}setOverlayPositionType(e){v().prepareCppNodeForAccess(this);let r=Be().OverlayPositionType[e];v().prototypingFacetTsApiGenerated().setOverlayPositionType(r,ne.PROTOTYPE_LIB)}overriddenSymbolID(){return v().prepareCppNodeForAccess(this),v().instanceFacetTsApiGenerated().getOverriddenSymbolID(ne.PROTOTYPE_LIB)}overrideKey(){return v().prepareCppNodeForAccess(this),v().instanceFacetTsApiGenerated().getOverrideKey(ne.PROTOTYPE_LIB)}setOverrideKey(e){v().prepareCppNodeForAccess(this);let r=e;v().instanceFacetTsApiGenerated().setOverrideKey(r,ne.PROTOTYPE_LIB)}rectangleBottomLeftCornerRadius(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getRectangleBottomLeftCornerRadius(ne.PROTOTYPE_LIB)}setRectangleBottomLeftCornerRadius(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setRectangleBottomLeftCornerRadius(r,ne.PROTOTYPE_LIB)}rectangleBottomRightCornerRadius(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getRectangleBottomRightCornerRadius(ne.PROTOTYPE_LIB)}setRectangleBottomRightCornerRadius(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setRectangleBottomRightCornerRadius(r,ne.PROTOTYPE_LIB)}rectangleCornerRadiiIndependent(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getRectangleCornerRadiiIndependent(ne.PROTOTYPE_LIB)}setRectangleCornerRadiiIndependent(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setRectangleCornerRadiiIndependent(r,ne.PROTOTYPE_LIB)}rectangleCornerToolIndependent(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getRectangleCornerToolIndependent(ne.PROTOTYPE_LIB)}setRectangleCornerToolIndependent(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setRectangleCornerToolIndependent(r,ne.PROTOTYPE_LIB)}rectangleTopLeftCornerRadius(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getRectangleTopLeftCornerRadius(ne.PROTOTYPE_LIB)}setRectangleTopLeftCornerRadius(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setRectangleTopLeftCornerRadius(r,ne.PROTOTYPE_LIB)}rectangleTopRightCornerRadius(){return v().prepareCppNodeForAccess(this),v().renderableRectangleFacetTsApiGenerated().getRectangleTopRightCornerRadius(ne.PROTOTYPE_LIB)}setRectangleTopRightCornerRadius(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableRectangleFacetTsApiGenerated().setRectangleTopRightCornerRadius(r,ne.PROTOTYPE_LIB)}isResizeToFit(){return v().prepareCppNodeForAccess(this),v().frameFacetTsApiGenerated().getResizeToFit(ne.PROTOTYPE_LIB)}setIsResizeToFit(e){v().prepareCppNodeForAccess(this);let r=e;v().frameFacetTsApiGenerated().setResizeToFit(r,ne.PROTOTYPE_LIB)}scrollBehavior(){v().prepareCppNodeForAccess(this);let e=v().prototypingFacetTsApiGenerated().getScrollBehavior(ne.PROTOTYPE_LIB);return Be().ScrollBehavior[e]}setScrollBehavior(e){v().prepareCppNodeForAccess(this);let r=Be().ScrollBehavior[e];v().prototypingFacetTsApiGenerated().setScrollBehavior(r,ne.PROTOTYPE_LIB)}shapeWithTextType(){v().prepareCppNodeForAccess(this);let e=v().shapeWithTextFacetTsApiGenerated().getShapeWithTextType(ne.PROTOTYPE_LIB);return Be().ShapeWithTextType[e]}setShapeWithTextType(e){v().prepareCppNodeForAccess(this);let r=Be().ShapeWithTextType[e];v().shapeWithTextFacetTsApiGenerated().setShapeWithTextType(r,ne.PROTOTYPE_LIB)}sizeVectorF(){return v().prepareCppNodeForAccess(this),v().layoutFacetTsApiGenerated().getSize(ne.PROTOTYPE_LIB)}setSizeVectorF(e){v().prepareCppNodeForAccess(this);let r=e;v().layoutFacetTsApiGenerated().setSize(r,ne.PROTOTYPE_LIB)}stackCounterSpacing(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackCounterSpacing(ne.PROTOTYPE_LIB)}setStackCounterSpacing(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackCounterSpacing(r,ne.PROTOTYPE_LIB)}stackPaddingBottom(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackPaddingBottom(ne.PROTOTYPE_LIB)}setStackPaddingBottom(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackPaddingBottom(r,ne.PROTOTYPE_LIB)}stackPaddingLeft(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackPaddingLeft(ne.PROTOTYPE_LIB)}setStackPaddingLeft(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackPaddingLeft(r,ne.PROTOTYPE_LIB)}stackPaddingRight(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackPaddingRight(ne.PROTOTYPE_LIB)}setStackPaddingRight(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackPaddingRight(r,ne.PROTOTYPE_LIB)}stackPaddingTop(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackPaddingTop(ne.PROTOTYPE_LIB)}setStackPaddingTop(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackPaddingTop(r,ne.PROTOTYPE_LIB)}stackReverseZIndex(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackReverseZIndex(ne.PROTOTYPE_LIB)}setStackReverseZIndex(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackReverseZIndex(r,ne.PROTOTYPE_LIB)}stackSpacing(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getStackSpacing(ne.PROTOTYPE_LIB)}setStackSpacing(e){v().prepareCppNodeForAccess(this);let r=e;v().stackFacetTsApiGenerated().setStackSpacing(r,ne.PROTOTYPE_LIB)}strokeAlign(){v().prepareCppNodeForAccess(this);let e=v().renderableBaseFacetTsApiGenerated().getStrokeAlign(ne.PROTOTYPE_LIB);return Be().StrokeAlign[e]}setStrokeAlign(e){v().prepareCppNodeForAccess(this);let r=Be().StrokeAlign[e];v().renderableBaseFacetTsApiGenerated().setStrokeAlign(r,ne.PROTOTYPE_LIB)}strokeWeight(){return v().prepareCppNodeForAccess(this),v().renderableBaseFacetTsApiGenerated().getStrokeWeight(ne.PROTOTYPE_LIB)}setStrokeWeight(e){v().prepareCppNodeForAccess(this);let r=e;v().renderableBaseFacetTsApiGenerated().setStrokeWeight(r,ne.PROTOTYPE_LIB)}styleType(){v().prepareCppNodeForAccess(this);let e=v().styleFacetTsApiGenerated().getStyleType(ne.PROTOTYPE_LIB);return Be().StyleType[e]}setStyleType(e){v().prepareCppNodeForAccess(this);let r=Be().StyleType[e];v().styleFacetTsApiGenerated().setStyleType(r,ne.PROTOTYPE_LIB)}textAlignHorizontal(){v().prepareCppNodeForAccess(this);let e=v().textFacetTsApiGenerated().getTextAlignHorizontal(ne.PROTOTYPE_LIB);return Be().TextAlignHorizontal[e]}setTextAlignHorizontal(e){v().prepareCppNodeForAccess(this);let r=Be().TextAlignHorizontal[e];v().textFacetTsApiGenerated().setTextAlignHorizontal(r,ne.PROTOTYPE_LIB)}textAlignVertical(){v().prepareCppNodeForAccess(this);let e=v().textFacetTsApiGenerated().getTextAlignVertical(ne.PROTOTYPE_LIB);return Be().TextAlignVertical[e]}setTextAlignVertical(e){v().prepareCppNodeForAccess(this);let r=Be().TextAlignVertical[e];v().textFacetTsApiGenerated().setTextAlignVertical(r,ne.PROTOTYPE_LIB)}usedAsBaseScreen(){return v().prepareCppNodeForAccess(this),v().viewerStateFacetTsApiGenerated().getUsedAsBaseScreen(ne.PROTOTYPE_LIB)}setUsedAsBaseScreen(e){v().prepareCppNodeForAccess(this);let r=e;v().viewerStateFacetTsApiGenerated().setUsedAsBaseScreen(r,ne.PROTOTYPE_LIB)}verticalConstraint(){v().prepareCppNodeForAccess(this);let e=v().constraintsFacetTsApiGenerated().getVerticalConstraint(ne.PROTOTYPE_LIB);return Be().ConstraintType[e]}setVerticalConstraint(e){v().prepareCppNodeForAccess(this);let r=Be().ConstraintType[e];v().constraintsFacetTsApiGenerated().setVerticalConstraint(r,ne.PROTOTYPE_LIB)}visible(){return v().prepareCppNodeForAccess(this),v().layerFacetTsApiGenerated().getVisible(ne.PROTOTYPE_LIB)}setVisible(e){v().prepareCppNodeForAccess(this);let r=e;v().layerFacetTsApiGenerated().setVisible(r,ne.PROTOTYPE_LIB)}};var Wa;(a=>{function t(s){return s.hasNodeProperty?U.getFeatureFlags().prototype_fix_scrolling_hotspots?s.hasNodeProperty(73)&&s.hasOverflowingContentInScrollDirection():s.hasNodeProperty(73):s.scrollDirection()!="NONE"&&s.hasOverflowingContentInScrollDirection()}function e(s,l,c,d,u){let p=s.stickyNodeInitialTopPosition,_=s.overflowingAncestorInitialTopPosition,h=p-_;if(d)return c.y()>h?Ae.FrozenVector_new4(c.x(),h):c;{if(u)return Ae.FrozenVector_new4(0,0);let g=l(),m=s.stickyNodeHeight,A=s.parentNodeHeight,S=s.parentNodeInitialTopPosition,R=p-S+m,b=A-R,O=g.y()>h&&g.y()<=h+b,f=g.y()>h+b;return O?Ae.FrozenVector_new4(0,h-g.y()):f?Ae.FrozenVector_new4(0,-b):Ae.FrozenVector_new4(0,0)}}a.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=e;function r(s){let l=s.parent();if(l==null)return Ae.FrozenVector_new4(0,0);let c=l.parent(),d=l.isFixed()&&c!=null&&t(c),u=t(l);if(s.isStandardScrolling()){let p=U.getFeatureFlags().prototype_parallax_scroll&&!o(s)?s.scrollSpeedMultiplier():1;if(u){let _=l.scrollOffset();return Ae.FrozenVector_new4(_.x(),_.y()*p)}else return p!=1?n(l).multiplyScalar(p-1):Ae.FrozenVector_ZERO}else if(s.isStickyScrolling()){let p=l;for(;p!=null&&!t(p);)p=p.parent();if(p==null)return Ae.FrozenVector_ZERO;let _=s.absoluteTransform().m12(),h=s.size().y(),g=l.absoluteTransform().m12(),m=l.size().y(),A=p.absoluteTransform().m12(),S=new i(_,h,g,m,A);return e(S,()=>n(l),l.scrollOffset(),u,d)}return Ae.FrozenVector_ZERO}a.getScrollTranslationOfNodeRelativeToParent=r;function n(s){let l=Ae.FrozenVector_ZERO,c=s;for(;c!=null&&(!t(c)||c==s);){let d=r(c);l=l.add(d),c=c.parent()}return l}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor=n;function o(s){let l=s;for(;l!=null;){if(l.isStickyScrolling())return!0;l=l.parent()}return!1}a.hasStickyScrollingAncestor=o;class i{constructor(l,c,d,u,p){this.stickyNodeInitialTopPosition=l,this.stickyNodeHeight=c,this.parentNodeInitialTopPosition=d,this.parentNodeHeight=u,this.overflowingAncestorInitialTopPosition=p}}a.StickyScrollBounds=i})(Wa||(Wa={}));var Xn;(o=>{function t(i){return i!="NONE"}o.hasExplicitOverflow=t;function e(i){return i=="HORIZONTAL"||i=="BOTH"}o.scrollsHorizontally=e;function r(i){return i=="VERTICAL"||i=="BOTH"}o.scrollsVertically=r;function n(i,a){switch(i){case"VERTICAL":return Math.abs(a.y());case"HORIZONTAL":return Math.abs(a.x());case"BOTH":return Math.abs(a.length());default:break}return 0}o.getDirectionSimilarity=n})(Xn||(Xn={}));var mO;(e=>{function t(r){let n=r,o=r.parent(),i=new F(0,0);for(;o!=null&&o.type()!="CANVAS";){let a=o.scrollDirection()!="NONE"&&o.hasNodeProperty(73),s=n.isFixed();a&&!s&&i.addUpdate1(o.scrollOffset()),n=o,o=o.parent()}return i}e.cumulativeScrollOffsetOfAncestors=t})(mO||(mO={}));function _L(t){switch(t){case"VERTICAL":return new F(0,1);case"HORIZONTAL":return new F(1,0);case"BOTH":{let e=new F(1,1);return e.divideScalar(e.length())}default:break}return F.new()}var qg=(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",n[n.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",n))(qg||{}),Qg=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new fe(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return Xn.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return Xn.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return er.isFrameLike(this._node.type())?(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll():!1}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),r=e.prototypeDevice(),n=e.currentViewportSize(),o=r.type=="NONE"||r.type=="PRESENTATION"?n:r.size();return new F(Math.min(this._node.fullSize().x(),o.x()),Math.min(this._node.fullSize().y(),o.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._role()==2?this._node.isTopLevel():this._role()==0,r=!Xn.hasExplicitOverflow(this._node.overflowDirection()),n=e?r:!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE",o=e&&r?this._node.originalSize():this._node.fullSize(),i=L.new2();if(n)i.setTo1(0,0,o.x(),o.y());else{let a=this._node.canvasSpaceBoundingBox().topLeft();i.setTo1(a.x(),a.y(),o.x(),o.y());for(let s=0,l=this._node.childCount();s<l;s=s+1){let c=this._node.childAt1(s);c.isFixed()||(Uo?i.expandToInclude(c.canvasSpaceBoundingBox()):i.expandToInclude(c.canvasSpaceScrollingBounds()))}i.setX(i.x()-a.x()),i.setY(i.y()-a.y()),this._node.overflowDirection()=="VERTICAL"?(i.setX(0),i.setWidth(o.x())):this._node.overflowDirection()=="HORIZONTAL"?(i.setY(0),i.setHeight(o.y())):this._node.overflowDirection()=="BOTH"}return i}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?pt.asBool(this._node.get(109,!1)):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.type()==="SLIDE"?"NONE":this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),r=this.canvasSpaceContentBounds(),n=this._node.canvasSpaceBoundingBox(),o=Xn.scrollsVertically(e)&&r.height()>n.height(),i=Xn.scrollsHorizontally(e)&&r.width()>n.width();return o&&i?"BOTH":o?"VERTICAL":i?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,r){let n=e.clone(),o=this._node;for(;o.parent()!=null;){let i=Wa.getScrollTranslationOfNodeRelativeToParent(o);n.translate2(i.negative());let a=o.parent();a.clipsToBoundingRectangle()&&r==0&&n.intersectWith(a.canvasSpaceBoundingBox()),o=a}return n}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let r=this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(r,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return Xn.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return Xn.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),r=this._node.canvasSpaceBoundingBox();return Xn.scrollsHorizontally(this.scrollDirection())&&e.width()>r.width()||Xn.scrollsVertically(this.scrollDirection())&&e.height()>r.height()}};var zl=(s=>(s[s.NORMAL=0]="NORMAL",s[s.SHADOW=1]="SHADOW",s[s.WITHOUT_BACKGROUND_BLURS_AND_GLASS_EFFECTS=2]="WITHOUT_BACKGROUND_BLURS_AND_GLASS_EFFECTS",s[s.WITHOUT_GLASS_EFFECTS=3]="WITHOUT_GLASS_EFFECTS",s[s.KNOCKOUT_SHADOW=4]="KNOCKOUT_SHADOW",s[s.SLIDE_THUMBNAIL=5]="SLIDE_THUMBNAIL",s[s.WITHOUT_EFFECTS=6]="WITHOUT_EFFECTS",s))(zl||{});var or=class t{constructor(e,r=null,n=null){this.mode=e,this.shadowOwnerID=n,this.visitedNodes=r}clone(){return new t(this.mode,this.visitedNodes,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==4}};var bL=Ja(hL());var xr;(e=>{let t;(l=>(l[l.NON_RENDERABLE=0]="NON_RENDERABLE",l[l.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",l[l.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",l[l.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",l[l.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE",l[l.TRANSFORM=5]="TRANSFORM"))(t=e.RenderableContentType||(e.RenderableContentType={}))})(xr||(xr={}));var SL=Ja(hd(),1),AL=Ja(fL(),1);var gL="package Fig;enum MessageType{JOIN_START=0;NODE_CHANGES=1;USER_CHANGES=2;JOIN_END=3;SIGNAL=4;STYLE=5;STYLE_SET=6;JOIN_START_SKIP_RELOAD=7;NOTIFY_SHOULD_UPGRADE=8;UPGRADE_DONE=9;UPGRADE_REFRESH=10;SCENE_GRAPH_QUERY=11;SCENE_GRAPH_REPLY=12;DIFF=13;CLIENT_BROADCAST=14;JOIN_START_JOURNALED=15;STREAM_START=16;STREAM_END=17;INTERACTIVE_SLIDE_CHANGE=18;RECONNECT_SCENE_GRAPH_QUERY=19;RECONNECT_SCENE_GRAPH_REPLY=20;JOIN_END_INCREMENTAL_RECONNECT=21;NODE_STATUS_CHANGE=22;CLIENT_RENDERED=23;}enum Axis{X=0;Y=1;}enum Access{READ_ONLY=0;READ_WRITE=1;}enum NodePhase{CREATED=0;REMOVED=1;}enum WindingRule{NONZERO=0;ODD=1;}enum NodeType{NONE=0;DOCUMENT=1;CANVAS=2;GROUP=3;FRAME=4;BOOLEAN_OPERATION=5;VECTOR=6;STAR=7;LINE=8;ELLIPSE=9;RECTANGLE=10;REGULAR_POLYGON=11;ROUNDED_RECTANGLE=12;TEXT=13;SLICE=14;SYMBOL=15;INSTANCE=16;STICKY=17;SHAPE_WITH_TEXT=18;CONNECTOR=19;CODE_BLOCK=20;WIDGET=21;STAMP=22;MEDIA=23;HIGHLIGHT=24;SECTION=25;SECTION_OVERLAY=26;WASHI_TAPE=27;VARIABLE=28;TABLE=29;TABLE_CELL=30;VARIABLE_SET=31;SLIDE=32;ASSISTED_LAYOUT=33;INTERACTIVE_SLIDE_ELEMENT=34;VARIABLE_OVERRIDE=35;MODULE=36;SLIDE_GRID=37;SLIDE_ROW=38;RESPONSIVE_SET=39;CODE_COMPONENT=40;TEXT_PATH=41;CODE_INSTANCE=42;CODE_LIBRARY=43;CODE_FILE=44;CODE_LAYER=45;BRUSH=46;MANAGED_STRING=47;TRANSFORM=48;CMS_RICH_TEXT=49;REPEATER=50;JSX=51;EMBEDDED_PROTOTYPE=52;REACT_FIBER=53;RESPONSIVE_NODE_SET=54;WEBPAGE=55;KEYFRAME=56;KEYFRAME_TRACK=57;}enum ShapeWithTextType{SQUARE=0;ELLIPSE=1;DIAMOND=2;TRIANGLE_UP=3;TRIANGLE_DOWN=4;ROUNDED_RECTANGLE=5;PARALLELOGRAM_RIGHT=6;PARALLELOGRAM_LEFT=7;ENG_DATABASE=8;ENG_QUEUE=9;ENG_FILE=10;ENG_FOLDER=11;TRAPEZOID=12;PREDEFINED_PROCESS=13;SHIELD=14;DOCUMENT_SINGLE=15;DOCUMENT_MULTIPLE=16;MANUAL_INPUT=17;HEXAGON=18;CHEVRON=19;PENTAGON=20;OCTAGON=21;STAR=22;PLUS=23;ARROW_LEFT=24;ARROW_RIGHT=25;SUMMING_JUNCTION=26;OR=27;SPEECH_BUBBLE=28;INTERNAL_STORAGE=29;}enum BlendMode{PASS_THROUGH=0;NORMAL=1;DARKEN=2;MULTIPLY=3;LINEAR_BURN=4;COLOR_BURN=5;LIGHTEN=6;SCREEN=7;LINEAR_DODGE=8;COLOR_DODGE=9;OVERLAY=10;SOFT_LIGHT=11;HARD_LIGHT=12;DIFFERENCE=13;EXCLUSION=14;HUE=15;SATURATION=16;COLOR=17;LUMINOSITY=18;}enum PaintType{SOLID=0;GRADIENT_LINEAR=1;GRADIENT_RADIAL=2;GRADIENT_ANGULAR=3;GRADIENT_DIAMOND=4;IMAGE=5;EMOJI=6;VIDEO=7;PATTERN=8;NOISE=9;}enum ImageScaleMode{STRETCH=0;FIT=1;FILL=2;TILE=3;}enum EffectType{INNER_SHADOW=0;DROP_SHADOW=1;FOREGROUND_BLUR=2;BACKGROUND_BLUR=3;REPEAT=4;SYMMETRY=5;GRAIN=6;NOISE=7;GLASS=8;}enum TextCase{ORIGINAL=0;UPPER=1;LOWER=2;TITLE=3;SMALL_CAPS=4;SMALL_CAPS_FORCED=5;}enum TextDecoration{NONE=0;UNDERLINE=1;STRIKETHROUGH=2;}enum TextDecorationStyle{SOLID=0;DOTTED=1;WAVY=2;}enum LeadingTrim{NONE=0;CAP_HEIGHT=1;}enum NumberUnits{RAW=0;PIXELS=1;PERCENT=2;}enum ConstraintType{MIN=0;CENTER=1;MAX=2;STRETCH=3;SCALE=4;FIXED_MIN=5;FIXED_MAX=6;}enum StrokeAlign{CENTER=0;INSIDE=1;OUTSIDE=2;}enum StrokeCap{NONE=0;ROUND=1;SQUARE=2;ARROW_LINES=3;ARROW_EQUILATERAL=4;DIAMOND_FILLED=5;TRIANGLE_FILLED=6;HIGHLIGHT=7;WASHI_TAPE_1=8;WASHI_TAPE_2=9;WASHI_TAPE_3=10;WASHI_TAPE_4=11;WASHI_TAPE_5=12;WASHI_TAPE_6=13;CIRCLE_FILLED=14;}enum StrokeJoin{MITER=0;BEVEL=1;ROUND=2;}enum BooleanOperation{UNION=0;INTERSECT=1;SUBTRACT=2;XOR=3;}enum TextAlignHorizontal{LEFT=0;CENTER=1;RIGHT=2;JUSTIFIED=3;}enum TextAlignVertical{TOP=0;CENTER=1;BOTTOM=2;}enum MouseCursor{DEFAULT=0;CROSSHAIR=1;EYEDROPPER=2;HAND=3;PAINT_BUCKET=4;PEN=5;PENCIL=6;MARKER=7;ERASER=8;HIGHLIGHTER=9;LASSO=10;}enum VectorMirror{NONE=0;ANGLE=1;ANGLE_AND_LENGTH=2;}enum DashMode{CLIP=0;STRETCH=1;}enum ImageType{PNG=0;JPEG=1;SVG=2;PDF=3;MP4=4;}enum ExportConstraintType{CONTENT_SCALE=0;CONTENT_WIDTH=1;CONTENT_HEIGHT=2;}enum LayoutGridType{MIN=0;CENTER=1;STRETCH=2;MAX=3;}enum LayoutGridPattern{STRIPES=0;GRID=1;}enum TextAutoResize{NONE=0;WIDTH_AND_HEIGHT=1;HEIGHT=2;}enum TextTruncation{DISABLED=0;ENDING=1;}enum StyleSetType{PERSONAL=0;TEAM=1;CUSTOM=2;FREQUENCY=3;TEMPORARY=4;}enum StyleSetContentType{SOLID=0;GRADIENT=1;IMAGE=2;}enum StackMode{NONE=0;HORIZONTAL=1;VERTICAL=2;GRID=3;}enum StackAlign{MIN=0;CENTER=1;MAX=2;BASELINE=3;}enum StackCounterAlign{MIN=0;CENTER=1;MAX=2;STRETCH=3;AUTO=4;BASELINE=5;}enum StackJustify{MIN=0;CENTER=1;MAX=2;SPACE_EVENLY=3;SPACE_BETWEEN=4;}enum GridChildAlign{AUTO=0;MIN=1;CENTER=2;MAX=3;}enum StackSize{FIXED=0;RESIZE_TO_FIT=1;RESIZE_TO_FIT_WITH_IMPLICIT_SIZE=2;}enum StackPositioning{AUTO=0;ABSOLUTE=1;}enum StackWrap{NO_WRAP=0;WRAP=1;}enum StackCounterAlignContent{AUTO=0;SPACE_BETWEEN=1;}enum ConnectionType{NONE=0;INTERNAL_NODE=1;URL=2;BACK=3;CLOSE=4;SET_VARIABLE=5;UPDATE_MEDIA_RUNTIME=6;CONDITIONAL=7;SET_VARIABLE_MODE=8;OBJECT_ANIMATION=9;}enum InteractionType{ON_CLICK=0;AFTER_TIMEOUT=1;MOUSE_IN=2;MOUSE_OUT=3;ON_HOVER=4;MOUSE_DOWN=5;MOUSE_UP=6;ON_PRESS=7;NONE=8;DRAG=9;ON_KEY_DOWN=10;ON_VOICE=11;ON_MEDIA_HIT=12;ON_MEDIA_END=13;MOUSE_ENTER=14;MOUSE_LEAVE=15;}enum TransitionType{INSTANT_TRANSITION=0;DISSOLVE=1;FADE=2;SLIDE_FROM_LEFT=3;SLIDE_FROM_RIGHT=4;SLIDE_FROM_TOP=5;SLIDE_FROM_BOTTOM=6;PUSH_FROM_LEFT=7;PUSH_FROM_RIGHT=8;PUSH_FROM_TOP=9;PUSH_FROM_BOTTOM=10;MOVE_FROM_LEFT=11;MOVE_FROM_RIGHT=12;MOVE_FROM_TOP=13;MOVE_FROM_BOTTOM=14;SLIDE_OUT_TO_LEFT=15;SLIDE_OUT_TO_RIGHT=16;SLIDE_OUT_TO_TOP=17;SLIDE_OUT_TO_BOTTOM=18;MOVE_OUT_TO_LEFT=19;MOVE_OUT_TO_RIGHT=20;MOVE_OUT_TO_TOP=21;MOVE_OUT_TO_BOTTOM=22;MAGIC_MOVE=23;SMART_ANIMATE=24;SCROLL_ANIMATE=25;}enum EasingType{IN_CUBIC=0;OUT_CUBIC=1;INOUT_CUBIC=2;LINEAR=3;IN_BACK_CUBIC=4;OUT_BACK_CUBIC=5;INOUT_BACK_CUBIC=6;CUSTOM_CUBIC=7;SPRING=8;GENTLE_SPRING=9;CUSTOM_SPRING=10;SPRING_PRESET_ONE=11;SPRING_PRESET_TWO=12;SPRING_PRESET_THREE=13;}enum ScrollDirection{NONE=0;HORIZONTAL=1;VERTICAL=2;BOTH=3;}enum ScrollContractedState{EXPANDED=0;CONTRACTED=1;}struct GUID{uint sessionID;uint localID;}struct Color{float r;float g;float b;float a;}struct Vector{float x;float y;}struct Rect{float x;float y;float w;float h;}struct ColorStop{Color color;float position;}message ColorStopVar{Color color=1;VariableData colorVar=2;float position=3;}struct Matrix{float m00;float m01;float m02;float m10;float m11;float m12;}struct ParentIndex{GUID guid;string position;}struct Number{float value;NumberUnits units;}struct FontName{string family;string style;string postscript;}enum FontVariantNumericFigure{NORMAL=0;LINING=1;OLDSTYLE=2;}enum FontVariantNumericSpacing{NORMAL=0;PROPORTIONAL=1;TABULAR=2;}enum FontVariantNumericFraction{NORMAL=0;DIAGONAL=1;STACKED=2;}enum FontVariantCaps{NORMAL=0;SMALL=1;ALL_SMALL=2;PETITE=3;ALL_PETITE=4;UNICASE=5;TITLING=6;}enum FontVariantPosition{NORMAL=0;SUB=1;SUPER=2;}enum FontStyle{NORMAL=0;ITALIC=1;}enum SemanticWeight{NORMAL=0;BOLD=1;}enum SemanticItalic{NORMAL=0;ITALIC=1;}enum CodeSnapshotState{INITIAL=0;SNAPSHOTTING=1;OK=2;SNAPSHOT_ERROR=3;LLM_IN_PROGRESS=4;}enum CodeObjectType{WEB_LAYER=0;WEB_INTERACTION=1;NATIVE_LAYER=2;}enum LockMode{NONE=0;ALL=1;BACKGROUND_ONLY=2;}enum OpenTypeFeature{PCAP=0;C2PC=1;CASE=2;CPSP=3;TITL=4;UNIC=5;ZERO=6;SINF=7;ORDN=8;AFRC=9;DNOM=10;NUMR=11;LIGA=12;CLIG=13;DLIG=14;HLIG=15;RLIG=16;AALT=17;CALT=18;RCLT=19;SALT=20;RVRN=21;VERT=22;SWSH=23;CSWH=24;NALT=25;CCMP=26;STCH=27;HIST=28;SIZE=29;ORNM=30;ITAL=31;RAND=32;DTLS=33;FLAC=34;MGRK=35;SSTY=36;KERN=37;FWID=38;HWID=39;HALT=40;TWID=41;QWID=42;PWID=43;JUST=44;LFBD=45;OPBD=46;RTBD=47;PALT=48;PKNA=49;LTRA=50;LTRM=51;RTLA=52;RTLM=53;ABRV=54;ABVM=55;ABVS=56;VALT=57;VHAL=58;BLWF=59;BLWM=60;BLWS=61;AKHN=62;CJCT=63;CFAR=64;CPCT=65;CURS=66;DIST=67;EXPT=68;FALT=69;FINA=70;FIN2=71;FIN3=72;HALF=73;HALN=74;HKNA=75;HNGL=76;HOJO=77;INIT=78;ISOL=79;JP78=80;JP83=81;JP90=82;JP04=83;LJMO=84;LOCL=85;MARK=86;MEDI=87;MED2=88;MKMK=89;NLCK=90;NUKT=91;PREF=92;PRES=93;VPAL=94;PSTF=95;PSTS=96;RKRF=97;RPHF=98;RUBY=99;SMPL=100;TJMO=101;TNAM=102;TRAD=103;VATU=104;VJMO=105;VKNA=106;VKRN=107;VRTR=108;VRT2=109;SS01=110;SS02=111;SS03=112;SS04=113;SS05=114;SS06=115;SS07=116;SS08=117;SS09=118;SS10=119;SS11=120;SS12=121;SS13=122;SS14=123;SS15=124;SS16=125;SS17=126;SS18=127;SS19=128;SS20=129;CV01=130;CV02=131;CV03=132;CV04=133;CV05=134;CV06=135;CV07=136;CV08=137;CV09=138;CV10=139;CV11=140;CV12=141;CV13=142;CV14=143;CV15=144;CV16=145;CV17=146;CV18=147;CV19=148;CV20=149;CV21=150;CV22=151;CV23=152;CV24=153;CV25=154;CV26=155;CV27=156;CV28=157;CV29=158;CV30=159;CV31=160;CV32=161;CV33=162;CV34=163;CV35=164;CV36=165;CV37=166;CV38=167;CV39=168;CV40=169;CV41=170;CV42=171;CV43=172;CV44=173;CV45=174;CV46=175;CV47=176;CV48=177;CV49=178;CV50=179;CV51=180;CV52=181;CV53=182;CV54=183;CV55=184;CV56=185;CV57=186;CV58=187;CV59=188;CV60=189;CV61=190;CV62=191;CV63=192;CV64=193;CV65=194;CV66=195;CV67=196;CV68=197;CV69=198;CV70=199;CV71=200;CV72=201;CV73=202;CV74=203;CV75=204;CV76=205;CV77=206;CV78=207;CV79=208;CV80=209;CV81=210;CV82=211;CV83=212;CV84=213;CV85=214;CV86=215;CV87=216;CV88=217;CV89=218;CV90=219;CV91=220;CV92=221;CV93=222;CV94=223;CV95=224;CV96=225;CV97=226;CV98=227;CV99=228;}struct ExportConstraint{ExportConstraintType type;float value;}struct GUIDMapping{GUID from;GUID to;}struct Blob{byte[]bytes;}message Image{byte[]hash=1;string name=2;uint dataBlob=3;}message Video{byte[]hash=1;string s3Url=2;}message PasteSource{string srcFile=1;GUID srcNode=2;}struct FilterColorAdjust{float tint;float shadows;float highlights;float detail;float exposure;float vignette;float temperature;float vibrance;}message PaintFilterMessage{float tint=1;float shadows=2;float highlights=3;float detail=4[deprecated];float exposure=5;float vignette=6[deprecated];float temperature=7;float vibrance=8;float contrast=9;float brightness=10[deprecated];}message Paint{PaintType type=1;Color color=2;float opacity=3;bool visible=4;BlendMode blendMode=5;ColorStop[]stops=6;Matrix transform=7;Image image=8;Image imageThumbnail=9;Image animatedImage=16;uint animationFrame=17;ImageScaleMode imageScaleMode=10;bool imageShouldColorManage=22;float rotation=11;float scale=12;FilterColorAdjust filterColorAdjust=13[deprecated];PaintFilterMessage paintFilter=14;uint[]emojiCodePoints=15;Video video=18;uint originalImageWidth=19;uint originalImageHeight=20;VariableData colorVar=21;VariableData imageVar=31;ColorStopVar[]stopsVar=23;string thumbHashBase64=24[deprecated];byte[]thumbHash=25;GUID sourceNodeId=26;float spacing=27;Vector patternSpacing=37;PatternTileType patternTileType=28;PatternAlignment verticalAlignment=29;PatternAlignment horizontalAlignment=30;GUID id=32;string altText=33;NoiseType noiseType=34;float density=35;Vector noiseSize=36;}enum NoiseType{MULTITONE=0;MONOTONE=1;DUOTONE=2;}enum PatternTileType{RECTANGULAR=0;HORIZONTAL_HEXAGONAL=1;VERTICAL_HEXAGONAL=2;}enum PatternAlignment{START=0;CENTER=1;END=2;}message FontMetaData{FontName key=1;float fontLineHeight=2;byte[]fontDigest=3;FontStyle fontStyle=4;int fontWeight=5;}message FontVariation{uint axisTag=1;string axisName=2;float value=3;}message TextData{string characters=1;uint[]characterStyleIDs=2;NodeChange[]styleOverrideTable=3;TextLineData[]lines=12;uint layoutVersion=8[deprecated];FontName[]fallbackFonts=10[deprecated];float minContentHeight=17[deprecated];Vector layoutSize=4[deprecated];Baseline[]baselines=5[deprecated];Glyph[]glyphs=6[deprecated];Decoration[]decorations=7[deprecated];Blockquote[]blockquotes=16[deprecated];FontMetaData[]fontMetaData=9[deprecated];HyperlinkBox[]hyperlinkBoxes=11[deprecated];int truncationStartIndex=13[deprecated];float truncatedHeight=14[deprecated];float[]logicalIndexToCharacterOffsetMap=15[deprecated];MentionBox[]mentionBoxes=18[deprecated];DerivedTextLineData[]derivedLines=19[deprecated];}message DerivedTextData{Vector layoutSize=1;Baseline[]baselines=2;Glyph[]glyphs=3;Decoration[]decorations=4;Blockquote[]blockquotes=5;FontMetaData[]fontMetaData=6;HyperlinkBox[]hyperlinkBoxes=7;int truncationStartIndex=8;float truncatedHeight=9;float[]logicalIndexToCharacterOffsetMap=10;MentionBox[]mentionBoxes=11;DerivedTextLineData[]derivedLines=12;}message HyperlinkBox{Rect bounds=1;string url=2;GUID guid=3;CMSItemPageTarget cmsTarget=5;bool openInNewTab=6;int hyperlinkID=4;}message MentionBox{Rect bounds=1;uint startIndex=2;uint endIndex=3;bool isValid=4;uint mentionKey=5;}message Baseline{Vector position=1;float width=2;float lineY=3;float lineHeight=4;float lineAscent=7;float ignoreLeadingTrim=8;uint firstCharacter=5;uint endCharacter=6;}message Glyph{uint commandsBlob=1;Vector position=2;uint styleID=3;float fontSize=4;uint firstCharacter=5;float advance=6;uint[]emojiCodePoints=7;EmojiImageSet emojiImageSet=8;float rotation=9;}message Decoration{Rect[]rects=1;uint styleID=2;}message Blockquote{Rect verticalBar=1;Rect quoteMarkBounds=2;uint styleID=3;}message VectorData{uint vectorNetworkBlob=1;Vector normalizedSize=2;NodeChange[]styleOverrideTable=3;}message TextPathStart{float tValue=1;bool forward=2;}message GUIDPath{GUID[]guids=1;}message SymbolData{GUID symbolID=1;NodeChange[]symbolOverrides=2;float uniformScaleFactor=3;}message GUIDPathMapping{GUID id=1;GUIDPath path=2;}message DerivedBreakpointData{NodeChange[]overrides=1;}message NodeGenerationData{NodeChange[]overrides=1;bool useFineGrainedSyncing=2;NodeChange[]diffOnlyRemovals=3;}message DerivedImmutableFrameData{NodeChange[]overrides=1;uint version=2;}message JsxData{NodeChange[]overrides=1;}message DerivedJsxData{NodeChange[]overrides=1;}message AssetIdMap{AssetIdEntry[]entries=1;}message AssetIdEntry{string assetKey=1;AssetId assetId=2;}message AssetRef{string key=1;string version=2;}message AssetId{GUID guid=1[deprecated];AssetRef assetRef=2[deprecated];StateGroupId stateGroupId=3;StyleId styleId=4;SymbolId symbolId=5;VariableID variableId=6;VariableSetID variableSetId=7;}message StateGroupId{GUID guid=1;AssetRef assetRef=2;}message StyleId{GUID guid=1;AssetRef assetRef=2;}message SymbolId{GUID guid=1;AssetRef assetRef=2;}message VariableID{GUID guid=1;AssetRef assetRef=2;}message VariableOverrideId{GUID guid=1;AssetRef assetRef=2;}message VariableSetID{GUID guid=1;AssetRef assetRef=2;}message ModuleId{GUID guid=1;AssetRef assetRef=2;}message ResponsiveSetId{GUID guid=1;AssetRef assetRef=2;}message ThemeID{GUID guid=1;AssetRef assetRef=2;}message CodeLibraryId{GUID guid=1;AssetRef assetRef=2;}message CodeFileId{GUID guid=1;AssetRef assetRef=2;}message CodeComponentId{GUID guid=1;AssetRef assetRef=2;}message CanvasNodeId{GUID guid=1;SymbolId symbolId=2;StateGroupId stateGroupId=3;}struct IndexRange{uint startIndex;uint endIndexExclusive;}struct CollaborativeTextOpID{uint sessionID;uint counterID;}enum CollaborativeTextOpType{INSERT=0;DELETE=1;}message CollaborativeTextStrippedOpRunWithIDs{CollaborativeTextOpID firstId=1;uint runLength=2;CollaborativeTextOpID[]parentIds=3;CollaborativeTextOpID[]rebasedOnOpIds=4;}message CollaborativeTextStrippedOpRunWithLoc{CollaborativeTextOpType type=1;IndexRange range=2;bool rangeShouldBeIteratedInReverse=3;IndexRange contentBytesInBuffer=4;IndexRange rebasedRange=5;}message CollaborativeTextOpRun{CollaborativeTextOpID id=1;CollaborativeTextOpID[]parentIds=2;CollaborativeTextOpType type=3;IndexRange range=4;bool rangeShouldBeIteratedInReverse=5;string content=6;CollaborativeTextOpID[]rebasedOnOpIds=7;IndexRange rebasedRange=8;}message CollaborativePlainText{CollaborativeTextStrippedOpRunWithIDs[]historyOpsWithIds=1;CollaborativeTextStrippedOpRunWithLoc[]historyOpsWithLoc=2;byte[]historyStringContentBuffer=3;CollaborativeTextOpRun[]changesToAppend=4;}message CollaborativeTextSelection{GUID node=1;uint field=2;IndexRange selectedRange=3;bool caretAtFront=4;CollaborativeTextOpID[]textVersion=5;}message ResponsiveTextStyleVariant{float minWidth=1;NodeChange fields=2;VariableData variableFontSize=3;VariableData variableLineHeight=4;VariableData variableLetterSpacing=5;VariableData variableParagraphSpacing=6;string name=7;}enum FlappType{POLL=0;EMBED=1;FACEPILE=2;ALIGNMENT=3;YOUTUBE=4;}message SlideThemeProps{string themeVersion=1;VariableSetID variableSetId=2;StyleId[]textStyleIds=3;bool isTextColorManuallySelected=4[deprecated];bool isBorderColorManuallySelected=5[deprecated];AssetRef subscribedThemeRef=6;uint schemaVersion=7;bool isGeneratedFromDesign=8;}message SlideThemeMap{SlideThemeMapEntry[]entries=1;}message SlideThemeMapEntry{ThemeID themeId=1;SlideThemeProps themeProps=2;}message SharedSymbolReference{string fileKey=1;GUID symbolID=2;string versionHash=3;GUIDPathMapping[]guidPathMappings=4;byte[]bytes=5;GUIDMapping[]libraryGUIDToSubscribingGUID=6[deprecated];string componentKey=7;GUIDPathMapping[]unflatteningMappings=8;bool isUnflattened=9;}message SharedComponentMasterData{string componentKey=1;GUIDPathMapping[]publishingGUIDPathToTeamLibraryGUID=2;bool isUnflattened=3;}message InstanceOverrideStash{GUIDPath overridePathOfSwappedInstance=1;string componentKey=2;NodeChange[]overrides=3;}message InstanceOverrideStashV2{GUIDPath overridePathOfSwappedInstance=1;GUID localSymbolID=2;NodeChange[]overrides=3;}message ImportedCodeFileEntry{CodeFileId codeFileId=1;}message ImportedCodeFiles{ImportedCodeFileEntry[]entries=1;}enum BlurOpType{NORMAL=0;PROGRESSIVE=1;}enum RepeatType{LINEAR=0;RADIAL=1;}enum UnitType{PIXELS=0;RELATIVE=1;}enum RepeatOrder{FORWARD=0;REVERSE=1;}enum EffectAxis{X=0;Y=1;X_AND_Y=2;}message Effect{EffectType type=1;Vector offset=3;float radius=4;bool visible=5;BlendMode blendMode=6;float spread=7;bool showShadowBehindNode=8;VariableData radiusVar=9;VariableData colorVar=10;VariableData spreadVar=11;VariableData xVar=12;VariableData yVar=13;uint count=14;RepeatType repeatType=15;EffectAxis axis=16;UnitType unitType=17;RepeatOrder order=18;BlurOpType blurOpType=19;Vector startOffset=20;Vector endOffset=28;float startRadius=21;Color color=2;Color secondaryColor=24;Vector noiseSize=22;uint seed=29;bool clipToShape=23;float density=25;NoiseType noiseType=26;float opacity=27;float refractionRadius=30;float specularAngle=31;float specularIntensity=32;float bevelSize=33;float chromaticAberration=34;float reflectionDistance=35;float refractionIntensity=36;}enum TransformModifierType{REPEAT=0;SYMMETRY=1;SKEW=2;}message TransformModifier{TransformModifierType type=1;Vector offset=2;bool visible=3;uint count=4;RepeatType repeatType=5;EffectAxis axis=6;UnitType unitType=7;RepeatOrder order=8;float skewX=9;float skewY=10;}message TransitionInfo{TransitionType type=1;float duration=2;}enum PrototypeDeviceType{NONE=0;PRESET=1;CUSTOM=2;PRESENTATION=3;}enum DeviceRotation{NONE=0;CCW_90=1;}message PrototypeDevice{PrototypeDeviceType type=1;Vector size=2;string presetIdentifier=3;DeviceRotation rotation=4;}enum OverlayPositionType{CENTER=0;TOP_LEFT=1;TOP_CENTER=2;TOP_RIGHT=3;BOTTOM_LEFT=4;BOTTOM_CENTER=5;BOTTOM_RIGHT=6;MANUAL=7;}enum OverlayBackgroundInteraction{NONE=0;CLOSE_ON_CLICK_OUTSIDE=1;}enum OverlayBackgroundType{NONE=0;SOLID_COLOR=1;}message OverlayBackgroundAppearance{OverlayBackgroundType backgroundType=1;Color backgroundColor=2;}enum NavigationType{NAVIGATE=0;OVERLAY=1;SWAP=2;SWAP_STATE=3;SCROLL_TO=4;}enum ExportColorProfile{DOCUMENT=0;SRGB=1;DISPLAY_P3_V4=2;CMYK=3;}message ExportSettings{string suffix=1;ImageType imageType=2;ExportConstraint constraint=3;bool svgDataName=4;ExportSVGIDMode svgIDMode=5;bool svgOutlineText=6;bool contentsOnly=7;bool svgForceStrokeMasks=8;bool useAbsoluteBounds=9;ExportColorProfile colorProfile=10;float quality=11;bool useBicubicSampler=12;}enum ExportSVGIDMode{IF_NEEDED=0;ALWAYS=1;}message LayoutGrid{LayoutGridType type=1;Axis axis=2;bool visible=3;int numSections=4;float offset=5;float sectionSize=6;float gutterSize=7;Color color=8;LayoutGridPattern pattern=9;VariableData numSectionsVar=10;VariableData offsetVar=11;VariableData sectionSizeVar=12;VariableData gutterSizeVar=13;}message Guide{Axis axis=1;float offset=2;GUID guid=3;}message Path{WindingRule windingRule=1;uint commandsBlob=2;uint styleID=3;}enum StyleType{NONE=0;FILL=1;STROKE=2;TEXT=3;EFFECT=4;EXPORT=5;GRID=6;}enum BrushOrientation{FORWARD=0;REVERSE=1;}enum BrushType{STRETCH=0;SCATTER=1;}message DynamicStrokeSettings{float frequency=1;float wiggle=2;float smoothen=3;}message ScatterStrokeSettings{float gap=1;float wiggle=2;float angularJitter=3;float rotation=4;float sizeJitter=5;}message StretchStrokeSettings{BrushOrientation orientation=1;}message VariableWidthPoint{float position=1;float ascent=2;float descent=3;int segmentId=4;}message SharedStyleReference{string styleKey=1;string versionHash=2;}message SharedStyleMasterData{string styleKey=1;string sortPosition=2;string fileKey=3;}enum ScrollBehavior{SCROLLS=0;FIXED_WHEN_CHILD_OF_SCROLLING_FRAME=1;STICKY_SCROLLS=2;}message ArcData{float startingAngle=1;float endingAngle=2;float innerRadius=3;}message SymbolLink{string uri=1;string displayName=2;string displayText=3;}message PluginData{string pluginID=1;string value=2;string key=3;}message PluginRelaunchData{string pluginID=1;string message=2;string command=3;bool isDeleted=4;}message MultiplayerFieldVersion{uint counter=1;uint sessionID=2;}enum ConnectorMagnet{NONE=0;AUTO=1;TOP=2;LEFT=3;BOTTOM=4;RIGHT=5;CENTER=6;AUTO_HORIZONTAL=7;EDGE=8;ABSOLUTE=9;}message ConnectorEndpoint{GUID endpointNodeID=1;Vector position=2;ConnectorMagnet magnet=3;}message ConnectorControlPoint{Vector position=1;Vector axis=2;}enum ConnectorTextSection{MIDDLE_TO_START=0;MIDDLE_TO_END=1;}enum ConnectorOffAxisOffset{NONE=0;ABOVE=1;BELOW=2;}message ConnectorTextMidpoint{ConnectorTextSection section=1;float offset=2;ConnectorOffAxisOffset offAxisOffset=3;}enum ConnectorLineStyle{ELBOWED=0;STRAIGHT=1;CURVED=2;}enum ConnectorType{MANUAL=0;DIAGRAM=1;}enum AnnotationPropertyType{FILL=0;STROKE=1;WIDTH=2;HEIGHT=3;MIN_WIDTH=4;MIN_HEIGHT=5;MAX_WIDTH=6;MAX_HEIGHT=7;STROKE_WIDTH=8;CORNER_RADIUS=9;EFFECT=10;TEXT_STYLE=11;TEXT_ALIGN_HORIZONTAL=12;FONT_FAMILY=13;FONT_SIZE=14;FONT_WEIGHT=15;LINE_HEIGHT=16;LETTER_SPACING=17;STACK_SPACING=18;STACK_PADDING=19;STACK_MODE=20;STACK_ALIGNMENT=21;OPACITY=22;COMPONENT=23;FONT_STYLE=24;GRID_ROW_GAP=25;GRID_COLUMN_GAP=26;GRID_ROW_COUNT=27;GRID_COLUMN_COUNT=28;GRID_ROW_ANCHOR_INDEX=29;GRID_COLUMN_ANCHOR_INDEX=30;GRID_ROW_SPAN=31;GRID_COLUMN_SPAN=32;}message AnnotationProperty{AnnotationPropertyType type=1;}enum AnnotationCategoryPreset{NONE=0;ACCESSIBILITY=1;BEHAVIOR=2;CONTENT=3;DEVELOPMENT=4;INTERACTION=5;}enum AnnotationCategoryColor{YELLOW=0;ORANGE=1;RED=2;PINK=3;VIOLET=4;BLUE=5;TEAL=6;GREEN=7;}message AnnotationCategoryCustom{AnnotationCategoryColor color=1;Color customColor=2[deprecated];string label=3;}message AnnotationCategory{GUID id=1;AnnotationCategoryPreset preset=2;AnnotationCategoryCustom custom=3;}message AnnotationCategories{uint version=1;AnnotationCategory[]items=2;}message Annotation{string label=1;AnnotationProperty[]properties=2;string labelV2=3;GUID categoryId=4;}enum AnnotationMeasurementNodeSide{TOP=0;BOTTOM=1;LEFT=2;RIGHT=3;}message AnnotationMeasurement{GUID id=1;GUID fromNode=2[deprecated];GUID toNode=3;AnnotationMeasurementNodeSide fromNodeSide=4;bool toSameSide=5;float innerOffsetRelative=6;float outerOffsetFixed=7;GUIDPath toNodeStablePath=8;string freeText=9;}message LibraryMoveInfo{string oldKey=1;string pasteFileKey=2;}message LibraryMoveHistoryItem{GUID sourceNodeId=1;string sourceComponentKey=2;}message DeveloperRelatedLink{string nodeId=1;string fileKey=2;string linkName=3;string linkUrl=4;}message WidgetPointer{GUID nodeId=1;}message EditInfo{string timestampIso8601=1;string userId=2;uint lastEditedAt=3;uint createdAt=4;}enum EditorType{DESIGN=0;WHITEBOARD=1;SLIDES=2;DEV_HANDOFF=3;SITES=4;COOPER=5;ILLUSTRATION=6;FIGMAKE=7;}enum MaskType{ALPHA=0;OUTLINE=1;LUMINANCE=2;}enum ModuleType{NONE=0;SINGLE_NODE=1;MULTI_NODE=2;}enum SectionStatus{NONE=0;BUILD=1;COMPLETED=2;}message SectionStatusInfo{SectionStatus status=1;uint lastUpdateUnixTimestamp=2;string description=3;string userId=4;SectionStatus prevStatus=5;}message NodeChange{GUID guid=1;uint guidTag=53[deprecated];NodePhase phase=2;uint phaseTag=54[deprecated];ParentIndex parentIndex=3;uint parentIndexTag=55[deprecated];NodeType type=4;uint typeTag=56[deprecated];string name=5;uint nameTag=57[deprecated];bool isPublishable=174;string description=318;LibraryMoveInfo libraryMoveInfo=256;LibraryMoveHistoryItem[]libraryMoveHistory=281;string key=319;AssetIdMap fileAssetIds=383;uint styleID=49;uint styleIDTag=101[deprecated];bool isFillStyle=157[deprecated];bool isStrokeStyle=161[deprecated];bool isOverrideOverTextStyle=376;StyleType styleType=163;string styleDescription=191;string version=171;string userFacingVersion=399;string sortPosition=320;SharedStyleMasterData ojansSuperSecretNodeField=345[deprecated];SharedStyleMasterData sevMoonlitLilyData=348[deprecated];bool isSoftDeletedStyle=176;bool isNonUpdateable=177;SharedStyleMasterData sharedStyleMasterData=172;SharedStyleReference sharedStyleReference=173;GUID inheritFillStyleID=158;GUID inheritStrokeStyleID=162;GUID inheritTextStyleID=167;GUID inheritExportStyleID=168;GUID inheritEffectStyleID=169;GUID inheritGridStyleID=170;GUID inheritFillStyleIDForStroke=185;StyleId styleIdForFill=332;StyleId styleIdForStrokeFill=333;StyleId styleIdForText=334;StyleId styleIdForEffect=335;StyleId styleIdForGrid=336;Paint[]backgroundPaints=193;GUID inheritFillStyleIDForBackground=194[deprecated];bool isStateGroup=225;StateGroupPropertyValueOrder[]stateGroupPropertyValueOrders=238;SharedSymbolReference sharedSymbolReference=122;bool isSymbolPublishable=123;GUIDPathMapping[]sharedSymbolMappings=124;string sharedSymbolVersion=126;SharedComponentMasterData sharedComponentMasterData=152;string symbolDescription=144;GUIDPathMapping[]unflatteningMappings=164;GUIDPathMapping[]forceUnflatteningMappings=228;string publishFile=214[deprecated];string sourceLibraryKey=395;GUID publishID=215;string componentKey=216;bool isC2=217;string publishedVersion=218;string originComponentKey=252[deprecated];ComponentPropDef[]componentPropDefs=266;ComponentPropRef[]componentPropRefs=267;VariantPropSpec[]variantPropSpecs=483;SymbolData symbolData=113;uint symbolDataTag=114[deprecated];NodeChange[]derivedSymbolData=125;bool nestedInstanceResizeEnabled=394;GUID overriddenSymbolID=143;ComponentPropAssignment[]componentPropAssignments=268;bool propsAreBubbled=305;InstanceOverrideStash[]overrideStash=248;InstanceOverrideStashV2[]overrideStashV2=250[deprecated];GUIDPath guidPath=111;uint guidPathTag=112[deprecated];int overrideLevel=321;ModuleType moduleType=382;bool isSlot=463;bool isSlotContent=495;float fontSize=21;uint fontSizeTag=73[deprecated];float paragraphIndent=22;uint paragraphIndentTag=74[deprecated];float paragraphSpacing=23;uint paragraphSpacingTag=75[deprecated];TextAlignHorizontal textAlignHorizontal=32;uint textAlignHorizontalTag=84[deprecated];TextAlignVertical textAlignVertical=33;uint textAlignVerticalTag=85[deprecated];TextCase textCase=34;uint textCaseTag=86[deprecated];TextDecoration textDecoration=35;uint textDecorationTag=87[deprecated];Number lineHeight=40;uint lineHeightTag=92[deprecated];FontName fontName=41;uint fontNameTag=93[deprecated];TextData textData=42;uint textDataTag=94[deprecated];DerivedTextData derivedTextData=359;bool fontVariantCommonLigatures=127;bool fontVariantContextualLigatures=128;bool fontVariantDiscretionaryLigatures=129;bool fontVariantHistoricalLigatures=130;bool fontVariantOrdinal=131;bool fontVariantSlashedZero=132;FontVariantNumericFigure fontVariantNumericFigure=133;FontVariantNumericSpacing fontVariantNumericSpacing=134;FontVariantNumericFraction fontVariantNumericFraction=135;FontVariantCaps fontVariantCaps=136;FontVariantPosition fontVariantPosition=137;Number letterSpacing=165;string fontVersion=202;LeadingTrim leadingTrim=322;bool hangingPunctuation=337;bool hangingList=339;int maxLines=351;ResponsiveTextStyleVariant[]responsiveTextStyleVariants=417;SectionStatus sectionStatus=352[deprecated];SectionStatusInfo sectionStatusInfo=355;uint textUserLayoutVersion=203;uint textExplicitLayoutVersion=396;OpenTypeFeature[]toggledOnOTFeatures=205;OpenTypeFeature[]toggledOffOTFeatures=206;Hyperlink hyperlink=223;Mention mention=340;FontVariation[]fontVariations=260;uint textBidiVersion=279;TextTruncation textTruncation=280;bool hasHadRTLText=292;EmojiImageSet emojiImageSet=391;string slideThumbnailHash=392;bool visible=6;uint visibleTag=58[deprecated];bool locked=7;uint lockedTag=59[deprecated];LockMode lockMode=434;float opacity=8;uint opacityTag=60[deprecated];BlendMode blendMode=9;uint blendModeTag=61[deprecated];Vector size=11;uint sizeTag=63[deprecated];Matrix transform=12;uint transformTag=64[deprecated];float[]dashPattern=13;uint dashPatternTag=65[deprecated];bool mask=16;uint maskTag=68[deprecated];Vector rotationOrigin=424;bool maskIsOutline=18;uint maskIsOutlineTag=70[deprecated];MaskType maskType=317;float backgroundOpacity=19;uint backgroundOpacityTag=71[deprecated];float cornerRadius=20;uint cornerRadiusTag=72[deprecated];float strokeWeight=26;uint strokeWeightTag=78[deprecated];StrokeAlign strokeAlign=29;uint strokeAlignTag=81[deprecated];StrokeCap strokeCap=30;uint strokeCapTag=82[deprecated];Number strokeCapSize=497;StrokeJoin strokeJoin=31;uint strokeJoinTag=83[deprecated];Paint[]fillPaints=38;uint fillPaintsTag=90[deprecated];Paint[]strokePaints=39;uint strokePaintsTag=91[deprecated];Effect[]effects=43;uint effectsTag=95[deprecated];Color backgroundColor=50;uint backgroundColorTag=102[deprecated];Path[]fillGeometry=51;uint fillGeometryTag=103[deprecated];Path[]strokeGeometry=52;uint strokeGeometryTag=104[deprecated];Paint[]textDecorationFillPaints=411;bool textDecorationSkipInk=412;Number textUnderlineOffset=413;Number textDecorationThickness=415;TextDecorationStyle textDecorationStyle=416;TransformModifier[]transformModifiers=455;float rectangleTopLeftCornerRadius=145;float rectangleTopRightCornerRadius=146;float rectangleBottomLeftCornerRadius=147;float rectangleBottomRightCornerRadius=148;bool rectangleCornerRadiiIndependent=149;bool rectangleCornerToolIndependent=150;bool proportionsConstrained=151;OptionalVector targetAspectRatio=423;bool useAbsoluteBounds=258[deprecated];bool borderTopHidden=287[deprecated];bool borderBottomHidden=288[deprecated];bool borderLeftHidden=289[deprecated];bool borderRightHidden=290[deprecated];bool bordersTakeSpace=294;float borderTopWeight=295;float borderBottomWeight=296;float borderLeftWeight=297;float borderRightWeight=298;bool borderStrokeWeightsIndependent=299;ConstraintType horizontalConstraint=28;uint horizontalConstraintTag=80[deprecated];StackMode stackMode=105;uint stackModeTag=106[deprecated];float stackSpacing=107;uint stackSpacingTag=108[deprecated];float stackPadding=109;uint stackPaddingTag=110[deprecated];StackCounterAlign stackCounterAlign=120[deprecated];StackJustify stackJustify=121;StackAlign stackAlign=208[deprecated];float stackHorizontalPadding=209;float stackVerticalPadding=210;StackSize stackWidth=211[deprecated];StackSize stackHeight=212[deprecated];StackSize stackPrimarySizing=229;StackJustify stackPrimaryAlignItems=230;StackAlign stackCounterAlignItems=231;float stackChildPrimaryGrow=232;float stackPaddingRight=233;float stackPaddingBottom=234;StackCounterAlign stackChildAlignSelf=236;StackPositioning stackPositioning=269;bool stackReverseZIndex=271;StackWrap stackWrap=323;float stackCounterSpacing=324;OptionalVector minSize=325;OptionalVector maxSize=326;StackCounterAlignContent stackCounterAlignContent=343;int[]sortedMovingChildIndices=406;GUIDPositionMap gridRows=435;GUIDPositionMap gridColumns=436;float gridRowGap=437;float gridColumnGap=438;GUID gridRowAnchor=439;GUID gridColumnAnchor=440;uint gridRowSpan=441;uint gridColumnSpan=442;GUIDGridTrackSizeMap gridColumnsSizing=474;GUIDGridTrackSizeMap gridRowsSizing=475;GridChildAlign gridChildVerticalAlign=476;GridChildAlign gridChildHorizontalAlign=477;bool isSnakeGameBoard=344[deprecated];GUID transitionNodeID=139;GUID prototypeStartNodeID=140;Color prototypeBackgroundColor=141;TransitionInfo transitionInfo=153[deprecated];TransitionType transitionType=154;float transitionDuration=155;EasingType easingType=156;bool transitionPreserveScroll=181;ConnectionType connectionType=182;string connectionURL=183;PrototypeDevice prototypeDevice=184;InteractionType interactionType=187;float transitionTimeout=188;bool interactionMaintained=189;float interactionDuration=190;bool destinationIsOverlay=192[deprecated];bool transitionShouldSmartAnimate=207;PrototypeInteraction[]prototypeInteractions=226;PrototypeInteraction[]objectAnimations=426;PrototypeStartingPoint prototypeStartingPoint=249;PluginData[]pluginData=204;PluginRelaunchData[]pluginRelaunchData=219;ConnectorEndpoint connectorStart=242;ConnectorEndpoint connectorEnd=243;ConnectorLineStyle connectorLineStyle=244;StrokeCap connectorStartCap=245;StrokeCap connectorEndCap=246;ConnectorControlPoint[]connectorControlPoints=253;ConnectorControlPoint[]connectorBezierControlPoints=479;ConnectorTextMidpoint connectorTextMidpoint=255;ConnectorType connectorType=373;Annotation[]annotations=369;AnnotationMeasurement[]measurements=384;AnnotationCategories annotationCategories=453;ShapeWithTextType shapeWithTextType=241;float shapeUserHeight=247;DerivedImmutableFrameData derivedImmutableFrameData=254;MultiplayerFieldVersion derivedImmutableFrameDataVersion=338;NodeGenerationData nodeGenerationData=240;JsxData jsxData=491;DerivedJsxData derivedJsxData=492;string stableKey=493;CodeBlockLanguage codeBlockLanguage=259;CodeBlockTheme codeBlockTheme=433;LinkPreviewData linkPreviewData=278;bool shapeTruncates=282;bool sectionContentsHidden=283;VideoPlayback videoPlayback=300;StampData stampData=301;SectionPresetInfo sectionPresetInfo=370;PlatformShapeDefinition platformShapeDefinition=409;MultiplayerMap widgetSyncedState=273;uint widgetSyncCursor=274[deprecated];WidgetDerivedSubtreeCursor widgetDerivedSubtreeCursor=275[deprecated];WidgetPointer widgetCachedAncestor=276;WidgetInputBehavior widgetInputBehavior=285;string widgetTooltip=286;WidgetHoverStyle widgetHoverStyle=291;bool isWidgetStickable=293;bool shouldHideCursorsOnWidgetHover=360;WidgetMetadata widgetMetadata=262;WidgetEvent[]widgetEvents=263;WidgetPropertyMenuItem[]widgetPropertyMenuItems=265;WidgetInputTextNodeType widgetInputTextNodeType=401;MultiplayerMap jsxProps=489;TableRowColumnPositionMap tableRowPositions=308;TableRowColumnPositionMap tableColumnPositions=309;TableRowColumnSizeMap tableRowHeights=310;TableRowColumnSizeMap tableColumnWidths=311;MultiplayerMap interactiveSlideConfigData=371;MultiplayerMap interactiveSlideParticipantData=372;FlappType flappType=402;bool isEmbeddedPrototype=486;string slideSpeakerNotes=389;bool isSkippedSlide=410;ThemeID themeID=379;SlideThemeData slideThemeData=381[deprecated];SlideThemeMap slideThemeMap=390;string slideTemplateFileKey=393;SlideNumber slideNumber=443;string slideNumberSeparator=456;GUID diagramParentId=363[deprecated];GUID layoutRoot=362[deprecated];string layoutPosition=364[deprecated];DiagramLayoutRuleType diagramLayoutRuleType=366;DiagramParentIndex diagramParentIndex=367;DiagramLayoutPaused diagramLayoutPaused=368;bool isPageDivider=380;InternalEnumForTest internalEnumForTest=251;InternalDataForTest internalDataForTest=257;bool autoRename=14;uint autoRenameTag=66[deprecated];bool backgroundEnabled=15;uint backgroundEnabledTag=67[deprecated];bool exportContentsOnly=17;uint exportContentsOnlyTag=69[deprecated];float miterLimit=25;uint miterLimitTag=77[deprecated];float textTracking=27;uint textTrackingTag=79[deprecated];ConstraintType verticalConstraint=37;uint verticalConstraintTag=89[deprecated];ExportSettings[]exportSettings=45;uint exportSettingsTag=97[deprecated];TextAutoResize textAutoResize=46;uint textAutoResizeTag=98[deprecated];LayoutGrid[]layoutGrids=47;uint layoutGridsTag=99[deprecated];bool frameMaskDisabled=115;uint frameMaskDisabledTag=116[deprecated];bool resizeToFit=117;uint resizeToFitTag=118[deprecated];BooleanOperation booleanOperation=36;uint booleanOperationTag=88[deprecated];VectorMirror handleMirroring=44;uint handleMirroringTag=96[deprecated];uint count=10;uint countTag=62[deprecated];float starInnerScale=24;uint starInnerScaleTag=76[deprecated];ArcData arcData=195;VectorData vectorData=48;uint vectorDataTag=100[deprecated];uint vectorOperationVersion=425;TextPathStart textPathStart=432;bool exportBackgroundDisabled=119;Guide[]guides=138;bool internalOnly=142;ScrollDirection scrollDirection=159;float cornerSmoothing=160;Vector scrollOffset=166[deprecated];bool exportTextAsSVGText=175;ScrollContractedState scrollContractedState=178[deprecated];Vector contractedSize=179[deprecated];string fixedChildrenDivider=180[deprecated];ScrollBehavior scrollBehavior=186;int derivedSymbolDataLayoutVersion=196;NavigationType navigationType=197;OverlayPositionType overlayPositionType=198;Vector overlayRelativePosition=199;OverlayBackgroundInteraction overlayBackgroundInteraction=200;OverlayBackgroundAppearance overlayBackgroundAppearance=201;GUID overrideKey=213;bool containerSupportsFillStrokeAndCorners=220;StackSize stackCounterSizing=221;bool containersSupportFillStrokeAndCorners=222[deprecated];KeyTrigger keyTrigger=224;string voiceEventPhrase=227;GUID[]ancestorPathBeforeDeletion=235;SymbolLink[]symbolLinks=237;TextListData textListData=239[deprecated];bool detachOpticalSizeFromFontSize=261;float listSpacing=264;EmbedData embedData=270;RichMediaData richMediaData=272;MultiplayerMap renderedSyncedState=277;bool simplifyInstancePanels=284;HTMLTag accessibleHTMLTag=302;ARIARole ariaRole=303[deprecated];ARIAAttributesMap ariaAttributes=357;string accessibleLabel=304;bool isDecorativeImage=490;VariableData variableData=306[deprecated];VariableDataMap variableConsumptionMap=307;VariableModeBySetMap variableModeBySetMap=316;VariableSetMode[]variableSetModes=312;VariableSetID variableSetID=313;VariableResolvedDataType variableResolvedType=314;VariableDataValues variableDataValues=315;string variableTokenName=350[deprecated];VariableScope[]variableScopes=353;VariableDataMap parameterConsumptionMap=445;CodeSyntaxMap codeSyntax=358;PasteSource pasteSource=388[deprecated];EditorType pageType=397;GUID strokeBrushGuid=446;uint64 strokeSeed=482;VariableWidthPoint[]variableWidthPoints=447;DynamicStrokeSettings dynamicStrokeSettings=448;ScatterStrokeSettings scatterStrokeSettings=449;StretchStrokeSettings stretchStrokeSettings=450;Matrix[]scatterBrushTransforms=488;BrushType brushType=452;VariableSetID backingVariableSetId=377;VariableID overriddenVariableId=464;VariableIdOrVariableOverrideId backingVariableId=378[deprecated];bool isCollectionExtendable=385;string rootVariableKey=386;InheritedVariablesData inheritedVariableIds=517;HandoffStatusMap handoffStatusMap=361;AgendaPositionMap agendaPositionMap=327;AgendaMetadataMap agendaMetadataMap=328;MigrationStatus migrationStatus=329;bool isSoftDeleted=330;EditInfo editInfo=331;ColorProfile colorProfile=341[deprecated];SymbolId detachedSymbolId=342;ChildReadingDirection childReadingDirection=346;string readingIndex=347;DocumentColorProfile documentColorProfile=349;DeveloperRelatedLink[]developerRelatedLinks=354;string slideActiveThemeLibKey=356;EditScopeInfo editScopeInfo=365;SemanticWeight semanticWeight=374;SemanticItalic semanticItalic=375;bool areSlidesManuallyIndented=403;bool isResponsiveSet=387[deprecated];DerivedBreakpointData derivedBreakpointData=500;GUID defaultResponsiveSetId=398;bool isPrimaryBreakpoint=458;GUID primaryResponsiveNodeId=457[deprecated];GUID multiEditGlueId=462;float breakpointMinWidth=501;ResponsiveSetSettings responsiveSetSettings=400;NodeBehaviors behaviors=404;string sourceCode=414;CollaborativePlainText collaborativeSourceCode=444;CodeLibraryId belongsToCodeLibraryId=427;ImportedCodeFiles importedCodeFiles=467;CanvasNodeId codeFileCanvasNodeId=468;bool isEntrypointCodeFile=498;string componentOrStateGroupKey=502;uint componentOrStateGroupVersion=503;string sourceCodeLibraryKey=504;string[]sourceCodeLibraryKeys=515;string makeLibraryComponentId=518;bool shouldHidePreviewForMakeKitCreation=520;CodeFileId exportedFromCodeFileId=428;string codeExportName=430;CodeComponentId backingCodeComponentId=429;bool isMainCodeComponent=487;CodeSnapshotState codeSnapshotState=431;NodeChatMessage[]chatMessages=451;NodeChatCompressionState chatCompressionState=485;AIChatThread aiChatThread=496;string codeChatMessagesKey=484;CodeSnapshot codeSnapshot=459;uint codeSnapshotInvalidatedAt=480;bool isCodeBehavior=465;bool autoForkCode=469;bool hasBeenManuallyRenamed=470;bool codeCreatedFromDesign=471;CanvasNodeId codeCreatedFromDesignNodeId=481;ImageImportMap imageImports=473;CodeObjectType codeObjectType=516;string codeFilePath=472;CodeBehaviorData codeBehaviorData=478;uint codeLibraryFormat=519;CMSSelector cmsSelector=419;CMSConsumptionMap cmsConsumptionMap=420;CMSRichTextStyleMap cmsRichTextStyleMap=460;uint[]aiEditedNodeChangeFieldNumbers=405;string aiEditScopeLabel=408;FirstDraftData firstDraftData=407;FirstDraftKitElementData firstDraftKitElementData=418;CooperRevertData cooperRevertData=421[deprecated];CooperTemplateData cooperTemplateData=461;HubFileAttribution hubFileAttribution=422;ManagedStringData managedStringData=454;ThumbnailInfo thumbnailInfo=466;AiCanvasPrompt aiCanvasPrompt=494;CanvasNodeId backingNodeId=499;InterpolationType interpolationType=505;int64 timelinePosition=506;KeyframeValueData keyframeValue=507;BezierHandles bezierHandles=508;KeyframeOperation keyframeOperation=509;TimelinePositionType timelinePositionType=510;GUID clipId=511;uint64 timelineDuration=512;int64 timelineOffset=513;PlaybackStyle playbackStyle=514;}message CodeSnapshot{CodeSnapshotState state=6;uint invalidatedAt=7;Paint[]paints=1;Vector offset=2;Vector layoutSize=3;Vector canvasSize=5;uint devicePixelRatio=4;}message CodeBehaviorData{string name=1;string icon=2;string[]nodeTypes=3;string category=4;uint apiVersion=5;}message CookieBannerText{string bannerHeader=1;string bannerDisclaimerExplicit=2;string bannerDisclaimerImplicit=3;string policyLabel=4;string acceptText=5;string acknowledgeText=6;string manageText=7;string rejectText=8;string necessaryText=9;string necessaryDescription=10;string analyticsText=11;string analyticsDescription=12;string preferencesText=13;string preferencesDescription=14;string marketingText=15;string marketingDescription=16;string saveLabel=17;string triggerLabel=18;}message CookieBannerSettings{bool enabled=1;CookieBannerComponentType componentType=2;CookieXAlignment xAlignment=3;CookieYAlignment yAlignment=4;CookieXAlignment triggerXAlignment=5;CookieYAlignment triggerYAlignment=6;TriggerComponentType triggerComponentType=7;string policyUrl=8;CookieBannerText text=9;GUID policyLink=10;string locale=11;}enum CookieBannerComponentType{BANNER=0;MODAL=1;}enum TriggerComponentType{BANNER=0;TAG=1;}enum CookieXAlignment{LEFT=0;CENTER=1;RIGHT=2;}enum CookieYAlignment{TOP=0;CENTER=1;BOTTOM=2;}message ResponsiveSetSettings{string title=1;string description=2;ResponsiveScalingMode scalingMode=3;float scalingMinFontSize=4;float scalingMaxFontSize=5;float scalingMinLayoutWidth=6;float scalingMaxLayoutWidth=7;string lang=8;string faviconHash=9;string socialImageHash=10;string googleAnalyticsID=11;bool blockSearchIndexing=12;string customCodeHeadStart=13;string customCodeHeadEnd=14;string customCodeBodyStart=15;string customCodeBodyEnd=16;GUID faviconID=17;GUID socialImageID=18;bool addBypassLinks=19;bool ignoreReducedMotion=20;CookieBannerSettings cookieBanner=21;}enum ResponsiveScalingMode{REFLOW=0;SCALE=1;}message CMSSelector{string cmsCollectionId=1;CMSFilterCritera filterCriteria=2;CMSSelectorSort[]sorts=3;uint limit=4;}message CMSFilterCritera{CMSFilterCriteriaMatchType matchType=1;CMSSelectorFilter[]filters=2;}enum CMSFilterCriteriaMatchType{MATCH_ALL=0;MATCH_ANY=1;}message CMSSelectorFilter{string cmsFieldId=1;CMSSelectorFilterOperator op=2;string comparisonValue=3;}enum CMSSelectorFilterOperator{EQUALS=0;}message CMSSelectorSort{string cmsFieldId=1;CMSFieldOrderBy orderBy=2;}enum CMSFieldOrderBy{ASCENDING=0;DESCENDING=1;}message CMSConsumptionMap{CMSConsumptionMapEntry[]entries=1;}message CMSConsumptionMapEntry{CMSConsumptionField consumptionField=1;string cmsFieldId=2;}enum CMSConsumptionField{MISSING=0;TEXT_DATA=1;}message CMSRichTextStyleMap{CMSRichTextStyleEntry[]entries=1;}message CMSRichTextStyleEntry{CMSRichTextStyleClass styleClass=1;CMSRichTextDescriptor textDescriptor=2;}enum CMSRichTextStyleClass{HEADING1=0;HEADING2=1;HEADING3=2;HEADING4=3;HEADING5=4;HEADING6=5;PARAGRAPH=6;LINK=7;BLOCKQUOTE=8;}message CMSRichTextDescriptor{StyleId textStyleId=1;}message InheritedVariablesData{InheritedVariableEntry[]variableIds=1;}message InheritedVariableEntry{VariableID variableId=1;}message HubFileAttribution{string hubFileId=1;string hubFileName=2;}message ManagedStringData{string key=1;string context=2;string locale=3;ManagedStringNode content=4;ManagedStringContentSchema contentSchema=5;}enum ManagedStringContentSchema{V0=0;}enum ManagedStringNodeType{TEXT=0;CONCATENATE=1;PLURAL=2;PLACEHOLDER=3;}message ManagedStringNode{ManagedStringNodeType type=1;ManagedStringTextNodeData textNodeData=2;ManagedStringConcatenateAstNodeData concatenateNodeData=3;ManagedStringPluralAstNodeData pluralNodeData=4;ManagedStringPlaceholderAstNodeData placeholderNodeData=5;}message ManagedStringTextNodeData{string value=1;}message ManagedStringConcatenateAstNodeData{ManagedStringNode[]values=1;}enum ManagedStringPluralType{ZERO=0;ONE=1;TWO=2;FEW=3;MANY=4;OTHER=5;}message ManagedStringPluralAstNodeData{string identifier=1;ManagedStringPluralTypeMapEntry[]conditions=2;}message ManagedStringPluralTypeMapEntry{ManagedStringPluralType key=1;ManagedStringNode value=2;}enum ManagedStringFormatType{TEXT=0;DATE=1;TIME=2;NUMBER=3;}message ManagedStringPlaceholderAstNodeData{string identifier=1;ManagedStringFormatType formatType=2;string formatPattern=3;}message CooperRevertData{NodeChange originalValues=1;}message VideoPlayback{bool autoplay=1;bool mediaLoop=2;bool muted=3;bool showControls=4;uint startTimeMs=5;uint endTimeMs=6;}enum MediaAction{PLAY=0;PAUSE=1;TOGGLE_PLAY_PAUSE=2;MUTE=3;UNMUTE=4;TOGGLE_MUTE_UNMUTE=5;SKIP_FORWARD=6;SKIP_BACKWARD=7;SKIP_TO=8;SET_PLAYBACK_RATE=9;}message WidgetHoverStyle{Paint[]fillPaints=1;Paint[]strokePaints=2;float opacity=3;bool areFillPaintsSet=4;bool areStrokePaintsSet=5;bool isOpacitySet=6;}message WidgetDerivedSubtreeCursor{uint sessionID=1;uint counter=2;}message MultiplayerMap{MultiplayerMapEntry[]entries=1;}message MultiplayerMapEntry{string key=1;string value=2;}message VariableDataMap{VariableDataMapEntry[]entries=1;}message VariableDataMapEntry{uint nodeField=1;VariableData variableData=2;VariableField variableField=3;}enum VariableField{MISSING=0;CORNER_RADIUS=1;PARAGRAPH_SPACING=2;PARAGRAPH_INDENT=3;STROKE_WEIGHT=4;STACK_SPACING=5;STACK_PADDING_LEFT=6;STACK_PADDING_TOP=7;STACK_PADDING_RIGHT=8;STACK_PADDING_BOTTOM=9;VISIBLE=10;TEXT_DATA=11;WIDTH=12;HEIGHT=13;RECTANGLE_TOP_LEFT_CORNER_RADIUS=14;RECTANGLE_TOP_RIGHT_CORNER_RADIUS=15;RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=16;RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=17;BORDER_TOP_WEIGHT=18;BORDER_BOTTOM_WEIGHT=19;BORDER_LEFT_WEIGHT=20;BORDER_RIGHT_WEIGHT=21;VARIANT_PROPERTIES=22;STACK_COUNTER_SPACING=23;MIN_WIDTH=24;MAX_WIDTH=25;MIN_HEIGHT=26;MAX_HEIGHT=27;FONT_FAMILY=28;FONT_STYLE=29;FONT_VARIATIONS=30;OPACITY=31;FONT_SIZE=32;LETTER_SPACING=34;LINE_HEIGHT=36;OVERRIDDEN_SYMBOL_ID=37;HYPERLINK=38;CMS_SERIALIZED_RICH_TEXT_DATA=39;SLOT_CONTENT_ID=40;GRID_ROW_GAP=41;GRID_COLUMN_GAP=42;X_POSITION=43;Y_POSITION=44;ROTATION=45;}message VariableModeBySetMap{VariableModeBySetMapEntry[]entries=1;}message VariableModeBySetMapEntry{VariableSetID variableSetID=1;GUID variableModeID=2;VariableSetID variableSetExtensionID=3;}message CodeSyntaxMap{CodeSyntaxMapEntry[]entries=1;}message CodeSyntaxMapEntry{CodeSyntaxPlatform platform=1;string value=2;}message TableRowColumnPositionMap{TableRowColumnPositionMapEntry[]entries=1;}message TableRowColumnPositionMapEntry{GUID id=1;string position=2;}message GUIDPositionMap{GUIDPositionMapEntry[]entries=1;}message GUIDPositionMapEntry{GUID id=1;string position=2;}message GUIDGridTrackSizeMap{GUIDGridTrackSizeMapEntry[]entries=1;}message GUIDGridTrackSizeMapEntry{GUID id=1;GridTrackSize trackSize=2;}message ObjectAnimationList{ObjectAnimationListItem[]entries=1;}message ObjectAnimationListItem{GUID targetNodeId=1;PrototypeAction animation=2;}message GridTrackSize{GridTrackSizingFunction minSizing=1;GridTrackSizingFunction maxSizing=2;}message GridTrackSizingFunction{GridTrackSizingType type=1;float value=2;}enum GridTrackSizingType{FLEX=0;FIXED=1;HUG=2;}message TableRowColumnSizeMap{TableRowColumnSizeMapEntry[]entries=1;}message TableRowColumnSizeMapEntry{GUID id=1;float size=2;}message AgendaPositionMap{AgendaPositionMapEntry[]entries=1;}message AgendaPositionMapEntry{GUID id=1;string position=2;}enum AgendaItemType{NODE=0;BLOCK=1;}message AgendaMetadataMap{AgendaMetadataMapEntry[]entries=1;}message AgendaMetadataMapEntry{GUID id=1;AgendaMetadata data=2;}message AgendaMetadata{string name=1;AgendaItemType type=2;GUID targetNodeID=3;AgendaTimerInfo timerInfo=4;AgendaVoteInfo voteInfo=5;AgendaMusicInfo musicInfo=6;}message AgendaTimerInfo{uint timerLength=1;}message AgendaVoteInfo{uint voteCount=1;}message AgendaMusicInfo{string songID=1;uint startTimeMs=2;}enum DiagramLayoutRuleType{NONE=0;TREE=1;}struct DiagramParentIndex{GUID guid;string position;}enum DiagramLayoutPaused{NO=0;YES=1;}message ComponentPropRef{uint nodeField=1;GUID defID=2;string zombieFallbackName=3;ComponentPropNodeField componentPropNodeField=4;bool isDeleted=5;}enum ComponentPropNodeField{VISIBLE=0;TEXT_DATA=1;OVERRIDDEN_SYMBOL_ID=2;INHERIT_FILL_STYLE_ID=3;SLOT_CONTENT_ID=4;}message ComponentPropAssignment{GUID defID=1;ComponentPropValue value=2;VariableData varValue=3;DerivedTextData legacyDerivedTextData=4;}message ComponentPropDef{GUID id=1;string name=2;ComponentPropValue initialValue=3;string sortPosition=4;GUID parentPropDefId=5;ComponentPropType type=6;bool isDeleted=7;ComponentPropPreferredValues preferredValues=8;VariableData varValue=9;ParameterConfig parameterConfig=10;string description=11;}message ComponentPropValue{bool boolValue=1;TextData textValue=2;GUID guidValue=3;float floatValue=4;}enum ComponentPropType{BOOL=0;TEXT=1;COLOR=2;INSTANCE_SWAP=3;VARIANT=4;NUMBER=5;IMAGE=6;SLOT=7;}message ComponentPropPreferredValues{string[]stringValues=1[deprecated];InstanceSwapPreferredValue[]instanceSwapValues=2;}message ParameterConfig{NumberPropConfig numberPropConfig=1;ParameterConfigControl control=2;SliderConfig sliderConfig=3;VariableData label=4;InputConfig inputConfig=5;SelectConfig selectConfig=6;}enum ParameterConfigControl{DEFAULT=0;SLIDER=1;INPUT=2;SELECT=3;}message InputConfig{VariableData unit=1;VariableData min=2;VariableData max=3;}message SliderConfig{VariableData min=1;VariableData max=2;VariableData step=3;}message SelectOption{VariableData value=1;string label=2;}message SelectConfig{SelectOption[]options=1;}message NumberPropConfig{ParameterConfigControl control=1;VariableData min=2;VariableData max=3;VariableData step=4;}message InstanceSwapPreferredValue{InstanceSwapPreferredValueType type=1;string key=2;}enum InstanceSwapPreferredValueType{COMPONENT=0;STATE_GROUP=1;}enum WidgetEvent{MOUSE_DOWN=0;CLICK=1;TEXT_EDIT_END=2;ATTACHED_STICKABLES_CHANGED=3;STUCK_STATUS_CHANGED=4;}enum WidgetInputBehavior{WRAP=0;TRUNCATE=1;MULTILINE=2;}message WidgetMetadata{string pluginID=1;string pluginVersionID=2;string widgetName=3;}enum WidgetPropertyMenuItemType{ACTION=0;SEPARATOR=1;COLOR=2;DROPDOWN=3;COLOR_SELECTOR=4;TOGGLE=5;LINK=6;}message WidgetPropertyMenuSelectorOption{string option=1;string tooltip=2;}enum WidgetInputTextNodeType{WIDGET_CONTROLLED=0;RICH_TEXT=1;}message WidgetPropertyMenuItem{string propertyName=1;string tooltip=2;WidgetPropertyMenuItemType itemType=3;string icon=4;WidgetPropertyMenuSelectorOption[]options=5;string selectedOption=6;bool isToggled=7;string href=8;bool allowCustomColor=9;}enum CodeBlockLanguage{TYPESCRIPT=0;CPP=1;RUBY=2;CSS=3;JAVASCRIPT=4;HTML=5;JSON=6;GRAPHQL=7;PYTHON=8;GO=9;SQL=10;SWIFT=11;KOTLIN=12;RUST=13;BASH=14;PLAINTEXT=15;}enum CodeBlockTheme{FIGJAM_DARK=0;DRACULA=1;DUOTONE_SEA=2;DUOTONE_SPACE=3;DUOTONE_EARTH=4;DUOTONE_FOREST=5;DUOTONE_LIGHT=6;}enum InternalEnumForTest{OLD=1;}message InternalDataForTest{int testFieldA=1;}message StateGroupPropertyValueOrder{string property=1;string[]values=2;}message VariantPropSpec{GUID propDefId=1;string value=2;}message TextListData{int listID=1[deprecated];BulletType bulletType=2[deprecated];int indentationLevel=3[deprecated];int lineNumber=4[deprecated];}enum BulletType{ORDERED=0;UNORDERED=1;INDENT=2;NO_LIST=3;}message TextLineData{LineType lineType=1;int styleId=10;int indentationLevel=2;SourceDirectionality sourceDirectionality=9;Directionality directionality=3[deprecated];DirectionalityIntent directionalityIntent=4[deprecated];int downgradeStyleId=5;int consistencyStyleId=6;int listStartOffset=7;bool isFirstLineOfList=8;}message DerivedTextLineData{Directionality directionality=1;}enum LineType{PLAIN=0;ORDERED_LIST=1;UNORDERED_LIST=2;BLOCKQUOTE=3;HEADER=4;}enum SourceDirectionality{AUTO=0;LTR=1;RTL=2;}enum Directionality{LTR=0;RTL=1;}enum DirectionalityIntent{IMPLICIT=0;EXPLICIT=1;}message PrototypeInteraction{GUID id=1;PrototypeEvent event=2;PrototypeAction[]actions=3;bool isDeleted=4;int stateManagementVersion=5;}message PrototypeEvent{InteractionType interactionType=1;bool interactionMaintained=2;float interactionDuration=3;KeyTrigger keyTrigger=4;string voiceEventPhrase=5;float transitionTimeout=6;float mediaHitTime=7;}message PrototypeVariableTarget{VariableID id=1;NodeFieldAlias nodeFieldAlias=2;}message ConditionalActions{PrototypeAction[]actions=1;VariableData condition=2;}message PrototypeAction{GUID transitionNodeID=1;TransitionType transitionType=2;float transitionDuration=3;EasingType easingType=4;float transitionTimeout=5[deprecated];bool transitionShouldSmartAnimate=6;ConnectionType connectionType=7;Vector overlayRelativePosition=9;NavigationType navigationType=10;bool transitionPreserveScroll=11;float[]easingFunction=12;Vector extraScrollOffset=13;bool transitionResetScrollPosition=25;bool transitionResetInteractiveComponents=26;string connectionURL=8;bool openUrlInNewTab=18;VariableData linkParam=34;CMSItemPageTarget cmsTarget=35;GUID targetVariableID=14[deprecated];VariableAnyValue targetVariableValue=15[deprecated];PrototypeVariableTarget targetVariable=19;VariableData targetVariableData=20;MediaAction mediaAction=16;bool transitionResetVideoPosition=17;float mediaSkipToTime=21;float mediaSkipByAmount=22;float mediaPlaybackRate=36;VariableData[]conditions=23[deprecated];ConditionalActions[]conditionalActions=24;VariableSetID targetVariableSetID=27;GUID targetVariableModeID=28;string targetVariableSetKey=29;VariableSetID variableSetTargetExtensionId=38;AnimationType animationType=30;GUID animationTargetId=31[deprecated];AnimationPhase animationPhase=32;AnimationState animationState=33;bool simpleLink=37;}enum AnimationPhase{IN=0;OUT=1;}enum AnimationType{NONE=0;FADE=1;SLIDE_FROM_LEFT=2;SLIDE_FROM_RIGHT=3;SLIDE_FROM_TOP=4;SLIDE_FROM_BOTTOM=5;}message AnimationState{float opacity=1;Matrix transform=2;}message PrototypeStartingPoint{string name=1;string description=2;string position=3;}enum TriggerDevice{KEYBOARD=0;UNKNOWN_CONTROLLER=1;XBOX_ONE=2;PS4=3;SWITCH_PRO=4;}message KeyTrigger{int[]keyCodes=1;TriggerDevice triggerDevice=2;}message Hyperlink{string url=1;GUID guid=2;CMSItemPageTarget cmsTarget=4;bool openInNewTab=3;}message CMSItemPageTarget{GUID nodeId=1;string cmsItemId=2;string fieldSchemaId=3;}enum MentionSource{DEFAULT=0;COPY_DUPLICATE=1;}message Mention{GUID id=1;string mentionedUserId=2;string mentionedByUserId=3;string fileKey=4;MentionSource source=5;uint64 mentionedUserIdInt=6;uint64 mentionedByUserIdInt=7;}message EmbedData{string url=1;string srcUrl=2;string title=3;string thumbnailUrl=4;float width=5;float height=6;string embedType=7;string thumbnailImageHash=8;string faviconImageHash=9;string provider=10;string originalText=11;string description=12;string embedVersionId=13;}message StampData{string userId=1;string votingSessionId=2;string stampedByUserId=3;}message LinkPreviewData{string url=1;string title=2;string provider=3;string description=4;string thumbnailImageHash=5;string faviconImageHash=6;float thumbnailImageWidth=7;float thumbnailImageHeight=8;}message Viewport{Rect canvasSpaceBounds=1;bool pixelPreview=2;float pixelDensity=3;GUID canvasGuid=4;}message Mouse{MouseCursor cursor=1;Vector canvasSpaceLocation=2;Rect canvasSpaceSelectionBox=3;GUID canvasGuid=4;uint cursorHiddenReason=5;}struct Click{uint id;Vector point;}struct ScrollPosition{GUID node;Vector scrollOffset;}struct TriggeredOverlay{GUID overlayGuid;GUID hotspotGuid;GUID swapGuid;}message TriggeredOverlayData{GUID overlayGuid=1;GUID hotspotGuid=2;GUID swapGuid=3;GUID prototypeInteractionGuid=4;GUIDPath hotspotBlueprintId=5;}message TriggeredSetVariableActionData{GUID nodeForFindingTopmostScreenId=1;string targetVariableId=2;string targetVariableData=3;string resolvedVariableModes=4;}message TriggeredSetVariableModeActionData{GUID nodeForFindingTopmostScreenId=1;string targetVariableSetKey=2;string targetVariableModeId=3;VariableSetID targetVariableSetId=4;}message VideoStateChangeData{GUID targetNodeId=1;bool isPlaying=2;bool isPlayingSound=3;uint[]currentTimes=4;uint actionTakenTimestamp=5;}message EmbeddedPrototypeData{GUID nodeId=1;uint sessionId=2;}message PresentedState{GUID baseScreenID=1;TriggeredOverlayData[]overlays=2;}enum TransitionDirection{FORWARD=0;REVERSE=1;}message TopLevelPlaybackChange{PresentedState oldState=1;PresentedState newState=2;GUIDPath hotspotBlueprintID=3;GUID interactionID=4;bool isHotspotInNewPresentedState=5;TransitionDirection direction=6;GUIDPath instanceStablePath=7;}message InstanceStateChange{GUID stateID=1;GUID interactionID=2;GUIDPath hotspotStablePath=3;GUIDPath instanceStablePath=4;PlaybackChangePhase phase=5;}message TextCursor{Rect selectionBox=1;GUID canvasGuid=2[deprecated];GUID textNodeGuid=3;}message TextSelection{Rect[]selectionBoxes=1;GUID canvasGuid=2[deprecated];GUID textNodeGuid=3;Vector textSelectionRange=4;GUID textNodeOrContainingIfGuid=5;GUID tableCellRowId=6;GUID tableCellColId=7;}enum PlaybackChangePhase{INITIATED=0;ABORTED=1;COMMITTED=2;}message PlaybackChangeKeyframe{PlaybackChangePhase phase=1;float progress=2;float timestamp=3;}message StateMapping{GUIDPath stablePath=1;TopLevelPlaybackChange lastTopLevelChange=2;PlaybackChangeKeyframe lastTopLevelChangeStatus=3;float timestamp=4;}message ScrollMapping{GUIDPath blueprintID=1;uint overlayIndex=2;Vector scrollOffset=3;}message PlaybackUpdate{TopLevelPlaybackChange lastTopLevelChange=1;PlaybackChangeKeyframe lastTopLevelChangeStatus=2;ScrollMapping[]scrollMappings=3;float timestamp=4;Vector pointerLocation=5;bool isTopLevelFrameChange=6;StateMapping[]stateMappings=7;}message ChatMessage{string text=1;string previousText=2;}message VoiceMetadata{string connectedCallId=1;}message AprilFunCursor{string id=1;bool trailEnabled=2;}message AprilFunFigPal{string customization=1;string name=2;}enum Heartbeat{FOREGROUND=0;BACKGROUND=1;}enum SitesViewState{FILE=0;CODE=1;DAKOTA=2;SETTINGS=3;INSERT=4;}message UserChange{uint sessionID=1;string stableSessionID=44;bool connected=2;string name=3;Color color=4;string imageURL=5;Viewport viewport=6;Mouse mouse=7;GUID[]selection=8;uint[]observing=9;string deviceName=10;Click[]recentClicks=11;ScrollPosition[]scrollPositions=12;TriggeredOverlay[]triggeredOverlays=13[deprecated];string userID=14;GUID lastTriggeredHotspot=15;GUID lastTriggeredPrototypeInteractionID=16;uint lastTriggeredObjectAnimationIndex=38;TriggeredOverlayData[]triggeredOverlaysData=17;PlaybackUpdate[]playbackUpdates=18[deprecated];ChatMessage chatMessage=19;VoiceMetadata voiceMetadata=20;bool canWrite=21;bool highFiveStatus=22;InstanceStateChange[]instanceStateChanges=23;TextCursor textCursor=24;TextSelection textSelection=25;uint connectedAtTimeS=26;bool focusOnTextCursor=27;Heartbeat heartbeat=28;TriggeredSetVariableActionData[]triggeredSetVariableActionData=29;VideoStateChangeData[]videoStateChangeData=30;string clientID=31;GUID focusedSlideId=32;TriggeredSetVariableModeActionData[]triggeredSetVariableModeActionData=33;AprilFunCursor aprilFunCursor=34[deprecated];EmbeddedPrototypeData[]embeddedPrototypeData=35;GUID activeSlidesEmbeddablePrototype=36;GUID[]activeEmbeddedPrototypes=43;GUID activeCodeComponentId=37;AprilFunFigPal aprilFunFigPal=39[deprecated];CollaborativeTextSelection collaborativeTextSelection=40;SitesViewState sitesViewState=41;NodeChatExchange[]nodeChatExchanges=42;}message InteractiveSlideElementChange{string userID=1[deprecated];string anonymousUserID=2;GUID nodeID=3;string responseData=4;}message NodeStatusChange{GUID[]nodeIds=1;SectionStatusInfo statusInfo=2;}enum SceneGraphQueryBehavior{DEFAULT=0;CONTAINING_PAGE=1;PLUGIN=2;}message SceneGraphQuery{GUID startingNode=1;uint depth=2;SceneGraphQueryBehavior behavior=3;}message NodeChangesMetadata{uint blobsFieldOffset=1;}message CursorReaction{string imageUrl=1;}message TimerInfo{bool isPaused=1;uint timeRemainingMs=2;uint totalTimeMs=3;uint timerID=4;string setBy=5;uint songID=6[deprecated];uint lastReceivedSongTimestampMs=7;string songUUID=8;}message MusicInfo{bool isPaused=1;uint messageID=2;string songID=3;uint lastReceivedSongTimestampMs=4;bool isStopped=5;}message PresenterNomination{uint sessionID=1;bool isCancelled=2;}message PresenterInfo{uint sessionID=1;PresenterNomination nomination=2;bool isReconnected=3;}message ClientBroadcast{uint sessionID=1;CursorReaction cursorReaction=2;TimerInfo timer=3;PresenterInfo presenter=4;PresenterInfo prototypePresenter=5;MusicInfo music=6;}enum PasteAssetType{UNKNOWN=0;VARIABLE=1;}message Message{MessageType type=1;uint sessionID=2;string stableSessionID=42;uint ackID=3;bool isRetransmission=37;NodeChange[]nodeChanges=4;UserChange[]userChanges=5;InteractiveSlideElementChange interactiveSlideElementChange=32;NodeStatusChange nodeStatusChange=36;Blob[]blobs=6;uint blobBaseIndex=30;string signalName=7;Access access=8;string styleSetName=9;StyleSetType styleSetType=10;StyleSetContentType styleSetContentType=11;int pasteID=12;Vector pasteOffset=13;string pasteFileKey=14;string signalPayload=15;SceneGraphQuery[]sceneGraphQueries=16;NodeChangesMetadata nodeChangesMetadata=17[deprecated];uint fileVersion=18;bool pasteIsPartiallyOutsideEnclosingFrame=19;GUID pastePageId=20;bool isCut=21;Message[]localUndoStack=22;Message[]localRedoStack=23;ClientBroadcast[]broadcasts=24;uint reconnectSequenceNumber=25;string pasteBranchSourceFileKey=26;EditorType pasteEditorType=27;string postSyncActions=28;GUID[]publishedAssetGuids=29;bool dirtyFromInitialLoad=31;ClipboardSelectionRegion[]clipboardSelectionRegions=33;EncodedOffsetsIndex encodedOffsetsIndex=34;bool hasRepeatingContent=35;uint64 sentTimestamp=38;AnnotationCategory[]annotationCategories=39;ClientRenderedMetadata clientRenderedMetadata=40;PasteAssetType pasteAssetType=41;ObjectAnimationList objectAnimations=43;}message EncodedOffsetsIndex{uint nodeChangesFieldOffset=1;uint nodeChangesFieldLength=2;uint blobsFieldOffset=3;GUIDAndEncodedOffset[]nodeChangeOffsets=4;}struct GUIDAndEncodedOffset{GUID guid;uint offset;}message DiffChunk{uint[]nodeChanges=1;NodePhase phase=2[deprecated];NodeChange displayNode=3;GUID canvasId=4;string canvasName=5;bool canvasIsInternal=6;uint[]chunksAffectingThisChunk=7;NodeChange[]basisParentHierarchy=8[deprecated];NodeChange[]parentHierarchy=9[deprecated];GUID[]basisParentHierarchyGuids=10;GUID[]parentHierarchyGuids=11;}enum DiffType{BRANCHING=0;NODE_CHANGES_ONLY=1;}message DiffPayload{NodeChange[]nodeChanges=1;Blob[]blobs=2;DiffChunk[]diffChunks=3;NodeChange[]diffBasis=4;NodeChange[]basisParentNodeChanges=5;NodeChange[]parentNodeChanges=6;DiffType diffType=7;}enum RichMediaType{ANIMATED_IMAGE=0;VIDEO=1;}message RichMediaData{string mediaHash=1;RichMediaType richMediaType=2;}enum VariableDataType{BOOLEAN=0;FLOAT=1;STRING=2;ALIAS=3;COLOR=4;EXPRESSION=5;MAP=6;SYMBOL_ID=7;FONT_STYLE=8;TEXT_DATA=9;INVALID=10;NODE_FIELD_ALIAS=11;CMS_ALIAS=12;PROP_REF=13;IMAGE=14;MANAGED_STRING_ALIAS=15;LINK=16;JS_RUNTIME_ALIAS=17;SLOT_CONTENT_ID=18;DATE=19;KEYFRAME_TRACK_ID=20;}enum VariableResolvedDataType{BOOLEAN=0;FLOAT=1;STRING=2;COLOR=4;MAP=5;SYMBOL_ID=6;FONT_STYLE=7;TEXT_DATA=8;IMAGE=9;LINK=10;JS_RUNTIME_ALIAS=11;SLOT_CONTENT_ID=12;KEYFRAME_TRACK_ID=13;}message VariableAnyValue{bool boolValue=1;string textValue=2;float floatValue=3;VariableID alias=4;Color colorValue=5;Expression expressionValue=6;VariableMap mapValue=7;SymbolId symbolIdValue=8;VariableFontStyle fontStyleValue=9;TextData textDataValue=10;NodeFieldAlias nodeFieldAliasValue=11;CMSAlias cmsAliasValue=12;PropRefValue propRefValue=13;ImageParameterValue imageValue=14;ManagedStringAlias managedStringAliasValue=15;Hyperlink linkValue=16;JsRuntimeAlias jsRuntimeAliasValue=17;SlotContentId slotContentIdValue=18;KeyframeTrackId keyframeTrackIdValue=19;}enum ExpressionFunction{ADDITION=0;SUBTRACTION=1;RESOLVE_VARIANT=2;MULTIPLY=3;DIVIDE=4;EQUALS=5;NOT_EQUAL=6;LESS_THAN=7;LESS_THAN_OR_EQUAL=8;GREATER_THAN=9;GREATER_THAN_OR_EQUAL=10;AND=11;OR=12;NOT=13;STRINGIFY=14;TERNARY=15;VAR_MODE_LOOKUP=16;NEGATE=17;IS_TRUTHY=18;KEYFRAME=19;}message Expression{ExpressionFunction expressionFunction=1;VariableData[]expressionArguments=2;}message VariableMapValue{string key=1;VariableData value=2;GUID guidKey=3;}message VariableMap{VariableMapValue[]values=1;}message VariableFontStyle{VariableData asString=1;VariableData asFloat=2;VariableData asVariations=3;}message ImageParameterValue{Image image=1;Image imageThumbnail=2;Image animatedImage=6;string altText=3;uint originalImageHeight=4;uint originalImageWidth=5;uint animationFrame=7;}message ThumbnailInfo{GUID nodeID=1;string thumbnailVersion=2;}message AiCanvasPrompt{string userPrompt=1;string authorId=2;GUID[]parentNodeIds=3;}message NodeFieldAlias{GUIDPath stablePathToNode=1;NodeFieldAliasType nodeField=2;string indexOrKey=3;}enum NodeFieldAliasType{MISSING=0;COMPONENT_PROP_ASSIGNMENTS=1;}message CMSAlias{string collectionId=1;string itemId=2;string fieldId=3;VariableDataType type=4;}message JsRuntimeAlias{string lookupKey=1;}message PropRefValue{GUID defId=1;}message ManagedStringId{GUID guid=1;AssetRef assetRef=2;}message ManagedStringPlaceholderMapEntry{string key=1;string value=2;}message SlotContentId{GUID guid=1;}message ManagedStringAlias{ManagedStringId managedStringId=1;ManagedStringPlaceholderMapEntry[]placeholderValues=2;}message KeyframeTrackId{GUID guid=1;AssetRef assetRef=2;}message VariableData{VariableAnyValue value=1;VariableDataType dataType=2;VariableResolvedDataType resolvedDataType=3;}message VariableSetMode{GUID id=1;string name=2;string sortPosition=3;VariableSetID parentVariableSetId=4;GUID parentModeId=5;}message VariableDataValues{VariableDataValuesEntry[]entries=1;}message VariableDataValuesEntry{GUID modeID=1;VariableData variableData=2;}enum VariableScope{ALL_SCOPES=0;TEXT_CONTENT=1;CORNER_RADIUS=2;WIDTH_HEIGHT=3;GAP=4;ALL_FILLS=5;FRAME_FILL=6;SHAPE_FILL=7;TEXT_FILL=8;STROKE=9;STROKE_FLOAT=10;EFFECT_FLOAT=11;EFFECT_COLOR=12;OPACITY=13;FONT_STYLE=14;FONT_FAMILY=15;FONT_SIZE=16;LINE_HEIGHT=17;LETTER_SPACING=18;PARAGRAPH_SPACING=19;PARAGRAPH_INDENT=20;FONT_VARIATIONS=21;TRANSFORM=22;}message KeyframeAnyValue{float floatValue=1;}enum KeyframeValueType{FLOAT=0;INVALID=1;}message KeyframeValueData{KeyframeAnyValue value=1;KeyframeValueType valueType=2;}enum CodeSyntaxPlatform{WEB=0;ANDROID=1;iOS=2;}message OptionalVector{Vector value=1;}enum HTMLTag{AUTO=0;ARTICLE=1;SECTION=2;NAV=3;ASIDE=4;H1=5;H2=6;H3=7;H4=8;H5=9;H6=10;HGROUP=11;HEADER=12;FOOTER=13;ADDRESS=14;P=15;HR=16;PRE=17;BLOCKQUOTE=18;OL=19;UL=20;MENU=21;LI=22;DL=23;DT=24;DD=25;FIGURE=26;FIGCAPTION=27;MAIN=28;DIV=29;A=30;EM=31;STRONG=32;SMALL=33;S=34;CITE=35;Q=36;DFN=37;ABBR=38;RUBY=39;RT=40;RP=41;DATA=42;TIME=43;CODE=44;VAR=45;SAMP=46;KBD=47;SUB=48;SUP=49;I=50;B=51;U=52;MARK=53;BDI=54;BDO=55;SPAN=56;BR=57;WBR=58;PICTURE=59;SOURCE=60;IMG=61;FORM=62;LABEL=63;INPUT=64;BUTTON=65;SELECT=66;DATALIST=67;OPTGROUP=68;OPTION=69;TEXTAREA=70;OUTPUT=71;PROGRESS=72;METER=73;FIELDSET=74;LEGEND=75;VIDEO=76;}enum ARIARole{AUTO=0;NONE=52;APPLICATION=30;BANNER=67;COMPLEMENTARY=68;CONTENTINFO=69;FORM=70;MAIN=71;NAVIGATION=72;REGION=73;SEARCH=74;SEPARATOR=13;ARTICLE=31;COLUMNHEADER=35;DEFINITION=36;DIRECTORY=38;DOCUMENT=39;GROUP=44;HEADING=45;IMG=46;LIST=48;LISTITEM=49;MATH=50;NOTE=53;PRESENTATION=55;ROW=56;ROWGROUP=57;ROWHEADER=58;TABLE=62;TOOLBAR=65;BUTTON=1;CHECKBOX=2;GRIDCELL=3;LINK=4;MENUITEM=5;MENUITEMCHECKBOX=6;MENUITEMRADIO=7;OPTION=8;PROGRESSBAR=9;RADIO=10;SCROLLBAR=11;SLIDER=14;SPINBUTTON=15;TAB=17;TABPANEL=18;TEXTBOX=19;TREEITEM=20;COMBOBOX=21;GRID=22;LISTBOX=23;MENU=24;MENUBAR=25;RADIOGROUP=26;TABLIST=27;TREE=28;TREEGRID=29;TOOLTIP=66;ALERT=75;LOG=76;MARQUEE=77;STATUS=78;TIMER=79;ALERTDIALOG=80;DIALOG=81;SEARCHBOX=12;SWITCH=16;BLOCKQUOTE=32;CAPTION=33;CELL=34;DELETION=37;EMPHASIS=40;FEED=41;FIGURE=42;GENERIC=43;INSERTION=47;METER=51;PARAGRAPH=54;STRONG=59;SUBSCRIPT=60;SUPERSCRIPT=61;TERM=63;TIME=64;IMAGE=82;HEADING_1=83;HEADING_2=84;HEADING_3=85;HEADING_4=86;HEADING_5=87;HEADING_6=88;HEADER=89;FOOTER=90;SIDEBAR=91;SECTION=92;MAINCONTENT=93;TABLE_CELL=94;WIDGET=95;}message MigrationStatus{bool dsdCleanup=1;}message NodeFieldMap{NodeFieldMapEntry[]entries=1;}message NodeFieldMapEntry{GUID guid=1;uint field=2;uint lastModifiedSequenceNumber=3;}enum ColorProfile{SRGB=0;DISPLAY_P3=1;}enum DocumentColorProfile{LEGACY=0;SRGB=1;DISPLAY_P3=2;}enum ChildReadingDirection{NONE=0;LEFT_TO_RIGHT=1;RIGHT_TO_LEFT=2;}message ARIAAttributeAnyValue{bool boolValue=1;string stringValue=2;float floatValue=3;int intValue=4;string[]stringArrayValue=5;}enum ARIAAttributeDataType{BOOLEAN=0;STRING=1;FLOAT=2;INT=3;STRING_LIST=4;}message ARIAAttributeData{ARIAAttributeDataType type=1;ARIAAttributeAnyValue value=2;}message ARIAAttributesMap{ARIAAttributesMapEntry[]entries=1;}message ARIAAttributesMapEntry{string attribute=1;ARIAAttributeData value=2;}message HandoffStatusMapEntry{GUID guid=1;SectionStatusInfo handoffStatus=2;}message HandoffStatusMap{HandoffStatusMapEntry[]entries=1;}message EditScopeInfo{EditScopeStack[]editScopeStacks=1[deprecated];EditScopeSnapshot[]snapshots=2;}message EditScopeSnapshot{EditScopeStack[]frames=1;uint[]nodeChangeFieldNumbers=2;}message EditScopeStack{EditScope[]stack=1;}message EditScope{EditScopeType type=1;string label=2;EditorType editorType=3;}enum EditScopeType{INVALID=0;TEST_SETUP=1;USER=2;PLUGIN=3;SYSTEM=4;REST_API=5;ONBOARDING=6;AUTOSAVE=7;AI=8;}enum SectionPresetState{INSERTED=0;USER_EDITED=1;}enum EmojiImageSet{APPLE=0;NOTO=1;}enum SelectionRegionFocusType{NONE=0;PRIMARY=1;SECONDARY=2;}message SectionPresetInfo{uint64 shelfId=1;uint64 templateId=2;string templateName=3;SectionPresetState state=4;}message ClipboardSelectionRegion{GUID parent=1;GUID[]nodes=2;Vector enclosingFrameOffset=3;bool pasteIsPartiallyOutsideEnclosingFrame=4;SelectionRegionFocusType focusType=5;}enum FirstDraftKitType{LOCAL=0;LIBRARY=1;NONE=2;}message FirstDraftKit{string key=1;FirstDraftKitType type=2;}message FirstDraftData{string generationId=1;FirstDraftKit kit=2;}enum FirstDraftKitElementType{NONE=0;BUILDING_BLOCK=1;GROUPED_COMPONENT=2;}message FirstDraftKitElementData{FirstDraftKitElementType type=1;}enum PlatformShapeProperty{FILL=0;STROKE=1;TEXT=2;STROKE_COLOR=3;}enum PlatformShapeBehaviorType{SHAPE=0;CONTAINER=1;ADVANCED_CONTAINER=2;}message PlatformShapePropertyMapEntry{PlatformShapeProperty property=1;GUIDPath[]nodePaths=2;}message PlatformShapeDefinition{PlatformShapePropertyMapEntry[]propertyMapEntries=1;PlatformShapeBehaviorType behaviorType=2;GUIDPath thumbnailNode=3;}message NodeBehaviors{LinkBehavior link=1[deprecated];AppearBehavior appear=2;HoverBehavior hover=3;PressBehavior press=4;FocusBehavior focus=5;ScrollParallaxBehavior scrollParallax=6;ScrollTransformBehavior scrollTransform=7;CursorBehavior cursor=8;MarqueeBehavior marquee=9;CodeBehavior[]code=10;}message BehaviorTransition{EasingType easingType=1;float[]easingFunction=2;float transitionDuration=3;float delay=4;VariableData transitionDurationVar=5;VariableData delayVar=6;}enum AppearBehaviorTrigger{PAGE_LOAD=1;THIS_LAYER_IN_VIEW=2;OTHER_LAYER_IN_VIEW=3;SCROLL_DIRECTION=4;}enum RelativeDirection{UP=1;DOWN=2;LEFT=3;RIGHT=4;}message AppearBehavior{AppearBehaviorTrigger trigger=1;RelativeDirection direction=2;GUID otherLayer=3;BehaviorTransition enterTransition=4;NodeChange enterState=5;BehaviorTransition exitTransition=6;NodeChange exitState=7;bool playsOnce=8;VariableData playsOnceVar=9;}message HoverBehavior{BehaviorTransition transition=1;NodeChange state=2;}message PressBehavior{BehaviorTransition transition=1;NodeChange state=2;}message FocusBehavior{BehaviorTransition transition=1;NodeChange state=2;}message ScrollParallaxBehavior{ScrollDirection axis=1;float speed=2;bool relativeToPage=3;VariableData speedVar=4;}enum ScrollTransformBehaviorTrigger{PAGE_HEIGHT=1;THIS_LAYER_IN_VIEW=2;OTHER_LAYER_IN_VIEW=3;}message ScrollTransformBehavior{ScrollTransformBehaviorTrigger trigger=1;GUID otherLayer=2;BehaviorTransition transition=3;NodeChange fromState=4;NodeChange toState=5;bool playsOnce=6;bool playsOnceVar=7;VariableData playsOnceVar2=8;}message CursorBehavior{float hotspotX=1;float hotspotY=2;GUID cursorGuid=3;}message MarqueeBehavior{RelativeDirection direction=1;float speed=2;bool shouldLoopInfinitely=3;VariableData speedVar=4;VariableData shouldLoopInfinitelyVar=5;}message CodeBehavior{CodeComponentId codeComponentId=1;ComponentPropAssignment[]componentPropAssignments=2;}message ClientRenderedMetadata{string loadID=1;string trackingSessionId=2;uint trackingSessionSequenceId=3;string reconnectID=4;}enum LinkBehaviorType{URL=1;PAGE=2;}message LinkBehavior{LinkBehaviorType type=1[deprecated];string url=2[deprecated];GUID page=3[deprecated];bool openInNewWindow=4[deprecated];}message VariableIdOrVariableOverrideId{VariableID variableId=1;VariableOverrideId variableOverrideId=2;}struct IndexFontVariationAxis{string tag;string name;float min;float max;float defaultValue;}struct IndexFontVariationAxisValue{string tag;float value;}message IndexFontStyle{string name=1;string postscript=2;float weight=3;bool italic=4;float stretch=5;IndexFontVariationAxisValue[]variationAxisValues=6;}message IndexFontFile{string filename=1;uint version=2;string family=3;IndexFontStyle[]styles=4;IndexFontVariationAxis[]variationAxes=5;bool useFontOpticalSize=6;}struct IndexFamilyRename{string oldFamily;string newFamily;}struct IndexStyleRename{string oldStyle;string newStyle;}struct IndexFamilyStylesRename{string familyName;IndexStyleRename[]styleRenames;}struct IndexRenames{IndexFamilyRename[]family;IndexFamilyStylesRename[]style;}struct IndexEmojiSequence{uint[]codepoints;}struct IndexEmojis{uint revision;uint[]sizes;IndexEmojiSequence[]sequences;}message FontIndex{uint schemaVersion=1;IndexFontFile[]files=2;IndexRenames renames=3;IndexEmojis emojis=4;}message SlideThemeData{ThemeID themeID=1;string version=2;}enum SlideNumber{NONE=0;SLIDE=1;SECTION=2;SUBSECTION=3;TOTAL_WITHIN_DECK=4;TOTAL_WITHIN_SECTION=5;}enum NodeChatMessageType{USER_MESSAGE=0;ASSISTANT_MESSAGE=1;TOOL_MESSAGE=2;SYSTEM_MESSAGE=3;}message NodeChatMessage{GUID id=1;NodeChatMessageType type=2;string userId=3;string textContent=4;uint sentAt=5;NodeChatToolCall[]toolCalls=6;NodeChatToolResult[]toolResults=7;uint64 sentAt64=8;}message NodeChatToolCall{string toolCallId=1;string toolName=2;string argsJson=3;}message NodeChatToolResult{string toolCallId=1;string toolName=2;string resultJson=3;}message NodeChatExchange{GUID node=1;NodeChatMessage[]messages=2;bool isTyping=3;FileUpdate[]fileUpdates=4;}message NodeChatCompressionState{uint startIndex=1;string summary=2;}message FileUpdate{string name=1;string contents=2;}message AIChatContentPart{AIChatContentPartType type=1;AIChatContentPartAnyValue value=2;}enum AIChatContentPartType{INVALID=0;TEXT=1;SELECTED_NODE_IDS=2;}message AIChatContentPartAnyValue{string textValue=1;string[]selectedNodeIds=2;}enum AIChatMessageRole{USER=0;ASSISTANT=1;TOOL=2;SYSTEM=3;}message AIChatMessage{uint createdAtMs=1;AIChatMessageRole role=2;AIChatContentPart[]content=3;string clientId=4;uint64 createdAtMs64=5;}message AIChatThread{AIChatMessage[]messages=1;}enum CooperTemplateType{CUSTOM=0;TWITTER_POST=1;LINKEDIN_POST=2;INSTA_POST_SQUARE=3;INSTA_POST_PORTRAIT=4;INSTA_STORY=5;INSTA_AD=6;FACEBOOK_POST=7;FACEBOOK_COVER_PHOTO=8;FACEBOOK_EVENT_COVER=9;FACEBOOK_AD_PORTRAIT=10;FACEBOOK_AD_SQUARE=11;PINTEREST_AD_PIN=12;TWITTER_BANNER=13;LINKEDIN_POST_SQUARE=15;LINKEDIN_POST_PORTRAIT=16;LINKEDIN_POST_LANDSCAPE=17;LINKEDIN_PROFILE_BANNER=18;LINKEDIN_ARTICLE_BANNER=19;LINKEDIN_AD_LANDSCAPE=20;LINKEDIN_AD_SQUARE=21;LINKEDIN_AD_VERTICAL=22;YOUTUBE_THUMBNAIL=23;YOUTUBE_BANNER=24;YOUTUBE_AD=25;TWITCH_BANNER=26;GOOGLE_LEADERBOARD_AD=27;GOOGLE_LARGE_AD=28;GOOGLE_MED_AD=29;GOOGLE_MOBILE_BANNER_AD=30;GOOGLE_SKYSCRAPER_AD=31;CARD_HORIZONTAL=32;CARD_VERTICAL=33;PRINT_US_LETTER=34;POSTER=35;BANNER_STANDARD=36;BANNER_WIDE=37;BANNER_ULTRAWIDE=38;NAME_TAG_PORTRAIT=39;NAME_TAG_LANDSCAPE=40;INSTA_REEL_COVER=41;ZOOM_BACKGROUND=42;TIKTOK_POST=43;}message CooperTemplateData{CooperTemplateType type=1;}message ImageImportMap{ImageImport[]imports=1;}message ImageImport{string name=1;Image image=2;}enum InterpolationType{HOLD=0;BEZIER=1;}message BezierHandles{float p1x=1;float p1y=2;float p2x=3;float p2y=4;}enum KeyframeOperation{SET=0;SCALE=1;OFFSET=2;}enum TimelinePositionType{ABSOLUTE=0;RELATIVE=1;}enum PlaybackStyle{ONCE=0;LOOP=1;BOOMERANG=2;}";var S_=(0,SL.createKiwiCodec)(!1,(0,AL.parseSchema)(gL));var JH=new Int32Array(127),$H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(A_=0;A_<127;A_++)JH[A_]=$H.indexOf(String.fromCharCode(A_));var A_;function TL(t){for(var e="",r=1024,n=t.length,o=0;o<n;o+=r)e+=String.fromCharCode.apply(String,t.subarray(o,o+r));return btoa(e)}var EL=new Set(["vectorNetworkBlob","version"]);function jg(t,e,r=!1,n=!1,o=!1){if(n&&(t instanceof Array&&t.length===0&&e===void 0||e instanceof Array&&e.length===0&&t===void 0||!t&&!e))return!0;let i=typeof t;if(typeof e!==i)return!1;if(i==="number")return Number.isNaN(t)||Number.isNaN(e)?n:r?!0:n?t-e<.01&&t-e>-.01:t===e;if(i!=="object")return t===e;if(t===null!=(e===null))return!1;if(t===null)return!0;if(t instanceof Array!=e instanceof Array)return!1;if(t instanceof Array)return t.length===e.length&&t.every((l,c)=>jg(l,e[c],r,n,o));let a=Object.keys(t),s=Object.keys(e);return o&&(a=a.filter(l=>t[l]!==void 0),s=s.filter(l=>e[l]!==void 0)),a.length!==s.length||(n&&(a=a.filter(l=>!EL.has(l)),s=s.filter(l=>!EL.has(l))),a.sort(),s.sort(),!a.every((l,c)=>l===s[c]))?!1:a.every(l=>jg(t[l],e[l],r,n,o))}var Zg;(function(t){t.ACTIVATION="activation",t.ADAPTIVE_PLATFORM="adaptive_platform",t.ADOPTION="adoption",t.AGENT_PLATFORM="agent_platform",t.AI_APPLIED_RESEARCH="ai_applied_research",t.AI_APPS_INFRA="ai_apps_infra",t.AI_ASSISTANT="ai_assistant",t.AI_FOR_PRODUCTION="ai_for_production",t.AI_GENERATION="ai_generation",t.AI_INFRA="ai_infra",t.AI_PRODUCTIVITY="ai_productivity",t.AI_RESEARCH="ai_research",t.AI_RESEARCH_FOR_CODE="ai_research_for_code",t.AI_RESEARCH_FOR_DESIGN="ai_research_for_design",t.AI_SECURITY="ai_security",t.ANTIABUSE="antiabuse",t.APPLICATION_PLATFORM="application_platform",t.ASSISTANT="assistant",t.BILLING="billing",t.BILLING_CORE_PLATFORM="billing_core_platform",t.BILLING_EXPERIENCE="billing_experience",t.BILLING_SCALE="billing_scale",t.BUILD_SYSTEMS="build_systems",t.BUZZ="buzz",t.CLIENT_PLATFORM="client_platform",t.CMS="cms",t.CODE_CONNECT="code_connect",t.CODE_FOUNDATIONS="code_foundations",t.COMMUNITY="community",t.COMPUTE="compute",t.CTOP="ctop",t.DATA_AI="data_ai",t.DATA_COLLAB_TOOLS="data_collab_tools",t.DATA_CORE="data_core",t.DATA_CREATION_ENGINE="data_creation_engine",t.DATA_DESIGN_TOOLS="data_design_tools",t.DATA_DEV_TOOLS="data_dev_tools",t.DATA_ENGINEERING="data_engineering",t.DATA_FINANCE="data_finance",t.DATA_INFRA="data_infra",t.DATA_MARKETING="data_marketing",t.DATA_MARKETING_TOOLS="data_marketing_tools",t.DATA_MONETIZATION="data_monetization",t.DATA_PRODUCT_FOUNDATIONS="data_product_foundations",t.DATA_SALES="data_sales",t.DATA_USER_GROWTH="data_user_growth",t.DEPLOYS="deploys",t.DESIGN_SYSTEMS_ECOSYSTEM="design_systems_ecosystem",t.DESIGN_SYSTEMS_EDITOR="design_systems_editor",t.DESIGN_SYSTEMS_FOUNDATIONS="design_systems_foundations",t.DESKTOP="desktop",t.DEV_MODE="dev_mode",t.DEVELOPER_EXPERIENCE="developer_experience",t.DEVELOPER_PRODUCTIVITY="developer_productivity",t.DEVELOPER_TOOLS="developer_tools",t.DS_EDITOR="ds_editor",t.DS_ENABLEMENT="ds_enablement",t.DS_FOUNDATIONS="ds_foundations",t.DS_MANAGEMENT="ds_management",t.EDITOR_COLLABORATION="editor_collaboration",t.EDITOR_ERGONOMICS="editor_ergonomics",t.EDITOR_USABILITY="editor_usability",t.ENTERPRISE_CMS="enterprise_cms",t.ENV_TOOLS="env_tools",t.EXPANSION="expansion",t.EXPERIMENTATION_PLATFORM="experimentation_platform",t.EXPRESSIVE_AI="expressive_ai",t.EXTENSIBILITY="extensibility",t.EXTENSIBILITY_ECOSYSTEM="extensibility_ecosystem",t.EXTENSIBILITY_PLATFORM="extensibility_platform",t.FEEDBACK="feedback",t.FIGFILE_PLATFORM="figfile_platform",t.FIGJAM="figjam",t.FIGJAM_HORIZONTAL="figjam_horizontal",t.FIGMA_DOT_COM="figma_dot_com",t.FOUNDATION="foundation",t.FPL="fpl",t.FPL_AND_A11Y="fpl_and_a11y",t.FRONTEND_PLATFORM="frontend_platform",t.FULLSCREEN_PLATFORM="fullscreen_platform",t.GROWTH_PLATFORM="growth_platform",t.IAM="iam",t.INFRA_DATA_SCIENCE="infra_data_science",t.INTEGRATIONS="integrations",t.INTERACTION_DESIGN="interaction_design",t.INTERNAL_TOOLS="internal_tools",t.IT_ENG="it_eng",t.LITMUS="litmus",t.MAKE="make",t.MAKE_CORE="make_core",t.MAKE_DESIGN_SYSTEMS="make_design_systems",t.MAKE_EDITING="make_editing",t.MAKE_IN_CANVAS="make_in_canvas",t.MCP_SERVER="mcp_server",t.ML_PLATFORM="ml_platform",t.MOBILE="mobile",t.MOBILE_PLATFORM="mobile_platform",t.MOBILE_TEAMWORK="mobile_teamwork",t.MODELING_PLATFORM="modeling_platform",t.MONETIZATION_EXPANSION="monetization_expansion",t.MONETIZATION_UPGRADES="monetization_upgrades",t.MOTION="motion",t.PAYLOAD="payload",t.PIXEL_ENGINE="pixel_engine",t.PLATFORM_SECURITY="platform_security",t.PRODUCT_SECURITY="product_security",t.PRODUCT_SUPPORT="product_support",t.PRODUCTION_ENGINEERING="production_engineering",t.PROJECT_BUZZ="project_buzz",t.PROTOTYPING="prototyping",t.PUBLISHING="publishing",t.REALTIME_PLATFORM="realtime_platform",t.RENDERING_AND_ANIMATION="rendering_and_animation",t.SCALE="scale",t.SCENEGRAPH_AND_SYNC="scenegraph_and_sync",t.SEARCH="search",t.SEARCH_AI="search_ai",t.SEARCH_AND_RECOMMENDATIONS="search_and_recommendations",t.SEARCH_EXPERIENCE="search_experience",t.SECURITY="security",t.SITES_CMS="sites_cms",t.SITES_CORE="sites_core",t.SITES_EDITOR="sites_editor",t.SITES_WEB_PUBLISHING="sites_web_publishing",t.SITES_WEB_RUNTIME="sites_web_runtime",t.SLIDES="slides",t.STORAGE_PLATFORM="storage_platform",t.STORAGE_PRODUCTS="storage_products",t.TEXT_AND_LAYOUT="text_and_layout",t.TEXT_AND_VECTOR="text_and_vector",t.TEXTURE_LABS="texture_labs",t.TRAFFIC="traffic",t.UI3_PLATFORM="ui3_platform",t.UNOWNED="unowned",t.UPGRADES="upgrades",t.UX_PLATFORM="ux_platform",t.VECTORS="vectors",t.WAYFINDING="wayfinding",t.WEB_EXPERIENCE="web_experience",t.WEB_PLATFORM="web_platform",t.WORKFLOW="workflow"})(Zg||(Zg={}));var IL=null;var RL=(t,e,r)=>{if(IL)return IL(t,e,r);console.error(e,r)};function e3(t,e){let r=S_.encodeNodeChange({[t]:e.data}),n=S_.decodeNodeChange(r);return jg(e.data,n[t],!0,!1,!0)?S_.encodeMessage({type:"NODE_CHANGES",sessionID:0,ackID:0,nodeChanges:[{[t]:e.data}],blobs:e.blobs}):(RL(Zg.DESIGN_SYSTEMS_EDITOR,new Error(`Invalid format for ${t}`),{extra:{type:typeof e,value:e,jsonifiedData:JSON.stringify(e==null?void 0:e.data),jsonifiedDecodedNodeChange:JSON.stringify(n),source:"encodeDataWithBlobs",props:{field:t}}}),S_.encodeMessage({type:"NODE_CHANGES",sessionID:0,ackID:0,nodeChanges:[{[t]:null}],blobs:[]}))}function pu(t,e){return TL(e3(t,e))}function t3(t){let e={},r=[],n=[],o={};return o.windingRule=t.windingRule,o.styleID=t.styleID,o.commandsBlob=0,r.push(Lt.mutableData(t.path().toBezierPath().getMutableClone()).bytes()),n.push(o),e.fillGeometry=n,new ao(e,r)}var SO=class{constructor(e){this._region=e;let r=e.path();if(r instanceof To)this._pathType=dl.CppUniquePath,this._cppUniquePath=r.cppUniquePath(),this._serializedPathFallback="",this._roundedRectPath=null,this._ellipsePath=null;else if(r instanceof At)this._roundedRectPath={rect:{min:{x:r.rect().x(),y:r.rect().y()},max:{x:r.rect().width()-r.rect().x(),y:r.rect().height()-r.rect().y()}},radii:{topLeft:r.radii().topLeft,topRight:r.radii().topRight,bottomLeft:r.radii().bottomLeft,bottomRight:r.radii().bottomRight}},this._pathType=dl.RoundedRectPath,this._serializedPathFallback="",this._ellipsePath=null,this._cppUniquePath=0;else if(r instanceof En)this._ellipsePath={center:{x:r.center.x(),y:r.center.y()},radius:{x:r.xRadius,y:r.yRadius}},this._pathType=dl.EllipsePath,this._serializedPathFallback="",this._roundedRectPath=null,this._cppUniquePath=0;else{this._pathType=dl.BezierPathSerialized;let n=t3(e),o=n.b,i=n.a.fillGeometry;this._serializedPathFallback=pu("fillGeometry",{data:i,blobs:o.map((a,s)=>({index:s,bytes:a}))}),this._roundedRectPath=null,this._ellipsePath=null,this._cppUniquePath=0}}pathType(){return this._pathType}cppUniquePath(){return this._region.path().cppUniquePath()}roundedRectPath(){return this._roundedRectPath}ellipsePath(){return this._ellipsePath}serializedPathFallback(){return this._serializedPathFallback}},T_=class{constructor(e){this._regions=[];this._geometry=e;for(let r of e.regions)this._regions.push(new SO(r))}regions(){return this._regions}};var Wl=class{constructor(e){this._fillGeometry=null;this._strokeGeometry=null;this._cursor=e}opacity(){return this._cursor.opacity()}visible(){return this._cursor.visible()}blendModeEncodedNumber(){return Be().BlendMode[this._cursor.blendMode()]}typeEncodedNumber(){return Be().NodeType[this._cursor.type()]}uniqueIdentifier(){return this._cursor.uniqueIdentifier()}fillGeometryBindingsRegions(){var e;if(this._fillGeometry==null){let r=this._cursor.fillGeometry();this._fillGeometry=r?new T_(r):null}return((e=this._fillGeometry)==null?void 0:e.regions())??[]}strokeGeometryBindingsRegions(){var e;if(this._strokeGeometry==null){let r=this._cursor.strokeGeometry();this._strokeGeometry=r?new T_(r):null}return((e=this._strokeGeometry)==null?void 0:e.regions())??[]}childCount(){return this._cursor.childCount()}childAtForBindings(e){if(e<0||e>=this.childCount())return null;let r=this._cursor.clone();return r.moveToChildAt(e),r}indexInParent(){return this._cursor.indexInParent()}parentForBindings(){let e=this._cursor.parent();return e??null}sizeVectorF(){return Ot(this._cursor.size())}isMask(){return this._cursor.isMask()}maskTypeEncodedNumber(){return Be().MaskType[this._cursor.maskType()]}strokeWeight(){return this._cursor.strokeWeight()}strokeAlignEncodedNumber(){return Be().StrokeAlign[this._cursor.strokeAlign()]}isInsideOutlineMask(){return this._cursor.isInsideOutlineMask()}absoluteTransformForBindings(){return $e(this._cursor.absoluteTransform())}relativeTransformForBindings(){return $e(this._cursor.relativeTransform())}absoluteBoundsRectD(){return MD(this._cursor.canvasSpaceContentBounds())}relativeBoundsRectD(){let e=this.absoluteBoundsRectD(),r=this.parentForBindings();if(r==null)return e;let n=r.absoluteBoundsRectD();return{origin:{x:e.origin.x-n.origin.x,y:e.origin.y-n.origin.y},size:{x:e.size.x,y:e.size.y}}}canvasSpaceRenderedBoundsRectF(){return ft(this._cursor.canvasSpaceContentBounds())}};var E_;(r=>{function t(){return new Map}r._new=t;function e(n,o){return new Map([...n.entries()].filter(([i,a])=>o(i,a)))}r._filter=e})(E_||(E_={}));var Kl=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let r=e?this.name.split("/")[0]:this.name;return r=r.trim(),r+" "+this.relativeChildIndex.toString()}constructor(e,r){this.name=e,this.relativeChildIndex=r}},Jg=class t{getData(e,r){let n=this.getAllDataForNode(e);return n!=null&&n.has(r)?n.get(r):null}getAllDataForNode(e){let r=this.getSubTrie(e);return r!=null?r.cache:null}insert(e,r,n){if(e.length==0){this.cache.set(r,n);return}let o=e[0].toString(),i=e.slice(1,e.length);this.children.has(o)||this.children.set(o,new t),this.children.get(o).insert(i,r,n)}remove(e,r){if(e.length==0){this.cache.delete(r);return}let n=e[0].toString(),o=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new t),this.children.get(n).remove(o,r)}forEach(e){for(let r of Array.from(this.cache.keys()))e(this.cache.get(r));for(let r of Array.from(this.children.keys()))this.children.get(r).forEach(e)}getSubTrie(e){if(e.length==0)return this;let r=e[0].toString();return this.children.has(r)?this.children.get(r).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let r of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(r));for(let r of Array.from(this.children.keys()))this.children.get(r).uninitialize2(e),this.children.delete(r)}toString1(){return this.toString2(null)}toString2(e){let r=this.toStringHelper(e),n="";for(let o of r)n=n+`${o}
`;return n}toStringHelper(e){let r=[];for(let n of Array.from(this.cache.keys()))r.push(e==null?n:`${n}: ${e(this.cache.get(n))}`);for(let n of Array.from(this.children.keys())){let o=this.children.get(n).toStringHelper(e);for(let i of o)r.push(`${n}/${i}`)}return r}constructor(){this.cache=E_._new(),this.children=new Map}},Yl=class{getData(e,r){if(e.length==0)return null;let n=this._getSSTDataCacheFromLowerNodeStorage(e);return n!=null&&n.has(r)?n.get(r):null}getAllDataForNode(e){return e.length==0?null:this._getSSTDataCacheFromLowerNodeStorage(e)}_getSSTDataCacheFromTLFStorage(e){let r=e[0].toString();return this.tlfNodeStorage.has(r)?this.tlfNodeStorage.get(r).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let r=this._getFirstNodeName(e);return this.lowerNodeStorage.has(r)?this.lowerNodeStorage.get(r).getAllDataForNode(e.slice(1,e.length)):null}insert(e,r,n){e.length!=0&&this._insertIntoLowerNodeStorage(e,r,n)}remove(e,r){e.length!=0&&this._deleteFromLowerNodeStorage(e,r)}_deleteFromTLFStorage(e,r){let n=e[0].toString();this.tlfNodeStorage.has(n)&&this.tlfNodeStorage.get(n).remove(e.slice(1,e.length),r)}_deleteFromLowerNodeStorage(e,r){let n=this._getFirstNodeName(e);this.lowerNodeStorage.has(n)&&this.lowerNodeStorage.get(n).remove(e.slice(1,e.length),r)}_insertIntoTLFStorage(e,r,n){let o=e[0].toString();this.tlfNodeStorage.has(o)||this.tlfNodeStorage.set(o,new Jg),this.tlfNodeStorage.get(o).insert(e.slice(1,e.length),r,n)}_insertIntoLowerNodeStorage(e,r,n){let o=this._getFirstNodeName(e);this.lowerNodeStorage.has(o)||this.lowerNodeStorage.set(o,new Jg),this.lowerNodeStorage.get(o).insert(e.slice(1,e.length),r,n)}forEach(e){for(let r of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(r).forEach(e);for(let r of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(r).forEach(e)}getSubTrie(e){if(e.length==0)return this;let r=e,n=this._getFirstNodeName(r);return this.lowerNodeStorage.has(n)?this.lowerNodeStorage.get(n).getSubTrie(r.slice(1,r.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let r of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(r).uninitialize2(e),this.tlfNodeStorage.delete(r);for(let r of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(r).uninitialize2(e),this.lowerNodeStorage.delete(r)}toString1(){return this.toString2(null)}toString2(e){let r=this._toStringHelper(e),n="";for(let o of r)n=n+`${o}
`;return n}_toStringHelper(e){let r=[];for(let n of Array.from(this.lowerNodeStorage.keys())){let o=this.lowerNodeStorage.get(n).toStringHelper(e);for(let i of o)r.push(`*/${n}/${i}`)}for(let n of Array.from(this.tlfNodeStorage.keys())){let o=this.tlfNodeStorage.get(n).toStringHelper(e);for(let i of o)r.push(`[TLF]/${n}/${i}`)}return r}_getFirstNodeName(e){return e.length==1?e[0].toStringWithPrefix(!0):AO.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},kr;(l=>{function t(){l._cachedNodePaths.clear()}l.clearCachedNodePaths=t;function e(c){if(c==null)return[];if(l._cachedNodePaths.has(c.uniqueIdentifier()))return l._cachedNodePaths.get(c.uniqueIdentifier());let d=c.getSemanticNodePath();return l._cachedNodePaths.set(c.uniqueIdentifier(),d),d}l.getSemanticNodePath=e;function r(c){return c=="FRAME"||c=="INSTANCE"||c=="SYMBOL"||c=="SLIDE"}l._isValidTLFType=r;function n(c){return c.isTopLevel()&&r(c.type())}l._isValidSemanticTLF=n;function o(c){if(c.isTopLevel()&&!r(c.type()))return[];let d=[],u=!0;for(let p=c.clone();u&&p!=null;p=p.parent())d.splice(0,0,new Kl(p.name(),i(p))),n(p)&&(u=!1);return d}l.getSemanticNodePathHelper=o;function i(c){var _;if(n(c)||c.parent()==null)return 0;let d=(_=c.parent())==null?void 0:_.clone();if(d==null)return 0;let u=[],p=d.childCount();for(let h=0;h<p;h=h+1){let g=d.clone();g.moveToChildAt(h),g.name()==c.name()&&u.push(g.uniqueIdentifier())}return u.indexOf(c.uniqueIdentifier())}l.getRelativeChildIndex=i,l.DEFAULT_STORAGE_KEY="storage_key",l._cachedNodePaths=new Map})(kr||(kr={}));var yL;(l=>{function t(c){return c}l.SSTDataCache_asMap=t;function e(c){return Array.from(c.keys())}l.SSTDataCache_keys=e;function r(c,d){return c.has(d)}l.SSTDataCache_has=r;function n(c){return c.size}l.SSTDataCache_size=n;function o(c,d){c.delete(d)}l.remove=o;function i(c,d){return c.get(d)}l.SSTDataCache_get=i;function a(c,d,u){c.set(d,u)}l.SSTDataCache_set=a;function s(c,d){c.forEach(d)}l.SSTDataCache_forEach=s})(yL||(yL={}));var AO;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(AO||(AO={}));var gt=class t{constructor(e,r=null){this.node=e,this._overlayRenderData=r,this._bindingsConverter=new Wl(this)}clone(){return new t(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":return xr.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"CODE_INSTANCE":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":case"MODULE":case"SLIDE_GRID":case"SLIDE_ROW":case"JSX":return xr.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":case"INTERACTIVE_SLIDE_ELEMENT":return xr.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":case"TEXT_PATH":return xr.RenderableContentType.RENDERABLE_TEXT;case"TRANSFORM":return xr.RenderableContentType.TRANSFORM}return xe("Unhandled scene node type while getting cursor renderable content type"),xr.RenderableContentType.NON_RENDERABLE}isFrameLike(){return er.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}isBrushInstanceType(e){return this.node.isBrushInstanceType(e)}getStrokeBrush(){return this.node.strokeBrush()}getStrokeBrushCursor(){var e=this.node.strokeBrush();return e==null?null:new t(e,null)}getScatterBrushInstanceTransforms(){return this.node.getScatterBrushInstanceTransforms()}hasScatterBrushInstanceTransforms(){return this.node.hasScatterBrushInstanceTransforms()}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new t(this.node.parent()):null}blendMode(){return this.node.blendMode()}codeSnapshot(){return this.node.codeSnapshot()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}isMask(){return this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():wt.FrozenAffineTransform_IDENTITY}relativeTransform(){return this.node!=null?this.node.relativeTransform():wt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}isRoundedRect(){return this.node.isRoundedRect()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,r,n){return this.node.fillGeometryForSpread(e,r,n)}strokeGeometryForSpread(e,r,n,o){return this.node.strokeGeometryForSpread(e,r,n,o)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}hasDefaultStrokeParameters(){return this.node.hasDefaultStrokeParameters()}strokeJoin(){return this.node.strokeJoin()}setStrokeJoin(e){this.node.setStrokeJoin(e)}strokeMiterLimit(){return this.node.strokeMiterLimit()}setStrokeMiterLimit(e){this.node.setStrokeMiterLimit(e)}id(){return this.node.id()}uniqueIdentifier(){return this.node.id()}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}derivedTextData(){return this.node.derivedTextData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(e=null){return this.node.renderTree2(this.clone(),e)}renderTreeWithoutBackgroundBlursAndGlassEffects(e=null){return this.node.renderTreeWithoutBackgroundBlursAndGlassEffects(e)}renderTreeWithoutGlassEffects(e=null){return this.node.renderTreeWithoutGlassEffects(e)}renderTreeForShadowRoot(e=null){return this.node.renderTreeForShadowRoot1(e)}renderTreeForShadowDescendant(e=null){return this.node.renderTreeForShadowDescendant1(e)}renderTreeForKnockoutShadowRoot(e=null){return this.node.renderTreeForKnockoutShadowRoot1(e)}renderTreeForKnockoutShadowDescendant(e=null){return this.node.renderTreeForKnockoutShadowDescendant1(e)}renderTreeForSlideThumbnail(e=null){return this.node.renderTreeForSlideThumbnail1(e)}renderTreeWithoutEffects(e=null){return this.node.renderTreeWithoutEffects(e)}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollSpeedMultiplier(){var e,r;return((r=(e=this.node.behaviors())==null?void 0:e.scrollParallax)==null?void 0:r.speed)??1}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}transformModifiers(){return this.node.transformModifiers()}fillPaints(){return this.node.fillPaints()}textDecorationFillPaints(){return this.node.textDecorationFillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return kr.getSemanticNodePathHelper(this)}dependsOnBackgroundContent(){return this.node.dependsOnBackgroundContent()}overlayRenderData(){return this._overlayRenderData}canvasSpaceContentBounds(){return this.node.canvasSpaceContentBounds()}blendModeEncodedNumber(){return this._bindingsConverter.blendModeEncodedNumber()}typeEncodedNumber(){return this._bindingsConverter.typeEncodedNumber()}fillGeometryBindingsRegions(){return this._bindingsConverter.fillGeometryBindingsRegions()}strokeGeometryBindingsRegions(){return this._bindingsConverter.strokeGeometryBindingsRegions()}childAtForBindings(e){return this._bindingsConverter.childAtForBindings(e)}parentForBindings(){return this._bindingsConverter.parentForBindings()}sizeVectorF(){return this._bindingsConverter.sizeVectorF()}maskTypeEncodedNumber(){return this._bindingsConverter.maskTypeEncodedNumber()}strokeAlignEncodedNumber(){return this._bindingsConverter.strokeAlignEncodedNumber()}absoluteTransformForBindings(){return this._bindingsConverter.absoluteTransformForBindings()}relativeTransformForBindings(){return this._bindingsConverter.relativeTransformForBindings()}absoluteBoundsRectD(){return this._bindingsConverter.absoluteBoundsRectD()}relativeBoundsRectD(){return this._bindingsConverter.relativeBoundsRectD()}canvasSpaceRenderedBoundsRectF(){return this._bindingsConverter.canvasSpaceRenderedBoundsRectF()}sceneNodeRenderTreeCacheKey(){return this.node.handle()}};var Qc=class t extends gt{constructor(e,r=null,n=null,o=null,i=null){super(e,r),this._icRoot=e,this._enteringICNode=o,this._exitingICNode=i,this._icFramePairTransition=n}clone(){let e=new t(this.node,this.overlayRenderData(),this._icFramePairTransition,this._enteringICNode,this._exitingICNode);return e._icRoot=this._icRoot,e}moveToChildAt(e){let r=this.node.childAt2(e,!0);r!=null&&this._enteringICNode!=null&&r.id()==this._enteringICNode.id()?this.node=this._exitingICNode:this.node=r}moveToParent(){this._enteringICNode!=null&&this._exitingICNode!=null&&this._enteringICNode.parent()!=null&&this.node.id()==this._exitingICNode.id()?this.node=this._enteringICNode.parent():this.node=this.node.parent()}isRoot(){return this._enteringICNode!=null&&this._exitingICNode!=null&&this.node.id()==this._exitingICNode.id()?this._enteringICNode.parent()==null:this.node.parent()==null}indexInParent(){return this._enteringICNode!=null&&this._exitingICNode!=null&&this.node.id()==this._exitingICNode.id()?this._enteringICNode.indexInParent():this.node.indexInParent()}parent(){let e=this.clone();return e.moveToParent(),e.node==null?null:e}icFramePairTransition(){return this._icFramePairTransition}icRoot(){return this._icRoot}};var I_;(be=>{let t;(W=>(W[W.FOR_BACKGROUND_BLUR=0]="FOR_BACKGROUND_BLUR",W[W.FOR_GLASS=1]="FOR_GLASS"))(t=be.BackgroundContentType||(be.BackgroundContentType={}));function e(x,M,W){if(W!=null){let te=x.getCachedRenderTree();if(te!=null&&(te.value==null||!W.overlaps(te.value.maxBounds)))return null}let Z=null;switch(M.mode){case 0:{Z=x.renderTree(M.visitedNodes);break}case 2:{Z=x.renderTreeWithoutBackgroundBlursAndGlassEffects(M.visitedNodes);break}case 3:{Z=x.renderTreeWithoutGlassEffects(M.visitedNodes);break}case 1:{Z=M.shadowOwnerID==x.uniqueIdentifier()?x.renderTreeForShadowRoot(M.visitedNodes):x.renderTreeForShadowDescendant(M.visitedNodes);break}case 4:{Z=M.shadowOwnerID==x.uniqueIdentifier()?x.renderTreeForKnockoutShadowRoot(M.visitedNodes):x.renderTreeForKnockoutShadowDescendant(M.visitedNodes);break}case 5:{Z=x.renderTreeForSlideThumbnail(M.visitedNodes);break}case 6:{Z=x.renderTreeWithoutEffects(M.visitedNodes);break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${zl[M.mode]}`)}return W!=null&&(Z==null||!W.overlaps(Z.maxBounds))?null:Z}be._generateRenderTreeForChild=e;function r(x){return x.scrollDirection()!="NONE"&&x.hasOverflowingContentInScrollDirection()}be._nodeCanScroll=r;function n(x,M,W){return U.useBackgroundBlurOpts()?W==null?!0:W.hasVolatileContent()?!1:!E(x,M):!1}be._canSkipWrappingInVolatileTransforms=n;function o(x,M,W){if(x.isRoot())return M;if(W||(M=B(M,x)),x instanceof Qc){let Y=x;Y.icRoot().id()==Y.uniqueIdentifier()&&Y.icFramePairTransition()!=null&&(M=M!=null?Y.icFramePairTransition()(M):null)}let Z=x.clone(),te=x.indexInParent();if(x.moveToParent(),(r(x)||Z.isStickyScrolling())&&te<s(x)){let Y=x.clone(),re=Pt.forScrollOffset(x.uniqueIdentifier());M=M!=null?mt.forTranslation(M,re,()=>Wa.getScrollTranslationOfNodeRelativeToParent(Z).negative()):null}return M=o(x,M,!1),x.moveToChildAt(te),M}be._wrapInVolatileTransformsForAncestors=o;function i(x,M,W,Z,te,Y){return a(x,M,W,Z,te,Y)}be._generateChildrenWithMasking=i;function a(x,M,W,Z,te,Y){let re=r(x),se=M.clone(),oe=x.clone(),de=re?oe:null,ue=[],Ne=[],Te=W,ve=Z;for(;Te<ve;){x.moveToChildAt(Te++);let Ue=ue.length==0||!le.List_last(ue).isStandardScrolling(),Qe=ue.length==0?null:le.List_last(ue).scrollSpeedMultiplier,De=x.parent()!=null&&x.isStickyScrolling(),Je=de!=null&&x.isFixed(),ir=!De&&!Je,Yt=U.getFeatureFlags().prototype_parallax_scroll?x.scrollSpeedMultiplier():1;De?(ue.push(new on("STICKY_SCROLLS",Yt)),le.List_last(ue).scrollingSceneNode=x.clone()):ir&&(Ue||Qe!=Yt)&&(ue.push(new on("SCROLLS",Yt)),le.List_last(ue).scrollingSceneNode=x.clone());let sn=Je?Ne:le.List_last(ue).nodes,Ra=de==null||x.isFixed()?te:null;if(!x.isVisibleMask()){let Za=e(x,se,Ra);Za!=null&&sn.push(Za),x.moveToParent();continue}let ni=x.maskType(),NA=se.clone(),qu=e(x,NA,Ra),Rs=[];x.moveToParent();let PA=s(x);for(;Te<ve;){if(x.moveToChildAt(Te),x.stopsMaskPropagation()||Te==PA){x.moveToParent();break}if(qu!=null){let Za=e(x,se,Ra);Za!=null&&Rs.push(Za)}Te=Te+1,x.moveToParent()}qu!=null&&Rs.length!=0&&(Y==0&&Te==ve?sn.push(Le.wrap(Rs)):ni=="LUMINANCE"?sn.push(In.createForLuminanceMask(qu,Le.wrap(Rs))):sn.push(new In(qu,Le.wrap(Rs))))}let Ge=ue.filter(Ue=>Ue.nodes.length!=0),ot=Pt.forScrollOffset(x.uniqueIdentifier()),we=[];for(let Ue=0;Ue<Ge.length;Ue=Ue+1){let Qe=Ge[Ue],De=Qe.scrollSpeedMultiplier;if(Qe.isStandardScrolling()){let Je=Qe.scrollingSceneNode;if(de!=null||De!=1){let Yt=Ue>0&&Ge[Ue-1].isStickyScrolling(),sn=Le.wrap(Qe.nodes).optimized();!Yt&&sn!=null&&(sn=l(oe,sn)),sn!=null&&we.push(mt.forTranslation(sn,ot,()=>Wa.getScrollTranslationOfNodeRelativeToParent(Je).negative()))}else ln(we,Qe.nodes)}else if(Qe.isStickyScrolling()){Qe.nodes.length==1,Qe.scrollingSceneNode;let Je=Qe.scrollingSceneNode,ir=Qe.nodes[0],Yt=mt.forTranslation(ir,ot,()=>Wa.getScrollTranslationOfNodeRelativeToParent(Je).negative());we.push(Yt)}}if(Ne.length!=0){let Ue=Le.wrap(Ne).optimized();Ue!=null&&we.push(Ue)}return new Le(we).optimized()}be._generateChildrenWithMaskingNew=a;function s(x){for(let M=x.childCount()-1;M>=0;M=M-1){if(x.moveToChildAt(M),!x.isFixed())return x.moveToParent(),M+1;x.moveToParent()}return 0}be._indexOfFirstValidFixedChild=s;function l(x,M){if(M.hasAnimatingMedia()||M.hasVolatileContent()||M.dependsOnBackgroundContent()||!M.hasNonIsolatedBlends())return M;let W=Ce.firstPaintIfSolidAndOpaqueOrNull(x.fillPaintsToRender());return W==null?M:Le.wrapWithSolidBackground(M,W.color())}be._wrapScrollingContentWithSolidBackground=l;function c(x,M,W,Z,te,Y,re,se){if(x.parent()==null)return null;let oe=x.indexInParent();x.moveToParent();let de=d(x,M,W,Z,te,oe,Y,re,se);return x.moveToChildAt(oe),de}be._generateBackground=c;function d(x,M,W,Z,te,Y,re,se,oe){let de;switch(se){case 1:de=new or(3,oe);break;case 0:de=new or(2,oe);break}oe!=null&&oe.delete(x.uniqueIdentifier());let ue=i(x,de,0,Y,M,0);if(W!=null){let ve=x.clone();if(ve.moveToChildAt(Y),(r(x)||ve.isStickyScrolling())&&Y<s(x)){let Ge=x.clone(),ot=Pt.forScrollOffset(Ge.uniqueIdentifier());W=mt.forTranslation(W,ot,()=>Wa.getScrollTranslationOfNodeRelativeToParent(ve).negative())}ue==null?ue=W:ue=Le.wrap([ue,W]).optimized()}ue=q(ue,x.clone(),de,1,Z,!0);let Ne=!1;x.isFrameLike()&&x.clipsChildren()&&(Ne=Ce.containsAtLeastOneVisibleOpaquePaint(x.fillPaintsToRender()));let Te=U.getViewerMode()==U.ViewerMode.PROTOTYPE&&x.isTopLevel();if(!x.isRoot()&&!Ne&&!Te)ue=c(x,M,ue,Z,te,re,se,oe);else{let ve=!re&&!n(te,x,ue);ve&&(ue=o(x,ue,!0)),ue!=null&&(ue=new Le([ue,T(te,new or(2,oe),void 0,!1,!0)]),C(te)&&ve&&(ue=mt.forInverseTransform(ue)))}return ue}be._generateBackgroundFromParent=d;function u(x,M,W,Z){let te=null;switch(M){case 1:{te=x.renderTreeForShadowRoot(Z);break}case 4:{te=x.renderTreeForKnockoutShadowRoot(Z);break}default:throw new Error(`Unhandled shadow mode: ${zl[M]}`)}if(te!=null&&W!=null){if(x.shouldOptimizeShadowForAnimation(W)){let Y=x.clone(),re=Y.absoluteTransform(),se=re.inverse();te=mt.forTransform(te,Pt.forShadowTransformation(Y.uniqueIdentifier()),()=>{let oe=Y.absoluteTransform(),de=oe.inverse();de.multiply(Q.new2().translatedBy1(W)),de.multiply(oe);let ue=Q.new2();return ue.multiply(re),ue.multiply(de),ue.multiply(se),ue})}else{let Y=Q.translated(W.x(),W.y());te=new so(te,Y)}te=te.optimized()}return te}be._generateRenderTreeForShadow=u;function p(x,M,W){if(M.effects()!=null)for(let Z=0,te=M.effects().length;Z<te;Z=Z+1){let Y=M.effects()[Z];if(Y.type()!="INNER_SHADOW"||!Y.isVisibleForRendering())continue;let re=u(M,1,null,W);if(re!=null){let se=u(M,1,Y.blurOffset(),W);if(se==null)se=new Le([]);else{if(Y.spread()!=0&&(se=S(se,-Y.spread(),M,Y.type()),se==null))continue;se=new fi(se,N.BLACK)}re=new fi(re,N.BLACK);let oe=In.createForInnerShadow(re,Yn.createForStandardBlur(Y.blurRadius(),se,L.INVALID),Y.color());oe=new Fo(Y.blendMode(),1,oe),x!=null?x=new mi(new Le([x,oe])):x=oe}}return x}be._wrapWithInnerShadows=p;function _(x){let M=x.renderableContentType();if(M!=xr.RenderableContentType.RENDERABLE_GEOMETRY&&M!=xr.RenderableContentType.RENDERABLE_TEXT&&M!=xr.RenderableContentType.RENDERABLE_GROUP||M==xr.RenderableContentType.RENDERABLE_GROUP&&x.childCount()>0&&!x.clipsChildren())return!1;let W=x.fillPaints(),Z=x.strokePaints(),te=x.fillGeometry(),Y=te!=null&&te.regions.length!=0,re=x.strokeGeometry(),se=re!=null&&re.regions.length!=0,oe=Y&&W!=null&&Ce.containsAtLeastOneVisibleOpaquePaint(W),de=!se||Z==null||Ce.containsAtLeastOneVisibleOpaquePaint(Z);if(M==xr.RenderableContentType.RENDERABLE_TEXT){let Ne=x.textData().styleOverrideTable().styleByID2();for(let Te of Array.from(Ne.keys())){let ve=Ne.get(Te),Ge=Nr.get(ve,24,null);if(Ge!=null&&!Ce.containsAtLeastOneVisibleOpaquePaint(pt.asPaintData(Ge))){oe=!1;break}}}return oe&&(de||x.strokeAlign()=="INSIDE")}be._hasOpaqueGeometry=_;function h(x,M,W,Z,te,Y){if(!M.isForShadows()||x.strokeAlign()!="OUTSIDE"&&x.strokeAlign()!="CENTER"||!Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(Z)||!Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(W)||!x.hasDefaultStrokeParameters())return null;let re=x.effects();if(!re)return null;for(let Je=0;Je<re.length;Je++)if(re[Je].type()!="DROP_SHADOW"&&re[Je].isVisibleForRendering())return null;let se=te.length==1&&te[0].path().isRect(),oe=!1,de=null;if(!se&&(x.isRoundedRect()&&(de=x.roundedRectInfo(),oe=(de&&de.isSimpleRoundedRect())??!1),!oe))return null;let ue=x.strokeAlign()=="OUTSIDE"?2:1,Ne=x.strokeAlign()=="OUTSIDE"?1:.5,Te=x.strokeWeight()*ue,ve=x.strokeWeight()*Ne,Ge=x.size().withOnesForZeros().addScalar(Te),ot=new L(-Te/2,-Te/2,Ge.x(),Ge.y()),we=de&&de.nodeRadius()>0?de.nodeRadius()+ve:de&&de.vertexRadii().length>0?de.vertexRadii()[0]+ve:0,Ue=null;if(se)Ue=new Gt(At.fromRect(ot),"NONZERO");else{let Je=new Na(1,ot.topLeft(),ot.size(),[we,we,we,we],0);Ue=new Gt(At.fromRoundedRect(Je),"NONZERO")}let Qe=[];Qe.push(new Kt(Ue,W));let De=[];return nt(Y,Qe,x.size(),De,M),Le.wrap(De)}be.attemptToReplaceStrokeWithExpandedFillForDropShadow=h;function g(x,M,W,Z,te,Y){let re=M.getStrokeBrushCursor(),se=M.getScatterBrushInstanceTransforms(),oe=[];Dt(oe,re,0,Z,M.uniqueIdentifier(),W,1),ae(x,oe,se,te,Y,W)}be._generateFrameScatterBrushes=g;function m(x,M){let W=x.isInsideOutlineMask(),Z=[],te=[],Y=null,re=j(M,x,0),se=j(M,x,1),oe=j(M,x,2);if(x.renderableContentType()==xr.RenderableContentType.RENDERABLE_TEXT)qt(Z,x,re,oe,x.scene(),W,M);else{let De=M.mode==4?0:1;Dt(Z,x,0,re,x.uniqueIdentifier(),M,De)}let ue=x.isBrushInstanceType(ic.SCATTER)&&x.hasScatterBrushInstanceTransforms(),Ne=[],Te=[];Dt(te,x,1,se,x.uniqueIdentifier(),M,1);let ve=x.size().withOnesForZeros(),Ge=x.strokeAlign();if(ue){let De=x.getStrokeBrushCursor();Te=x.getScatterBrushInstanceTransforms();let Je=M.mode==4?0:1;Dt(Ne,De,0,se,x.uniqueIdentifier(),M,Je)}M.isForShadows()&&Ge=="INSIDE"&&br(Z)&&br(te)&&(te.length=0);let ot=x.effects(),we=x.absoluteTransform();if(U.useFastStrokeShadow()&&!ue){let De=h(x,M,re,se,Z,we);if(De)return new an(De,Y)}if(kt(Z)&&kt(te)&&!M.isForShadows()&&Wt(ot)&&!(Sd&&Zt(ot,"FOREGROUND_BLUR")&&Zt(ot,"INNER_SHADOW"))){let De=[],Je=[];nt(we,Z,ve,De,M);let ir=p(Le.wrap(De),x,M.visitedNodes);return Y=new fe(2),Je.push(ir),ue?ae(we,Ne,Te,ve,Je,M):Ge=="CENTER"?nt(we,te,ve,Je,M):st(Ge,we,Z,te,ve,Je,M),new an(Le.wrap(Je),Y)}if(Ge=="CENTER"||Z.length==0||ue){let De=[];return nt(we,Z,ve,De,M),ue?ae(we,Ne,Te,ve,De,M):nt(we,te,ve,De,M),new an(Le.wrap(De),Y)}if(re!=null&&se!=null&&(Ce.isIsolated(re)&&Ce.isIsolated(se)||M.isForShadows())&&te.length!=0){let De=[],Je=[],ir=[];for(let ni of Z)Ce.isEmojiPaint(ni.paints)?De.push(ni):(Ce.containsPatternPaint(ni.paints)&&Je.push(ni),ir.push(ni));let Yt=[],sn=[];for(let ni of te)Ce.containsPatternPaint(ni.paints)?sn.push(ni):Yt.push(ni);let Ra=[];return nt(we,De,ve,Ra,M),nt(we,Je,ve,Ra,M),Ra.push(new Kd(we,ir,Yt,ve,Ge=="INSIDE"?0:1)),sn.length>0&&st(Ge,we,Z,sn,ve,Ra,M),new an(Le.wrap(Ra),Y)}let Qe=[];return nt(we,Z,ve,Qe,M),st(Ge,we,Z,te,ve,Qe,M),new an(Le.wrap(Qe),Y)}be._generateRenderTreeForGeometry=m;function A(x,M){let W=M.visitedNodes;if(W!=null){if(U.getFeatureFlags().viewer_pattern_fill_cycle_stop&&W.has(x.uniqueIdentifier()))return console.warn("cycle detected while generating render tree for node",x.uniqueIdentifier()),null;W.add(x.uniqueIdentifier())}if(!x.visible()||x.opacity()<=0&&!(2&x.willChange()))return null;let Z=(()=>{let te=null,Y=0;switch(x.renderableContentType()){case xr.RenderableContentType.NON_RENDERABLE:return null;case xr.RenderableContentType.RENDERABLE_GEOMETRY:case xr.RenderableContentType.RENDERABLE_TEXT:{if(x.type()=="INTERACTIVE_SLIDE_ELEMENT"&&M.mode!=5)return null;let re=m(x,M);te=re.node,re.layerWrap!=null&&(Y=re.layerWrap.value);break}case xr.RenderableContentType.TRANSFORM:case xr.RenderableContentType.RENDERABLE_GROUP:{!(M.isForShadows()&&x.clipsChildren()&&Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(x.fillPaintsToRender()))&&(te=i(x,M,0,x.childCount(),null,1)),x.renderableContentType()==xr.RenderableContentType.TRANSFORM&&(te=vi(te,x));break}case xr.RenderableContentType.CUSTOM_RENDER_TREE:{Y=2,te=x.customRenderTree(M);break}}return q(te,x,M,Y,0)})();return W!=null&&W.delete(x.uniqueIdentifier()),Z}be.generateRenderTree=A;function S(x,M,W,Z){var Ue,Qe;if(!W.isSpreadEligibleNode())return x;if(x.op()==10){let De=x,Je=S(De.child,M,W,Z);return Je==null?null:new mt(Je,De.id,De.property,De.getter)}else if(x.op()==11){let De=x,Je=S(De.child,M,W,Z);return Je==null?null:new so(Je,De.transform)}else if(x.op()==2){let Je=S(x.child,M,W,Z);return Je==null?null:new mi(Je)}else if(x.op()==12){let De=x,Je=De.startChild!=null?S(De.startChild,M,W,Z):null,ir=De.endChild!=null?S(De.endChild,M,W,Z):null;return Je!=null||ir!=null?new Qn(Je,ir,De.id,De.progressFn):null}let te=W.fillGeometry()!=null&&((Ue=W.fillGeometry())==null?void 0:Ue.regions.length)!=0&&Ce.containsAtLeastOneVisiblePaint(W.fillPaints()),Y=W.strokeGeometry()!=null&&((Qe=W.strokeGeometry())==null?void 0:Qe.regions.length)!=0&&Ce.containsAtLeastOneVisiblePaint(W.strokePaints()),re=te&&!Y,se=!te&&Y,oe=null,de=x,ue=()=>{Re.trackEvent("unexpected_spread_shadow_node",{sceneNode:W.paintsDebugString(),renderNode:x.debugString1()})};for(;oe==null&&de!=null;)switch(de.op()){case 3:case 4:case 16:{oe=de;break}case 5:{de=de.alpha;break}case 7:{de=de.child;break}case 1:{let De=null;Vr.visitEachNodeInTree(de,Je=>{var ir,Yt;(Je.op()==3||Je.op()==4||Je.op()===16)&&(De==null||(((ir=Vr.geometryNodePaintSize(Je))==null?void 0:ir.area())??0)>(((Yt=Vr.geometryNodePaintSize(De))==null?void 0:Yt.area())??0))&&(De=Je)},null),de=De;break}case 0:{de=de.child,ue();break}case 9:{de=de.alpha,ue();break}case 6:{de=de.child,ue();break}case 14:{de=de.child,ue();break}default:return ue(),xe("Unexpected wrapped node for spread shadow"),x}if(oe==null||oe.op()!=3&&oe.op()!=4&&oe.op()!=16)return xe(`Failed to find geometryNode after search; got ${_n[(oe==null?void 0:oe.op())??0]}`),x;let Ne=null,Te=null,ve=null;switch(oe.op()){case 3:{let De=oe;Ne=Te=De.paintSize,ve=De.transform;break}case 4:{let De=oe;Ne=Te=De.paintSize,ve=De.transform;break}case 16:{let De=oe;Ne=Te=De.paintSize,ve=De.transform;break}default:return xe(`Unexpected node type ${_n[oe.op()]}`),x}if(Y&&W.strokeAlign()!="INSIDE"){let De=W.strokeAlign()=="OUTSIDE"?2:1;Ne=Ne.addScalar(W.strokeWeight()*De)}if(Z=="DROP_SHADOW"){if(Ne.x()<=-(2*M)||Ne.y()<=-(2*M))return null}else Z=="INNER_SHADOW"&&(M=Math.max(M,-Math.min(Ne.x(),Ne.y())/2));let Ge=Te.addScalar(2*M),ot=Ge.divide(Te),we=Q.new2().translatedBy2(-M,-M).scaledBy1(ot);if(re){let De=W.fillGeometryForSpread(we,M,Ce.SOLID_BLACK);return De==null?null:new Xr(ve,De,Ge)}else if(se){let De=W.strokeGeometryForSpread(we,M,Te,Ce.SOLID_BLACK);if(De==null){if(Z=="DROP_SHADOW")return null;De=new Kt(new Gt(At.fromRect(ar.FrozenRect_EMPTY),"NONZERO"),Ce.SOLID_BLACK)}return new Xr(ve,De,Ge)}else{let De=W.strokeGeometryForSpread(we,M,Te,Ce.SOLID_BLACK);return De==null?null:new Xr(ve,De,Ge)}}be._blurChildWithSpread=S;function T(x,M,W,Z=!1,te=!1){let Y=[],re=x.effects(),se=te&&re.filter(oe=>oe.dependsOnBackgroundContent()&&oe.isVisibleForRendering()).length>0;for(let oe=0;oe<re.length;oe=oe+1){let de=re[oe];if(de.type()=="DROP_SHADOW"&&de.isVisibleForRendering()){if(M.mode==2&&!de.showShadowBehindNode()&&(se||Z))continue;let ue=u(x,1,de.blurOffset(),M.visitedNodes);if(ue!=null){if(de.spread()!=0&&(ue=S(ue,de.spread(),x,de.type()),ue==null))continue;let Ne=new fi(ue,de.color()),Te=null,ve=Ne.optimized();if(ve!=null&&(Te=Yn.createForStandardBlur(de.blurRadius(),new mi(ve),L.INVALID)),Te!=null){if(W&&(Te=G(x,W,Te,!1)),!de.showShadowBehindNode()&&!_(x)){let Ge=u(x,4,null,M.visitedNodes);Te=Ge!=null&&Te!=null?new mi(In.createForKnockoutShadow(Ge,Te)):null}Te=Te!=null?new Fo(de.blendMode(),1,Te):null,Te!=null&&Y.push(Te)}}}}return new Le(Y)}be._dropShadowsForNode=T;function R(x){let M=x.parent();if(M==null)return x.absoluteTransform();let W=M.absoluteTransform().clone();return W.invert()?(W.multiply(x.absoluteTransform()),W):Q.new2()}be._transformRelativeToParent=R;function b(x,M,W,Z,te){x.push(new Uc(()=>Gt.getOrCreate(At.fromRect(L.fromRect(te.path().asRoundedRectPath().rect()).expandedBy1(W)),"ODD"),Z,te.bounds(),M.uniqueIdentifier()))}function O(x,M,W,Z,te,Y){var ve,Ge,ot;let re=M.size(),se=Z>0&&M.clipsChildren()&&W!=0,oe=null,de=null,ue=j(Y,M,0);Y.isForShadows()&&Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(ue)&&(ue=ke(1)),Ce.forEachPaintWithVideo(ue,we=>{let Ue=we.video().getVideoManager();Ue!=null&&Ue.associatePaintWithNode(we,M)});let Ne=M.absoluteTransform(),Te=[];if(se){oe=Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,re).expandedBy1(Z)),"ODD");let we=Ce.isolatedPaints(ue);for(let Ue=0,Qe=we.length;Ue<Qe;Ue=Ue+1){let De=M.fillGeometry();((Ge=(ve=De==null?void 0:De.regions)==null?void 0:ve[0])==null?void 0:Ge.type)==1?b(te,M,Z,we[Ue],De.regions[0]):te.push(new Kt(oe,we[Ue]))}}else if(M.fillGeometry()!=null&&((ot=M.fillGeometry())==null?void 0:ot.regions.length)!=0)Dt(te,M,0,ue,M.uniqueIdentifier(),Y,1);else if(at(0,M)){de=Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,re)),"ODD");let we=Ce.isolatedPaints(ue);for(let Ue=0,Qe=we.length;Ue<Qe;Ue=Ue+1)te.push(new Kt(de,we[Ue]))}if(nt(Ne,te,re,Te,Y,Z),!M.clipsChildren()){let we=[],Qe=M.isBrushInstanceType(ic.SCATTER)&&M.hasScatterBrushInstanceTransforms(),De=j(Y,M,1);Dt(we,M,1,De,M.uniqueIdentifier(),Y,1),Qe?g(Ne,M,Y,De,re,Te):M.strokeAlign()=="CENTER"||te.length==0?nt(Ne,we,re,Te,Y):st(M.strokeAlign(),Ne,te,we,re,Te,Y)}return x!=null&&Te.push(x),x=Le.wrap(Te),x}be._wrapTreeWithFrameFillPaints=O;function f(x,M,W,Z){let te=M.codeSnapshot();if(!te)return x;let{paints:Y,offset:re,layoutSize:se,canvasSize:oe}=te;if(!Y||Y.length===0||!re||!se)return x;let de=[],ue=j(Z,M,3),Ne=ue[0].asSinglePaint(),Te=oe;(!Te||Te.isZero())&&(Te=Ae.FrozenVector_new4(Ne.originalImageWidth()/devicePixelRatio,Ne.originalImageHeight()/devicePixelRatio));let ve=L.new4(re,Te),Ge=Gt.getOrCreate(At.fromRect(ve),"ODD"),ot=Ce.isolatedPaints(ue);for(let Qe=0,De=ot.length;Qe<De;Qe=Qe+1)W.push(new Kt(Ge,ot[Qe]));let we=Q.new3(M.absoluteTransform());we.translatedBy1(ve.topLeft()).translatedBy1(M.size().divideScalar(2).subtract(se.divideScalar(2)));let Ue=wt.FrozenAffineTransform_new3(we);if(nt(Ue,W,Te,de,Z),x!=null&&de.push(x),x=Le.wrap(de),M.clipsChildren()){let Qe=new Kt(Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,M.size())),"ODD"),Ce.SOLID_BLACK),De=new Xr(M.absoluteTransform(),Qe,M.size());x=new In(De,x)}return x}be._wrapTreeWithCodeSnapshot=f;function I(x,M,W,Z,te){var ue,Ne,Te;let Y=M.size(),re=Z>0&&M.clipsChildren()&&W!=0,se=null,oe=null,de=M.absoluteTransform();if(re?se=Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,Y).expandedBy1(Z)),"ODD"):oe=Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,Y)),"ODD"),M.clipsChildren()){let ve=[],Ge=[];if(re){if(se!=null){let ot=ke(1),we=M.fillGeometry();((Ne=(ue=we==null?void 0:we.regions)==null?void 0:ue[0])==null?void 0:Ne.type)==1?b(ve,M,Z,ot,we.regions[0]):ve.push(new Kt(se,ot))}}else M.fillGeometry()!=null&&((Te=M.fillGeometry())==null?void 0:Te.regions.length)!=0?Dt(ve,M,0,ke(1),M.uniqueIdentifier(),te,1):oe!=null&&ve.push(new Kt(oe,ke(1)));nt(de,ve,Y,Ge,te,Z),x=new In(Le.wrap(Ge),x)}return x}be._wrapTreeWithFrameMasks=I;function y(x){return x.containerSupportsFillStrokeAndCorners()?x.fillPaints():x.fillPaintsToRender()}be._fillPaintsToRender=y;function P(x,M,W,Z){let te=M.size();if(!te.isZero()){let Y=null,re=M.clipsChildren(),se=y(M);if(Ce.containsAtLeastOneVisiblePaint(se)){let oe=[],de=[],ue=null;W.isForShadows()&&Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(se)?ue=ke(1):ue=Ee(W,se,0),Y=Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,te).expandedBy1(re?Z:0)),"ODD");let Ne=Ce.isolatedPaints(ue);for(let Te=0,ve=Ne.length;Te<ve;Te=Te+1){let Ge=Ne[Te];oe.push(new Kt(Y,Ge))}nt(M.absoluteTransform(),oe,te,de,W),x!=null&&de.push(x),x=Le.wrap(de)}if(x!=null&&re){Y==null&&(Y=Gt.getOrCreate(At.fromRect(L.new4(Ae.FrozenVector_ZERO,te).expandedBy1(Z)),"ODD"));let oe=new Kt(Y,ke(1));x=new In(new Xr(M.absoluteTransform(),oe,te),x)}}return x}be._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=P;function E(x,M){let W=x.clone(),Z=W.parent(),te=!0;for(;W!=null;){if(M!=null&&W.uniqueIdentifier()==M.uniqueIdentifier())return!1;if(1&W.willChange()||W.overlayRenderData()!=null)return!0;if(Z==null||M!=null&&Z.uniqueIdentifier()==M.uniqueIdentifier())return!1;if(!te){let Y=W.indexInParent();if(r(Z)&&Y<s(Z))return!0}te=!1,W=Z,Z=Z.parent()}return!1}be._hasVolatileTransformOnAncestor=E;function C(x){return U.useBackgroundBlurOpts()?E(x,null):!0}be._needInverseTransform=C;function B(x,M){if(1&M.willChange()){let W=wt.FrozenAffineTransform_IDENTITY,Z=M.parent();Z!=null&&(W=Z.absoluteTransform());let te=M.absoluteTransform().clone(),Y=te.invert(),re=M.clone();x=x!=null?mt.forTransform(x,Pt.forAnimateableTranslation(M.uniqueIdentifier()),()=>{let oe=Q.new2();return oe.multiply(W),oe.multiply(R(re)),oe.multiply(te),oe}):null;let se=M.maxTransformScale();se!=1&&(x=x!=null?mt.forMaxTransformScale(se,x):null)}return x}be._wrapTreeInVolatileTransform=B;function G(x,M,W,Z){if(W==null)return null;let te=null;if(M.isVolatile()){let Y=M,re=Y.from(),se=Y.to();te=cs.forGrain(W,Pt.forAnimateableEffect(x.uniqueIdentifier()),()=>[Y.blurRadius()],()=>[Y.noiseSize().x()],()=>[Y.centerPoint()],Math.max(re.blurRadius(),se.blurRadius()),x.absoluteTransform().clone(),Y.seed(),Z??Y.clipToShape())}else te=Yd.createForGrain(M.blurRadius(),M.noiseSize(),Z??M.clipToShape(),W,x.absoluteTransform(),x.size().divideScalar(2),M.seed());return M.noiseSize().x()<=1&&U.getFeatureFlags().viewer_ssaa_sub_pixel_grain&&(te=new mi(te,32)),te}be._generateGrain=G;function V(x,M,W){if(W==null)return null;let Z=null;if(M.isVolatile()){let te=M,Y=te.from(),re=te.to();Z=cs.forNoise(W,Pt.forAnimateableEffect(x.uniqueIdentifier()),te.noiseType(),()=>[te.color(),te.secondaryColor()],()=>[te.density(),te.noiseSize().x()],te.blendMode(),te.seed(),x.absoluteTransform().clone(),()=>[te.centerPoint()])}else{let te=1;M.noiseType()=="MULTITONE"?te=M.effectOpacity():te=N.alphaF(M.color()),Z=Qd.createForNoise(M.noiseType(),M.blendMode(),M.noiseSize(),M.density(),N.new3(N.redF(M.color()),N.greenF(M.color()),N.blueF(M.color()),te),M.secondaryColor(),W,x.absoluteTransform(),x.size().divideScalar(2),M.seed()),M.noiseSize().x()<=1&&U.getFeatureFlags().viewer_ssaa_sub_pixel_noise&&(Z=new mi(Z,32))}return Z}be._generateNoise=V;function D(x,M,W,Z){if(W==null)return null;let te=null;if(M.isVolatile()){let Y=M,re=Y.from(),se=Y.to();if(Y.blurOpType()==="PROGRESSIVE"){let oe=re.blurStartOffset().multiply(Y.fromNodeSize()),de=re.blurEndOffset().multiply(Y.fromNodeSize()),ue=se.blurStartOffset().multiply(Y.toNodeSize()),Ne=se.blurEndOffset().multiply(Y.toNodeSize()),Te=x.absoluteTransform().transformPoint(oe),ve=x.absoluteTransform().transformPoint(de),Ge=x.absoluteTransform().transformPoint(ue),ot=x.absoluteTransform().transformPoint(Ne);te=cs.forProgressiveBlur(W,Pt.forAnimateableEffect(x.uniqueIdentifier()),()=>[Y.blurStartRadius(),Y.blurRadius()],()=>[Y.blurStartOffsetInCanvasSpace(Te,Ge),Y.blurEndOffsetInCanvasSpace(ve,ot)],Z,Math.max(re.blurRadius(),se.blurRadius()))}else Y.blurOpType()==="NORMAL"&&(te=cs.forBlur(W,Pt.forAnimateableEffect(x.uniqueIdentifier()),()=>[Y.blurRadius(),Y.blurRadius()],Z,Math.max(re.blurRadius(),se.blurRadius())))}else if(M.blurOpType()=="PROGRESSIVE"){let Y=M.blurStartOffset().multiply(x.size()),re=M.blurEndOffset().multiply(x.size()),se=x.absoluteTransform().transformPoint(Y),oe=x.absoluteTransform().transformPoint(re);te=Yn.createForProgressiveBlur(M.blurStartRadius(),M.blurRadius(),se,oe,W,Z)}else te=Yn.createForStandardBlur(M.blurRadius(),W,Z);return te}be._generateBlur=D;function w(x,M){var Z;if(x.backgroundAppearance.backgroundType=="NONE")return null;let W=Ve(x.backgroundAppearance,((Z=M.scene().findNode(M.overrideKey()))==null?void 0:Z.canvasSpaceBoundingBox())??null);return W!=null?(x.backgroundTransitionProgress!=null&&(W=mt.forOpacity(W,Pt.OVERLAY_BACKGROUND,x.backgroundTransitionProgress)),mt.forInverseTransform(W)):null}be._generateRenderTreeForOverlayBackground=w;function k(x,M,W,Z,te){let Y=[];for(let re=0,se=x.count();re<se;re=re+1){let oe=x.keys()[re];if(oe==M)break;let de=x.get(oe),ue=de.overlayNode,Ne=w(de,W.clone()),Te=null;switch(Z){case 0:Te=ue.renderTreeWithoutBackgroundBlursAndGlassEffects(te);break;case 1:Te=ue.renderTreeWithoutGlassEffects(te);break}if(Ne!=null&&Y.push(Ne),Te!=null){let ve=de.bounds.center(),Ge=ue.canvasSpaceBoundingBox().center(),ot=ve.subtract(Ge),we=Qe=>()=>Qe,Ue=mt.forInverseTransform(mt.forTranslation(Te,Pt.forOverlayPosition(re),we(ot)));Y.push(Ue)}}return new Le(Y)}be._generateIntermediateOverlays=k;function z(x,M,W,Z,te,Y){let re=L.new2();re.copyFrom(x.bounds);let se=x.baseTlfCursor.clone(),oe=M.overlayRenderData(),de=[],ue=d(se.clone(),re,null,Z,M.clone(),se.childCount(),!1,te,Y.visitedNodes);ue!=null&&de.push(ue);let Ne=k(oe,x.overlayId,se.clone(),te,Y.visitedNodes);Ne!=null&&de.push(Ne);let Te=w(x,se);Te!=null&&de.push(Te);let ve=null;return x.overlayId!=M.uniqueIdentifier()&&(ve=c(M,W,null,Z,M.clone(),!0,te,Y.visitedNodes),ve!=null&&(ve=mt.forInverseTransform(mt.forTranslation(ve,Pt.ENTERING_OVERLAY,()=>(x.transform!=null?x.transform():Ae.FrozenVector_new4(0,0)).add(x.animationTransform!=null?x.animationTransform():Ae.FrozenVector_new4(0,0)))))),ve!=null&&de.push(ve),new Le(de)}be._generateBackgroundForOverlays=z;function H(x,M,W,Z,te){let Y=0;if(Z.type()=="BACKGROUND_BLUR")if(Z.isVolatile()){let se=Z.asVolatileEffect();Y=Math.max(se.from().blurRadius(),se.to().blurRadius())}else Y=Z.blurRadius();else Y=Math.max(Z.blurRadius(),Z.reflectionDistance());let re=u(x,1,null,W.visitedNodes);if(re!=null){let se=null,oe=null;se=L.new2();let de=!x.isFixed(),ue=null;if(de){for(ue=x.parent()!=null?x.parent().clone():null;ue!=null&&!r(ue);)ue=ue.parent();de=ue!=null}let Ne=new vt;if(Ne.include3(re.maxBounds),de&&ue!=null?Ne.include3(ue.canvasSpaceContentBounds()):Ne.include3(re.maxBounds),se.copyFrom(Ne.build()),x.overlayRenderData()!=null){let Te=x.clone(),ve=null,Ge=x.overlayRenderData();for(;Te!=null&&Ge!=null&&(ve=Ge.get(Te.uniqueIdentifier()),ve==null);)Te=Te.parent();if(Te==null||ve==null)return xe("Blurred node with overlay data cannot be found in an overlay"),M;se=L.new2(),se.copyFrom(ve.bounds),oe=z(ve,x.clone(),re.maxBounds,Y,Z.type()=="BACKGROUND_BLUR"?0:1,W)}else oe=c(x,se,null,Y,x.clone(),!1,te,W.visitedNodes);if(oe!=null){let Te=null,ve=vf(re),Ge=ve.op()==3?ve:null;Ge!=null&&Ge.geometry.type==0?Te=Ge.geometryBounds():Te=re.maxBounds;let ot=null;if(Z.type()=="BACKGROUND_BLUR"?ot=D(x,Z,oe,Te):ot=K(x,Z,oe),ot!=null){let we=In.createForBackgroundBlur(re,ot);M=new Le([we,M])}}Z.type()=="BACKGROUND_BLUR"?M=ua.createForBackgroundBlur(M):Z.type()=="GLASS"&&(M=ua.createForGlass(M))}return M}be._generateBackgroundEffect=H;function K(x,M,W){if(W==null)return null;let Z=null,te=x.roundedRectInfo();if(M.isVolatile()){let Y=M.asVolatileEffect(),re=()=>Y.cornerInfo()??Jo.createFromNode(x);Z=cs.forGlass(W,Pt.forAnimateableEffect(x.uniqueIdentifier()),()=>[Y.blurRadius(),Y.refractionIntensity(),Y.refractionDistance(),Y.specularIntensity(),Y.specularAngle(),Y.bevelSize(),Y.chromaticAberration()*vl.CHROMATIC_EXPANSION_FACTOR,Y.reflectionDistance(),Y.textureRadius(),re(),N.TRANSPARENT],()=>[Y.centerPoint()],0,te.cornerSmoothing(),x.absoluteTransform())}else Z=vl.createForGlassEffect(M.blurRadius(),0,M.refractionIntensity(),M.refractionDistance(),M.specularIntensity(),M.specularAngle(),M.bevelSize(),M.chromaticAberration()*vl.CHROMATIC_EXPANSION_FACTOR,M.reflectionDistance(),N.TRANSPARENT,Jo.createFromNode(x),x.absoluteTransform(),x.size().divideScalar(2),W);return Z}be._generateGlass=K;function j(x,M,W){let Z=M.isInsideOutlineMask(),te;switch(W){case 1:te=M.strokePaints();break;case 0:te=M.fillPaints();break;case 3:te=M.codeSnapshot().paints;break;case 2:te=M.textDecorationFillPaints()??M.fillPaints();break;default:throw new Error(`Unknown paint type: ${W}`)}let Y=te!=null&&Ce.containsAtLeastOneVisiblePaint(te);return Z?ke(Y?1:0):Ee(x,te,W)}be._getFinalizedPaintData=j;function q(x,M,W,Z,te,Y=!1){let re=[],se=Z==0&&M.isFrameLike()&&M.containerSupportsFillStrokeAndCorners()&&!M.isGroup()&&M.clipsChildren(),oe=M.isFrameLike()&&!M.size().isZero(),ue=M.isBrushInstanceType(ic.SCATTER)&&M.hasScatterBrushInstanceTransforms(),Ne=M.overlayRenderData()==null&&M.isTopLevel()&&M.isFrameLike()&&Ce.containsAtLeastOneVisibleOpaquePaint(M.fillPaintsToRender())||M.type()==="SLIDE",Te=!M.containerSupportsFillStrokeAndCorners()||M.isGroup(),ve=oe&&!Te;oe&&(Te?x=P(x,M,W,te):x=O(x,M,Z,te,re,W)),er.supportsCodeSnapshot(M.type())&&(x=f(x,M,re,W)),x!=null&&(x=x.optimized());let Ge=W.mode!==6&&!W.isForShadows()&&M.effects()!=null,ot=!1,we=!1,Ue=[];if(Ge)if(x!=null){if(W.mode==0||W.mode==3)for(let Je=0,ir=M.effects().length;Je<ir;Je=Je+1){let Yt=M.effects()[Je];if((Yt.type()=="BACKGROUND_BLUR"||Yt.type()=="GLASS"&&M.isRoundedRect()&&W.mode==0)&&Yt.isVisibleForRendering()){_(M)||(x=H(M,x,W,Yt,Yt.type()=="BACKGROUND_BLUR"?0:1));break}}if((Z==1||Z==0)&&(x=p(x,M,W.visitedNodes)),!Ne){let Je=null;for(let ir=0;ir<M.effects().length;ir++){let Yt=M.effects()[ir];Yt.type()==="GRAIN"&&Yt.isVisibleForRendering()&&Yt.clipToShape()?(ot=!0,Je=Yt):Yt.type()==="NOISE"&&Yt.isVisibleForRendering()&&(we=!0)}ot||we?Ue.push(T(M,W,Je??void 0,Y)):Ue.push(T(M,W,void 0,Y))}}else Ne||Ue.push(T(M,W));if(x==null&&Ue.length==0&&!se)return x;let Qe=se&&M.strokeAlign()=="INSIDE";if(ve&&!Qe&&x!=null&&(x=I(x,M,Z,te,W)),se&&!Et(M,W,re)){let Je=M.absoluteTransform(),ir=[],Yt=j(W,M,1),sn=[];x!=null&&sn.push(x),Dt(ir,M,1,Yt,M.uniqueIdentifier(),W,1),ue?g(Je,M,W,Yt,M.size(),sn):M.strokeAlign()=="CENTER"||re.length==0||Qe?nt(Je,ir,M.size(),sn,W):st(M.strokeAlign(),Je,re,ir,M.size(),sn,W),x=Le.wrap(sn)}else Qe=!1;if(se&&M.strokeAlign()=="OUTSIDE"&&M.clipsChildren()&&x!=null&&(x=mi.thatShouldNotBeUnwrappedInOptimization(x)),ve&&Qe&&x!=null&&(x=I(x,M,Z,te,W)),x==null?(x=new Le(Ue),Ue=[]):!ot&&!we&&(x=new Le([new Le(Ue),x]),Ue=[]),x!=null&&Ge)for(let Je=0,ir=M.effects().length;Je<ir;Je=Je+1){let Yt=M.effects()[Je];Yt.type()=="FOREGROUND_BLUR"&&Yt.isVisibleForRendering()&&(Ue.length!=0&&(x=x!=null?new Le([new Le(Ue),x]):new Le([new Le(Ue)]),Ue=[]),x=D(M,Yt,x,L.INVALID)),Yt.type()==="GRAIN"&&Yt.isVisibleForRendering()&&(Yt.clipToShape()||Ue.length!=0&&(x=x!=null?new Le([new Le(Ue),x]):new Le([new Le(Ue)]),Ue=[]),x=G(M,Yt,x)),Yt.type()==="NOISE"&&Yt.isVisibleForRendering()&&(x=V(M,Yt,x))}if(Ue.length!=0&&(x=x!=null?new Le([new Le(Ue),x]):new Le([new Le(Ue)])),W.isForShadows()&&W.shadowOwnerID==M.uniqueIdentifier())return(x==null?void 0:x.optimized())??null;let De=2&M.willChange()?1:M.opacity();if(x=x!=null?new Fo(M.blendMode(),De,x):null,x=(x==null?void 0:x.optimized())??null,x!=null&&2&M.willChange()){let Je=M.clone();x=new mt(x,Pt.forAnimateableOpacity(Je.uniqueIdentifier()),et.OPACITY,()=>Je.opacity())}return x!=null&&(x=B(x,M)),x}be._wrapTreeWithLayerProperties=q;function J(x){if(x==null)return[];let M=!1;for(let Z=0,te=x.length;Z<te;Z=Z+1){let Y=x[Z].asVolatilePaint();if(Y!=null){if(Y.from().image()!=null&&Y.from().image().isDecoded()||Y.from().imageThumbnail()!=null&&Y.from().imageThumbnail().isDecoded()||Y.to().image()!=null&&Y.to().image().isDecoded()||Y.to().imageThumbnail()!=null&&Y.to().imageThumbnail().isDecoded()){M=!0;break}}else if(x[Z].asSinglePaint()!=null){let re=x[Z].asSinglePaint();if(re.image()!=null&&re.image().isDecoded()||re.imageThumbnail()!=null&&re.imageThumbnail().isDecoded()){M=!0;break}}if(!x[Z].isEnabledAndVisible()){M=!0;break}}if(!M)return x;let W=[];for(let Z=0,te=x.length;Z<te;Z=Z+1){if(!x[Z].isEnabledAndVisible())continue;let Y=x[Z].asVolatilePaint();if(Y!=null){let re=Y.cloneAsVolatilePaint();re.from().setDecodedImageIsReady(re.from().image()!=null&&re.from().image().isDecoded()),re.to().setDecodedImageIsReady(re.to().image()!=null&&re.to().image().isDecoded()),re.from().setDecodedImageThumbnailIsReady(re.from().imageThumbnail()!=null&&re.from().imageThumbnail().isDecoded()),re.to().setDecodedImageThumbnailIsReady(re.to().imageThumbnail()!=null&&re.to().imageThumbnail().isDecoded()),W.push(re)}else if(x[Z].asSinglePaint()!=null){let re=x[Z].asSinglePaint().cloneAsSinglePaint();re.setDecodedImageIsReady(re.image()!=null&&re.image().isDecoded()),re.setDecodedImageThumbnailIsReady(re.imageThumbnail()!=null&&re.imageThumbnail().isDecoded()),W.push(re)}}return W}be._filteredPaintsWithImageAvailability=J;function ie(x,M,W){if(x!=4||W==1&&M.length==0)return M;let Z=[];for(let te=0,Y=M.length;te<Y;te=te+1){let re=M[te];if(re.type()=="IMAGE"||re.type()=="EMOJI"||re.type()=="VIDEO")Z.push(re);else return[$.createSolid(N.BLACK,1)]}return Z.length==0&&Z.push($.SOLID_BLACK),Z}be._filteredPaintsForKnockoutShadow=ie;function Ee(x,M,W){return ie(x.mode,J(M),W)}be._substitutePaintsAsNeeded=Ee;function Ke(x,M,W,Z,te,Y){var oe;if(X.equals(M.overrideKey(),X._new(4e7,2)))return!1;let se=M.strokeGeometry()!=null&&((oe=M.strokeGeometry())==null?void 0:oe.regions.length)!=0&&Ce.containsAtLeastOneVisiblePaint(M.strokePaints());if(Z!=0||se&&!He(M,Y,te))return!1;for(let de of W.regions)if(de.type==1)return!1;switch(M.type()){case"ELLIPSE":{if(M.arcData()==null||Ce.hasEmoji(te))return!1;let de=M.arcData(),ue=de.innerRadius<=0,Ne=de.endingAngle-de.startingAngle,Te=Math.abs(Ne)>2*Math.PI-.001,ve=M.size().withOnesForZeros();if(ue&&Te&&W.regions.length==1&&W.regions[0].type==0){let ot=ve.divideScalar(2),we=new En(ot,ot.x(),ot.y()),Ue=new Gt(we,"NONZERO"),Qe=Ce.isolatedPaints(te);for(let De=0,Je=Qe.length;De<Je;De=De+1){let ir=Qe[De];x.push(new Kt(Ue,ir))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":case"INTERACTIVE_SLIDE_ELEMENT":{let de=M.roundedRectInfo();if(!At.isRoundedRectSupported(de)||de==null)return!1;let ue=At.fromRoundedRect(de),Ne=new Gt(ue,"NONZERO"),Te=Ce.isolatedPaints(te);for(let ve=0,Ge=Te.length;ve<Ge;ve=ve+1){let ot=Te[ve];x.push(new Kt(Ne,ot))}return!0}}return!1}be._attemptToGenerateAAAGeometry=Ke;function Ve(x,M){switch(x.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(M==null)return null;let W=x.backgroundColor;return Xr.solidColorRect(M,W,1)}}throw new Error(`Unhandled backgroundType ${x.backgroundType}`)}be.renderTreeForOverlayBackground=Ve;function at(x,M){if(x==0){let W=M.fillPaints(),Z=M!=null&&M.clipsChildren();return M!=null&&(Z||Ce.containsAtLeastOneVisiblePaint(W)||M.strokeAlign()!="CENTER"&&at(1,M))}else if(x==1){let W=M.strokePaints();return Ce.containsAtLeastOneVisiblePaint(W)&&M.hasNonZeroStrokeWeight()}return!1}be._isGeometryNecessary=at;function Dt(x,M,W,Z,te,Y,re){let se=W==0?M.fillGeometry():M.strokeGeometry();if(W==0&&re==1&&!at(W,M)&&(se=null),se==null||Z==null)return;if(Ce.forEachPaintWithVideo(Z,de=>{let ue=de.video().getVideoManager();ue!=null&&ue.associatePaintWithNode(de,M)}),M.hasPerRegionFillPaints()&&W==0){M.forEachRegionWithFillPaintBatch((de,ue)=>{let Ne=Ce.isolatedPaints(ue);for(let Te=0,ve=Ne.length;Te<ve;Te=Te+1){let Ge=J(Ne[Te]);Ce.forEachPaintWithVideo(Ge,we=>{let Ue=we.video().getVideoManager();Ue!=null&&Ue.associatePaintWithNode(we,M)});let ot=Gt.getOrCreate(de.path(),de.windingRule);x.push(new Kt(ot,Ge))}});return}if(Ke(x,M,se,W,Z,Y))return;let oe=Ce.isolatedPaints(Z);for(let de=0,ue=oe.length;de<ue;de=de+1){let Ne=oe[de],Te=null,ve=()=>{if(Te!=null){let Ge=Te.compilePaths(),ot=Gt.getOrCreate(Ge,Te.windingRule);x.push(new Kt(ot,Ne)),Te=null}};for(let Ge of se.regions)Ge.bounds().isEmpty()||(Ge.type==0?Te!=null&&Te.canAddRegion(Ge)?Te.add(Ge):(ve(),Te=new ri(Ge)):(ve(),x.push(new Uc(()=>new Gt(Ge.path(),Ge.windingRule),Ne,Ge.bounds(),Pt.forDynamicGeometry(te)))));ve()}}be._generateGeometries=Dt;function qt(x,M,W,Z,te,Y,re){Re.perfTimerScope("text-geometry-viewer",Re.ProfileLevel.LOW,()=>{let se=M.textGeometry();if(se==null||W==null)return;let oe=(Ne,Te)=>{var ot;let ve=Dn.getEmojiImageUrl(Ne,Te),Ge=((ot=M.derivedTextData())==null?void 0:ot.usedEmojiImages())??[];for(let we of Ge)if(we.url()==ve){let Ue=new $("EMOJI");return Ue.setOpacity(1),Ue.setBlendMode("NORMAL"),Ue.setImage(we),Ee(re,[Ue],0)}return null},de=Ne=>{var ve;let Te=((ve=se==null?void 0:se.paintOverrides)==null?void 0:ve.get(Ne,te))??null;return Te!=null?Ee(re,Te,0):Ee(re,W,0)},ue=(Ne,Te)=>{let ve=Te.textData();if(!ve)return null;let Ge=ve.styleOverrideTable().styleByID2(),ot=Ge.get(Ne);if(!ot)return null;let we=Nr.get(ot,100,null);if(we!=null)return pt.asPaintData(we);let Ue=Ge!=null?Nr.get(ot,94,null):null,Qe=Ue!=null?te.findStyle(pt.asStyleId(Ue)):null;return Qe!=null&&Qe.styleType()=="TEXT"?Qe.textDecorationFillPaints():null};for(let Ne=0,Te=se.regions.length;Ne<Te;Ne=Ne+1){let ve=se.regions[Ne];if(se.emojiCodepoints[Ne]&&se.emojiCodepoints[Ne].length>0){let we=Gt.getOrCreate(ve.path(),ve.windingRule),Ue=oe(se.emojiCodepoints[Ne],se.emojiImageSet);if(Ue==null)continue;let Qe=se.emojiRotationWidthHeights.get(Ne),De=Qe?Qe[0]:0,Je=Qe?Qe[1]:0,ir=Qe?Qe[2]:0;De!=0?x.push(new Kt(we,Ue,De,new F(Je,ir))):x.push(new Kt(we,Ue));continue}if(se.decorationRegions[Ne]){let we=se.decorationRegions[Ne],Ue=Gt.getOrCreate(we.path(),we.windingRule),Qe=ue(we.styleID,M),De=Qe&&Qe.length>0?Qe:Z.length>0?Z:de(we.styleID);De!=null&&x.push(new Kt(Ue,De))}let Ge=de(ve.styleID);if(Ge==null)continue;for(let we=0,Ue=Ge.length;we<Ue;we=we+1){let Qe=Ge[we].asSinglePaint();(Qe==null?void 0:Qe.video())!=null&&Qe.video().getVideoManager().associatePaintWithNode(Qe,M)}let ot=Ce.isolatedPaints(Ge);for(let we=0,Ue=ot.length;we<Ue;we=we+1){let Qe=ot[we];if(!ve.bounds().isEmpty()){let De=Gt.getOrCreate(ve.path(),ve.windingRule);x.push(new Kt(De,Qe))}}}})}be._generateGeometriesForText=qt;function zt(x,M){return M.length!=0&&M[0].blendMode()!="NORMAL"?new Fo(M[0].blendMode(),1,x):x}be._wrapInBlendIfNecessary=zt;function ae(x,M,W,Z,te,Y){if(M.length==0)return;let re=!1,se=!1;for(let ue=0,Ne=M.length;ue<Ne;ue=ue+1){let Te=M[ue];Ce.containsAtLeastOneVisiblePaint(Te.paints)&&(re=!0),Ce.containsPatternPaint(Te.paints)&&(se=!0)}if(!re)return;let oe=new e_(x,M,Z,W),de=M[0].paints;if(Y.visitedNodes==null&&(Y.visitedNodes=new Set),se){let ue=In.createForPatternScatterFill(oe,Y.visitedNodes);te.push(zt(ue,de))}else te.push(zt(oe,de))}be._generateScatterBrushFills=ae;function nt(x,M,W,Z,te,Y=null){for(let re=0,se=M.length;re<se;re=re+1){let oe=M[re];if(Ce.containsAtLeastOneVisiblePaint(oe.paints)){let de=new Xr(x,oe,W,Y),ue=oe.paints;if(Ce.containsPatternPaint(oe.paints)){te.visitedNodes==null&&(te.visitedNodes=new Set);let Ne=In.createForPatternFill(de,oe.paints[0].asSinglePaint(),te.visitedNodes);Z.push(zt(Ne,ue));continue}Z.push(zt(de,ue))}}}be._generateFills=nt;function Et(x,M,W){if(M.mode!=1||x.strokeAlign()!="INSIDE")return!1;for(let Z=0,te=W.length;Z<te;Z=Z+1){let Y=W[Z];if(Ce.containsAtLeastOneVisibleOpaquePaint(Y.paints))return!0}return!1}be._canSkipInsideStrokesForShadows1=Et;function He(x,M,W){return M.mode!=1||x.strokeAlign()!="INSIDE"?!1:Ce.containsAtLeastOneVisibleOpaquePaint(W)}be._canSkipInsideStrokesForShadows2=He;function st(x,M,W,Z,te,Y,re){let se=[];for(let oe=0,de=W.length;oe<de;oe=oe+1){let ue=W[oe];se.push(new Kt(ue.path(),Ce.EMPTY))}for(let oe=0,de=Z.length;oe<de;oe=oe+1){let ue=Z[oe],Ne=ue.paints,Te=[ue],ve=new Kd(M,se,Te,te,x=="INSIDE"?0:1);if(Ne.length!=0){if(Ce.containsPatternPaint(Ne)){let Ge=new Xr(M,new Kt(ue.path(),Ne),Ae.FrozenVector_ZERO);re.visitedNodes==null&&(re.visitedNodes=new Set);let ot=In.createForPatternStroke(Ge,ve,Ne[0].asSinglePaint(),re.visitedNodes);Y.push(zt(ot,Ne));continue}Y.push(zt(ve,Ne))}}}be._generateFillStrokes=st;function ke(x){return x==1?Ce.SOLID_BLACK:Ce.EMPTY}be._outlineMaskPaintData=ke;function kt(x){for(let M=0,W=x.length;M<W;M=M+1){let Z=x[M];if(Ce.containsAtLeastOneVisiblePaint(Z.paints))return!0}return!1}be._isAnyGeometryVisible=kt;function Zt(x,M){for(let W=0,Z=x.length;W<Z;W=W+1){let te=x[W];if(te.type()==M&&te.isEnabledAndVisible())return!0}return!1}be._hasVisibleEffectsOfType=Zt;function Wt(x){for(let M=0,W=x.length;M<W;M=M+1)if(x[M].isEnabledAndVisible())return!0;return!1}be._hasVisibleEffects=Wt;function br(x){if(x.length!=1)return!1;let M=x[0].paints;return M.length==1&&M[0].type()=="SOLID"}be._isSingleSolidGeometry=br;class on{constructor(M,W){this.nodes=[],this.scrollBehavior=M,this.scrollSpeedMultiplier=W,this.scrollingSceneNode=null}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}be.ContiguousRenderNodes=on;class an{constructor(M,W){this.node=M,this.layerWrap=W}}be.GeometryRenderTreeResult=an;let _o;(Z=>(Z[Z.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",Z[Z.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",Z[Z.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(_o=be.LayerWrap||(be.LayerWrap={}));let Ia;(te=>(te[te.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",te[te.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA",te[te.TEXT_DECORATION_FILL_PAINT_DATA=2]="TEXT_DECORATION_FILL_PAINT_DATA",te[te.CODE_SNAPSHOT_PAINT_DATA=3]="CODE_SNAPSHOT_PAINT_DATA"))(Ia=be.PaintType||(be.PaintType={}));class vr{constructor(M){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=M.left(),this.maxX=M.right(),this.minY=M.top(),this.maxY=M.bottom()}}be.RBushRect=vr;class ri{constructor(M){this._uniquePathsOnly=!1,this._collisionTracker=new bL.default,this._paths=[],this.windingRule=M.windingRule,this._uniquePathsOnly=M.path()instanceof To,this.add(M)}compilePaths(){var W,Z;if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let te=[];for(let se of this._paths)te.push(se.handle);let Y=((Z=(W=v().modules())==null?void 0:W.uniquePathHelpers)==null?void 0:Z.getVolatileConcatenatedPaths(te))??[],re=new Uint8Array(Y);return new tt(new oo(re))}let M=this._paths[0].toBezierPath().getMutableClone();for(let te=1,Y=this._paths.length;te<Y;te=te+1)M.append(this._paths[te].toBezierPath());return M}canAddRegion(M){return M.windingRule==this.windingRule&&this._uniquePathsOnly==M.path()instanceof To&&!this._collisionTracker.collides(new vr(M.path().bounds()))}add(M){this._paths.push(M.path()),this._collisionTracker.insert(new vr(M.path().bounds()))}}be.PathBatch=ri;let Xi;(W=>(W[W.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",W[W.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(Xi=be.PaintVisibility||(be.PaintVisibility={}));function vi(x,M){if(!x)return xe("transform tree is null"),new Le([]);let Z=M.transformModifiers()??[],te={x:1/0,y:1/0},Y={x:-1/0,y:-1/0};for(let se=0;se<M.childCount();se++){M.moveToChildAt(se);let oe=new us(M.relativeTransform().clone(),M.size().clone());for(let de=0;de<4;de++)te.x=Math.min(te.x,oe.get(de).x()),te.y=Math.min(te.y,oe.get(de).y()),Y.x=Math.max(Y.x,oe.get(de).x()),Y.y=Math.max(Y.y,oe.get(de).y());M.moveToParent()}let re=new us([new F(te.x,te.y),new F(te.x,Y.y),new F(Y.x,Y.y),new F(Y.x,te.y)]);for(let se of Z)if(se.visible())switch(se.type()){case"REPEAT":{let[oe,de]=ji(x,M,se,re);x=oe,re=de;break}case"SYMMETRY":case"SKEW":break}return x??new Le([])}function ji(x,M,W,Z){if(!W.visible()||!W.repeatType())return[x,Z];switch(W.repeatType()){case"LINEAR":{let te=Z.bounds();return Zi(x,M,W,Z,te)}case"RADIAL":return Ci(x,M,W,Z)}return[x,Z]}function Zi(x,M,W,Z,te){if(!x)return[null,Z];if(!W.unitType()||!W.axis()||!W.repeatType())return[x,Z];let Y=W.offset(),re=W.count()??1,se=M.absoluteTransform(),oe=se.determinant()<0&&W.axis()=="Y"?-Math.PI:0,de=se.toAngle()+oe,ue=te.center(),Ne;W.axis()==="X"?Ne=Z.bounds().size().x():Ne=Z.bounds().size().y();let Te=W.unitType()==="PIXELS"?W.offset().x():Ne*W.offset().x(),ve=W.order()==="LAST"?-1:1,Ge=[];for(let Ue=0;Ue<re;Ue++){let Qe=new F(0,0);W.axis()==="X"?Qe.setX(Te*Ue*ve):Qe.setY(Te*Ue*ve);let De=me(Qe,ue,de),Je=new so(x,De);Ge.push(Je)}let ot=Pe(Z,Y,re,W.unitType(),W.repeatType(),W.axis());return[new Le(Ge),ot]}function Ci(x,M,W,Z){if(x===null)return[null,Z];if(!W.unitType()||!W.axis()||!W.repeatType())return[x,Z];let te=Z.bounds(),Y=M.absoluteTransform(),re=Y.transformRect(L.new3(te)),se=Y.toAngle(),oe=re.center(),de=Q.forRotationAboutPoint(se,oe),ue=W.offset().x(),Ne=W.unitType(),Te=Ne==="PIXELS"?new F(0,ue/2):new F(0,te.height()/2*ue),ve=re.size(),Ge=new F(re.x(),re.y()),ot=ve.divideScalar(2).add(Ge).add(Te),we=W.count()??1,Ue=Math.PI*2/we,Qe=W.order()==="LAST"?-1:1,De=[];for(let Rs=0;Rs<we;Rs++){let PA=Rs*Ue*Qe,Za=Q.forRotationAboutPoint(PA,ot),HM=L.new3(re),kN=Za.transformRect(HM).center(),HN=de.transformPoint(F.new(kN));if(Za.preTranslate(HN.subtract(kN)),Y.determinant()<0){let WM=oe.subtract(HN).multiplyScalar(2);Za.preTranslate(WM)}let zM=new so(x,Za);De.push(zM)}let Je=Pe(Z,W.offset(),we,Ne,"RADIAL"),ir=new Le(De),Yt=re.topLeft().subtract(ot).length(),sn=ir.maxBounds,Ra=Math.max(0,Yt*2-sn.width()),ni=Math.max(0,Yt*2-sn.height()),NA=L.fromRect(sn).expandedBy2(Ra/2,ni/2);return[ua.createForRadialRepetition(ir,NA),Je]}function me(x,M,W){let Z=Q.forRotationAboutPoint(W,M),te=x.add(M),Y=Z.transformPoint(te),re=new F(Y.x()-M.x(),Y.y()-M.y());return new Q(1,0,re.x(),0,1,re.y())}function Pe(x,M,W,Z,te,Y){let re=x.bounds();if(te==="RADIAL"){let se=re.height(),oe=Z==="PIXELS"?M.x()/2:se/2*M.x(),de=new F(re.centerX(),re.centerY()+oe),ue=-1/0;for(let ve=0;ve<4;ve++){let Ge=x.get(ve).distanceTo(de);ue=Math.max(ue,Ge)}let Ne=de,Te=new F(ue*2,ue*2);return us.fromCenterSize(Ne,Te)}else{let se=Y==="X"?"x":"y",oe=se==="x"?re.width():re.height(),de=Z==="PIXELS"?M.x()-oe:(M.x()-1)*oe,ue=(W-1)*de+oe*W,Ne=new L(re.x(),re.y(),se==="x"?ue:re.width(),se==="y"?ue:re.height()),Te=Math.min(re.x(),Ne.x()),ve=Math.min(re.y(),Ne.y()),Ge=Math.max(re.right(),Ne.right()),ot=Math.max(re.bottom(),Ne.bottom()),we=new L(Te,ve,Ge-Te,ot-ve);return new us(we)}}})(I_||(I_={}));function vL(t){switch(t){case cn.METADATA:return 0;case cn.GROUP:return 1;case cn.FILL:return 3;case cn.FILL_GLYPHS:throw new Error("FILL_GLYPHS is not supported");case cn.FILL_STROKE:return 4;case cn.MASK:return 5;case cn.BLUR:return 6;case cn.BLEND:return 7;case cn.COMPOSITE_TILE:throw new Error("COMPOSITE_TILE is not supported");case cn.HARD_MASK_WITH_COLOR:return 9;case cn.STATIC_TRANSFORM_BINDING:return 11;case cn.GRAIN:return 14;case cn.NOISE:return 15;case cn.SCATTER_BRUSH_FILL:return 16;case cn.GLASS:return 17;case cn.VOLATILE_PROPERTY_BINDING:return 10;case cn.VOLATILE_RENDER_EFFECT:return 13;case cn.DISSOLVE:return 12;case cn.COMPOSITE_TILE_GRID:return 8;case cn.SUPERSAMPLE_GROUP:return 2}}function n3(t){switch(t){case gd.INSIDE:return 0;case gd.OUTSIDE:return 1}}function o3(t){switch(t){case ys.NORMAL:return 0;case ys.LUMINANCE:return 1;case ys.INNER_SHADOW:return 2;case ys.BACKGROUND_BLUR:return 3;case ys.KNOCKOUT_SHADOW:return 4}}function CO(t){switch(t){case $r.PASS_THROUGH:return"PASS_THROUGH";case $r.NORMAL:return"NORMAL";case $r.DARKEN:return"DARKEN";case $r.MULTIPLY:return"MULTIPLY";case $r.LINEAR_BURN:return"LINEAR_BURN";case $r.COLOR_BURN:return"COLOR_BURN";case $r.LIGHTEN:return"LIGHTEN";case $r.SCREEN:return"SCREEN";case $r.LINEAR_DODGE:return"LINEAR_DODGE";case $r.COLOR_DODGE:return"COLOR_DODGE";case $r.OVERLAY:return"OVERLAY";case $r.SOFT_LIGHT:return"SOFT_LIGHT";case $r.HARD_LIGHT:return"HARD_LIGHT";case $r.DIFFERENCE:return"DIFFERENCE";case $r.EXCLUSION:return"EXCLUSION";case $r.HUE:return"HUE";case $r.SATURATION:return"SATURATION";case $r.COLOR:return"COLOR";case $r.LUMINOSITY:return"LUMINOSITY"}}function CL(t){switch(t){case al.NORMAL:return"NORMAL";case al.PROGRESSIVE:return"PROGRESSIVE"}}function OL(t){switch(t){case bs.MULTITONE:return"MULTITONE";case bs.MONOTONE:return"MONOTONE";case bs.DUOTONE:return"DUOTONE"}}var xt=class{constructor(e){this.maxBounds=ar.FrozenRect_EMPTY;this.flags=0;this._wasmRenderNode=e}static getOrCreate(e){var a,s,l;if(!e||!za.WeakHandle_isValid(e))return null;let r=(a=v().modules().wasmRenderTreeBindings)==null?void 0:a.getJsShim(e);if(r)return r;let n=((s=v().modules().renderTreeBindings)==null?void 0:s.fromWeakHandle(e))??null;if(!n)return null;let o=vL(n.op()),i;switch(o){case 1:i=new hu(n);break;case 3:i=new R_(n);break;case 4:i=new _u(n);break;case 5:i=new y_(n);break;case 9:i=new TO(n);break;case 7:i=new b_(n);break;case 11:i=new EO(n);break;case 14:i=new v_(n);break;case 6:i=new C_(n);break;case 15:i=new O_(n);break;case 16:i=new IO(n);break;case 17:i=new RO(n);break;case 0:i=new yO(n);break;case 10:i=new N_(n);break;case 13:i=new P_(n);break;case 12:i=new F_(n);break;case 8:i=new bO(n);break;case 2:i=new vO(n);break}return(l=v().modules().wasmRenderTreeBindings)==null||l.setJsShimForHandle(e,i),i}computeBounds(e){throw new Error("computeBounds not implemented")}currentBounds(e){throw new Error("currentBounds not implemented")}op(){try{return vL(this._wasmRenderNode.op())}catch(e){return xe(e),0}}optimized(){throw new Error("optimized not implemented")}equals(e){throw new Error("equals not implemented")}equalsWithinBounds(e,r){throw new Error("equalsWithinBounds not implemented")}hasNonIsolatedBlends(){throw new Error("hasNonIsolatedBlends not implemented")}dependsOnBackgroundContent(){throw new Error("dependsOnBackgroundContent not implemented")}hasBackgroundBlurs(){return this._wasmRenderNode.hasBackgroundBlurs()??!1}hasGlassEffects(){return this._wasmRenderNode.hasGlassEffects()??!1}canBeUsedInBackgroundBlurs(){throw new Error("canBeUsedInBackgroundBlurs not implemented")}desiredAntialiasing(e){throw new Error("desiredAntialiasing not implemented")}opProfileString(){throw new Error("opProfileString not implemented")}canCacheRasterized(){throw new Error("canCacheRasterized not implemented")}isRectFill(){throw new Error("isRectFill not implemented")}isRoundedRectFill(){throw new Error("isRoundedRectFill not implemented")}isAxisAlignedRoundedRectFill(){throw new Error("isAxisAlignedRoundedRectFill not implemented")}isAxisAlignedRectFill(){throw new Error("isAxisAlignedRectFill not implemented")}hasAnimatingMedia(){throw new Error("hasAnimatingMedia not implemented")}maskNeedsSSAA(){throw new Error("maskNeedsSSAA not implemented")}hasVolatileContent(){throw new Error("hasVolatileContent not implemented")}debugString1(){return this._wasmRenderNode.debugString()??""}},R_=class extends xt{constructor(e){super(e)}get transform(){return ds(v().modules().fillBindings.transform(this._wasmRenderNode))??Q.new2()}get geometry(){return new Kt(null,[])}get paintSize(){return pa(v().modules().fillBindings.paintSize(this._wasmRenderNode))??F.new()}get bgBlurExpansionForFrameFill(){return null}geometryBounds(){throw new Error("geometryBounds not implemented")}},_u=class extends xt{constructor(e){super(e)}get transform(){return ds(v().modules().fillStrokeBindings.transform(this._wasmRenderNode))??Q.new2()}get fillGeometries(){return Dp.new1()}get strokeGeometries(){return Dp.new1()}get paintSize(){return pa(v().modules().fillStrokeBindings.paintSize(this._wasmRenderNode))??F.new()}get mode(){return n3(v().modules().fillStrokeBindings.mode(this._wasmRenderNode))}},hu=class extends xt{constructor(r){super(r);this._children=null}get children(){if(this._children===null){let r=v().modules().groupBindings.children(this._wasmRenderNode);this._children=[];for(let n of r){let o=xt.getOrCreate(n);o&&this._children.push(o)}}return this._children}isFirstChildSolidBackground(){return!1}},y_=class extends xt{constructor(e){super(e)}get alpha(){let e=v().modules().maskBindings.alpha(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Mask alpha node is null");return r}get color(){let e=v().modules().maskBindings.color(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Mask color node is null");return r}get type(){return o3(v().modules().maskBindings.type(this._wasmRenderNode))}get innerShadowFill(){return N.fromColorF(v().modules().maskBindings.innerShadowFill(this._wasmRenderNode))}get innerShadowAlphaRequiresHardMask(){return v().modules().maskBindings.innerShadowAlphaRequiresHardMask(this._wasmRenderNode)??!1}},TO=class extends xt{constructor(e){super(e)}get alpha(){let e=v().modules().hardMaskWithColorBindings.alpha(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("HardMaskWithColor alpha node is null");return r}get color(){return N.fromColorF(v().modules().hardMaskWithColorBindings.color(this._wasmRenderNode))}},b_=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().blendBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Blend child node is null");return r}get blendMode(){return CO(v().modules().blendBindings.mode(this._wasmRenderNode))}get opacity(){return v().modules().blendBindings.opacity(this._wasmRenderNode)}},EO=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().staticTransformBindingBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("StaticTransformBinding child node is null");return r}get transform(){return ds(v().modules().staticTransformBindingBindings.transform(this._wasmRenderNode))??Q.new2()}},v_=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().grainBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Grain child node is null");return r}get radius(){return v().modules().grainBindings.radius(this._wasmRenderNode)}get noiseSize(){return pa(v().modules().grainBindings.noiseSize(this._wasmRenderNode))??F.new()}get clipToShape(){return v().modules().grainBindings.clipToShape(this._wasmRenderNode)}get nodeToCanvasSpaceTransform(){return ds(v().modules().grainBindings.nodeToCanvasSpaceTransform(this._wasmRenderNode))??Q.new2()}get centerPoint(){return pa(v().modules().grainBindings.centerPoint(this._wasmRenderNode))??F.new()}get seed(){return v().modules().grainBindings.seed(this._wasmRenderNode)}},C_=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().blurBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Blur child node is null");return r}get blurOpType(){return CL(v().modules().blurBindings.blurOpType(this._wasmRenderNode))}get startRadius(){return v().modules().blurBindings.startRadius(this._wasmRenderNode)}get endRadius(){return v().modules().blurBindings.endRadius(this._wasmRenderNode)}get startPoint(){return pa(v().modules().blurBindings.startPoint(this._wasmRenderNode))??F.new()}get endPoint(){return pa(v().modules().blurBindings.endPoint(this._wasmRenderNode))??F.new()}get clamp(){let e=v().modules().blurBindings.clamp(this._wasmRenderNode),r=e.max.x-e.min.x,n=e.max.y-e.min.y;return ar.FrozenRect_new4(e.min.x,e.min.y,r,n)}hasInvertedStartAndEndPoints(){return v().modules().blurBindings.hasInvertedStartAndEndPoints(this._wasmRenderNode)}},O_=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().noiseBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Noise child node is null");return r}get noiseType(){return OL(v().modules().noiseBindings.noiseType(this._wasmRenderNode))}get blendMode(){return CO(v().modules().noiseBindings.blendMode(this._wasmRenderNode))}get noiseSize(){return pa(v().modules().noiseBindings.noiseSize(this._wasmRenderNode))??F.new()}get density(){return v().modules().noiseBindings.density(this._wasmRenderNode)}get color(){let e=v().modules().noiseBindings.color(this._wasmRenderNode);return N.fromColorF(e)}get secondaryColor(){if(v().modules().noiseBindings.hasSecondaryColor(this._wasmRenderNode)){let r=v().modules().noiseBindings.secondaryColor(this._wasmRenderNode);return N.fromColorF(r)}return N.new2(0,0,0,0)}get nodeToCanvasSpaceTransform(){return ds(v().modules().noiseBindings.nodeToCanvasSpaceTransform(this._wasmRenderNode))??Q.new2()}get nodeSpaceCenterPoint(){return pa(v().modules().noiseBindings.centerPoint(this._wasmRenderNode))??F.new()}get seed(){return v().modules().noiseBindings.seed(this._wasmRenderNode)}},IO=class extends xt{constructor(e){super(e)}get transform(){return ds(v().modules().scatterBrushFillBindings.transform(this._wasmRenderNode))??Q.new2()}get fillGeometries(){throw new Error("ScatterBrushFill.fillGeometries not yet implemented in WASM bindings")}get instanceTransforms(){let e=v().modules().scatterBrushFillBindings.instanceTransformCount(this._wasmRenderNode),r=[];for(let n=0;n<e;n++){let o=ds(v().modules().scatterBrushFillBindings.instanceTransformAt(this._wasmRenderNode,n))??Q.new2();r.push(o)}return r}get paintSize(){return pa(v().modules().scatterBrushFillBindings.paintSize(this._wasmRenderNode))??F.new()}getAccumulatedFillGeometryPathBounds(){throw new Error("ScatterBrushFill.getAccumulatedFillGeometryPathBounds not yet implemented in WASM bindings")}getInstanceBuffer(e){throw new Error("ScatterBrushFill.getInstanceBuffer not yet implemented in WASM bindings")}},RO=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().glassBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Glass child node is null");return r}get blurRadius(){return v().modules().glassBindings.blurRadius(this._wasmRenderNode)}get textureRadius(){return v().modules().glassBindings.reflectionRadius(this._wasmRenderNode)}get refractionIntensity(){return v().modules().glassBindings.refractionIntensity(this._wasmRenderNode)}get refractionDistance(){return v().modules().glassBindings.refractionDistance(this._wasmRenderNode)}get lightIntensity(){return v().modules().glassBindings.lightIntensity(this._wasmRenderNode)}get lightAngle(){return v().modules().glassBindings.lightAngle(this._wasmRenderNode)}get bevelSize(){return v().modules().glassBindings.bevelSize(this._wasmRenderNode)}get chromaticAberration(){return v().modules().glassBindings.chromaticAberration(this._wasmRenderNode)}get reflectionRadius(){return v().modules().glassBindings.reflectionRadius(this._wasmRenderNode)}get tintColor(){let e=v().modules().glassBindings.tintColor(this._wasmRenderNode);return N.fromColorF(e)}get cornerInfo(){throw new Error("Glass.cornerInfo not yet implemented in WASM bindings")}get nodeToCanvasSpaceTransform(){return ds(v().modules().glassBindings.nodeToCanvasSpaceTransform(this._wasmRenderNode))??Q.new2()}get centerPoint(){return pa(v().modules().glassBindings.centerPoint(this._wasmRenderNode))??F.new()}},yO=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().metadataBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Metadata child node is null");return r}},N_=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().volatilePropertyBindingBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("VolatilePropertyBinding child node is null");return r}get id(){return v().modules().volatilePropertyBindingBindings.volatilePropertyID(this._wasmRenderNode)}get property(){return v().modules().volatilePropertyBindingBindings.property(this._wasmRenderNode)}get getter(){throw new Error("VolatilePropertyBinding.getter not yet implemented in WASM bindings")}transform(){throw new Error("VolatilePropertyBinding.transform not yet implemented in WASM bindings")}opacity(){throw new Error("VolatilePropertyBinding.opacity not yet implemented in WASM bindings")}maxTransformScale(){throw new Error("VolatilePropertyBinding.maxTransformScale not yet implemented in WASM bindings")}},P_=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().volatileRenderEffectBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("VolatileRenderEffect child node is null");return r}get id(){return v().modules().volatileRenderEffectBindings.volatilePropertyID(this._wasmRenderNode)}get property(){return v().modules().volatileRenderEffectBindings.property(this._wasmRenderNode)}get blurOpType(){return CL(v().modules().volatileRenderEffectBindings.blurOpType(this._wasmRenderNode))}get getter(){throw new Error("VolatileRenderEffect.getter not yet implemented in WASM bindings")}get getter1(){throw new Error("VolatileRenderEffect.getter1 not yet implemented in WASM bindings")}get getter2(){throw new Error("VolatileRenderEffect.getter2 not yet implemented in WASM bindings")}get canvasSpaceClamp(){let e=v().modules().volatileRenderEffectBindings.canvasSpaceClamp(this._wasmRenderNode),r=e.max.x-e.min.x,n=e.max.y-e.min.y;return ar.FrozenRect_new4(e.min.x,e.min.y,r,n)}get clipToShape(){return v().modules().volatileRenderEffectBindings.clipToShape(this._wasmRenderNode)}get nodeToCanvasSpace(){return ds(v().modules().volatileRenderEffectBindings.nodeToCanvasSpace(this._wasmRenderNode))??Q.new2()}get maxEffectRadius(){return v().modules().volatileRenderEffectBindings.maxEffectRadius(this._wasmRenderNode)}get cornerSmoothing(){return v().modules().volatileRenderEffectBindings.cornerSmoothing(this._wasmRenderNode)}get noiseType(){return OL(v().modules().volatileRenderEffectBindings.noiseType(this._wasmRenderNode))}get blendMode(){return CO(v().modules().volatileRenderEffectBindings.blendMode(this._wasmRenderNode))}get seed(){return v().modules().volatileRenderEffectBindings.seed(this._wasmRenderNode)}startRadius(){throw new Error("VolatileRenderEffect.startRadius not yet implemented in WASM bindings")}endRadius(){throw new Error("VolatileRenderEffect.endRadius not yet implemented in WASM bindings")}getStartOffsetInCanvasSpace(){throw new Error("VolatileRenderEffect.getStartOffsetInCanvasSpace not yet implemented in WASM bindings")}getOffsetInCanvasSpace(){throw new Error("VolatileRenderEffect.getOffsetInCanvasSpace not yet implemented in WASM bindings")}getNoiseColor(){throw new Error("VolatileRenderEffect.getNoiseColor not yet implemented in WASM bindings")}getSecondaryNoiseColor(){throw new Error("VolatileRenderEffect.getSecondaryNoiseColor not yet implemented in WASM bindings")}getNoiseDensity(){throw new Error("VolatileRenderEffect.getNoiseDensity not yet implemented in WASM bindings")}getNoiseSize(){throw new Error("VolatileRenderEffect.getNoiseSize not yet implemented in WASM bindings")}type(){return this.property}getNodeToCanvasSpaceTransform(){return this.nodeToCanvasSpace}getNodeSpaceCenterPoint(){return pa(v().modules().volatileRenderEffectBindings.centerPoint(this._wasmRenderNode))??F.new()}hasInvertedStartAndEndPoints(){return v().modules().volatileRenderEffectBindings.hasInvertedStartAndEndPoints(this._wasmRenderNode)}grainRadius(){throw new Error("VolatileRenderEffect.grainRadius not yet implemented in WASM bindings")}grainNoiseSize(){throw new Error("VolatileRenderEffect.grainNoiseSize not yet implemented in WASM bindings")}glassCenterPoint(){throw new Error("VolatileRenderEffect.glassCenterPoint not yet implemented in WASM bindings")}glassBlurRadius(){throw new Error("VolatileRenderEffect.glassBlurRadius not yet implemented in WASM bindings")}glassRefractionIntensity(){throw new Error("VolatileRenderEffect.glassRefractionIntensity not yet implemented in WASM bindings")}glassRefractionDistance(){throw new Error("VolatileRenderEffect.glassRefractionDistance not yet implemented in WASM bindings")}glassSpecularIntensity(){throw new Error("VolatileRenderEffect.glassSpecularIntensity not yet implemented in WASM bindings")}glassSpecularAngle(){throw new Error("VolatileRenderEffect.glassSpecularAngle not yet implemented in WASM bindings")}glassBevelSize(){throw new Error("VolatileRenderEffect.glassBevelSize not yet implemented in WASM bindings")}glassChromaticAberration(){throw new Error("VolatileRenderEffect.glassChromaticAberration not yet implemented in WASM bindings")}glassReflectionDistance(){throw new Error("VolatileRenderEffect.glassReflectionDistance not yet implemented in WASM bindings")}glassTextureRadius(){throw new Error("VolatileRenderEffect.glassTextureRadius not yet implemented in WASM bindings")}glassCornerInfo(){throw new Error("VolatileRenderEffect.glassCornerInfo not yet implemented in WASM bindings")}glassTintColor(){throw new Error("VolatileRenderEffect.glassTintColor not yet implemented in WASM bindings")}},F_=class extends xt{constructor(e){super(e)}get startChild(){let e=v().modules().dissolveBindings.start(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Dissolve startChild node is null");return r}get endChild(){let e=v().modules().dissolveBindings.end(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("Dissolve endChild node is null");return r}get id(){return v().modules().dissolveBindings.volatilePropertyID(this._wasmRenderNode)}get progressFn(){throw new Error("Dissolve.progressFn not yet implemented in WASM bindings")}progress(){throw new Error("Dissolve.progress not yet implemented in WASM bindings")}},bO=class extends xt{constructor(e){super(e)}get tree(){let e=v().modules().compositeTileGridBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("CompositeTileGrid child node is null");return r}forEachTileWithinBounds(e,r,n){throw new Error("CompositeTileGrid.forEachTileWithinBounds not yet implemented in WASM bindings")}},vO=class extends xt{constructor(e){super(e)}get child(){let e=v().modules().supersampleGroupBindings.child(this._wasmRenderNode),r=xt.getOrCreate(e);if(!r)throw new Error("SupersampleGroup child node is null");return r}};var D_;(r=>{function t(n,o){var a;let i=(a=v().modules().wasmRenderTreeBindings)==null?void 0:a.generateRenderTree(n);return xt.getOrCreate(i??null)}r.generateRenderTree=t;function e(n,o){return null}r.renderTreeForOverlayBackground=e})(D_||(D_={}));var ct=class{static initializeJsImpl(){this._generateRenderTree=I_.generateRenderTree,this._renderTreeForOverlayBackground=I_.renderTreeForOverlayBackground}static initializeWasmImpl(){this._generateRenderTree=D_.generateRenderTree,this._renderTreeForOverlayBackground=D_.renderTreeForOverlayBackground}static isInitialized(){return this._generateRenderTree!==null&&this._renderTreeForOverlayBackground!==null}static generateRenderTree(e,r){var n;return((n=this._generateRenderTree)==null?void 0:n.call(this,e,r))??null}static renderTreeForOverlayBackground(e,r){var n;return((n=this._renderTreeForOverlayBackground)==null?void 0:n.call(this,e,r))??null}static _logIfNecessary(e,r,n){if(e>this.GEN_DURATION_LOG_THRESHOLD_S){let o=`${qg[r]}${n}`;this._trackingKeys.has(o)&&(Re.trackEvent("Slow Render Tree Generation",{duration:e,frameRole:r,callSite:n}),this._trackingKeys.add(o))}}static renderTreeWithPerfLogging1(e,r){let n=new uc,o=Re.perfTimerScope("generateRenderTree",Re.ProfileLevel.LEGACY,()=>e.renderTree(null));return this._logIfNecessary(n.elapsedSeconds(),1,r),o}static renderTreeWithPerfLogging2(e,r,n){let o=new uc,i=Re.perfTimerScope("generateRenderTree",Re.ProfileLevel.LEGACY,()=>e.renderTree2(r));return this._logIfNecessary(o.elapsedSeconds(),1,n),i}static renderTreeForBaseScreenWithPerfLogging(e,r,n){let o=new uc,i=Re.perfTimerScope("generateRenderTree",Re.ProfileLevel.LEGACY,()=>e.renderTreeForBaseScreen2(r));return this._logIfNecessary(o.elapsedSeconds(),0,n),i}static renderTreeForOverlayWithPerfLogging(e,r,n){let o=new uc,i=Re.perfTimerScope("generateRenderTree",Re.ProfileLevel.LEGACY,()=>e.renderTreeForOverlay(r));return this._logIfNecessary(o.elapsedSeconds(),1,n),i}};ct._generateRenderTree=null,ct._renderTreeForOverlayBackground=null,ct.GEN_DURATION_LOG_THRESHOLD_S=.15,ct._trackingKeys=new Set;var Nt=class Nt extends Yg{constructor(e,r,n){super(),this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=wt.FrozenAffineTransform_IDENTITY,this._flags=5,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this.animatingFrom=null,this.sourceNodeForTransition=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=ar.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=ar.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=ar.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlursAndGlassEffects=null,this._renderTreeWithoutGlassEffects=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._renderTreeWithoutEffects=null,this._overlayCacheKey=null,this._scene=r,this._id=n,this._scrollingLogic=new Qg(this),this._handle=e}handle(){return this._handle}updateAfterPropertyChange(e){e==58?(this.updateDirtyFlagsForPropertyChange(e,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(e,null),e==108&&(this._cachedType=null)}linkToParent(e,r){e!=null&&(this._cachedParent=e,this._addFlagsToSelfAndChildren(1),e._cachedChildren.splice(r,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(le.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(e){return this._scrollingLogic.scrollsInPreferredDirection(e)}scrollAndClipBoundsBySelfAndAncestors(e,r){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(e,r)}canvasSpaceScrolledBounds(e){return this._scrollingLogic.canvasSpaceScrolledBounds(e)}canvasSpaceScrolledInteractiveBounds(e){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(e)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return er.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():er.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}isTransitionDestinationNode(){return!!U.getFeatureFlags().prototype_animate_parent&&!!this.sourceNodeForTransition}parentOrTransitionSourceNodeParent(){return U.getFeatureFlags().prototype_animate_parent&&this.sourceNodeForTransition&&this.sourceNodeForTransition.parent()&&!this._cachedParent?this.sourceNodeForTransition.parent():this._cachedParent}parent(){return this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}containerSupportsFillStrokeAndCorners(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().containerSupportsFillStrokeAndCorners(ne.PROTOTYPE_LIB)}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.hasNodeProperty(4)&&this.hasNodeProperty(2)?[$.createSolid(this.computedBackgroundColor(),1)]:Ce.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?N.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):N.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getIsStack(ne.PROTOTYPE_LIB)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}isEmbeddedPrototype(){return this.type()=="INTERACTIVE_SLIDE_ELEMENT"&&this.interactiveSlideElementType()=="EMBED"}isClipInstance(){return this.clipId()!=X.invalid()}isValidTLFType(){return kr._isValidTLFType(this.type())&&this.type()!="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode(this.stablePath().guids[0]):null}getBackingSymbolParent(){var e;return this.isInstance()?(e=this.scene().findNode(this.symbolID()))==null?void 0:e.parent():null}findNearestAncestorOrSelf(e){let r=this;for(;r!=null&&r.type()!="CANVAS"&&r.type()!="DOCUMENT";){if(r.type()==e)return r;r=r.parent()}return null}findContainingCanvasOrSelf(){let e=this;for(;e!=null;){if(e.type()=="CANVAS")return e;if(e.parent()==null)break;e=e.parent()}return null}constrainsAnchoredChildren(){return er.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}minSize(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getMinSize(ne.PROTOTYPE_LIB)}maxSize(){return v().prepareCppNodeForAccess(this),v().stackFacetTsApiGenerated().getMaxSize(ne.PROTOTYPE_LIB)}prototypeDevice(){return U.deviceFramesSupported()?this.storedPrototypeDevice():Wn.DEFAULT}findContainingCanvasOrParent(){let e=this.parentOrTransitionSourceNodeParent();for(;e!=null&&e.type()!="CANVAS"&&e.parent()!=null;)e=e.parent();return e}guidPath(){return v().getOverridePath(this)}stablePath(){return v().getStablePath(this)}clipId(){return v().getClipId(this)}timelineDuration(){return v().getTimelineDuration(this)}removeSelfAndSubtree(){v().prepareCppNodeForAccess(this),v().nodeTsApi().removeSelfAndChildrenWithoutSafetyChecks(ne.PROTOTYPE_LIB)}type(){if(this._cachedType==null||this._cachedType=="NONE"){v().prepareCppNodeForAccess(this);let e=v().baseNodeTsApiGenerated().getType(ne.PROTOTYPE_LIB);this._cachedType=Be().NodeType[e]}return this._cachedType}name(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getName(ne.PROTOTYPE_LIB)}setName(e){v().prepareCppNodeForAccess(this);let r=v().nodeTsApi().setName(e,ne.PROTOTYPE_LIB);r!=""&&xe(r)}scrollOffset(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getScrollOffset(ne.PROTOTYPE_LIB);return new F(e.x,e.y)}setScrollOffset(e){v().prepareCppNodeForAccess(this);let r=v().nodeTsApi().setScrollOffset({x:e.x(),y:e.y()},ne.PROTOTYPE_LIB);r!=""&&xe(r)}scrollSpeedMultiplier(){var r;let e=this.behaviors();return((r=e==null?void 0:e.scrollParallax)==null?void 0:r.speed)??1}currentViewportSize(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getCurrentViewportSize(ne.PROTOTYPE_LIB);return new F(e.x,e.y)}setCurrentViewportSize(e){v().prepareCppNodeForAccess(this);let r=v().nodeTsApi().setCurrentViewportSize({x:e.x(),y:e.y()},ne.PROTOTYPE_LIB);r!=""&&xe(r)}fullSize(){v().prepareCppNodeForAccess(this);let e=v().layoutFacetTsApiGenerated().getSize(ne.PROTOTYPE_LIB);return new F(e.x,e.y)}originalSize(){v().prepareCppNodeForAccess(this);let{x:e,y:r}=v().modules().prototype.getOriginalNodeSize(this.id());return e>0&&r>0?new F(e,r):this.fullSize()}setSize(e){v().prepareCppNodeForAccess(this),this.setSizeVectorF({x:e.x(),y:e.y()})}relativeTransform(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getRelativeTransform(ne.PROTOTYPE_LIB,fd.NO);return new Q(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setRelativeTransform(e){v().prepareCppNodeForAccess(this);let r=v().nodeTsApi().setRelativeTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),ne.PROTOTYPE_LIB,fd.NO);r!=""&&xe(r)}overlayTransform(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getOverlayTransform(ne.PROTOTYPE_LIB);return new Q(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setOverlayTransform(e){v().prepareCppNodeForAccess(this);let r=v().nodeTsApi().setOverlayTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),ne.PROTOTYPE_LIB);r!=""&&xe(r)}behaviors(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getBehaviors(ne.PROTOTYPE_LIB)}setBehavior(e,r){v().prepareCppNodeForAccess(this);let o={...v().nodeTsApi().getBehaviors(ne.PROTOTYPE_LIB)??{},[e]:r};v().nodeTsApi().setBehaviors(o,ne.PROTOTYPE_LIB)}interactiveSlideConfigData(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getInteractiveSlideConfigData(ne.PROTOTYPE_LIB)}setInteractiveSlideConfigData(e,r){return v().prepareCppNodeForAccess(this),v().nodeTsApi().setInteractiveSlideConfigData(e,r,ne.PROTOTYPE_LIB)}interactiveSlideParticipantData(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getInteractiveSlideParticipantData(ne.PROTOTYPE_LIB)}setInteractiveSlideParticipantData(e,r){return v().prepareCppNodeForAccess(this),v().nodeTsApi().setInteractiveSlideParticipantData(e,r,ne.PROTOTYPE_LIB)}slideSpeakerNotes(){return v().prepareCppNodeForAccess(this),v().slideFacetTsApiGenerated().getSlideSpeakerNotes(ne.PROTOTYPE_LIB)}slideThumbnailHash(){return v().prepareCppNodeForAccess(this),v().slideFacetTsApiGenerated().getSlideThumbnailHash(ne.PROTOTYPE_LIB)}stackMode(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getStackMode(ne.PROTOTYPE_LIB);return Be().StackMode[e]}setStackMode(e){v().prepareCppNodeForAccess(this);let r=Be().StackMode[e];v().nodeTsApi().setStackMode(r,ne.PROTOTYPE_LIB)}backgroundColor(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getBackgroundColor(ne.PROTOTYPE_LIB);return N.new3(e.red,e.green,e.blue,e.alpha)}setBackgroundColor(e){v().prepareCppNodeForAccess(this);let r=v().nodeTsApi().setBackgroundColor(N.toColorF(e),ne.PROTOTYPE_LIB);r!=""&&xe(r)}prototypeBackgroundColor(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getPrototypeBackgroundColor(ne.PROTOTYPE_LIB);return N.fromColorF(e)}setPrototypeBackgroundColor(e){v().prepareCppNodeForAccess(this);let r={red:N.redF(e),green:N.greenF(e),blue:N.blueF(e),alpha:N.alphaF(e)},n=v().nodeTsApi().setPrototypeBackgroundColor(r,ne.PROTOTYPE_LIB);n!=""&&xe(n)}parentIndex(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getParentIndex(ne.PROTOTYPE_LIB),r=e.parent;return new vn(r,e.position)}setParentIndex(e){v().prepareCppNodeForAccess(this);let r={parent:e.id,position:e.position},n=v().nodeTsApi().setParentIndex(r,ne.PROTOTYPE_LIB);n!=""&&xe(n)}fillPaints(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.getViewerJsFillPaints(ne.PROTOTYPE_LIB))??[]}textDecorationFillPaints(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.getViewerJsTextDecorationFillPaints(ne.PROTOTYPE_LIB))??[]}getBoundVariables(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getBoundVariables(ne.PROTOTYPE_LIB)}getResolvedVariableModes(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getResolvedVariableModes(ne.PROTOTYPE_LIB)}getResolvedVariableModesForPrototype(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getResolvedVariableModesForPrototype(ne.PROTOTYPE_LIB)}getResolvedVariableModesWithSetKeys(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getResolvedVariableModesWithSetKeys(ne.PROTOTYPE_LIB)}getExplicitVariableModes(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getExplicitVariableModes(ne.PROTOTYPE_LIB)}getExplicitVariableModesWithSetKeys(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getExplicitVariableModesWithSetKeys(ne.PROTOTYPE_LIB)}setExplicitVariableModeForCollection(e,r){return v().prepareCppNodeForAccess(this),v().nodeTsApi().setExplicitVariableModeForCollection(e,r,ne.PROTOTYPE_LIB)}setExplicitVariableModeForCollectionWithSetKey(e,r,n){return v().prepareCppNodeForAccess(this),v().nodeTsApi().setExplicitVariableModeForCollectionWithSetKey(e,r,n,ne.PROTOTYPE_LIB)}clearExplicitVariableConsumerModeForCollection(e){return v().prepareCppNodeForAccess(this),v().nodeTsApi().clearExplicitVariableConsumerModeForCollection(e,ne.PROTOTYPE_LIB)}clearExplicitVariableConsumerModeForCollectionWithSetKey(e){return v().prepareCppNodeForAccess(this),v().nodeTsApi().clearExplicitVariableConsumerModeForCollectionWithSetKey(e,ne.PROTOTYPE_LIB)}setTestOnlyFillPaints(e){pi("Paint serialization only partially implemented in TS Viewer"),fa(v(),this,24,e)}strokePaints(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.getViewerJsStrokePaints(ne.PROTOTYPE_LIB))??[]}codeSnapshot(){var e;return v().prepareCppNodeForAccess(this),(e=v().nodeTsApi())==null?void 0:e.getViewerCodeSnapshot(ne.PROTOTYPE_LIB)}setTestOnlyStrokePaints(e){pi("Paint serialization only partially implemented in TS Viewer"),fa(v(),this,88,e)}effects(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.getViewerJsEffects(ne.PROTOTYPE_LIB))??[]}setTestOnlyEffects(e){pi("Effect serialization only partially implemented in TS Viewer"),fa(v(),this,21,e)}transformModifiers(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.getViewerJsTransformModifiers(ne.PROTOTYPE_LIB))??[]}setTestOnlyTransformModifiers(e){pi("TransformModifier serialization only partially implemented in TS Viewer"),fa(v(),this,101,e)}symbolID(){return this.isInstance()?(v().prepareCppNodeForAccess(this),v().nodeTsApi().getSymbolId(ne.PROTOTYPE_LIB)):X.invalid()}setTestOnlySymbolData(e){pi("SymbolData serialization only partially implemented in TS Viewer"),fa(v(),this,96,e)}fillGeometry(){var r;if(!1)return la(this.canvasSpaceBoundingBox());v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getFillGeometryRegions(ne.PROTOTYPE_LIB);return v().idlRegionsToGeometry(e??null,null)}setTestOnlyFillGeometry(e){pi("Geometry serialization only partially implemented in TS Viewer"),fa(v(),this,23,e)}strokeGeometry(){var r;v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getStrokeGeometryRegions(ne.PROTOTYPE_LIB);return v().idlRegionsToGeometry(e??null,null)}setTestOnlyStrokeGeometry(e){pi("Geometry serialization only partially implemented in TS Viewer"),fa(v(),this,87,e)}strokeBrush(){var r;v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getStrokeBrushGuid(ne.PROTOTYPE_LIB);return!e||e.length===0?null:this.scene().findNode(e)}hasStrokeBrush(){return this.strokeBrush()!==null}getBrushType(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getBrushType(ne.PROTOTYPE_LIB)}isBrushInstanceType(e){var r;return v().prepareCppNodeForAccess(this),((r=v().nodeTsApi())==null?void 0:r.isBrushInstanceType(e,ne.PROTOTYPE_LIB))??!1}getScatterBrushInstanceTransforms(){var n;v().prepareCppNodeForAccess(this);let e=((n=v().nodeTsApi())==null?void 0:n.getScatterBrushInstanceTransforms(ne.PROTOTYPE_LIB))??[],r=[];for(let o of e)r.push(new Q(o.m00,o.m01,o.m02,o.m10,o.m11,o.m12));return r}hasScatterBrushInstanceTransforms(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.hasScatterBrushInstanceTransforms(ne.PROTOTYPE_LIB))??!1}textGeometry(){var o;let e=this.textData();if(e==null)return null;v().prepareCppNodeForAccess(this);let r=(o=v().nodeTsApi())==null?void 0:o.getTextGeometryRegions(ne.PROTOTYPE_LIB),n=new di(e.styleOverrideTable());return v().idlRegionsToTextGeometry(r??null,n)}prototypeInteractions(){var r;v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getPrototypeInteractions(ne.PROTOTYPE_LIB);return!e||!za.WeakHandle_isValid(e)?[]:v().modules().prototypeInteractions_Internal.getOrCreateViewerJsCopy(e)}setTestOnlyPrototypeInteractions(e){pi("PrototypeInteraction[] serialization only partially implemented in TS Viewer"),fa(v(),this,61,e)}objectAnimations(){var e;return v().prepareCppNodeForAccess(this),((e=v().nodeTsApi())==null?void 0:e.getObjectAnimationsViewerJs(ne.PROTOTYPE_LIB))??[]}setTestOnlyObjectAnimations(e){pi("PrototypeInteraction[] serialization only partially implemented in TS Viewer"),fa(v(),this,47,e)}getObjectAnimationInteractionIndex(e){return this.objectAnimations().findIndex(n=>n.id()===e.interactionId)}getObjectAnimationInteraction(e){return this.objectAnimations().find(n=>n.id()===e.interactionId)??null}getObjectAnimationAction(e){let r=this.getObjectAnimationInteraction(e);if(r==null)return null;let n=r.getAllActions();return 0<=e.actionIndex&&e.actionIndex<n.length?n[e.actionIndex]:null}prototypeStartingPoint(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getPrototypeStartingPoint(ne.PROTOTYPE_LIB);if(e==null)return null;let r=e;return new wa(r.name,r.description,Or.fromString(r.position))}setPrototypeStartingPoint(e){v().prepareCppNodeForAccess(this);let r={name:e.name,description:e.description,position:Or.toString(e.position)},n=v().nodeTsApi().setPrototypeStartingPoint(r,ne.PROTOTYPE_LIB);n!=""&&xe(n)}storedPrototypeDevice(){v().prepareCppNodeForAccess(this);let e=v().prototypingFacetTsApiGenerated().getPrototypeDevice(ne.PROTOTYPE_LIB);if(e==null)return null;let r=e;return new Wn(Be().PrototypeDeviceType[r.type],new F(r.size.x,r.size.y),r.presetIdentifier,Be().DeviceRotation[r.rotation])}setPrototypeDevice(e){v().prepareCppNodeForAccess(this);let r={type:Be().PrototypeDeviceType[e.type],size:{x:e.nonRotatedSize.x(),y:e.nonRotatedSize.y()},presetIdentifier:e.presetIdentifier,rotation:Be().DeviceRotation[e.rotation]};v().updatePrototypeDevice(r)}overlayBackgroundAppearance(){v().prepareCppNodeForAccess(this);let e=v().nodeTsApi().getOverlayBackgroundAppearance(ne.PROTOTYPE_LIB);if(e==null)return null;let r=e;return new La(Be().OverlayBackgroundType[r.backgroundType],N.fromColorF(r.backgroundColor))}setOverlayBackgroundAppearance(e){v().prepareCppNodeForAccess(this);let r={backgroundType:Be().OverlayBackgroundType[e.backgroundType],backgroundColor:N.toColorF(e.backgroundColor)},n=v().nodeTsApi().setOverlayBackgroundAppearance(r,ne.PROTOTYPE_LIB);n!=""&&xe(n)}textData(){var r;v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getTextData(ne.PROTOTYPE_LIB);return!e||!za.WeakHandle_isValid(e)?null:v().modules().textData_Internal.getOrCreateViewerJsCopy(e)}setTestOnlyTextData(e){pi("TextData serialization only partially implemented in TS Viewer"),fa(v(),this,99,e)}derivedTextData(){var r;v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getDerivedTextData(ne.PROTOTYPE_LIB);return!e||!za.WeakHandle_isValid(e)?null:v().modules().derivedTextData_Internal.getOrCreateViewerJsCopy(e)}setTestOnlyDerivedTextData(e){pi("DerivedTextData serialization only partially implemented in TS Viewer"),fa(v(),this,19,e)}vectorData(){var r;v().prepareCppNodeForAccess(this);let e=(r=v().nodeTsApi())==null?void 0:r.getVectorData(ne.PROTOTYPE_LIB);return!e||!za.WeakHandle_isValid(e)?null:v().modules().compiledVectorData_Internal.getOrCreateViewerJsCopy(e)}hasDefaultStrokeParameters(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getHasDefaultStrokeParameters(ne.PROTOTYPE_LIB)}strokeJoin(){switch(v().prepareCppNodeForAccess(this),v().nodeTsApi().getStrokeJoin(ne.PROTOTYPE_LIB)){default:case 0:return"MITER";case 1:return"BEVEL";case 2:return"ROUND"}}setStrokeJoin(e){v().prepareCppNodeForAccess(this);let r=0;switch(e){case"MITER":r=0;break;case"BEVEL":r=1;break;case"ROUND":r=2;break}v().nodeTsApi().setStrokeJoin(r,ne.PROTOTYPE_LIB)}setStrokeMiterLimit(e){v().prepareCppNodeForAccess(this),v().nodeTsApi().setStrokeMiterLimit(e,ne.PROTOTYPE_LIB)}strokeMiterLimit(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getStrokeMiterLimit(ne.PROTOTYPE_LIB)}videoPlayback(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getVideoPlayback(ne.PROTOTYPE_LIB)}setVideoPlayback(e){v().prepareCppNodeForAccess(this),v().nodeTsApi().setVideoPlayback(e,ne.PROTOTYPE_LIB)}accessibleLabel(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getAccessibleLabel(ne.PROTOTYPE_LIB)}hasNodeProperty(e){return v().hasNodeProperty(this,e)}get(e,r=null){let n=Hg(v(),this,e);return n??r}getSerializedPropertyForTests(e){let r;switch(e){case"effects":{r=21;break}case"fillPaints":{r=24;break}case"strokePaints":{r=88;break}case"prototypeInteractions":case"objectAnimations":{r=61;break}default:throw"unknown property name in getSerializedPropertyForTests"+e}return Tt.serializeValueToKiwiForTests1(r,this.get(r)).a[e]}each(e){v().forEachField(this,r=>{e(r,this.get(r))})}isVisibleInCanvas(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().isVisibleInCanvas(ne.PROTOTYPE_LIB)}isSlotReactive(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getIsSlotReactive(ne.PROTOTYPE_LIB)}supportsBackgroundPaints(){return er.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return er.isGeometryLeaf(this.type())||er.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(e){if(e==null)return null;let r=this.prototypeInteractions().filter(n=>X.equals(n.id(),e));return r.length==0?null:(r.length>1&&xe("Found multiple prototype interactions with the same GUID"),r[0])}updateDirtyFlagsForPropertyChange(e,r){this._handlePropertyChangeForTransform(e),this._handlePropertyChangeForBounds(e,r),this._handlePropertyChangeForRenderTree(e,r),this._handlePropertyChangeForInteractions(e)}_handlePropertyChangeForTransform(e){if((e==109||e==70||e==60||e==72||e==18)&&this._addFlagsToSelfAndChildren(1),e==27||e==110){let r=this;for(;r!=null&&!(r.isFixed()||r.hasOwnConstraintValues());)r=r.parent();r!=null&&r.isFixed()&&r.dirtyTransform()}}_handlePropertyChangeForInteractions(e){xo.isInteractionProperty(e)&&(this._lazyInteractionsMigrationValue=null)}map(e){return this._cachedChildren.map(e)}forEachChild(e,r=!1){for(let n=0;n<this._cachedChildren.length;n++)e(this.childAt2(n,r))}forEachDescendantPreorder(e){this._cachedChildren.forEach(r=>{e(r),r.forEachDescendantPreorder(e)})}children(){return this._cachedChildren}childCount(){return this._cachedChildren.length}childAt1(e){return this.childAt2(e,!1)}childAt2(e,r){return r&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-e-1]:this._cachedChildren[e]}indexInParent(){if(this._cachedParent==null)return-1;let e=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(e=this._cachedParent.childCount()-e-1),e}updateIsRooted(){let e=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(e!=this.isRooted()){this._flags=e?this._flags|2:this._flags&-3,e&&this._addFlagsToSelfAndChildren(1);for(let r of this._cachedChildren)r.updateIsRooted()}}appendChild(e){let r=this._cachedChildren.length==0?Or.FIRST_POSITION:Or.after(le.List_last(this._cachedChildren).parentIndex().position);e.setParentIndex(new vn(this.id(),r))}collectUniqueUsedImages(e=new Set){let r=new Map;return this.forEachSinglePaint(n=>{if((n.type()=="IMAGE"||n.type()=="EMOJI"||n.type()=="VIDEO")&&(n.image()!=null&&r.set(n.image().objectHash(),n.image()),n.imageThumbnail()!=null&&r.set(n.imageThumbnail().objectHash(),n.imageThumbnail())),n.type()=="PATTERN"){let o=n.patternSource();o&&o.id()!==this.id()&&!e.has(o.id())&&(e.add(o.id()),o.collectUniqueUsedImages(e).forEach((a,s)=>{r.set(s,a)}))}}),this.forEachEmojiInTextData(n=>{r.set(n.objectHash(),n)}),r}forEachSinglePaint(e){var n,o;let r=i=>{let a=i.asVolatilePaint();a!=null&&(e(a.from()),e(a.to()));let s=i.asSinglePaint();s!=null&&e(s)};this.fillPaints().forEach(r),this.strokePaints().forEach(r),er.supportsCodeSnapshot(this.type())&&this.codeSnapshot()&&this.codeSnapshot().paints&&this.codeSnapshot().paints.forEach(r),(o=(n=this.textData())==null?void 0:n.styleOverrideTable())==null||o.forEachFillPaint(this.scene(),i=>{i.forEach(r)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((i,a)=>{a.forEach(r)})}forEachEmojiInTextData(e){var r,n;this._cachedType!="TEXT"&&this._cachedType!="TEXT_PATH"||(n=(r=this.derivedTextData())==null?void 0:r.usedEmojiImages())==null||n.forEach(o=>{e(o)})}textHyperlinkBoxes(){var e;return this._cachedType!="TEXT"&&this._cachedType!="TEXT_PATH"?[]:((e=this.derivedTextData())==null?void 0:e.hyperlinkBoxes())??[]}textHasMixedFontSizes(){return this._cachedType!="TEXT"&&this._cachedType!="TEXT_PATH"||this.textData()==null||this.textData().fontSizes()===null?!1:this.textData().fontSizes()==="mixed"?!0:(v().prepareCppNodeForAccess(this),this.textData().fontSizes()!=v().textFacetTsApiGenerated().getFontSize(ne.PROTOTYPE_LIB))}restartGifs(){this.forEachSinglePaint(e=>{let r=e.image();if(r==null||!r.isGIF())return;let n=r.gif();n!=null&&n.restart()})}clipsToBoundingRectangle(){return er.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let r=this.absoluteTransform();return Math.abs(r.m00())<1e-4&&Math.abs(r.m11())<1e-4||Math.abs(r.m01())<1e-4&&Math.abs(r.m10())<1e-4}isAxisAlignedRectFill(){var e;return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&!!((e=this.fillGeometry())!=null&&e.isRect())&&this.isAxisAligned()}isInSymbol(){let e=!1;for(let r=this;r!=null;r=r.parent())if(r.type()=="SYMBOL"){e=!0;break}return e}_addScrollableChildFramesToListRecursive(e){for(let r of this._cachedChildren)r.scrollDirection()!="NONE"&&e.push(r),r._addScrollableChildFramesToListRecursive(e)}scrollableFrameDescendants(){let e=[];return this._addScrollableChildFramesToListRecursive(e),e}isGroup(){return er.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(e){let r=null;return no(this,n=>{if(!n.hasOwnConstraintValues())return 0;let o=e(n);if(r==null)r=new fe(o);else if(r.value!=o)return r=null,1;return 2}),r}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.verticalConstraint())}_withOverriddenFrameRole(e,r){this._scrollingLogic.overrideRole(e),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let n=0,o=this.childCount();n<o;n=n+1){let i=this.childAt1(n);i.isFixed()&&no(i,a=>{a._invalidateRenderTreeForSelf()})}r(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(e){this._withOverriddenFrameRole(1,e)}actingAsBaseScreenForRendertreeGeneration(e){this._withOverriddenFrameRole(0,e)}_translateFixedElementIfNecessary(e){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let r=this.parent();if(Xn.scrollsHorizontally(r.scrollDirection())){let n=this.horizontalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(r.size().x()-r.fullSize().x(),0):n.value=="CENTER"&&e.translate2((r.size().x()-r.fullSize().x())/2,0))}if(Xn.scrollsVertically(r.scrollDirection())){let n=this.verticalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(0,r.size().y()-r.fullSize().y()):n.value=="CENTER"&&e.translate2(0,(r.size().y()-r.fullSize().y())/2))}}hasPerRegionFillPaints(){var r;if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let e=(r=this.fillGeometry())==null?void 0:r.styleIDs;return e==null?!1:e.some(n=>n!=0)}forEachRegionWithFillPaintBatch(e){var i,a;let r=this.fillGeometry(),n=((i=this.vectorData())==null?void 0:i.paintOverrides)??null,o=this.fillPaints();if(!(n==null||r==null))for(let s=0;s<r.regions.length;s=s+1){let l=o;if(s<(((a=r.styleIDs)==null?void 0:a.length)??0)){let d=r.styleIDs[s],u=n.get(d,this.scene());u!=null&&(l=u)}let c=r.regions[s];e(c,l)}}relativeTransformAccountingForFixedOffset(){let e=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(e),e}absoluteTransform(){if(this.isRooted()&&1&this._flags){let e=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let r=this._cachedParent.absoluteTransform().clone();r.multiply(e),e=r}this._absoluteTransform=e,this._flags&=-2}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(e){this._absoluteTransform=e._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=e._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=e._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=e._cachedCanvasSpaceScrollingBounds,U.getFeatureFlags().prototype_animate_parent&&(this.sourceNodeForTransition=e)}_addFlagsToParents(e){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(e)}_addFlagsToSelfAndParents(e){for(let r=this;r!=null;r=r.parent())r._flags|=e}_addFlagsToSelfAndChildren(e){this._flags|=e;for(let r of this._cachedChildren)r._addFlagsToSelfAndChildren(e)}isFrameBackgroundVisible(){if(!er.isFrameLike(this.type()))return!1;let e=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(e==null)return N.alpha(this.computedBackgroundColor())>0;for(let r=0,n=e.length;r<n;r=r+1)if(e[r].isEnabledAndVisible())return!0;return!1}dependsOnBackgroundContent(){if(this.effects().filter(r=>r.isVisibleForRendering()&&r.dependsOnBackgroundContent()).length>0)return!0;let e=!1;return this.forEachChild(r=>{r.dependsOnBackgroundContent()&&(e=!0)}),e}hasNonZeroStrokeWeight(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getHasNonZeroStrokeWeight(ne.PROTOTYPE_LIB)}styleId(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().styleId(ne.PROTOTYPE_LIB)}inheritedStyleId(e){return v().prepareCppNodeForAccess(this),v().nodeTsApi().inheritedStyleId(e,ne.PROTOTYPE_LIB)}setInheritStyleId(e,r){return v().prepareCppNodeForAccess(this),v().nodeTsApi().setInheritStyleId(e,r,ne.PROTOTYPE_LIB)}setStyleSortPosition(e){return v().prepareCppNodeForAccess(this),v().nodeTsApi().setStyleSortPosition(e,ne.PROTOTYPE_LIB)}tableCellRowId(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().tableCellColumnId(ne.PROTOTYPE_LIB)}tableCellColumnId(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().tableCellColumnId(ne.PROTOTYPE_LIB)}getTableCellAt(e,r){v().prepareCppNodeForAccess(this);let n=v().nodeTsApi().getTableCellGuid(ne.PROTOTYPE_LIB,e,r);return this._scene.findNode(n)}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let e=this.fillOrTextGeometry(),r=this.strokeGeometry(),n=L.new2(),o=this.size();n.setTo1(0,0,o.x(),o.y());let i=new vt;i.include3(n),e!=null&&i.include3(e.bounds),r!=null&&this.strokeAlign()!="INSIDE"&&i.include3(r.bounds);let a=i.build();return a.transformInto1(a,this.absoluteTransform()),a}canvasSpacePreviewBounds(){let e=this.strokeGeometry(),r=this.fullSize();U.getFeatureFlags().viewer_ensure_nonzero_preview_bounds&&(r=r.max(new F(Number.EPSILON,Number.EPSILON)));let n=new vt;n.include3(new L(0,0,r.x(),r.y())),e!=null&&this.strokeAlign()!="INSIDE"&&n.include3(e.bounds);let o=n.build();if(o.transformInto1(o,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let i=this.parent().prototypeDevice(),a=i.type=="NONE"||i.type=="PRESENTATION"?this.parent().currentViewportSize():i.size(),s=this.findContainingCanvasOrParent();if(i=s.prototypeDevice(),a=i.type=="NONE"||i.type=="PRESENTATION"?s.currentViewportSize():i.size(),!o.size().min(a).equals(o.size())){let l=L.new4(this.canvasSpaceBoundingBox().topLeft(),a);o.intersectWith(l)}}return o}canvasSpaceBoundingBox(){let e=L.new2(),r=this.size();return e.setTo1(0,0,r.x(),r.y()),e.transformInto1(e,this.absoluteTransform()),e}fullSizeCanvasSpaceBoundingBox(){let e=L.new2(),r=this.originalSize();return e.setTo1(0,0,r.x(),r.y()),e.transformInto1(e,this.absoluteTransform()),e}_updateBoundsIfNeeded(){if(!this.isRooted()||!(4&this._flags))return;for(let n of this._cachedChildren)n._updateBoundsIfNeeded();Nt._geometryBuilder.reset(),Nt._renderedBuilder.reset(),Nt._scrollingBuilder.reset(),Nt._effectBuilder.reset();let e=0,r=this.effects();for(let n=0,o=r.length;n<o;n=n+1){let i=r[n];i.isEnabledAndVisible()&&i.type()=="FOREGROUND_BLUR"&&(e+=i.blurRadius())}e>0&&(Nt._effectBuilder.include1(-e,-e),Nt._effectBuilder.include1(e,e));for(let n=0,o=r.length;n<o;n=n+1){let i=r[n];if(i.isEnabledAndVisible()&&i.type()=="DROP_SHADOW"){let a=e+i.blurRadius()+i.spread();Nt._effectBuilder.include1(i.blurOffset().x()-a,i.blurOffset().y()-a),Nt._effectBuilder.include1(i.blurOffset().x()+a,i.blurOffset().y()+a)}}if(er.isGeometryLeaf(this.type())){let n=this.fillOrTextGeometry(),o=this.strokeGeometry(),i=this.absoluteTransform();n!=null&&Nt._geometryBuilder.include4(n.bounds,i),o!=null&&(this.strokeAlign()!="INSIDE"||n==null||n.regions.length==0||n.bounds.isInvalid())&&Nt._geometryBuilder.include4(o.bounds,i)}else for(let n of this._cachedChildren)n.isInvisibleOrTransparent()||(Nt._geometryBuilder.include3(n._cachedCanvasSpaceGeometryBounds),Nt._renderedBuilder.include3(n._cachedCanvasSpaceRenderedBounds)),n.visible()&&Nt._scrollingBuilder.include3(n._cachedCanvasSpaceScrollingBounds);if(er.isFrameLike(this.type())){let n=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let o=Nt._geometryBuilder.build(),i=Nt._renderedBuilder.build(),a=Nt._scrollingBuilder.build();o.intersectWith(n),i.intersectWith(n),a.intersectWith(n),Nt._geometryBuilder.reset(),Nt._renderedBuilder.reset(),Nt._scrollingBuilder.reset(),Nt._geometryBuilder.include3(o),Nt._renderedBuilder.include3(i),Nt._scrollingBuilder.include3(a)}if(this.containerSupportsFillStrokeAndCorners()){let o=this.fillOrTextGeometry(),i=this.strokeGeometry(),a=this.absoluteTransform();o!=null&&Nt._geometryBuilder.include4(o.bounds,a),i!=null&&(this.strokeAlign()!="INSIDE"||o==null||o.regions.length==0||o.bounds.isInvalid())&&Nt._geometryBuilder.include4(i.bounds,a)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(Nt._geometryBuilder.include3(n),Nt._renderedBuilder.include3(n)),Nt._scrollingBuilder.include3(n)}this._cachedCanvasSpaceGeometryBounds=Nt._geometryBuilder.build(),Nt._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Nt._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Nt._effectBuilder.isValidOrZeroArea()&&(Nt._effectBuilder.buildTo(Nt._effectBounds),Nt._renderedBuilder.include3(Nt._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Nt._effectBounds)),Nt._scrollingBuilder.include3(Nt._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Nt._effectBounds))),this._cachedCanvasSpaceRenderedBounds=Nt._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=Nt._scrollingBuilder.build(),this._flags&=-5}_handlePropertyChangeForBounds(e,r){switch(e){case 6:case 27:case 110:case 36:case 55:case 96:case 45:case 14:case 15:case 20:case 29:case 30:case 31:case 59:case 60:case 62:case 102:case 103:case 104:case 106:case 107:case 46:case 73:break;case 2:case 112:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),e==58&&r!=null&&r._addFlagsToSelfAndParents(4);break}}}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let n=this.parent();return n==null?(console.error("Orphaned table cell"),null):"T"+[n.id(),this.tableCellRowId(),this.tableCellColumnId()].map(i=>i).join(";")}if(!this.isInstanceSublayer())return this.id();let e=this;for(;e!=null&&!e.isPrimaryInstance();)e=e.parent();return e==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(n=>n).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return Nt._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return Nt._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let e=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=e||this.rectangleBottomLeftCornerRadius()!=e||this.rectangleBottomRightCornerRadius()!=e}isRoundedRect(){return this.type()=="RECTANGLE"||this.type()=="ROUNDED_RECTANGLE"||this.type()=="STAMP"||er.isFrameLike(this.type())}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let e=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new Na(1,Ae.FrozenVector_ZERO,this.size(),e,this.cornerSmoothing())}else return new Na(0,Ae.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(e,r,n){let o;if(this.type()=="ELLIPSE"){let i={m00:e.m00(),m01:e.m01(),m02:e.m02(),m10:e.m10(),m11:e.m11(),m12:e.m12()},a=v().getFillGeometryForSpread(i,r,this);o=new To(a)}else{let i=this._instantiateRoundedRect();i.transform(e),i.adjustCornerRadiiForSpread(r),o=At.fromRoundedRect(i)}return new Kt(new Gt(o,"NONZERO"),n)}strokeGeometryForSpread(e,r,n,o){let i,a=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,s=!n.subtractScalar(2*r+a*this.strokeWeight()).isPositive(),l=2-a;if(Ce.containsAtLeastOneVisiblePaint(this.fillPaints())||s){let c=Q.new2(),u=n.addScalar(this.strokeWeight()*l).addScalar(2*r).divide(n),p=-r-this.strokeWeight()*l/2;if(c.translate2(p,p),c.scale3(u),this.type()=="ELLIPSE"){let _=new L(0,0,this.size().x(),this.size().y());c.transformRect(_),i=Lt.forEllipse(_)}else{let _=this._instantiateRoundedRect();_.transform(c),i=Lt.fromRoundedRectWithSpread(_,r+l*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*r<=0)return null;if(this.type()=="ELLIPSE"){let c=L.new4(Ae.FrozenVector_ZERO,this.size());e.transformRect(c),c.expand1(l*this.strokeWeight()/2),i=Lt.forEllipse(c),c.contract(2*r+this.strokeWeight()),i.append(Lt.forEllipse(c))}else{let c=this._instantiateRoundedRect();c.transform(e),c.expand(l*this.strokeWeight()/2),i=Lt.fromRoundedRectWithSpread(c,r+l*this.strokeWeight()/2),c.contract(2*r+this.strokeWeight()),i.append(Lt.fromRoundedRectWithSpread(c,-(2*r+this.strokeWeight())))}}return new Kt(new Gt(i,"ODD"),o)}isTopLevel(){return this.parentOrTransitionSourceNodeParent()!=null&&this.parentOrTransitionSourceNodeParent().isTopLevelParent()}isTopLevelParent(){return Nt.isTopLevelParentNodeType(this.type())}static isTopLevelParentNodeType(e){return e=="CANVAS"||e=="SECTION"||e=="SLIDE_ROW"||e=="SLIDE_GRID"||e=="MODULE"}topLevelAncestor(){let e=this;for(;e!=null;){if(e.isTopLevel())return e;e=e.parent()}return null}isSlideModule(){return this.type()=="MODULE"&&this.childCount()==1&&this.childAt1(0).type()=="SLIDE"}hasBeenManuallyRenamed(){return v().prepareCppNodeForAccess(this),v().nodeTsApi().getHasBeenManuallyRenamed(ne.PROTOTYPE_LIB)}canvas(){if(this.type()=="CANVAS")return this;let e=this.findContainingCanvasOrParent();return(e==null?void 0:e.type())=="CANVAS"?e:null}isAncestorOf(e){for(let r=e;r!=null;r=r.parent())if(r==this)return!0;return!1}forSelfAndAncestors(e){for(let r=this;r!=null;r=r.parent())e(r)}findContainingStateGroupOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.isStateGroup())return e;return null}findContainingScrollingFrameOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.scrollDirection()!="NONE"&&!e.isTooRotatedToScroll())return e;return null}findContainingInstanceOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.type()=="INSTANCE")return e;return null}findAllSectionsInNode(){let e=this,r=[];r.push(e);let n=[];for(;r.length>0;){let o=r.shift();for(let i=0,a=o.childCount();i<a;i=i+1){let s=o.childAt1(i);s!=null&&s.type()=="SECTION"&&(r.push(s),n.push(s))}}return n}findAllTopLevelNodesInNode(e){let r=[];if(e.type()!="CANVAS"&&e.type()!="SECTION")return r;let n=[];for(n.push(e);n.length>0;){let o=n.shift();for(let i=0,a=o.childCount();i<a;i=i+1){let s=o.childAt1(i);s.type()=="SECTION"&&n.push(s),r.push(s)}}return r}buildAncestors(){let e=[];return this.forSelfAndAncestors(r=>{e.push(r)}),e.reverse(),e}isAboveInLayerOrder(e){let r=this.buildAncestors(),n=e.buildAncestors();for(let o=0,i=Math.min(r.length,n.length);o<i;o=o+1)if(r[o]!=n[o]){let a=r[o],s=n[o];return a.indexInParent()>s.indexInParent()}return r.length==n.length?!1:r.length>n.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Math.PI/180}debugString(){let e="";if(e+=this.hierarchyString()+`

`,this.type()=="INSTANCE"){let r=`stablePath: ${this.stablePath()}`;e+=r+`

`}return e+=`{
`,this.each((r,n)=>{e+=`  ${Ht[r]}: ${pt.toString(n)}
`}),e+="}",e+=`

`,e}paintsDebugString(){let e=this.strokePaints().some(r=>r.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(r=>r.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(r=>r.debugString()).join(", ")}]`+e}_makeIndent(e,r){let o="";if(r){for(let i=0,a=2*(e-1);i<a;i=i+1)o+="-";return o+="> ",o}else{for(let i=0,a=2*e;i<a;i=i+1)o+=" ";return o}}hierarchyString(){let e=[],r=this._hierarchyStringForAncestors(e);return r==0&&(e.push("(null parent)"),r=r+1),this._hierarchyStringWithChildren(r,!0,e),e.join(`
`)}_hierarchyStringLocal(e,r){let n=this._makeIndent(e,r);return n+=`${this.type()}: '${this.name()??"null"}' (${this.id()})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(n+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(n+=` (overrideKey: ${this.overrideKey()})`),this.type()=="INSTANCE"&&(n+=` (symbol: ${this.symbolID()??"null"})`),n+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,n}_hierarchyStringForAncestors(e){let r=0,n=[];for(this.forSelfAndAncestors(o=>{o!=this&&n.push(o)});n.length>0;)e.push(n.pop()._hierarchyStringLocal(r,!1)),r=r+1;return r}_hierarchyStringWithChildren(e,r,n){n.push(this._hierarchyStringLocal(e,r));for(let o=0,i=this.childCount();o<i;o=o+1)this.childAt1(o)._hierarchyStringWithChildren(e+1,!1,n)}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlursAndGlassEffects=null,this._renderTreeWithoutGlassEffects=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._renderTreeWithoutEffects=null}invalidateRenderTreeForSelfAndParents(){for(let e=this;e!=null;e=e.parent())e._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let e=0,r=this.childCount();e<r;e=e+1){let n=this.childAt1(e);n._invalidateRenderTreeForSelf(),n.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundRenderTrees(e,r){var a;let n=this.topLevelAncestor();if(!this.isTopLevelParent()&&(n==null||!e.has(n.id())))return!1;let o=((a=this._renderTree)==null?void 0:a.value)??null;if(o!=null&&!o.dependsOnBackgroundContent())return!1;if(this.transitioningFrom!=null){if(o==null||o.dependsOnBackgroundContent()){let s=this.topLevelAncestor();if(s!=null&&e.has(s.id()))return this._invalidateRenderTreeForSelf(),!0}return!1}let i=!1;for(let s=0,l=this.childCount();s<l;s=s+1)i=this.childAt2(s,!0).invalidateNestedBackgroundRenderTrees(e,r)||i;if(i)return this._invalidateRenderTreeForSelf(),!0;if(!er.isGeometryLeaf(this.type())&&!er.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let s=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let l=0,c=this.effects().length;l<c;l=l+1){let d=this.effects()[l];if(d.isVisibleForRendering()&&d.dependsOnBackgroundContent()){let u=L.new3(s).expandedBy1(d.blurRadius()),p=!1,_=this.topLevelAncestor();if(_!=null&&e.has(_.id())&&(p=!0),p)return this._invalidateRenderTreeForSelf(),r.push(u),!0}else if(d.isVisibleForRendering()&&d.type()=="GLASS"){let u=L.new3(s).expandedBy1(Math.max(d.reflectionDistance(),d.blurRadius())),p=!1,_=this.topLevelAncestor();if(_!=null&&e.has(_.id())&&(p=!0),p)return this._invalidateRenderTreeForSelf(),r.push(u),!0}}}return!1}getCachedRenderTree(){return this._renderTree}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTree1(e=null){return this.renderTree2(new gt(this),e)}renderTree2(e,r=null){var o,i,a;let n=e.overlayRenderData();if(n!=null&&n.hasTransition()&&e.dependsOnBackgroundContent()){let s=new or(0,r);return ct.generateRenderTree(e,s)}if(this._renderTree==null){let s=new or(0,r),l=null;this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{l=ct.generateRenderTree(e,s)}),this._renderTree=l!=null?new fe(l):null,(((o=this._renderTree)==null?void 0:o.value)==null||!this._renderTree.value.hasBackgroundBlurs()&&!this._renderTree.value.hasGlassEffects())&&(this._renderTreeWithoutBackgroundBlursAndGlassEffects=this._renderTree),(((i=this._renderTree)==null?void 0:i.value)==null||!this._renderTree.value.hasGlassEffects())&&(this._renderTreeWithoutGlassEffects=this._renderTree)}return((a=this._renderTree)==null?void 0:a.value)??null}renderTreeForBaseScreen1(e=null){return this.renderTreeForBaseScreen2(new gt(this))}renderTreeForBaseScreen2(e,r=null){var n;if(this._renderTreeAsBaseScreen==null){let o=new or(0,r);this.actingAsBaseScreenForRendertreeGeneration(()=>{let i=ct.generateRenderTree(e,o);this._renderTreeAsBaseScreen=i!=null?new fe(i):null})}return((n=this._renderTreeAsBaseScreen)==null?void 0:n.value)??null}renderTreeWithoutBackgroundBlursAndGlassEffects(e=null){var r;if(this._renderTreeWithoutBackgroundBlursAndGlassEffects==null){let n=new gt(this),o=new or(2,e),i=ct.generateRenderTree(n,o);this._renderTreeWithoutBackgroundBlursAndGlassEffects=i!=null?new fe(i):null}return((r=this._renderTreeWithoutBackgroundBlursAndGlassEffects)==null?void 0:r.value)??null}renderTreeWithoutGlassEffects(e=null){var r;if(this._renderTreeWithoutGlassEffects==null){let n=new gt(this),o=new or(3,e),i=ct.generateRenderTree(n,o);this._renderTreeWithoutGlassEffects=i!=null?new fe(i):null}return((r=this._renderTreeWithoutGlassEffects)==null?void 0:r.value)??null}renderTreeForShadowRoot1(e=null){return this.renderTreeForShadowRoot2(new gt(this))}renderTreeForShadowRoot2(e,r=null){var n;if(this._renderTreeForShadowRoot==null){let o=new or(1,r,e.uniqueIdentifier()),i=ct.generateRenderTree(e,o);this._renderTreeForShadowRoot=i!=null?new fe(i):null}return((n=this._renderTreeForShadowRoot)==null?void 0:n.value)??null}renderTreeForShadowDescendant1(e=null){return this.renderTreeForShadowDescendant2(new gt(this),e)}renderTreeForShadowDescendant2(e,r=null){var n;if(this._renderTreeForShadowDescendant==null){let o=new or(1,r),i=ct.generateRenderTree(e,o);this._renderTreeForShadowDescendant=i!=null?new fe(i):null}return((n=this._renderTreeForShadowDescendant)==null?void 0:n.value)??null}renderTreeForKnockoutShadowRoot1(e=null){return this.renderTreeForKnockoutShadowRoot2(new gt(this))}renderTreeForKnockoutShadowRoot2(e,r=null){var n;if(this._renderTreeForKnockoutShadowRoot==null){let o=new or(4,r,e.uniqueIdentifier()),i=ct.generateRenderTree(e,o);this._renderTreeForKnockoutShadowRoot=i!=null?new fe(i):null}return((n=this._renderTreeForKnockoutShadowRoot)==null?void 0:n.value)??null}renderTreeForKnockoutShadowDescendant1(e=null){return this.renderTreeForKnockoutShadowDescendant2(new gt(this),e)}renderTreeForKnockoutShadowDescendant2(e,r=null){var n;if(this._renderTreeForKnockoutShadowDescendant==null){let o=new or(4,r),i=ct.generateRenderTree(e,o);this._renderTreeForKnockoutShadowDescendant=i!=null?new fe(i):null}return((n=this._renderTreeForKnockoutShadowDescendant)==null?void 0:n.value)??null}renderTreeForOverlay(e,r=null){let n=!1,o=e.overlayRenderData();o!=null&&this._overlayCacheKey!=o.overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),n=!0);let i=this.renderTree2(e,r);return n&&o!=null&&(this._overlayCacheKey=o.overlayCacheKey()),i}renderTreeForSlideThumbnail1(e=null){return this.renderTreeForSlideThumbnail2(new gt(this))}renderTreeForSlideThumbnail2(e,r=null){let n=new or(5,r),o=ct.generateRenderTree(e,n),i=o!=null?new fe(o):null;return(i==null?void 0:i.value)??null}renderTreeWithoutEffects(e=null){var r;if(this._renderTreeWithoutEffects==null){let n=new gt(this),o=new or(6,e),i=ct.generateRenderTree(n,o);this._renderTreeWithoutEffects=i!=null?new fe(i):null}return((r=this._renderTreeWithoutEffects)==null?void 0:r.value)??null}_handlePropertyChangeForRenderTree(e,r){switch(e){case 70:case 84:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 58:{this.invalidateRenderTreeForSelfAndParents(),r!=null&&r.invalidateRenderTreeForSelfAndParents();break}case 18:case 60:{let n=this.findAllTopLevelNodesInNode(this);for(let o=0,i=n.length;o<i;o=o+1){let a=n[o];a!=null&&a.invalidateRenderTreeForSelfAndParents()}break}case 2:case 12:case 3:case 4:case 6:case 24:case 25:case 35:case 37:case 38:case 48:case 42:case 71:case 40:case 72:case 49:case 75:case 86:case 87:case 88:case 97:case 98:case 99:case 19:case 13:case 108:case 112:case 21:case 91:case 93:case 94:case 90:case 1:case 23:case 96:case 16:case 68:case 69:case 64:case 65:case 66:case 17:case 45:{this.invalidateRenderTreeForSelfAndParents();break}}}static _applyEffectSpread(e,r){if(r!=null){let n=e.clone();return n.translate1(r.centerX(),r.centerY()),n.expand2(r.width()/2,r.height()/2),n}return e}static _computeRegionPaintsFromStyles(e,r,n){if(r==null||r.length==0)return Nt.EMPTY_REGION_PAINTS;if(e!=null){let o=r!=null?r.filter(s=>s.isEnabledAndVisible()):[],i=new Map,a=e.paintOverrides;return e.regions.map(s=>{let l=o,c=s.styleID;if(c!=0&&a!=null){let d=nr.IntMap_get(i,c,null);if(d==null){let u=a.get(c,n);u!=null&&(d=u.filter(p=>p.isEnabledAndVisible()),i.set(c,d))}d!=null&&(l=d)}return l})}return Nt.EMPTY_REGION_PAINTS}};Nt._geometryBuilder=new vt,Nt._renderedBuilder=new vt,Nt._scrollingBuilder=new vt,Nt._effectBuilder=new vt,Nt._effectBounds=L.new2(),Nt.EMPTY_REGION_PAINTS=[];var $g=Nt;var OO=class{constructor(e,r){this.clone=e,this.source=r}},NO=class{constructor(e,r){this.transitionRootStablePath=e,this.cloneOps=r}},mu=class extends Kg{constructor(e,r){super(),this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=r,this._alwaysSetGlobalNode=Bt.getFeatureGate("prototype_always_set_global_node"),r.addFrameObserver(this._prototype())}modules(){return this._modules}appState(){return this._appState}nodeTsApi(){var e;return(e=this._modules)==null?void 0:e.nodeTsApi}nodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.nodeTsApiGenerated}layoutFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.layoutFacetTsApiGenerated}sceneGraphTsApi(){var e;return(e=this._modules)==null?void 0:e.sceneGraphTsApi}_prototype(){var e;return(e=this._modules)==null?void 0:e.prototype}fonts(){var e;return(e=this._modules)==null?void 0:e.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,r,n,o){let i=this._prototype().getNodeChangesForSwap(e.guids,r,n),a=this._appState.scene(),s=i.clones.map(l=>{let c=a.findNode(l.clone),d=a.findNode(l.source);return o&&d===null&&Re.trackDefinedEvent("prototype.null_source_for_swap_v2",{sourceNodeId:l.source}),new OO(c,d)});return new NO(new Rt(i.transitionRootStablePath),s)}runSetVariable(e,r,n,o){return this._prototype().runSetVariable(e,r,n,o)}runSetVariableMode(e,r,n){return this._prototype().runSetVariableMode(e,r,n)}getFirstTruthyConditionalIndex(e,r){return this._prototype().getFirstTruthyConditionalIndex(e,r)}getICActionsForSetVariableAction(e,r,n,o,i){return this._prototype().getICActionsForSetVariableAction(e,r,n,o,i)}shouldDisallowSwap(e,r){return this._prototype().shouldDisallowSwap(e.guids,r)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}getChangedVariables(){return this._prototype().getChangedVariables()}updateImmutableFramesAndLayoutDirtyGroupsAndStacks(){this._prototype().updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}prepareCppNodeForAccess(e){(this._alwaysSetGlobalNode||e!=this._cachedViewNode)&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,r){let n=this._prototype().initializeActiveSceneWithDangerousLoadingFlag(e,r),o=po.instance.findScene(n);if(o==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(o),o}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}updateCurrentBaseScreenIDs(e){this._prototype().updateCurrentBaseScreenIDs(e)}cloneNode(e){return this._prototype().cloneNode(e)}setNodeToInitialObjectAnimationState(e,r){this._prototype().setNodeToInitialObjectAnimationState(e,r)}setNodeToFinalObjectAnimationState(e,r){this._prototype().setNodeToFinalObjectAnimationState(e,r)}previewSceneAt(e,r,n){this._prototype().previewSceneAt(e,r,n)}updatePrototypeDevice(e){this._prototype().setOverridePrototypeDevice(e,ne.PROTOTYPE_LIB)}updateResponsiveSize(e,r,n){this._prototype().updateResponsiveSize(e,r,n)}isOrContainsBaseScreen(e){return this._prototype().isOrContainsBaseScreen(e)}resetLocalVariableChanges(){this._prototype().resetLocalVariableChanges()}resetLocalVariableModeChanges(){this._prototype().resetLocalVariableModeChanges()}resetLocalNodeSizeChanges(e){this._prototype().resetLocalNodeSizeChanges(e)}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,en)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,r){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(r.guids)}idlRegionsToGeometry(e,r){if(e===null||e==null)return null;let n=[],o=[];vt.INSTANCE.reset();for(let a of e){let s=new To(a.path),l=new Gr(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());n.push(l),o.push(a.styleID),vt.INSTANCE.include3(l.bounds())}let i=r??new di(new Bn(new Map));return new Ur(n,o,vt.INSTANCE.build(),i)}idlRegionsToTextGeometry(e,r){if(e==null)return null;let n=[],o=[],i=[],a=[],s=new Map,l="apple";vt.INSTANCE.reset();for(let d=0;d<e.length;d++){let u=e[d],p=new To(u.path),_=u.decorationPath!=null?new To(u.decorationPath):void 0,h=new Gr(u.windingRule==1?"ODD":"NONZERO",u.styleID,p,p.bounds());if(n.push(h),i.push(u.styleID),_){let g=new Gr(u.windingRule==1?"ODD":"NONZERO",u.styleID,_,_.bounds());o.push(g),i.push(u.styleID)}if(a.push(u.emojiCodePoints),u.emojiCodePoints.length&&u.emojiRotation!=0){let g=[u.emojiRotation,u.emojiUnrotatedSize.x,u.emojiUnrotatedSize.y];s.set(d,g)}l=u.emojiImageSet,vt.INSTANCE.include3(h.bounds())}let c=r??new di(new Bn(new Map));return new zm(n,i,vt.INSTANCE.build(),c,a,s,l,o)}getFillGeometryForSpread(e,r,n){return this.prepareCppNodeForAccess(n),this._prototype().getFillGeometryForSpread(e,r,ne.PROTOTYPE_LIB)}getAffineTransform(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(r),new Q(Mt.retAffineTransform_m00,Mt.retAffineTransform_m01,Mt.retAffineTransform_m02,Mt.retAffineTransform_m10,Mt.retAffineTransform_m11,Mt.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new Q(Mt.retAffineTransform_m00,Mt.retAffineTransform_m01,Mt.retAffineTransform_m02,Mt.retAffineTransform_m10,Mt.retAffineTransform_m11,Mt.retAffineTransform_m12)}getArcData(e,r){this.prepareCppNodeForAccess(e),this._prototype().getArcData(r);let n={};return n.startingAngle=Mt.retArcData_startAngle,n.endingAngle=Mt.retArcData_endAngle,n.innerRadius=Mt.retArcData_innerRadius,n}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let r={};return r.startingAngle=Mt.retArcData_startAngle,r.endingAngle=Mt.retArcData_endAngle,r.innerRadius=Mt.retArcData_innerRadius,r}getBool(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getBool(r)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getCodeSnapshot(e,r){var n;return this.prepareCppNodeForAccess(e),(n=this._prototype())==null?void 0:n.getCodeSnapshot()}getCodeSnapshot_SGEO(e){var r;return(r=this._prototype())==null?void 0:r.getCodeSnapshot_SGEO(e)}getDouble(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(r)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){var r;return this.prepareCppNodeForAccess(e),((r=this._prototype())==null?void 0:r.getEffectList())??[]}getEffectList_SGEO(e){var r;return((r=this._prototype())==null?void 0:r.getEffectList_SGEO(e))??[]}getTransformModifierList(e){var r;return this.prepareCppNodeForAccess(e),((r=this._prototype())==null?void 0:r.getTransformModifierList())??[]}getTransformModifierList_SGEO(e){var r;return((r=this._prototype())==null?void 0:r.getTransformModifierList_SGEO(e))??[]}getGUID(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(r),X._new(Mt.retGUID_sessionId,Mt.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),X._new(Mt.retGUID_sessionId,Mt.retGUID_localId)}getStyleId(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(r),{guid:Mt.retStyleId.guid,ref:Mt.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:Mt.retStyleId.guid,ref:Mt.retStyleId.ref}}getInt(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getInt(r)}getInt_SGEO(e,r){return this._prototype().getInt_SGEO(e,r)}getPaintList(e,r){var n;return this.prepareCppNodeForAccess(e),((n=this._prototype())==null?void 0:n.getPaintList(r))??[]}getPaintList_SGEO(e){var r;return((r=this._prototype())==null?void 0:r.getPaintList_SGEO(e))??[]}getField(e,r){this.prepareCppNodeForAccess(e);let n=this._prototype().getField(r);if(n.length==0)return null;let o=Be().decodeMessage(n);if(o.nodeChanges===void 0||o.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let i=o.nodeChanges[0],a=[],s=null;return this._appState.serialization().decodeNodeChange(i,a,(l,c)=>{s=c}),s}getField_SGEO(e){let r=this._prototype().getField_SGEO(e);if(r.length==0)return null;let n=Be().decodeMessage(r);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let o=n.nodeChanges[0],i=[],a=null;return this._appState.serialization().decodeNodeChange(o,i,(s,l)=>{a=l}),a}getParentIndex(e){this.prepareCppNodeForAccess(e);let r=this._prototype().getParentIndex();return vn.fromString(r)}getParentIndex_SGEO(e){return vn.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){var n;let r=(n=this._prototype())==null?void 0:n.getPrototypeInteractions_SGEO(e);return!r||!za.WeakHandle_isValid(r)?[]:this._modules.prototypeInteractions_Internal.getOrCreateViewerJsCopy(r)}getString(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getString(r)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getVector(r),new F(Mt.retVector_x,Mt.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new F(Mt.retVector_x,Mt.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new Rt(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new Rt(this._prototype().stablePath())}getClipId(e){this.prepareCppNodeForAccess(e);let r=this._prototype();return r?r.clipId():X.invalid()}getTimelineDuration(e){this.prepareCppNodeForAccess(e);let r=this._prototype();return r?parseInt(r.timelineDuration(),10):0}hasNodeProperty(e,r){return this.prepareCppNodeForAccess(e),this._prototype().hasNodeProperty(r)}forEachField(e,r){this.prepareCppNodeForAccess(e),Mt.forEachFieldCallback=r,this._prototype().forEachField(),Mt.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!Yr())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!Yr())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!Yr())throw new Error("Should not be calling updateSymbolInstancesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!Yr())throw new Error("Should not be calling updateStylesForTests outside of tests");this._prototype().updateStylesForTests()}updateFontForTests(e,r){if(!Yr())throw new Error("Should not be calling updateFontForTests outside of tests");this._prototype().updateFontForTests(e,r)}clearWaitingForFontListForTesting(){if(!Yr())throw new Error("Should not be calling clearWaitingForFontListForTesting outside of tests");this._prototype().clearWaitingForFontListForTesting()}initializeRenderer(){this._prototype().initializeRenderer()}topLevelPrototypeStartingPointsSorted(e){return this._prototype().topLevelPrototypeStartingPointsSorted(e)??[]}},eS=class eS{isReady(){return this._isReady}createScene(e){return new Me(e)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,r,n){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,n)}getSceneLoadingPhase(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.getSceneLoadingPhase()}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}willReceiveNodeChanges(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.willReceiveNodeChanges()}didReceiveNodeChanges(e,r){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,r)}setMultiplayer(e){this._multiplayer=e}findScene(e){var r;return(r=v().modules().prototype)==null?void 0:r.getScene(e)}findNode(e){return nr.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let r=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,r}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,r){Re.trackEvent(e,r)}triggerViewerEvent(e,r){this._viewer!==null&&this._viewer.trigger(e,r)}getBaseScreenId(){var e,r;return((r=(e=this._viewer)==null?void 0:e.getBaseScreenId)==null?void 0:r.call(e))??""}isScalingModeResponsive(){var e,r;return((r=(e=this._viewer)==null?void 0:e.isScalingModeResponsive)==null?void 0:r.call(e))??!1}Node_created(e,r,n,o){if(r!=null){let i=new $g(e,r,X._new(n,o));this._nodes.set(e,i),r.dangerouslyRegisterNode(i)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let r=this.findNode(e);if(r!=null){let n=r.scene();n!=null&&n.dangerouslyUnregisterNode(r.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,r,n){let o=this.findNode(e);if(o==null)return;let i=o.scene();if(i!=null){let a=r,s=o.id(),l=pL(v(),i,s,a,n),c=null,d=!1;a==114?pt.asStringEnum(l,"CREATED")=="CREATED"?(c="REMOVED",d=!0):c="CREATED":c=Hg(v(),o,a),i.broadcastPropertyChange(new Hf(o,a,l,c)),d&&i.dangerouslyUnregisterNode(s)}}updateNodeAfterPropertyChange(e,r){let n=this.findNode(e);n!=null&&n.updateAfterPropertyChange(r)}linkNodeToParent(e,r,n){let o=this.findNode(e);o!=null&&o.linkToParent(this.findNode(r),n)}unlinkNodeFromParent(e){let r=this.findNode(e);r!=null&&r.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}retAffineTransform(e,r,n,o,i,a){Mt.retAffineTransform_m00=e,Mt.retAffineTransform_m01=r,Mt.retAffineTransform_m02=n,Mt.retAffineTransform_m10=o,Mt.retAffineTransform_m11=i,Mt.retAffineTransform_m12=a}retArcData(e,r,n){Mt.retArcData_startAngle=e,Mt.retArcData_endAngle=r,Mt.retArcData_innerRadius=n}retGUID(e,r){Mt.retGUID_sessionId=e,Mt.retGUID_localId=r}retStyleId(e){Mt.retStyleId=e}retVector(e,r){Mt.retVector_x=e,Mt.retVector_y=r}forEachFieldCallback(e){Mt.forEachFieldCallback!=null&&Mt.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._multiplayer=null,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}};eS.instance=new eS;var po=eS,Mt;(g=>(g.retAffineTransform_m00=0,g.retAffineTransform_m01=0,g.retAffineTransform_m02=0,g.retAffineTransform_m10=0,g.retAffineTransform_m11=0,g.retAffineTransform_m12=0,g.retArcData_startAngle=0,g.retArcData_endAngle=0,g.retArcData_innerRadius=0,g.retGUID_sessionId=0,g.retGUID_localId=0,g.retStyleId=null,g.retVector_x=0,g.retVector_y=0,g.forEachFieldCallback=null))(Mt||(Mt={}));var tS=16,rS=class{constructor(e){this._history=[];this._sessionActions=[];this._isRecording=!1;this._startingLoc="-1:-1";this._startRecordingTime=-1;this._endRecordingTime=-1;this._appState=e}isRecording(){return this._isRecording}startRecording(){this._isRecording||(this._sessionActions=[],this._startingLoc=this._appState.baseScreenNode().id(),this._startRecordingTime=Date.now(),this._isRecording=!0)}stopRecording(){this._isRecording&&(this._endRecordingTime=Date.now(),this._isRecording=!1)}addHistoricalEvent(e){if(!this._isRecording)return;e.action==tS&&this._sessionActions.length>0&&this._sessionActions[this._sessionActions.length-1].action==tS&&e.targetPath==this._sessionActions[this._sessionActions.length-1].targetPath&&this._sessionActions.pop(),this._sessionActions.push(e)}getHistory(){return{actions:this._sessionActions,startingNodeGUID:this._startingLoc,startTime:this._startRecordingTime,endTime:this._endRecordingTime}}setHistory(e){this._sessionActions=e.actions,this._startingLoc=e.startingNodeGUID,this._startRecordingTime=e.startTime,this._endRecordingTime=e.endTime}};var x_;(a=>{function t(s,l,c){s.set(l,c)}a.Map_set1=t;function e(s,l){return s.get(l)}a.Map_get1=e;function r(s,l,c){let d=s.get(l);return d!==void 0?d:c}a.Map_getOrDefault=r;function n(s){return Array.from(s.keys())}a.Map_keys=n;function o(s){return Array.from(s.values())}a.Map_values=o;function i(s,l){let c=new Map;for(let d=0,u=s.length;d<u;d=d+1)c.set(s[d],l[d]);return c}a.Map_new1=i})(x_||(x_={}));var NL;(n=>{function t(o,i){return o.get(i)}n.WeakMap_get1=t;function e(o,i,a){o.set(i,a)}n.WeakMap_set1=e;function r(o,i){let a=new WeakMap;for(let s=0,l=o.length;s<l;s=s+1)a.set(o[s],i[s]);return a}n.WeakMap_new1=r})(NL||(NL={}));function PO(t,e){return!!t&&!!e&&t.guid===e.guid&&t.collectionKey===e.collectionKey&&(t.extendedCollectionId??null)===(e.extendedCollectionId??null)}var Qs=class t{startAnimation(e,r){this._animationCurve=e,this._animationStartTime=Ze.seconds(),this._animationEndTime=this._animationStartTime+r}animationProgress(){let e=(Ze.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==t.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=t.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(e=>{let t;(o=>(o[o.EASE_IN_OUT=0]="EASE_IN_OUT",o[o.DECAY=1]="DECAY"))(t=e.Curve||(e.Curve={}))})(Qs||(Qs={}));var Ti=class Ti{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new nS,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=F.new(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=L.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=F.new(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=L.new2()}pixelSpaceBounds(e){let r=this.viewSpaceBounds();return new L(r.left()*e,r.top()*e,r.width()*e,r.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return U.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return U.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=Q.new2().copyFrom(wt.FrozenAffineTransform_IDENTITY);return e.copyFrom(wt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return U.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let r=this.viewSpaceToClipSpace();return r.multipliedBy2(this.canvasSpaceToViewSpace2(e)),r}computeCanvasSpaceBounds1(e){U.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,r){this._boundsMapping.computeCanvasSpaceBounds(e,r)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){this.viewSpaceBounds().equals(e)||(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,r,n,o){e==1?this._setCameraWithAnimation(r,n,Qs.Curve.EASE_IN_OUT,o):(this._isAnimating=!1,(!this.offset().equals(r)||this.zoomScale()!=n)&&(this._setCanvasSpaceOffsetTo(r),this._boundsMapping.setViewPixelsPerCanvasPixel(n),this._isInvalid=!0))}_setCamera2(e,r,n){this._setCamera1(e,r,n,Ti.ANIMATION_DURATION)}_setCameraWithAnimation(e,r,n,o){this._animationManager.startAnimation(n,o),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(r),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(Fr.Math_clamp(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),Fr.Math_clamp(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=Fr.Math_clamp(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),r=Fr.Math_clamp(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),n=1e-6;if(Math.abs(this.offsetX()-e)>n||Math.abs(this.offsetY()-r)>n)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new F(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new F(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new F(e,this.offset().y()))),this.offsetY()!=r&&(this._animationOffsetStart=new F(this._animationOffsetStart.x(),r),this._animationOffsetEnd=new F(this._animationOffsetEnd.x(),r),this._setCanvasSpaceOffsetTo(new F(this.offset().x(),r))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new F(e,r),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,r){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),r)}adjustCameraZoom1(e,r){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*r)}adjustCameraZoom2(e,r,n){let o=e==1&&this._isAnimating;this._setCamera1(e,o?this._animationOffsetEnd:this.offset(),(o?this._animationZoomScaleEnd:this.zoomScale())*r,n)}adjustCameraZoomRounded(e,r){let n=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((n?this._animationZoomScaleEnd:this.zoomScale())*r)/Math.log(2))))}setCameraOffset1(e,r){this.setCameraOffset2(e,r,Ti.ANIMATION_DURATION)}setCameraOffset2(e,r,n){let o=e==1&&this._isAnimating;this._setCamera1(e,r,o?this._animationZoomScaleEnd:this.zoomScale(),n),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add(e.divideScalar(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,r){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add(e.divideScalar(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),Qs.Curve.DECAY,r),this._clampCameraOffset()}adjustCameraZoomWithPin(e,r){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add(r.subtract(this.viewSpaceBounds().size().divideScalar(2)).multiplyScalar(1/n-1/this.zoomScale())),n),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,r,n){let o=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add(n.subtract(this.viewSpaceBounds().size().divideScalar(2)).divideScalar(o)).subtract(r.subtract(this.viewSpaceBounds().size().divideScalar(2)).divideScalar(this.zoomScale())),o),this._clampCameraOffset()}zoomToFit1(e,r,n){this._zoomToFit(e,r,Ti.ZOOM_TO_FIT_PADDING,n)}zoomToFit2(e,r){this._zoomToFit(e,r,Ti.ZOOM_TO_FIT_PADDING,Ti.ANIMATION_DURATION)}zoomToFitExactly(e,r){this._zoomToFit(e,r,0,Ti.ANIMATION_DURATION)}_zoomToFit(e,r,n,o){r.isEmpty()||(this._setCamera1(e,r.center().negative(),this.viewSpaceBounds().size().subtractScalar(2*n).divide(r.size()).minComponent(),o),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract(this._animationOffsetStart).multiplyScalar(e).add(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,r,n){let o=go.canvasSpaceContentSize(e,n);if(!o||o.x()===0||o.y()===0)return 1;switch(r.fitMode){case"scale-down-width":return o.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/o.x():1;case"fit-width":return this.viewSpaceBounds().width()/o.x();case"scale-down":case"contain-with-zoom":case"contain":{let i=1/Math.max(o.x()/this.viewSpaceBounds().width(),o.y()/this.viewSpaceBounds().height());return r.fitMode=="scale-down"&&(i=Math.min(i,1)),i=Math.ceil(i*e.y())/e.y(),i}case"min-zoom":return 1;case"none":return 1;case"free":return 0;default:return 1}}_clampedZoomScale(e){let r=Math.max(this._minZoom,Ti.ZOOM_MIN);return Math.max(r,Math.min(e,Ti.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,r,n){return n!=null&&Al.hasDevice(n.type)?go.adjustNodeBoundsForDevice(e,n):U.isInlinePreview()?e:r}_snapOffsetToPixelGrid(e,r){let n=e.add(r).multiplyScalar(this.zoomScale()*2);n.setX(Math.floor(n.x())),n.setY(Math.floor(n.y()));let o=n.divideScalar(this.zoomScale()*2).subtract(r);return r.add(o.subtract(e))}_calculateBoundsForClamping(e,r){let n=this._boundsOfDevicePreview.isInvalid()?L.new2():this._boundsOfDevicePreview,o=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,n.width()/2),i=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,n.height()/2),a=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,n.width()/2),s=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,n.height()/2),l=-n.right()+o,c=-n.bottom()+i,d=-n.left()-a,u=-n.top()-s,p=d-l,_=u-c;r.setTo1(l,c,p,_)}_updateBoundsForClamping(){let e=L.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,r,n){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),r,n)}updateForCurrentPreview(e,r,n,o){if(r==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,r,o)),this._minZoom=this.getScaleFactorForCurrentTlf(r.size(),n,o),n.fitMode){case"free":{this._useClamping=!1;break}case"contain-with-zoom":case"min-zoom":case"scale-down-width":case"none":case"fit-width":{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let i=o!=null&&o.type!="NONE";Pf(n,i)||this.setCameraZoom(0,this._minZoom);break}case"contain":case"scale-down":{this._useClamping=!0;let i=this._snapOffsetToPixelGrid(r.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new L(i.x(),i.y(),0,0)),this._setCamera2(0,i,this._minZoom);break}}}constructor(){this._boundsMapping=new nS,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=L.new2(),this._dummyOffset=F.new(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new Qs,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=F.new(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=L.new2()}};Ti.ZOOM_MIN=Math.pow(2,-6),Ti.ZOOM_MAX=Math.pow(2,8),Ti.ZOOM_TO_FIT_PADDING=50,Ti.ANIMATION_DURATION=.2;var wo=Ti,nS=class t{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){isNaN(e)||e<=0?this._viewPixelsPerCanvasPixel=1:this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let r=xn.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),n=xn.new2();if(e==0){let o=F.new(this.canvasSpaceOrigin()).rounded(),i=r.transformPoint(o),a=-(i.x()-Math.floor(i.x())),s=-(i.y()-Math.floor(i.y()));n.translate1(a,s)}return n.multiply(r),n}viewSpaceToCanvasSpace(e){let r=this.canvasSpaceToViewSpace(e).clone();return r.invert(),r}computeCanvasSpaceBounds(e,r){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(r))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():Ae.FrozenVector_ZERO}clone(){let e=new t;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=F.new(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=L.new2(),this._clampingBoundsForCanvasSpaceOffset=L.new2()}};var w_=class t{constructor(e,r,n){this._numStatesTransferred=0;this._numStatesReset=0;this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new Yl,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=r,this._swapStateCallback=n,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this)}static getStateGroupID(e){var o;let r=e!=null?e.scene().findNode(e==null?void 0:e.symbolID()):null,n=(o=r==null?void 0:r.findContainingStateGroupOrSelf())==null?void 0:o.id();return n??X.invalid()}getComponentHistory(e,r){if(e.length==0)return[];let n=this._semanticChangeHistoryStorage.getData(e,r);return n??[]}setComponentHistory(e,r,n){this._semanticChangeHistoryStorage.insert(e,r,n)}handleStateChangeCommitted(e,r){}_transferChildComponentStates(e){e!=null&&e.forEachChild(r=>{this._setInstanceChangeHistory(r),this._transferChildComponentStates(r)})}_hasStateToTranfer(e,r){return r.length>0&&e.symbolID()!=le.List_last(r).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let r=kr.getSemanticNodePath(new gt(e)),n=this.getComponentHistory(r,t.getStateGroupID(e)),o=this._prototypeState.getStateMachineOrNull(e.stablePath());o!=null&&this._hasStateToTranfer(e,n)&&!this._stateAlreadyManagedByVariables(e)&&(o.setChangeHistory(n),this._swapStateCallback(e.stablePath(),le.List_last(n).newStateId(),cl.MATERIALIZE_SWAPPED_OUT_TREE),this._numStatesTransferred++)}}_resetChildComponentStates(e,r){e!=null&&e.forEachChild(n=>{this._clearInstanceChangeHistory(n,r),this._resetChildComponentStates(n,r)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,r){let n=v();return!r&&n!=null&&this._nodeIsInstance(e)?n.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,r){var n,o;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,r))&&!this._stateAlreadyManagedByVariables(e)){this._numStatesReset++,r?(n=v())==null||n.resetLocalNestedInstanceChanges([e.id()]):(o=v())==null||o.resetLocalInstanceChanges([e.id()]);let i=kr.getSemanticNodePath(new gt(e));this._semanticChangeHistoryStorage.remove(i,t.getStateGroupID(e))}}_hasStateToStore(e,r,n){if(r==null||r.length==0)return!1;if(n==null||n.length==0)return!0;let o=le.List_last(n);return e.symbolID()!=o.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let r=this._prototypeState.getStateMachineOrNull(e.stablePath());if(r!=null){let n=kr.getSemanticNodePath(new gt(e)),o=t.getStateGroupID(e),i=this.getComponentHistory(n,o),a=r.changeHistory();this._hasStateToStore(e,a,i)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(n,o,a)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(r=>{this._storeChangeHistory(r),this._storeChangeHistoryForChildren(r)})}_semanticPathToString(e){let r=kr.getSemanticNodePath(new gt(e)),n=":/:",o=t.getStateGroupID(e);return r.length==1?r[0].toStringWithPrefix(!0):r.reduce((i,a,s)=>s==0?i:i+a.toString()+n,"")+n+o}_recordInteraction(e,r){if(r.transitionParameters.navigationType=="SWAP_STATE"&&!lt.isTransientAction(r.cause)){let n=this._appState.scene().findNodeByStablePath(e);if(n==null)return;let o=this._semanticPathToString(n);this._semanticPathInteracted.add(o)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return t.getStateGroupID(e)!=X.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?t.getStateGroupID(e)!=X.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let r=e.oldStateAndOverlays.topId(),n=e.newStateAndOverlays.topId(),o=this._appState.scene().findNode(r),i=this._appState.scene().findNode(n);this._storeChangeHistory(o),this._storeChangeHistoryForChildren(o),e.resetInteractiveComponents()==0?(this._numStatesReset=0,this._clearInstanceChangeHistory(i,!1),this._resetChildComponentStates(i,!1),this._sendStateResetLog()):(this._numStatesTransferred=0,this._setInstanceChangeHistory(i),this._transferChildComponentStates(i),this._sendStateTransferLog())}}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,r){}handleHsmCommitted(e,r,n){r.stateManagementVersion()==1&&this._recordInteraction(e,r)}handleHsmRequested(e,r){if(r.stateManagementVersion()==1){let n=this._appState.scene().findNodeByStablePath(e);this._storeChangeHistoryForChildren(n)}}handleHsmInitiated(e,r){if(r.stateManagementVersion()==1){let n=this._appState.scene().findNodeByStablePath(e);r.resetInteractiveComponents()!=0?(this._numStatesTransferred=0,this._transferChildComponentStates(n),this._sendStateTransferLog()):(this._numStatesReset=0,this._resetChildComponentStates(n,!0),this._sendStateResetLog())}}_sendStateTransferLog(){this._numStatesTransferred>0&&Re.trackDefinedEvent("prototype.viewer_interaction_state_transferred",{count:this._numStatesTransferred})}_sendStateResetLog(){this._numStatesReset>0&&Re.trackDefinedEvent("prototype.viewer_interaction_state_reset",{count:this._numStatesReset})}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{let r="",n=Math.max(e.length-4,0);n!=0&&(r="..., ");for(let o=n,i=e.length;o<i;o=o+1){let a=e[o];r+=`${(a==null?void 0:a.oldStateId())??"null"}->${a==null?void 0:a.newStateId()}`,o!=e.length-1&&(r+=", ")}return r})}};var oS=class t{opacity1(){return this._opacity}effects(){return this._effects}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}textDecorationPaints(){return this._textDecorationPaints}fillPaintsToString(){return this._fillPaints.map(e=>e.debugString()).join(", ")}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var r,n;let e=new t;return e._opacity=this._opacity,e._translation=this._translation.clone(),e._transform=this._transform.clone(),e._scaling=this._scaling,e._transformOrigin=((r=this._transformOrigin)==null?void 0:r.clone())??null,e._effects=this._effects,e._fillPaints=this._fillPaints,e._textDecorationPaints=this._textDecorationPaints,e._strokePaints=this._strokePaints,e._cornerRadii=this._cornerRadii,e._rectangleSize=((n=this._rectangleSize)==null?void 0:n.clone())??null,e}_areVectorsEqual(e,r){return e==null&&r==null?!0:e==null||r==null?!1:e.equals(r)}equals(e){return this._opacity==e.opacity1()&&$t.FrozenList_equals(this._effects,e.effects(),(r,n)=>r.equalsWithinEffectType(n))&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&$t.FrozenList_equals(this._fillPaints,e.fillPaints1(),(r,n)=>r.equals1(n))&&$t.FrozenList_equals(this._strokePaints,e.strokePaints1(),(r,n)=>r.equals1(n))&&$t.FrozenList_equals(this._textDecorationPaints,e.textDecorationPaints(),(r,n)=>r.equals1(n))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,r){return this.equalTransformsUpToTranslationAndScaling(e,r)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,r){let n=Ko.from(this.transform1()),o=Ko.from(e.transform1()),i=Math.abs(n.angleDegrees-o.angleDegrees)<=r,a=Math.abs(n.m00-o.m00)<=r&&Math.abs(n.m01-o.m01)<=r&&Math.abs(n.m10-o.m10)<=r&&Math.abs(n.m11-o.m11)<=r;return i&&a}opacity2(e){return this._opacity=e,this}setEffects(e){return this._effects=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}setTextDecorationPaints(e){return this._textDecorationPaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply(e))}constructor(){this._opacity=1,this._translation=F.new(),this._transform=wt.FrozenAffineTransform_new1(),this._scaling=F.new().withOnesForZeros(),this._effects=[],this._transformOrigin=null,this._fillPaints=[],this._textDecorationPaints=[],this._strokePaints=[],this._cornerRadii=Mn.ZEROS,this._rectangleSize=null}},jn=class t{constructor(e){e?(this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual):(this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._from=new oS,this._to=new oS,this._isTransformEqual=!0)}from(){return this._from}to(){return this._to}opacity(e,r){return this._from.opacity2(e),this._to.opacity2(r),this}translation(e,r){return this._from.translation2(e),this._to.translation2(r),this}transform(e,r){return this._isTransformEqual=e.equals2(r,1e-6),this._from.transform2(e),this._to.transform2(r),this}scaling(e,r){return this._from.scaling2(e),this._to.scaling2(r),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,r,n,o){return this._from.rectangleSize2(e),this._from.cornerRadii2(r),this._to.rectangleSize2(n),this._to.cornerRadii2(o),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,r){return this._from.transformOrigin2(e),this._to.transformOrigin2(r),this}setEffectsForTransition(e,r){return this._from.setEffects(e),this._to.setEffects(r),this}fillPaints1(e,r){return this._from.fillPaints2(e),this._to.fillPaints2(r),this}strokePaints1(e,r){return this._from.strokePaints2(e),this._to.strokePaints2(r),this}_getEffects(e,r,n){let o=[];for(let i=0,a=r.length;i<a;i=i+1){let s=r[i],l=n[i];s.equalsWithinEffectType(l)&&!this.hasTransitioningTransformOrigin()&&!this.hasTransitioningCornerRadii()||s.type()=="DROP_SHADOW"||s.type()=="INNER_SHADOW"?o.push(s):o.push(Of.create(s,l,this._from.transformOrigin1().multiplyScalar(2),this._to.transformOrigin1().multiplyScalar(2),this._from.cornerRadii1(),this._to.cornerRadii1(),this._from.rectangleSize1(),this._to.rectangleSize1(),e))}return o}_getPaints(e,r,n){let o=[];for(let i=0,a=r.length;i<a;i=i+1){let s=r[i],l=n[i];if(s.equals2(l))o.push(s);else{let c=s,d=l;c.opacity()==0&&(c=l.cloneAsSinglePaint(),c.setOpacity(0)),d.opacity()==0&&(d=s.cloneAsSinglePaint(),d.setOpacity(0)),o.push(Kp.create(c,d,this._from.transformOrigin1().multiplyScalar(2),this._to.transformOrigin1().multiplyScalar(2),e))}}return o}fillGeometryForRoundedRectangles(e,r){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let n=Math.max(1-r.top(),r.bottom(),1),o=L.new4(Ae.FrozenVector_ZERO,this._from.rectangleSize1().multiplyScalar(n).max(this._to.rectangleSize1().multiplyScalar(n))),i=new Vp("NONZERO",0,()=>{let a=F.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),s=this._from.cornerRadii1().toList(),l=this._to.cornerRadii1().toList(),c=[];for(let d=0;d<4;d=d+1)c.push(Math.max(Ye.double_lerp(s[d],l[d],e()),0));return new At(new L(0,0,Math.abs(a.x()),Math.abs(a.y())),Mn.fromList(c))},o);return new Ur([i],[],o,null)}fillGeometryForSpreadDynamic(e,r,n,o,i,a){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let s=this._from.rectangleSize1().addScalar(2*r),l=this._to.rectangleSize1().addScalar(2*r),c=Math.max(1-a.top(),a.bottom(),1),d=L.new4(Ae.FrozenVector_ZERO,this._from.rectangleSize1().multiplyScalar(c).max(this._to.rectangleSize1().multiplyScalar(c))).expandedBy1(r),u=this._from.cornerRadii1().toList(),p=this._to.cornerRadii1().toList();for(let h=0;h<4;h=h+1)u[h]=u[h]==0?0:u[h]+r,p[h]=p[h]==0?0:p[h]+r;let _=new Vp("NONZERO",0,()=>{let h=F.lerp(s,l,n()),g=[];for(let m=0;m<4;m=m+1)g.push(Math.max(Ye.double_lerp(u[m],p[m],n()),0));return new At(new L(-r,-r,Math.abs(h.x()),Math.abs(h.y())),Mn.fromList(g))},d);return new Uc(()=>new Gt(_.path(),_.windingRule),o,_.bounds(),Pt.forDynamicGeometry(i))}effects2(e){return this._getEffects(e,this._from.effects(),this._to.effects())}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}setTextDecorationPaints(e){return this._getPaints(e,this._from.textDecorationPaints(),this._to.textDecorationPaints())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0||this._to.textDecorationPaints().length!=0&&this._from.textDecorationPaints().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}hasTransitioningCornerRadii(){return this._from.cornerRadii1()==null&&this._to.cornerRadii1()==null?!1:this._from.cornerRadii1()==null||this.to().cornerRadii1()==null?!0:!this._from.cornerRadii1().equals(this.to().cornerRadii1())}hasTransitioningEffects(){return this._from.effects().length!=0&&this._to.effects().length!=0}interpolateOpacity(e){return Ye.double_clamp(Ye.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return F.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let r=this.from().transform1(),n=this.to().transform1();if(r.toAngle()!=n.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let o=r.clone().translatedBy1(this.from().transformOrigin1()),i=n.clone().translatedBy1(this.to().transformOrigin1()),a=Ko.lerp1(o,i,e),s=F.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),l=Q.new2().translatedBy1(s.negative());return a.multiply(l),a}else return this._isTransformEqual?r:Ko.lerp1(r,n,e)}interpolateScaling(e){return F.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new t(this)}withScaledTranslation(e){let r=this.clone();return r._from=r._from.withScaledTranslation(e),r._to=r._to.withScaledTranslation(e),r}},Ie=class Ie{constructor(){this._reversed=null;arguments.length==0?(this._enteringFrameTransition=new jn,this._exitingFrameTransition=new jn,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1):arguments.length==4&&(this._enteringFrameTransition=arguments[0],this._exitingFrameTransition=arguments[1],this._drawsEnteringFrameOnTopOfExitingFrame=arguments[2],this._isDissolve=arguments[3])}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,r){return this._enteringFrameTransition.translation(e,r),this._reversed=null,this}enteringFrameOpacity(e,r){return this._enteringFrameTransition.opacity(e,r),this._reversed=null,this}exitingFrameTranslation(e,r){return this._exitingFrameTransition.translation(e,r),this._reversed=null,this}exitingFrameOpacity(e,r){return this._exitingFrameTransition.opacity(e,r),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new Ie(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new Ie().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new Ie(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return Ie.INSTANT_TRANSITION;case"DISSOLVE":return Ie.DISSOLVE;case"SMART_ANIMATE":return Ie.DISSOLVE;case"SLIDE_FROM_LEFT":return Ie.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return Ie.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return Ie.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return Ie.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return Ie.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return Ie.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return Ie.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return Ie.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return Ie.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return Ie.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return Ie.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return Ie.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return Ie.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return Ie.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return Ie.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return Ie.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return Ie.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return Ie.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return Ie.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return Ie.MOVE_OUT_TO_BOTTOM;case"FADE":return Ie.DISSOLVE;case"MAGIC_MOVE":return Ie.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}};Ie.SLIDE_BACK_FRAME_OPACITY_START=1,Ie.SLIDE_BACK_FRAME_OPACITY_END=.5,Ie.OFFSCREEN_LEFT=new F(-1,0),Ie.OFFSCREEN_RIGHT=new F(1,0),Ie.OFFSCREEN_TOP=new F(0,-1),Ie.OFFSCREEN_BOTTOM=new F(0,1),Ie.CENTER=F.new(),Ie.INSTANT_TRANSITION=new Ie().freeze(),Ie.DISSOLVE=new Ie().dissolve().freeze(),Ie.SLIDE_FROM_LEFT=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_LEFT,Ie.CENTER).exitingFrameTranslation(Ie.CENTER,Ie.OFFSCREEN_RIGHT.divideScalar(4)).exitingFrameOpacity(Ie.SLIDE_BACK_FRAME_OPACITY_START,Ie.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ie.SLIDE_FROM_RIGHT=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_RIGHT,Ie.CENTER).exitingFrameTranslation(Ie.CENTER,Ie.OFFSCREEN_LEFT.divideScalar(4)).exitingFrameOpacity(Ie.SLIDE_BACK_FRAME_OPACITY_START,Ie.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ie.SLIDE_FROM_TOP=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_TOP,Ie.CENTER).exitingFrameTranslation(Ie.CENTER,Ie.OFFSCREEN_BOTTOM.divideScalar(4)).exitingFrameOpacity(Ie.SLIDE_BACK_FRAME_OPACITY_START,Ie.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ie.SLIDE_FROM_BOTTOM=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_BOTTOM,Ie.CENTER).exitingFrameTranslation(Ie.CENTER,Ie.OFFSCREEN_TOP.divideScalar(4)).exitingFrameOpacity(Ie.SLIDE_BACK_FRAME_OPACITY_START,Ie.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ie.SLIDE_OUT_TO_LEFT=Ie.SLIDE_FROM_RIGHT.reversed(),Ie.SLIDE_OUT_TO_RIGHT=Ie.SLIDE_FROM_LEFT.reversed(),Ie.SLIDE_OUT_TO_TOP=Ie.SLIDE_FROM_BOTTOM.reversed(),Ie.SLIDE_OUT_TO_BOTTOM=Ie.SLIDE_FROM_TOP.reversed(),Ie.PUSH_FROM_LEFT=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_LEFT,Ie.CENTER).exitingFrameTranslation(Ie.CENTER,Ie.OFFSCREEN_RIGHT).freeze(),Ie.PUSH_FROM_RIGHT=Ie.PUSH_FROM_LEFT.reversed(),Ie.PUSH_FROM_TOP=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_TOP,Ie.CENTER).exitingFrameTranslation(Ie.CENTER,Ie.OFFSCREEN_BOTTOM).freeze(),Ie.PUSH_FROM_BOTTOM=Ie.PUSH_FROM_TOP.reversed(),Ie.MOVE_FROM_LEFT=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_LEFT,Ie.CENTER).freeze(),Ie.MOVE_FROM_RIGHT=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_RIGHT,Ie.CENTER).freeze(),Ie.MOVE_FROM_TOP=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_TOP,Ie.CENTER).freeze(),Ie.MOVE_FROM_BOTTOM=new Ie().enteringFrameTranslation(Ie.OFFSCREEN_BOTTOM,Ie.CENTER).freeze(),Ie.MOVE_OUT_TO_LEFT=Ie.MOVE_FROM_RIGHT.reversed(),Ie.MOVE_OUT_TO_RIGHT=Ie.MOVE_FROM_LEFT.reversed(),Ie.MOVE_OUT_TO_TOP=Ie.MOVE_FROM_BOTTOM.reversed(),Ie.MOVE_OUT_TO_BOTTOM=Ie.MOVE_FROM_TOP.reversed();var Zr=Ie;var fu=class fu{constructor(e,r){this.hotspotStablePath=e,this.interactionId=r}};fu.EXTERNAL_INTERACTION_ID=X._new(-1,-2),fu.EXTERNAL=new fu(null,fu.EXTERNAL_INTERACTION_ID);var ei=fu,Sn=class t{static getDefault(){return new t("INSTANT_TRANSITION",0,null,!1,Ae.FrozenVector_new1(),"NAVIGATE",!1,Ae.FrozenVector_new1(),!1,!0,!1,!1,1,"NONE")}static fromPrototypeAction(e,r){return e==null?t.getDefault():new t(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),r,e.animationType())}withTransitionPreserveScroll(e){return new t(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion,this.animationType)}withDefaultStateManagementSettings(){return new t(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion,this.animationType)}withStateManagementSettings(e){return e==null?this:new t(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion,e.animationType)}constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h){this.transitionType=e,this.transitionDuration=r,this.easingFunction=n,this.transitionShouldSmartAnimate=o,this.overlayRelativePosition=i,this.navigationType=a,this.transitionPreserveScroll=s,this.extraScrollOffset=l,this.transitionResetVideoPosition=c,this.openUrlInNewTab=d,this.transitionResetScrollPosition=u,this.transitionResetInteractiveComponents=p,this.stateManagementVersion=_,this.animationType=h}};function FO(t,e){return t==null&&e==null?!0:t==null||e==null?!1:t.interactionId===e.interactionId&&t.actionIndex===e.actionIndex}var ti=class{constructor(e,r){this.interactionId=e,this.actionIndex=r}debugString(){return`[animationState] interactionId: ${this.interactionId}, actionIndex: ${this.actionIndex}`}compareTo(e,r){let n=-1,o=-1;if(r.forEach((i,a)=>{let s=i.id();s===this.interactionId&&(n=a),s===e.interactionId&&(o=a)}),!(n<0||o<0))return this.interactionId===e.interactionId?this.actionIndex-e.actionIndex:n-o}},wr=class{topId(){return this.overlays.length>0?le.List_last(this.overlays).id:this.stateId}debugString(e){let r=a=>{let s=e.findNode(a);return`[nodeId.toString]: ${(s==null?void 0:s.name())??"null"}`},n="  ",o="[";for(let a=0,s=this.overlays.length;a<s;a=a+1){let l=this.overlays[a];o+=n+r(l.id),a!=this.overlays.length-1&&(o+=`,
`)}o+="]";let i=this.animationState?this.animationState.debugString():"";return`PresentedState(
`+n+r(this.stateId)+`,
`+n+o+i+`
)`}statesAndOverlaysIncluded(){let e=new Set;this.stateId!=null&&X.isValid(this.stateId)&&e.add(this.stateId);for(let r of this.overlays)X.isValid(r.id)&&e.add(r.id);return e}constructor(e,r,n=null){this.stateId=e,this.overlays=r,this.animationState=n}},Rn=class t{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Sn.getDefault(),this.interactionAddress=ei.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new wr(null,[]),this.newStateAndOverlays=new wr(null,[])}else if(arguments[0]==1){let[,e,r,n]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Sn.getDefault(),this.interactionAddress=ei.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=r,this.newStateAndOverlays=n}else if(arguments[0]==2){let[,e,r,n,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Sn.getDefault(),this.interactionAddress=ei.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new wr(r,[]),this.newStateAndOverlays=new wr(n,[]),this.direction=0,this.cause=s,this.interactionAddress=o,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=i}else if(arguments[0]==3){let[,e,r,n,o,i,a,s,l]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Sn.getDefault(),this.interactionAddress=ei.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=r,this.newStateAndOverlays=n,this.direction=s,this.cause=l,this.interactionAddress=o,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=i}else if(arguments[0]==4){let[,e,r,n,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Sn.getDefault(),this.interactionAddress=ei.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=r,this.newStateAndOverlays=n,this.interactionAddress=i,this.direction=a,this.transitionParameters=s,this.cause=o}}static forClosingTopNOverlays(e,r,n,o,i,a){let l=n[n.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new t(3,Rt.ROOT_STABLE_PATH(),new wr(r,n),new wr(r,n.slice(0,n.length-e)),o,i,l,1,a)}oldStateId(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.stateId}newStateId(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.stateId}oldObjectAnimationState(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.animationState}newObjectAnimationState(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.animationState}isObjectAnimation(){return this.newObjectAnimationState()!=null}isBaseScreenTransition(){return this.oldStateId()!==this.newStateId()}objectAnimationTargetNode(e){let r=this.newObjectAnimationState();if(!r)return null;let n=this.newStateId(),o=e.findNode(n);if(!o)throw new Error("Expected slide node");let i=o.objectAnimations().find(l=>l.id()===r.interactionId);if(!i)throw new Error("Could not find interaction matching the prototype state change's interaction id");if(i.actions().length===0)throw new Error("Expected interaction with at least one action");let a=r.actionIndex;if(a<0||a>=i.actions().length)throw new Error("Action index out of bounds");let s=i.actions()[a].transitionNodeID();return e.findNode(s)}canInstantlyCommit(){return this.direction==0?!1:this.transitionParameters.transitionType=="INSTANT_TRANSITION"||this.transitionParameters.animationType!="NONE"}oldOverlayData(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.overlays}newOverlayData(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.overlays}oldOverlays(e){var r;return e.bindOverlays((r=this.oldStateAndOverlays)==null?void 0:r.overlays)}newOverlays(e){var r;return e.bindOverlays((r=this.newStateAndOverlays)==null?void 0:r.overlays)}isTransientChange(e){let r=X.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return(e?lt.isForwardTransientAction(this.cause):lt.isTransientAction(this.cause))||r}debugString(e){var r,n;return`${(r=this.oldStateAndOverlays)==null?void 0:r.debugString(e)}
=>
${(n=this.newStateAndOverlays)==null?void 0:n.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=Zr.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrames(e){let r=[];if(!X.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null){let n=e.findNode(this.newStateId());n!=null&&r.push(n)}for(let n=0,o=this.newOverlayData().length;n<o;n=n+1)if(n>=this.oldOverlayData().length||!X.equals(this.oldOverlayData()[n].id,this.newOverlayData()[n].id)){let i=e.findNode(this.newOverlayData()[n].id);i!=null&&r.push(i)}return r}getInsertedFrameIds(){let e=[];!X.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let r=new So;this.oldOverlayData().forEach(n=>{r.add(n.id)});for(let n=0,o=this.newOverlayData().length;n<o;n=n+1){let i=this.newOverlayData()[n].id;r._in(i)||e.push(i)}return e}getRemovedFrameIds(){let e=[];!X.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let r=new So;this.newOverlayData().forEach(n=>{r.add(n.id)});for(let n=0,o=this.oldOverlayData().length;n<o;n=n+1){let i=this.oldOverlayData()[n].id;r._in(i)||e.push(i)}return e}},Lo=class t{static getDefaultExternalExecution(){return new t(ei.EXTERNAL,Sn.getDefault(),null)}static forNoodle(e,r,n){let o=new ei(t.stablePathForHotspot(e),r.id()),i=r.action().value;if(n!=null)i=n;else for(let l of r.getAllValidTransitionActionsInInteraction()){i=l;break}let a=Sn.fromPrototypeAction(i,r.stateManagementVersion()),s=r.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new t(o,a,s)}static forExternalOpenOverlay(e){let r=new ei(t.stablePathForHotspot(e),X._new(-1,-2));return new t(r,Sn.getDefault(),null)}static stablePathForHotspot(e){let r=null;return r=e.stablePath(),r}constructor(e,r,n){this.interactionAddress=e,this.transitionParameters=r,this.canvasSpaceTriggerBoundsOrNull=n}};function L_(t){let e=t.slice();return e.sort((r,n)=>{let o=r.fullSizeCanvasSpaceBoundingBox(),i=n.fullSizeCanvasSpaceBoundingBox();return i.top()<=o.bottom()&&i.bottom()>=o.top()?o.x()==i.x()?Pi.string_compare(r.id(),n.id()):o.x()-i.x()|0:o.y()-i.y()|0}),e}function FL(t,e){let r=[];for(let o of e){let i=t.findNode(o);i!=null&&r.push(i)}return L_(r).map(o=>o.id())}var B_=(n=>(n[n.FRAME_LIST=0]="FRAME_LIST",n[n.NONLINEAR=1]="NONLINEAR",n[n.SLIDESHOW=2]="SLIDESHOW",n))(B_||{}),iS=class{constructor(e){this._appState=e}getNextBaseScreenNode(){let e=this.getNextBaseScreenId();return e?this._appState.scene().findNode(e):null}getNextObjectAnimation(){return null}getPreviousObjectAnimation(){return null}getCurrentObjectAnimation(){return this._appState.prototypeState().getCurrentAnimationState()}getNavigateForwardEnabled(){return this.getNextBaseScreenId()!=null||this.getNextObjectAnimation()!=null||this.shouldCommitInitiatedChangeOnNavigate()&&this._appState.prototypeState().getInitiatedChange()!==null}getNavigateBackwardEnabled(){return this._appState.prototypeState().getPreviousBaseScreenId()!=null||this.getCurrentObjectAnimation()!=null}shouldCommitInitiatedChangeOnNavigate(){return!1}transitionDirectionBetweenFrames(e,r){return this.navigationOrderType()!=2?0:this.compare(e,r)<=0?0:1}compare(e,r){if(e===r)return 0;let n=this.topLevelPrototypeNodesInOrder().indexOf(e),o=this.topLevelPrototypeNodesInOrder().indexOf(r);return n===-1&&o===-1?0:n-o}shouldSyncObjectAnimations(){return!1}navigationOrderTypeString(){return B_[this.navigationOrderType()]}},aS=class extends iS{navigationOrderType(){return 1}isLinear(){return!1}getNextBaseScreenId(){let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e)return null;let n=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF().get(e.id());if(!n)return null;for(let o of n)for(let i of o.allActions()){if(i==null||!X.isValid(i.transitionNodeID())||!(i.connectionType()==="INTERNAL_NODE"&&i.navigationType()==="NAVIGATE"))continue;let a=i.transitionNodeID();if(this._appState.scene().findNode(a)!=null)return a}return null}topLevelPrototypeNodesInOrder(){return this._appState.prototypeState().getTlfHistory()}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let r=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();if(r!=null)return r;let n=Ql.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}},sS=class extends iS{isLinear(){return!0}getNextBaseScreenId(){let e=this._appState.prototypeState().getCurrentBaseScreenIndex(),r=this.topLevelPrototypeNodesInOrder();return e<0||e>=r.length-1?null:X.fromString(r[e+1])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let r=[];for(let i of e.children())v().isOrContainsBaseScreen(i.id())&&r.push(i);let n=L_(r),o=[];for(let i of n)i.type()!="SECTION"?o.push(i):ln(o,Ql.visuallySortedTopLevelFrames(i));return o}},Ql=class t extends sS{navigationOrderType(){return 0}topLevelPrototypeNodesInOrder(){let e=this._appState.getActiveCanvas();return e==null?[]:t.visuallySortedTopLevelFrames(e).map(r=>r.id())}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let r=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();if(r!=null)return r;let n=t.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}static visuallySortedTopLevelFrames(e){if(e==null)return[];let r=[];for(let i of e.children())v().isOrContainsBaseScreen(i.id())&&r.push(i);let n=L_(r),o=[];for(let i of n)i.type()!="SECTION"?o.push(i):ln(o,t.visuallySortedTopLevelFrames(i));return o}},M_=class extends sS{navigationOrderType(){return 2}getNextObjectAnimation(){let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e)return null;let r=e.objectAnimations();if(r.length==0)return null;let n=this._appState.prototypeState().getCurrentAnimationState();if(n==null)return new ti(r[0].id(),0);{let o=r.findIndex(a=>a.id()===n.interactionId);if(o===-1)return null;let i=r[o];return n.actionIndex+1<i.getAllActions().length?new ti(i.id(),n.actionIndex+1):o+1<r.length?new ti(r[o+1].id(),0):null}}getPreviousObjectAnimation(){let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e||e.objectAnimations().length==0)return null;let r=this._appState.prototypeState().getCurrentAnimationState();if(r==null)return null;{let n=e.objectAnimations().findIndex(i=>i.id()===r.interactionId);if(n===-1||n===0)return null;let o=e.objectAnimations()[n-1];return new ti(o.id(),o.getAllActions().length-1)}}shouldCommitInitiatedChangeOnNavigate(){return!0}shouldSyncObjectAnimations(){return!0}topLevelPrototypeNodesInOrder(){let e=this._appState.getActiveCanvas();if(e==null)return[];let r=e.children().find(o=>(o==null?void 0:o.type())==="SLIDE_GRID");if(r==null)return[];let n=[];return r.forEachDescendantPreorder(o=>{o.type()=="SLIDE"&&o.isVisibleInCanvas()&&!o.isSkippedSlide()&&n.push(o)}),n.map(o=>o.id())}nodeToRestartPrototypeOn(e){let r=this.topLevelPrototypeNodesInOrder();return r.length>0?this._appState.scene().findNode(X.fromString(r[0])):null}};var gu=class t{constructor(e,r,n,o,i,a,s){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.oldOverlayDerivedModes=[],this.newOverlayExplicitModes=[],this.id=e,this.overlayDataModelId=r,this.openingHotspotStablePath=n,this.openingInteractionId=o,this.openingTransition=i,this.oldOverlayDerivedModes=a,this.newOverlayExplicitModes=s||[]}cloneWithId(e,r){return new t(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition,r)}openingTransitionType(){return this.openingTransition.transitionType}},qc=class{constructor(e,r,n,o,i,a,s,l){this.overlayId=e,this.overlayNode=r,this.bounds=n,this.baseTlfCursor=o,this.backgroundAppearance=i,this.backgroundTransitionProgress=a,this.transform=s,this.animationTransform=l}},ms=class{constructor(e=new Map){this._hasTransitionComputed=!1;this._hasTransition=!1;this._multiOverlayMap=e}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,r){this._multiOverlayMap.set(e,r),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get(e){return qe.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let r of this.keys())e.push(r);return new Rt(e)}},G_=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode(this.id())}backgroundInteraction(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?new La:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let r=this.node();if(r==null)return Ae.FrozenVector_new1();let n=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let i=this.scene.findNode(this._previousOverlay.id()).canvasSpaceBoundingBox(),a=this._previousOverlay.renderedOrigin(e),s=this.scene.findNodeByStablePath(this.openingHotspotStablePath());s!=null&&(n=s.canvasSpaceScrolledBounds(1).topLeft().add(a.subtract(i.topLeft())))}if(n==null){let o=this.scene.findNodeByStablePath(this.openingHotspotStablePath());o!=null&&(n=o.canvasSpaceScrolledBounds(1).topLeft())}if(n==null)return Ae.FrozenVector_new1()}return U_.BoundOverlay_computeOrigin(r,e,this._data.openingTransition,n,this.positionType())}renderedBounds(e){let r=this.scene.findNode(this._data.id);if(r==null)return ar.FrozenRect_new1();let n=r.canvasSpaceBoundingBox().size(),o=this.renderedOrigin(e);return ar.FrozenRect_new4(o.x(),o.y(),n.x(),n.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let r=this.scene.findNode(this._data.id);return r==null?new F(0,0):this.renderedOrigin(e).subtract(r.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,r){let n=this.scene.findNode(this._data.id);if(n==null||r==null||e==null)return Ae.FrozenVector_ZERO;let o=this.renderedOrigin(e),i=n.canvasSpaceBoundingBox().topLeft();return r.add(i).subtract(o)}baseTlfSpaceToOverlaySpace2(e,r){return L.new4(this.baseTlfSpaceToOverlaySpace1(e,r.topLeft()),r.size())}overlaySpaceToBaseTlfSpace1(e,r){let n=this.baseTlfSpaceToOverlaySpace1(e,r);return r.add(r.subtract(n))}overlaySpaceToBaseTlfSpace2(e,r){return L.new4(this.overlaySpaceToBaseTlfSpace1(e,r.topLeft()),r.size())}constructor(e,r,n,o){this.scene=e,this._data=r,this._previousOverlay=n,this._stackPosition=o}},U_;(r=>{function t(n,o,i,a,s){if(n==null)return F.new();let l=n.canvasSpaceBoundingBox().size();if(s=="MANUAL")return new F(a.x()+i.overlayRelativePosition.x(),a.y()+i.overlayRelativePosition.y());{let c=o.canvasSpaceBoundingBox(),d=c.topLeft(),u=c.size(),p=d.x();switch(s){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{p+=u.x()/2-l.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{p+=u.x()-l.x();break}}let _=d.y();switch(s){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{_+=u.y()/2-l.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{_+=u.y()-l.y();break}}return new F(p,_)}}r.BoundOverlay_computeOrigin=t;function e(n,o,i,a,s){let l=n.canvasSpaceBoundingBox().size(),c=t(n,o,i,a,s);return ar.FrozenRect_new4(c.x(),c.y(),l.x(),l.y())}r.BoundOverlay_computeNewBounds=e})(U_||(U_={}));var An=class t{static isNodeInteractableBecauseOfHyperlinks(e){return e.type()=="TEXT"&&e.textHyperlinkBoxes().length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="SET_VARIABLE_MODE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}static cleanedInteractionsForNode(e,r){if(r==null)return[];let n=r.prototypeInteractions();return this.cleanedInteractionsForNodeFromDirtyInteractions(e,r,n)}static cleanedUpTransitionDestinationId(e,r,n,o,i){return v().modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,r,n,Be().NavigationType[o],Be().ConnectionType[i])}static cleanedInteractionsForNodeFromDirtyInteractions(e,r,n){let o=[];if(r==null||n==null)return o;for(let i=0,a=n.length;i<a;i=i+1){let s=n[i];if(s.actions()==null||s.actions().length==0)continue;let l=[];for(let c=0,d=s.actions().length;c<d;c=c+1){let u=s.actions()[c],p=null;if(X.isValid(u.transitionNodeID())){let _=e.getActiveCanvas(),h=t.cleanedUpTransitionDestinationId(_,r==null?void 0:r.id(),u.transitionNodeID(),u.navigationType(),u.connectionType());h!==null&&h!=null&&(p=u.withTransitionNodeID(h))}else r.isVisibleInCanvas()&&t.isPrototypeActionInteractableBecauseOfConnection(u)&&(p=u);p!=null&&l.push(p)}l.length!=0&&o.push(s.withActions(l))}return o.length==0&&t.isNodeInteractableBecauseOfHyperlinks(r)&&o.push(t.createFakeHyperlinkInteraction()),o}static createFakeHyperlinkInteraction(){let e=new Po("ON_CLICK",null,null,{},null,null),r=Ir.NULL_ACTION.withConnectionType("URL").withConnectionURL("HYPERLINK");return new dr(X.invalid(),e,[r],!1,0)}static adjacentBaseScreens(e,r){let n=r.scene(),o=new oa(s=>s),i=null,a=new So;return i=s=>{if(s==null||a._in(s.id())||!e._in(s.id()))return;a.add(s.id());let l=e.get(s.id());for(let c=0,d=l.length;c<d;c=c+1){let u=l[c];for(let p of u.allActions()){if(p==null||!X.isValid(p.transitionNodeID()))continue;let _=n.findNode(p.transitionNodeID());if(_==null){xe("null destination when finding reachable TLFs?");continue}let h=p.connectionType()!="UPDATE_MEDIA_RUNTIME"&&p.connectionType()!="SET_VARIABLE"&&p.connectionType()!="SET_VARIABLE_MODE";p.navigationType()=="NAVIGATE"&&h||p.navigationType()=="SWAP"&&X.equals(s.id(),r.id())?o.add(_.id()):(p.navigationType()=="OVERLAY"||p.navigationType()=="SWAP")&&i(_)}}},i(r),o}};var Xs=class t{constructor(e){this.VERBOSE_LOGS=!1,this._observers=new bn,this._isNotifyingStateChangeObservers=!1,this._interactionsEnabled=!0,this._disengageObservationOnClick=!0,this._disableNewStateChanges=!1,this._currentFitMode="none",this._currentContentScalingMode="fixed",this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._changeHistoryBeforeNodeChanges=[],this._initiatedChange=null,this._initiatedChangeBeforeNodeChanges=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._baseScreenWasValidDestinationBeforeNodeChanges=!1,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._guidToVideoStateChangeMap=new Map,this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new So,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._hsmObservers=new bn,this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new w_(this._appState,this,(r,n,o)=>this._getFullscreenNodeChangesForStateSwap(r,n,o)),this._emitter=Xt.getEventEmitter(),this._hsmRoot=new Su(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle")},this.resetState()}hasRequestedStateChange(){return this._requestedStateChange!==null}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._hsmRoot=new Su(this),this._initiatedInstanceChanges=new Map,r!=null&&this.createOrRepairStateMachinesForInsertedSubtree(r.root()),this._visitedScreenIds=new So,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode="none",this._currentContentScalingMode="fixed",this._transitionOnClick=!0}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){if(xo.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==114)pt.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==96&&e.node.isInstance()){let r=e.node.symbolID()??X.invalid();X.isValid(r)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,r)}else if(e.property==58){let r=e.oldVal!=null&&pt.isParentIndex(e.oldVal)?pt.asParentIndex(e.oldVal):null,n=e.newVal!=null&&pt.isParentIndex(e.newVal)?pt.asParentIndex(e.newVal):null,o=r!=null?e.node.scene().findNode(r.id):null,i=n!=null?e.node.scene().findNode(n.id):null,a=o!=null&&o.isRooted(),s=i!=null&&i.isRooted();!a&&s?this.createOrRepairStateMachinesForInsertedSubtree(e.node):a&&!s&&(this.isApplyingStateChangeMutation()||no(e.node,l=>{if(l.isInstance()){let c=this._getStateMachineOrNull(l.stablePath());if(c!=null)return this.commitInstanceStateChange(c),2}return 0}))}else e.property==45&&kr.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new Rt([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&Ze.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let r=e.length;for(let n=0;n<e.length;n=n+1){let o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[n].id);if(o==null){r=n;break}o.setUsedAsBaseScreen(!1)}return r==e.length?e:e.slice(0,r)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let r=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(r==null)return new wr(null,[]);r.setUsedAsBaseScreen(!0);let n=this._filterOverlays(e.overlays);return n==e.overlays?e:new wr(e.stateId,n)}_filterChange(e){if(e==null)return null;let r=this._filterPresentedState(e.oldStateAndOverlays),n=this._filterPresentedState(e.newStateAndOverlays);return r==e.oldStateAndOverlays&&n==e.newStateAndOverlays?e:new Rn(1,Rt.ROOT_STABLE_PATH(),r,n)}_getBaseScreenIdFromChangeOrHistory(e,r){return e!=null?e.newStateAndOverlays.stateId:r&&r.length>0?le.List_last(r).newStateAndOverlays.stateId:null}_getAnimationStateFromChangeOrHistory(e,r){return e!=null?e.newStateAndOverlays.animationState:r&&r.length>0?le.List_last(r).newStateAndOverlays.animationState:null}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let o=!U.getFeatureFlags().viewer_only_check_new_state_id&&this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,i=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=o||i,o&&(this.mostRecentFixInvalidStateInitiator+=" oldIsInvalid"),i&&(this.mostRecentFixInvalidStateInitiator+=" newIsInvalid")}else if(this._changeHistory&&this._changeHistory.length>0){let o=le.List_last(this._changeHistory).newStateId(),i=this._appState.prototypeStructure().validDestinationForPrototypeFromId(o)==null;e=i,i&&(this.mostRecentFixInvalidStateInitiator+=" currentIsInvalid")}else return;if(e){this.restartPrototype(0);return}let r=null,n=null;if(this._initiatedChange!=null){let o=this._filterChange(this._initiatedChange);this._initiatedChange!=o&&(n=this._initiatedHistory.slice(),r=o)}else if(this._changeHistory&&this._changeHistory.length>0){let o=le.List_last(this._changeHistory),i=this._filterChange(o);i!=o&&(n=this._changeHistory.slice(),r=i)}r!=null&&n!=null&&(le.List_removeLast(n),n.push(r),this._requestStateChange(r,n),this.mostRecentFixInvalidStateInitiator+=" PrototypeState._enforceValidPrototypeState",this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory&&this._changeHistory.length<1?null:le.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._getBaseScreenIdFromChangeOrHistory(this._initiatedChange,this._changeHistory)}getCurrentAnimationState(){return this._getAnimationStateFromChangeOrHistory(this._initiatedChange,this._changeHistory)}getCurrentBaseScreenNode(){var r;let e=this.getCurrentBaseScreenId();return e==null?null:(r=this._appState.scene())==null?void 0:r.findNode(e)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),r=this.getCurrentBaseScreenIndex();return r<1?null:X.fromString(e[r-1])}getPreviousBaseScreenNode(){return this._appState.scene().findNode(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory&&this._changeHistory.length>0?le.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let r=this.getCurrentOverlays();for(let n=0,o=r.length;n<o;n=n+1){let i=r[n];if(X.equals(i.id(),e))return i}return null}getTopmostScreenAndPoint(e){let r=this.getCurrentBaseScreenNode(),n=this.getTopmostOverlayNode();return n?[n,this.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(r,e)]:[r,e]}getTopmostScreen(){return this.getTopmostOverlayNode()??this.getCurrentBaseScreenNode()}getTopmostScreenId(){return this.getTopmostOverlayId()??this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?le.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?le.List_last(e).id():null}getTopmostOverlayNode(){var r;let e=this.getCurrentOverlays();return e.length==0?null:(r=this._appState.scene())==null?void 0:r.findNode(le.List_last(e).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var r;let e=this.getCurrentOverlays();return e.length==0?null:e.length==1?this.getCurrentBaseScreenNode():(r=this._appState.scene())==null?void 0:r.findNode(e[e.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let r=this.getCurrentOverlayIds().slice();return r.unshift(e),r}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;this._changeHistory&&e.length>0&&le.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;this._changeHistory&&e.length>0;){let r=e.pop();if(!(e.length>0&&le.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(r.oldStateId())==null))return r}return null}bindOverlays(e){let r=[];for(let n=0,o=e.length;n<o;n=n+1)r.push(new G_(this._appState.scene(),e[n],n>0?r[n-1]:null,n));return r}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var r;let e=null;return this._initiatedChange!=null?e=this._initiatedChange.oldStateId():this._changeHistory&&this._changeHistory.length>0&&(e=le.List_last(this._changeHistory).newStateId()),e==null?null:(r=this._appState.scene())==null?void 0:r.findNode(e)}nextNodeForBaseScreen(){var e,r;return((e=this._initiatedChange)==null?void 0:e.newStateId())==null?null:(r=this._appState.scene())==null?void 0:r.findNode(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var n;let r=null;if(this._initiatedChange!=null)r=this._initiatedChange.oldOverlayData();else if(this._changeHistory&&this._changeHistory.length>0)r=le.List_last(this._changeHistory).newOverlayData();else return null;return r.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(r[e].id)}nextNodeForOverlayAt(e){var n;if(this._initiatedChange==null)return null;let r=this._initiatedChange.newOverlayData();return r.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(r[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory&&this._changeHistory.length>0?le.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var n;let r=this.getCurrentOverlayData();return r.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(r[e].id)}getCurrentFitMode(){return this._currentFitMode}getCurrentContentScalingMode(){return this._currentContentScalingMode}getCurrentScalingInfo(){return{fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode}}setScalingInfoFromParameter(e,r){let n={};switch(e){case"contain":{n.fitMode="contain",n.contentScalingMode="fixed";break}case"contain-with-zoom":{n.fitMode="contain-with-zoom",n.contentScalingMode="fixed";break}case"scale-down":{n.fitMode="scale-down",n.contentScalingMode="fixed";break}case"min-zoom":{n.fitMode="min-zoom",n.contentScalingMode="fixed";break}case"scale-down-width":{n.fitMode="scale-down-width",n.contentScalingMode="fixed";break}case"fit-width":{n.fitMode="fit-width",n.contentScalingMode="fixed";break}case"free":{n.fitMode="free",n.contentScalingMode="fixed";break}case"responsive":{n.fitMode="contain",n.contentScalingMode="responsive";break}default:{n.fitMode="scale-down",n.contentScalingMode="fixed";break}}if(r)switch(r){case"responsive":{n.contentScalingMode="responsive";break}case"fixed":{n.contentScalingMode="fixed";break}default:break}let o={fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode},i=!1;n.fitMode!=this._currentFitMode&&(this._currentFitMode=n.fitMode,i=!0),n.contentScalingMode!==this._currentContentScalingMode&&(this._currentContentScalingMode=n.contentScalingMode,i=!0),i&&this._notifyFitModeChange(o,{fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode})}_notifyFitModeChange(e,r){this._observers.forEach(n=>{n.handleFitModeChange(e,r)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}disengageObservationOnClick(){return this._disengageObservationOnClick}setDisengageObservationOnClick(e){this._disengageObservationOnClick=e}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}showDeviceFrame(){return this._showDeviceFrame}setShowDeviceFrame(e){this._showDeviceFrame=e}showTransparentBackground(){return this._showTransparentBackground}setShowTransparentBackground(e){this._showTransparentBackground=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,r){let n=Lo.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,n.interactionAddress,n.canvasSpaceTriggerBoundsOrNull,0,null,r)}closeOverlayForHotspot(e,r,n,o){var c;let i=null,a=null,s=0;e!=null&&r!=null?(i=(c=e.topLevelAncestor())==null?void 0:c.id(),a=Lo.forNoodle(e,r,o),s=lt.fromInteractionType(r.event().interactionType())):(xe("closeOverlayForHotspot called with null hotspot"),i=this.getTopmostOverlayId(),a=Lo.getDefaultExternalExecution(),s=0);let l=this.getCurrentOverlayData();for(let d=l.length-1;d>=0;d=d-1)if(X.equals(l[d].id,i)){this._closeOverlayAtAndAbove(d,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,n);return}}_closeOverlayAtAndAbove(e,r,n,o,i,a){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let s=this.getCurrentOverlayData();if(s.length>e){let l=Rn.forClosingTopNOverlays(s.length-e,this.getCurrentBaseScreenId(),s,r,n,o);if(i==null)switch(a){case 0:{i=this._changeHistory.slice();break}case 1:{i=$t.FrozenList_cloneAndAppendOne(this._changeHistory,l);break}case 2:{i=[l];break}}this._requestStateChange(l,i)}}navigateToFrameAndCloseOverlaysOrRestart(e,r){var o;this.mostRecentFixInvalidStateInitiator=r;let n=null;if(e!=null){let i=this._appState.scene().findNode(e),a=i==null?void 0:i.findContainingCanvasOrSelf();if(a!=null&&this._appState.setActiveCanvas(a),n=(o=this._appState.prototypeStructure())==null?void 0:o.validDestinationForPrototypeFromId(e),this._appState.prototypeStructure().navigationOrder().navigationOrderType()===2&&(n==null?void 0:n.type())!=="SLIDE"){let[s]=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();s&&(n=this._appState.scene().findNode(s))}n||(this.mostRecentFixInvalidStateInitiator=`${r} invalid`)}else this.mostRecentFixInvalidStateInitiator=`${r} null`;n!=null?this.navigateToFrameAndCloseOverlays(n.id()):this.restartPrototype(0)}navigateToFrameAndCloseOverlays(e,r=null,n=2,o=0,i=0,a=null,s=null){var R,b;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let l=this.getCurrentBaseScreenNode(),c=(R=this._appState.prototypeStructure())==null?void 0:R.getDestinationFrame(e);if((l==null?void 0:l.type())==="SLIDE"&&!c||c!=null&&c.isSkippedSlide()){let O=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),f=O[O.indexOf(l.id())+1];c=(b=this._appState.prototypeStructure())==null?void 0:b.getDestinationFrame(f)}if(c!=null){this._appState.prototypeStructure().validDestinationForPrototypeFromId(c.id())||Re.trackDefinedEvent("prototype.viewer_navigation_invalid_destination",{cause:i,nodeType:c.type(),interactionId:(a==null?void 0:a.id())??"",enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});let O=this._appState.scene().findNode(e);O!=null&&O.type()=="SECTION"&&Re.trackDefinedEvent("prototype.navigate_to_section",{}),c.setUsedAsBaseScreen(!0),e=c.id()}else{Re.trackDefinedEvent("prototype.navigate_to_null_frame",{isInlinePreview:U.isInlinePreview(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});return}let d=this.getCurrentOverlayData(),u=this.getCurrentAnimationState();if(X.equals(e,l==null?void 0:l.id())&&(l==null?void 0:l.scene())==(c==null?void 0:c.scene())&&d.length==0)return;let p=l!=null?l.id():null,_=[],h;r!=null&&a!=null?h=Lo.forNoodle(r,a,s):(h=Lo.getDefaultExternalExecution(),this._appState.prototypeStructure().navigationOrder().navigationOrderType()===2&&(h.transitionParameters.transitionResetVideoPosition=!0));let g=null;if(o===1){let O=this._appState.scene().findNode(e),f=O==null?void 0:O.objectAnimations();if(f&&f.length>0){let I=f[f.length-1];g=new ti(I.id(),I.getAllActions().length-1)}}let m=new Rn(3,Rt.ROOT_STABLE_PATH(),new wr(p,d,u),new wr(e,_,g),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,o,i),A=[];switch(n){case 0:{A=this._changeHistory;break}case 1:{A=$t.FrozenList_cloneAndAppendOne(this._changeHistory,m);break}case 2:{A=[m];break}}let S=c!==null?c.findNearestAncestorOrSelf("SECTION"):null;if(S!==null){let O=this._getStateMachineOrNull(new Rt([S.id()]));if(O===null||this._shouldDisableNewChangesInStateMachine(O))return;O.clearInitiatedChangesInSelfAndSubstates();let f=[];switch(n){case 0:{f=O.changeHistory();break}case 1:{f=$t.FrozenList_cloneAndAppendOne(O.changeHistory(),m);break}case 2:{f=[m];break}}this._requestAndSaveSectionStateChange(O,m,f,A);let I=S,y=S.parent();for(;y!==null&&y.type()==="SECTION";){let P=new Rn(3,Rt.ROOT_STABLE_PATH(),new wr(p,d),new wr(I.id(),_),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,o,i),E=this._getStateMachineOrNull(new Rt([y.id()]));if(E===null||this._shouldDisableNewChangesInStateMachine(E))return;switch(E.clearInitiatedChangesInSelfAndSubstates(),n){case 0:{f=E.changeHistory();break}case 1:{f=$t.FrozenList_cloneAndAppendOne(E.changeHistory(),P);break}case 2:{f=[P];break}}this._saveSectionStateChange(E,P,f),I=y,y=I.parent()}}else this._requestStateChange(m,A)}playObjectAnimation(e,r,n){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let o=Sn.getDefault();if(r!=null){let l=e.getObjectAnimationInteraction(r),c=e.getObjectAnimationAction(r);if(l==null||c==null)return;o=Sn.fromPrototypeAction(c,l.stateManagementVersion())}let i=this.getCurrentAnimationState(),a=new Rn(3,Rt.ROOT_STABLE_PATH(),new wr(e.id(),[],i),new wr(e.id(),[],r),ei.EXTERNAL,null,o,n,0);this.logVerbose(()=>`[PrototypeState] playObjectAnimation: ${a.debugString(this._appState.scene())}`);let s=$t.FrozenList_cloneAndAppendOne(this._changeHistory,a);this._requestStateChange(a,s)}overlayFrame(e,r,n,o,i,a){var h,g;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||r==null)return;this._clearInitiatedChangesBeforeNewChange();let s=i!=null?Lo.forNoodle(r,i,a):Lo.forExternalOpenOverlay(r),l=this.getCurrentOverlayData(),c=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e);if(c==null){xe("tried to open to null overlay");return}(g=v())==null||g.resetLocalNodeSizeChanges(c.id());let d=new gu(c.id(),e,s.interactionAddress.hotspotStablePath,s.interactionAddress.interactionId,s.transitionParameters,this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen()??this.getCurrentBaseScreenNode(),c)),u=this.getCurrentBaseScreenId(),p=new Rn(3,Rt.ROOT_STABLE_PATH(),new wr(u,l),new wr(u,$t.FrozenList_cloneAndAppendOne(l,d)),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n,o);c.setUsedAsBaseScreen(!1);let _=$t.FrozenList_cloneAndAppendOne(this._changeHistory,p);this._requestStateChange(p,_)}getSetVariableActionHistoryLength(){return this._setVariableActionHistory.length}getSetVariableModeActionHistoryLength(){return this._setVariableModeActionHistory.length}createMultiplayerSetVariableAction(e,r,n,o){let i={nodeForFindingTopmostScreenId:X.toFigGUID(e),targetVariableId:r,targetVariableData:JSON.stringify(n),resolvedVariableModes:JSON.stringify(o)};this._addVariableToHistory(i)}createMultiplayerSetVariableModeAction(e,r,n){let o={nodeForFindingTopmostScreenId:X.toFigGUID(e),targetVariableSetId:Ga.toKiwi(r),targetVariableModeId:n};this._addVariableModeToHistory(o)}performMultiplayerSetVariableAction(e){v().runSetVariable(X.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableId,JSON.parse(e.targetVariableData),JSON.parse(e.resolvedVariableModes)),this._addVariableToHistory(e)}performMultiplayerSetVariableModeAction(e){v().runSetVariableMode(X.fromFigGUID(e.nodeForFindingTopmostScreenId),Ga.fromKiwi(e.targetVariableSetId),e.targetVariableModeId),this._addVariableModeToHistory(e)}_addVariableToHistory(e){let r=e.targetVariableId;if(this._variableIdToSetVariableActionHistoryIndex.has(r)){let n=this._variableIdToSetVariableActionHistoryIndex.get(r);this._setVariableActionHistory[n]=e}else this._variableIdToSetVariableActionHistoryIndex.set(r,this._setVariableActionHistory.length),this._setVariableActionHistory.push(e);this._notifyMultiplayerSetVariableActionHistory()}_addVariableModeToHistory(e){let r=Ga.fromKiwi(e.targetVariableSetId);if(!Ga.isValid(r)){Re.trackEvent("variable_set_mode_action_invalid_id",{variableSetID:r});return}if(this._variableSetIdToSetVariableModeActionHistoryIndex.has(r)){let n=this._variableSetIdToSetVariableModeActionHistoryIndex.get(r);this._setVariableModeActionHistory[n]=e}else this._variableSetIdToSetVariableModeActionHistoryIndex.set(r,this._setVariableModeActionHistory.length),this._setVariableModeActionHistory.push(e);this._notifyMultiplayerSetVariableModeActionHistory(),this._setOverlaysToParentModes(this.getCurrentOverlayData(),this.getCurrentBaseScreenId(),!0)}_notifyMultiplayerSetVariableActionHistory(){this._observers.forEach(e=>{var r;(r=e.handleSetVariableAction)==null||r.call(e,this._setVariableActionHistory)})}_notifyMultiplayerSetVariableModeActionHistory(){this._observers.forEach(e=>{var r;(r=e.handleSetVariableModeAction)==null||r.call(e,this._setVariableModeActionHistory)})}resetVariablePrototypeState(){v().resetLocalVariableChanges(),v().resetLocalVariableModeChanges(),this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory()}resetSetVariableActionHistory(){this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableActionHistory()}resetSetVariableModeActionHistory(){this._setVariableModeActionHistory=[],this._variableSetIdToSetVariableModeActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableModeActionHistory()}createVideoStateChange(e,r,n,o,i){if(e==null||r==null||n==null)return;let a={targetNodeId:X.toFigGUID(e),isPlaying:r,isPlayingSound:n,currentTimes:o,actionTakenTimestamp:i};this._addVideoStateChangeToHistory(a)}performMultiplayerVideoStateChange(e,r){this._appState.videoManager().multiplayerUpdateVideoRuntimes(e,r),this._addVideoStateChangeToHistory(r)}_addVideoStateChangeToHistory(e){if(!e.targetNodeId)return;let r=X.fromFigGUID(e.targetNodeId);this._guidToVideoStateChangeMap.set(r,e),this._notifyMultiplayerVideoStateChangeToHistory()}_notifyMultiplayerVideoStateChangeToHistory(){this._observers.forEach(e=>{var r;(r=e.handleVideoStateChange)==null||r.call(e,Array.from(this._guidToVideoStateChangeMap.values()))})}getVideoStateChangeForGuid(e){return this._guidToVideoStateChangeMap.get(e)}allVisibleVideosAreLoaded(){var e;return((e=this._appState.videoManager())==null?void 0:e.allVisibleVideosAreLoaded())??!1}snapshotLatestVideoStateChanges(){var e;(e=this._appState.videoManager())==null||e.snapshotVideoStates()}getVideoStateChanges(){return Array.from(this._guidToVideoStateChangeMap.values())}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let r=e.findAllSectionsInNode();for(let n of r){let o=this._getStateMachineOrNull(new Rt([n.id()]));o!=null&&o.resetHistoryToFirstFrameInSection(n)}}}notifyMultiplayerEmbeddedPrototypeDataChange(e){this._observers.forEach(r=>{var n;(n=r.handleEmbeddedPrototypeDataChange)==null||n.call(r,e)})}resetPrototype(e=!0){var r;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(r=v())==null||r.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this._clearOverlays(this.getCurrentOverlayData()),this.resetSectionsState(),kr.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,e&&(this._changeHistory=[]),this._tlfHistory=[],this._upcomingTlfs=new Set,this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory(),this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}getOrSetRestartPrototypeNode(){var o;let e=this._appState.activePrototypeStartingPointNodeId();if((e?(o=this._appState.scene())==null?void 0:o.findNode(e):null)==null){let i=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();i!=null&&(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="PrototypeState.getOrSetRestartPrototypeNode",this._appState.setActivePrototypeStartingPointNodeId(i.id()))}return this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas())}restartPrototype(e){if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${qs[e]}`),this.mostRecentBaseScreenIdChangeInitiator="PrototypeState.restartPrototype "+qs[e],this.resetPrototype(),this._observers.forEach(n=>{n.handleRestartPrototype()}),U.getViewerMode()==U.ViewerMode.MIRROR)return;let r=this.getOrSetRestartPrototypeNode();r!=null&&(e==0&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays(r.id()),this.tryToInitiateRequestedStateChange(t.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${qs[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,r,n,o,i,a){var u;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=n!=2,l=null;this._clearInitiatedChangesBeforeNewChange();let c=this._changeHistory.slice(),d=null;for(e!=null&&r!=null?d=Lo.forNoodle(e,r,a):d=Lo.getDefaultExternalExecution();c.length>1&&(s&&le.List_last(c).isTransientChange());)l=c.pop();if(n==0||c.length<=1){((u=r==null?void 0:r.event())==null?void 0:u.interactionType())=="DRAG"&&this._returnToOverlayState(d,o,l==null?void 0:l.oldOverlayData(),l,c);return}for(l=le.List_last(c);c.length>1;){let p=c.pop();if(c.length>1&&s&&le.List_last(c).isTransientChange())continue;let h=p.oldStateId();if(X.equals(h,this.getCurrentBaseScreenId()))this._returnToOverlayState(d,o,p.oldOverlayData(),l,c);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(p==null?void 0:p.oldStateId())==null)continue;this._returnToFrame(h,d,o,l,c,i)}break}}_returnToFrame(e,r,n,o,i,a){var _;let s=(_=this._appState.prototypeStructure())==null?void 0:_.getDestinationFrame(e),l=o.transitionParameters.withStateManagementSettings(a),c=new Rn(4,Rt.ROOT_STABLE_PATH(),new wr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new wr(e,[]),n,r.interactionAddress,1,l);if(s!=null)s.setUsedAsBaseScreen(!0);else{xe("tried to return to deleted frame");return}let d=!1,u=s.findNearestAncestorOrSelf("SECTION"),p=this.getCurrentBaseScreenNode().findNearestAncestorOrSelf("SECTION");if(u!=null&&p!=null){if(u==p||u==p.parent()){let h=this._getStateMachineOrNull(new Rt([u.id()])),g=le.List_last(h.changeHistory()),m=$t.FrozenList_cloneAndRemoveOne(h.changeHistory(),g);this._requestAndSaveSectionStateChange(h,c,m,i),d=!0}else if(p==u.parent()){c=new Rn(4,Rt.ROOT_STABLE_PATH(),new wr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new wr(u.id(),[]),n,r.interactionAddress,1,o.transitionParameters);let h=this._getStateMachineOrNull(new Rt([p.id()])),g=le.List_last(h.changeHistory()),m=$t.FrozenList_cloneAndRemoveOne(h.changeHistory(),g);this._requestAndSaveSectionStateChange(h,c,m,i),d=!0}}d||this._requestStateChange(c,i)}_returnToOverlayState(e,r,n,o,i){var s;let a=this.getCurrentOverlayData();if(n.length<a.length)this._closeOverlayAtAndAbove(n.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,r,i,0);else{for(let d=0,u=n.length;d<u;d=d+1){let p=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(n[d].id);if(p==null)break;p.setUsedAsBaseScreen(!1)}let l=this.getCurrentBaseScreenId(),c=new Rn(4,Rt.ROOT_STABLE_PATH(),new wr(l,this.getCurrentOverlayData()),new wr(l,n),r,e.interactionAddress,1,o.transitionParameters);this._requestStateChange(c,i)}}swapTopOverlay(e,r,n,o,i){var h,g;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let l=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e);if(l==null){xe("tried to swap to null overlay");return}(g=v())==null||g.resetLocalNodeSizeChanges(l.id());let c=a.slice();c[c.length-1]=c[c.length-1].cloneWithId(l.id(),this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen(),l));let d=null,u=0;r!=null&&o!=null?(d=Lo.forNoodle(r,o,i),u=lt.fromInteractionType(o.event().interactionType())):(d=Lo.getDefaultExternalExecution(),u=0);let p=new Rn(3,Rt.ROOT_STABLE_PATH(),new wr(s,a),new wr(s,c),d.interactionAddress,d.canvasSpaceTriggerBoundsOrNull,d.transitionParameters,0,u);if(l==null){xe("tried to swap to null overlay");return}l.setUsedAsBaseScreen(!1);let _=$t.FrozenList_cloneAndAppendOne(this._changeHistory,p);this._requestStateChange(p,_)}baseScreenWasValidDestinationBeforeNodeChanges(){return this._baseScreenWasValidDestinationBeforeNodeChanges}checkValidBaseScreenBeforeNodeChanges(){this._baseScreenWasValidDestinationBeforeNodeChanges||(this._initiatedChangeBeforeNodeChanges=this._initiatedChange,this._changeHistoryBeforeNodeChanges=this._changeHistory,this._baseScreenWasValidDestinationBeforeNodeChanges=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._getBaseScreenIdBeforeNodeChanges())!=null)}checkValidBaseScreenAfterNodeChanges(){if(!this._baseScreenWasValidDestinationBeforeNodeChanges)return;let e=this._appState.prototypeStructure();if(e.validDestinationForPrototypeFromId(this.getCurrentBaseScreenId())==null){if(e.validDestinationForPrototypeFromId(this._getBaseScreenIdBeforeNodeChanges())==null)return;this._initiatedChange=this._initiatedChangeBeforeNodeChanges,this._changeHistory=this._changeHistoryBeforeNodeChanges}this._initiatedChangeBeforeNodeChanges=null,this._changeHistoryBeforeNodeChanges=[],this._baseScreenWasValidDestinationBeforeNodeChanges=!1}_getBaseScreenIdBeforeNodeChanges(){return this._getBaseScreenIdFromChangeOrHistory(this._initiatedChangeBeforeNodeChanges,this._changeHistoryBeforeNodeChanges)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let r=this._getStateMachineOrNull(e);return r!=null&&r.clearInitiatedChangesInSelfAndSubstates(),0}),this._initiatedChange!=null&&(this.mostRecentFixInvalidStateInitiator="PrototypeState._clearInitiatedChangesBeforeNewChange",this.commitStateChange()),this._disableNewStateChanges=!1}_allowNewStateChanges(){return!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._handleOverlaysModeSetting(e,2),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null||this._initiatedHistory==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let r=[],n=o=>{r.push(o)};if(this._broadcastStateChange(e,3,n),this._handleOverlaysModeSetting(e,3),this._allowNewStateChanges())for(let o of r)o();U.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let r=An.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let n of r.asList())this._upcomingTlfs.add(n);this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=FL(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(r=>X.fromString(r)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode(e)==null?null:X.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,r){var n;this._broadcastStateChange(e,0,null),this._requestedStateChange=new t.StateChangeRequest(e,r),this._requestedStateChangeAtMs=Ze.milliseconds(),this._emitter.trigger("requestedStateChange",{interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,cause:lt[e.cause],destinationId:e.newStateId()}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(t.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,r,n,o){this._appState.scene()!=null&&(e.stage(r,n),this._requestStateChange(r,o),X.equals(r.oldStateId(),r.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,r,n){this._appState.scene()!=null&&(e.stage(r,n),X.equals(r.oldStateId(),r.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==t.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):Array.from(this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded()).every(o=>{var a;let i=(a=this._appState.scene())==null?void 0:a.findNode(o);return i==null?!1:i.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){var n;let r=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let o of r)this._visitedScreenIds._in(o)||this._visitedScreenIds.add(o);if(this._requestedStateChangeAtMs>0){let o=Ze.milliseconds()-this._requestedStateChangeAtMs;if(o>100){let i={prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString(),incrementalFrameLoading:!0,timeWaitedForLoadingMs:o,interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,interactionCause:lt[e.cause],destinationId:e.newStateId(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced,destinationWasLoaded:!1,destinationWasInWorkingSet:!1},a=this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.newStateId());this._appState.requestedFrameMetricsTracker().clear(),a&&(i.destinationWasLoaded=a.wasAlreadyLoaded,i.destinationWasInWorkingSet=a.wasAlreadyInWorkingSet),Re.trackDefinedEvent("prototype.viewer_reached_unloaded_frame",i)}}}_initializeStateForObjectAnimation(e){let r=e.oldStateId(),n=e.newStateId(),o=this._appState.scene().findNode(n);if(o==null)return;let i=o.objectAnimations();if(!i.length)return;let a=-1,s=0;if(r!=n)e.direction==0?a=0:e.direction==1&&(a=i.length-1,s=i[a].getAllActions().length-1);else{if(e.direction==0)return;if(e.direction==1)if(e.newObjectAnimationState()==null)a=0;else{let l=e.newObjectAnimationState();if(l==null)return;a=i.findIndex(c=>c.id()==l.interactionId),s=l.actionIndex}}this.logVerbose(()=>`[PrototypeState] _initializeAnimationStateForNewBaseScreen with animation index ${a} with direction ${e.direction}`),a!=-1&&v().previewSceneAt(n,a,s)}_initiateStateChange(e,r){var i;this._disableNewStateChanges=!0,this._updateCurrentBaseScreenIDs(e);for(let a of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(a,s=>{if(s.changeHistory().length>0&&le.List_last(s.changeHistory()).isTransientChange(!0)){let l=lt.getOppositeTransientAction(le.List_last(s.changeHistory()).cause);return this.returnInstanceToState(s.stablePath,0,l),s.clearInitiatedChangesInSelfAndSubstates(),2}return 0});this._emitter.trigger("requestedStateChangeInitiated",{interactionId:(i=e==null?void 0:e.interactionAddress)==null?void 0:i.interactionId,cause:lt[e.cause],destinationId:e.newStateId()}),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=r;let n=e.newStateId(),o=this._tlfHistory.indexOf(n);this._initializeStateForObjectAnimation(e),o<0&&le.List_appendOne(this._tlfHistory,n),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),this._handleOverlaysModeSetting(e,1),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.canInstantlyCommit()&&(this.mostRecentFixInvalidStateInitiator="PrototypeState._initiateStateChange",this.commitStateChange()),this._deferEnqueueUpcomingTlfs()}_updateCurrentBaseScreenIDs(e){var n;let r=e.newStateAndOverlays.statesAndOverlaysIncluded();(n=v())==null||n.modules().prototype.updateCurrentBaseScreenIDs(r)}_handleOverlaysModeSetting(e,r){let n=e.oldOverlayData(),o=n.length,i=e.newOverlayData(),a=i.length;if(!(a==0&&o==0)){if(a>o)r==1?this._setOverlaysToParentModes(i.slice(o),e.oldStateAndOverlays.topId()):r==2&&this._clearOverlays(i.slice(o));else if(a<o)r==3&&this._clearOverlays(n.slice(a));else if(a>0&&o>0&&a===o&&i[a-1].id!=n[o-1].id){let s=[i[a-1]];r==1?this._setOverlaysToParentModes(s,this.getSecondTopmostOverlayNodeOrBaseScreen().id()):r==2&&this._clearOverlays(s),r==3&&this._clearOverlays([n[o-1]])}}}_getOverlayDerivedModes(e,r){let n=r.getExplicitVariableModesWithSetKeys(),o=r.getResolvedVariableModesWithSetKeys(),i=e.getResolvedVariableModesWithSetKeys();return Object.entries(i).filter(([a,s])=>o[a]!=null&&n[a]==null)}_setOverlaysToParentModes(e,r,n){var i;let o=r;e.forEach(a=>{let s=this._appState.scene().findNode(a.id),l=this._appState.scene().findNode(o),c=l.getResolvedVariableModesWithSetKeys(),d=[];n?a.newOverlayExplicitModes.forEach(([u,p])=>{let _=c[u];PO(_,p)||s.setExplicitVariableModeForCollectionWithSetKey(u,_==null?void 0:_.guid,(_==null?void 0:_.extendedCollectionId)??null),d.push([u,_])}):this._getOverlayDerivedModes(l,s).forEach(([u,p])=>{var _,h;s.setExplicitVariableModeForCollectionWithSetKey(u,(_=c[u])==null?void 0:_.guid,((h=c[u])==null?void 0:h.extendedCollectionId)??null),d.push([u,c[u]])}),a.newOverlayExplicitModes=d,o=a.id}),(i=v())==null||i.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}_clearOverlays(e){var r;e.forEach(n=>{let o=this._appState.scene().findNode(n.id);if(o==null)return;let i=o.getExplicitVariableModesWithSetKeys();n.oldOverlayDerivedModes.filter(([a,s])=>{var l;return i[a]!=null&&PO(i[a],(l=n.newOverlayExplicitModes.find(([c])=>c===a))==null?void 0:l[1])}).forEach(([a,s])=>{o.clearExplicitVariableConsumerModeForCollectionWithSetKey(a)})}),(r=v())==null||r.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,r,n){let o=this._isNotifyingStateChangeObservers;switch(o&&xe("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,r){case 0:{this._observers.forEach(i=>{i.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(i=>{i.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(i=>{i.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(i=>{i.handleStateChangeCommitted(e,n)});break}}this._isNotifyingStateChangeObservers=o}debugHSMTree(){console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM =="),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let r=e==null?void 0:e.guids;if(r==null)return null;let n=this._hsmRoot;for(let o of r){if(n==null)break;n=n.childOrNull(o)}return n}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(Rt.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,r){var i;let o=[this._getStateMachineOrNull(e)];for(;o.length>0;){let a=o.pop();if(a!=null){let s=((i=this._appState.scene())==null?void 0:i.findNodeByStablePath(a.stablePath))==null,l=0;s?a==this._hsmRoot?l=0:l=2:l=r(a);let c=!1;switch(l){case 1:{c=!0;break}case 0:{ln(o,a.getChildren());break}case 2:continue}if(c)break}}}createOrRepairStateMachinesForInsertedSubtree(e){no(e,r=>{if(r.isInstance()||r.isSlotReactive()){let n=r.symbolID()??X.invalid();X.isValid(n)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(r,n)}else r.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(r,r.id())})}createOrRepairSectionStateMachineIfNeeded(e,r){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){xe("Could not create or repair state machine for section with null parent");return}let o=le.List_last(e.stablePath().guids),i=n.childOrNull(o);if(i!=null)if(X.equals(i.stateId(),r)){this._isResettingStateChangeMutations&&i.resetHistoryToFirstFrameInSection(e);return}else i.initiatedChange()!=null&&this.commitSectionStateChange(i);n.setChild(o,new Su(this,e,r,!0))}createOrRepairInstanceStateMachineIfNeeded(e,r){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){console.warn("Could not create or repair state machine with null parent");return}let o=le.List_last(e.stablePath().guids),i=n.childOrNull(o);if(i!=null){if(X.equals(i.stateId(),r)){this._isResettingStateChangeMutations&&i.resetHistoryToState(r);return}else if(i.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(i)}}n.setChild(o,new Su(this,e,r))}actionCounterForState(e){let r=this._getStateMachineOrNull(e);return r==null?-1:r.actionCounter}actionCountersForStateAndAncestors(e){let r=[this.actionCounter()];for(let n=0,o=e.guids.length;n<o;n=n+1)r.push(this.actionCounterForState(e.slice2(0,n+1)));return r}getStateMachineInitiatedChange(e){let r=this._getStateMachineOrNull(e);return r==null?void 0:r.initiatedChange()}getStateMachineLastChangeInHistory(e){let r=this._getStateMachineOrNull(e);return r==null||r.changeHistory().length==0?null:r!==null?le.List_last(r.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let r=this.getStateMachineLastChangeInHistory(new Rt([e]));return r!=null?r.newStateAndOverlays.stateId:null}getState(e){let r=this._getStateMachineOrNull(e);return r==null?void 0:r.stateId()}_forEachMaterializedStateInTlf(e,r){var o;let n=(o=this._appState.scene())==null?void 0:o.findNode(e);n==null||!n.isTopLevel()||no(n,i=>{if(i.isInstance()){let a=this._getStateMachineOrNull(i.stablePath());if(a!=null)return r(a)}return 0})}_forEachTransitioningStateMachine(e){for(let r of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(r)!=-1){let n=this._initiatedInstanceChanges.get(r);if(e(n.stablePath)==1)break}}getOnscreenStates(){let e=[],r=this.getLayersIds();for(let n of r)this._forEachMaterializedStateInTlf(n,o=>{if(!1){let i=this._appState.scene().findNodeByStablePath(o.stablePath)}return e.push(new ao(o.stablePath,o.stateId())),0});return e}forMaterializedStateInstanceAndDescendants(e,r){this._forMaterializedStateMachineAndDescendants(e,n=>r(n.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=Ze.milliseconds()+(en?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,r){let n=e.guids,o=[],i=this._hsmRoot,a=0;for(;i!=null&&a<n.length;)i=i.childOrNull(n[a]),i!=null&&o.push(i),a=a+1;if(!(o.length==0||!Rt.equals(le.List_last(o).stablePath,e))){for(let s=o.length-1;s>=0;s=s-1)if(r(o[s])==1)return}}_shouldDisableNewChangesInStateMachine(e){var o;let r=(o=this._appState.scene())==null?void 0:o.findNodeByStablePath(e.stablePath);if(r==null)return!0;let n=r;for(;n!=null;){let i=this._getStateMachineOrNull(n.stablePath());if(i!=null&&i.isClearingChangesInSelfAndSubstates())return!0;n=n.parent()}return!1}swapInstanceToState1(e,r,n,o,i,a){this.swapInstanceToState2(e,r,n,o,i,a,null)}swapInstanceToState2(e,r,n,o,i,a,s){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${r} cause: ${lt[o]}`);let l=this._getStateMachineOrNull(e);if(l==null||this._shouldDisableNewChangesInStateMachine(l)||this._validatedStateSwapDestination(l.stateId(),r)==null)return;l.clearInitiatedChangesInSelfAndSubstates();let d=n!=null&&i!=null?Lo.forNoodle(n,i,s):Lo.getDefaultExternalExecution(),u=new Rn(2,l.stablePath,l.stateId(),r,d.interactionAddress,d.canvasSpaceTriggerBoundsOrNull,d.transitionParameters,o),p=null;switch(a){case 0:{p=l.changeHistory();break}case 1:{p=$t.FrozenList_cloneAndAppendOne(l.changeHistory(),u);break}case 2:{p=[u];break}}let _=this._shouldDisallowSwap(e,r);_==ll.DISALLOWED_CYCLE?this._onStateSwapFailedDueToCycle():_==ll.ALLOWED&&this._requestInstanceStateChange(l,u,p)}returnInstanceToState(e,r,n){var p,_;let o=(p=this._appState.scene())==null?void 0:p.findNodeByStablePath(e);this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:e.toString(),action:n,timeRecorded:Date.now(),name:o.name(),currentFrameName:(_=this.getCurrentBaseScreenNode())==null?void 0:_.name()}),this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${lt[n]}`);let i=this._getStateMachineOrNull(e);if(i==null||this._shouldDisableNewChangesInStateMachine(i)||(i.clearInitiatedChangesInSelfAndSubstates(),i.changeHistory().length<=1))return;let a=i.cloneHistoryForReturnToState(r,(h,g)=>this._validatedStateSwapDestination(h,g)),s=a.a,l=a.b,c=this._validatedStateSwapDestination(i.stateId(),le.List_last(l).newStateId());if(c==null)return;let d=new Rn(2,i.stablePath,i.stateId(),c.id(),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n),u=this._shouldDisallowSwap(i.stablePath,c.id());u==ll.DISALLOWED_CYCLE?this._onStateSwapFailedDueToCycle():u==ll.ALLOWED&&this._requestInstanceStateChange(i,d,l)}_requestInstanceStateChange(e,r,n){this._forMaterializedStateMachineAndDescendants(e.stablePath,i=>{if(i!=e&&i.changeHistory().length>0&&le.List_last(i.changeHistory()).isTransientChange(!0)){let a=lt.getOppositeTransientAction(le.List_last(i.changeHistory()).cause);return this.returnInstanceToState(i.stablePath,0,a),i.clearInitiatedChangesInSelfAndSubstates(),2}return 0});let o=this._appState.scene();if(o!=null){e.stage(r,n),this._initiatedInstanceChanges.set(e.stablePath.toString(),r),this._lastInitiatedInstanceStateChange=r;let i=this._appState.scene().findNodeByStablePath(r.interactionAddress.hotspotStablePath),a=new Map,s=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,r,0,null),o.dangerouslyDeferNodeRemovalScope(()=>{let d=this._getFullscreenNodeChangesForStateSwap(e.stablePath,r.newStateId(),cl.MATERIALIZE_SWAPPED_OUT_TREE,!0);for(let u of d.cloneOps)u.clone.copyNodeCachedTransformAndBounds(u.source),a.set(u.source,u.clone);s=this._appState.scene().findNodeByStablePath(d.transitionRootStablePath)});let l=x_.Map_getOrDefault(a,i,null),c=x_.Map_getOrDefault(a,s,null);s!=null&&c!=null?s.transitioningFrom=new kp(c,r.stablePath,l):xe("Failed to find swapped out node after state swap"),X.equals(r.oldStateId(),r.newStateId())||(this._forEachTransitioningStateMachine(d=>{if(!Rt.equals(r.stablePath,d)){let u=o.findNodeByStablePath(d);if(s!=null&&s.isAncestorOf(u)){let p=this._getStateMachineOrNull(d);this.commitInstanceStateChange(p)}}return 0}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,r,1,null),this.logVerbose(()=>`[HSM] initiate ${r.oldStateId()} -> ${r.newStateId()} finished for ${e.stablePath} -- ${r.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var n,o;let r=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e);for(let i of Array.from(this._initiatedInstanceChanges.keys())){let a=this._initiatedInstanceChanges.get(i);if(a!=null){let s=this._getStateMachineOrNull(a.stablePath);s!=null&&r!=null&&r.isAncestorOf((o=this._appState.scene())==null?void 0:o.findNodeByStablePath(s.stablePath))&&this.commitInstanceStateChange(s)}}}commitChangesBelowInstanceTransitionRoot(e){let r=this._findTransitionRootForSwappedPath(e),n=r==null?e:r.stablePath();this.commitChangesBelowStablePath(n)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let r=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),X.equals(r.oldStateId(),r.newStateId())||this._finishStateSwapMutation(r.stablePath);let n=[],o=i=>{n.push(i)};if(e.broadcastHsmStateChange(this._hsmObservers,r,3,o),!e.isClearingChangesInSelfAndSubstates())for(let i of n)i();this.logVerbose(()=>`[HSM] commit ${r.oldStateId()} -> ${r.newStateId()} finished for ${r.stablePath} -- ${r.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let r=this._getStateMachineOrNull(e);if(r==null||r.initiatedChange()==null)return;let n=r.initiatedChange();if(this._appState.scene()!=null){r.stage(null,null),this._initiatedInstanceChanges.delete(r.stablePath.toString());let i=this._findTransitionRootForSwappedPath(e),a=i.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,i.transitioningFrom=null,a.removeSelfAndSubtree(),r.broadcastHsmStateChange(this._hsmObservers,n,0,null),this._getFullscreenNodeChangesForStateSwap(r.stablePath,n.oldStateId(),cl.SKIP_MATERIALIZATION),this._isApplyingStateChangeMutation=!1}r.broadcastHsmStateChange(this._hsmObservers,n,2,null),this.logVerbose(()=>`[HSM] abort ${n.oldStateId()} -> ${n.newStateId()} finished for ${r.stablePath} -- ${n.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,r){var s,l;let n=(s=this._appState.scene())==null?void 0:s.findNode(e),o=n==null?void 0:n.parent();if((n==null?void 0:n.type())!="SYMBOL"||o==null||!o.isStateGroup())return null;let i=(l=this._appState.scene())==null?void 0:l.findNode(r),a=i==null?void 0:i.parent();return(i==null?void 0:i.type())!="SYMBOL"||a==null||!a.isStateGroup()||X.equals(e,r)?null:X.equals(o.id(),a.id())?i:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var n;let r=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e);for(;r!=null;){if(r.transitioningFrom!=null&&r.transitioningFrom.swappedStablePath==e)return r;r=r.parent()}return null}_finishStateSwapMutation(e){let r=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),r==null)return;let n=r.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,r.transitioningFrom=null,n.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,r.invalidateRenderTreeForSelfAndParents(),r.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,r,n,o){return v().getNodeChangesForSwap(e,r,n,o)}_shouldDisallowSwap(e,r){return v().shouldDisallowSwap(e,r)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(r=>{class t{constructor(o,i){this.change=o,this.history=i}}r.StateChangeRequest=t;let e;(i=>(i[i.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",i[i.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=r.InitiateRequestedStateChangePolicy||(r.InitiateRequestedStateChangePolicy={}))})(Xs||(Xs={}));var qs=(r=>(r[r.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",r[r.USER_REQUESTED=1]="USER_REQUESTED",r))(qs||{});var Su=class{constructor(e,r,n,o){this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=e,r?(this.stablePath=r.stablePath(),o?this.resetHistoryToFirstFrameInSection(r):this.resetHistoryToState(n)):(this.stablePath=new Rt([]),this.setChangeHistory([]))}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,r){let n="";for(let p=0,_=e;p<_;p=p+1)n+="  ";n+=this.stablePath.toString()+": ";let o="missing state name",i="(N/A)";if(this.stateId()!=null){let p=r.findNode(this.stateId());p!=null&&(o=p.name()??"null state name"),i="("+this.stateId()+")"}n+="<"+o+" "+i+">";let a="[",s=0,l=3,c=this.changeHistory();c.length>l&&(a+="..., ",s=c.length-l);for(let p=s,_=c.length;p<_;p=p+1){let h=c[p];a+=`${(h==null?void 0:h.oldStateId())??"null"}->${h==null?void 0:h.newStateId()}`,p!=c.length-1&&(a+=", ")}a+="]",n+=" "+a;let d=r.findNodeByStablePath(this.stablePath);if(d!=null){let p=d.name()??"null node name";n+=" "+p}let u=this.initiatedChange()!=null?`{${this.initiatedChange().oldStateId()??"null"}->${this.initiatedChange().newStateId()}}`:"";n+=" "+u+`
`;for(let p of Array.from(this._children.values()))n+=p._debugHierarchy(e+1,r);return n}removeChild(e){this._children.delete(e)}setChild(e,r){this._children.set(e,r)}childOrNull(e){return qe.StringMap_get(this._children,e,null)}getChildren(){return Array.from(this._children.values())}stage(e,r){this._initiatedChange=e,this._initiatedChangeHistory=r}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var r,n;if(((r=this.initiatedChange())==null?void 0:r.newStateId())!=null)return(n=this.initiatedChange())==null?void 0:n.newStateId();let e=this.changeHistory();return e!=null&&e.length>0?le.List_last(e).newStateId():X.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,r){let n=e!=2,o=null,i=this.changeHistory().slice();for(;i.length>1&&(n&&le.List_last(i).isTransientChange());)o=i.pop();if(e==0||i.length<=1)return new ao(o,i);for(o=le.List_last(i);i.length>1;){let a=i.pop();if(!(i.length>1&&n&&le.List_last(i).isTransientChange()||r(a.newStateId(),a.oldStateId())==null))break}return new ao(o,i)}resetHistoryToState(e){let r=new Rn(2,this.stablePath,null,e,ei.EXTERNAL,null,Sn.getDefault(),0);this.setChangeHistory([r])}resetHistoryToFirstFrameInSection(e){let r=Ql.visuallySortedTopLevelFrames(e);if(r.length>0){let n=r[0];if(n!=null){let o=new Rn(2,this.stablePath,null,n.id(),ei.EXTERNAL,null,Sn.getDefault(),0);this.setChangeHistory([o])}}else this.setChangeHistory([])}broadcastHsmStateChange(e,r,n,o){let i=this._isNotifyingStateChangeObservers;switch(i&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,n){case 0:{e.forEach(a=>{a.handleHsmRequested(this.stablePath,r)});break}case 1:{e.forEach(a=>{a.handleHsmInitiated(this.stablePath,r)});break}case 2:{e.forEach(a=>{a.handleHsmAborted(this.stablePath,r)});break}case 3:{e.forEach(a=>{a.handleHsmCommitted(this.stablePath,r,o)});break}}this._isNotifyingStateChangeObservers=i}};function DO(t){return t==="ON_HOVER"||t==="ON_PRESS"}var k_=class{constructor(e){this._noodleMap=new fs,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.triggerPotentialTimedTransitionForSpecificRootNode=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,r){r.some(o=>o.isValid())?this._noodleMap.update(e,r):this._noodleMap.update(e,[])}getStateGroupStateSwapInteractionCounts(){return this._noodleMap.stateGroupStateSwapInteractionCounts}_setHyperlinkInteractionInNoodleMap(e){if(An.isNodeInteractableBecauseOfHyperlinks(e)){let r=An.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[r])}}cleanedUpMediaEndInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(2)}cleanedUpMediaHitInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(3)}cleanedUpInteractionMapForPrefilteredType(e){return new fs.CleanedMap(this._noodleMap,e,r=>{var i,a;let n=(i=this._scene)==null?void 0:i.findNode(r),o=(a=this._noodleMap.noodleNodes.get(r,null))==null?void 0:a.prefilteredInteractionsByType.get(e);return An.cleanedInteractionsForNodeFromDirtyInteractions(this._appState,n,o==null?void 0:o.asList())})}cleanedUpInteractionMap(){return new fs.CleanedMap(this._noodleMap,0,e=>{var n;let r=(n=this._scene)==null?void 0:n.findNode(e);return An.cleanedInteractionsForNode(this._appState,r)})}cleanedUpTransitionMap(){return new fs.CleanedMap(this._noodleMap,1,e=>{let r=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(n=>{n.interactionContainsTransitionAction()&&r.push(n)}),r})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new zo(r=>r);for(let r of this.cleanedUpTransitionMap().hotspots()){let n=this._scene.findNode(r);if(n!=null){let o=null,i=n.topLevelAncestor();i!=null&&i.visible()&&(o=i.id()),o!=null&&(e._in(o)||e.set(o,[]),ln(e.get(o),this.cleanedUpTransitionMap().getHotspotInteractions(r).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}rawInteractionMapForTests(){return new fs.RawMapForTests(this._noodleMap)}handleSceneChange(e,r){this._scene=r,e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){this._noodleMap.noodleNodes.clear(),this._noodleMap.stateGroupStateSwapInteractionCounts.clear(),this._noodleMap.guidsForPrefilterType.forEach(n=>n.clear()),this._noodleMap.queuedInteractionChanges=[],r!=null&&this._addConnectionsFromSubtree(r),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,r){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._addConnectionsFromSubtree(o)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let r=0,n=e.childCount();r<n;r=r+1)this._removeConnectionsFromSubtree(e.childAt1(r))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let r=!1;if((xo.isInteractionProperty(e.property)||xo.affects(e.property,61)||xo.affects(e.property,47))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),r=!0),X.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(n=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,n.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(n.event().interactionType()=="ON_MEDIA_HIT"||n.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==112||e.property==3||e.property==71||e.property==40)r=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==58){let n=e.oldVal!=null&&pt.isParentIndex(e.oldVal)?pt.asParentIndex(e.oldVal):null,o=e.newVal!=null&&pt.isParentIndex(e.newVal)?pt.asParentIndex(e.newVal):null,i=n!=null?e.node.scene().findNode(n.id):null,a=o!=null?e.node.scene().findNode(o.id):null,s=i!=null&&i.isRooted(),l=a!=null&&a.isRooted();s&&!l?(this._removeConnectionsFromSubtree(e.node),r=!0):!s&&l&&(this._addConnectionsFromSubtree(e.node),r=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),s&&l&&i.id()!=a.id()&&(r=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}e.property==112&&this.triggerPotentialTimedTransitionForSpecificRootNode!=null&&this.triggerPotentialTimedTransitionForSpecificRootNode(e.node),r&&(this._cachedCleanedUpTransitionMapByTlf=null)}};var lS=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null),this.caches.set(2,null),this.caches.set(3,null)}constructor(){this.interactions=new oa(e=>e.id()),this.backReferences=new zo(e=>e),this.caches=new Map([[0,null],[1,null],[2,null],[3,null]]),this.prefilteredInteractionsByType=new Map}},xO=new Map([[3,t=>t.event().interactionType()=="ON_MEDIA_HIT"],[2,t=>t.event().interactionType()=="ON_MEDIA_END"]]);var fs=class{constructor(){this.queuedInteractionChanges=[];this.noodleNodes=new zo(e=>e),this.stateGroupStateSwapInteractionCounts=new zo(e=>e),this.guidsForPrefilterType=new Map([[2,new oa(e=>e)],[3,new oa(e=>e)]])}update(e,r){var i,a,s;let n=((a=(i=this.noodleNodes.get(e.id()))==null?void 0:i.interactions)==null?void 0:a.asList())??[];for(let l=0,c=n.length;l<c;l=l+1){let d=n[l];this._eraseInteraction(e,d)}for(let l=0,c=r.length;l<c;l=l+1){let d=r[l];this._addInteraction(e,d)}let o=this.noodleNodes.get(e.id());if(o!=null&&o.interactions.count()==0&&o.backReferences.count()==0){for(let l of xO.keys())(s=this.guidsForPrefilterType.get(l))!=null&&s._in(e.id())&&xe("Removing noodleNode which is still referenced in guidsForPrefilterType");this.noodleNodes.remove(e.id())}}_updateStateGroupSwapInteractionCounts(e,r,n){if(U.shouldPreventVolatileCaching())return;let o=e.getBackingSymbolParent();if(!(!o||!o.isStateGroup())){for(let i of r.allActions())if(i.navigationType()=="SWAP_STATE"){let a=this.stateGroupStateSwapInteractionCounts.get(o.id(),0),s=n?1:-1;this.stateGroupStateSwapInteractionCounts.set(o.id(),a+s)}}}_processQueuedInteractionChanges(){for(;this.queuedInteractionChanges.length>0;){let e=this.queuedInteractionChanges[0];switch(e.change){case 0:this._updatePrefilteredInteractionsForAddedInteraction(e.interaction,e.guid);case 1:this._updatePrefilteredInteractionsForRemovedInteraction(e.interaction,e.guid)}this.queuedInteractionChanges.shift()}}_addInteraction(e,r){let n=e.id(),o=this.noodleNodes.get(n)??new lS;this.noodleNodes.set(n,o),o.interactions.add(r);for(let i of r.allActions()){let a=i.transitionNodeID();if(DL(a,i.connectionType())){let s=this.noodleNodes.get(a);s==null&&(s=new lS,this.noodleNodes.set(a,s)),s.backReferences.set(n,s.backReferences.get(n,0)+1)}}o.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,r,!0),U?U.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForAddedInteraction(r,n)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:r,guid:n,change:0})}_updatePrefilteredInteractionsForAddedInteraction(e,r){let n=this.noodleNodes.get(r);n&&e!=null&&n!=null&&xO.forEach((o,i)=>{var a;if(o(e)){let s=n.prefilteredInteractionsByType.get(i)??new oa(l=>l.id());n.prefilteredInteractionsByType.set(i,s),s.add(e),(a=this.guidsForPrefilterType.get(i))==null||a.add(r)}})}_eraseInteraction(e,r){let n=e.id(),o=this.noodleNodes.get(n);o!=null&&o.interactions.remove(r);for(let i of r.allActions()){let a=i.transitionNodeID();if(DL(a,i.connectionType())){let s=this.noodleNodes.get(a);if(s!=null){let l=s.backReferences.get(n,0);s.backReferences.set(n,l-1),s.backReferences.get(n,0)<=0&&s.backReferences.remove(n)}}}o==null||o.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,r,!1),U?U.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForRemovedInteraction(r,n)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:r,guid:n,change:1})}_updatePrefilteredInteractionsForRemovedInteraction(e,r){var o;let n=this.noodleNodes.get(r);if(e!=null&&n!=null)for(let i of xO.keys()){let a=n.prefilteredInteractionsByType.get(i);a==null||a.remove(e),(!a||(a==null?void 0:a.count())<1)&&((o=this.guidsForPrefilterType.get(i))==null||o.remove(r))}}invalidateHotspotAndChildren(e){no(e,r=>{if(this.noodleNodes._in(r.id())){let n=this.noodleNodes.get(r.id());n==null||n.invalidateCaches()}return 0})}invalidateBackRefsForDestinationAndChildren(e){no(e,r=>{if(this.noodleNodes._in(r.id())){let n=this.noodleNodes.get(r.id());n==null||n.backReferences.each((o,i)=>{var a;(a=this.noodleNodes.get(o))==null||a.invalidateCaches()})}return 0})}};(r=>{class t{_in(o){return this.noodleMap.noodleNodes._in(o)&&this.getHotspotInteractions(o).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(o=>this.getHotspotInteractions(o).length!=0)}getHotspotInteractions(o){var i;return((i=this.noodleMap.noodleNodes.get(o))==null?void 0:i.interactions.asList())??[]}constructor(o){this.noodleMap=o}}r.RawMapForTests=t;class e{_in(o){return this.noodleMap.noodleNodes._in(o)?this.getHotspotInteractions(o).length!=0:!1}hotspots(){return this.cacheType===2||this.cacheType===3?this.noodleMap.guidsForPrefilterType.get(this.cacheType).asList().filter(o=>this.noodleMap.noodleNodes._in(o)?this.getHotspotInteractions(o).length!=0:(xe("GUID in guidsForPrefilterType not in noodleNodes"),!1)):this.noodleMap.noodleNodes.keys().filter(o=>this.getHotspotInteractions(o).length!=0)}getHotspotInteractions(o){let i=this.noodleMap.noodleNodes.get(o);return i?(i.caches.get(this.cacheType)==null&&i.caches.set(this.cacheType,this.computeCacheForHotspot(o)),i.caches.get(this.cacheType)):[]}constructor(o,i,a){this.noodleMap=o,this.cacheType=i,this.computeCacheForHotspot=a}}r.CleanedMap=e})(fs||(fs={}));function DL(t,e){return t!=null&&X.isValid(t)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var Ki=class{constructor(e,r=null){this.node=e,this.hyperlink=r}canvasSpaceScrolledInteractiveBounds(e){let r=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?ar.FrozenRect_new4(this.hyperlink.bounds.x+r.x(),this.hyperlink.bounds.y+r.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):r}},cS=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}},Tn=class t extends cS{asScreen(){return this}hash(){let e=`${this.nodeId}-${t.FrameRole[this.role]}`;return this.role==t.FrameRole.OVERLAY?e+`-${this.overlayStackPosition}`:e}static forBaseScreen(e){return new t(e,t.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(e,r,n,o){return new t(e,t.FrameRole.OVERLAY,r,n,o)}constructor(e,r,n,o,i){super(),this.nodeId=e,this.role=r,this.overlayStackPosition=n,this.prototypeAction=o,this.precedingOverlays=i}};(e=>{let t;(o=>(o[o.BASE_SCREEN=0]="BASE_SCREEN",o[o.OVERLAY=1]="OVERLAY"))(t=e.FrameRole||(e.FrameRole={}))})(Tn||(Tn={}));var wO=class extends cS{asSmartAnimate(){return this}hash(){return`Smart animate ${this.srcNodeId} -> ${this.dstNodeId} w/ ${this.transitionType}`}constructor(e,r,n,o,i){super(),this.srcNodeId=e,this.dstNodeId=r,this.role=n,this.transitionType=o,this.easingFunction=i}},H_;(e=>{function t(r,n){if(n=="URL"){if(r!="ON_CLICK"&&r!="MOUSE_UP")return!1}else if(n=="BACK"&&DO(r))return!1;return!0}e.isValidForConnection=t})(H_||(H_={}));var dS=class dS{constructor(e){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=Xt.getEventEmitter(),this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new k_(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,r){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,r){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(xo.isPrototypeStructuralChange(e.property)||e.property==71||e.property==40||e.property==3||e.property==70){this._cachedPrerenderJobList=null;let r=this._appState.prototypeState();r.isApplyingStateChangeMutation()||r.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated"),this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,r){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),Bt.getFeatureGate("viewer_no_prerender")?0:dS.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}navigationOrder(){switch(this._appState.editorType()){case"SLIDES":return new M_(this._appState);default:return this.topLevelPrototypeStartingPointNodeIdsSorted().length>0||U.getViewerMode()==U.ViewerMode.MIRROR?new aS(this._appState):new Ql(this._appState)}}navigationOrderType(){return this.navigationOrder().navigationOrderType()}isLinear(){return this.navigationOrder().isLinear()}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;let e=this._appState.activePrototypeStartingPointNodeId();if(e!=null){let n=this._scene().findNode(e);if(n!=null&&n.visible())return n}let[r]=this.topLevelPrototypeStartingPointNodeIdsSorted();return r?this._scene().findNode(X.fromString(r)):null}nodeToRestartPrototypeOn(e){return this.navigationOrder().nodeToRestartPrototypeOn(e)}getDestinationFrame(e){var o,i,a;let r=(o=this._scene())==null?void 0:o.findNode(e);if(r==null)return null;let n=s=>{let l="",c=s.children().find(d=>d.isValidTLFType())||null;if(c==null){if(c=this._appState.prototypeState().getOrSetRestartPrototypeNode(),c==null)return{lastFrame:c,lastFrameOrSectionID:l};l=c.id()}else l=c.id();return{lastFrame:c,lastFrameOrSectionID:l}};if(r.type()=="SECTION"){let s=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(r.id()),l=(i=this._scene())==null?void 0:i.findNode(s);if(l==null){let c=n(r);l=c.lastFrame,s=c.lastFrameOrSectionID}if((l==null?void 0:l.type())=="SECTION"){let c;for(;!(l!=null&&l.isValidTLFType());)if(s=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(s),c=l,l=(a=this._scene())==null?void 0:a.findNode(s),l==null){let d=n(c);l=d.lastFrame,s=d.lastFrameOrSectionID}}return l}return r}validDestinationForPrototypeFromId(e){let r=this.getDestinationFrame(e);return r==null||!r.isTopLevel()||!r.isVisibleInCanvas()||r.isStateGroup()||r.isGroup()||r.isSkippedSlide()||er.isImmutableFrame(r.type())?null:r}topLevelPrototypeNodesInOrder(){return this.navigationOrder().topLevelPrototypeNodesInOrder()}topLevelPrototypeStartingPointNodeIdsSorted(){let e=this._appState.getActiveCanvas();return e==null?[]:v().topLevelPrototypeStartingPointsSorted(e.id())}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?null:v().topLevelPrototypeStartingPointsSorted(e.id()).map(n=>{let o=this._scene().findNode(n);if(o)return{id:o.id(),name:o.prototypeStartingPoint().name,description:o.prototypeStartingPoint().description}}).filter(Boolean)}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(Tn.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let r=(a=this._scene())==null?void 0:a.findNode(e.nodeId);if(r==null)return[];let n=new Map,o=[],i=s=>{n.has(s.hash())||(n.set(s.hash(),!0),o.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),l=s.indexOf(e.nodeId);if(l!=-1){let c=l+1,d=null;c<s.length?d=X.fromString(s[c]):d=this._appState.prototypeStructure().navigationOrder().getNextBaseScreenId(),d!=null&&i(Tn.forBaseScreen(d))}}return this.forTransitionInFrame(r,s=>{for(let l of s.allActions()){if(l==null||!X.isValid(l.transitionNodeID()))return!0;let c=l.transitionType(),d=!1;if(l.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(c=="SMART_ANIMATE"||Kn.supportsSmartAnimate(c)&&l.transitionShouldSmartAnimate())&&(d=!0),e.role==1&&c=="SMART_ANIMATE"&&l.navigationType()=="SWAP"&&(d=!0),d&&i(new wO(r.id(),l.transitionNodeID(),e.role,c,l.easingFunction)),l.navigationType()=="NAVIGATE"){i(Tn.forBaseScreen(l.transitionNodeID()));let u=this._scene().findNode(l.transitionNodeID());u!=null&&u.setUsedAsBaseScreen(!0)}else if(l.navigationType()=="OVERLAY"){let u=e.precedingOverlays!=null?e.precedingOverlays.slice():[];u.push(l.transitionNodeID()),i(Tn.forOverlay(l.transitionNodeID(),e.overlayStackPosition+1,l,u));let p=this._scene().findNode(l.transitionNodeID());p!=null&&p.setUsedAsBaseScreen(!1)}else if(l.navigationType()=="SWAP"){if(e.role==1){let u=e.precedingOverlays!=null?e.precedingOverlays.slice():null;u!=null&&(u[u.length-1]=l.transitionNodeID()),i(Tn.forOverlay(l.transitionNodeID(),e.overlayStackPosition,l,u))}else i(Tn.forBaseScreen(l.transitionNodeID()));this._scene().findNode(l.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),o}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var i;if(((i=this._scene())==null?void 0:i.findNode(e))==null)return null;let n=this.topLevelPrototypeNodesInOrder(),o=n.indexOf(e);if(o!=-1){let a=o-1;if(a>=0)return Tn.forBaseScreen(X.fromString(n[a]))}return null}computePrerenderJobsForStartNode(e,r){if(e==null)return[];let n=[Tn.forBaseScreen(e)],o=[Tn.forBaseScreen(e)],i=new Map,a=0;for(i.set(n[0].hash(),!0);a<n.length;){let s=n[a],l=[],c=this.prerenderJobForNodeBefore(s.nodeId);if(c!=null&&l.push(c),ln(l,this.prerenderJobsAfter(s)),l.forEach(d=>{if(o.length<r&&!i.has(d.hash())){let u=d.asScreen();u!=null&&n.push(u),o.push(d),i.set(d.hash(),!0)}}),n.length==r)break;a=a+1}return o}forTransitionInFrame(e,r){let n=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(n._in(e.id())){let o=n.get(e.id());for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(!r(s))return}}}forInteractionInFrame(e,r){this.forInteractionInFrames([e],r)}getInteractionsGroupedByType(e){let r=this._nodeTransitionTracker.cleanedUpInteractionMap(),n={};for(let o of r.hotspots()){let i=this._scene().findNode(o);if(i!=null)for(let a of e)a!=null&&a.isAncestorOf(i)&&r.getHotspotInteractions(o).forEach(s=>{let l=s.event().interactionType().toString();n[l]||(n[l]=[]),n[l].push({node:i,interaction:s})})}return n}static getNodeInteractionPairs(e,r){if(r!==null)return r[e]||[]}forInteractionInFrames(e,r){let n=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let o of n.hotspots()){let i=this._scene().findNode(o);if(i!=null)for(let a of e)a!=null&&a.isAncestorOf(i)&&n.getHotspotInteractions(o).forEach(s=>{r(i,s)})}}forHotspotInMap(e,r){for(let n of Array.from(e.keys())){let o=this._scene().findNode(n);if(o!=null){let i=!1;if(An.isNodeInteractableBecauseOfHyperlinks(o)){for(let a of e.get(n))for(let s of a.allActions())if(s.connectionURL()=="HYPERLINK"){for(let l of o.textHyperlinkBoxes())r(new Ki(o,l)),i=!0;break}}i||r(new Ki(o))}}}findPrototypeInteractionWithId(e,r){if(!this._scene())return null;let n=this._scene().findNode(e),o=An.cleanedInteractionsForNode(this._appState,n);for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(s.id()==r)return s}return null}findPrototypeInteractionsWithTransition(e,r){let n=this._scene().findNode(e),o=An.cleanedInteractionsForNode(this._appState,n),i=[];return o.forEach(a=>{for(let s of a.getAllValidTransitionActionsInInteraction())if(s!=null&&s.transitionNodeID()==r){i.push(a);break}}),i}findPrototypeInteractionsWithInteractionType(e,r){let n=An.cleanedInteractionsForNode(this._appState,e);if(n.length==0)return n;let o=[],i=[];return n.forEach(a=>{a.event().interactionType()==r&&(a.action()!=null&&a.action().value.navigationType()=="SWAP_STATE"&&a.action().value.connectionType()=="INTERNAL_NODE"?i.push(a):o.push(a))}),e.isInstanceSublayer()&&i.sort((a,s)=>{var d,u;let l=dr.whichInstanceToSwap(e,(d=a.action())==null?void 0:d.value.transitionNodeID()).stablePath(),c=dr.whichInstanceToSwap(e,(u=s.action())==null?void 0:u.value.transitionNodeID()).stablePath();return l.guids.length<c.guids.length?-1:1}),ln(o,i),o}findHotspotsWithInteractionFilter(e,r,n,o){return this.findHotspotsWithNoodleFilter(e,r,(i,a)=>n(a),o)}findHotspotsWithInteractionFilterWithinMultipleNodes(e,r,n){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,r,(o,i)=>n(i))}findHotspotsWithNoodleFilter(e,r,n,o){let i=[];return e==null?i:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),r,n,o)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,r,n,o){let i=[];if(e==null||e.size==0)return i;let a=new Map,s=(l,c)=>{!n(l,c)||!c.allActions().some(u=>H_.isValidForConnection(c.event().interactionType(),u.connectionType()))||(a.has(l.id())||a.set(l.id(),[]),a.get(l.id()).push(c))};if(o)for(let l of o)s(l.node,l.interaction);else this.forInteractionInFrames(Array.from(e.values()),s);return this.forHotspotInMap(a,l=>{(r==0||!e.has(l.node))&&i.push(l)}),i.sort((l,c)=>l.node.isAboveInLayerOrder(c.node)?-1:1),i}findHotspotsWithInteractionType(e,r,n,o){return this.findHotspotsWithInteractionFilter(e,r,i=>i.event().interactionType()==n,o)}findAllHotspots(e,r){return this.findHotspotsWithInteractionFilter(e,r,n=>!0)}hotspotOnPresentedNode(e,r,n,o){let i=n!="MOUSE_OUT"&&n!="MOUSE_LEAVE",a=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,n,o),s=null;for(let l of a)l.canvasSpaceScrolledInteractiveBounds(0).contains2(r)==i&&(s==null||l.node.isAboveInLayerOrder(s.node))&&(s=l);return s}};dS.MAX_PRERENDER_JOB_COUNT=10;var vo=dS;var uS=class{track(e,r){this._frameRequestInfo.set(e,r)}getMetricsForRequestedNode(e){return this._frameRequestInfo.get(e)}clear(){this._frameRequestInfo.clear()}constructor(){this._frameRequestInfo=new Map}};var pS=class{hash(){return Dn.bytesToHex(this._hash)}binaryHash(){return this._hash}getVideoManager(){return this._videoManager}size(e){let r=this._videoManager.getVideoRuntimeForPaint(e);return r?r.size():new F(0,0)}didLoad(e){let r=this._videoManager.getVideoRuntimeForPaint(e);return r==null?!1:r.isReadyToPlay()}getOrCreateTexture(e,r,n){let o=this._videoManager.getVideoRuntimeForPaint(e);return o==null||o.shouldDisplayThumbnail?null:o.getOrCreateTexture(r,n)}pause(e){let r=this._videoManager.getVideoRuntimeForPaint(e);r!=null&&r.pause()}constructor(e,r){this.id=i3++,this._hash=e,this._videoManager=r,this._loadComplete=!1}},i3=0;var Mo;(e=>e.VERBOSE_LOGS=!1)(Mo||(Mo={}));var Tu=class Tu{constructor(e,r,n){this._videoLoadAttemptId=0;this._startTimeMs=0;this._endTimeMs=0;this._sourceNodeGuid=null;this.id=(Tu.nextID=Tu.nextID+1)+-1,this._videoResolver=r,this._hash=e,this._videoManager=n,this._loadTimeTracker=new LO,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._isErrorRetryable=null,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._overrideSeeking=!1,this._prevReadyState=Au.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null,this._loaded=new to,this._preloadedData=null}clone(){let e=new Tu(this._hash,this._videoResolver,this._videoManager);return e._startTimeMs=this._startTimeMs,e._endTimeMs=this._endTimeMs,e._sourceNodeGuid=this._sourceNodeGuid,this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(jt.ios()||this.isSeeking())return this._player.readyState()>Au.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=Au.HAVE_CURRENT_DATA;return this._player.readyState()>=Au.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}isErrorRetryable(){return this._isErrorRetryable}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose(),this._player=null,this.clearPreloadedData())}clearPreloadedData(){if(this._preloadedData!=null){let e=v().modules().corePerfInfo;e==null||e.mediaMemStatsFree($a.VIDEO,this._preloadedData.blob.size),URL.revokeObjectURL(this._preloadedData.objectUrl),this._preloadedData=null}}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,r=Ut.int_remainder(e,60)<10?`0${Ut.int_remainder(e,60)}`:`${Ut.int_remainder(e,60)}`,o=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${r}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${o}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,r){if(this._player!=null){jt.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),r&&(this.overriddenMutedState=new fe(e))}catch{Re.trackEvent("video_mute_failure",{errorState:this._isInErrorState,loadComplete:this._loadComplete,fileType:this._fileTypeLoading})}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}setVolume(e){var n;let r=Math.max(0,Math.min(1,e));(n=this._player)==null||n.volume(r)}setShouldDisplayThumbnail(e){this.shouldDisplayThumbnail=e}muted(){return this._player!=null?this._player.muted():!0}ended(){var e;return((e=this._player)==null?void 0:e.ended())||!1}setLoop(e){this._loop=e}setTrimTimes(e,r){this._startTimeMs=e,this._endTimeMs=r}getStartTimeMs(){return this._startTimeMs}getEndTimeMs(){return this._endTimeMs}setSourceNodeGuid(e){this._sourceNodeGuid=e}getSourceNodeGuid(){return this._sourceNodeGuid}size(){return this._player==null?null:new F(this._player.videoWidth(),this._player.videoHeight())}_pause(e){Mo.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new fe(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,r){Mo.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(this.shouldDisplayThumbnail=!1,this._player.play().then(n=>{r&&(this.overriddenPlayingState=new fe(!0)),this.reportPlaySuccessAnalytics()},n=>{var i;let o=n.message+"";o.indexOf("The play() request was interrupted")!=-1?this.reportPlayFailureAnalytics(e?`Loop error: ${o}`:o):(console.warn("User has yet to interact with page, starting video muted",n),this.setMuted(!0),(i=this._player)==null||i.play().then(a=>{this.reportPlaySuccessAnalytics()},a=>{let s=a.message+"";e&&(s=`Loop error: ${s}`),this.reportPlayFailureAnalytics(s)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){if(this._player!=null){let e=this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration();return Bt.getFeatureGate("buzz_video_trimming")&&this._endTimeMs>0&&this._startTimeMs>=0?(this._endTimeMs-this._startTimeMs)/1e3:e}return 0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",r=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){let e=Bt.getFeatureGate("buzz_video_trimming")?this._startTimeMs/1e3:0;this.currentTime2(e)}isPlaying(){return this._player==null?!1:!this._player.paused()}setIsSeeking(e){this._overrideSeeking=e}isSeeking(){return this._seeking||this._overrideSeeking}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(e){var r;Mo.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(e),this._loadComplete=!0,window.vid=this,Bt.getFeatureGate("buzz_video_trimming")&&this._startTimeMs>0&&this.currentTime2(this._startTimeMs/1e3),this._loaded.resolve(),(r=this._videoManager)==null||r.onVideoLoaded(this)}_getVideoLoadAttemptIdAndIncrement(){return(this._videoLoadAttemptId++).toString()}_beginLoadingHLS(e){var r,n;this._loadTimeTracker.start(),this._fileTypeLoading="hls",(r=this._player)==null||r.src({type:"application/x-mpegURL",src:this._videoResolver.manifestUrl}),(n=this._player)==null||n.one("error",o=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest",e),this._beginLoadingMP4(e)})}_beginLoadingMP4(e,r=!1){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._videoResolver.fetchMp4Url().then2(n=>{var o,i;r?fetch(n).then(a=>a.blob()).then(a=>{if(!this._player)return;this._preloadedData={blob:a,objectUrl:URL.createObjectURL(a)};let s=v().modules().corePerfInfo;s==null||s.mediaMemStatsAlloc($a.VIDEO,a.size),this._player.src({type:"video/mp4",src:this._preloadedData.objectUrl})}):(o=this._player)==null||o.src({type:"video/mp4",src:n}),(i=this._player)==null||i.one("error",a=>{this._loadTimeTracker.end(),this._isInErrorState=!0,this._isErrorRetryable=!1;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Error code: ${a.code} Message: ${a.message}`,e)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.",e)}})},({message:n,statusCode:o})=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${n}`,e),this._isInErrorState=!0,this._isErrorRetryable=o!=404})}getMP4VideoBlob(){var e;return((e=this._preloadedData)==null?void 0:e.blob)||null}startLoadIfNeeded(e=!1){if(this._player!=null&&!e||e&&this._isPreloaded)return;this._isPreloaded=e;let r=this._getVideoLoadAttemptIdAndIncrement(),n=document.createElement("video");if(n.crossOrigin="anonymous",n.style.display="none",document.body.appendChild(n),this._player=Vo.instance().getPlayer(n,e?"auto":void 0),this._player==null){Vo.instance().isLibAvailable()&&(this._isInErrorState=!0,this._isErrorRetryable=!1,this.reportLoadFailureAnalytics("Failed to create VideoJS player",r));return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{var o,i,a,s,l;(o=this._player)==null||o.on("ended",c=>{this._loop?this._playLoop():this.resetToDefaultState()}),(i=this._player)==null||i.on("timeupdate",c=>{Bt.getFeatureGate("buzz_video_trimming")&&this._endTimeMs>0&&this._player&&this._player.currentTime()*1e3>=this._endTimeMs&&(this.currentTime2(this._startTimeMs/1e3),this._loop||this._player.pause())}),(a=this._player)==null||a.on("seeking",c=>{this._seeking=!0}),(s=this._player)==null||s.on("seeked",c=>{this._seeking=!1}),(l=this._player)==null||l.on("loadedmetadata",c=>{this._handleOnLoadedMetadata(r)})}),e?this._beginLoadingMP4(r,!0):this._beginLoadingHLS(r)}on(e,r){let n=o=>{r(this._player)};return this._player!=null&&this._player.on(e,n),n}off(e,r){this._player!=null&&this._player.off(e,r)}getHtmlVideoElement(){return this._player==null||!this._loadComplete?null:sp.VideoJsPlayer_getBackingVideo(this._player)}getOrCreateTexture(e,r){if(this._texture==null&&this._loadComplete&&this._player){let n=sp.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTextureWithVideo(r,n,fr.IMAGE)}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e,r){this._loadTimeTracker.end();let n=this._loadTimeTracker.getLoadTime();n<0||(console.warn("Video failed to load:",e),Re.trackDefinedEvent("prototype.video_load",{status:"failure",hash:this._hash,load_time:n,file_type:this._fileTypeLoading,reason:e,location:this._getCurrentLocation(),attempt_id:r,runtime_id:this.id.toString()}))}reportLoadSuccessAnalytics(e){var n,o;this._loadTimeTracker.end();let r=this._loadTimeTracker.getLoadTime();r<0||Re.trackDefinedEvent("prototype.video_load",{status:"success",hash:this._hash,load_time:r,file_type:this._fileTypeLoading,width:(n=this._player)==null?void 0:n.videoWidth(),height:(o=this._player)==null?void 0:o.videoHeight(),location:this._getCurrentLocation(),attempt_id:e,runtime_id:this.id.toString()})}reportPlaySuccessAnalytics(){Re.trackDefinedEvent("prototype.video_play",{status:"success",hash:this._hash,location:this._getCurrentLocation()})}reportPlayFailureAnalytics(e){Re.trackDefinedEvent("prototype.video_play",{status:"failure",hash:this._hash,reason:e,location:this._getCurrentLocation()})}waitForLoad(){return this._loaded}hash(){return this._hash}};Tu.nextID=0;var jc=Tu,Au;(i=>(i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4))(Au||(Au={}));var LO=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=Ze.seconds()}end(){this._endConditionSeconds=Ze.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},Eu=class extends Yl{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var z_=class{constructor(e){this._hash=e}},W_=class extends to{},GO=new class extends z_{get manifestUrl(){return""}fetchMp4Url(){let t=new W_;return t.resolve(""),t}}(""),MO=class extends z_{constructor(r){super(r);this._cachedMp4Url=void 0;let n=Qt.getVideoPrefixUrl(),o=n!=null&&n.endsWith("/")?n:n+"/";this._metaMp4Url=`${o}${this._hash}`,this._manifestUrl=`${this._metaMp4Url}/manifest`}get manifestUrl(){return this._manifestUrl}fetchMp4Url(){let r=new W_;return this._cachedMp4Url?(r.resolve(this._cachedMp4Url),r):(new oi(this._metaMp4Url).userIdHeader().get().then(n=>{let o=null;try{o=JSON.parse(n.text)}catch{r.reject({message:"Failed to parse response"});return}let i=new fe(o.status);if(i.value===void 0){r.reject({message:"Failed to parse status from response"});return}if(i.value!=200){r.reject({message:`Status is ${i.value}: ${o.message}`,statusCode:i.value});return}let a=o.meta;if(a===void 0){r.reject({message:"Failed to parse signed_url",statusCode:i.value});return}let s=a.signed_url;if(s===void 0){r.reject({message:"Failed to parse signed_url",statusCode:i.value});return}this._cachedMp4Url=s,r.resolve(s)},n=>{r.reject({message:"Request failed",statusCode:n.status})}),r)}},BO=class extends z_{constructor(e){super(e),this._mp4Url=`https://static.figma.com/uploads/${e}`}get manifestUrl(){return""}fetchMp4Url(){let e=new W_;return e.resolve(this._mp4Url),e}};function xL(t){return en?new BO(t):new MO(t)}var _S=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}getAllVisiblePaints(){return this._visiblePaints}forEachVisiblePaint(e){for(let r=0,n=Array.from(this._visiblePaints.values()).length;r<n;r=r+1)e(Array.from(this._visiblePaints.values())[r])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;if(e==null)return;this._visiblePaints=new Set;let r=e.newStateId(),n=(a=this._appState.scene())==null?void 0:a.findNode(r);if(n==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(n);let o=e.newOverlayData();for(let s=0,l=o.length;s<l;s=s+1){let c=this._appState.scene().findNode(o[s].id);this._gatherVisibleVideoResources(c)}let i="";this.forEachVisiblePaint(s=>{i+=" "+s.id().toString()+","}),Mo.VERBOSE_LOGS&&console.log("Found these visible paints:",i)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let n=0,o=e.childCount();n<o;n=n+1)this._gatherVisibleVideoResources(e.childAt1(n));let r=null;if(e.getCachedRenderTree()!=null)r=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)r=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode((r==null?void 0:r.value)??null)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 16:{this._gatherVideosFromScatterBrushFillNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 2:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 9:{let r=e;this._gatherVideosFromRenderNode(r.alpha);break}case 7:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 8:{let r=e;this._gatherVideosFromRenderNode(r.tree);break}case 10:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 11:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 12:{let r=e;this._gatherVideosFromRenderNode(r.startChild),this._gatherVideosFromRenderNode(r.endChild);break}case 0:{let r=e;this._gatherVideosFromRenderNode(r.child);break}}}_gatherVideosFromScatterBrushFillNode(e){for(let r=0,n=e.fillGeometries.length;r<n;r=r+1){let o=e.fillGeometries[r].paints;Ce.forEachPaintWithVideo(o,i=>{this._visiblePaints.add(i)})}}_gatherVideosFromFillNode(e){let r=e.geometry.paints;Ce.forEachPaintWithVideo(r,n=>{this._visiblePaints.add(n)})}_gatherVideosFromFillStrokeNode(e){let r=e.fillGeometries;for(let n=0,o=r.length;n<o;n=n+1){let i=r[n].paints;Ce.forEachPaintWithVideo(i,a=>{this._visiblePaints.add(a)})}for(let n=0,o=e.strokeGeometries.length;n<o;n=n+1){let i=e.strokeGeometries[n].paints;Ce.forEachPaintWithVideo(i,a=>{this._visiblePaints.add(a)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let r=0,n=e.children.length;r<n;r=r+1)this._gatherVideosFromRenderNode(e.children[r])}getLastTopLevelStateChange(){return this._lastStateChange}};var Ka=class Ka extends jc{constructor(r,n,o,i){super(r,GO,i);this.guid="";this._isPlaying=!1;this._isPlayingSound=!0;this._currentTime=0;this._isReady=!1;this._duration=1/0;this.eventListener=r=>{var o,i,a,s;if((r==null?void 0:r.origin)!==Ka.eventOrigin)return;let n=this.parseEventData(r);if(!(!n||n.id!==this.channelId||n.channel!==Ka.channel))switch(n.event){case"onReady":this._isReady=!0;break;case"infoDelivery":if(typeof((o=n.info)==null?void 0:o.playerState)=="number"&&(n.info.playerState===1||n.info.playerState===2||n.info.playerState===3)){let l=n.info.playerState===1||n.info.playerState===3;this._isPlaying!==l&&(this._isPlaying=l,this._videoManager.updateVideoRuntime(this.getMediaAction(l?"PLAY":"PAUSE"),this.guid))}if(typeof((i=n.info)==null?void 0:i.muted)=="boolean"){let l=n.info.muted===!1;this._isPlayingSound!==l&&(this._isPlayingSound=l)}typeof((a=n.info)==null?void 0:a.currentTime)=="number"&&(this.shouldSeek(n.info.currentTime)&&this._videoManager.updateVideoRuntime(this.getMediaAction("SKIP_TO",{mediaSkipToTime:new fe(n.info.currentTime)}),this.guid),this._currentTime=n.info.currentTime),typeof((s=n.info)==null?void 0:s.duration)=="number"&&(this._duration=n.info.duration);break}};this.guid=n,this.iframe=o,this.channelId=Ka.currentChannelId++,this.subscribeToEvents()}subscribeToEvents(){var r;window.addEventListener("message",this.eventListener),(r=this.iframe.contentWindow)==null||r.postMessage(JSON.stringify({event:"listening",id:this.channelId,channel:Ka.channel}),"*")}issueCommand(r,n){var o,i;(i=(o=this.iframe)==null?void 0:o.contentWindow)==null||i.postMessage(JSON.stringify({event:"command",func:r,args:n}),Ka.eventOrigin)}parseEventData(r){try{return JSON.parse(r.data)}catch{return null}}getMediaAction(r,n={}){let o=Ir.NULL_ACTION.withTransitionNodeID(this.guid).withMediaAction(r);return n.mediaSkipToTime?o.withMediaSkipToTime(n.mediaSkipToTime.value):o}shouldSeek(r){return!isNaN(r)&&Math.abs(this._currentTime-r)>2}clone(){let r=new Ka(this._hash,this.guid,this.iframe,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(r),r}isReadyToPlay(){return this._isReady}isInErrorState(){return!1}uninitialize(){window.removeEventListener("message",this.eventListener)}toString(){return`YoutubeRuntime(${this.guid})`}_setMuted(r,n){}muted(){return!this._isPlayingSound}size(){return new F(0,0)}_pause(r){this._isPlaying&&(this._isPlaying=!1,this.issueCommand("pauseVideo"))}_play(r,n){this._isPlaying||(n&&this._isPlayingSound&&(this._isPlayingSound=!1,this.issueCommand("mute")),this._isPlaying=!0,this.issueCommand("playVideo"))}duration(){return this._duration}currentTime1(){return this._currentTime}currentTime2(r){this.shouldSeek(r)&&(this._currentTime=r,this.issueCommand("seekTo",[r,!0]))}isPlaying(){return this._isPlaying}resetToDefaultState(){this.issueCommand("stopVideo")}setLoop(r){}invalidateTexture(){}startLoadIfNeeded(){}on(r,n){return i=>{}}off(r,n){}reportLoadFailureAnalytics(r){}reportLoadSuccessAnalytics(){}reportPlayFailureAnalytics(r){}};Ka.currentChannelId=1,Ka.channel="widget",Ka.eventOrigin="https://www.youtube.com";var hS=Ka;var Iu=class t{constructor(e,r,n,o){this.status=t.Status.PENDING,this.interactionType=e,this.interactionID=r,this.hotspotNodeID=n,this.listener=o,this.internalEventListeners=[]}};(e=>{let t;(i=>(i[i.PENDING=0]="PENDING",i[i.ACTIVE=1]="ACTIVE",i[i.SUPERCEDED=2]="SUPERCEDED"))(t=e.Status||(e.Status={}))})(Iu||(Iu={}));var Zc=class{constructor(e,r){this.nodePath=e,this.videoPlayback=r}},K_=class{constructor(e,r){this.eventName=e,this.listener=r}},a3="VideoManager",s3=150,Y_=class t{constructor(e){this.getVideoRuntimeForPaint=e=>{var a;if(!this._paintToNodeGUIDMap.has(e))return null;let r=this._paintToNodeGUIDMap.get(e);if(!r)return null;let n=(a=this.getNodeMetadata(r))==null?void 0:a.nodePath;if(!n)return null;let o=e.video().hash();return this._runtimeStorage.getData(n,o)};this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._nodeGUIDToVideoHashesMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new Eu,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new _S(e),this._lastPlayedVideo=null,this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this),this._videoRuntimeUpdateSubscriptionKey=0,this._videoRuntimeUpdateSubscriptions=new Map}runtimeStorage(){return this._runtimeStorage}subscribeToVideoRuntimeUpdates(e){let r=this._videoRuntimeUpdateSubscriptionKey;return this._videoRuntimeUpdateSubscriptionKey+=1,this._videoRuntimeUpdateSubscriptions.set(r,e),()=>{this._videoRuntimeUpdateSubscriptions.delete(r)}}_fireVideoRuntimeSubscriptions(){this._videoRuntimeUpdateSubscriptions.forEach(e=>e())}associatePaintWithNode(e,r){this._needToRecalculateVisibleVideos=!0;let n=r.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,n);let o=this._nodeGUIDToVideoHashesMap.get(n);o||(o=[],this._nodeGUIDToVideoHashesMap.set(n,o)),o.push(e.video().hash());let i=r.videoPlayback();this._guidToVideoMetadata.set(n,new Zc(kr.getSemanticNodePath(r),i)),this._paintsForPlaybackSettingsRefresh.add(e),this._fireVideoRuntimeSubscriptions()}associateYoutubeWithNode(e,r){let n=e;if(!this._hashToRuntimeMap.has(n)){let a=new hS(n,e,r,this);this._hashToRuntimeMap.set(n,a)}let o=this.getNodePathForNode(e);this._guidToVideoMetadata.set(e,new Zc(o,{autoplay:!1,mediaLoop:!1,muted:!1,showControls:!1,startTimeMs:0,endTimeMs:0}));let i=this._hashToRuntimeMap.get(n).clone();this._runtimeStorage.insert(o,n,i),this._fireVideoRuntimeSubscriptions()}disassociateYoutubeWithNode(e){let r=e;this._hashToRuntimeMap.has(r)&&this._hashToRuntimeMap.delete(r),this._guidToVideoMetadata.has(e)&&this._guidToVideoMetadata.delete(e);let n=this.getNodePathForNode(e);this._runtimeStorage.remove(n,r),this._fireVideoRuntimeSubscriptions()}getNodePathForNode(e){let r=this._appState.scene();if(!r)return[];let n=r.findNode(e);if(!n)return[];let o=[];for(;n;)o.unshift(new Kl(n.name(),this.getPositionOutOfAllSiblingsWithSameName(n))),n=n.parent();return o}getPositionOutOfAllSiblingsWithSameName(e){let r=0,n=e.parent();if(n){let o=!1;n.forEachChild(i=>{o=o||i.id()===e.id(),!o&&i.name()===e.name()&&(r+=1)})}return r}getNodeMetadata(e){if(this._guidToVideoMetadata.has(e))return this._guidToVideoMetadata.get(e)}getVideoDurationForNode(e){let r=this.getVideoRuntimesForNode(e);if(r){let n=Array.from(r.values())[0];if(n&&n.duration()>0)return Math.floor(n.duration()*1e3)}return 0}getTrimTimesForNode(e){let r=this.getNodeMetadata(e);if(!r)return{startTimeMs:0,endTimeMs:0};let n=r.videoPlayback,o=n.endTimeMs??0;if(n.endTimeMs==null){let a=this.getVideoRuntimesForNode(e);if(a){let s=Array.from(a.values())[0];s&&s.duration()>0&&(o=Math.floor(s.duration()*1e3))}}return Bt.getFeatureGate("buzz_video_trimming")?{startTimeMs:n.startTimeMs??0,endTimeMs:o}:{startTimeMs:0,endTimeMs:0}}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let r=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(r).videoPlayback,o=this.getVideoRuntimeForPaint(e);return Bt.getFeatureGate("buzz_video_trimming")||(n.startTimeMs=0,n.endTimeMs=(o==null?void 0:o.duration())??0),n==null&&(n={autoplay:!0,mediaLoop:!0,muted:!1,showControls:!1,startTimeMs:0,endTimeMs:(o==null?void 0:o.duration())??0}),n}getRuntimesForVisibleVideos(e=!1){return e&&this._visibilityTracker.refreshVisibleVideosIfNeeded(),Array.from(this._visibilityTracker.getAllVisiblePaints()).flatMap(r=>{let n=this.getVideoRuntimeForPaint(r);return n?[n]:[]})}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let r=this._paintToNodeGUIDMap.get(e);if(!r)return;let n=this.getNodeMetadata(r).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let o=e.video().hash(),i=this._hashToRuntimeMap.get(o).clone();i.setSourceNodeGuid(r);let a=this.getTrimTimesForNode(r);i.setTrimTimes(a.startTimeMs,a.endTimeMs),this._runtimeStorage.insert(n,o,i)})}getVideoRuntimesForNode(e){var o;let r=(o=this.getNodeMetadata(e))==null?void 0:o.nodePath;if(r==null)return null;let n=this._runtimeStorage.getAllDataForNode(r);return n==null?null:E_._filter(n,i=>(this._nodeGUIDToVideoHashesMap.get(e)??[]).includes(i))}updateVideoRuntime(e,r){let n=X.isValid(e.transitionNodeID())?e.transitionNodeID():r;if(!this._guidToVideoMetadata.has(n))return;let o,i,a=[],s=this.getVideoRuntimesForNode(n);s!=null&&(s.forEach((l,c)=>{if(l==null)return;let d=e.mediaAction();switch(d){case"PLAY":{this.playVideo(l,n,d);break}case"PAUSE":{l.pauseByVideoAction();break}case"TOGGLE_PLAY_PAUSE":{l.isPlaying()?l.pauseByVideoAction():this.playVideo(l,n,d);break}case"MUTE":{l.setMutedByVideoAction(!0);break}case"UNMUTE":{l.setMutedByVideoAction(!1);break}case"TOGGLE_MUTE_UNMUTE":{l.setMutedByVideoAction(!l.muted());break}case"SKIP_FORWARD":{let u=e.mediaSkipByAmount(),p=Math.min(l.currentTime1()+u,l.duration()-.01);l.currentTime2(p);break}case"SKIP_BACKWARD":{let u=e.mediaSkipByAmount(),p=Math.max(0,l.currentTime1()-u);l.currentTime2(p);break}case"SKIP_TO":{let u=e.mediaSkipToTime(),p=Math.max(0,u);p=Math.min(p,l.duration()-.01),l.currentTime2(p);break}}o=l.isPlaying(),i=!l.muted(),a.push(l.currentTime1()*1e3)}),o!=null&&i!=null&&a.length>0&&this._createVideoStateChangeInPrototypeState(n,o,i,a))}snapshotVideoStates(e=[...this._guidToVideoMetadata.keys()]){e.forEach(r=>{let n=null,o=null,i=[],a=this.getVideoRuntimesForNode(r);a!=null&&(a.forEach(s=>{n=s.isPlaying(),o=!s.muted(),i.push(s.currentTime1()*1e3)}),n!=null&&o!=null&&i.length>0&&this._createVideoStateChangeInPrototypeState(r,n,o,i))})}_createVideoStateChangeInPrototypeState(e,r,n,o){this._appState.prototypeState().createVideoStateChange(e,r,n,o,this._currentTruncatedTimeInMilliseconds())}resetVideoStateChanges(e){Array.from(e.keys()).forEach(r=>{if(!this._guidToVideoMetadata.has(r))return;let n=this.getVideoRuntimesForNode(r);if(n==null)return;let o=[];n.forEach((i,a)=>{o.push(i.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(r,o)})}_createDefaultVideoStateChangeInPrototypeState(e,r){var i;let n=(i=this.getNodeMetadata(e))==null?void 0:i.videoPlayback,o=!(n!=null&&n.muted);this._appState.prototypeState().createVideoStateChange(e,(n==null?void 0:n.autoplay)??!1,o,r,this._currentTruncatedTimeInMilliseconds())}multiplayerUpdateVideoRuntimes(e,r){let n=X.fromFigGUID(r.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let o=this.getVideoRuntimesForNode(n);if(o==null)return;let i=0;o.forEach((a,s)=>{if(a!=null){if(r.isPlaying!=a.isPlaying()&&(a.isPlaying()?a.pauseByVideoAction():(a.playByVideoAction(),this._lastPlayedVideo=n)),r.isPlayingSound!=!a.muted()&&a.setMutedByVideoAction(!r.isPlayingSound),!a.isPlaying()||r.currentTimes[i]!=e[i]){let l=this._currentTruncatedTimeInMilliseconds()-r.actionTakenTimestamp,d=(a.isPlaying()?r.currentTimes[i]+l:r.currentTimes[i])%(a.duration()*1e3);Math.abs(d-a.currentTime1()*1e3)>s3&&a.currentTime2(d/1e3)}i+=1}})}_currentTruncatedTimeInMilliseconds(){return Date.now()%1e6}_registerDeferredInteractionEvent(e){if(e.status==1)return;let r=this.getVideoRuntimesForNode(e.hotspotNodeID);if(r!=null){for(let n of Array.from(r.keys())){let o=r.get(n);if(e.interactionType=="ON_MEDIA_END"){let i=o.on("ended",a=>{e.listener(a)});e.internalEventListeners.push(new K_("ended",i))}else if(e.interactionType=="ON_MEDIA_HIT"){let i=o.on("timeupdate",a=>{e.listener(a)});e.internalEventListeners.push(new K_("timeupdate",i)),i=o.on("play",a=>{e.listener(a)}),e.internalEventListeners.push(new K_("play",i))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let r=this.getVideoRuntimesForNode(e.hotspotNodeID);if(r!=null)for(let n of Array.from(r.keys())){let o=r.get(n);for(let i of e.internalEventListeners)o.off(i.eventName,i.listener)}}_getListenerForInteractionEvent(e,r,n){let o=null;if(e=="ON_MEDIA_END")o=i=>{n()};else if(e=="ON_MEDIA_HIT"){let i=!1;o=a=>{let s=a.currentTime(),l=a.liveTracker?a.liveTracker.seekableEnd():a.duration();r>l&&(r=l);let c=.3;if(s>=r-c&&s<r){let d=Math.ceil((r-s)*1e3)|0;setTimeout(()=>{let u=a.currentTime(),p=a.paused()&&u<r,_=u>=r&&u<r+c;!i&&!p&&_&&(i=!0,n())},d)}else i=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return o}addInteractionEvent(e,r,n,o){let i=e.event().interactionType(),a=this._getListenerForInteractionEvent(i,n,o),s=new Iu(i,e.id(),r,a);for(let l of Array.from(this._deferredInteractionEvents.values()))l.interactionID==s.interactionID&&(l.status=2,Vo.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(l),this._deferredInteractionEvents.delete(l)));Vo.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(s),this._deferredInteractionEvents.add(s)}onFrame(){if(Mo.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,Mo.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this.allVisibleVideosAreLoaded()){this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos();for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));Mo.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let r=new gt(this._appState.scene().findNode(e)),n=kr.getSemanticNodePath(r),o=this._runtimeStorage.getSubTrie(n),i=[];o!=null&&o.forEach(a=>{a.resetToStartTime(),i.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,i)}resetAllRuntimesWithinTLFNode(e){let r=this._appState.scene().findNode(e);if(!r){Nn.loge(a3,"Cannot find TLF node for resetAllRuntimesWithinTLFNode",{tlfGuid:e},{reportAsSentryError:!0,logToConsole:0});return}for(let i=0,a=r.childCount();i<a;i=i+1){let s=r.childAt1(i);this.resetAllRuntimesWithinNode(s.id())}let n=this._runtimeStorage.getSubTrie([new Kl(r.name(),0)]),o=[];n!=null&&n.forEach(i=>{i.resetToStartTime(),o.push(i.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,o)}handleHsmAborted(e,r){}handleHsmCommitted(e,r,n){if(this._lastTransitionShouldForceStateRefresh=r.transitionParameters.transitionResetVideoPosition,r.transitionParameters.transitionResetVideoPosition){let o=this._appState.scene().findNodeByStablePath(e);o&&this.resetAllRuntimesWithinNode(o.id())}this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),r.getInsertedFrameIds())}handleHsmInitiated(e,r){}handleHsmRequested(e,r){}handleStateChangeCommitted(e,r){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let n=e.newOverlayData();for(let o=0,i=n.length;o<i;o=o+1)this.resetAllRuntimesWithinNode(n[o].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){this._appState.isPreloaded||(this._lastPlayedVideo=null,this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0)}reactToStateChange(e,r){this._recalculateVisibleVideoPaints(e);let n=!0,o=new Set;this._visibilityTracker.forEachVisiblePaint(s=>{if(!this._paintToNodeGUIDMap.has(s))return;let l=s.video().hash(),c=this._paintToNodeGUIDMap.get(s),d=this.getNodeMetadata(c).nodePath,u=this.getVideoRuntimeForPaint(s);u!=null&&(o.add(u.id),this._lastPlayedVideo===c&&(n=!1));let p=this._appState.scene().findNode(c);for(let _ of r){let h=this._appState.scene().findNode(_);h!=null&&h.isAncestorOf(p)&&this._paintsForPlaybackSettingsRefresh.add(s)}if(u==null){let _=this._hashToRuntimeMap.get(l).clone(),h=this.getTrimTimesForNode(c);_.setTrimTimes(h.startTimeMs,h.endTimeMs),this._runtimeStorage.insert(d,l,_)}}),n&&(this._lastPlayedVideo=null);let i=Array.from(this._guidToVideoMetadata.entries()),a=new Set;i.forEach(([s,l])=>{var d;let c=(d=this._runtimeStorage.getAllDataForNode(l.nodePath))==null?void 0:d.values();c&&Array.from(c).forEach(u=>{!o.has(u.id)&&u.isPlaying()&&(u.pause(),a.add(s))})}),this.snapshotVideoStates([...a]),this._framePotentiallyReadyToPlay=!0}handleAction(e,r){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(n=>{let o=this.getVideoRuntimeForPaint(n),i=this.getPlaybackSettingsForPaint(n);o!=null&&i!=null&&!i.muted&&o.setMuted(i.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){let e=[];this._visibilityTracker.forEachVisiblePaint(r=>{if(!this._paintsForPlaybackSettingsRefresh.has(r))return;this._paintsForPlaybackSettingsRefresh.delete(r);let n=this.getVideoRuntimeForPaint(r),o=this.getPlaybackSettingsForPaint(r),i=this._paintToNodeGUIDMap.get(r);if(!n||!o||!i)return;e.push(i),n.setLoop(o.mediaLoop),this._lastTransitionShouldForceStateRefresh&&n.resetToDefaultState();let s=n.overriddenMutedState==null?o.muted:n.overriddenMutedState.value;n.setMuted(s),(n.overriddenPlayingState==null?o.autoplay:n.overriddenPlayingState.value)?this._appState.editorType()==="COOPER"?n.setShouldDisplayThumbnail(!1):this.playVideo(n,i,void 0):n.pause()}),this.snapshotVideoStates(e)}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let r=this.getVideoRuntimeForPaint(e);r!=null&&(r.isPlaying()||r.isSeeking())&&r.invalidateTexture()})}_recalculateVisibleVideoPaints(e){Mo.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getVideoRuntimeForPaint(r);n==null||n.startLoadIfNeeded(this._appState.editorType()==="COOPER")}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){Mo.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){this.initializeRuntimes();let r=new pS(e,this);return this.addToHashToRuntimeMap(r),r}addToHashToRuntimeMap(e){let r=e.hash();if(!this._hashToRuntimeMap.has(r)){let n=xL(r),o=new jc(r,n,this);this._hashToRuntimeMap.set(r,o)}}initializeRuntimes(){Vo.instance().hasRequestedLibrary()||(Vo.instance().onSuccess=()=>{for(let e of Array.from(this._deferredRuntimes.values()))e.startLoadIfNeeded(this._appState.editorType()==="COOPER")},Vo.instance().requestLibrary())}allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getVideoRuntimeForPaint(r);n!=null&&!n.isReadyToPlay()&&!n.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._fireVideoRuntimeSubscriptions();let r=this._appState.imageManager();r==null||r.onImageLoaded==null||(this.allVisibleVideosAreLoaded()?(Mo.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&r.onImageLoaded(this._appState.baseScreenNode())):Mo.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){e.property==111&&(this._guidToVideoMetadata.set(e.node.id(),new Zc(kr.getSemanticNodePath(new gt(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((r,n)=>{r==e.node.id()&&this._paintsForPlaybackSettingsRefresh.add(n)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((r,n)=>{e+="		hash: "+n+" -> "+r.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getPlaybackSettingsForPaint(r);n!=null?e+="		"+r.debugString()+" muted="+n.muted.toString()+" loop="+n.mediaLoop.toString()+" autoplay="+n.autoplay.toString()+" hash: "+r.video().hash()+`
`:e+="		"+r.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((r,n)=>{e+="		P="+n.id().toString()+" => "+r+`
`}),e}enqueueVideoOrStartLoad(e){Vo.instance().isLibAvailable()?e.startLoadIfNeeded(this._appState.editorType()==="COOPER"):this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(r=>{r.id!=e.id&&r.setMuted(!0)})}playNextVisibleVideo(){let e=(u,p)=>{let _=u.canvasSpaceRenderedBounds().x(),h=p.canvasSpaceRenderedBounds().x();if(_!==h)return _-h;{let g=u.canvasSpaceRenderedBounds().y(),m=p.canvasSpaceRenderedBounds().y();return g-m}},r=[],n=new Set;if(this._visibilityTracker.forEachVisiblePaint(u=>{if(!this._paintToNodeGUIDMap.has(u))return;let p=this._paintToNodeGUIDMap.get(u);if(!p||n.has(p))return;let _=this.getPlaybackSettingsForPaint(u);if(_!=null&&_.autoplay)return;let h=this.getVideoRuntimeForPaint(u);if(!h||!h.isReadyToPlay())return;let g=this._appState.scene().findNode(p);g!=null&&(n.add(p),r.push({node:g,paint:u}))}),r.sort((u,p)=>e(u.node,p.node)),r.length===0)return!1;let i=r.findIndex(u=>u.node.id()===this._lastPlayedVideo)+1;if(i>=r.length)return!1;let a=r[i],s=a.paint;if(!this.getVideoRuntimeForPaint(s))return!1;let c=a.node.id(),d=Ir.NULL_ACTION.withTransitionNodeID(c).withMediaAction("PLAY");return this.updateVideoRuntime(d,c),!0}unloadAllVideos(){for(let e of this._hashToRuntimeMap.values())e.clearPreloadedData();this._runtimeStorage.uninitialize1()}preloadAllVideos(){var n,o;let e=(n=this._appState.scene())==null?void 0:n.root();if(!e)return;let r=[];for(let{video:i,paint:a,node:s}of t.getVideosInSubtree(e)){this._hashToRuntimeMap.has(i.hash())||(this.initializeRuntimes(),this.addToHashToRuntimeMap(i));let l=this._hashToRuntimeMap.get(i.hash());l==null||l.startLoadIfNeeded(!0),this.enqueueVideoOrStartLoad(l);let c=this._paintToNodeGUIDMap.get(a);c||(this.associatePaintWithNode(a,new gt(s)),c=this._paintToNodeGUIDMap.get(a));let d=c&&((o=this.getNodeMetadata(c))==null?void 0:o.nodePath);d&&l&&(this._runtimeStorage.insert(d,i.hash(),l),r.push(l))}return r}static getVideosInSubtree(e){let r=new Map;t._getVideosInSubtree(e,r);let n=[];return r.forEach(o=>{n.push(o)}),n}static _getVideosInSubtree(e,r){e.forEachSinglePaint(n=>{n.video()!=null&&r.set(n.video().hash(),{video:n.video(),paint:n,node:e})});for(let n=0,o=e.childCount();n<o;n=n+1){let i=e.childAt1(n);t._getVideosInSubtree(i,r)}}getVideoLoadingProgress(e){return{loaded:e.reduce((n,o)=>{let i=o.isReadyToPlay()||o.isInErrorState()&&!o.isErrorRetryable();return n+(i?1:0)},0),total:e.length}}playVideo(e,r,n){n?e.playByVideoAction():e.play(),this._lastPlayedVideo=r}clonePaintRegistration(e,r){let n=this._paintToNodeGUIDMap.get(e);if(!n)return;this._needToRecalculateVisibleVideos=!0,this._paintToNodeGUIDMap.set(r,n);let o=this._nodeGUIDToVideoHashesMap.get(n);o||(o=[],this._nodeGUIDToVideoHashesMap.set(n,o)),o.push(r.video().hash()),this._paintsForPlaybackSettingsRefresh.add(r),this._fireVideoRuntimeSubscriptions()}};var Sr=class{constructor(){this.isPreloaded=!1;this.prototypeSecurityBoundariesEnforced=!1;this._appObservers=new bn,this._actionObservers=new bn,this._frameObservers=new bn,this._scene=null,this._canvas=null,this._requestedFrameMetricsTracker=new uS,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(),this._pendingSetActiveCanvas=null,this._emitter=Xt.getEventEmitter(),this._prototypeState=new Xs(this),this._prototypeStructure=new vo(this),this._imageManager=new Ks(this,()=>{this._emitter.trigger("showImageFetchFailureUI")}),this._videoManager=new Y_(this),this._embeddedPrototypeManager=new wp(this),this._prototypeRecorder=new rS(this),this._serialization=new Tt(this,this._imageManager,this._videoManager),Uo&&v()==null&&Kh(new mu(es,this))}emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}embeddedPrototypeManager(){return this._embeddedPrototypeManager}prototypeRecorder(){return this._prototypeRecorder}requestedFrameMetricsTracker(){return this._requestedFrameMetricsTracker}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}currentScalingInfo(){return this._prototypeState.getCurrentScalingInfo()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}needsAlphaGPUBackingStore(){return!!new URLSearchParams(window.location.search).get("needsAlpha")}editorType(){return this._editorType}setEditorType(e){this._editorType!=e&&(this._editorType=e)}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,r){this._actionObservers.forEach(n=>{n.handleAction(e,r)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){var r;if(e!=this._scene){let n=this._scene;this._scene=e,(r=this._scene)==null||r.markLoaded(),this._appObservers.forEach(o=>{o.handleSceneChange(n,e)}),n!=null&&n.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,e))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let r=this._canvas;this._canvas=e,this._appObservers.forEach(n=>{n.handleActiveCanvasChange(r,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.prototypeDevice()}storedPrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let r=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(n=>{n.handleActivePrototypeStartingPointChange(r,e)})}};function Ru(){return AssertLib}function Ya(t,e){Ru()(t,e)}function yn(t,e,r=""){Ya(Math.abs(t-e)<1e-6,`Expected ${t} to approximately equal ${e}. ${r}`)}function mS(t,e,r){yn(e,r,`Expected velocity at timestep ${t} to equal ${e}, got ${r}`)}var ML=Ja(LL());var Gn=class Gn{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return qe.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,r){this._valueBySnapshotId.set(e,r),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((n,o)=>Pi.string_compare(n,o));let r="";for(let n of e)r+=`
${Gn._PREFIX}snapshotId: ${n}
`,r+=this._valueBySnapshotId.get(n);return r}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(Gn._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return Gn._snapshotFileCache.set(e,new Gn(new Map)),Gn._snapshotFileCache.get(e)._isDirty=!0,Gn._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let r=qe.StringMap_get(Gn._snapshotFileCache,e,null);return r!=null?Promise.resolve(r):ProtoTestHost_readFile(e).then(n=>{let o=qe.StringMap_get(Gn._snapshotFileCache,e,null);return o??(n==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),Gn._createEmptyDefaultDirtyAtPath(e)):(Gn._snapshotFileCache.set(e,new Gn(Gn._snapshotStringToMap(n))),Gn._snapshotFileCache.get(e)))})}static _snapshotStringToMap(e){let r=new Map,n=e.split(`
`),o=null,i=null;for(let a of n){let s=`${Gn._PREFIX}snapshotId: `;a.startsWith(s)?(o!=null&&r.set(o,i.join(`
`)),o=a.slice(s.length),i=[]):i!=null&&i.push(a)}return o!=null&&r.set(o,i.join(`
`)),r}static flushSnapshotUpdates(){let e=[];return qe.StringMap_each(Gn._snapshotFileCache,(r,n)=>{n.isDirty()&&e.push(Gn._saveToPath(r,n))}),Promise.all(e)}static _saveToPath(e,r){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,r.toString())}};Gn._PREFIX="#*#* ",Gn._snapshotFileCache=new Map;var yu=Gn;var Js=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,r){if(fS==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let o=this._testFilepath.split(".ts").join(".snapshot.txt"),i=fS+" -- "+e,a=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return d3(o,i).then(s=>{let l=new RegExp("\\d+\\.\\d*","g"),c=r.replaceAll(l,d=>`${Math.round(parseFloat(d)*1e3)/1e3}`);if(s==null||a){c3(o,i,c);return}if(s!==c)throw new Error(`${X_}Snapshot ${i} in file ${o} did not match previous value. Here's a diff that changes the ${GL}stored snapshot${X_} into the ${BL}received value${X_}:

${l3(s,c)}`)})}},Zs;(i=>{function t(){return i.hasSetExpectedErrorsBeenCalled=!1,es.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(rp.VIEWER_TEST)}i.resetExpectedErrorsAndGetErrorString=t;function e(a){if(i.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");i.hasSetExpectedErrorsBeenCalled=!0,es.interactionTestHelpers.setExpectedErrors(a)}i.setExpectedErrors=e;function r(){i.isUnhandledErrorsExpected=!0}i.setUnhandledErrorsExpected=r,i.hasSetExpectedErrorsBeenCalled=!1,i.isUnhandledErrorsExpected=!1})(Zs||(Zs={}));function ce(t,e){VO(t,()=>new Promise((r,n)=>{e(),setTimeout(()=>{r()},0)}))}function he(t,e,r=!1){VO(t,e,r)}function Jc(t,e,r=!1){VO(t,()=>e().then(n=>{}),r)}function VO(t,e,r=!1){q_.push(t);let n=q_.join(" -- ");le.List_removeLast(q_);let o=()=>{new Sr,ct.isInitialized()||ct.initializeJsImpl();let i=e();return r||v().reset(),i};it(t,()=>{fS=n,Yi=[],Zs.isUnhandledErrorsExpected=!1;let i=Zs.resetExpectedErrorsAndGetErrorString();return i.length>0&&Yi.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+i)),o().catch(a=>{Yi.push(a)}).then(()=>{let a=Zs.resetExpectedErrorsAndGetErrorString();if(a.length>0&&Yi.push(new Error(a)),fS=null,Zs.isUnhandledErrorsExpected){if(Yi.length==0)throw new Error("Expected errors, but none were triggered")}else{Yi=Yi.filter(l=>l.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let s=Yi.length>1?Yi.length.toString()+` unhandled errors: 
`:`Unhandled error: 
`;if(Yi.length==1)throw Yi[0];if(Yi.length>1){for(let l of Yi)s+=l.message,s+=`
`,s+=l.stack;throw new Error(s)}}}).finally(()=>{r&&v().reset()})})}function Ct(t,e){q_.push(t),describe(t,()=>{e()}),le.List_removeLast(q_)}function l3(t,e){let r=ML.diffLines(t,e),n="";return r.forEach(o=>{let i="",a="";o.added?(i="+ ",a=BL):o.removed?(i="- ",a=GL):(i="  ",a=X_),n+=`${a}${i}${o.value}${X_}
`}),n}function c3(t,e,r){yu.loadOrCreateFromPath(t).then(n=>{n.updateValue(e,r)})}function d3(t,e){return yu.loadOrCreateFromPath(t).then(r=>r.getValueOrNull(e))}var Yi=[],q_=[],fS=null,BL="\x1B[32m",GL="\x1B[31m",X_="\x1B[0m";var $c=class{constructor(e,r,n){var o;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=r,this._activeCanvasGUID=(o=e.getActiveCanvas())==null?void 0:o.id(),this._onChange=n,e.addAppObserver(this)}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){if(r==null)return;this._activeCanvasGUID=r.id();let n=e==null?void 0:e.get(this._property),o=r.get(this._property);n!=o&&this._onChange(o)}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){var r;e.property==this._property&&X.equals((r=e.node)==null?void 0:r.id(),this._activeCanvasGUID)&&e.oldVal!=e.newVal&&this._onChange(e.newVal)}};var SS=10,u3=1e3,p3=Math.ceil(u3/SS);var Sa={frontLeft:[1,0],frontRight:[0,1],center:[.707,.707],lfe:[.707,.707],surroundLeft:[.707,0],surroundRight:[0,.707]},j_=class{constructor(e,r){this._readableStreamController=null;this._audioSources=[];this._sampleRate=0;this._maxTotalFrames=0;this._currentPlayheadTimeMs=0;this._framesConsumed=0;this._normalizationWindow=[];this._currentNormalizationFactor=1;if(e.length===0)throw new Error("At least one audio buffer is required");this._readableStream=new ReadableStream({start:n=>{this._readableStreamController=n}}),this._sampleRate=e[0].buffer.sampleRate;for(let n of e){if(n.volume===0)continue;if(n.buffer.sampleRate!==this._sampleRate)throw new Error("All audio buffers must have the same sample rate");let o=[];for(let a=0;a<n.buffer.numberOfChannels;++a){let s=n.buffer.getChannelData(a);if(Bt.getFeatureGate("buzz_video_trimming")&&(n.startTimeMs!==void 0||n.endTimeMs!==void 0)){let l=n.startTimeMs?Math.floor(n.startTimeMs/1e3*this._sampleRate):0,c=s.length;if(n.endTimeMs!==void 0&&n.endTimeMs>0){let d=n.endTimeMs-(n.startTimeMs||0),u=Math.floor(d/1e3*this._sampleRate);c=l+u}o.push(s.slice(l,c))}else o.push(s)}let i=Math.min(...o.map(a=>a.length))||0;this._audioSources.push({channelData:o,sampleRate:n.buffer.sampleRate,volume:n.volume,totalFrames:i}),this._maxTotalFrames=Math.max(this._maxTotalFrames,i)}}get readable(){return this._readableStream}getAudioEncoderConfig(e){if(this._audioSources.length!==0)return{numberOfChannels:this.numberOfChannels,sampleRate:e,codec:"mp4a.40.2"}}captureAudio(e){if(this._audioSources.length!==0)for(;this._currentPlayheadTimeMs+SS<e;){let r=Math.min(this._maxTotalFrames-this._framesConsumed,Math.floor(this._sampleRate*SS/1e3));if(r<=0)break;this.enqueueAudioData(r),this._framesConsumed+=r,this._currentPlayheadTimeMs+=SS}}get numberOfChannels(){return 2}stop(e=!0){var r;e&&this.enqueueAudioData(this._maxTotalFrames-this._framesConsumed),(r=this._readableStreamController)==null||r.close()}enqueueAudioData(e){var i;if(e<=0)return;let{left:r,right:n}=this.createStereoMixBuffer(this._framesConsumed,e),o=new Float32Array(e*2);o.set(r,0),o.set(n,e),(i=this._readableStreamController)==null||i.enqueue(new AudioData({timestamp:this._currentPlayheadTimeMs*1e3,format:"f32-planar",numberOfChannels:2,sampleRate:this._sampleRate,data:o,numberOfFrames:e}))}createStereoMixBuffer(e,r){let n=new Float32Array(r),o=new Float32Array(r),i=0;for(let c of this._audioSources){if(e>=c.totalFrames)continue;let d=Math.min(c.totalFrames-e,r);switch(c.channelData.length){case 1:this.upmixMonoToStereo(c.channelData[0],e,d,n,o,c.volume);break;case 2:this.mixStereo(c.channelData,e,d,n,o,c.volume);break;case 6:this.downmix51ToStereo(c.channelData,e,d,n,o,c.volume);break;default:this.genericDownmixToStereo(c.channelData,e,d,n,o,c.volume)}}for(let c=0;c<r;c++)i=Math.max(i,Math.abs(n[c]),Math.abs(o[c]));this._normalizationWindow.push(i),this._normalizationWindow.length>p3&&this._normalizationWindow.shift();let a=Math.max(...this._normalizationWindow),s=a>1?1/a:1,l=.1;this._currentNormalizationFactor+=(s-this._currentNormalizationFactor)*l;for(let c=0;c<r;c++)n[c]*=this._currentNormalizationFactor,o[c]*=this._currentNormalizationFactor;return{left:n,right:o}}upmixMonoToStereo(e,r,n,o,i,a){for(let s=0;s<n;s++){let l=e[r+s];o[s]+=l*a,i[s]+=l*a}}mixStereo(e,r,n,o,i,a){let[s,l]=e;for(let c=0;c<n;c++)o[c]+=s[r+c]*a,i[c]+=l[r+c]*a}downmix51ToStereo(e,r,n,o,i,a){let[s,l,c,d,u,p]=e;for(let _=0;_<n;_++){let h=r+_;o[_]+=s[h]*Sa.frontLeft[0]*a+l[h]*Sa.frontRight[0]*a+c[h]*Sa.center[0]*a+d[h]*Sa.lfe[0]*a+u[h]*Sa.surroundLeft[0]*a+p[h]*Sa.surroundRight[0]*a,i[_]+=s[h]*Sa.frontLeft[1]*a+l[h]*Sa.frontRight[1]*a+c[h]*Sa.center[1]*a+d[h]*Sa.lfe[1]*a+u[h]*Sa.surroundLeft[1]*a+p[h]*Sa.surroundRight[1]*a}}genericDownmixToStereo(e,r,n,o,i,a){let s=1/e.length,l=Math.floor(e.length/2);for(let c=0;c<n;c++)for(let d=0;d<e.length;d++)d<l?o[c]+=e[d][r+c]*s*a:i[c]+=e[d][r+c]*s*a}};var NN=Ja(hd());var _3=new FinalizationRegistry(t=>{t.value!==0&&v().modules().vertexBufferAreaHelper.release(t.value)}),h3=new FinalizationRegistry(t=>{v().modules().vertexBufferPoolHelper.release(t)}),bu=class{constructor(){this._handle=null;v()?this.init():ts().then(e=>{this.init()})}bindings(){return v().modules().vertexBufferPoolHelper}init(){this._handle=this.bindings().create(),h3.register(this,this._handle)}totalVRAM(){return this._handle?this.bindings().totalVramInBytes(this._handle):0}usedVRAM(){return this._handle?this.bindings().usedVramInBytes(this._handle):0}allocateVertexBufferAreas(e,r,n){if(this._handle==null)return[];let o=[],i=this.bindings().allocateVertexBufferArea(this._handle,e,r.stride(),n);for(;i!==0;)o.push(new ed(i)),i=v().modules().vertexBufferAreaHelper.next(i);return o}allocateInstanceBufferArea(e){if(this._handle==null)return null;let r=this.bindings().allocateInstanceBufferArea(this._handle,bt.getInstanceTransform_F3_F3().stride(),e);return r===0?null:(v().modules().vertexBufferAreaHelper.next(r)!==0&&Nn.loge("WasmVertexBufferPool","Attempting to allocate instance buffer larger than chunk size",{byteCount:e.length}),new ed(r))}allocateSmallManagedArea(e,r,n){let o=new Uint8Array(n);return new Fi(()=>{let i=this.allocateVertexBufferAreas(e,r,o);return i.length===0?null:(i.length>1&&Nn.loge("WasmVertexBufferPool","Attempting to allocate managed buffer area larger than chunk size",{byteCount:n.length}),i[0])})}chunkSizeInBytes(){return v()?this.bindings().vertexBufferPoolChunkSizeInBytes():0}},ed=class{constructor(e){this._handle={value:e},_3.register(this,this._handle)}bindings(){return v().modules().vertexBufferAreaHelper}byteCount(){return this._handle.value?this.bindings().byteCount(this._handle.value):0}stride(){return this._handle.value?this.bindings().stride(this._handle.value):0}byteOffset(){return this._handle.value?this.bindings().byteOffset(this._handle.value):0}hasBuffer(){return this._handle.value?this.bindings().hasBuffer(this._handle.value):!1}bufferBytesForUpload(){return this._handle.value?this.bindings().bufferBytesForUpload(this._handle.value):null}free(){this._handle.value!==0&&(this.bindings().release(this._handle.value),this._handle.value=0)}wasFreed(){return this._handle.value===0}handle(){return this._handle.value}};var m3=new FinalizationRegistry(t=>{t.value!==0&&v().modules().gPUFramebufferBindings.release(t.value)}),AS=class extends Nc{constructor(r,n,o,i){super(r.getHTMLContext(),n,o,i);this._handle=null;this._gpuFramebuffer=null;this._wasmContext=r,this._wasmContext=r,this._color=n,this._stencil=o,v()?this._create():ts().then(a=>{this._create()})}_create(){this._handle={value:v().modules().gPUFramebufferBindings.create(this._color.handle(),this._stencil?this._stencil.handle():0)},this._gpuFramebuffer=v().modules().gPUFramebufferBindings.lookup(this._handle.value),m3.register(this,this._handle)}colorTexture(){return this._color}context(){return this._wasmContext}depthStencilTexture(){return this._stencil}setColorTexture(r){throw new Error("Method not implemented.")}setDepthStencil(r){throw new Error("Method not implemented.")}resize(r,n){throw new Error("Method not implemented.")}deleteTexture(){var r,n;(r=this._color)==null||r.deleteTexture(),(n=this._stencil)==null||n.deleteTexture(),!(this._gpuFramebuffer==null||this._handle==null)&&(v().modules().gPUFramebufferBindings.release(this._handle.value??0),this._handle.value=0,this._gpuFramebuffer=null)}bounds(){var r,n;return new L(0,0,((r=this._color)==null?void 0:r.width())??0,((n=this._color)==null?void 0:n.height())??0)}framebuffer(){var r;return xa.getFramebuffer(((r=this._gpuFramebuffer)==null?void 0:r.emscriptenId())??0)??null}handle(){var r;return((r=this._handle)==null?void 0:r.value)??0}};var f3=t=>{switch(t.pixelFormat){case 0:return sl.RGBA8;case 1:return sl.DEPTH24_STENCIL8;case 2:return sl.ASTC_6x6;default:return sl.RGBA8}},g3=new FinalizationRegistry(t=>{t.value!==0&&v().modules().gPUTextureBindings.release(t.value)}),vu=class extends aa{constructor(r,n,o,i,a,s,l){super(r.getHTMLContext(),a,o,i,s,l,n);this._handle=null;this._gpuTexture=null;this._wasmContext=r,v()?this._create(n,o,i,a):ts().then(()=>{this._create(n,o,i,a)})}_create(r,n,o,i){this._handle={value:v().modules().gPUTextureBindings.create(r,n,o,f3(i))},this._gpuTexture=v().modules().gPUTextureBindings.lookup(this._handle.value),g3.register(this,this._handle)}context(){return this._wasmContext}format(){return this._format}width(){var r;return((r=this._gpuTexture)==null?void 0:r.width())??0}height(){var r;return((r=this._gpuTexture)==null?void 0:r.height())??0}hasContentBeenInitialized(){return super.hasContentBeenInitialized()}markContentHasBeenInitialized(){return super.markContentHasBeenInitialized()}resize1(r,n,o,i){return super.resize1(r,n,o,i)}setFormat(r){this._format=r}setShouldUnloadImageBuffer(r){super.setShouldUnloadImageBuffer(r)}deleteTexture(){this._gpuTexture==null||this._handle==null||(v().modules().gPUTextureBindings.release(this._handle.value),this._handle.value=0,this._gpuTexture=null)}texture(){var o,i,a,s,l,c,d;let r=this._wasmContext.gl(),n=xa.getTexture(((o=this._gpuTexture)==null?void 0:o.emscriptenId())??0);if(this._needsUploadToGPUTexture()){if(this._video!=null)this._isVideoFrameDirty&&(r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{if(this._pixels==null)return xe("Tried to reupload image data after unloading it"),this._texture;let u=this._pixels.pixels;if(this._context.supportsCompressedTextures()&&this.format().isCompressedFormat()?((i=this._gpuTexture)==null||i.uploadFromJsBuffer(u.array),this._hasContentBeenInitialized=u.array!=null):u.imageBitmap!=null?((a=this._gpuTexture)==null||a.uploadFromImageSource(u.imageBitmap),this._hasContentBeenInitialized=!0):u.img!=null?((s=this._gpuTexture)==null||s.uploadFromImageSource(u.img),this._hasContentBeenInitialized=!0):u.canvas!=null?((l=this._gpuTexture)==null||l.uploadFromImageSource(u.canvas),this._hasContentBeenInitialized=!0):u.array!=null&&((c=this._gpuTexture)==null||c.uploadFromJsBuffer(u.array),this._hasContentBeenInitialized=u.array!=null),this._shouldUnloadImageBuffer){let p=v().modules().corePerfInfo;p==null||p.imageMemStatsFree(ba.BUFFER,this._pixels.memorySize()),this._pixels=null}}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR)),this._isContentDirty=!1}return xa.getTexture(((d=this._gpuTexture)==null?void 0:d.emscriptenId())??0)??super.texture()}renderbuffer(){var o;let r=this._wasmContext.gl(),n=xa.getRenderbuffer(((o=this._gpuTexture)==null?void 0:o.emscriptenId())??0);return n&&(r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,this.width(),this.height())),n??super.renderbuffer()}handle(){var r;return((r=this._handle)==null?void 0:r.value)??0}};var TS=class{constructor(e){this._htmlContext=new ci(e),this._quadArea=new bu().allocateSmallManagedArea(ze.TRIANGLE_STRIP,bt.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer))}draw(e,r,n,o,i,a,s,l){var u;let c=0;if(n instanceof ed&&(c=n.handle()??0),n instanceof Fi){let p=n.bufferArea();p instanceof ed&&(c=p.handle()??0)}let d=null;switch(r.name()){case"solidColor":d=yt.SolidColorPaint;break;case"gradientPaint":d=yt.GradientPaint;break;case"lerpGradientPaint":d=yt.LerpGradientPaint;break;case"lerpImage":d=yt.LerpImage;break;case"lerpImageColorAdjust":d=yt.LerpImageColorAdjust;break;case"lerpTexture":d=yt.LerpTexture;break;case"drawTexture":d=yt.DrawTexture;break;case"deviceFrame":d=yt.DeviceFrame;break;case"superSSAA4x4Downsample":d=yt.SuperSSAA4x4Downsample;break;case"aaaShapeSolidColor":d=yt.AAAShapeSolidColorPaint;break;case"aaaShapeGradientPaint":d=yt.AAAShapeGradientPaint;break;case"aaaShapeLerpGradientPaint":d=yt.AAAShapeLerpGradientPaint;break;case"aaaShapeImage":d=yt.AAAShapeImagePaint;break;case"aaaShapeImageColorAdjust":d=yt.AAAShapeImageColorAdjustPaint;break;case"aaaShapeLerpImageEllipse":d=yt.AAAShapeLerpImagePaintEllipse;break;case"aaaShapeLerpImageRoundedRect":d=yt.AAAShapeLerpImagePaintRoundedRect;break;case"aaaShapeLerpImageColorAdjustEllipse":d=yt.AAAShapeLerpImageColorAdjustPaintEllipse;break;case"aaaShapeLerpImageColorAdjustRoundedRect":d=yt.AAAShapeLerpImageColorAdjustPaintRoundedRect;break;case"clampedBlurTile":d=yt.ClampedBlurTile;break;case"clampedGradientBlur":d=yt.ClampedGradientBlurTile;break;case"unclampedBlurTile":d=yt.UnclampedBlurTile;break;case"unclampedGradientBlur":d=yt.UnclampedGradientBlurTile;break;case"upscaleAndBlendGradientBlurTile":d=yt.UpscaleAndBlendGradientBlurTile;break;case"rectangleBlur":d=yt.RectangleBlur;break;case"roundedRectangleBlur":d=yt.RoundedRectangleBlur;break;case"upscaleTile":d=yt.UpscaleTile;break;case"downscaleTile":d=yt.DownscaleTile;break;case"maskTile":d=yt.MaskTile;break;case"maskInnerShadowTile":d=yt.MaskInnerShadowTile;break;case"maskKnockoutShadowTile":d=yt.MaskKnockoutShadowTile;break;case"maskInnerShadowTileAndFirstHardMaskAlpha":d=yt.MaskInnerShadowTileAndFirstHardMaskAlpha;break;case"maskBackgroundBlurTile":d=yt.MaskBackgroundBlurTile;break;case"maskTileLuminance":d=yt.MaskTileLuminance;break;case"maskTileLuminancePassThrough":d=yt.MaskTileLuminancePassThrough;break;case"maskTilePassThrough":d=yt.MaskTilePassThrough;break;case"blendTexture":d=yt.BlendTexture;break;case"blendTileSimple":d=yt.BlendTileSimple;break;case"blendTileCustom":d=yt.BlendTileCustom;break;case"hardMaskWithColor":d=yt.HardMaskTileWithColor;break;case"hardMaskWithColorAndDownscaleTile":d=yt.HardMaskWithColorAndDownscaleTile;break;case"hotspot":d=yt.Hotspot;break;case"glass":d=yt.Glass;break;case"glassNonUniformCornerRadii":d=yt.GlassNonUniformCornerRadii;break;case"noise":d=yt.Noise;break;case"clampedGrain":d=yt.ClampedGrain;break;case"unclampedGrain":d=yt.UnclampedGrain;break;case"imagePatternSingle":d=yt.ImagePaintPatternSingle;break;case"imagePattern":d=yt.ImagePaintPattern;break;case"image":d=yt.ImagePaintViewer;break;case"imageColorAdjust":d=yt.ImageColorAdjustPaintViewer;break;case"stencil":d=yt.LoopBlinn;break;case"smooth":d=yt.SmoothPath;break;default:return}(u=v().modules().wasmRendererBindings)==null||u.draw(e,d,c,o.type,o.constant,i.type,i.reference,(a==null?void 0:a.handle())??0,s?{x:s.x(),y:s.y(),width:s.width(),height:s.height()}:null,l?{x:l.x(),y:l.y(),width:l.width(),height:l.height()}:null)}drawInstanced(e,r,n,o,i,a,s,l,c){throw new Error("Not implemented.")}createVertexBufferPool(){return new bu}getHTMLContext(){return this._htmlContext}addContextResetHandler(e){this._htmlContext.addContextResetHandler(e)}beginFrame(){var e;(e=v().modules().wasmRendererBindings)==null||e.beginFrame(),this._htmlContext.beginFrame()}clear(e,r,n,o,i){var a;this.gl().enable(this.gl().SCISSOR_TEST),(a=v().modules().wasmRendererBindings)==null||a.clear(e,Mf(r),(n==null?void 0:n.handle())??0,o?{x:o.x(),y:o.y(),width:o.width(),height:o.height()}:null)}createMaterial(e,r,n,o){return this._htmlContext.createMaterial(e,r,n,o)}createTexture(e,r,n,o){return new vu(this,o,r,n,e,lr.createFromPixels(r,n,null),null)}createTextureWithPixels(e,r,n,o,i){return new vu(this,i,r,n,e,lr.createFromPixels(r,n,o),null)}createTextureWithVideo(e,r,n){return new vu(this,n,r.videoWidth,r.videoHeight,e,null,r)}createFramebuffer(e,r,n){return new AS(this,e,r,n)}flush(){return this._htmlContext.flush()}getNumFramebufferSwitches(){return this._htmlContext.getNumFramebufferSwitches()}height(){throw new Error("Method not implemented.")}maxTextureSize(){return this._htmlContext.maxTextureSize()}removeContextResetHandler(e){return this._htmlContext.removeContextResetHandler(e)}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(e){return this._htmlContext.bindWebGLFramebufferAndTrackForBudget(e)}resizeDefaultFramebuffer(e,r){var n;return v()?(n=v().modules().wasmRendererBindings)==null||n.updateBackbufferSize(e,r):ts().then(()=>{var o;(o=v().modules().wasmRendererBindings)==null||o.updateBackbufferSize(e,r)}),this._htmlContext.resizeDefaultFramebuffer(e,r)}width(){throw new Error("Method not implemented.")}readPixels(e,r,n,o,i){return this._htmlContext.readPixels(e,r,n,o,i)}annotate(e,r){return this._htmlContext.annotate(e,r)}annotateAndReturn(e,r){return this._htmlContext.annotateAndReturn(e,r)}annotateProfile(e,r){return this._htmlContext.annotateProfile(e,r)}isContextLost(){return this._htmlContext.isContextLost()}graphicsCardName(){return this._htmlContext.graphicsCardName()}stats(){return this._htmlContext.stats()}getGpuMetricsCollection(){return this._htmlContext.getGpuMetricsCollection()}isVisible(){return this._htmlContext.isVisible()}setMaximumDrawingBufferSizeForTesting(e){return this._htmlContext.setMaximumDrawingBufferSizeForTesting(e)}clearMaximumDrawingBufferSizeForTesting(){return this._htmlContext.clearMaximumDrawingBufferSizeForTesting()}hasLoggedHighpPrecisionUnsupported(){return this._htmlContext.hasLoggedHighpPrecisionUnsupported()}setHasLoggedHighpPrecisionUnsupported(){return this._htmlContext.setHasLoggedHighpPrecisionUnsupported()}supportsCompressedTextures(){return this._htmlContext.supportsCompressedTextures()}gl(){return this._htmlContext.gl()}takeSpectorSnapshot(){this._htmlContext.takeSpectorSnapshot()}useMaterial(e){this._htmlContext.useMaterial(e)}supportsGpuInstancing(){return!1}singleColorTextureManager(){return this._singleColorTextureManager||(this._singleColorTextureManager=new El(this)),this._singleColorTextureManager}};function kO(t){switch(t){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}var Cu=class{createBallisticScrollSimulation(e,r,n,o,i,a){return null}applyOverscrollBehavior(e,r,n,o){return r}constructor(){}};var ql=class{constructor(){this._startTime=0,this._startTime=Ze.seconds()}endPos(){return new F(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new F(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new F(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return Ze.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},Z_=class Z_{static withDampingRatio(e,r,n){return new Z_(e,r,n*2*Math.sqrt(e*r))}constructor(e,r,n){this.mass=e,this.stiffness=r,this.damping=n}};Z_.DEFAULT_SPRING=Z_.withDampingRatio(.5,100,1.1);var Ou=Z_,Nu=class{constructor(e,r){this.velocity=e,this.distance=r}};function HO(){return typeof window<"u"&&typeof si()=="number"?new Nu(1/(.05*si()),1/si()):new Nu(1/.05,1)}var Pu=class{constructor(e,r,n){this._friction=.015;this._initialVelocityPenetration=3.065;this._decelerationRate=Math.log(.78)/Math.log(.9);this._pos=e,this._velocity=r,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=n??this._flingDuration(r),this._distance=Math.abs(r*this._duration/this._initialVelocityPenetration)}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let r=Fr.Math_clamp(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(r)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let r=Fr.Math_clamp(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(r)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let r=this._friction*this._decelerationForFriction(.84),n=Math.log(.35*Math.abs(e)/r);return Math.exp(n/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},J_=class{constructor(e,r,n,o=HO()){this._drag=e,this._dragLog=Math.log(e),this._p=r,this._v=n,this._tolerance=o}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let r=this.endPos();return this._v==0||(this._v>0?e<this._p||e>r:e>this._p||e<r)?1/0:Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},Xl=class{constructor(e,r,n,o,i=HO()){let a=r-n,s=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(s))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(s))/(2*e.mass),this._c2=(-(a*this._r1)+o)/(this._r2-this._r1),this._c1=a-this._c2,this._end=n,this._tolerance=i}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Math.E,this._r1*e)+this._c2*Math.pow(Math.E,this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Math.E,this._r1*e)+this._c2*this._r2*Math.pow(Math.E,this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},Fu=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var $_=class{applyOverscrollBehavior(e,r,n,o){let i=e.subtract(n),s=e.subtract(r).divide(o).makeAbs(),l=this._frictionFactor2(s);return n.add(l.multiply(i))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new F(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,r,n,o,i,a){return new Du(e,r,n,o,i,a)}constructor(){}},Du=class extends ql{constructor(e,r,n,o,i,a){super(),this._xSim=null,this._ySim=null;let s=Ou.DEFAULT_SPRING;this._xSim=new ES(e.x(),r.x(),n,o,s),this._ySim=new ES(e.y(),r.y(),i,a,s)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},ES=class{constructor(e,r,n,o,i){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<n)this._springSimulation=new Xl(i,e,n,r),this._springTime=-1/0;else if(e>o)this._springSimulation=new Xl(i,e,o,r),this._springTime=-1/0;else if(r==0)this._fixedSolution=new Fu(e);else{this._frictionSimulationIOS=new J_(S3,e,r);let a=this._frictionSimulationIOS.endPos();r>0&&a>o?(this._springTime=this._frictionSimulationIOS.timeAtPos(o),this._springSimulation=new Xl(i,o,o,Math.min(this._frictionSimulationIOS.dPos(this._springTime),UL))):r<0&&a<n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new Xl(i,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),UL))):this._springTime=1/0}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},UL=5e3,S3=.135;var eh=class{createBallisticScrollSimulation(e,r,n,o,i,a){return new WO(e,r,n,o,i,a)}applyOverscrollBehavior(e,r,n,o){return r}constructor(){}},WO=class extends ql{constructor(e,r,n,o,i,a){if(super(),this._xSim=null,this._ySim=null,Math.abs(r.x())>Math.abs(r.y())){this._xSim=new xu(e.x(),r.x(),n,o);let s=Math.abs(r.y())>=VL?r.y():0;this._ySim=new xu(e.y(),s,i,a,this._xSimulation().duration())}else{this._ySim=new xu(e.y(),r.y(),i,a);let s=Math.abs(r.x())>=VL?r.x():0;this._xSim=new xu(e.x(),s,n,o,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},xu=class{constructor(e,r,n,o,i){this._duration=-1/0,this._min=n,this._max=o,r==0?this._simulation=new Fu(e):i?this._simulation=new Pu(e,r):(this._simulation=new Pu(e,r,i),this._duration=this._simulation.duration()),this._startTime=Ze.seconds()}duration(){return this._duration}pos(e){let r=this._simulation.pos(e);return r<=this._min?this._min:r>=this._max?this._max:r}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let r=this.pos(e);return r>=this._max||r<=this._min}elapsed(){return Ze.seconds()-this._startTime}typeAt(e){return 0}},VL=50;var th=class extends ql{constructor(e,r,n,o){super(),this._xSim=null,this._ySim=null,this._xSim=new IS(e.x(),r.x(),n,o),this._ySim=new IS(e.y(),r.y(),n,o)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},IS=class{constructor(e,r,n,o){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=r,this._duration=n,this._curve=o}pos(e){let r=Fr.Math_clamp(e/this._duration,0,1);return r==0?this._begin:r==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(r)}dPos(e){return(this.pos(e+.001)-this.pos(e-.001))/(2*.001)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var tN=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Se=(t,e,r)=>(tN(t,e,"read from private field"),r?r.call(t):e.get(t)),ur=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Co=(t,e,r,n)=>(tN(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),rn=(t,e,r)=>(tN(t,e,"access private method"),r),yr=new Uint8Array(8),$s=new DataView(yr.buffer),Aa=t=>[(t%256+256)%256],Hr=t=>($s.setUint16(0,t,!1),[yr[0],yr[1]]),A3=t=>($s.setInt16(0,t,!1),[yr[0],yr[1]]),HL=t=>($s.setUint32(0,t,!1),[yr[1],yr[2],yr[3]]),Vt=t=>($s.setUint32(0,t,!1),[yr[0],yr[1],yr[2],yr[3]]),T3=t=>($s.setUint32(0,Math.floor(t/2**32),!1),$s.setUint32(4,t,!1),[yr[0],yr[1],yr[2],yr[3],yr[4],yr[5],yr[6],yr[7]]),rN=t=>($s.setInt16(0,2**8*t,!1),[yr[0],yr[1]]),Ss=t=>($s.setInt32(0,2**16*t,!1),[yr[0],yr[1],yr[2],yr[3]]),KO=t=>($s.setInt32(0,2**30*t,!1),[yr[0],yr[1],yr[2],yr[3]]),gs=(t,e=!1)=>{let r=Array(t.length).fill(null).map((n,o)=>t.charCodeAt(o));return e&&r.push(0),r},od=t=>t&&t[t.length-1],uh=(t,e,r=!0)=>{let n=t*e;return r?Math.round(n):n},zL=t=>{let e=t*(Math.PI/180),r=Math.cos(e),n=Math.sin(e);return[r,n,0,-n,r,0,0,0,1]},E3=zL(0),WL=t=>[Ss(t[0]),Ss(t[1]),KO(t[2]),Ss(t[3]),Ss(t[4]),KO(t[5]),Ss(t[6]),Ss(t[7]),KO(t[8])],ih=t=>!t||typeof t!="object"?t:Array.isArray(t)?t.map(ih):Object.fromEntries(Object.entries(t).map(([e,r])=>[e,ih(r)])),Bo=(t,e,r)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:r}),Go=(t,e,r,n,o)=>Bo(t,[Aa(e),HL(r),n??[]],o),I3=t=>t?Bo("ftyp",[gs("isom"),Vt(0),gs("iso4"),gs("hvc1")]):Bo("ftyp",[gs("isom"),Vt(0),gs("isom"),gs("avc1"),gs("mp41")]),kL=t=>({type:"mdat",largeSize:t}),R3=t=>({type:"free",size:t}),YO=(t,e)=>Bo("moov",null,[y3(e,t),...t.map(r=>b3(r,e))]),y3=(t,e)=>{let r=uh(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>od(o.samples).timestamp+od(o.samples).duration)),XO),n=Math.max(...e.map(o=>o.id))+1;return Go("mvhd",0,0,[Vt(t),Vt(t),Vt(XO),Vt(r),Ss(1),rN(1),Array(10).fill(0),WL(E3),Array(24).fill(0),Vt(n)])},b3=(t,e)=>Bo("trak",null,[v3(t,e),C3(t,e)]),v3=(t,e)=>{let r=od(t.samples),n=uh(r?r.timestamp+r.duration:0,XO);return Go("tkhd",0,3,[Vt(e),Vt(e),Vt(t.id),Vt(0),Vt(n),Array(8).fill(0),Hr(0),Hr(0),rN(t.info.type==="audio"?1:0),Hr(0),WL(zL(t.info.type==="video"?t.info.rotation:0)),Ss(t.info.type==="video"?t.info.width:0),Ss(t.info.type==="video"?t.info.height:0)])},C3=(t,e)=>Bo("mdia",null,[O3(t,e),N3(t.info.type==="video"?"vide":"soun"),P3(t)]),O3=(t,e)=>{let r=od(t.samples),n=uh(r?r.timestamp+r.duration:0,t.timescale);return Go("mdhd",0,0,[Vt(e),Vt(e),Vt(t.timescale),Vt(n),Hr(21956),Hr(0)])},N3=t=>Go("hdlr",0,0,[gs("mhlr"),gs(t),Vt(0),Vt(0),Vt(0),gs("mp4-muxer-hdlr")]),P3=t=>Bo("minf",null,[t.info.type==="video"?F3():D3(),x3(),M3(t)]),F3=()=>Go("vmhd",0,1,[Hr(0),Hr(0),Hr(0),Hr(0)]),D3=()=>Go("smhd",0,0,[Hr(0),Hr(0)]),x3=()=>Bo("dinf",null,[w3()]),w3=()=>Go("dref",0,0,[Vt(1)],[L3()]),L3=()=>Go("url ",0,1),M3=t=>Bo("stbl",null,[B3(t),Y3(t),Q3(t),q3(t),X3(t),j3(t)]),B3=t=>Go("stsd",0,0,[Vt(1)],[t.info.type==="video"?G3(Z3[t.info.codec],t):z3($3[t.info.codec],t)]),G3=(t,e)=>Bo(t,[Array(6).fill(0),Hr(1),Hr(0),Hr(0),Array(12).fill(0),Hr(e.info.width),Hr(e.info.height),Vt(4718592),Vt(4718592),Vt(0),Hr(1),Array(32).fill(0),Hr(24),A3(65535)],[J3[e.info.codec](e)]),U3=t=>t.codecPrivate&&Bo("avcC",[...t.codecPrivate]),V3=t=>t.codecPrivate&&Bo("hvcC",[...t.codecPrivate]),k3=t=>t.codecPrivate&&Bo("vpcC",[...t.codecPrivate]),H3=t=>t.codecPrivate&&Bo("av1C",[...t.codecPrivate]),z3=(t,e)=>Bo(t,[Array(6).fill(0),Hr(1),Hr(0),Hr(0),Vt(0),Hr(e.info.numberOfChannels),Hr(16),Hr(0),Hr(0),Ss(e.info.sampleRate)],[ez[e.info.codec](e)]),W3=t=>Go("esds",0,0,[Vt(58753152),Aa(32+t.codecPrivate.byteLength),Hr(1),Aa(0),Vt(75530368),Aa(18+t.codecPrivate.byteLength),Aa(64),Aa(21),HL(0),Vt(130071),Vt(130071),Vt(92307584),Aa(t.codecPrivate.byteLength),...t.codecPrivate,Vt(109084800),Aa(1),Aa(2)]),K3=t=>Bo("dOps",[Aa(0),Aa(t.info.numberOfChannels),Hr(3840),Vt(t.info.sampleRate),rN(0),Aa(0)]),Y3=t=>Go("stts",0,0,[Vt(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[Vt(e.sampleCount),Vt(e.sampleDelta)])]),Q3=t=>{if(t.samples.every(r=>r.type==="key"))return null;let e=[...t.samples.entries()].filter(([,r])=>r.type==="key");return Go("stss",0,0,[Vt(e.length),e.map(([r])=>Vt(r+1))])},q3=t=>Go("stsc",0,0,[Vt(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[Vt(e.firstChunk),Vt(e.samplesPerChunk),Vt(1)])]),X3=t=>Go("stsz",0,0,[Vt(0),Vt(t.samples.length),t.samples.map(e=>Vt(e.size))]),j3=t=>t.finalizedChunks.length>0&&od(t.finalizedChunks).offset>=2**32?Go("co64",0,0,[Vt(t.finalizedChunks.length),t.finalizedChunks.map(e=>T3(e.offset))]):Go("stco",0,0,[Vt(t.finalizedChunks.length),t.finalizedChunks.map(e=>Vt(e.offset))]),Z3={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},J3={avc:U3,hevc:V3,vp9:k3,av1:H3},$3={aac:"mp4a",opus:"Opus"},ez={aac:W3,opus:K3},nN=class{constructor(){this.buffer=null}},KL=class{constructor(t,e,r){this.onData=t,this.onDone=e,this.options=r}},tz=class{constructor(t,e){this.stream=t,this.options=e}},td,wu,oN=class{constructor(){this.pos=0,ur(this,td,new Uint8Array(8)),ur(this,wu,new DataView(Se(this,td).buffer)),this.offsets=new WeakMap}seek(t){this.pos=t}writeU32(t){Se(this,wu).setUint32(0,t,!1),this.write(Se(this,td).subarray(0,4))}writeU64(t){Se(this,wu).setUint32(0,Math.floor(t/2**32),!1),Se(this,wu).setUint32(4,t,!1),this.write(Se(this,td).subarray(0,8))}writeAscii(t){for(let e=0;e<t.length;e++)Se(this,wu).setUint8(e%8,t.charCodeAt(e)),e%8===7&&this.write(Se(this,td));t.length%8!==0&&this.write(Se(this,td).subarray(0,t.length%8))}writeBox(t){if(this.offsets.set(t,this.pos),t.contents&&!t.children)this.writeBoxHeader(t,t.size??t.contents.byteLength+8),this.write(t.contents);else{let e=this.pos;if(this.writeBoxHeader(t,0),t.contents&&this.write(t.contents),t.children)for(let o of t.children)o&&this.writeBox(o);let r=this.pos,n=t.size??r-e;this.seek(e),this.writeBoxHeader(t,n),this.seek(r)}}writeBoxHeader(t,e){this.writeU32(t.largeSize?1:e),this.writeAscii(t.type),t.largeSize&&this.writeU64(e)}measureBoxHeader(t){return 8+(t.largeSize?8:0)}patchBox(t){let e=this.pos;this.seek(this.offsets.get(t)),this.writeBox(t),this.seek(e)}measureBox(t){if(t.contents&&!t.children)return this.measureBoxHeader(t)+t.contents.byteLength;{let e=this.measureBoxHeader(t);if(t.contents&&(e+=t.contents.byteLength),t.children)for(let r of t.children)r&&(e+=this.measureBox(r));return e}}};td=new WeakMap;wu=new WeakMap;var RS,nd,ph,rh,yS,QO,rz=class extends oN{constructor(t){super(),ur(this,yS),ur(this,RS,void 0),ur(this,nd,new ArrayBuffer(2**16)),ur(this,ph,new Uint8Array(Se(this,nd))),ur(this,rh,0),Co(this,RS,t)}write(t){rn(this,yS,QO).call(this,this.pos+t.byteLength),Se(this,ph).set(t,this.pos),this.pos+=t.byteLength,Co(this,rh,Math.max(Se(this,rh),this.pos))}finalize(){rn(this,yS,QO).call(this,this.pos),Se(this,RS).buffer=Se(this,nd).slice(0,Math.max(Se(this,rh),this.pos))}};RS=new WeakMap;nd=new WeakMap;ph=new WeakMap;rh=new WeakMap;yS=new WeakSet;QO=function(t){let e=Se(this,nd).byteLength;for(;e<t;)e*=2;if(e===Se(this,nd).byteLength)return;let r=new ArrayBuffer(e),n=new Uint8Array(r);n.set(Se(this,ph),0),Co(this,nd,r),Co(this,ph,n)};var nh,rd,YL=class extends oN{constructor(t){super(),ur(this,nh,void 0),ur(this,rd,[]),Co(this,nh,t)}write(t){Se(this,rd).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){if(Se(this,rd).length===0)return;let t=[],e=[...Se(this,rd)].sort((r,n)=>r.start-n.start);t.push({start:e[0].start,size:e[0].data.byteLength});for(let r=1;r<e.length;r++){let n=t[t.length-1],o=e[r];o.start<=n.start+n.size?n.size=Math.max(n.size,o.start+o.data.byteLength-n.start):t.push({start:o.start,size:o.data.byteLength})}for(let r of t){r.data=new Uint8Array(r.size);for(let n of Se(this,rd))r.start<=n.start&&n.start<r.start+r.size&&r.data.set(n.data,n.start-r.start);Se(this,nh).onData(r.data,r.start)}Se(this,rd).length=0}finalize(){var t,e;(e=(t=Se(this,nh)).onDone)==null||e.call(t)}};nh=new WeakMap;rd=new WeakMap;var nz=2**24,oz=2,ah,Qa,qi,CS,qO,iN,QL,aN,qL,sh,OS,XL=class extends oN{constructor(t){var e;if(super(),ur(this,CS),ur(this,iN),ur(this,aN),ur(this,sh),ur(this,ah,void 0),ur(this,Qa,void 0),ur(this,qi,[]),Co(this,ah,t),Co(this,Qa,((e=t.options)==null?void 0:e.chunkSize)??nz),!Number.isInteger(Se(this,Qa))||Se(this,Qa)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(t){rn(this,CS,qO).call(this,t,this.pos),rn(this,sh,OS).call(this),this.pos+=t.byteLength}finalize(){var t,e;rn(this,sh,OS).call(this,!0),(e=(t=Se(this,ah)).onDone)==null||e.call(t)}};ah=new WeakMap;Qa=new WeakMap;qi=new WeakMap;CS=new WeakSet;qO=function(t,e){let r=Se(this,qi).findIndex(s=>s.start<=e&&e<s.start+Se(this,Qa));r===-1&&(r=rn(this,aN,qL).call(this,e));let n=Se(this,qi)[r],o=e-n.start,i=t.subarray(0,Math.min(Se(this,Qa)-o,t.byteLength));n.data.set(i,o);let a={start:o,end:o+i.byteLength};if(rn(this,iN,QL).call(this,n,a),n.written[0].start===0&&n.written[0].end===Se(this,Qa)&&(n.shouldFlush=!0),Se(this,qi).length>oz){for(let s=0;s<Se(this,qi).length-1;s++)Se(this,qi)[s].shouldFlush=!0;rn(this,sh,OS).call(this)}i.byteLength<t.byteLength&&rn(this,CS,qO).call(this,t.subarray(i.byteLength),e+i.byteLength)};iN=new WeakSet;QL=function(t,e){let r=0,n=t.written.length-1,o=-1;for(;r<=n;){let i=Math.floor(r+(n-r+1)/2);t.written[i].start<=e.start?(r=i+1,o=i):n=i-1}for(t.written.splice(o+1,0,e),(o===-1||t.written[o].end<e.start)&&o++;o<t.written.length-1&&t.written[o].end>=t.written[o+1].start;)t.written[o].end=Math.max(t.written[o].end,t.written[o+1].end),t.written.splice(o+1,1)};aN=new WeakSet;qL=function(t){let r={start:Math.floor(t/Se(this,Qa))*Se(this,Qa),data:new Uint8Array(Se(this,Qa)),written:[],shouldFlush:!1};return Se(this,qi).push(r),Se(this,qi).sort((n,o)=>n.start-o.start),Se(this,qi).indexOf(r)};sh=new WeakSet;OS=function(t=!1){for(let e=0;e<Se(this,qi).length;e++){let r=Se(this,qi)[e];if(!(!r.shouldFlush&&!t)){for(let n of r.written)Se(this,ah).onData(r.data.subarray(n.start,n.end),r.start+n.start);Se(this,qi).splice(e--,1)}}};var iz=class extends XL{constructor(t){var e;super(new KL((r,n)=>t.stream.write({type:"write",data:r,position:n}),void 0,{chunkSize:(e=t.options)==null?void 0:e.chunkSize}))}},XO=1e3,az=["avc","hevc","vp9","av1"],sz=["aac","opus"],lz=2082844800,cz=.5,dz=["strict","offset"],pr,Pr,NS,Qi,jl,Zl,oh,lh,ch,jO,jL,ZO,ZL,sN,JL,JO,$L,lN,eM,bS,$O,cN,tM,dh,PS,_h,FS,vS,eN,rM=class{constructor(t){var e;if(ur(this,jO),ur(this,ZO),ur(this,sN),ur(this,JO),ur(this,lN),ur(this,bS),ur(this,cN),ur(this,dh),ur(this,_h),ur(this,vS),ur(this,pr,void 0),ur(this,Pr,void 0),ur(this,NS,void 0),ur(this,Qi,void 0),ur(this,jl,null),ur(this,Zl,null),ur(this,oh,Math.floor(Date.now()/1e3)+lz),ur(this,lh,[]),ur(this,ch,!1),rn(this,jO,jL).call(this,t),t.video=ih(t.video),t.audio=ih(t.audio),t.fastStart=ih(t.fastStart),this.target=t.target,Co(this,pr,{firstTimestampBehavior:"strict",...t}),t.target instanceof nN)Co(this,Pr,new rz(t.target));else if(t.target instanceof KL)Co(this,Pr,(e=t.target.options)!=null&&e.chunked?new XL(t.target):new YL(t.target));else if(t.target instanceof tz)Co(this,Pr,new iz(t.target));else throw new Error(`Invalid target: ${t.target}`);rn(this,ZO,ZL).call(this),rn(this,JO,$L).call(this)}addVideoChunk(t,e,r){let n=new Uint8Array(t.byteLength);t.copyTo(n),this.addVideoChunkRaw(n,t.type,r??t.timestamp,t.duration,e)}addVideoChunkRaw(t,e,r,n,o){if(rn(this,vS,eN).call(this),!Se(this,pr).video)throw new Error("No video track declared.");if(typeof Se(this,pr).fastStart=="object"&&Se(this,jl).samples.length===Se(this,pr).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${Se(this,pr).fastStart.expectedVideoChunks}).`);rn(this,bS,$O).call(this,Se(this,jl),t,e,r,n,o)}addAudioChunk(t,e,r){let n=new Uint8Array(t.byteLength);t.copyTo(n),this.addAudioChunkRaw(n,t.type,r??t.timestamp,t.duration,e)}addAudioChunkRaw(t,e,r,n,o){if(rn(this,vS,eN).call(this),!Se(this,pr).audio)throw new Error("No audio track declared.");if(typeof Se(this,pr).fastStart=="object"&&Se(this,Zl).samples.length===Se(this,pr).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${Se(this,pr).fastStart.expectedAudioChunks}).`);rn(this,bS,$O).call(this,Se(this,Zl),t,e,r,n,o)}finalize(){if(Se(this,ch))throw new Error("Cannot finalize a muxer more than once.");Se(this,jl)&&rn(this,dh,PS).call(this,Se(this,jl)),Se(this,Zl)&&rn(this,dh,PS).call(this,Se(this,Zl));let t=[Se(this,jl),Se(this,Zl)].filter(Boolean);if(Se(this,pr).fastStart==="in-memory"){let e;for(let n=0;n<2;n++){let o=YO(t,Se(this,oh)),i=Se(this,Pr).measureBox(o);e=Se(this,Pr).measureBox(Se(this,Qi));let a=Se(this,Pr).pos+i+e;for(let s of Se(this,lh)){s.offset=a;for(let l of s.sampleData)a+=l.byteLength,e+=l.byteLength}if(a<2**32)break;e>=2**32&&(Se(this,Qi).largeSize=!0)}let r=YO(t,Se(this,oh));Se(this,Pr).writeBox(r),Se(this,Qi).size=e,Se(this,Pr).writeBox(Se(this,Qi));for(let n of Se(this,lh)){for(let o of n.sampleData)Se(this,Pr).write(o);n.sampleData=null}}else{let e=Se(this,Pr).offsets.get(Se(this,Qi)),r=Se(this,Pr).pos-e;Se(this,Qi).size=r,Se(this,Qi).largeSize=r>=2**32,Se(this,Pr).patchBox(Se(this,Qi));let n=YO(t,Se(this,oh));if(typeof Se(this,pr).fastStart=="object"){Se(this,Pr).seek(Se(this,NS)),Se(this,Pr).writeBox(n);let o=e-Se(this,Pr).pos;Se(this,Pr).writeBox(R3(o))}else Se(this,Pr).writeBox(n)}rn(this,_h,FS).call(this),Se(this,Pr).finalize(),Co(this,ch,!0)}};pr=new WeakMap;Pr=new WeakMap;NS=new WeakMap;Qi=new WeakMap;jl=new WeakMap;Zl=new WeakMap;oh=new WeakMap;lh=new WeakMap;ch=new WeakMap;jO=new WeakSet;jL=function(t){if(t.video){if(!az.includes(t.video.codec))throw new Error(`Unsupported video codec: ${t.video.codec}`);if(t.video.rotation!==void 0&&![0,90,180,270].includes(t.video.rotation))throw new Error(`Invalid video rotation: ${t.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(t.audio&&!sz.includes(t.audio.codec))throw new Error(`Unsupported audio codec: ${t.audio.codec}`);if(t.firstTimestampBehavior&&!dz.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`);if(typeof t.fastStart=="object"){if(t.video&&t.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(t.audio&&t.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(t.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};ZO=new WeakSet;ZL=function(){var e;let t=((e=Se(this,pr).video)==null?void 0:e.codec)==="hevc";if(Se(this,Pr).writeBox(I3(t)),Co(this,NS,Se(this,Pr).pos),Se(this,pr).fastStart==="in-memory")Co(this,Qi,kL(!1));else{if(typeof Se(this,pr).fastStart=="object"){let r=rn(this,sN,JL).call(this);Se(this,Pr).seek(Se(this,Pr).pos+r)}Co(this,Qi,kL(!0)),Se(this,Pr).writeBox(Se(this,Qi))}rn(this,_h,FS).call(this)};sN=new WeakSet;JL=function(){if(typeof Se(this,pr).fastStart!="object")return;let t=0,e=[Se(this,pr).fastStart.expectedVideoChunks,Se(this,pr).fastStart.expectedAudioChunks];for(let r of e)r&&(t+=8*Math.ceil(2/3*r),t+=4*r,t+=12*Math.ceil(2/3*r),t+=4*r,t+=8*r);return t+=4096,t};JO=new WeakSet;$L=function(){if(Se(this,pr).video&&Co(this,jl,{id:1,info:{type:"video",codec:Se(this,pr).video.codec,width:Se(this,pr).video.width,height:Se(this,pr).video.height,rotation:Se(this,pr).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),Se(this,pr).audio){let t=rn(this,lN,eM).call(this,2,Se(this,pr).audio.sampleRate,Se(this,pr).audio.numberOfChannels);Co(this,Zl,{id:Se(this,pr).video?2:1,info:{type:"audio",codec:Se(this,pr).audio.codec,numberOfChannels:Se(this,pr).audio.numberOfChannels,sampleRate:Se(this,pr).audio.sampleRate},timescale:Se(this,pr).audio.sampleRate,codecPrivate:t,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};lN=new WeakSet;eM=function(t,e,r){let o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),i=r,a="";a+=t.toString(2).padStart(5,"0"),a+=o.toString(2).padStart(4,"0"),o===15&&(a+=e.toString(2).padStart(24,"0")),a+=i.toString(2).padStart(4,"0");let s=Math.ceil(a.length/8)*8;a=a.padEnd(s,"0");let l=new Uint8Array(a.length/8);for(let c=0;c<a.length;c+=8)l[c/8]=parseInt(a.slice(c,c+8),2);return l};bS=new WeakSet;$O=function(t,e,r,n,o,i){var l;let a=n/1e6,s=o/1e6;if(t.firstTimestamp===void 0&&(t.firstTimestamp=a),a=rn(this,cN,tM).call(this,a,t),t.lastTimestamp=a,(!t.currentChunk||a-t.currentChunk.startTimestamp>=cz)&&(t.currentChunk&&rn(this,dh,PS).call(this,t),t.currentChunk={startTimestamp:a,sampleData:[],sampleCount:0}),t.currentChunk.sampleData.push(e),t.currentChunk.sampleCount++,(l=i==null?void 0:i.decoderConfig)!=null&&l.description&&(t.codecPrivate=new Uint8Array(i.decoderConfig.description)),t.samples.push({timestamp:a,duration:s,size:e.byteLength,type:r}),t.lastTimescaleUnits!==null){let c=uh(a,t.timescale,!1),d=Math.round(c-t.lastTimescaleUnits);t.lastTimescaleUnits+=d;let u=od(t.timeToSampleTable);u.sampleCount===1?(u.sampleDelta=d,u.sampleCount++):u.sampleDelta===d?u.sampleCount++:(u.sampleCount--,t.timeToSampleTable.push({sampleCount:2,sampleDelta:d}))}else t.lastTimescaleUnits=0,t.timeToSampleTable.push({sampleCount:1,sampleDelta:uh(s,t.timescale)})};cN=new WeakSet;tM=function(t,e){if(Se(this,pr).firstTimestampBehavior==="strict"&&e.lastTimestamp===-1&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${t}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(Se(this,pr).firstTimestampBehavior==="offset"&&(t-=e.firstTimestamp),t<e.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${e.lastTimestamp*1e6} to ${t*1e6}).`);return t};dh=new WeakSet;PS=function(t){if(t.currentChunk){if((t.compactlyCodedChunkTable.length===0||od(t.compactlyCodedChunkTable).samplesPerChunk!==t.currentChunk.sampleCount)&&t.compactlyCodedChunkTable.push({firstChunk:t.finalizedChunks.length+1,samplesPerChunk:t.currentChunk.sampleCount}),t.finalizedChunks.push(t.currentChunk),Se(this,lh).push(t.currentChunk),Se(this,pr).fastStart==="in-memory"){t.currentChunk.offset=0;return}t.currentChunk.offset=Se(this,Pr).pos;for(let e of t.currentChunk.sampleData)Se(this,Pr).write(e);t.currentChunk.sampleData=null,rn(this,_h,FS).call(this)}};_h=new WeakSet;FS=function(){Se(this,Pr)instanceof YL&&Se(this,Pr).flush()};vS=new WeakSet;eN=function(){if(Se(this,ch))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};function nM(t){if(t.startsWith("avc1"))return"avc";if(t.startsWith("av01"))return"av1";if(t.startsWith("vp09"))return"vp9";if(t.startsWith("hvc1")||t.startsWith("hev1"))return"hevc";throw new Error(`Codec ${t} not supported for Mp4`)}function oM(t){if(t.startsWith("mp4a"))return"aac";if(t.startsWith("opus"))return"opus";throw new Error(`Codec ${t} not supported for Audio`)}function iM(t,e,r,n,o,i,a){try{var s=t[i](a),l=s.value}catch(c){r(c);return}s.done?e(l):Promise.resolve(l).then(n,o)}function uz(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(l){iM(i,n,o,a,s,"next",l)}function s(l){iM(i,n,o,a,s,"throw",l)}a(void 0)})}}function As(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function pz(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{},n=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable}))),n.forEach(function(o){As(t,o,r[o])})}return t}function _z(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function hz(t,e){return e=e??{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_z(Object(e)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}),t}var mz=t=>new VideoEncoder(t),fz=t=>new AudioEncoder(t),DS=class{encodeVideoFrame(e){if(this._cancelledOrError)throw e.close(),new Error("Video recording stopped");try{this._videoEncoder.encode(e)}catch(r){this.handleError(r)}finally{e==null||e.close()}}encodeAudioData(e){if(this._cancelledOrError)throw e.close(),new Error("Video recording stopped");try{var r;(r=this._audioEncoder)===null||r===void 0||r.encode(e)}catch(n){this.handleError(n)}finally{e.close()}}cancel(){this._cancelledOrError=!0}destroy(){this._videoEncoder.state!=="closed"&&this._videoEncoder.close(),this._audioEncoder&&this._audioEncoder.state!=="closed"&&this._audioEncoder.close()}getFinalBuffer(){var e=this;return uz(function*(){var r,n,o;if(e._cancelledOrError)throw new Error("Video recording stopped");yield e._videoEncoder.flush(),yield(r=e._audioEncoder)===null||r===void 0?void 0:r.flush(),e._videoEncoder.close(),(n=e._audioEncoder)===null||n===void 0||n.close(),e._muxer.finalize();let{buffer:i}=e._muxer.target;if(e._videoEncoder.encodeQueueSize||!((o=e._audioEncoder)===null||o===void 0)&&o.encodeQueueSize){var a;console.error(`Exported video before encoding finished, pending video encodes: ${e._videoEncoder.encodeQueueSize}, pending audio encodes: ${(a=e._audioEncoder)===null||a===void 0?void 0:a.encodeQueueSize}`)}if(e._cancelledOrError)throw new Error("Error");return i})()}constructor(e){As(this,"params",void 0),As(this,"_videoEncoder",void 0),As(this,"_audioEncoder",void 0),As(this,"_muxer",void 0),As(this,"_videoChunksAlreadyEncoded",void 0),As(this,"_cancelledOrError",void 0),As(this,"handleVideoChunk",void 0),As(this,"handleAudioChunk",void 0),As(this,"handleError",void 0),this.params=e,this._videoChunksAlreadyEncoded=0,this._cancelledOrError=!1,this.handleVideoChunk=(s,l)=>{if(!this._cancelledOrError)try{this._muxer.addVideoChunk(s,l),this._videoChunksAlreadyEncoded++;let{numFramesToRender:c}=this.params.video;if(!c)return;this.params.onProgress(Math.min(this._videoChunksAlreadyEncoded/c,1))}catch(c){this.handleError(c)}},this.handleAudioChunk=(s,l)=>{if(!this._cancelledOrError)try{this._muxer.addAudioChunk(s,l)}catch(c){this.handleError(c)}},this.handleError=s=>{this._cancelledOrError=!0,this.params.onError(s)};let{width:r,height:n,codec:o}=e.video.config,{videoEncoderFactory:i=mz,audioEncoderFactory:a=fz}=e;if(this._muxer=new rM({target:new nN,firstTimestampBehavior:"offset",fastStart:!1,video:{codec:nM(o),width:r,height:n},audio:e.audio&&hz(pz({},e.audio),{codec:oM(e.audio.codec)})}),this._videoEncoder=i({output:this.handleVideoChunk,error:this.handleError}),this._videoEncoder.configure(e.video.config),this._videoEncoder.state!=="configured")throw new Error("Video encoder config failed");if(e.audio&&(this._audioEncoder=a({output:this.handleAudioChunk,error:this.handleError}),this._audioEncoder.configure(e.audio),this._audioEncoder.state!=="configured"))throw new Error("Audio encoder config failed")}};var el=class extends Error{constructor(){super("Export canceled"),this.name="ExportCanceledError"}};function aM(t){return{name:t.name,message:t.message,stack:t.stack}}function sM(t,e,r,n,o,i,a){try{var s=t[i](a),l=s.value}catch(c){r(c);return}s.done?e(l):Promise.resolve(l).then(n,o)}function xS(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(l){sM(i,n,o,a,s,"next",l)}function s(l){sM(i,n,o,a,s,"throw",l)}a(void 0)})}}function Lu(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var wS=class{recordVideo(e){var r=this;return xS(function*(){if(r._session)throw new Error("Recording already in progress");return new Promise(function(){var n=xS(function*(o,i){let a=new DS({video:r.params.video,audio:r.params.audio,onError:r.onError,onProgress:s=>{if(!r._session)return;let l=Math.floor(s*10)/10;l>r._session.lastProgressPercent&&(r._session.lastProgressPercent=l,r.params.onProgress(l))}});for(r._session={clockSource:e,videoEncoder:a,currentPendingEncode:null,resolve:o,reject:i,lastProgressPercent:0},e.start();r._session;)r._session.currentPendingEncode=r.captureFrame(r._session),yield r._session.currentPendingEncode;r.params.onProgress(1)});return function(o,i){return n.apply(this,arguments)}}())})()}stopRecording(e=!1){var r=this;return xS(function*(){if(!r._session)return;let n=r._session;r._session=null;let{clockSource:o,resolve:i,reject:a,videoEncoder:s}=n;if(o.stop(),e){s.cancel(),s.destroy(),a(new el);return}if(yield n.currentPendingEncode,r._pendingError){s.cancel(),s.destroy(),a(r._pendingError);return}s.getFinalBuffer().finally(()=>s.destroy()).then(i).catch(a)})()}constructor(e){var r=this;Lu(this,"params",void 0),Lu(this,"_session",void 0),Lu(this,"_pendingError",void 0),Lu(this,"_reader",void 0),Lu(this,"captureFrame",void 0),Lu(this,"onError",void 0),this.params=e,this._session=null,this._pendingError=null,this.captureFrame=function(){var n=xS(function*(o){try{let{done:i,value:a}=yield r._reader.read();if(i||!a){r.stopRecording(!1);return}"numberOfChannels"in a?o.videoEncoder.encodeAudioData(a):(o.videoEncoder.encodeVideoFrame(a),r.params.onFrameCaptured())}catch(i){r.onError(i)}});return function(o){return n.apply(this,arguments)}}(),this.onError=n=>{this._session&&(this._pendingError=n,this.stopRecording(!1))},this._reader=e.readableStream.getReader()}};var LS;(function(t){t.AVC_MAIN_LEVEL_4="avc1.4d0028",t.AVC_HIGH_LEVEL_5="avc1.640032",t.AVC_HIGH_LEVEL_6="avc1.64003c",t.AVC_HIGH_LEVEL_6_2="avc1.64003e",t.AVC_HIGH_PROGRESSIVE_LEVEL_6_2="avc1.64083e",t.AVC_HIGH_10_LEVEL_4="avc1.6e0028",t.AVC_HIGH_10_LEVEL_5="avc1.6e0032",t.AVC_HIGH_10_LEVEL_6="avc1.6e003c",t.AVC_HIGH_10_INTRA_LEVEL_1="avc1.6e100a",t.AVC_HIGH_10_INTRA_LEVEL_6="avc1.6e103c",t.AVC_HIGH_4_2_2_LEVEL_6="avc1.7a003c",t.AVC_HIGH_4_4_4_PREDICTIVE_LEVEL_6="avc1.f4003c",t.AV1_MAIN_LEVEL_4="av01.0.08M.08",t.VP9_PROFILE_2_LEVEL_1="vp09.02.10.10.01.09.16.09.01",t.HEVC_BASIC="hev1.1.6.L93.90",t.HEVC_MAIN_PROGRESSIVE_LEVEL_3_1="hvc1.1.6.L93.B0"})(LS||(LS={}));function lM(t,e){return new ReadableStream({start(r){let n=[t.getReader(),e.getReader()],o=[!1,!1];function i(a,s){a.read().then(({value:l,done:c})=>{if(c){o[s]=!0,o[0]&&o[1]&&r.close();return}r.enqueue(l),i(a,s)})}i(n[0],0),i(n[1],1)}})}function MS(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var BS=class{stop(){this._started&&(this._started=!1,this.params.onStop())}start(){this._started||(this._started=!0,this._frameNumber=0,this.params.onStart(),this.params.setPlayheadTimeMs(this.getPlayheadTimeMs()))}getPlayheadTimeMs(){return Math.round(this._frameNumber*1e3*1e3/this.params.fps)/1e3}constructor(e){MS(this,"params",void 0),MS(this,"_started",void 0),MS(this,"_frameNumber",void 0),MS(this,"bumpTime",void 0),this.params=e,this._started=!1,this._frameNumber=0,this.bumpTime=()=>{if(!this._started)return;this._frameNumber+=1;let r=this.getPlayheadTimeMs();if(r>=this.params.durationMs){this.stop();return}this.params.setPlayheadTimeMs(r)}}};var dM=new Map([["http:",80],["https:",443]]);function gz(t){return t==="http:"||t==="https:"}function Sz(t){if(gz(t.protocol)){let e=t.port?parseInt(t.port):dM.get(t.protocol);return{scheme:t.protocol,hostname:t.hostname,port:e}}else return"INVALID_ORIGIN"}function Az(t,e){return e.scheme==="ALL"||e.scheme.scheme===t}function Tz(t,e){if(e.hostname==="ALL"||e.hostname.hostname===t)return!0;try{let r=decodeURI(e.hostname.hostname);if(r.startsWith("*."))return new RegExp(`^${r.replace(/\./g,"\\.").replace("*",".*")}$`).test(t)}catch{return!1}return!1}function Ez(t,e){return e.port==="ALL"||e.port.port===t}function Iz(t,e){return Az(t.scheme,e)&&Tz(t.hostname,e)&&Ez(t.port,e)?"ALLOWED":"DENIED"}var cM="embedkit-wildcard-placeholder.";function Rz(t){return t.map(e=>{let r=e.includes("*."),n=r?e.replace("*.",cM):e,o=new URL(n),i=r?o.hostname.replace(cM,"%2A."):o.hostname;return{scheme:{scheme:o.protocol},hostname:{hostname:i},port:{port:o.port?parseInt(o.port):dM.get(o.protocol)}}})}function yz(t,e){let r=Rz(e);for(let n of r)if(Iz(t,n)==="ALLOWED")return"ALLOWED";return"DENIED"}function dN(t,e){let r;try{r=new URL(t)}catch{return"DENIED"}let n=Sz(r);return n==="INVALID_ORIGIN"?"DENIED":yz(n,e)}var uN={clientId:null,allowedEmbedOrigins:null,embedHost:null};function uM(){try{if(window.top===window)return null;if(window.location.origin===window.parent.location.origin)return window.location.origin}catch{return null}return null}var Jl;(g=>{function t(m){g._mockEmbedListener=m}g.setMockListener=t;function e(m,A,S){A.addObserver(new u(m,A)),g._prototypeObserver=new p(m,A),uN=S,U.getFeatureFlags().embedkit_v2_embed_api&&!U.getFeatureFlags().embedkit_v2_enforce_embed_origins&&S.clientId==null&&console.warn("[Figma Embed Kit] To continue using the Embed API for sending and receiving messages from your Figma embeds, you must register a Figma OAuth app, specify in the app's configuration the domains where you're hosting embeds, and provide the app's client ID in your embed URL using the client-id parameter. You need to do this by December 5th, 2024."),m.prototypeState().addObserver(g._prototypeObserver),m.prototypeState().addHsmObserver(g._prototypeObserver),Xt.getEventEmitter().on("sceneDidCompleteInitialLoad",b=>{m.scene().addObserver(g._prototypeObserver),o(0,{})}),Xt.getEventEmitter().on("requestClose",b=>{o(4,{})});let T=window;if(T===null)return;let R=U.getFeatureFlags().embedkit_v2_enforce_embed_origins;T.addEventListener("message",b=>{let O=b.data;if(!O)return;let f=O.type;if(!g.VALID_MESSAGE_TYPES.has(f))return;let I=O.data;if(!uM()&&U.getFeatureFlags().embedkit_v2_embed_api){let{clientId:P,allowedEmbedOrigins:E}=uN;if(P==null){if(R){console.error("[Figma Embed Kit] You must register an app and provide a client-id to enable the Embed API.");return}console.warn("[Figma Embed Kit] Starting on December 5th, 2024, you must register an app and provide a client-id to enable the Embed API. Please do so to avoid any disruption to your users.")}else if(E==null){if(R){console.error(`[Figma Embed Kit] The app (${P}) must have allowed embed origins set to enable the Embed API.`);return}console.warn(`[Figma Embed Kit] Starting on December 5th, 2024, to use the Embed API, you must set allowed embed origins for your app (${P}).`)}if(E&&dN(b.origin,E)==="DENIED"){if(R){console.error(`[Figma Embed Kit] The origin ${b.origin} does not match any allowed embed origins for the app (${P}). It must be be one of the following: ${E.join(", ")}`);return}console.warn(`[Figma Embed Kit] The origin ${b.origin} does not match any allowed embed origins for the app (${P}). It must be be one of the following: ${E.join(", ")}. Starting on December 5th, 2024, this will be enforced.`)}}n(m,A,f,I)})}g.init=e,g.VALID_MESSAGE_TYPES=new Set(["NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS","NAVIGATE_BACKWARD","NAVIGATE_FORWARD","CHANGE_COMPONENT_STATE","RESTART","REQUEST_EXPORT","CANCEL_EXPORT","TIMELINE_PLAYER_PLAY","TIMELINE_PLAYER_PAUSE","TIMELINE_PLAYER_RESET"]);function n(m,A,S,T){var R,b,O;if(g.VALID_MESSAGE_TYPES.has(S))switch(S){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let f=X.fromString(T.nodeId),I=X.fromString(T.startingPointNodeId);if(U.isInlinePreview()&&(m.prototypeState().mostRecentBaseScreenIdChangeInitiator="EmbedAPI._receiveFromHost",m.prototypeState().resetPrototype(),g._prototypeObserver.handleRestartPrototype(),A.handleRestartPrototype(),m.videoManager().handleRestartPrototype()),!(U.isInlinePreview()&&f==null))if(X.isValid(f)){let y=(R=m.scene())==null?void 0:R.findNode(f);if(y!=null){I&&(m.prototypeState().mostRecentFixInvalidStateInitiator="EmbedAPI._receiveFromHost",m.setActivePrototypeStartingPointNodeId(I));let P=I&&y.topLevelAncestor()==null?I:f;m.prototypeState().navigateToFrameAndCloseOverlays(P,null,2,0,0,null,null)}else g._prototypeObserver.setPendingNodeId(f)}else console.error(`Expected node id; got '${T.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{A.navigateBackward(18);break}case"NAVIGATE_FORWARD":{A.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let f=(b=m.scene())==null?void 0:b.findNodeFromDeveloperFriendlyId(T.nodeId),I=(O=m.scene())==null?void 0:O.findNodeFromDeveloperFriendlyId(T.newVariantId);if(f==null){console.error(`Could not find node from specified node id '${T.nodeId}'`);return}if(I==null){console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${T.newVariantId}'`);return}m.prototypeState().swapInstanceToState2(f.stablePath(),I.id(),null,0,null,1,null);break}case"RESTART":{m.prototypeState().restartPrototype(1);break}case"REQUEST_EXPORT":{A.exportVideos(T.nodeIds,T.videoVolumeByNodeId||{},T.videoTrimValuesByNodeId||{},(f,I)=>{o(6,{completedNodeId:f,progressPercent:I||0})}).then(f=>{o(5,{videoBuffer:f})}).catch(f=>{f instanceof el||(console.error(`[Figma Embed Kit] Error exporting video ${f.message}`),o(5,{error:f}))});break}case"CANCEL_EXPORT":{A.cancelVideoExport(),o(5,{error:aM(new el)});break}case"TIMELINE_PLAYER_PLAY":{let C=function(){o(7,{status:E,currentTimeMs:y,totalTimeMs:P})},f=m.baseScreenNode();if(!f)return;let I=f.id(),y=0,P=0,E="stopped";A.timelineManager().play({nodeId:I,videoVolumeByNodeId:T.videoVolumeByNodeId||{},videoTrimValuesByNodeId:T.videoTrimValuesByNodeId||{},onPause:()=>{E="paused",C()},onDurationMs:B=>{P=B,C()},onPlayheadTimeMs:B=>{y=B,C()},onStart:()=>{E="playing",y=0,C()},onResume:()=>{E="playing",C()},onStop:()=>{E="stopped",y=0,C()}}).catch(B=>{console.error(`[Figma Embed Kit] Error playing scene ${B.message}`)});break}case"TIMELINE_PLAYER_PAUSE":{A.timelineManager().pause();break}case"TIMELINE_PLAYER_RESET":{A.timelineManager().cancelCurrentPlayingSession();break}default:break}}g._receiveFromHost=n;function o(m,A){let S={type:d[m],data:A};if(g._mockEmbedListener!=null){(0,g._mockEmbedListener)(S);return}let T=window;if(T===null||T.parent===null||T.parent.postMessage===void 0||T.top===T)return;if(!uM()&&U.getFeatureFlags().embedkit_v2_embed_api){let{clientId:b,allowedEmbedOrigins:O}=uN,f=U.getFeatureFlags().embedkit_v2_enforce_embed_origins;if(b==null){if(f)return}else if(b!=null&&O==null||O.length===0){if(f){console.error(`[Figma Embed Kit] The app (${b}) must have allowed embed origins set to enable the Embed API.`);return}console.warn(`[Figma Embed Kit] Starting on December 5th, 2024, to use the Embed API, you must set allowed embed origins for your app (${b}). Please do so to avoid any disruption to your users.`)}}T.parent.postMessage(S,"*")}function i(m,A){for(let S=m.childCount()-1;S>=0;S=S-1)i(m.childAt2(S,!0),A);A(m)}g._forEachNodeInHitTestOrder=i;function a(m,A){let S=null,T=null;return i(m,R=>{if(S!=null)return;let b=R.canvasSpaceScrolledInteractiveBounds(0);if(R.isVisibleInCanvas()&&b.contains2(A)){S=R;let O=R.canvasSpaceScrolledInteractiveBounds(1);T=A.subtract(O.topLeft())}}),S==null?null:new c(S,T)}g.findClickInfoForUnhandledMouseRelease=a;function s(m,A,S){if(A.node==null){xe("Hotspot node is null");return}let T=m.baseScreenNode();if(T==null)return;let R=m.prototypeState().getTopmostOverlayNode(),b=R??T,O=S;R!=null&&(O=m.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(T,S));let f=O.subtract(A.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),I={};I.handled=!0,I.presentedNodeId=b.developerFriendlyId(),I.targetNodeId=A.node.developerFriendlyId(),I.targetNodeMousePosition=f.toJSON();let y=A.node.findContainingScrollingFrameOrSelf();if(y!=null){let P=y.canvasSpaceScrolledInteractiveBounds(1),E=O.subtract(P.topLeft());I.nearestScrollingFrameId=y.developerFriendlyId(),I.nearestScrollingFrameMousePosition=E.toJSON(),I.nearestScrollingFrameOffset=y.scrollOffset().toJSON()}else I.nearestScrollingFrameId=null,I.nearestScrollingFrameMousePosition=null,I.nearestScrollingFrameOffset=null;o(1,I)}g.willTriggerClickLikeHotspot=s;function l(m,A){let S=m.baseScreenNode();if(S==null)return;let T=m.prototypeState().getTopmostOverlayNode(),R=A;T!=null&&(R=m.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(S,A));let b=T??S,O=a(b,R),f={};f.handled=!1,f.presentedNodeId=b.developerFriendlyId(),f.targetNodeId=O!=null?O.node.developerFriendlyId():null,f.targetNodeMousePosition=O!=null?O.nodeSpacePoint.toJSON():null;let I=O!=null?O.node.findContainingScrollingFrameOrSelf():null;if(I!=null){let y=I.canvasSpaceScrolledInteractiveBounds(1),P=R.subtract(y.topLeft());f.nearestScrollingFrameId=I.developerFriendlyId(),f.nearestScrollingFrameMousePosition=P.toJSON(),f.nearestScrollingFrameOffset=I.scrollOffset().toJSON()}else f.nearestScrollingFrameId=null,f.nearestScrollingFrameMousePosition=null,f.nearestScrollingFrameOffset=null;o(1,f)}g.notifyUnhandledMouseRelease=l;class c{constructor(A,S){this.node=A,this.nodeSpacePoint=S}}g.ClickedLayer=c;let d;(I=>(I[I.INITIAL_LOAD=0]="INITIAL_LOAD",I[I.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",I[I.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",I[I.NEW_STATE=3]="NEW_STATE",I[I.REQUEST_CLOSE=4]="REQUEST_CLOSE",I[I.EXPORT_COMPLETED=5]="EXPORT_COMPLETED",I[I.EXPORT_PROGRESS=6]="EXPORT_PROGRESS",I[I.UPDATE_TIMELINE_PLAYER_STATE=7]="UPDATE_TIMELINE_PLAYER_STATE"))(d=g.MessageType||(g.MessageType={}));class u{willTriggerHotspot(A,S,T,R){let b=T==4||T==8||T==9||T==3;if(R!=null&&b){let O=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(R.clone());s(this._appState,A,O)}}didScrollNode(A){}constructor(A,S){this._appState=A,this._canvasView=S}}g.EmbedCanvasViewObserver=u;class p{constructor(A,S){this.appState=null,this._pendingNodeId=null,this.appState=A,this._canvasView=S}setPendingNodeId(A){this._pendingNodeId=A}handleSceneGraphEvent(A){this._pendingNodeId!=null&&this.appState.prototypeStructure().validDestinationForPrototypeFromId(this._pendingNodeId)&&(U.isInlinePreview()?(this.appState.prototypeState().mostRecentFixInvalidStateInitiator="EmbedPrototypeObserver.handleSceneGraphEvent",this.appState.setActivePrototypeStartingPointNodeId(this._pendingNodeId),this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId,null,2,0,0,null,null)):this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(A){if(A==null)return;let S=this.appState.baseScreenNode();if(!U.isInlinePreview()&&S==null)return;let T=this.appState.prototypeState().getTopmostOverlayNode(),R=T??S,b={};b.presentedNodeId=R==null?void 0:R.developerFriendlyId(),b.isStoredInHistory=!lt.isTransientAction(A.cause);let O={};this.appState.prototypeState().getOnscreenStates().forEach(f=>{let I=f.a,y=f.b,P=this.appState.scene().findNodeByStablePath(I);P!=null&&(O[P.developerFriendlyId()]=y)}),b.stateMappings=O,o(2,b)}handleInteractiveComponentStateChange(A,S){if(S==null)return;let T=this.appState.scene().findNodeByStablePath(A);if(T==null)return;let R={};R.nodeId=T.developerFriendlyId(),R.currentVariantId=S.oldStateId(),R.newVariantId=S.newStateId(),R.isStoredInHistory=!lt.isTransientAction(S.cause),R.isTimedChange=S.cause==1,o(3,R)}handleStateChangeAborted(A){this.handlePresentedNodeChanged(A)}handleStateChangeCommitted(A,S){}handleStateChangeInitiated(A){this.handlePresentedNodeChanged(A)}handleStateChangeRequested(A){this._canvasView.timelineManager().cancelCurrentTimelineActions()}handleFitModeChange(A,S){}handleRestartPrototype(){this._canvasView.timelineManager().cancelCurrentTimelineActions()}handleHsmAborted(A,S){this.handleInteractiveComponentStateChange(A,S)}handleHsmCommitted(A,S,T){}handleHsmInitiated(A,S){this.handleInteractiveComponentStateChange(A,S)}handleHsmRequested(A,S){}}g.EmbedPrototypeObserver=p,g._mockEmbedListener=null,g._prototypeObserver=null})(Jl||(Jl={}));var GS=class{onClick(){this._timeOfLastClick=Ze.seconds()}getOpacity(){let e=Ze.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){this._animationDuration=.7,this._easingFunction=No.makeEasingFunction([0,0,.58,1],.7),this._timeOfLastClick=0}},US=class{constructor(e,r){this._context=e,this._materialStrings=Br.instance(),this._hotspotMaterial=this._context.createMaterial("hotspot",St.getPositionF4(),this._materialStrings.SHADER_SOURCE_RENDER_HOTSPOT_VERTEX,this._materialStrings.SHADER_SOURCE_RENDER_HOTSPOT_FRAGMENT);let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=r.allocateSmallManagedArea(ze.TRIANGLE_STRIP,bt.getPositionF4(),n)}draw(e,r,n,o,i){if(o<=0)return;let a=e;for(let s of n){let l=Q.new2();l.copyFrom(a);let c=s.canvasSpaceBounds;l.translate2(c.x(),c.y()),l.scale4(c.width(),c.height());let d=L.new2();s.canvasSpaceClipBounds.transformInto1(d,a);let u=new F(2/c.width(),2/c.height());u.divideUpdate(r*i),_x(this._hotspotMaterial,this._materialStrings,l,d,u,o),this._context.draw(ze.TRIANGLE_STRIP,this._hotspotMaterial,this._hotspotQuad,It.UNPREMULTIPLIED,gr.NONE,null)}}},hh=class{constructor(e,r){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=r}},mh=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var VS=class{constructor(e,r){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=2,this._emitter=null,this._didFinishZooming=e,this._emitter=r}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus!=2?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let r=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!r&&this._emitter.trigger("zoomStart");let n=this._userIdleCount>=2;this._zoomInProgress&&n&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&r&&this._emitter.trigger("zoomStop"),this._justInteracted=!1}shouldRenderOptionalTiles(){return U.shouldApplyMobileOptimizations()?this._userIdleCount>6&&this._drawIdleCount<120:this._userIdleCount>6}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var pN=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,r,n){this._delayedHotspotId=e,this._interaction=r,this._action=n,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},HS=class{resetEntry(e,r){this.resetAllEntriesMatchingPredicate((n,o)=>X.equals(n,e)&&o==r)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((r,n)=>n==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(r=>!e(r.delayedHotspotId(),r.interaction()))}set(e,r,n){let o=this.getByHotspotAndInteractionType(e,r);if(o==null){let i=new pN;i.set(e,r,n),this._maintainedDataEntries.push(i),o=i}else o.set(e,r,n);return o.counter()}getByHotspotAndInteractionType(e,r){for(let n of this._maintainedDataEntries)if(X.equals(n.delayedHotspotId(),e)&&n.interaction()==r)return n;return null}constructor(){this._maintainedDataEntries=[]}};var zS=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e,r){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._getNodesEnteredByCanvasSpacePoint(e,r),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let r=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(i=>!this.previouslyEnteredGUIDsSet.has(i));r.reverse();let n=new Map;for(let i=0,a=r.length;i<a;i=i+1)n.set(r[i],i);let o=e.filter(i=>n.has(i.node.id()));return o.sort((i,a)=>Ut.int_compare(n.get(i.node.id()),n.get(a.node.id()))),o}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let r=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(i=>!this.currentlyEnteredGUIDsSet.has(i)),n=new Map;for(let i=0,a=r.length;i<a;i=i+1)n.set(r[i],i);let o=e.filter(i=>n.has(i.node.id()));return o.sort((i,a)=>Ut.int_compare(n.get(i.node.id()),n.get(a.node.id()))),o}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let r=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(n=>!r.has(n))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((r,n)=>{let o=n=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(r),i=n=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(r);return o||i})}_getNodesEnteredByCanvasSpacePoint(e,r){if(this._appState.baseScreenNode()==null)return[];let o=[],[i,a]=this._appState.prototypeState().getTopmostScreenAndPoint(e),s=vo.getNodeInteractionPairs("MOUSE_ENTER",r),l=vo.getNodeInteractionPairs("MOUSE_LEAVE",r),c=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(i,0,u=>{let p=u.event().interactionType();return p=="MOUSE_LEAVE"||p=="MOUSE_ENTER"},[...s??[],...l??[]]),d=null;for(let u of c)u.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(d==null||u.node.isAboveInLayerOrder(d.node))&&(d=u);if(d!=null&&d.node){let u=d.node;for(;u!=i;)o.push(u.id()),u=u.parent();o.push(i.id())}return o}};var WS=class{toggleRenderTreePrinting(){}addObserver(e){}removeObserver(e){}setBackgroundEnabled(e){}isRenderingDone(){return!0}getContext(){return null}graphicsCardName(){return""}setNeedsBlit(e){}checkNeedsBlit(){return!1}deviceRenderer(){return null}initializeThumbnailInvalidationManager(e){}thumbnailRenderer(){return null}setShouldRenderCursor(e){}changeFitMode(e){}setZoomScale(e){}updateScroll(e){}handleSceneChange(e,r){}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}resize(e,r,n,o){return new Oa(new F(0,0),!1)}drawBlank(){}draw(e,r,n,o){return 2}clearTileCaches(){}resetTileStackUsage(){}reclaimTileStack(){}triggerTransition(e,r,n){}handleAbortedTransition(e){}handleCommittedTransition(e){}triggerHsmTransition(e,r,n){}abortHsmTransition(e,r){}commitHsmTransition(e,r){}triggerObjectAnimation(e,r){}handleAbortedObjectAnimation(e){}handleCommittedObjectAnimation(e){}isTopLevelTransitionOngoing(){return!1}easedTransitionProgress(){return 1}currentCanvasSpacePreviewBounds(){return new L(0,0,0,0)}currentCanvasSpaceFrameBounds(){return new L(0,0,0,0)}canvasSpacePreviewBoundsForTransition(e,r){return new L(0,0,0,0)}canvasSpaceFrameBoundsForTransition(e,r){return new L(0,0,0,0)}ongoingPrototypeStateChange(){return null}transitionProgressTracker(){return null}drawDeviceFrameIfNecessary(e,r,n,o){return!1}renderLayerByLayerActivate(e){}renderLayerByLayerDeactivate(){}renderLayerByLayerPlay(){}renderLayerByLayerPause(){}renderLayerByLayerForward(){}renderLayerByLayerBackward(){}renderLayerByLayerRewind(){}renderLayerByLayerIncreaseSpeed(){}renderLayerByLayerDecreaseSpeed(){}attachTo(e){}removeFrom(e){}setInViewerRenderServerForTests(e){}};var fM=Ja(ib());var $l=class t{constructor(e,r){this._rectPoints=[F.new(),F.new(),F.new(),F.new()],this._inside=[],this._material=null,this._outside=[],this._vertices=new oo,this._context=null,this._pixelScale=1,this._previousColor=N.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=e,this._pool=r,this._materialStrings=Br.instance(),this._vertexTransform=null,this._material=e.createMaterial("smooth",St.getPositionF4CoordB4(),this._materialStrings.SHADER_SOURCE_SMOOTH_PATH_VERTEX,this._materialStrings.SHADER_SOURCE_SMOOTH_PATH_FRAGMENT)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(e,r){!0,this._vertexTransform=e,this._pixelScale=r}flush(){let e=this._pool.allocateVertexBufferAreas(ze.TRIANGLE_STRIP,bt.getPositionF4CoordB4(),this._vertices.bytes());BD(this._material,this._materialStrings,this._vertexTransform);for(let r of e)this._context.draw(ze.TRIANGLE_STRIP,this._material,r,It.PREMULTIPLIED,gr.NONE,null),r.free();this._vertices.clear()}_loadPoints(e){this._rectPoints[0].setTo(e.left(),e.top()),this._rectPoints[1].setTo(e.right(),e.top()),this._rectPoints[2].setTo(e.right(),e.bottom()),this._rectPoints[3].setTo(e.left(),e.bottom())}fillRect(e,r){this._loadPoints(e),this.fillConvexPolygon(this._rectPoints,r)}strokeRect(e,r,n){this._loadPoints(e),this.strokeNonOverlappingPolyline(this._rectPoints,r,n,t.Loop.CLOSED)}fillConvexPolygon(e,r){let n=this._inside,o=this._outside,i=e.length;if(!(i<3)){for(r=N.premultiplied(r);n.length<i;)n.push(F.new()),o.push(F.new());for(let a=0,s=i;a<s;a=a+1){let l=e[Ut.int_remainder(a+i-1,i)],c=e[a],d=e[Ut.int_remainder(a+1,i)],u=l.y()-c.y(),p=c.x()-l.x(),_=this._length(u,p),h=c.y()-d.y(),g=d.x()-c.x(),m=this._length(h,g),A=u/_+h/m,S=p/_+g/m,T=.5*this._pixelScale*_/(u*A+p*S),R=A*T,b=S*T;o[a].setTo(c.x()-R,c.y()-b),n[a].setTo(c.x()+R,c.y()+b)}for(let a=0,s=i-1;a<=s;a=a+1,s=s-1){let l=n[a],c=n[s];this._appendVertex(l.x(),l.y(),1,1,r),a==0&&this._appendPreviousVertex(),a<s&&this._appendVertex(c.x(),c.y(),1,1,r)}this._appendPreviousVertex();for(let a=0;a<=i;a=a+1){let s=Ut.int_remainder(a,i),l=n[s],c=o[s];this._appendVertex(c.x(),c.y(),0,0,r),a==0&&this._appendPreviousVertex(),this._appendVertex(l.x(),l.y(),1,1,r)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(e,r,n,o){let i=(n+this._pixelScale)/this._pixelScale,a=(n+this._pixelScale)/2,s=e.length;if(s<2)return;if(r=N.premultiplied(r),o==t.Loop.OPEN){let d=e[0],u=e[1],p=u.x()-d.x(),_=u.y()-d.y(),h=this._length(p,_),g=.5*this._pixelScale/h,m=p*g,A=_*g,S=a/h,T=-_*S,R=p*S;this._appendVertex(d.x()-m-T,d.y()-A-R,0,-i,r),this._appendPreviousVertex(),this._appendVertex(d.x()-m+T,d.y()-A+R,-i,0,r),this._appendVertex(d.x()+m-T,d.y()+A-R,0,i,r),this._appendVertex(d.x()+m+T,d.y()+A+R,i,0,r)}let l=o==t.Loop.CLOSED?0:1,c=o==t.Loop.CLOSED?s+1:s-1;for(let d=l,u=c;d<u;d=d+1){let p=e[Ut.int_remainder(d+s-1,s)],_=e[Ut.int_remainder(d,s)],h=e[Ut.int_remainder(d+1,s)],g=p.y()-_.y(),m=_.x()-p.x(),A=this._length(g,m),S=_.y()-h.y(),T=h.x()-_.x(),R=this._length(S,T),b=g/A+S/R,O=m/A+T/R,f=a*A/(g*b+m*O),I=b*f,y=O*f;this._appendVertex(_.x()-I,_.y()-y,0,i,r),d==0&&this._appendPreviousVertex(),this._appendVertex(_.x()+I,_.y()+y,i,0,r)}if(o==t.Loop.OPEN){let d=e[s-2],u=e[s-1],p=u.x()-d.x(),_=u.y()-d.y(),h=this._length(p,_),g=.5*this._pixelScale/h,m=p*g,A=_*g,S=a/h,T=-_*S,R=p*S;this._appendVertex(u.x()-m-T,u.y()-A-R,0,i,r),this._appendVertex(u.x()-m+T,u.y()-A+R,i,0,r),this._appendVertex(u.x()+m-T,u.y()+A-R,0,-i,r),this._appendVertex(u.x()+m+T,u.y()+A+R,-i,0,r)}this._appendPreviousVertex()}_appendVertex(e,r,n,o,i){this._previousX=e,this._previousY=r,this._previousU=n,this._previousV=o,this._previousColor=i,this._vertices.appendFloat(e).appendFloat(r).appendFloat(n).appendFloat(o),this._vertices.appendByte(N.red(i)).appendByte(N.green(i)).appendByte(N.blue(i)).appendByte(N.alpha(i))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(e,r){return Math.sqrt(e*e+r*r)}};(e=>{let t;(o=>(o[o.CLOSED=0]="CLOSED",o[o.OPEN=1]="OPEN"))(t=e.Loop||(e.Loop={}))})($l||($l={}));var fh=class{constructor(e,r,n,o){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=r,this._equals=n,this._onChange=o,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new fe(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new fe(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};var KS=class{constructor(e,r){this._deviceImageManager=new go,this._hasPendingFrame=!1,this._context=e,this._bufferPool=r,this._materialStrings=Br.instance();let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocateSmallManagedArea(ze.TRIANGLE_STRIP,bt.getPositionF4(),n),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",St.getPositionF4(),this._materialStrings.SHADER_SOURCE_RENDER_DEVICE_FRAME_VERTEX,this._materialStrings.SHADER_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(HD(this._deviceFrameMaterial,this._materialStrings,this._vertexTransform,this._imgTexture),this._context.draw(ze.TRIANGLE_STRIP,this._deviceFrameMaterial,this._deviceFrameQuad,It.PREMULTIPLIED,gr.NONE,null),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let r=go.infoForDevice(e);if(r==null)return!1;let n=this._deviceImageManager.getImage(r,this._context).imageResource;return!n.isDecoded()&&!n.loadDidFail()}canRenderDeviceFrame(e){let r=go.infoForDevice(e);return r==null?!1:this._deviceImageManager.getImage(r,this._context).imageResource.isDecoded()}pixelAtPosition(e,r,n){if(r==null)return N.TRANSPARENT;let o=go.infoForDevice(n);if(o==null)return N.TRANSPARENT;let i=this._deviceImageManager.getImage(o,this._context).imageResource;if(!i.isDecoded()||i.width()<=0||i.height()<=0)return N.TRANSPARENT;let a=i.decodedData();if(a==null)return N.TRANSPARENT;let s=n.canvasSpaceTopLeftOffset(o),l=r.topLeft().subtract(s),c=n.canvasSpaceImageSize(o),d=e.subtract(l).divide(c);switch(n.rotation){case"NONE":break;case"CCW_90":{d=new F(1-d.y(),d.x());break}default:break}let u=d.x()*o.nonRotatedImageSize.x()|0,p=d.y()*o.nonRotatedImageSize.y()|0;return a.pixelAtIndex(u,p)}drawPrototypeDeviceIfAny(e,r,n,o){if(n==null)return;let i=go.infoForDevice(r);if(i==null)return;let a=this._deviceImageManager.getImage(i,this._context).imageResource;if(!a.isDecoded()&&!a.loadDidFail()){e.invalidate();return}let s=a.texture();if(s==null||a.width()<=0||a.height()<=0)return;let l=s.width()/i.scaleFactor,c=s.height()/i.scaleFactor,d=i.nonRotatedOffset,u=n.topLeft().subtract(d),p=L.new2();p.setTo1(u.x(),u.y(),l,c);let _=Q.new2();_.copyFrom(o),_.translate2(p.x(),p.y()),r.rotation=="CCW_90"&&(_.translate1(i.nonRotatedOffset),_.rotate(-Math.PI/2),_.translate1(i.nonRotatedOffset.negative()),_.translate2(-i.nonRotatedFramePresetSize.x(),0)),_.scale4(p.width(),p.height()),this._vertexTransform=_,this._imgTexture=s,this._hasPendingFrame=!0}async preloadDeviceImage(e){let r=go.infoForDevice(e);if(r!=null)return this._deviceImageManager.getImage(r,this._context).loadPromise}};var gh=class{constructor(e){this._dirtyNewBoundsBuilder=new vt,this._dirtyOldBoundsBuilder=new vt,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=L.new2(),this._canvasSpaceDirtyOldBounds=L.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 45:case 14:case 15:case 20:case 29:case 30:case 31:case 62:case 102:case 103:case 104:case 106:case 107:case 46:case 73:break;case 27:case 110:case 49:case 60:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(e.id(),e.id())}invalidateDirtyTiles(e,r){if(e==null||this._dirtyNodes.size==0)return;let n=[],o=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),qe.StringMap_each(this._dirtyNodes,(i,a)=>{let s=e.scene().findNode(a);if(s!=null&&s.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let l=s==null?void 0:s.topLevelAncestor();if(l!=null){if(!l.hasBeenLoaded())return;o.set(l.id(),!0)}let c=qe.StringMap_get(this._cachedCanvasSpaceBounds,i,null),d=s==null?void 0:s.canvasSpaceRenderedBounds();if(c!=null&&this._dirtyOldBoundsBuilder.include3(c),d!=null?(this._dirtyNewBoundsBuilder.include3(d),this._cachedCanvasSpaceBounds.set(i,d)):this._cachedCanvasSpaceBounds.delete(i),r.overlayRenderData()!=null){let u=r.overlayRenderData();if(u!=null)for(let p of u.keys()){let _=u.get(p),h=c!=null&&c.overlaps(_.bounds),g=d!=null&&d.overlaps(_.bounds);(h||g)&&o.set(_.overlayId,!0)}}}),Re.perfTimerScope("invalidateNestedBackgroundBlurRenderTrees",Re.ProfileLevel.LEGACY,()=>{e.invalidateNestedBackgroundRenderTrees(o,n)});for(let i=0,a=n.length;i<a;i=i+1){let s=n[i];this._dirtyOldBoundsBuilder.include3(s)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._cachedCanvasSpaceBounds.set(o.id(),o.canvasSpaceRenderedBounds()),this._initCachedBounds(o)}}};var bz=-1,pM=!1,rr=class rr{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new jn),this}dissolve(){return this.isDissolve=!0,this.transition=new jn().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,r){let n=new rr;for(let o of rr.propertyFunctions)if(o(e,r,n),n.isDissolve)return n;return n}static forDiscreteProperties(e,r,n){return n=rr.nodeTypeToRenderSetMap.get(e.type())==rr.nodeTypeToRenderSetMap.get(r.type())?n:n.dissolve(),n=e.blendMode()==r.blendMode()?n:n.dissolve(),n=e.clipsToBoundingRectangle()==r.clipsToBoundingRectangle()?n:n.dissolve(),n=e.isFixed()==r.isFixed()?n:n.dissolve(),n}static forSizes(e,r,n){let o=e.size(),i=r.size();if(n.addProperty(l=>l.transformOrigin(o.divideScalar(2),i.divideScalar(2))),n.transition.hasLegacyTransitioningSizesForImageRect()||n.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&r.type()=="ROUNDED_RECTANGLE")return n;let a=r.isResizeToFit()||er.isFrameLike(r.type())&&!r.clipsToBoundingRectangle();return(e.isResizeToFit()||er.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&rr._filterPaints3(e.fillPaintsToRender()).length==0&&a&&rr._filterPaints3(r.fillPaintsToRender()).length==0||o.equals(i)?n:n.dissolve()}static forOpacity(e,r,n){return n.addProperty(o=>o.opacity(e,r))}static forRelativeTransforms(e,r,n){return n.addProperty(o=>o.transform(e,r))}static forFillPaints(e,r,n){let o=rr._filterPaints2(e),i=rr._filterPaints2(r);return rr._maybeInterpolatePaints(o,i,n,a=>a.fillPaints1(o,i))}static forStrokePaints(e,r,n){let o=rr._filterPaints2(e),i=rr._filterPaints2(r);return rr._maybeInterpolatePaints(o,i,n,a=>a.strokePaints1(o,i))}static _filterPaints1(e){return rr._filterPaints2(e)}static _filterPaints2(e){return e.filter(r=>r.isEnabled())}static _filterPaints3(e){return rr._filterPaints2(e)}static _maybeInterpolatePaints(e,r,n,o){return!n.transition.hasTransitioningGeometryForRoundedRectangles()&&$t.FrozenList_equals(e,r,(i,a)=>i.equals1(a))?n:$t.FrozenList_equals(e,r,(i,a)=>i.type()==="PATTERN"?i.equals1(a):i.type()==a.type()&&i.blendMode()==a.blendMode())?n.addProperty(o):n.dissolve()}static forGeometryAndPaints(e,r,n){var d,u,p,_;let o=e.supportsGeometry(),i=r.supportsGeometry();if(!o&&!i)return n;if(o!=i)return n.dissolve();let a=((d=e.fillGeometry())==null?void 0:d.regions)??[],s=((u=r.fillGeometry())==null?void 0:u.regions)??[],l=(er.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&rr._filterPaints2(e.strokePaints()).length==0&&a.length==1&&At.isRoundedRectSupportedIgnoringCornerSmoothing(e.roundedRectInfo()),c=(er.isFrameLike(r.type())&&r.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(r.type())!=-1)&&rr._filterPaints2(r.strokePaints()).length==0&&s.length==1&&At.isRoundedRectSupportedIgnoringCornerSmoothing(r.roundedRectInfo());if(l&&c){if(a.length!=0&&s.length!=0){let h=(p=e.fillGeometry())==null?void 0:p.regions[0].bounds().size(),g=(_=r.fillGeometry())==null?void 0:_.regions[0].bounds().size(),m=e.roundedRectInfo(),A=r.roundedRectInfo();if(m!=null&&A!=null){let S=Mn.fromRoundedRect(m),T=Mn.fromRoundedRect(A);(!S.equals(T)||g!=null&&h!=null&&!h.equals(g))&&n.addProperty(R=>R.transitionGeometryForRoundedRectangles(h,S,g,T))}}n=rr._forGeometryPaints(e.fillRegionPaints(),r.fillRegionPaints(),n,(h,g,m)=>rr.forFillPaints(h,g,m))}else{let h=!1;if(e.isAxisAlignedRectFill()&&r.isAxisAlignedRectFill())for(let A of[e.fillPaints(),r.fillPaints()]){for(let S=0,T=A.length;S<T;S=S+1)if(A[S].type()=="IMAGE"||A[S].type()=="VIDEO"){h=!0;break}if(h)break}if(h){let A=e.fillOrTextGeometry(),S=r.fillOrTextGeometry();if(!(A!=null&&A.geometryEquals(S))){let T=rr._filterPaints1(e.fillRegionPaints()[0]),R=rr._filterPaints1(r.fillRegionPaints()[0]);if($t.FrozenList_equals(T,R,(b,O)=>b.type()==O.type()))return n.addProperty(b=>b.fillPaints1(T,R)),n.addProperty(b=>b.shouldDoLegacyImageRectSizeTransition(!0)),n}}let g=e.fillRegionPaints(),m=r.fillRegionPaints();n=rr._forGeometryPaints(g,m,n,(A,S,T)=>rr.forFillPaints(A,S,T)),(g.length>0||m.length>0)&&(n=rr._forGeometryStructure(e.fillOrTextGeometry(),r.fillOrTextGeometry(),n)),n=rr._forTextDecorationStructure(e.textGeometry(),r.textGeometry(),n)}return n=rr._forGeometryStructure(e.strokeGeometry(),r.strokeGeometry(),n),n=rr._forGeometryPaints(e.strokeRegionPaints(),r.strokeRegionPaints(),n,(h,g,m)=>rr.forStrokePaints(h,g,m)),n}static forEffects(e,r,n){let o=e.filter(a=>a.isVisibleForRendering()),i=r.filter(a=>a.isVisibleForRendering());return le.List_equalsWithComparison(o,i,(a,s)=>a.equalsWithinEffectType(s))&&!n.transition.hasTransitioningTransformOrigin()&&!n.transition.hasTransitioningCornerRadii()?n:le.List_equalsWithComparison(o,i,(a,s)=>{let l=U.getFeatureFlags().enable_smart_animate_for_blurs,c=U.getFeatureFlags().enable_smart_animate_for_prog_blurs;return a.type()!=s.type()?!1:a.type()=="FOREGROUND_BLUR"||a.type()=="BACKGROUND_BLUR"?a.blurOpType()=="NORMAL"&&!l||a.blurOpType()=="PROGRESSIVE"&&!c?!1:a.blurOpType()==s.blurOpType():a.type()=="GRAIN"?a.clipToShape()==s.clipToShape()&&a.seed()==s.seed():a.type()=="NOISE"?a.noiseType()==s.noiseType()&&a.blendMode()==s.blendMode()&&a.seed()==s.seed():a.type()=="GLASS"?!0:!!a.equalsWithinEffectType(s)})?n.addProperty(a=>a.setEffectsForTransition(o,i)):n.dissolve()}static forTransformModifiers(e,r,n){let o=e.filter(a=>a.isVisibleForRendering()),i=r.filter(a=>a.isVisibleForRendering());return le.List_equalsWithComparison(o,i,(a,s)=>a.equals(s))?n:n.dissolve()}static _forGeometryStructure(e,r,n){return e!=null&&r!=null?e.geometryEquals(r)?n:n.dissolve():e==null&&r==null?n:n.dissolve()}static _forTextDecorationStructure(e,r,n){return e!=null&&r!=null?e.decorationRegionsEquals(r)?n:n.dissolve():e==null&&r==null?n:n.dissolve()}static _forGeometryPaints(e,r,n,o){if(e.length==r.length){for(let i=0,a=e.length;i<a;i=i+1)if(n=o(e[i],r[i],n),n.isDissolve)return n;return n}return n.dissolve()}constructor(){this.isDissolve=!1,this.transition=new jn}};rr.propertyFunctions=[(e,r,n)=>{let o=e.overlayTransform().clone();o.multiply(e.relativeTransformAccountingForFixedOffset());let i=r.overlayTransform().clone();i.multiply(r.relativeTransformAccountingForFixedOffset()),rr.forRelativeTransforms(o,i,n)},(e,r,n)=>{rr.forGeometryAndPaints(e,r,n)},(e,r,n)=>{rr.forSizes(e,r,n)},(e,r,n)=>{rr.forDiscreteProperties(e,r,n)},(e,r,n)=>{rr.forOpacity(e.opacity(),r.opacity(),n)},(e,r,n)=>{rr.forEffects(e.effects(),r.effects(),n)},(e,r,n)=>{rr.forTransformModifiers(e.transformModifiers(),r.transformModifiers(),n)}],rr.nodeTypeToRenderSetMap=[["NONE","DOCUMENT","SLICE"],["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE","MODULE"],["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"],["BOOLEAN_OPERATION"],["TEXT"]].reduce((e,r,n)=>(r.forEach(o=>{e.set(o,n)}),e),new Map);var Mu=rr;var Ei=class t{constructor(e,r,n,o){this._lastInputTForAbsoluteTransform=-1;this._oldSceneNode=e,this._oldCanvasToRenderTreeTransform=r,this._newSceneNode=n,this._newCanvasToRenderTreeTransform=o,this._children=[],this._enabledTraits=bz,this._parent=null,this._transition=null,this._isDissolve=!1,this._scalesIndependentlyOfParent=!1,this._forceMask=!1,this._interpolateScalingToCachedAbsoluteTransform=new Map}get isDissolve(){return this._isDissolve}get scalesIndependentlyOfParent(){return this._scalesIndependentlyOfParent}get forceMask(){return this._forceMask}get enabledTraits(){return this._enabledTraits}get transition(){return this._transition}setTransition(e){this._transition=e,this._referenceTransitionForChildrenNodes=e}clearTransitionForDissolveRenderTrees(){var r;let e=((r=this.transition)==null?void 0:r.clone().transform(Q.new2(),Q.new2()))??null;this._transition=e}get parent(){return this._parent}get children(){return this._children}static debugStringRecursive(e,r,n,o){var s,l;r.result+=r.indent,n||(r.result+=o?"\u2514\u2500":"\u251C\u2500");let i=r.indent.length;n||(r.indent+=o?"  ":"\u2502 "),r.result+=`${((s=e._oldSceneNode)==null?void 0:s.name())??"null"} -> ${((l=e._newSceneNode)==null?void 0:l.name())??"null"}`,e.forceMask&&(r.result+=" (.MASK)");let a=e.transition;if(a!=null){let c=a.from(),d=a.to();if(r.result+=e.isDissolve?" (dissolve)":"",r.result+=a.hasTransitioningPaints()&&4&e.enabledTraits?` (paints) ${c.fillPaintsToString()} -> ${d.fillPaintsToString()}`:"",r.result+=a.hasTransitioningGeometryForRoundedRectangles()&&16&e.enabledTraits?" (geometry)":"",(c.opacity1()!=1||c.opacity1()!=d.opacity1())&&(r.result+=` (opacity: ${c.opacity1()} -> ${d.opacity1()})`),c.translation1().equals(d.translation1())||(r.result+=` (translation: ${c.translation1()} -> ${d.translation1()})`),!c.transform1().equals1(d.transform1())){let u=Ko.from(c.transform1()),p=Ko.from(d.transform1());u.translation.approximatelyEquals(p.translation,1e-6)||(r.result+=` (translation: ${u.translation} -> ${p.translation})`),u.scale.approximatelyEquals(p.scale,1e-6)||(r.result+=` (scale: ${u.scale} -> ${p.scale})`),u.angleDegrees!=p.angleDegrees&&(r.result+=` (angle: ${u.angleDegrees} deg -> ${p.angleDegrees} deg)`)}}r.result+=`
`;for(let c=0,d=e.children.length;c<d;c=c+1)this.debugStringRecursive(e.children[c],r,!1,c==e.children.length-1);e.isDissolve&&(this.debugStringRecursive(e.forDissolveStart1(),r,!1,!1),this.debugStringRecursive(e.forDissolveEnd1(),r,!1,!0)),r.indent=r.indent.slice(0,i)}static _generatePlanForMatchedNodes(e,r,n,o,i,a){let s=Mu.buildStrategy(e,n);if(s.transition.hasLegacyTransitioningSizesForImageRect()){let c=s.transition;c.scaling(new F(1,1),n.size().divide(e.size()));let d=new t(e,r,n,o);return d._isDissolve=!1,d.setTransition(c),d}let l=this.getMagicMovePlan1(e,r,n,o,i,null,e.isFixed()?Zr.DISSOLVE:a);return l._isDissolve=s.isDissolve,l.setTransition(s.transition),l}static _generatePlanForRemovedNode(e,r,n){let o=new t(e,r,null,null);if(n!=null&&n.isDissolve()){let i=new jn().opacity(e.opacity(),0);i.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),o.setTransition(i)}else{let i=new jn().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(i.translation(n.exitingFrameTransition().from().translation1(),n.exitingFrameTransition().to().translation1()),i.opacity(e.opacity()*n.exitingFrameTransition().from().opacity1(),e.opacity()*n.exitingFrameTransition().to().opacity1())):i.opacity(e.opacity(),e.opacity()),o.setTransition(i)}return e.forEachChild(i=>{o._appendChild(this._generatePlanForRemovedNode(i,r,null))},!0),o}static _generatePlanForInsertedNode(e,r,n){let o=new t(null,null,e,r);if(n!=null&&n.isDissolve()){let i=new jn().opacity(0,e.opacity());i.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),o.setTransition(i)}else{let i=new jn().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(i.translation(n.enteringFrameTransition().from().translation1(),n.enteringFrameTransition().to().translation1()),i.opacity(e.opacity()*n.enteringFrameTransition().from().opacity1(),e.opacity()*n.enteringFrameTransition().to().opacity1())):i.opacity(e.opacity(),e.opacity()),o.setTransition(i)}return e.forEachChild(i=>{o._appendChild(this._generatePlanForInsertedNode(i,r,null))},!0),o}static _matchKey(e){return e.name()}static _getNodeMatches(e,r,n,o){if(!o&&(e.type()=="BOOLEAN_OPERATION"||r.type()=="BOOLEAN_OPERATION"))return;let i=new Map;r.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l;i.has(s)?l=i.get(s):(l=[],i.set(s,l)),l.push(a)}),e.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=qe.StringMap_get(i,s,null);if(l==null||l.length==0)return;let c=l.shift();n.set(a.id(),c),n.set(c.id(),a),this._getNodeMatches(a,c,n,o)})}static getNodeMatches(e,r){let n=new Map;return this._getNodeMatches(e,r,n,!1),n}static getMagicMovePlan1(e,r,n,o,i,a,s){a==null&&(a=new jn);let l=e.isTopLevel()&&n.isTopLevel(),c=new t(e,r,n,o);if(e.type()=="BOOLEAN_OPERATION"||n.type()=="BOOLEAN_OPERATION")return c;for(let u=0;u<n.childCount();u=u+1){let p=n.childAt2(u,!0),_=qe.StringMap_get(i,p.id(),null);_==null?c._appendChild(this._generatePlanForInsertedNode(p,o,s)):c._appendChild(this._generatePlanForMatchedNodes(_,r,p,o,i,s))}let d=0;for(;d<e.childCount();){let u=[],p=d,_=d;for(;d<e.childCount();){let T=e.childAt2(d,!0);if(i.has(T.id()))break;u.push(this._generatePlanForRemovedNode(T,r,s)),_=d,d=d+1}if(u.length==0){d=d+1;continue}let h=-1,g=c.children.length;if(p-1>=0){let T=e.childAt2(p-1,!0);if(T!=null){let R=qe.StringMap_get(i,T.id(),null);R!=null&&(h=c.indexOfSceneNodeInChildren(R))}}if(_+1<e.childCount()){let T=e.childAt2(_+1,!0);if(T!=null){let R=qe.StringMap_get(i,T.id(),null);R!=null&&(g=c.indexOfSceneNodeInChildren(R))}}let m=Math.min(h,g),A=Math.max(h,g),S=s.drawsEnteringFrameOnTopOfExitingFrame()?m+1:A;c.insertChildren(S,u)}if(l&&!e.isTransitionDestinationNode()&&!n.isTransitionDestinationNode()){c._enabledTraits&=-5,c._enabledTraits&=-9,c._enabledTraits&=-65,c._enabledTraits&=-3,c._enabledTraits&=-33,c._enabledTraits&=-129;let u=e.clipsToBoundingRectangle()&&e.containerSupportsFillStrokeAndCorners()||n.clipsToBoundingRectangle()&&n.containerSupportsFillStrokeAndCorners(),p=new t(e,r,n,o);p._enabledTraits=156,u&&(p._enabledTraits&=-9),p._isDissolve=!0,p.setTransition(new jn);let _=u,h=e.fillGeometry(),g=n.fillGeometry();if(h!=null&&g!=null&&(_=_&&!h.geometryEquals(g)),_){let S=c,T=new t(e,r,n,o);T._enabledTraits=20,T.setTransition(new jn),T._forceMask=!0,T._isDissolve=!0,c=new t(e,r,n,o),c._enabledTraits=0,c._isDissolve=!1,c.setTransition(new jn),c._appendChild(T),c._appendChild(S)}else c._enabledTraits|=130;let m=[p,c];if(u){let S=new t(e,r,n,o);S._enabledTraits=24,S._isDissolve=!0,S.setTransition(new jn),m.push(S)}a.opacity(e.opacity(),n.opacity());let A=new t(e,r,n,o);return A._enabledTraits=224,A.insertChildren(0,m),A.setTransition(a),A}else return c}static getMagicMovePlanForStateSwapTransition(e,r){var a;let n=this.getNodeMatches(e,r),o=((a=r.parent())==null?void 0:a.absoluteTransform())??wt.FrozenAffineTransform_IDENTITY,i=this._generatePlanForMatchedNodes(e,wt.FrozenAffineTransform_IDENTITY,r,wt.FrozenAffineTransform_IDENTITY,n,Zr.DISSOLVE);if(i.transition!=null){let s=i.transition;i.setTransition(s.clone().transform(o.clone().multipliedBy1(s.from().transform1()),o.clone().multipliedBy1(s.to().transform1())))}return pM&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(i.debugString()),console.log("------------------------------")),i}static getMagicMovePlan2(e,r,n,o,i){let a=this.getNodeMatches(e,n),s=new jn().transform(r.clone().multipliedBy1(e.absoluteTransform()),o.clone().multipliedBy1(n.absoluteTransform()));return this.getMagicMovePlan1(e,r,n,o,a,s,i)}static renderTreeForMagicMove(e,r,n,o,i){let a=Q.new2().copyFrom(e.absoluteTransform());a.invert();let s=Q.new2();s.leftMultiply(a),s.leftMultiply(r.absoluteTransform());let l=wt.FrozenAffineTransform_IDENTITY,c=e.size().max(r.size()),d=this.getMagicMovePlan2(e,s,r,l,i.withScaledTranslation(c)),u=!0,p=()=>u?0:n(),_=new Ta(d,null,p,o,null),h=ct.renderTreeWithPerfLogging1(_,"renderTreeForMagicMove");return pM&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${e.id()} -> ${r.id()}`),console.log(d.debugString()),console.log(h==null?void 0:h.debugString1()),console.log("------------------------------")),u=!1,h??null}forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(e){var o,i,a;let r=new t(this._oldSceneNode,this._oldCanvasToRenderTreeTransform,null,null);r._enabledTraits=this._enabledTraits,r._forceMask=this._forceMask;let n=((a=this._referenceTransitionForChildrenNodes)==null?void 0:a.clone().opacity(((o=this._oldSceneNode)==null?void 0:o.opacity())??0,((i=this._oldSceneNode)==null?void 0:i.opacity())??0))??null;return n!=null&&this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._oldSceneNode,this._newSceneNode,s=>{n.scaling(Ae.FrozenVector_ONE,new F(s,s))},n.to().transform1(),s=>{n.transform(n.from().transform1(),s)}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(Ae.FrozenVector_ONE,YS(this._newSceneNode).divide(YS(this._oldSceneNode))),n.transformOrigin(this._oldSceneNode.size().divideScalar(2),this._newSceneNode.size().divideScalar(2))),r._isDissolve=!1,r.setTransition(n),e!=null&&n!=null&&(n.from().scaling1().divide(n.to().scaling1()).equals(e.from().scaling1().divide(e.to().scaling1()))||(r._scalesIndependentlyOfParent=!0)),this.children.forEach(s=>{s._oldSceneNode!=null&&r._appendChild(s.forDissolveStart2(n))}),r}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(e){var o,i,a;let r=new t(null,null,this._newSceneNode,this._newCanvasToRenderTreeTransform);r._enabledTraits=this._enabledTraits,r._forceMask=this._forceMask;let n=((a=this._referenceTransitionForChildrenNodes)==null?void 0:a.clone().opacity(((o=this._newSceneNode)==null?void 0:o.opacity())??0,((i=this._newSceneNode)==null?void 0:i.opacity())??0))??null;return n!=null&&this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._newSceneNode,this._oldSceneNode,s=>{n.scaling(new F(s,s),Ae.FrozenVector_ONE)},n.from().transform1(),s=>{n.transform(s,n.to().transform1())}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(YS(this._oldSceneNode).divide(YS(this._newSceneNode)),Ae.FrozenVector_ONE),n.transformOrigin(this._oldSceneNode.size().divideScalar(2),this._newSceneNode.size().divideScalar(2))),r._isDissolve=!1,r.setTransition(n),e!=null&&n!=null&&(n.from().scaling1().divide(n.to().scaling1()).equals(e.from().scaling1().divide(e.to().scaling1()))||(r._scalesIndependentlyOfParent=!0)),this.children.forEach(s=>{s._newSceneNode!=null&&r._appendChild(s.forDissolveEnd2(n))}),r}_maybeUpdateDissolveTransitionsForText(e,r,n,o,i){if(r.type()!="TEXT"||e.type()!="TEXT")return;let a=r.textGeometry(),s=e.textGeometry();if(a==null||s==null)return;let l=1;!r.textHasMixedFontSizes()&&!e.textHasMixedFontSizes()&&r.fontSize()>0&&e.fontSize()>0&&(l=r.fontSize()/e.fontSize(),n(l));let c=F.new(),d=L.new4(r.relativeTransform().translation(),r.size()),u=L.new4(e.relativeTransform().translation(),e.size()),p,_,h=L.new2();switch(r.textAlignHorizontal()==e.textAlignHorizontal()?(p=a.bounds,_=s.bounds):(p=d,_=u),h.copyFrom(_).scaledBy1(l),e.textAlignHorizontal()){case"RIGHT":{c.setX(p.right()-_.right()-(h.right()-_.right()));break}case"CENTER":case"JUSTIFIED":{c.setX(p.center().x()-_.center().x()-(h.center().x()-_.center().x()));break}}switch(r.textAlignVertical()==e.textAlignVertical()?(p=a.bounds,_=s.bounds):(p=d,_=u),h.copyFrom(_).scaledBy1(l),e.textAlignVertical()){case"BOTTOM":{c.setY(p.bottom()-_.bottom()-(h.bottom()-_.bottom()));break}case"CENTER":{c.setY(p.center().y()-_.center().y()-(h.center().y()-_.center().y()));break}}if(!c.equals(F.new())){let g=Q.new3(o);g.translate1(c),i(g)}}sceneNode(){return this._oldSceneNode??this._newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this._oldSceneNode)||this._isSceneNodeEverVisible(this._newSceneNode)}_isSceneNodeEverVisible(e){return e!=null&&e.visible()&&e.opacity()>0}absoluteTransform1(e){return U.smartAnimateCacheTransform()?this.absoluteTransform2WithCaching(e,1):this.absoluteTransform2(e,1)}invalidateCachedAbsoluteTransformsForSelf(){U.smartAnimateCacheTransform()&&(this._lastInputTForAbsoluteTransform=-1,this._interpolateScalingToCachedAbsoluteTransform.set(0,null),this._interpolateScalingToCachedAbsoluteTransform.set(1,null))}absoluteTransform2WithCaching(e,r){return e!=this._lastInputTForAbsoluteTransform&&(this._lastInputTForAbsoluteTransform=e,this._interpolateScalingToCachedAbsoluteTransform.set(0,null),this._interpolateScalingToCachedAbsoluteTransform.set(1,null)),this._interpolateScalingToCachedAbsoluteTransform.get(r)||this._interpolateScalingToCachedAbsoluteTransform.set(r,this.absoluteTransform2(e,r)),this._interpolateScalingToCachedAbsoluteTransform.get(r)}absoluteTransform2(e,r){let n=Q.new2();if(this._transition!=null){let o=this._transition.interpolateTranslation(e);n.translate1(o)}if(this._parent!=null&&n.multiply(this._parent.absoluteTransform2(e,0)),this._transition!=null){let o=this._transition.interpolateTransform(e);if(n.multiply(o),r){let i=this._transition.interpolateScaling(e);n.scale3(i)}}return n}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(e){var n,o,i;let r=this._transition!=null;return e?r=r&&!((n=this._transition)!=null&&n.from().equalTransformsUpToTranslation(this._transition.to(),1e-10)):r=r&&!((i=this._transition)!=null&&i.from().equalTransformsUpToTranslationAndScaling((o=this._transition)==null?void 0:o.to(),1e-10)),this._parent!=null&&(r=r||this._parent.rotatesOrScales2(!1)),r}_appendChild(e){e._parent=this,this._children.push(e)}insertChildren(e,r){for(let n of r)n._parent=this;v1(this._children,e,r)}removeChild(e){this._children.splice(e,1)}debugString(){let e=new hN;return t.debugStringRecursive(this,e,!0,!0),e.result}indexOfSceneNodeInChildren(e){for(let r=0;r<this.children.length;r=r+1){let n=this.children[r];if(n._oldSceneNode==e||n._newSceneNode==e)return r}return-1}indexInParent(){return this._parent!=null?this._parent.children.indexOf(this):-1}canvasSpaceContentBounds(){var r,n;let e=new vt;return e.include3((r=this._oldSceneNode)==null?void 0:r.canvasSpaceContentBounds()),e.include3((n=this._newSceneNode)==null?void 0:n.canvasSpaceContentBounds()),e.build()}},hN=class{constructor(){this.result="",this.indent=""}},Ta=class t{constructor(){this._overlayRenderData=null;this._bindingsConverter=new Wl(this),arguments.length==5?(this._planNode=arguments[0],this._node=arguments[1],this._getEasedT=arguments[2],this._easingFunction=arguments[3],this._overlayRenderData=arguments[4]):arguments.length==3&&(this._planNode=arguments[0],this._node=null,this._getEasedT=arguments[1],this._easingFunction=arguments[2]);let e=this._planNode.sceneNode();this._sceneNodeCursor=new gt(e,this._overlayRenderData)}clone(){return new t(this._planNode,this._node,this._getEasedT,this._easingFunction,this._overlayRenderData)}_updateSceneNodeCursorForCurrentPlanNode(){let e=this._planNode.sceneNode();this._sceneNodeCursor.setNode(e)}moveToChildAt(e){this._planNode=this._planNode.children[e],this._node=this._node!=null&&e<this._node.childCount()?this._node.childAt2(e,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){var e;return((e=this._planNode.transition)==null?void 0:e.hasTransitioningPaints())??!1}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?xr.RenderableContentType.CUSTOM_RENDER_TREE:16&this._planNode.enabledTraits?this._sceneNodeCursor.renderableContentType():xr.RenderableContentType.RENDERABLE_GROUP}isFrameLike(){return this._planNode.isDissolve?!1:er.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){var e,r;return`AnimationPlanNode [from=${((e=this._planNode._oldSceneNode)==null?void 0:e.paintsDebugString())??"null"}] [to=${((r=this._planNode._newSceneNode)==null?void 0:r.paintsDebugString())??"null"}]`}isBrushInstanceType(e){return this._sceneNodeCursor.isBrushInstanceType(e)}getStrokeBrush(){return this._sceneNodeCursor.getStrokeBrush()}getStrokeBrushCursor(){return this._sceneNodeCursor.getStrokeBrushCursor()}getScatterBrushInstanceTransforms(){return this._sceneNodeCursor.getScatterBrushInstanceTransforms()}hasScatterBrushInstanceTransforms(){return this._sceneNodeCursor.hasScatterBrushInstanceTransforms()}subtreeWillChange(){var r,n,o,i,a,s;if(this._planNode.cachedSubtreeWillChange!==void 0)return this._planNode.cachedSubtreeWillChange;if(this._sceneNodeCursor.node!=null&&this._sceneNodeCursor.node.isTopLevel())return this._planNode.cachedSubtreeWillChange=!0,!0;if((r=this._planNode._oldSceneNode)!=null&&r.dependsOnBackgroundContent()||(n=this._planNode._newSceneNode)!=null&&n.dependsOnBackgroundContent())return this._planNode.cachedSubtreeWillChange=!0,!0;if((((i=(o=this._planNode._oldSceneNode)==null?void 0:o.effects().filter(l=>l.type()=="DROP_SHADOW"&&l.isVisibleForRendering()))==null?void 0:i.length)??0)>0||(((s=(a=this._planNode._newSceneNode)==null?void 0:a.effects().filter(l=>l.type()=="DROP_SHADOW"&&l.isVisibleForRendering()))==null?void 0:s.length)??0)>0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(!this._planNode.isEverVisible())return this._planNode.cachedSubtreeWillChange=!1,!1;if(this.willChange()!==0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(this._planNode.isDissolve||this._planNode.transition!=null&&(this._planNode.transition.hasTransitioningPaints()||this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()||this._planNode.transition.hasTransitioningEffects()))return this._planNode.cachedSubtreeWillChange=!0,!0;if(this.childCount()===0)return this._planNode.cachedSubtreeWillChange=!1,!1;for(let l=this.childCount()-1;l>=0;l=l-1){this.moveToChildAt(l);let c=this.subtreeWillChange();if(this.moveToParent(),c!=!1)return this._planNode.cachedSubtreeWillChange=!0,!0}return this._planNode.cachedSubtreeWillChange}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let e=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(e|=2),this._planNode.transition.hasTransitioningEffects()&&(e|=4),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(e|=1),this._planNode.scalesIndependentlyOfParent&&(e|=1),e}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(e){return e==null||e.equals(Ae.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.isDissolve}customRenderTree(e){var r,n,o,i;if(this._planNode.isDissolve){let a=this._planNode.indexInParent(),s=this._planNode.forDissolveStart1();(r=this._planNode.parent)==null||r.insertChildren(a,[s]);let l=ct.generateRenderTree(new t(s,this._getEasedT,this._easingFunction),e);(n=this._planNode.parent)==null||n.removeChild(a);let c=null;if(this._node!=null&&this._node.dependsOnBackgroundContent())c=ct.generateRenderTree(new gt(this._node),e);else{let u=this._planNode.forDissolveEnd1();(o=this._planNode.parent)==null||o.insertChildren(a,[u]),c=ct.generateRenderTree(new t(u,this._getEasedT,this._easingFunction),e),(i=this._planNode.parent)==null||i.removeChild(a)}let d=new Qn(l,c,Pt.forAnimateableDissolve(this._planNode.sceneNode().id()),this._getEasedT);return this._planNode.clearTransitionForDissolveRenderTrees(),this._planNode.invalidateCachedAbsoluteTransformsForSelf(),this._planNode.cachedSubtreeWillChange=!0,d}throw new Error("Unhandled customRenderTree case")}opacity(){return 32&this._planNode.enabledTraits?this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity():1}absoluteTransform(){return this._planNode.absoluteTransform1(this._getEasedT())}relativeTransform(){return this._sceneNodeCursor.relativeTransform()}maxTransformScale(){let e=this._planNode.transition;if(e==null)return 1;let r=e.from().scaling1(),o=e.to().scaling1().divide(r).minComponent();return Math.max(o,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let e=this._node!=null?this._node.parent():null;return new t(this._planNode.parent,e,this._getEasedT,this._easingFunction,this._overlayRenderData)}blendMode(){return 32&this._planNode.enabledTraits?this._sceneNodeCursor.blendMode():"PASS_THROUGH"}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.isVisibleMask():!1}isMask(){return this.isVisibleMask()||this._sceneNodeCursor.isMask()}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return 2&this._planNode.enabledTraits?this._sceneNodeCursor.clipsChildren():!1}stopsMaskPropagation(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.stopsMaskPropagation():!1}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._sceneNodeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._sceneNodeCursor.strokeJoin()}setStrokeJoin(e){this._sceneNodeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._sceneNodeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._sceneNodeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._sceneNodeCursor.id()}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}derivedTextData(){return this._sceneNodeCursor.derivedTextData()}arcData(){return this._sceneNodeCursor.arcData()}isRoundedRect(){return this._sceneNodeCursor.isRoundedRect()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}codeSnapshot(){return this._sceneNodeCursor.codeSnapshot()}fillGeometry(){if(16&this._planNode.enabledTraits){if(this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles())return this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds)}else return null;return this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.strokeGeometry():null}fillGeometryForSpread(e,r,n){return 16&this._planNode.enabledTraits&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(e,r,this._getEasedT,n,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(e,r,n)}strokeGeometryForSpread(e,r,n,o){return this._sceneNodeCursor.strokeGeometryForSpread(e,r,n,o)}textGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.textGeometry():null}getCachedRenderTree(){return null}getCachedBaseScreenRenderTree(){return null}renderTree(e=null){if(!this.subtreeWillChange()){let n=null;return this._sceneNodeCursor.node.getCachedRenderTreeForBaseScreen()!=null?n=this._sceneNodeCursor.node.renderTreeForBaseScreen1():n=this._sceneNodeCursor.renderTree(),this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(0,e);return ct.generateRenderTree(this.clone(),r)}renderTreeWithoutBackgroundBlursAndGlassEffects(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeWithoutBackgroundBlursAndGlassEffects(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(2,e);return ct.generateRenderTree(this.clone(),r)}renderTreeWithoutGlassEffects(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeWithoutGlassEffects(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(3,e);return ct.generateRenderTree(this.clone(),r)}renderTreeForShadowRoot(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeForShadowRoot(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(1,e,this.uniqueIdentifier());return ct.generateRenderTree(this.clone(),r)}renderTreeForShadowDescendant(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeForShadowDescendant(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(1,e);return ct.generateRenderTree(this.clone(),r)}renderTreeForKnockoutShadowRoot(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeForKnockoutShadowRoot(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(4,e,this.uniqueIdentifier());return ct.generateRenderTree(this.clone(),r)}renderTreeForKnockoutShadowDescendant(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeForKnockoutShadowDescendant(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(4,e);return ct.generateRenderTree(this.clone(),r)}renderTreeForSlideThumbnail(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeForSlideThumbnail(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(5,e);return ct.generateRenderTree(this.clone(),r)}renderTreeWithoutEffects(e=null){if(!this.subtreeWillChange()){let n=this._sceneNodeCursor.renderTreeWithoutEffects(e);return this.wrapNonAnimatingSubTreeWithPositionTransform(n)}let r=new or(6,e);return ct.generateRenderTree(this.clone(),r)}wrapNonAnimatingSubTreeWithPositionTransform(e){if(e==null)return null;if(this._planNode._oldSceneNode==null){let r=this._planNode._newSceneNode.absoluteTransform(),n=this.absoluteTransform().clone();return n=n.multipliedBy1(r.inverse()),new so(e,n)}else return new so(e,this._planNode._oldCanvasToRenderTreeTransform)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollOffset():Ae.FrozenVector_ZERO}scrollSpeedMultiplier(){return this._sceneNodeCursor.scrollSpeedMultiplier()}scrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollDirection():"NONE"}hasOverflowingContentInScrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.hasOverflowingContentInScrollDirection():!1}effects(){var r;if(this._planNode.isDissolve||!(64&this._planNode.enabledTraits))return[];let e=((r=this._planNode.transition)==null?void 0:r.effects2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.effects():e}transformModifiers(){return this._planNode.isDissolve||!(512&this._planNode.enabledTraits)?[]:this._sceneNodeCursor.transformModifiers()}fillPaints(){var r;if(!(4&this._planNode.enabledTraits))return Ce.EMPTY;if(this._planNode.forceMask)return[$.createSolid(N.BLACK,1)];let e=((r=this._planNode.transition)==null?void 0:r.fillPaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.fillPaints():e}strokePaints(){var r;if(!(8&this._planNode.enabledTraits))return Ce.EMPTY;let e=((r=this._planNode.transition)==null?void 0:r.strokePaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.strokePaints():e}textDecorationFillPaints(){var r;if(!(256&this._planNode.enabledTraits))return Ce.EMPTY;if(this._planNode.forceMask)return[$.createSolid(N.BLACK,1)];let e=((r=this._planNode.transition)==null?void 0:r.setTextDecorationPaints(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.textDecorationFillPaints():e}fillPaintsToRender(){return 4&this._planNode.enabledTraits?this._sceneNodeCursor.fillPaintsToRender():Ce.EMPTY}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}dependsOnBackgroundContent(){return this._sceneNodeCursor.dependsOnBackgroundContent()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}canvasSpaceContentBounds(){return this._planNode.canvasSpaceContentBounds()}blendModeEncodedNumber(){return this._bindingsConverter.blendModeEncodedNumber()}typeEncodedNumber(){return this._bindingsConverter.typeEncodedNumber()}fillGeometryBindingsRegions(){return this._bindingsConverter.fillGeometryBindingsRegions()}strokeGeometryBindingsRegions(){return this._bindingsConverter.strokeGeometryBindingsRegions()}childAtForBindings(e){return this._bindingsConverter.childAtForBindings(e)}parentForBindings(){return this._bindingsConverter.parentForBindings()}sizeVectorF(){return this._bindingsConverter.sizeVectorF()}maskTypeEncodedNumber(){return this._bindingsConverter.maskTypeEncodedNumber()}strokeAlignEncodedNumber(){return this._bindingsConverter.strokeAlignEncodedNumber()}absoluteTransformForBindings(){return this._bindingsConverter.absoluteTransformForBindings()}relativeTransformForBindings(){return this._bindingsConverter.relativeTransformForBindings()}absoluteBoundsRectD(){return this._bindingsConverter.absoluteBoundsRectD()}relativeBoundsRectD(){return this._bindingsConverter.relativeBoundsRectD()}canvasSpaceRenderedBoundsRectF(){return this._bindingsConverter.canvasSpaceRenderedBoundsRectF()}sceneNodeRenderTreeCacheKey(){return-1}};function YS(t){var i;if(t.fillGeometry()!=null&&((i=t.fillGeometry())==null?void 0:i.regions.length)!=0)return t.size();let e=t.size().x()<=.1,r=t.size().y()<=.1;if(e==r)return t.size();let n=Math.max(t.strokeWeight(),.1),o=F.new(t.size());return e?o.setX(n):o.setY(n),o}var ec=class t{constructor(){var e,r,n,o;if(this._bindingsConverter=new Wl(this),arguments.length==6){let i=arguments[0],a=arguments[2];if(this._stateGroupSwapInteractionCounts=arguments[3],this._ongoingObjectAnimation=arguments[4],this._objectAnimationProgressTracker=arguments[5],this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this._sceneCursor=null,this._planTrees=new Map,this.transitionMap=arguments[1],i.transitioningFrom!=null){let s=i.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=s;let l=this._getOrCreateSmartAnimatePlanTreeAt(i,s);if(l!=null){let c=(e=this.transitionMap.get(s))==null?void 0:e.progress,d=(r=this.transitionMap.get(s))==null?void 0:r.change.transitionParameters;if(d!=null&&c!=null){this._activeCursor=new Ta(l,i,c,d.easingFunction,a);return}}}if(i.animationFrom&&this._ongoingObjectAnimation!=null){if(this._ongoingObjectAnimation.change.objectAnimationTargetNode(i.scene())!=i)throw new Error("Ongoing object animation target node does not match node with animatingFrom set");let s=i.id();this._activeTransitionKey=s;let l=this._getOrCreateObjectAnimationPlanTree(i,s);if(l!=null){let c=()=>this._objectAnimationProgressTracker.progress(),d=this._ongoingObjectAnimation.change.transitionParameters;this._activeCursor=new Ta(l,i,c,d.easingFunction,a);return}}this._sceneCursor=new gt(i,a),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let i=arguments[0];this._sceneCursor=(n=i._sceneCursor)==null?void 0:n.clone(),this._planTrees=i._planTrees,i._activeCursor==i._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(o=i._activeCursor)==null?void 0:o.clone(),this._activeTransitionKey=i._activeTransitionKey,this._activeTransitionIndexInParent=i._activeTransitionIndexInParent,this.transitionMap=i.transitionMap,this._stateGroupSwapInteractionCounts=i._stateGroupSwapInteractionCounts,this._ongoingObjectAnimation=i._ongoingObjectAnimation,this._objectAnimationProgressTracker=i._objectAnimationProgressTracker}}clone(){return new t(this)}isBrushInstanceType(e){return this._activeCursor.isBrushInstanceType(e)}getStrokeBrush(){return this._activeCursor.getStrokeBrush()}getStrokeBrushCursor(){return this._activeCursor.getStrokeBrushCursor()}getScatterBrushInstanceTransforms(){return this._activeCursor.getScatterBrushInstanceTransforms()}hasScatterBrushInstanceTransforms(){return this._activeCursor.hasScatterBrushInstanceTransforms()}_getOrCreateSmartAnimatePlanTreeAt(e,r){var o;let n=(o=this.transitionMap.get(r))==null?void 0:o.change.transitionParameters;if(n!=null&&(n.transitionType=="SMART_ANIMATE"||Kn.supportsSmartAnimate(n.transitionType)&&n.transitionShouldSmartAnimate)){if(!this._planTrees.has(r)){let i=Ei.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(r,i)}return this._planTrees.get(r)??null}return null}_getOrCreateObjectAnimationPlanTree(e,r){if(this._planTrees.has(r))return this._planTrees.get(r)??null;if(!e.animatingFrom)throw new Error("Expected target node to have an animatingFrom node");let n=Ei.getMagicMovePlanForStateSwapTransition(e.animatingFrom,e);return this._planTrees.set(r,n),n}moveToChildAt(e){var r,n;if(this._activeTransitionKey==null&&this._sceneCursor!=null){let o=this._sceneCursor.node.childAt2(e,!0);if(o.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let i=o.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=i;let a=this._getOrCreateSmartAnimatePlanTreeAt(o,i);if(a!=null){let s=(r=this.transitionMap.get(i))==null?void 0:r.progress,l=(n=this.transitionMap.get(i))==null?void 0:n.change.transitionParameters;if(s!=null&&l!=null){this._sceneCursor.moveToChildAt(e),this._activeCursor=new Ta(a,o,s,l.easingFunction,this.overlayRenderData());return}}}else if(o.animatingFrom!=null&&this._ongoingObjectAnimation!=null){let i=o.id();this._activeTransitionKey=i,this._activeTransitionIndexInParent=e;let a=this._getOrCreateObjectAnimationPlanTree(o,this._activeTransitionKey);if(a!=null){let s=this._ongoingObjectAnimation.change.transitionParameters,l=()=>{let c=this._objectAnimationProgressTracker.progress();return s.easingFunction?s.easingFunction.get(c):c};this._sceneCursor.moveToChildAt(e),this._activeCursor=new Ta(a,o,l,s.easingFunction,this.overlayRenderData());return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){var r;this._activeCursor.isRoot()?((r=this._sceneCursor)==null||r.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?xr.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){var e;return`PlaybackCursor ${(e=this._sceneCursor)==null?void 0:e.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){var h,g;if(this._sceneCursor!=this._activeCursor||this._sceneCursor.node.transitioningFrom==null||this._activeTransitionKey==null)return this._activeCursor.customRenderTree(e);let r=(h=this.transitionMap.get(this._activeTransitionKey))==null?void 0:h.progress,n=(g=this.transitionMap.get(this._activeTransitionKey))==null?void 0:g.change;if(r==null||n==null)return this._activeCursor.customRenderTree(e);let o=n.transitionParameters,i=Zr.get(o==null?void 0:o.transitionType);n.direction==1&&(i=i.reversed());let a=this._sceneCursor.node,s=a.transitioningFrom.exitingTransitionRoot,l=m=>A=>mt.forTranslation(mt.forOpacity(A,Pt.forAnimateableOpacity(a.id()),()=>m.interpolateOpacity(r())),Pt.forAnimateableTranslation(a.id()),()=>u.multiply(m.interpolateTranslation(r()))),c=ct.generateRenderTree(new Qc(a,this.overlayRenderData(),l(i.enteringFrameTransition())),e),d=ct.generateRenderTree(new Qc(s,this.overlayRenderData(),l(i.exitingFrameTransition()),a,s),e),u=a.size().max(s.size()),p=null;c!=null&&(p=c),p!=null?(p=mt.forOpacity(p,Pt.forAnimateableOpacity(a.id()),()=>i.enteringFrameTransition().interpolateOpacity(r())),p=mt.forTranslation(p,Pt.forAnimateableTranslation(a.id()),()=>u.multiply(i.enteringFrameTransition().interpolateTranslation(r())))):p=new Le([]);let _=null;if(d!=null&&(_=d),_!=null?(_=mt.forOpacity(_,Pt.forAnimateableOpacity(s.id()),()=>i.exitingFrameTransition().interpolateOpacity(r())),_=mt.forTranslation(_,Pt.forAnimateableTranslation(s.id()),()=>u.multiply(i.exitingFrameTransition().interpolateTranslation(r())))):_=new Le([]),i!=null&&i.isDissolve()){let m=Pt.forAnimateableDissolve(a.id());return new Qn(_,p,m,r)}else return i!=null&&i.drawsEnteringFrameOnTopOfExitingFrame()?Le.wrap([_,p]):Le.wrap([p,_])}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}isMask(){return this._activeCursor.isMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}relativeTransform(){return this._activeCursor.relativeTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}isRoundedRect(){return this._activeCursor.isRoundedRect()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}codeSnapshot(){return this._activeCursor.codeSnapshot()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,r,n){return this._activeCursor.fillGeometryForSpread(e,r,n)}strokeGeometryForSpread(e,r,n,o){return this._activeCursor.strokeGeometryForSpread(e,r,n,o)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._activeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._activeCursor.strokeJoin()}setStrokeJoin(e){this._activeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._activeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._activeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}derivedTextData(){return this._activeCursor.derivedTextData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){var o,i,a;if(U.shouldPreventVolatileCaching())return!1;let e=(i=(o=this._sceneCursor)==null?void 0:o.node.canvas().parent())==null?void 0:i.scene(),r=(a=this._sceneCursor)==null?void 0:a.node;if(!r||!r.isInstance())return!1;let n=r.getBackingSymbolParent();return n==null||!n.isStateGroup()?!1:this._stateGroupSwapInteractionCounts.get(n.id(),0)>0}renderTree(e=null){if(this._sceneCursor==null){let r=new or(0,e);return ct.generateRenderTree(this.clone(),r)}else if(this._activeCursor==this._sceneCursor){let r=this._sceneCursor.node.renderTree2(this,e);return this._shouldPreemptivelyMarkAsVolatile()&&r!=null?mt.forStateSwap(r):r}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this,e);{let r=new or(0,e);return ct.generateRenderTree(this.clone(),r)}}}renderTreeWithoutBackgroundBlursAndGlassEffects(e=null){return this._activeCursor.renderTreeWithoutBackgroundBlursAndGlassEffects(e)}renderTreeWithoutGlassEffects(e=null){return this._activeCursor.renderTreeWithoutGlassEffects(e)}renderTreeWithoutEffects(e=null){return this._activeCursor.renderTreeWithoutEffects(e)}renderTreeForShadowRoot(e=null){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this,e);{let r=new or(1,e,this.uniqueIdentifier());return ct.generateRenderTree(this.clone(),r)}}renderTreeForShadowDescendant(e=null){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let r=new or(1,e);return ct.generateRenderTree(this.clone(),r)}}renderTreeForKnockoutShadowRoot(e=null){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let r=new or(4,e,this.uniqueIdentifier());return ct.generateRenderTree(this.clone(),r)}}renderTreeForKnockoutShadowDescendant(e=null){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let r=new or(4,e);return ct.generateRenderTree(this.clone(),r)}}renderTreeForSlideThumbnail(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForSlideThumbnail2(this);{let e=new or(5);return ct.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollSpeedMultiplier(){return this._activeCursor.scrollSpeedMultiplier()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}transformModifiers(){return this._activeCursor.transformModifiers()}fillPaints(){return this._activeCursor.fillPaints()}textDecorationFillPaints(){return this._activeCursor.textDecorationFillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return kr.getSemanticNodePathHelper(this)}dependsOnBackgroundContent(){return this._activeCursor.dependsOnBackgroundContent()}overlayRenderData(){return this._activeCursor.overlayRenderData()}canvasSpaceContentBounds(){return this._activeCursor.canvasSpaceContentBounds()}blendModeEncodedNumber(){return this._bindingsConverter.blendModeEncodedNumber()}typeEncodedNumber(){return this._bindingsConverter.typeEncodedNumber()}fillGeometryBindingsRegions(){return this._bindingsConverter.fillGeometryBindingsRegions()}strokeGeometryBindingsRegions(){return this._bindingsConverter.strokeGeometryBindingsRegions()}childAtForBindings(e){return this._bindingsConverter.childAtForBindings(e)}parentForBindings(){return this._bindingsConverter.parentForBindings()}sizeVectorF(){return this._bindingsConverter.sizeVectorF()}maskTypeEncodedNumber(){return this._bindingsConverter.maskTypeEncodedNumber()}strokeAlignEncodedNumber(){return this._bindingsConverter.strokeAlignEncodedNumber()}absoluteTransformForBindings(){return this._bindingsConverter.absoluteTransformForBindings()}relativeTransformForBindings(){return this._bindingsConverter.relativeTransformForBindings()}absoluteBoundsRectD(){return this._bindingsConverter.absoluteBoundsRectD()}relativeBoundsRectD(){return this._bindingsConverter.relativeBoundsRectD()}canvasSpaceRenderedBoundsRectF(){return this._bindingsConverter.canvasSpaceRenderedBoundsRectF()}sceneNodeRenderTreeCacheKey(){return-1}};var QS=class QS{static initialize(e){QS.safeModeOptions=e}};QS.safeModeOptions=null;var Bu=QS;var mN=class{constructor(e,r,n,o){this.key=e,this.value=r,this.prev=n,this.next=o,this.lastUsedGeneration=0}},Gu=class{constructor(e,r=null){this._nodeByKey=new Map;this._size=0;this._head=null;this._tail=null;this._generation=1;this._maxElements=e,this._afterEvict=r}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,r){let n=qe.StringMap_get(this._nodeByKey,e,null);return n==null?r:(this._moveElemToHead(n),n.value)}tailElement(){return this._tail.value}set(e,r){let n=qe.StringMap_get(this._nodeByKey,e,null);if(n!=null)this._moveElemToHead(n),n.value=r;else if(n=new mN(e,r,null,null),this._addElemAsHead(n),this._nodeByKey.set(e,n),this._size=this._size+1,this._size>this._maxElements){let o=this._tail.value,i=this._tail.key;this.remove(this._tail.key)}}remove(e){let r=qe.StringMap_get(this._nodeByKey,e,null);r!=null&&(this._nodeByKey.delete(r.key),this._removeFromList(r),this._size=this._size-1,this._afterEvict!=null&&this._afterEvict(r.key,r.value))}removeValue(e){let r=[];qe.StringMap_each(this._nodeByKey,(n,o)=>{o.value==e&&r.push(n)}),r.forEach(n=>{this.remove(n)})}makeLeastRecent(e){let r=qe.StringMap_get(this._nodeByKey,e,null);r!=null&&(this._removeFromList(r),this._addElemAsTail(r))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let r=e.prev,n=e.next;r!=null&&(r.next=n),n!=null&&(n.prev=r),e==this._tail&&(this._tail=r),e==this._head&&(this._head=n),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var Sh=class Sh{constructor(e,r,n,o){this.textureSize=e;this.baseTileSize=r;this.numInitialTextures=n;this.maxNumTextures=o;this._CACHED_SUPERSAMPLE_COUNT=null;this.tileAtlasTilesPerSide=this.textureSize/this.baseTileSize|0;this.numInitialTileAtlasTiles=this.numInitialTextures()*this.tileAtlasTilesPerSide*this.tileAtlasTilesPerSide;this.maxNumTileAtlasTiles=this.maxNumTextures()<Number.POSITIVE_INFINITY?this.maxNumTextures()*this.tileAtlasTilesPerSide*this.tileAtlasTilesPerSide:Number.POSITIVE_INFINITY}static fromTargetMaxMemoryUsage(e,r,n,o,i){let a=Math.max(Math.ceil(i*1024*1024/(e*e*n)),1);return new Sh(e,r,o,()=>a)}SUPERSAMPLE_COUNT(){return this._CACHED_SUPERSAMPLE_COUNT==null&&(this._CACHED_SUPERSAMPLE_COUNT=U.useSSAA()?4:2),this._CACHED_SUPERSAMPLE_COUNT}SSAA_SIZE(){return this.baseTileSize*this.SUPERSAMPLE_COUNT()}DRAW_TO_SCREEN_LARGE_TILE_SIZE(){return this.SSAA_SIZE()}};Sh.DEFAULT_TARGET_MEMORY_USAGE_IN_MB=384,Sh.DEFAULT_TILE_SIZE=512;var Ii=Sh,tl=class{_createNewTexture(){let e=this._context.createTexture(Fe.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._config.textureSize,this._config.textureSize,fr.TILE_ATLAS),r=this._context.createFramebuffer(e,null,"Tile Atlas");this._tileCacheFramebuffers.push(r)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(U.shouldApplyMobileOptimizations()&&Bt.getFeatureGate("viewer_atlas_cap_capacity")&&!this.canAllocateTextureForCurrentFrame()?console.warn("cannot allocate a new texture in the atlas to handle demand for current frame"):(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._config.tileAtlasTilesPerSide*this._config.tileAtlasTilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame")));let r=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement():this._tilesLRU.count();return this._tilesLRU.set(e,r),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}capacityUsedForCurrentFrame(){return this._tilesLRU.capacityUsedForGeneration()}canAllocateTileForCurrentFrame(){return!this._tilesLRU.atMaximumCapacity()||this.canAllocateTextureForCurrentFrame()}canAllocateTextureForCurrentFrame(){return this._tileCacheFramebuffers.length<this._config.maxNumTextures()}totalVRAM(){let e=0;for(let r of this._tileCacheFramebuffers)e=e+$n.Texture_totalVRAM(r.colorTexture());return e}tileIsStillValid(e){return this._tilesLRU._in(e)}framebufferForTile(e){let r=this._tilesLRU.get1(e);return this._tileCacheFramebuffers[r/(this._config.tileAtlasTilesPerSide*this._config.tileAtlasTilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}viewportForTile(e,r){let n=this._tilesLRU.get1(e),o=Ut.int_remainder(n,this._config.tileAtlasTilesPerSide),i=Ut.int_remainder(n/this._config.tileAtlasTilesPerSide|0,this._config.tileAtlasTilesPerSide),a=this._config.baseTileSize;r.setTo1(o*a,i*a,a,a)}tileSize(){return this._config.baseTileSize}textureSize(){return this._config.textureSize}drawToScreenLargeTileSize(){return this._config.DRAW_TO_SCREEN_LARGE_TILE_SIZE()}clearCache(){let r=this._tileCacheFramebuffers.length*this._config.tileAtlasTilesPerSide*this._config.tileAtlasTilesPerSide;this._tilesLRU=new Gu(r,this._afterEvictOrNull)}constructor(e,r,n){this._config=n,this._tileIdCounter=0,this._tileCacheFramebuffers=[],this._afterEvictOrNull=r,this._tilesLRU=new Gu(this._config.numInitialTileAtlasTiles,this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let o=0,i=this._config.numInitialTextures();o<i;o=o+1)this._createNewTexture()}};tl.PRE_RENDERING_MULIPLIER=U.shouldApplyMobileOptimizations()?16:64;var Zn=class t{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Ze.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=t.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():t.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==t.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==t.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,r,n){this._progressAtStart=e,this._durationSeconds=r,this._progressType=n?t.ProgressType.REVERSE:t.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Ze.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,r){this._externalOnTickProgress=e,this._externalOnTransitionEnded=r,this._progressType=t.ProgressType.EXTERNAL,this._timeOfTransitionStart=Ze.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=Ze.seconds(),r=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*r),r=Math.min(r,1/30),this._elapsedSeconds+=r,this._timeOfLastTransitionFrame=e;let n=this._progressType==t.ProgressType.REVERSE?-1:1;this._lastProgress=Fr.Math_clamp(n*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==t.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=t.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(r=>{let t;(a=>(a[a.FORWARD=0]="FORWARD",a[a.REVERSE=1]="REVERSE",a[a.EXTERNAL=2]="EXTERNAL"))(t=r.ProgressType||(r.ProgressType={}));let e;(i=>(i[i.ABORT=0]="ABORT",i[i.COMMIT=1]="COMMIT"))(e=r.TransitionEndedAction||(r.TransitionEndedAction={}))})(Zn||(Zn={}));var id;(r=>{function t(n,o){n(o)}r.applyTo=t;function e(n){return n}r._new=e})(id||(id={}));var qS=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,r,n){let o=r.interactionAddress.hotspotStablePath!=null?e.findNodeByStablePath(r.interactionAddress.hotspotStablePath):null;if(o==null)return null;switch(r.cause){case 5:{if(!n&&lt.getControlSource(r.cause)!=0){let i=Lr.computeDragVector2(r,o,e);if(i!=null&&i.length()>0)return id._new(a=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new Lr(this,i,a,r.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,r,n){switch(r.cause){case 5:{if(!n&&lt.getControlSource(r.cause)!=0){let o=Lr.computeDragVectorForStateSwap(r,e);if(o!=null&&o.length()>0)return id._new(i=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new Lr(this,o,i,r.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},Ts=class Ts{static computeOverlaySwipeDragVector(e,r,n){let o=n.size(),i=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return o.multiply(i.to().translation1().subtract(i.from().translation1()))}static computeScreenSwipeDragVector(e,r,n){let o=r.size().max(n.size()),i=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return o.multiply(i.to().translation1().subtract(i.from().translation1()))}static computeSmartAnimateDragVector(e,r,n){if(r!=null&&n!=null&&e!=null){let o=Ei.getNodeMatches(r,n),i=qe.StringMap_get(o,e.id(),null);if(i!=null){let a=r.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divideScalar(2));return n.absoluteTransform().inverse().multipliedBy1(i.absoluteTransform()).transformPoint(i.size().divideScalar(2)).subtract(a)}}return null}static computeDragVectorImpl(e,r,n,o,i,a,s){if(e==null)return null;if(r!=null&&n!=null){if(i=="SMART_ANIMATE"||Kn.supportsSmartAnimate(i)&&s){let d=Ts.computeSmartAnimateDragVector(e,r,n);if(d!=null&&d.length()>0)return d}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(i)==-1){let d=Zr.get(i);o==1&&(d=d.reversed());let u=null;if(["OVERLAY","SWAP"].indexOf(a)!=-1?u=Ts.computeOverlaySwipeDragVector(d,r,n):u=Ts.computeScreenSwipeDragVector(d,r,n),u.length()>0)return u}}return null}static computeDragVector1(e,r,n,o,i){if(e==null||r==null)return null;let a=null;for(let h of r.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(h.connectionType())!=-1){a=h;break}if(a==null)return null;let s=a.connectionType(),l=null,c=null,d=a.transitionShouldSmartAnimate(),u=0,p=n,_=null;if(s=="INTERNAL_NODE")if(c=a.navigationType(),l=a.transitionType(),c=="SWAP_STATE"){let h=dr.whichInstanceToSwap(e,a.transitionNodeID());h!=null&&(p=h,_=e.scene().findNode(a.transitionNodeID()))}else c=="SWAP"&&(p=e.topLevelAncestor()),_=o.getDestinationFrame(a.transitionNodeID());else if(s=="BACK"){let h=i.getPreviousNonTransientChange();if(h==null)return null;_=o.getDestinationFrame(h.oldStateId()),l=h.transitionParameters.transitionType,c="NAVIGATE",u=1}else if(s=="CLOSE"){_=e.topLevelAncestor();let h=i.getOpenOverlayData(_.id());if(h==null)return null;l=h.openingTransitionType(),c="OVERLAY",u=1}return Ts.computeDragVectorImpl(e,p,_,u,l,c,d)}static computeDragVector2(e,r,n){let o=null,i=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let s=e.oldOverlayData()[e.oldOverlayData().length-1],l=e.newOverlayData()[e.newOverlayData().length-1];o=n.findNode(s.id),i=n.findNode(l.id)}else if(o=n.findNode(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let s=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();i=n.findNode(s[0])}else i=n.findNode(e.newStateId());return Ts.computeDragVectorImpl(r,o,i,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,r){var a,s;let n=r.findNodeByStablePath(e.stablePath),o=(a=n==null?void 0:n.transitioningFrom)==null?void 0:a.exitingTransitionRoot,i=(s=n==null?void 0:n.transitioningFrom)==null?void 0:s.hotspotInExitingTree;return Ts.computeDragVectorImpl(i,o,n,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,r,n,o){var i;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=Ze.seconds(),this._behaviorManager=e,this._dragVector=r,this._easingFunction=o,this._transitionProgress=n,(i=this._transitionProgress)==null||i.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=Ze.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let r=this._transitionProgress.progress(),n=this._easingFunction!=null?this._easingFunction.invert(r):r,o=this.signedDragSpeed(),i=this._transitionProgress.duration(),a=i>0?Ts.DRAG_SPEED_THRESHOLD_MULTIPLE/i:0,s=o>=a,l=o<=-a;this._shouldRevertTransition=!1,r>=.5?this._shouldRevertTransition=l:this._shouldRevertTransition=!s;let c=1;if(this._shouldRevertTransition&&(c=Fr.Math_clamp(Math.log(n+.5)/Math.log(2)+1,.02,1)),Math.abs(o)>=1/i){let d=this._easingFunction!=null?this._easingFunction.getDerivative(n,o):1;c=Math.abs(o/d)}this._transitionProgress.pinProgressToRealTimeWithDuration(n,i/c,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let n=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,n=Ze.seconds(),this._currPointerTime=n),this._pointerVelocity=this._currPointerPosition.subtract(this._lastPointerPosition).divideScalar(n-this._lastPointerTime)}let e=this._currPointerPosition.subtract(this._dragStartPosition),r=Fr.Math_clamp(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,r}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?Zn.TransitionEndedAction.ABORT:Zn.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}};Ts.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var Lr=Ts;var Uu=Ja(hd());var Ah=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=r=>{e(r)}}setOnerror(e){this.ws.onerror=r=>{e(r)}}setOnmessage(e){this.ws.onmessage=r=>{e(new gN(r))}}setOnopen(e){this.ws.onopen=r=>{e(r)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var r;return this.ws==((r=e==null?void 0:e.asHTMLSocket())==null?void 0:r.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},XS=class XS{simulateDidOpen(){if(this._readyState=Ri.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=Ri.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return XS.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=Ri.Socket_CLOSING}send1(e){if(this._readyState!=Ri.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e))}send2(e){if(this._readyState!=Ri.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=Ri.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}};XS.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var fN=XS;var gN=class{isArrayBuffer(){return this.messageEvent.data[Symbol.toStringTag]==="ArrayBuffer"}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},Ri;(o=>(o.Socket_CONNECTING=0,o.Socket_OPEN=1,o.Socket_CLOSING=2,o.Socket_CLOSED=3))(Ri||(Ri={}));var nn;(n=>{function t(o,i){let a={};return a.startingNode=X.toFigGUID(o),a.depth=i,a}n.create=t;function e(o){if(o==null)return"";let i="";for(let a of o)i+=Ln.serializeForMultiplayerURL(a),i+=",";return i.slice(0,i.length-1)}n.serializeListForMultiplayerURL=e;function r(o){return o.startingNode.localID==0&&o.startingNode.sessionID==0&&o.depth==0}n.isUnlimitedRootQuery=r})(nn||(nn={}));var zr=class zr{static logVerbose(e){zr.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return 2}constructor(e,r){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._currentQueries=new rl,this._previousSceneGraphReply=new rl,this._rootLevelSceneGraphQuery=nn.create(X._new(0,0),1),this._requestedTlfIds=new So,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._bfsOrderWorkingSet=[],this._pendingNodeToRequest=null,this._multiplayer=r,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=Xt.getEventEmitter(),this._emitter.on("slowIncrementalLoad",n=>{Re.trackEvent("Slow incremental load",n)})}dangerouslySetLoadFullDocument(e){this._setLoadFullDocument(e)}setLoadFullDocumentForTests(e){this._setLoadFullDocument(e)}_setLoadFullDocument(e){e?this._rootLevelSceneGraphQuery=nn.create(X._new(0,0),0):this._rootLevelSceneGraphQuery=nn.create(X._new(0,0),1)}simulateRepliedQueriesForTests(e){this._currentQueries=rl.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(e),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let r of e){if(this._isFullyLoaded(r)){this._appState.requestedFrameMetricsTracker().track(r,{wasAlreadyLoaded:!0,wasAlreadyInWorkingSet:!0});continue}else{let n={wasAlreadyLoaded:!1,wasAlreadyInWorkingSet:!1};for(let o of this._bfsOrderWorkingSet)if(o.nodeId==r){n.wasAlreadyInWorkingSet=!0;break}this._appState.requestedFrameMetricsTracker().track(r,n)}this._requestedTlfIds.add(r),this._redeferUpdate(0)}}_isFullyLoaded(e){var o;let r=(o=this._multiplayer.scene())==null?void 0:o.findNode(e);if(r==null)return!1;let n=r;for(;n!=null;){if(this._previousSceneGraphReply.containsExactQuery(nn.create(n.id(),0)))return!0;n=n.parent()}return!1}_isQueryPresent(e,r){for(let n of r)if(Ln.equals(n,e))return!0;return!1}_getQueriesToLoad(){let e=new rl;return this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_addRequestedTlfs(e){var r;zr.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().join(","));for(let n of this._requestedTlfIds.asList()){let o=X.fromString(n);if(o==null)continue;if(!this._previousSceneGraphReply.containsNodeById(o)){e.add(nn.create(o,1));continue}let a=(r=this._multiplayer.scene())==null?void 0:r.findNode(o);if(this._requestedTlfIds.remove(o),a==null){let s=X._new(0,0);e.add(nn.create(s,1)),this._requestedTlfIds.add(s);let l=this._multiplayer.scene().firstUserCanvasOrNull();if(l==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(l.id()),e.add(nn.create(l.id(),1))}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode");let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(s.id()),e.add(nn.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(s==null)continue;this._requestedTlfIds.add(s.id()),e.add(nn.create(s.id(),0)),this._setCurrentTlfIds([s.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add(nn.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add(nn.create(this._canvas.id(),1)))}}}_addScreenAdjacencies(e){U.getViewerMode()==U.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().isLinear()&&this._addScreenAdjacenciesForLinearPrototype(e),this._addScreenAdjacenciesForPrototype(e)}_getMaxBFSDistance(){return jt.isCurrentOSMobileOrIPad()?zr.MOBILE_MAX_PROTOTYPE_BFS_DEPTH:zr.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH}_getMaxBFSCount(){return jt.isCurrentOSMobileOrIPad()?zr.MOBILE_MAX_PROTOTYPE_BFS_COUNT:zr.DEFAULT_MAX_PROTOTYPE_BFS_COUNT}_addScreenAdjacenciesForLinearPrototype(e){let r=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(!this._currentTlfIds.length||!X.isValid(this._currentTlfIds[0]))return;let n=r.indexOf(this._currentTlfIds[0]);if(!(n<0)){for(let o=n-zr.MAX_SLIDESHOW_PRELOAD_DISTANCE(),i=n+zr.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<i;o=o+1)o>=0&&o<r.length&&e.add(nn.create(r[o],0));if(this._currentTlfIds.length>1)for(let o=1,i=this._currentTlfIds.length;o<i;o=o+1)X.isValid(this._currentTlfIds[o])&&e.add(nn.create(this._currentTlfIds[o],0))}}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!X.isValid(this._currentTlfIds[0]))return;let r=new zr.Queue;for(let l=this._currentTlfIds.length-1;l>=0;l=l-1)r.pushBackIfUnseen(this._currentTlfIds[l],0);let n=0;this._bfsOrderWorkingSet=[];let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;r.nonempty()&&(r.front().depth<=1||n<this._getMaxBFSCount());){let l=r.popFront(),c=l.guid,d=this._previousSceneGraphReply.containsExactQuery(nn.create(c,0));this._bfsOrderWorkingSet.push(new zr.WorkingSetItem(c,d));let u=this._appState.scene().findNode(c);if(u==null||(l.depth>0&&(n=n+1),l.depth>=this._getMaxBFSDistance()))continue;let p=An.adjacentBaseScreens(o,u);no(u,_=>{var h;if(_.isInstance()&&!_.isPrimaryInstance()&&_.getBoundVariables().componentProperties){let g=this._appState.scene().findNode(_.symbolID());if(g!=null){let m=g.parent();m.isStateGroup()&&(p.add(m.id()),_.invalidateRenderTreeForSelfAndParents(),_.invalidateRenderTreeForChildren())}}(h=_.prototypeInteractions())==null||h.forEach(g=>{for(let m of g.allActions())if(X.isValid(m.transitionNodeID())&&p.add(m.transitionNodeID()),m.connectionType()=="BACK"){let A=this._appState.prototypeState().getLastChangeInHistory();A!=null&&A.getRemovedFrameIds().forEach(S=>{S!=null&&p.add(S)})}}),U.getFeatureFlags().viewer_ifl_enhancements&&An.isNodeInteractableBecauseOfHyperlinks(_)&&_.textHyperlinkBoxes().forEach(g=>{g.guid&&p.add(X.fromFigGUID(g.guid))})});for(let _ of p.asList())r.pushBackIfUnseen(_,l.depth+1)}Re.trackDefinedEvent("prototype.ifl_nodes_loaded_count",{nodesLoadedCount:n,enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});let i=this._appState.prototypeState().getInitiatedChange();if(i!=null)for(let l of i.oldStateAndOverlays.statesAndOverlaysIncluded()){let c=X.fromString(l);this._bfsOrderWorkingSet.unshift(new zr.WorkingSetItem(c,this._previousSceneGraphReply.containsExactQuery(nn.create(c,0))))}dn.trackNumber("[IFL] Working set size",this._bfsOrderWorkingSet.length);let a=0,s=0;for(let l of this._bfsOrderWorkingSet)if(e.add(nn.create(l.nodeId,0)),l.isAlreadySubscribed?s=s+1:a=a+1,a>=zr.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;dn.trackNumber("[IFL] Working set frames loaded",s)}getMetricsForNode(e){return this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.id())}_requestNextQueriesToLoad(e){var n;if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;U.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&(this._currentQueries.each(i=>{let a=this._multiplayer.scene().findNode(Tl.toString(i.startingNode));a!=null&&(a.type()=="DOCUMENT"||a.type()=="CANVAS")&&e.add(i)}),((n=v())==null?void 0:n.getChangedVariables()).forEach(i=>{e.add(nn.create(i,0))})),this._currentQueries=e):e.each(o=>{this._currentQueries.add(o)});let r=[];for(let o of this._currentQueries.asList())r.push(o);zr.logVerbose(()=>"setting scene graph queries:"+r.map(o=>Ln.toString(o)).join(",")),this._multiplayer.setSceneGraphQueries(r)}_redeferUpdate(e){this._deferredUpdate!==void 0?this._deferredUpdate.redefer(e):this._deferredUpdate=new Th(()=>{zr.logVerbose(()=>`update............
`+(zr.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdate=void 0},e)}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,r){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,r){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,r){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let r=e.newStateAndOverlays.statesAndOverlaysIncluded(),n=[];for(let o of r)n.push(X.fromString(o));this._requestTlfs(n)}handleFitModeChange(e,r){}handleRestartPrototype(){}handleConnect(e,r){e==0&&(this._previousSceneGraphReply=new rl,this._currentQueries=new rl,this._redeferUpdate(0),U.getViewerMode()==U.ViewerMode.PROTOTYPE&&r==null&&(r=X._new(0,0)),r!=null&&(this._pendingNodeToRequest=r))}handleDisconnect(){}handleJoinStart(e,r,n){this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,r){}handleSceneGraphReply(e,r){Re.handleMultiplayerFirstResponse(),zr.logVerbose(()=>{let a="";return a+=`
-----handleSceneGraphReply-----
`,a+="sceneGraphQueries:"+r.map(s=>Ln.toString(s)).join(",")+`
`,zr.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(a+=this._multiplayer.scene().root().hierarchyString()+`
`),a+="-----------------------------------",a}),this._previousSceneGraphReply=rl.fromList(r);let n=this._getQueriesToLoad(),o=r.some(a=>nn.isUnlimitedRootQuery(a));n.isSubsetOf(this._previousSceneGraphReply)||o?(Re.handleMultiplayerIFLSatisfied(),zr.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),Re.handleIFLCompleted()):this._requestNextQueriesToLoad(n)}handleSceneGraphEvent(e){if(xo.isPrototypeStructuralChange(e.property)){if(this._deferredUpdate!=null&&this._deferredUpdate.delayMs==0)return;this._redeferUpdate(en||Uo?0:250)}}};zr.VERBOSE_LOGS=!1,zr.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,zr.MOBILE_MAX_PROTOTYPE_BFS_DEPTH=2,zr.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH=8,zr.MOBILE_MAX_PROTOTYPE_BFS_COUNT=4,zr.DEFAULT_MAX_PROTOTYPE_BFS_COUNT=64,zr.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;var tc=zr;(n=>{class t{constructor(i,a){this.guid=i,this.depth=a}}n.Entry=t;class e{constructor(i,a){this.nodeId=i,this.isAlreadySubscribed=a}}n.WorkingSetItem=e;class r{nonempty(){return this._queue.length>0}pushBackIfUnseen(i,a){this._seen.has(i)||(this._seen.set(i,!0),this._queue.push(new n.Entry(i,a)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}n.Queue=r})(tc||(tc={}));var rl=class t{add(e){let r=Ln.nodeIdString(e);if(!this._hash.has(r))this._hash.set(r,e);else{let n=this._hash.get(r);if(n.depth==0)return;(e.depth==0||e.depth>n.depth)&&this._hash.set(r,e)}}containsNodeById(e){return e!=null&&this._hash.has(e)}containsExactQuery(e){return this.containsNodeById(X.fromFigGUID(e.startingNode))?this._hash.get(Ln.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(Ln.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let r of Array.from(this._hash.values()))if(!e.containsExactQuery(r))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let r of Array.from(this._hash.values()))if(!e.containsExactQuery(r))return!1;return!0}toJSObject(){return qe.StringMap_toJSObject(this._hash)}static fromList(e){let r=new t;for(let n of e)r.add(n);return r}constructor(){this._hash=new Map}},yi=class yi{constructor(e,r){this.complete=()=>{var r;let e=this._executionTime-Date.now();e<=0||!1?((r=this.callback)==null||r.call(this),this.callback=null):this._timeoutID=yi._setTimeout(this.complete,e)};this.delayMs=r,this.callback=e,this._timeoutID=yi._setTimeout(this.complete,r),this._executionTime=Date.now()+r}redefer(e){this._executionTime=Date.now()+e}cancel(){this.callback=null,yi._clearTimeout(this._timeoutID)}static _setTimeout(e,r){if(!1){let n=(yi._nextMockTimeoutID=yi._nextMockTimeoutID+1)+-1;return yi._mockTimeouts.set(n,e),n}else return x1()?(Promise.resolve().then(e),0):setTimeout(e,r)}static _clearTimeout(e){clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(yi._mockTimeouts.keys());for(let r of e)yi._mockTimeouts.get(r)(),yi._mockTimeouts.delete(r)}};yi._nextMockTimeoutID=1,yi._mockTimeouts=new Map;var Th=yi;var SN=class{constructor(e,r){this.nodeId=e,this.offset=r}},jS=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new Ah(0,mpGlobal.sock):null}setSock(e){if(e!=null){let r=e.asHTMLSocket();if(r==null){console.warn("Ignoring invalid socket binding for mpGlobal");return}mpGlobal.sock=r.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new Ah(1,e)}constructor(){}},AN=class t{static attemptToParseFrom(e){try{let r=JSON.parse(e);return new t(r.url,r.type)}catch{xe("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,r){this.url=e,this.type=r}},TN=class{static attemptToParseFrom(e){try{let r=JSON.parse(e);return{enforcePrototypeSecurityBoundaries:r.enforcePrototypeSecurityBoundaries,docNotInitiallyDecoded:r.docNotInitiallyDecoded,incremental:r.incremental,numMultiplayerConnections:r.numMultiplayerConnections}}catch{xe("Failed to parse ServerSideLoadTimeMetadata")}return null}};var Un=class Un{static hasPrefix(e,r){if(e.length>=r.length){for(let n=0,o=r.length;n<o;n=n+1)if(e[n]!=r.charCodeAt(n))return!1;return!0}return!1}constructor(e,r,n){this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._nodeId=null,this._partialSnapshotInfo=new ZS(null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._observingStableSessionID=null,this._presenterSessionID=null,this._presenterReconnectKey=null,this._presenterIsReconnected=!1,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new bn,this._messageObservers=new bn,this._sceneLoadingPhase=On.PENDING_INITIAL_LOAD,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=r,this._emitter=Xt.getEventEmitter(),this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._wasBackgrounded=!1,this._mpContext=n,this._incrementalLoader=new tc(this._appState,this),this._flushQueueWhenAvailable=!1,this._localUserChangesHandler=null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}addMultiplayerMessageObserver(e){this._messageObservers.add(e)}removeMultiplayerMessageObserver(e){this._messageObservers.remove(e)}addLocalUserChangesHandler(e){this._localUserChangesHandler=e}removeLocalUserChangesHandler(){this._localUserChangesHandler=null}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}presenterIsReconnected(){return this._presenterIsReconnected}_trackObservationEvent(e,r){var a,s,l,c,d;if(e===null||r===null)return;let n=(s=(a=this._userSyncing)==null?void 0:a.getUserBySessionID(r))==null?void 0:s.userID,o=this._presenterSessionID?(c=(l=this._userSyncing)==null?void 0:l.getUserBySessionID(this._presenterSessionID.value))==null?void 0:c.userID:null,i={source:"viewer",multiplayer_session_id:this._sessionID,is_following_presenter:r===((d=this._presenterSessionID)==null?void 0:d.value),multiplayer_observing_session_id:r===-1?e:r,user_id:n,presenter_user_id:o,stable_session_id:this._observingStableSessionID};r===-1?Re.trackEvent("file_observation_ended",i):Re.trackEvent("file_observation_started",i)}setObservingSessionID(e){var o;this._startGlobalOpsTimer("start_following");let r=this._observingSessionID;this._observingSessionID=e,this._trackObservationEvent(r,this._observingSessionID),this._getOrCreateNextUserChange().observing=[e];let n=(o=this._userSyncing)==null?void 0:o.getUserBySessionID(e);n?this._observingStableSessionID=n.stableSessionID:this._observingStableSessionID=null}handleConnectedUser(e,r){if(!r){Re.trackEvent("slides.handle_connected_user.no_stable_session_id",{}),Nn.loge("MultiplayerSession","no stable session ID in handleConnectedUser",{sessionID:e,observingSessionID:this._observingSessionID},{reportAsSentryError:!0,logToConsole:0});return}!U.getFeatureFlags().slides_observing_user_reconnect||!(this._observingStableSessionID===r)||(this._observingSessionID=e,Re.trackEvent("slides.following_auto_resumed",{sessionID:e,observingSessionId:this._observingSessionID}),this._getOrCreateNextUserChange().observing=[e])}observedUser(){return this._userSyncing!=null?nr.IntMap_get(this._userSyncing.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}isPresenterSession(){return this._presenterSessionID&&this._presenterSessionID.value===this._sessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}nodeId(){return this._nodeId}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var e;return(e=this._socket)==null?void 0:e.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}hasMultiplayerUserSyncing(){return this._userSyncing!=null}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let r=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,r!=e&&this._observers.forEach(n=>{n.handleSceneChangedLoadingPhase(r,e)}),e){case On.PENDING_INITIAL_LOAD:break;case On.PENDING_LOAD_AFTER_RECONNECT:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting");break}case On.LOADED:{r==On.PENDING_INITIAL_LOAD?this._appState.fontListPromise().then(()=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad")}):r==On.PENDING_LOAD_AFTER_RECONNECT&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting")),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(Xs.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(r=>{r.type()!="CANVAS"||r.isInternalOnly()||(e==null||e.some(n=>Ln.fullyLoadsNode(n,r)))&&r.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var o,i,a;let r=0,n=0;Un.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((o=this.scene())==null?void 0:o.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(r=r+1)})})),this.scene().setTlfsLoaded(s=>e==null||e.some(l=>Ln.fullyLoadsNode(l,s))),Un.VERBOSE&&(((i=this.scene())==null?void 0:i.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(n=n+1)})}),console.log(`\u{1F69A} numLoaded ${n-r} (${r} -> ${n})`),console.log("--------------------------------------------")),(a=v())==null||a.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){this._sceneLoadingPhase!=On.LOADED&&(this._appState.setCurrentFileKey(this._fileKey),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="Multiplayer._finishLoadingIfNecessary",this._appState.setScene(this._scene),this._appState.prototypeState().navigateToFrameAndCloseOverlaysOrRestart(this._nodeId,"Multiplayer._finishLoadingIfNecessary"),this._setSceneLoadingPhase(On.LOADED))}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,r){this._connectTo(e,0,r)}attemptReconnect(){var r;if(this._scene==null||this._sceneLoadingPhase==On.PENDING_INITIAL_LOAD){this._scene!=null&&this._sceneLoadingPhase==On.PENDING_INITIAL_LOAD&&Re.trackEvent("Viewer reconnected during initial load",{}),this._connectTo(this._fileKey,0,this._nodeId);return}let e=this._appState.baseScreenId()??((r=this._appState.getActiveCanvas())==null?void 0:r.id());this._connectTo(this._fileKey,1,e)}_connectTo(e,r,n){this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,Re.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=r,this._nodeId=n,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let o="";switch(r){case 0:{o="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new ZS(null,null);break}case 1:{o="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let i=this._mpContext.url({fileKey:e,role:this._role,connectionType:o,canvasQuerySkipContainers:!0}),a=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);if(this._scene!=null&&a){this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(i+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`);let _=encodeURIComponent(nn.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull));i+=`&scenegraph-queries=${_}`,this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,0),this._pendingSceneGraphQueriesOrNull=null}this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),i+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=i,console.debug(`attempting to connect to ${i}`);let s=this._mpContext.sock(),l=this._mpContext.msgs();if(s!=null&&s.url()==i&&(s.readyState()==Ri.Socket_CONNECTING||s.readyState()==Ri.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${i}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(s!=null){console.warn(`Preconnect URL ${s.url()} doesn't match URL ${i}, skipping preconnect optimization`),Re.trackDefinedEvent("prototype.multiplayer_preconnect_failed",{role:this._role,socketUrl:s.url(),generatedUrl:i});try{s.close()}catch{}}s=this._mpContext.newSocket(i),s.setBinaryType("arraybuffer"),l=[]}let c=()=>this._socket==null?s==null:this._socket.equals(s),d=!0,u=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),Re.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(_=>{_.handleConnect(r,n)})};s.setOnopen(_=>{if(!c()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,u()});let p=_=>{let h=v();if(d){if(d=!1,!h.modules().prototype.handleServerSchema(_)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(U.getFeatureFlags()))}else h.modules().prototype.handleCompressedMultiplayerMessage(_,this.sessionID(),en,!1)};s.setOnmessage(_=>{if(!c()){console.warn("ignoring 'message' event on old socket");return}if(!_.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let h=new Uint8Array(_.dataAsArrayBuffer());p(h)}),s.setOnclose(_=>{if(!c()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?Re.handleMultiplayerSocketDisconnected(this._isWindowActive()):Re.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let h=null,g=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&(Tr.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():h()};h=()=>{let m=Math.min(Un.RECONNECTION_DELAY_MAX,Un.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),A=Un.RECONNECTION_DELAY_MIN+(m-Un.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${A}s`),this._reconnectionTimeout=setTimeout(g,A*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,g())},Tr.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},h(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=s,s.readyState()==Ri.Socket_OPEN&&u(),l.forEach(p)}_decodeConcatenatedUncompressedMessages(e,r){let n=new Uu.ByteBuffer(e);for(;n.length!==n._index;){let o;try{o=this._sessionSchema.decodeMessage(n)}catch(i){console.error(`decoding failed: '${i.message}'`);return}Un.VERBOSE&&console.log(`got message of type '${o.type}'`),r(o)}}handleUncompressedMessage(e,r){this._decodeConcatenatedUncompressedMessages(e,n=>{var o;switch(n.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(n,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(n);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::willReceiveNodeChanges/PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(n,this,r,this._localUserChangesHandler),(o=this._localUserChangesHandler)==null||o.maybeForceUpdateOnUserChange();break}case"SIGNAL":{this._handleSignal(n);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(n);break}}})}shouldAutoResumePresenting(){return U.getFeatureFlags().slides_spotlight_smart_refollow?this._presenterReconnectKey!=null&&this._presenterReconnectKey===this._reconnectKey:!1}_startGlobalOpsTimer(e){var r,n;(n=(r=window.FIGMA_opsTimer)==null?void 0:r.start)==null||n.call(r,e)}handleUncompressedSchema(e){try{this._sessionSchema=Uu.createKiwiCodec(!0,Uu.decodeBinarySchema(e))}catch(r){return console.error(`schema decoding failed: '${r.message}'; uncompressedBytes is ${e.length}`),!1}return!0}willReceiveNodeChanges(){this._appState.prototypeState().checkValidBaseScreenBeforeNodeChanges()}didReceiveNodeChanges(e,r){if(this._appState.prototypeState().checkValidBaseScreenAfterNodeChanges(),this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),r!==null&&r!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new fe(r)),this._observers.forEach(n=>{n.handleNodeChanges()}),U.getFeatureFlags().prototype_ifl_join_protocol_fix&&!en||this._isJoined||(console.debug("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}getSceneLoadingPhase(){return this._sceneLoadingPhase}_handleJoinStartOrJoinStartSkipReload(e,r){let n=0;if(e.type=="JOIN_START"?n=0:(n=1,console.debug("performing fast reconnect to skip scene reload")),r==0?this._setSceneLoadingPhase(On.PENDING_INITIAL_LOAD):r==1&&n!=1&&this._setSceneLoadingPhase(On.PENDING_LOAD_AFTER_RECONNECT),this._sessionID=e.sessionID,this._emitter.trigger("sessionIDSet",this._sessionID),n!=1){e.fileVersion||xe("Viewer received JOIN_START message without a file version"),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="Multiplayer._handleJoinStartOrJoinStartSkipReload",this._appState.setScene(null);let o=Me.createScene(this._sessionID,e.fileVersion||null);this.setScene(o),o.setFileKey(this.fileKey())}else this._sendSignal("client-rendered","");this._observers.forEach(o=>{o.handleJoinStart(n,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,1),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new Rn(0,Rt.ROOT_STABLE_PATH())),this.shouldAutoResumePresenting()&&!this.isPresenterSession()&&(Re.trackDefinedEvent("slides.spotlight_auto_resumed",{sessionID:this._sessionID,fileKey:this._fileKey,reconnectKey:this._reconnectKey}),this.reconnectPresenter())}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,dn.increment("[IFL] sceneGraphQueriesReceived",1),dn.trackNumber("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(r=>Ln.toString(r))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(r=>{r.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new Rn(0,Rt.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&(e.signalName==="invalid-permissions"||e.signalName==="ip-allowlist"||e.signalName==="network-access-restriction")){console.warn(`received ${e.signalName} message.`),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName==="server-side-load-time-metadata"){let r=TN.attemptToParseFrom(e.signalPayload)}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new fe(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let r=AN.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");r!=null&&(this._staticFileRequest=new oi(r.url).format(1),this._staticFileRequest.get().then(n=>{this._observers.forEach(o=>{o.handleJoinStart(0,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(n.bytes).then(o=>{o!=null?(this._scene=o,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(i=>{i.handleJoinEnd()}),this._finishLoadingIfNecessary()):xe("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){var r,n,o,i;for(let a of e.broadcasts)if(a.prototypePresenter!=null)if(a.prototypePresenter.nomination!=null)this.updateNominatedPresenter(a.prototypePresenter.nomination,a.sessionID);else{let s=this._presenterSessionID,l=new fe(a.prototypePresenter.sessionID);this.setPresenterSessionID(l),this._presenterIsReconnected=a.prototypePresenter.isReconnected||!1;let c=(l==null?void 0:l.value)===this._sessionID,d=l!=null&&l.value?(n=(r=this._userSyncing)==null?void 0:r.userBySessionID().get(l.value))==null?void 0:n.clientID:null,u=(i=(o=this._userSyncing)==null?void 0:o.userBySessionID().get(this._sessionID))==null?void 0:i.clientID,p=d&&u?d===u:!1;(s==null?void 0:s.value)!==(l==null?void 0:l.value)&&!c&&!p&&this._startGlobalOpsTimer("join_spotlight"),U.getFeatureFlags().slides_spotlight_smart_refollow&&a.prototypePresenter.sessionID===this._sessionID&&(this._presenterReconnectKey=this._reconnectKey),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)}this._observers.forEach(a=>{a.handlePresenterChange()})}updateNominatedPresenter(e,r){e.isCancelled?(e.sessionID==this._sessionID&&(r==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(r)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(r),r==this._sessionID&&(this._sessionNominatedByCurrentUser=new fe(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(!1)return;let e=()=>{this._heartbeatTimeout=setTimeout(r,Un.HEARTBEAT_DELAY)},r=()=>{var n;if(this._isWindowActive()&&((n=this._socket)==null?void 0:n.readyState())==Ri.Socket_OPEN){console.debug("sending heartbeat message");let o={};o.type="USER_CHANGES",o.userChanges=[],this._sendMessage(o)}e()};e()}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){let r=e.property==114&&pt.asString(e.newVal)=="CREATED",n=e.property==58;(r||n)&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(o=>Ln.fullyLoadsNode(o,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,r){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,r){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let r=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(r,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,r,n){let o=Tt.encodeInstanceStateChange(r,n);o.hotspotStablePath==null&&(o.hotspotStablePath=Tt.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(o)}handleHsmAborted(e,r){this._pushInstanceStateChange(e,r,"ABORTED")}handleHsmCommitted(e,r,n){this._pushInstanceStateChange(e,r,"COMMITTED")}handleHsmInitiated(e,r){this._pushInstanceStateChange(e,r,"INITIATED")}handleHsmRequested(e,r){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(r=>{let n=e.getStateMachineLastChangeInHistory(r.a);this._pushInstanceStateChange(r.a,n,"INITIATED"),this._pushInstanceStateChange(r.a,n,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var n,o;return(o=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e))==null?void 0:o.id()}_createTriggeredOverlaysDataForMultiplayer(e,r){let n=[];return r.overlays.forEach(o=>{let i=this._getSynchronizableHotspotId_instanceHACK(o.openingHotspotStablePath);n.push(Tt.encodeOverlayData(o,i))}),n}_updateNextUserChangeForOverlay(e,r){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,r))}handleVideoStateChange(e){this._getOrCreateNextUserChange().videoStateChangeData=e.slice()}handleEmbeddedPrototypeDataChange(e){this._getOrCreateNextUserChange().embeddedPrototypeData=e.slice()}pushAllVideoStateChanges(){this._appState.prototypeState().snapshotLatestVideoStateChanges(),this._getOrCreateNextUserChange().videoStateChangeData=this._appState.prototypeState().getVideoStateChanges()}handlePresentedStateChange(e,r,n){var a;let o=this._previousTlfID,i=this._appState.baseScreenId();X.equals(o,i)||(this._previousTlfID=i,this._getOrCreateNextUserChange().selection=[],i!=null&&this._getOrCreateNextUserChange().selection.push(X.toFigGUID(i))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=Tt.encodeGUID(e)),n!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=Tt.encodeGUID(n)),this._getOrCreateNextUserChange().lastTriggeredObjectAnimationIndex=(a=r.animationState)==null?void 0:a.actionIndex,r.animationState!=null?this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=Tt.encodeGUID(r.animationState.interactionId):n==null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=Tt.encodeGUID(X.invalid())),this._updateNextUserChangeForOverlay(e,r)}pushAllSetVariableActions(){this.handleSetVariableAction(this._appState.prototypeState()._setVariableActionHistory)}handleSetVariableAction(e){this._getOrCreateNextUserChange().triggeredSetVariableActionData=e}pushAllSetVariableModeActions(){this.handleSetVariableModeAction(this._appState.prototypeState()._setVariableModeActionHistory)}handleSetVariableModeAction(e){this._getOrCreateNextUserChange().triggeredSetVariableModeActionData=e}handleFitModeChange(e,r){}handleRestartPrototype(){}clearNextUserChange(){this._cachedNextUserChange=null}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var e;return(e=this.observedUser())==null?void 0:e.remainingParticles()}getMouse(){var e;return(e=this.observedUser())==null?void 0:e.canvasSpaceMouse}getScrollPositions(){var e;return(e=this.observedUser())==null?void 0:e.scrollPositions}setCanvasSpaceMouse(e){let r=this._previousCanvasSpaceMouseLocation;if(e==null&&r==null||e!=null&&r!=null&&e.equals(r))return;this._previousCanvasSpaceMouseLocation=(e==null?void 0:e.clone())??null;let n={};e!=null?(n.x=e.x(),n.y=e.y()):(n.x=NaN,n.y=NaN);let o={};o.canvasSpaceLocation=n,o.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=o}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)this._canvasSpaceClicks.shift();let r={};r.x=e.x(),r.y=e.y();let n={};n.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,n.point=r,this._canvasSpaceClicks.push(n),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,r){for(le.List_removeIf(this._recentlyChangedScrollPositions,n=>n.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)this._recentlyChangedScrollPositions.shift();this._recentlyChangedScrollPositions.push(new SN(e,r)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(n=>{let o={};return o.node=Tt.encodeGUID(X.fromString(n.nodeId)),o.scrollOffset=Tt.encodeVector2(n.offset),o})}maybeFlushNextUserChange(e){let r=Ze.seconds();(this._lastFlush==-1||r-this._lastFlush>Un.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=r)}_flushNextUserChange(){if(this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],this._messageObservers.forEach(r=>{r.handleMultiplayerMessage(e)}),this._isJoined&&(Un.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null)}}_queriesAreEqual(e,r){let n=new Map;for(let i of e)n.set(Ln.hash(i),!0);let o=new Map;for(let i of r)o.set(Ln.hash(i),!0);if(n.size!=o.size)return!1;for(let i of Array.from(n.keys()))if(!o.has(i))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,1):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,r){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=Ze.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,r==1)){let n={};n.type="SCENE_GRAPH_QUERY",n.sceneGraphQueries=e,dn.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:n.sceneGraphQueries.map(o=>Ln.toString(o))}),this._sendMessage(n)}}_sendSignal(e,r){let n={};n.type="SIGNAL",n.signalName=e,n.signalPayload=r,this._sendMessage(n)}nominatePresenter(e){let r=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(r)}cancelPresenterNomination(e){let r=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(r)}presenterClientBroadcastMessageWithNomination(e,r){let n={};n.type="CLIENT_BROADCAST";let o={};o.sessionID=this._sessionID;let i={},a={};return this._presenterSessionID!=null&&(i.sessionID=this._presenterSessionID.value),a.sessionID=e,a.isCancelled=r,i.nomination=a,o.prototypePresenter=i,n.broadcasts=[o],n}reconnectPresenter(){let e=this.presenterClientBroadcastMessage(!0,!0);this._sendClientBroadcast(e)}startPresenting(){this._startGlobalOpsTimer("start_spotlight");let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){this._presenterReconnectKey=null;let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}setSlideSpeakerNotes(e,r){let n={};n.type="NODE_CHANGES";let o={guid:X.toFigGUID(e),slideSpeakerNotes:r};n.nodeChanges=[o],this._sendClientBroadcast(n)}setInteractiveSlideConfigData(e,r,n){let o={};o.type="NODE_CHANGES";let i={entries:[{key:r,value:n}]},a={guid:X.toFigGUID(e),interactiveSlideConfigData:i};o.nodeChanges=[a],this._sendClientBroadcast(o)}setInteractiveSlideParticipantData(e,r,n){let o={};o.type="INTERACTIVE_SLIDE_CHANGE";let i={anonymousUserID:r,nodeID:X.toFigGUID(e),responseData:n};o.interactiveSlideElementChange=i,this._sendClientBroadcast(o)}presenterClientBroadcastMessage(e,r=!1){let n={};n.type="CLIENT_BROADCAST";let o={},i={};return e&&(i.sessionID=this._sessionID),r&&(i.isReconnected=!0),o.prototypePresenter=i,n.broadcasts=[o],n}debugInfo(){var e,r;return{sessionID:this._sessionID,observingSessionID:this._observingSessionID,presenterSessionID:((e=this._presenterSessionID)==null?void 0:e.value)??null,isReconnected:this._presenterIsReconnected,connection:{isConnected:this._isConnected,isJoined:this._isJoined},userSyncing:((r=this._userSyncing)==null?void 0:r.debugInfo())??null}}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){U.getFeatureFlags().prototype_log_all_ws&&console.log(e),this._socket.send2(wi.deflateRaw(Be().encodeMessage(e)))}};Un.debugUserChanges=!1,Un.VERBOSE=!1,Un.SCHEMA_PREFIX="fig-wire\0\0\0",Un.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),Un.RECONNECTION_DELAY_MIN=1,Un.RECONNECTION_DELAY_MAX=128,Un.FLUSH_INTERVAL_SEC=1/30,Un.HEARTBEAT_DELAY=60*1e3;var Es=Un;var ZS=class{constructor(e,r){this.reconnectSequenceNumber=e,this.fulfilledQueries=r}isValid(){return this.reconnectSequenceNumber!=null&&this.fulfilledQueries!=null}};var Eh=class Eh{age(){return Fr.Math_clamp((Ze.seconds()-this.startTimestamp)/Eh.LIFETIME,0,1)}constructor(e,r,n){this.sessionID=e,this.canvasSpaceLocation=r,this.startTimestamp=n}};Eh.LIFETIME=.25,Eh.RADIUS=25;var Vu=Eh,Ih=class{remainingParticles(){let e=Ze.seconds(),r=null;return this.particles!=null&&le.List_removeIf(this.particles,n=>e-n.startTimestamp>Vu.LIFETIME?!0:(r==null&&(r=[]),r.push(n),!1)),r}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=N.TRANSPARENT?N.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?this.currentFrame:null}}constructor(e,r){this.sessionID=e,this.stableSessionID=r??null,this.userID=null,this.clientID=null,this.name=null,this.color=N.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.lastTriggeredObjectAnimationIndex=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[],this.triggeredSetVariableActionData=[],this.triggeredSetVariableModeActionData=[],this.videoStateChangeData=[],this.embeddedPrototypeData=[],this.activeSlidesEmbeddablePrototype=X.invalid()}},ad=class{userBySessionID(){return this._userBySessionID}getUserBySessionID(e){return this._userBySessionID.get(e)??null}addUserBySessionId(e){this._userBySessionID.set(e,new Ih(e))}handleUserChanges(e,r,n=!1,o=null){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let i=!1,a=!1,s=U.getFeatureFlags();for(let l of e.userChanges){if(l.sessionID===void 0){xe("skipping user change message without sessionID");continue}if(o&&!o.shouldHandleUserChange(l,n))continue;let c=l.sessionID,d=Es.debugUserChanges&&r!=null&&c!=r.sessionID();if(l.observing&&l.observing.includes(r.sessionID())&&(a=!0),l.connected!==void 0){if(l.connected){let p=l.stableSessionID??null,_=new Ih(c,p);if(this._userBySessionID.set(c,_),d){let h=`user sessionID ${c} connected`;console.log(h,_.toJSON())}r!=null&&(r.pushAllInstanceStateChanges(),r.pushAllSetVariableActions(),r.pushAllSetVariableModeActions(),r.pushAllVideoStateChanges(),r.handleConnectedUser(c,p))}else{if(d){let p=`user sessionID ${c} disconnected`,_=this._userBySessionID.get(c);console.log(p,_==null?void 0:_.toJSON())}r!=null&&r.removeNominator(c),this._userBySessionID.delete(c)}i=!0}let u=nr.IntMap_get(this._userBySessionID,c,null);u!=null?(i=this._applyChangeToUser(l,u,d)||i,this._applyNullChecksToUserStrings(u)):d&&xe("could not find existing user to apply user change message"),d&&console.log("recvUserChange",l,i)}a&&r.pushAllVideoStateChanges(),i&&this.onChange!=null&&this.onChange()}debugInfo(){return Array.from(this._userBySessionID.values()).map(r=>({sessionID:r.sessionID,observedSessions:r.observedSessions,deviceName:r.deviceName}))}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,r,n){let o=!1,i=e.sessionID;if(e.color!==void 0&&(r.color=Tt.decodeColor(e.color),o=!0),e.name!==void 0&&(r.name=e.name,o=!0),e.deviceName!==void 0&&(r.deviceName=e.deviceName,o=!0),e.imageURL!==void 0&&(r.imageURL=e.imageURL,o=!0),e.userID!==void 0&&(r.userID=e.userID,o=!0),e.clientID!==void 0&&(r.clientID=e.clientID,o=!0),e.observing!==void 0&&(r.observedSessions=e.observing,o=!0),e.selection!==void 0){let a=e.selection;r.currentFrame=a.length==1?Tt.decodeGUID(a[0]):null,o=!0}if(e.mouse!==void 0){let a=e.mouse;if(a.canvasSpaceLocation!==void 0){let s=Tt.decodeVector(a.canvasSpaceLocation);(r.canvasSpaceMouse==null||!r.canvasSpaceMouse.equals(s))&&(r.canvasSpaceMouse=s.equals(s)?s:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(i))}}if(e.recentClicks!==void 0)if(r.particles==null){r.particles=[];for(let a of e.recentClicks)a.id>r.largestClickID&&(r.largestClickID=a.id)}else for(let a of e.recentClicks)a.id>r.largestClickID&&(r.largestClickID=a.id,r.particles.push(new Vu(i,Tt.decodeVector(a.point),Ze.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(i));if(e.scrollPositions!==void 0)for(let a of e.scrollPositions)r.scrollPositions.set(Tt.decodeGUID_instanceHACK(a.node),Tt.decodeVector(a.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(r.lastTriggeredHotspot=Tt.decodeGUID_instanceHACK(e.lastTriggeredHotspot),o=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(r.lastTriggeredPrototypeInteractionID=Tt.decodeGUID(e.lastTriggeredPrototypeInteractionID),r.lastTriggeredObjectAnimationIndex=e.lastTriggeredObjectAnimationIndex===void 0?null:e.lastTriggeredObjectAnimationIndex,o=!0),e.triggeredOverlaysData!==void 0&&(r.triggeredOverlaysData=e.triggeredOverlaysData.slice(),o=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(a=>{r.instanceStateChanges.push(a)}),o=!0),e.triggeredSetVariableActionData!==void 0&&(r.triggeredSetVariableActionData=e.triggeredSetVariableActionData.slice(),o=!0),e.triggeredSetVariableModeActionData!==void 0&&(r.triggeredSetVariableModeActionData=e.triggeredSetVariableModeActionData.slice(),o=!0),e.videoStateChangeData!==void 0&&(r.videoStateChangeData=e.videoStateChangeData.slice(),o=!0),e.embeddedPrototypeData!==void 0&&(r.embeddedPrototypeData=e.embeddedPrototypeData.slice(),o=!0),e.activeSlidesEmbeddablePrototype!==void 0&&(r.activeSlidesEmbeddablePrototype=X.fromFigGUID(e.activeSlidesEmbeddablePrototype),o=!0),n&&console.log("_applyChangeToUser",e,r.toJSON()),o}constructor(e){this._sessionID=e,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var sd;(a=>{function t(){let s=null;try{s=localStorage}catch{return 1}let l=+s.getItem("cursorScaleFactor");return l||1}a._globalCursorScaleFactor=t;function e(s,l,c,d,u,p,_){let h=L.new2(),g=L.new2(),m=c.clone(),A=1/l;if(U.isInlinePreview()&&m.expand1(3),g.copyFrom(d),g.expand1(A),g.left()<m.left()&&s.fillRect(h.setTo1(g.left(),g.top(),m.left()-g.left(),g.height()),u),m.right()<g.right()&&s.fillRect(h.setTo1(m.right(),g.top(),g.right()-m.right(),g.height()),u),g.top()<m.top()&&s.fillRect(h.setTo1(m.left()-A,g.top(),m.width()+2*A,m.top()-g.top()),u),m.bottom()<g.bottom()&&s.fillRect(h.setTo1(m.left()-A,m.bottom(),m.width()+2*A,g.bottom()-m.bottom()),u),p>0){let S=_==null?void 0:_.clone();S==null||S.expand1(A);let T=p*Math.cos(Math.PI/4)+4*A;(S.left()+T>m.left()||S.top()+T>m.top())&&s.fillConvexPolygon([S.topLeft(),S.topLeft().add(new F(T,0)),S.topLeft().add(new F(0,T))],u),(S.right()-T<m.right()||S.top()+T>m.top())&&s.fillConvexPolygon([S.topRight(),S.topRight().add(new F(0,T)),S.topRight().add(new F(-T,0))],u),(S.right()-T<m.right()||S.bottom()-T<m.bottom())&&s.fillConvexPolygon([S.bottomRight(),S.bottomRight().add(new F(-T,0)),S.bottomRight().add(new F(0,-T))],u),(S.left()+T>m.left()||S.bottom()-T<m.bottom())&&s.fillConvexPolygon([S.bottomLeft(),S.bottomLeft().add(new F(0,-T)),S.bottomLeft().add(new F(T,0))],u)}}a.drawPreviewStencil=e;function r(s,l,c,d){for(let u of l){let p=F.new(u.canvasSpaceLocation);if(!d.contains2(p))continue;let _=[],h=u.age(),g=h*Vu.RADIUS,m=Math.max(8,(g|0)*2);for(let A=0;A<m;A=A+1){let S=Math.PI*2*A/m;_.push(new F(p.x()+Math.cos(S)*g*c,p.y()+Math.sin(S)*g*c))}s.fillConvexPolygon(_,N.new3(.9,.9,.9,.5*(1-h)))}}a.drawParticles=r;function n(s,l,c){let d=l.x(),u=l.y(),p=t()/c,_=[],h=[];for(let T of a.cursorOutlineOuter)_.push(F.new());for(let T of a.cursorOutlineInner)h.push(F.new());let g=2,m=.5,A=(g+1)*(g+1)*(g+1)*(g+1),S=m/A;for(let T=-g,R=g+1;T<R;T=T+1)for(let b=-g,O=g+1;b<O;b=b+1){let I=(g+1-Math.abs(T))*(g+1-Math.abs(b))*S;if(!(I<1/255)){for(let y=0,P=a.cursorOutlineOuter.length;y<P;y=y+1){let E=a.cursorOutlineOuter[y],C=_[y];C.setX(d+(E.x()+T)*p),C.setY(u+(E.y()+b+1)*p)}s.fillConvexPolygon(_,N.new3(0,0,0,I))}}for(let T=0,R=a.cursorOutlineOuter.length;T<R;T=T+1){let b=a.cursorOutlineOuter[T],O=_[T];O.setX(d+b.x()*p),O.setY(u+b.y()*p)}s.fillConvexPolygon(_,N.WHITE);for(let T=0,R=a.cursorOutlineInner.length;T<R;T=T+1){let b=a.cursorOutlineInner[T],O=h[T];O.setX(d+b.x()*p),O.setY(u+b.y()*p)}s.fillConvexPolygon(h,N.BLACK)}a.drawMouseCursor=n,a.cursorOutlineOuter=[new F(14.933,9.027),new F(7.755,10.975),new F(3.57,17.299),new F(0,0)],a.cursorOutlineInner=[new F(12.416,8.674),new F(7.13,10.109),new F(4.063,14.742),new F(1.442,2.04)]})(sd||(sd={}));function Rh(t,e){let r=new WeakMap,n=null;return o=>{let i=e(o);if(i===null)return n==null&&(n=new fe(t(o))),n.value;if(r.has(i))return r.get(i);let a=t(o);return r.set(i,a),a}}function EN(t){return Rh(t,e=>e)}function Cz(t,e,r){let n=Rh(o=>Rh(i=>t(o,i),r),e);return(o,i)=>n(o)(i)}function hM(t,e,r,n){let o=Cz((i,a)=>Rh(s=>t(i,a,s),n),e,r);return(i,a,s)=>o(i,a)(s)}function mM(t,e,r,n,o){let i=hM((a,s,l)=>Rh(c=>t(a,s,l,c),o),e,r,n);return(a,s,l,c)=>i(a,s,l)(c)}var ku=class{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(e,r){this.node=e,this.canvasSpaceDistanceToViewport=r}};function qa(t,e,r,n,o,i){if(n==null)return[];let a=[Q.new2()],s=[Q.new2()],l=[1],c=[],d=p=>{switch(p.op()){case 10:{let _=p;switch(_.property){case et.TRANSFORM:{let h=Q.new3(le.List_last(a));h.multipliedBy1(_.transform()),a.push(h);let g=Q.new3(_.transform());g.invert()||g.copyFrom(wt.FrozenAffineTransform_IDENTITY),g.multipliedBy1(le.List_last(s)),s.push(g);break}case et.INVERSE_TRANSFORM:{let h=Q.new3(le.List_last(a));h.multipliedBy1(le.List_last(s)),a.push(h);let g=Q.new2();s.push(g);break}case et.TRANSFORM_ISOLATION:{s.push(Q.new2());break}case et.MAX_TRANSFORM_SCALE:{l.push(_.maxTransformScale());break}}break}case 11:{let _=p,h=Q.new3(le.List_last(a));h.multipliedBy1(_.transform),a.push(h);let g=Q.new3(_.transform);g.invert()||g.copyFrom(wt.FrozenAffineTransform_IDENTITY),g.multipliedBy1(le.List_last(s)),s.push(g);break}case 8:{let _=p,h=le.List_last(a),g=Q.new3(h);g.invert();let m=L.new3(r);g.transformRect(m);let A=L.new3(e);g.transformRect(A);let S=t*le.List_last(l),T=(o/i|0)**2;U.viewerDoubleTileCompositionLimit()&&(T*=2),_.setDevicePixelPerCanvasPixel(S);let R=_.numTilesNeededForBounds(A);if(R>T){let b=Math.ceil(Math.log(R/T)/Math.log(4));S/=Math.pow(2,b),_.setDevicePixelPerCanvasPixel(S),R=_.numTilesNeededForBounds(A),R>T&&(S/=2),_.setDevicePixelPerCanvasPixel(S)}_.forEachTileWithinBounds(0,m,b=>{let f=b.bounds().distanceTo(A)*h.scale1().maxComponent();c.push(new ku(b,f))});break}}},u=p=>{switch(p.op()){case 10:{let _=p.property;(_==et.TRANSFORM||_==et.INVERSE_TRANSFORM||_==et.TRANSFORM_ISOLATION)&&le.List_removeLast(s),(_==et.TRANSFORM||_==et.INVERSE_TRANSFORM)&&le.List_removeLast(a),_==et.MAX_TRANSFORM_SCALE&&le.List_removeLast(l);break}case 11:{le.List_removeLast(s),le.List_removeLast(a);break}}};return Vr.visitEachNodeInTree(n,d,u),c.sort((p,_)=>p.canvasSpaceDistanceToViewport<_.canvasSpaceDistanceToViewport?-1:1),c}function mr(t,e,r){if(t!=null&&t.isAxisAlignedRectFill()){let n=t;if(Ce.onlySolidPaintOrNull(n.geometry.paints)!=null)return t}if(t.op()==11){let n=t;return new so(mr(n.child,e,r),n.transform)}if((t.op()==3||t.op()==4||t.op()==16)&&le.List_last(e)>10)return t;if(t.canCacheRasterized())return new Vc(t,r);switch(t.op()){case 0:{let n=t;return new ua(mr(n.child,e,r),n.flags)}case 2:{let n=t;return new mi(mr(n.child,e,r))}case 1:{let n=t,o=[],i=[];for(let a of n.children)if(a.canCacheRasterized())i.push(a);else{if(i.length!=0){let s=Le.wrap(i);o.push(mr(s,e,r)),i=[]}o.push(mr(a,e,r))}if(i.length!=0){let a=Le.wrap(i);o.push(mr(a,e,r))}return Le.wrap(o)}case 5:{let n=t;return new In(mr(n.alpha,e,r),mr(n.color,e,r),n.type,n.innerShadowFill,n.innerShadowAlphaRequiresHardMask)}case 6:{let n=t;if(n.endRadius>=1||n.startRadius>=1)return n;if(n.blurOpType==="NORMAL")return Yn.createForStandardBlur(n.endRadius,mr(n.child,e,r),n.clamp);if(n.blurOpType==="PROGRESSIVE")return Yn.createForProgressiveBlur(n.startRadius,n.endRadius,n.startPoint,n.endPoint,mr(n.child,e,r),n.clamp)}case 17:{let n=t;return vl.createForGlassEffect(n.blurRadius,n.textureRadius,n.refractionIntensity,n.refractionDistance,n.lightIntensity,n.lightAngle,n.bevelSize,n.chromaticAberration,n.reflectionRadius,n.tintColor,n.cornerInfo,n.nodeToCanvasSpaceTransform,n.centerPoint,mr(n.child,e,r))}case 7:{let n=t;return new Fo(n.blendMode,n.opacity,mr(n.child,e,r))}case 14:{let n=t;return new Yd(n.radius,n.noiseSize,n.clipToShape,mr(n.child,e,r),n.nodeToCanvasSpaceTransform,n.centerPoint,n.seed)}case 15:{let n=t;return new Qd(n.noiseType,n.blendMode,n.noiseSize,n.density,n.color,n.secondaryColor,mr(n.child,e,r),n.nodeToCanvasSpaceTransform,n.nodeSpaceCenterPoint,n.seed)}case 9:{let n=t;return new fi(mr(n.alpha,e,r),n.color)}case 10:{let n=t;n.property==et.MAX_TRANSFORM_SCALE&&e.push(n.maxTransformScale());let o=new mt(mr(n.child,e,r),n.id,n.property,n.getter);return n.property==et.MAX_TRANSFORM_SCALE&&e.pop(),o}case 11:{let n=t;return new so(mr(n.child,e,r),n.transform)}case 13:{let n=t;return new cs(mr(n.child,e,r),n.blurOpType,n.id,n.property,n.getter,n.getter1,n.canvasSpaceClamp,n.maxEffectRadius,n.cornerSmoothing,n.clipToShape,n.nodeToCanvasSpace,n.noiseType,n.blendMode,n.seed,n.getter2)}case 12:{let n=t;return new Qn(n.startChild!=null?mr(n.startChild,e,r):null,n.endChild!=null?mr(n.endChild,e,r):null,n.id,n.progressFn)}case 3:case 4:case 16:{if(t.hasAnimatingMedia()||t.hasVolatileContent()&&t.op()!=8)return t;throw new Error(`Unexpectedly received ${_n[t.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${_n[t.op()]} node`);default:throw new Error(`Node type ${_n[t.op()]} is unhandled`)}}var Xa=class Xa{constructor(e,r,n,o){this._boundsCache=ca._new(),this._backbuffer=null,this._context=e,this._compositeTileCache=r,this._renderer=n,this._protoCleanUpInterruptCallback=o,this._prepareForEfficientCompositingMemoized=EN(i=>{let s=mr(i,[1],this._compositeTileCache);return Xa._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(i.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(s.debugString1())),s})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),ca.clear(this._boundsCache),this._context.resetNumFramebufferSwitches();let e=this._compositeTileCache.maximumCapacity(),r=U.shouldLockPreRenderingRatio()?Math.ceil(e/tl.PRE_RENDERING_MULIPLIER)*tl.PRE_RENDERING_MULIPLIER:e;return r>=1e3&&(Xa._alreadyLoggedTooManyTiles||(Re.trackEvent("viewer_prototype_too_many_tiles",{numTiles:r}),Xa._alreadyLoggedTooManyTiles=!0)),new Xa.FrameBudget(this._context,Xa.FrameBudget.defaultTimeBudgetInSeconds,Xa.FrameBudget.defaultTileRenderingBudget,r,Xa.FrameBudget.defaultFramebufferSwitchBudget)}prepareForEfficientCompositing(e){return e===null?null:this._prepareForEfficientCompositingMemoized(e)}getPrioritizedListOfTilesToPopulate(e,r,n,o){return qa(e,r,n,o,this._context.maxTextureSize(),this._compositeTileCache.tileSize())}cleanExistingInterrupt(e){this._renderer.cleanUpExistingInterrupt(),this._compositeTileCache.devalueTile(e),this._protoCleanUpInterruptCallback(),e.tileHandleOrNull=null,e.neededImagesOrNull=null}ensureTileIsPopulatedContinue(e,r,n,o){let i=L.new2(),a=this._compositeTileCache.prepareToRenderTo(e,i),s=!0,l=new Nl(e.key.tree,s,this._boundsCache,o,1,!0,!1);return this._renderer.drawTileContinued(i,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),n,a,l,r)==null?(this.cleanExistingInterrupt(e),2):(r.recordTileWasRendered(),0)}ensureTileIsPopulated(e,r,n,o){if(e.skippedPrerasterization=!1,this._compositeTileCache.hasRenderedContent(e))return r.recordTileCacheSlotWasUsed(),2;if(U.shouldApplyMobileOptimizations()&&Bt.getFeatureGate("viewer_atlas_cap_capacity")&&this._compositeTileCache.capacityUsedForCurrentFrame()&&!this._compositeTileCache.canAllocateTileForCurrentFrame())return e.skippedPrerasterization=!0,3;let i=L.new2(),a=this._compositeTileCache.prepareToRenderTo(e,i);r.recordTileCacheSlotWasUsed();let s=!0,l=new Nl(e.key.tree,s,this._boundsCache,o,1,!0,!1),c=()=>{this.cleanExistingInterrupt(e)},d=this._renderer.drawTile(i,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),n,a,l,r,c);return d.status!=1&&r.recordTileWasRendered(),d.neededImagesOrNull!=null&&this._compositeTileCache.setNeededImagesForTile(e,d.neededImagesOrNull),d.status==1?1:0}drawToScreen(e,r,n,o,i,a){this._context.annotate("Composite",()=>{var b;let s=xn.new2();s.copyFrom(r);let l=s.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(n.size().x()|0)||this._backbuffer.colorTexture().height()!=(n.size().y()|0)){this._backbuffer!=null&&this._backbuffer.deleteTexture();let O=this._context.createTexture(Fe.RGBA_LINEAR_CLAMP,n.size().x()|0,n.size().y()|0,fr.BACKBUFFER),f=this._context.createTexture(Fe.STENCIL,n.size().x()|0,n.size().y()|0,fr.BACKBUFFER);this._backbuffer=this._context.createFramebuffer(O,f,"Compositor Backbuffer")}this._context.clear(Ar.ALL,N.TRANSPARENT,this._backbuffer);let c=U.viewerLargeTilesDrawToScreen(),d=c?this._compositeTileCache.drawToScreenLargeTileSize():this._compositeTileCache.tileSize(),u=new L(0,0,d,d),p=L.new2();U.internalDebugTools()&&e!=null&&(e=this._renderer.treeToRender(e));let _=!1,h=!0,g=new Nl(e,_,this._boundsCache,a,h?0:1,!1,c);for(let O=n.left();O<=n.right();O+=d)for(let f=n.top();f<=n.bottom();f+=d)u.setX(O),u.setY(f),p.copyFrom(u),s.transformRect(p),u.translate2(n.topLeft().negative()),this._renderer.drawTile(u,p.x(),p.y(),p.width(),r.scale(),this._backbuffer,g,null,null);U.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let m=Q.new2();m.translate2(-1,1),m.scale4(2/o.width(),-2/o.height());let A=L.new2();A.copyFrom(n),A.transformBy1(m),A.setY(A.y()+A.height()),A.setHeight(-A.height());let S=null,T=new L(o.left()|0,o.top()|0,o.width()|0,o.height()|0);this._context.clear(Ar.ALL,i,S,null,T);let R=L.UNIT;this._renderer.drawTextureToCurrentFramebuffer((b=this._backbuffer)==null?void 0:b.colorTexture(),R,null,A,wt.FrozenAffineTransform_IDENTITY,1,1,S,T)})}};Xa._VERBOSE_LOGS=!1,Xa._alreadyLoggedTooManyTiles=!1;var ld=Xa;(r=>{class t{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(o,i){this.node=o,this.canvasSpaceDistanceToViewport=i}}r.TileWithPriority=t;class e{constructor(o,i,a,s,l){var c;this._context=o,this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=Ze.seconds()+i,this._tileRenderingBudgetRemaining=a,this._tileCacheCapacityRemaining=s,this._framebufferSwitchBudget=l,this._budgetCreationTimeMs=Ze.milliseconds(),this._safeModeRenderingBudgetLimitMs=((c=Bu.safeModeOptions)==null?void 0:c.getForcedRenderTimeMs())??null,this.isSafeModeRendering=(this._safeModeRenderingBudgetLimitMs??0)>0}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._safeModeRenderingBudgetLimitMs!=null&&this._safeModeRenderingBudgetLimitMs>0&&Ze.milliseconds()-this._budgetCreationTimeMs>this._safeModeRenderingBudgetLimitMs?!1:this._overrideFrameBudget?!0:!(this.pastRenderingBudgetTime()>=0||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0||this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()<=0)}pastRenderingBudgetTime(){return Ze.seconds()-this._renderingDeadline}frameBufferSwitchBudgetRemaining(){return this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()}tileRenderingBudgetRemaining(){return this._tileRenderingBudgetRemaining}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}frameBudgetOverride(){return this._overrideFrameBudget}}e.defaultTimeBudgetInSeconds=.016,e.defaultTileRenderingBudget=2,e.defaultFramebufferSwitchBudget=250,r.FrameBudget=e})(ld||(ld={}));var IN=class{constructor(e,r){this.hash=0,this.tree=e,this.bounds=r;let n=new li;n.hash1(r.x()),n.hash1(r.y()),n.hash1(r.width()),n.hash1(r.height()),this.hash=n.value(),this._equalsImpl=(o,i)=>o.bounds.equals(i.bounds)?o.tree.equalsWithinBounds(i.tree,o.bounds):!1}equals(e){return this._equalsImpl(this,e)}},cd=class{constructor(e,r){this._resetMaps();let n=o=>{let i=qe.StringMap_get(this._tileHandleToKey,o,null);i!=null&&(this._tileHandleToKey.delete(o),this._keyToTileHandle.remove(i),this._keyToNeededImages.remove(i))};this._tileAtlas=new tl(e,n,r)}tileSize(){return this._tileAtlas.tileSize()}textureSize(){return this._tileAtlas.textureSize()}drawToScreenLargeTileSize(){return this._tileAtlas.drawToScreenLargeTileSize()}_resetMaps(){this._keyToTileHandle=new ia(e=>e.hash,(e,r)=>e.equals(r),e=>null),this._keyToNeededImages=new ia(e=>e.hash,(e,r)=>e.equals(r),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let r=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(r,e),this._keyToTileHandle.set(e,r),r}getOrInsertOrNull(e,r){if(e==null)return null;let n=new In(Xr.solidColorRect(r,N.BLACK,1),e).optimized();if(n==null)return null;let o=new IN(n,r),i=new If(o,this);return i.tileHandleOrNull=this._keyToTileHandle.get(o,null),i.neededImagesOrNull=this._keyToNeededImages.get(o,null),i}setNeededImagesForTile(e,r){this._keyToNeededImages.set(e.key,r),e.neededImagesOrNull=r}maximumCapacity(){return this._tileAtlas.maximumCapacity()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}capacityUsedForCurrentFrame(){return this._tileAtlas.capacityUsedForCurrentFrame()}canAllocateTileForCurrentFrame(){return this._tileAtlas.canAllocateTileForCurrentFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,r){return(!this.hasRenderedContent(e)||e.tileHandleOrNull==null)&&(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,r),this._tileAtlas.framebufferForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasRenderedContent(e)||e.tileHandleOrNull==null)return null;let r=L.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,r);let n=this._tileAtlas.framebufferForTile(e.tileHandleOrNull).colorTexture();return new Ed(n,r.scaledBy1(1/n.width()))}devalueTile(e){this._tileAtlas.devalueTile(e.tileHandleOrNull)}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};var $S=class $S{constructor(e,r,n,o,i){this._appState=e,this._compositor=r,this._getDevicePixelRatio=n,this._createPlaybackCursor=i,this._getEasedTransitionProgress=o,this._initMagicMoveRenderTreeCache(),this._overlayBaseScreenId=null,this._generatedOverlays=new Map}generatedOverlays(){return this._generatedOverlays}resetGeneratedOverlays(){this._generatedOverlays=new Map}renderTreeForTransition(e,r){return r==null?null:r.cachedRenderTree!=null?r.cachedRenderTree:X.equals(r.change.oldStateId(),r.change.newStateId())?this._renderTreeForOverlayTransition(r):this._renderTreeForBaseScreenTransition(r,e)}_initMagicMoveRenderTreeCache(){let e=a=>a[1]==Tn.FrameRole.OVERLAY?ct.renderTreeWithPerfLogging2(a[0],this._createPlaybackCursor(a[0],null),"_initMagicMoveRenderTreeCache"):ct.renderTreeForBaseScreenWithPerfLogging(a[0],this._createPlaybackCursor(a[0],null),"_initMagicMoveRenderTreeCache"),r=a=>a,n=a=>a,o=(a,s,l,c)=>{let d=null;try{d=Ei.renderTreeForMagicMove(a,s,()=>this._getEasedTransitionProgress(),c,l)}catch(u){d=null,xe(u)}return $S.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(d==null?void 0:d.debugString1())),d},i=(a,s,l,c)=>o(a[0],s[0],l,c);this._consolidatedRenderTreeForMagicMove=mM(i,e,e,r,n)}renderTreeForMagicMove(e,r,n,o,i){return this._consolidatedRenderTreeForMagicMove([e,o],[r,o],n,i)}_preparedRenderTreeForMagicMove(e,r,n,o,i,a){let s=this.renderTreeForMagicMove(n,o,r,i,a);return e.cachedRenderTree=s?this._compositor.prepareForEfficientCompositing(s):null,e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,r){let n=e.change,o=e.viewportBeforeTransition.zoomScale()*this._getDevicePixelRatio(),i=this._appState.prototypeState().lastNodeForBaseScreen();if(i==null)return null;let a=r.zoomScale()*this._getDevicePixelRatio(),s=this._appState.prototypeState().nextNodeForBaseScreen();if(s==null)return null;let l=n.oldOverlays(this._appState.prototypeState()),c=n.newOverlays(this._appState.prototypeState()),d=Zr.get(n.transitionParameters.transitionType);n.direction==1&&(d=d.reversed());let u=n.transitionParameters.transitionType=="SMART_ANIMATE"||Kn.supportsSmartAnimate(n.transitionParameters.transitionType)&&n.transitionParameters.transitionShouldSmartAnimate,p=l.length!=0;if(u){let A=this._preparedRenderTreeForMagicMove(e,d,i,s,Tn.FrameRole.BASE_SCREEN,n.easingFunction());if(p){let S=s.size().max(i.size()),T=Q.new2(),R=this._renderTreeForOverlays(i,l);if(R==null)return null;if(R=mt.forOpacity(R,Pt.EXITING_TLF,()=>d.exitingFrameTransition().interpolateOpacity(this._getEasedTransitionProgress())),R=mt.forTransform(R,Pt.EXITING_TLF,()=>T.copyFrom(wt.FrozenAffineTransform_IDENTITY).translatedBy1(S.multiply(d.exitingFrameTransition().interpolateTranslation(this._getEasedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(o/a).translatedBy1(i.canvasSpaceBoundingBox().center().negative())),n.transitionParameters.transitionType=="SMART_ANIMATE"){let b=Pt.DISSOLVE_TRANSITION;R=new Qn(R,A,b,()=>this._getEasedTransitionProgress())}return e.cachedRenderTree=Le.wrap([A,R]).optimized(),e.cachedRenderTree}else return A}let _=s.size().max(i.size()),h=Q.new2(),g=this.renderTreeForBaseScreenAndOverlays(i,l);g!=null?(g=mt.forOpacity(g,Pt.EXITING_TLF,()=>d.exitingFrameTransition().interpolateOpacity(this._getEasedTransitionProgress())),g=mt.forTransform(g,Pt.EXITING_TLF,()=>h.copyFrom(wt.FrozenAffineTransform_IDENTITY).translatedBy1(_.multiply(d.exitingFrameTransition().interpolateTranslation(this._getEasedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(o/a).translatedBy1(i.canvasSpaceBoundingBox().center().negative()))):g=new Le([]);let m=this.renderTreeForBaseScreenAndOverlays(s,c);if(m!=null?(m=mt.forOpacity(m,Pt.ENTERING_TLF,()=>d.enteringFrameTransition().interpolateOpacity(this._getEasedTransitionProgress())),m=mt.forTranslation(m,Pt.ENTERING_TLF,()=>_.multiply(d.enteringFrameTransition().interpolateTranslation(this._getEasedTransitionProgress())))):m=new Le([]),d.isDissolve()){let A=Pt.DISSOLVE_TRANSITION;e.cachedRenderTree=new Qn(g,m,A,()=>this._getEasedTransitionProgress())}else d.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=Le.wrap([g,m]):e.cachedRenderTree=Le.wrap([m,g]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var S,T;let r=e.change,n=r.oldOverlays(this._appState.prototypeState()),o=r.newOverlays(this._appState.prototypeState()),i=this._appState.prototypeState().lastNodeForBaseScreen(),a=i.canvasSpaceBoundingBox().topLeft();if(i==null)return null;let s=ct.renderTreeForBaseScreenWithPerfLogging(i,this._createPlaybackCursor(i,null),"_renderTreeForOverlayTransition");if(s==null)return null;let l=[],c=this._compositor.prepareForEfficientCompositing(s);c!=null&&l.push(mt.forTransformIsolation(c));let d=r.getFramePairTransition(),u=new ms,p=0;for(let R=0,b=Math.min(n.length,o.length);R<b&&X.equals(n[R].id(),o[R].id());R=R+1){let O=ct.renderTreeForOverlayBackground(n[R].backgroundAppearance(),i.canvasSpaceBoundingBox());O!=null&&l.push(O);let f=this._renderTreeForOverlay1(n[R],i,R,u,null);f!=null&&l.push(f),p=p+1}if(n.length==o.length&&p==n.length-1&&r.transitionParameters.transitionType=="SMART_ANIMATE"){let R=n[n.length-1],b=o[o.length-1],O=this._appState.prototypeState().lastNodeForOverlayAt(n.length-1),f=this._appState.prototypeState().nextNodeForOverlayAt(o.length-1);if(O!=null&&f!=null){let I=[];ln(I,l);let y=ct.renderTreeForOverlayBackground(R.backgroundAppearance(),i.canvasSpaceBoundingBox()),P=ct.renderTreeForOverlayBackground(b.backgroundAppearance(),i.canvasSpaceBoundingBox());(y!=null||P!=null)&&I.push(new Qn(y,P,Pt.OVERLAY_BACKGROUND_DISSOLVE,()=>this._getEasedTransitionProgress()));let E=this._preparedRenderTreeForMagicMove(e,d,O,f,Tn.FrameRole.OVERLAY,r.easingFunction());return E==null?null:(E=mt.forTranslation(E,Pt.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let C=b.deltaFromRenderedPositionToCanvasSpacePosition(i),B=R.renderedOrigin(i).subtract(f.canvasSpaceBoundingBox().topLeft());return C.multiplyScalar(this._getEasedTransitionProgress()).add(B.multiplyScalar(1-this._getEasedTransitionProgress()))}),I.push(E),e.cachedRenderTree=Le.wrap(I).optimized(),e.cachedRenderTree)}}let g=[];for(let R=p,b=n.length;R<b;R=R+1){let O=ct.renderTreeForOverlayBackground(n[R].backgroundAppearance(),i.canvasSpaceBoundingBox()),f=null;O!=null&&(f=()=>1-this._getEasedTransitionProgress(),g.push(mt.forOpacity(O,Pt.EXITING_OVERLAY_BACKGROUND,f)));let I=n[R].renderedOrigin(i).subtract(a),y=((S=n[R].node())==null?void 0:S.size())??Ae.FrozenVector_new1(),P=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(r.transitionParameters.transitionType)!=-1?i.size().subtract(I.add(y)):I,E=y.add(P),C=()=>E.multiply(d.exitingFrameTransition().interpolateTranslation(this._getEasedTransitionProgress())),B=this._renderTreeForOverlay2(n[R],i,R,f,u,C);u!=null&&u.removeEntry(n[R].id()),B!=null&&(B=mt.forOpacity(B,Pt.EXITING_OVERLAY,()=>d.exitingFrameTransition().interpolateOpacity(this._getEasedTransitionProgress())),B=mt.forTranslation(B,Pt.EXITING_OVERLAY,C),g.push(B))}let m=[];for(let R=p,b=o.length;R<b;R=R+1){let O=ct.renderTreeForOverlayBackground(o[R].backgroundAppearance(),i.canvasSpaceBoundingBox()),f=null;O!=null&&(f=()=>this._getEasedTransitionProgress(),m.push(mt.forOpacity(O,Pt.ENTERING_OVERLAY_BACKGROUND,f)));let I=o[R].renderedOrigin(i).subtract(a),y=((T=o[R].node())==null?void 0:T.size())??Ae.FrozenVector_new1(),P=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(r.transitionParameters.transitionType)!=-1?i.size().subtract(I.add(y)):I,E=y.add(P),C=()=>E.multiply(d.enteringFrameTransition().interpolateTranslation(this._getEasedTransitionProgress())),B=this._renderTreeForOverlay2(o[R],i,R,f,u,C);B!=null&&(B=mt.forOpacity(B,Pt.ENTERING_OVERLAY,()=>d.enteringFrameTransition().interpolateOpacity(this._getEasedTransitionProgress())),B=mt.forTranslation(B,Pt.ENTERING_OVERLAY,C),m.push(B))}let A=[];if(ln(A,l),d.isDissolve()){let R=Pt.DISSOLVE_TRANSITION,b=Le.wrap(g),O=Le.wrap(m);A.push(new Qn(b,O,R,()=>this._getEasedTransitionProgress()))}else ln(A,g),ln(A,m);return e.cachedRenderTree=Le.wrap(A),e.cachedRenderTree}renderTreeForBaseScreenAndOverlays(e,r){if(e==null)return null;let n=ct.renderTreeForBaseScreenWithPerfLogging(e,this._createPlaybackCursor(e,null),"_renderTreeForBaseScreenAndOverlays");if(n==null)return null;let o=Le.wrap([this._compositor.prepareForEfficientCompositing(n),this._renderTreeForOverlays(e,r)]).optimized();return o==null?null:mt.forTransformIsolation(o)}_renderTreeForOverlays(e,r){let n=[],o=new ms;for(let i=0,a=r.length;i<a;i=i+1){let s=ct.renderTreeForOverlayBackground(r[i].backgroundAppearance(),e.canvasSpaceBoundingBox());s!=null&&n.push(s);let l=this._renderTreeForOverlay1(r[i],e,i,o,null);l!=null&&n.push(l)}return Le.wrap(n)}_renderTreeForOverlay1(e,r,n,o,i){return this._renderTreeForOverlay2(e,r,n,null,o,i)}_renderTreeForOverlay2(e,r,n,o,i,a){if(r==null)return null;let s=e.node();if(s==null)return null;let l=e.renderedBounds(r),c=s.canvasSpaceBoundingBox(),d=l.center().subtract(c.center());this._overlayBaseScreenId!=null&&r.id()!=this._overlayBaseScreenId&&(s.invalidateRenderTreeForSelfAndParents(),s.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=r.id();let u=new gt(r,null),p=new qc(e.id(),e.node(),l,u,e.backgroundAppearance(),o,()=>d,a);i.addEntry(e.id(),p),this._generatedOverlays.set(e.id(),p),s.transitioningFrom!=null&&i.addEntry(s.transitioningFrom.exitingTransitionRoot.id(),{...p,overlayNode:s.transitioningFrom.exitingTransitionRoot});let _=ct.renderTreeForOverlayWithPerfLogging(s,this._createPlaybackCursor(s,i),"_renderTreeForOverlay");if(_==null)return null;let h=this._compositor.prepareForEfficientCompositing(_);return h==null?null:(h=mt.forTranslation(h,Pt.forOverlayPosition(n),()=>d),h)}renderTreeForBaseScreenWithPerfLogging(e,r,n){return ct.renderTreeForBaseScreenWithPerfLogging(e,r,n)}renderTreeForOverlayWithPerfLogging(e,r,n){return ct.renderTreeForOverlayWithPerfLogging(e,r,n)}};$S.VERBOSE_LOGS=!1;var JS=$S;var RN=class{constructor(){this._emitter=Xt.getEventEmitter()}handleImageLoaded(e){this._dirtyNode(e)}handleObjectAnimationStateChange(e){this._dirtyNode(e)}handleSceneGraphEvent(e){this._shouldDirtyNodeFromEvent(e)&&this._dirtyNode(e.node)}_dirtyNode(e){let r=this._getDirtyContainerNodeFor(e);r&&this._emitter.trigger("nodeThumbnailInvalidated",r.id())}},eA=class extends RN{_getDirtyContainerNodeFor(e){return e.findNearestAncestorOrSelf("SLIDE")}_shouldDirtyNodeFromEvent(e){switch(e.property){case 59:case 60:case 22:case 62:case 111:case 61:case 63:case 77:case 76:return!1;case 70:case 58:case 26:return e.node.type()!=="SLIDE";default:return!0}}};var tA=class{constructor(e,r,n,o){this._context=e,this._tileConfig=r,this._renderer=n,this._requestImage=o,this._boundsCache=ca._new()}generateThumbnail(e,r,n,o,i){if(!e.hasBeenLoaded())return null;let a=this.renderTreeForThumbnail(e);if(a==null)return null;let s=new Nl(a,!0,this._boundsCache,this._requestImage,i,!1,!1);this._resetBuffer(n,o);let l=this._tileConfig.baseTileSize;for(let d=0;d<=n;d+=l)for(let u=0;u<=o;u+=l){let p=new L(d,u,l,l),_=L.new2();_.copyFrom(p),r.transformRect(_),this._renderer.drawTile(p,_.x(),_.y(),_.width(),r.scale(),this._frameBuffer,s,null,null)}return this._context.readPixels(this._frameBuffer,0,0,n,o)}renderTreeForThumbnail(e){let r=new gt(e);return e.type()==="SLIDE"?e.renderTreeForSlideThumbnail2(r):e.type()==="FRAME"&&e.isTopLevel()?e.renderTreeForBaseScreen2(r):e.renderTree2(r)}_resetBuffer(e,r){this._frameBuffer!=null&&this._frameBuffer.deleteTexture();let n=this._context.createTexture(Fe.RGBA_LINEAR_CLAMP,e,r,fr.EXPORT),o=this._context.createTexture(Fe.STENCIL,e,r,fr.EXPORT);this._frameBuffer=this._context.createFramebuffer(n,o,"thumbnailRenderer")}};var yh=class{constructor(e,r){this.cachedRenderTree=null,this.change=e,this.viewportBeforeTransition=new wo,this.viewportBeforeTransition.copyFrom(r)}},bh=class{constructor(e,r,n){this.tracker=e,this.progress=r,this.change=n}};var ja=class ja{constructor(e,r,n,o,i,a,s,l){this._shouldRenderCursor=!0;this._isInViewerRenderServerForTests=!1;this._prerenderViewport=new wo,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._didRasterizeContentOnLastDraw=!0,this._observers=new bn,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new Zn,this._ongoingObjectAnimation=null,this._objectAnimationProgressTracker=new Zn,this._hsmTransitionMap=new Map,this._appState=r,this._context=i;let c=U.shouldApplyMobileOptimizations(),d=this._getTextureSizeForTileConfig(),u=this._getTileSizeForTileConfig(),p=this._getTargetTileCacheMemoryUsageInMBForTileConfig(),_=Bt.getFeatureGate("viewer_atlas_cap_capacity")&&c;this._tileConfig=l??(_?Ii.fromTargetMaxMemoryUsage(d,u,4,()=>c?3:6,p):new Ii(d,u,()=>c?3:6,()=>Number.POSITIVE_INFINITY)),this._bufferPool=a,this._compositeTileCache=new cd(this._context,this._tileConfig),this._renderer=s(this._tileConfig),this._thumbnailRenderer=new tA(this._context,this._tileConfig,this._renderer,this._requestImageOnScreen);let h=()=>{this._interruptCompletionCallback=null};this._compositor=new ld(this._context,this._compositeTileCache,this._renderer,h),this._viewport=e,this._appState.addAppObserver(this),this._emitter=o,this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),U.shouldApplyMobileOptimizations()&&n.clearQueuesAndDecodedDataForAllImages(this._canvas())}),n.onImageLoaded=m=>{var A;m.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(m),(A=this._thumbnailInvalidationManager)==null||A.handleImageLoaded(m),this._viewport.invalidate()};let g=m=>{this._onBoundsInvalidate(m)};this._dirtinessTracker=new gh(g),this._smoothPath=new $l(this._context,this._bufferPool),this._deviceRenderer=new KS(this._context,this._bufferPool),this._hotspotRenderer=new US(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new fh(m=>{r.addFrameObserver(m)},2,(m,A)=>m==A,()=>{this.setNeedsBlit(!0)}),this._protoRenderTreeGenerator=new JS(r,this._compositor,()=>this._devicePixelRatio,()=>this.easedTransitionProgress(),(m,A)=>new ec(m,this._hsmTransitionMap,A,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker)),this._requestImageOnScreen=(m,A)=>{let S=Hn.forOnScreenPurpose(A);n.requestImageForRendering(m,S)},this._requestImageForPrerendering=(m,A)=>{let S=Hn.forPrerenderPurpose(A);n.requestImageForRendering(m,S)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`)}setInViewerRenderServerForTests(e){Yr()&&(this._isInViewerRenderServerForTests=e)}toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var e;return(e=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:e.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}tileAtlasTileSize(){return this._compositeTileCache.tileSize()}tileAtlasTextureSize(){return this._compositeTileCache.textureSize()}drawToScreenLargeTileSize(){return this._compositeTileCache.drawToScreenLargeTileSize()}tileRenderer(){return this._renderer}setNeedsBlit(e){this._needsBlit=e,this._observers.forEach(r=>{r.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this.hasHsmTransition()),this._needsBlit||Os.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}initializeThumbnailInvalidationManager(e){var r,n;switch(e){case"SLIDES":this._thumbnailInvalidationManager=new eA;break;default:this._thumbnailInvalidationManager=null;break}this._thumbnailInvalidationManager&&((n=(r=this._canvas())==null?void 0:r.scene())==null||n.addObserver(this._thumbnailInvalidationManager))}thumbnailRenderer(){return this._thumbnailRenderer}setShouldRenderCursor(e){this._shouldRenderCursor=e}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this.setNeedsBlit(!0)}handleSceneChange(e,r){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,r){this._renderer.setCanvas(r),e!=null&&(e.scene().removeObserver(this._dirtinessTracker),this._thumbnailInvalidationManager&&e.scene().removeObserver(this._thumbnailInvalidationManager)),r!=null&&(r.scene().addObserver(this._dirtinessTracker),this._thumbnailInvalidationManager&&r.scene().addObserver(this._thumbnailInvalidationManager)),this._dirtinessTracker.initCanvas(r)}handleActivePrototypeStartingPointChange(e,r){}resize(e,r,n,o){let a=new F(e,r).multiplyScalar(o),s=this._context.resizeDefaultFramebuffer(Math.round(a.x())|0,Math.round(a.y())|0);return this._devicePixelRatio=o,this.setZoomScale(n),this._debouncedDevicePixelsPerCanvasPixel.clear(),new Oa(s.canvasSize.divideScalar(o),s.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{U.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),this._renderer.context().clear(Ar.ALL,N.TRANSPARENT,null)})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._protoRenderTreeGenerator.renderTreeForTransition(e,this._ongoingTransition);{let r=this._appState.prototypeState().getCurrentBaseScreenNode(),n=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return Re.perfTimerScope("invalidateDirtyTiles",Re.ProfileLevel.LEGACY,()=>{this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new ec(this._canvas(),this._hsmTransitionMap,new ms(this._protoRenderTreeGenerator.generatedOverlays()),this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker))}),this._protoRenderTreeGenerator.resetGeneratedOverlays(),this._protoRenderTreeGenerator.renderTreeForBaseScreenAndOverlays(r,n)}}_getTextureSizeForTileConfig(){return U.shouldApplyMobileOptimizations()?2048:this._context.maxTextureSize()}_getTileSizeForTileConfig(){return U.shouldApplyMobileOptimizations()&&Bt.getFeatureGate("viewer_mobile_half_tile_size")?Ii.DEFAULT_TILE_SIZE/2:Ii.DEFAULT_TILE_SIZE}_getTargetTileCacheMemoryUsageInMBForTileConfig(){return Ii.DEFAULT_TARGET_MEMORY_USAGE_IN_MB}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,r,n,o){var l;if(this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost())return 2;if(((l=this._canvas())==null?void 0:l.scene())==null)return 2;if(this._currentTlf()==null)return 2;if(n.viewSpaceBounds().isEmpty())return 2;let i=this._compositor.beginFrameAndCreateBudget();var a="";let s=this._context.annotateAndReturn("draw",()=>{var R,b,O;let c=i.tileCacheCapacityRemaining();this._interruptCompletionCallback==null&&this._renderer.context().beginFrame(),this._isInViewerRenderServerForTests&&Yr()&&(this._renderer.context().getGpuMetricsCollection().nextFrame(),Re.nextFrame(this._renderer.context().getGpuMetricsCollection().getCurrentFrameIndex()));let d=this._ongoingTransition!=null,u=this._ongoingObjectAnimation!=null,p=this.isTopLevelTransitionOngoing();d&&this._onBeforeFrameForTransition(),u&&this._onBeforeFrameForObjectAnimation(),this._onBeforeFrameForHsm();let _=this._renderTreeToDraw(n);this._activeRenderTree=_,_!=null&&this._setAnimatedMediaPlaying(_.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(n.zoomScale()*this._devicePixelRatio);let h=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(p&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let g=[],m=0,A=L.new2();n.computeCanvasSpaceBounds1(A);let S=this.currentCanvasSpacePreviewBounds();if(S==null)return Re.trackEvent("prototype_null_canvas_space_preview_bounds",{currentTlfID:((R=this._currentTlf())==null?void 0:R.id)??"null",baseScreenNodeID:((b=this._appState.baseScreenNode())==null?void 0:b.id)??"null",sceneNull:((O=this._canvas())==null?void 0:O.scene())==null,transitionOngoing:this._ongoingTransition!=null}),2;let T=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new F(0,0);return S.intersectWith(A),!U.getFeatureFlags().prototype_skip_empty_rect_render_kill_switch&&S.area()==0?2:(this._interruptCompletionCallback&&Re.perfTimerScope("interruptCompletion",Re.ProfileLevel.LEGACY,()=>{i.permitWorkAfterBudgetExceeded(),this._interruptCompletionCallback(i),i.forbidWorkAfterBudgetExceeded(),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtDidCompleteInterruptedFrame=!0,this._interruptCompletionCallback=null}),this._renderer.context().beginFrame(),Re.perfTimerScope("drawOnScreenTiles",Re.ProfileLevel.LEGACY,()=>{this._context.annotate("On-screen tiles",()=>{if(!h){let y=L.new3(S);for(y.expandedBy1(S.height()),g=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),S,y,_),i.permitWorkAfterBudgetExceeded();m<g.length&&(!i.isSafeModeRendering||i.permitsMoreWork());){let P=g[m];if(!P.overlapsViewport()){a+="tileOutsideViewport_";break}let E=this._compositor.ensureTileIsPopulated(P.node,i,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageOnScreen);E==0?(this._didRasterizeContentOnLastDraw=!0,ja.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${i.tileCacheCapacityRemaining()} / ${c}`),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOnScreenTileCompletionCount++):E==1?(this._didRasterizeContentOnLastDraw=!0,this._interruptCompletionCallback=C=>{this._compositor.ensureTileIsPopulatedContinue(P.node,C,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)}):E==2&&this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOnScreenTileReuseCount++,m=m+1}i.forbidWorkAfterBudgetExceeded()}})}),this._interruptCompletionCallback!=null?(a+="safeModeInterrupt_",1):(Re.perfTimerScope("drawToScreen",Re.ProfileLevel.LEGACY,()=>{var f,I;if(this._needsBlit){this._printRenderTree&&console.log((f=this._activeRenderTree)==null?void 0:f.debugString1());let y=L.new2(),P=0,E=(I=this._canvas())==null?void 0:I.prototypeDevice(),C=E!=null&&E.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),B=this._appState.prototypeState().showTransparentBackground();C?(y.setTo2(T,E.size()),P=N.BLACK):(y.copyFrom(S),P=o.backgroundColor),B&&(P=N.TRANSPARENT);let G=xn.new2().scaledBy(this._devicePixelRatio).multipliedBy(n.canvasSpaceToViewSpace1());G.transformRect(y),y.round();let V=n.viewSpaceBounds(),D=new L(V.left()*this._devicePixelRatio,V.top()*this._devicePixelRatio,V.width()*this._devicePixelRatio,V.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(_,G,y,D,P,this._requestImageOnScreen),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics().setCurrentFrameSubMetricsType(Ls.GpuSubMetricsType.OVERLAY_UI_RENDERING),this._drawUI(n,o),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics().setCurrentFrameSubMetricsType(Ls.GpuSubMetricsType.SCENE_GRAPH_RENDERING),this.setNeedsBlit(!1),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtBlitToScreen=!0}}),Re.perfTimerScope("drawOffScreenTiles",Re.ProfileLevel.LEGACY,()=>{this._context.annotate("Off-screen tiles",()=>{if(!h){for(var f=i.permitsMoreWork();(f=i.permitsMoreWork())&&m<g.length;){let P=this._compositor.ensureTileIsPopulated(g[m].node,i,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering);if(P==3){a+="offscreenHitCacheLimit_";break}if(P==0)this._didRasterizeContentOnLastDraw=!0,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOffScreenTileCompletionCount++;else if(P==1){this._didRasterizeContentOnLastDraw=!0;let E=g[m].node;this._interruptCompletionCallback=C=>{this._compositor.ensureTileIsPopulatedContinue(E,C,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)},a+="optionalOffscreenInterrupt_";break}P==0&&ja.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${i.tileCacheCapacityRemaining()} / ${c}`),m=m+1}f||(a+="offscreenHitBudget_"),m==g.length&&(a+="completedScreenTiles_"),r=r&&this._interruptCompletionCallback==null;let I=r;if(U.getFeatureFlags().viewer_disable_prerendering_on_ongoing_interaction){let P=this._ongoingTransition!=null;I=I&&!this.hasHsmTransition()&&!P}if(r&&rt.didDisablePrerenderingOnOngoingTransition(!I),I){let P=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),E=null,C=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let B of this._appState.prototypeStructure().getPrerenderingJobs(()=>i.permitsMoreWork())){let G=null,V=null,D=null,w=null,k=B.asScreen(),z=B.asSmartAnimate();if(k!=null){if(k.role==Tn.FrameRole.BASE_SCREEN&&X.equals(k.nodeId,this._currentBaseScreenId())||(D=this._canvas().scene().findNode(k.nodeId),D==null||!D.hasBeenLoaded()))continue;if(!i.permitsMoreWork()){a+="startFutureFrame_";break}let J=null;if(k.role==Tn.FrameRole.OVERLAY){let Ee=Sn.fromPrototypeAction(k.prototypeAction,0);J=U_.BoundOverlay_computeNewBounds(D,this._appState.baseScreenNode(),Ee,C,D.overlayPositionType()),C=J.topLeft();let Ke=new gt(this._appState.baseScreenNode(),null),Ve=new qc(D.id(),D,J,Ke,D.overlayBackgroundAppearance(),null,()=>D.canvasSpaceBoundingBox().topLeft().negative().add(C),null);this._protoRenderTreeGenerator.generatedOverlays().set(D.id(),Ve),E==null&&(E=new ms),E.addEntry(D.id(),Ve),G==null&&k.precedingOverlays!=null&&(G=new ms)}if(k.role==Tn.FrameRole.OVERLAY&&P.some(Ee=>X.equals(k.nodeId,Ee.id())))continue;if(w=this.canvasSpacePreviewBoundsForTransition(D,D),G!=null){let Ee=!1;for(let Ke of k.precedingOverlays){let Ve=E==null?void 0:E.get(Ke);if(Ve==null){Ee=!0;break}G.addEntry(Ke,Ve)}if(Ee){a+="nonLoadedPrecedingOverlays_";break}}let ie=new ec(D,this._hsmTransitionMap,G,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker);V=k.role==Tn.FrameRole.BASE_SCREEN?this._protoRenderTreeGenerator.renderTreeForBaseScreenWithPerfLogging(D,ie,"_draw"):this._protoRenderTreeGenerator.renderTreeForOverlayWithPerfLogging(D,ie,"_draw")}else if(z!=null){let J=this._canvas().scene().findNode(z.srcNodeId),ie=this._canvas().scene().findNode(z.dstNodeId);if(J==null||ie==null||!J.hasBeenLoaded()||!ie.hasBeenLoaded())continue;w=this.canvasSpacePreviewBoundsForTransition(J,ie);let Ee=Zr.get(z.transitionType);V=this._protoRenderTreeGenerator.renderTreeForMagicMove(J,ie,Ee,z.role,z.easingFunction),D=ie}if(V==null)continue;if(!i.permitsMoreWork()){a+="beforePrepareFutureTree_";break}let H=this._compositor.prepareForEfficientCompositing(V);if(!i.permitsMoreWork()){a+="afterPrepareFutureTree_";break}if(w==null)continue;this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview(D.canvasSpaceBoundingBox(),w,this._appState.currentScalingInfo(),this._appState.activePrototypeDevice());let K=L.new2();this._prerenderViewport.computeCanvasSpaceBounds1(K),w.intersectWith(K);let j=this._prerenderViewport.zoomScale()*this._devicePixelRatio,q=this._compositor.getPrioritizedListOfTilesToPopulate(j,w,w,H);for(let J of q){if(i.tileCacheCapacityRemaining()==0){a+="tileCapacityFutureFrame_";break}let ie=this._compositor.ensureTileIsPopulated(J.node,i,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering);if(ie==3){a+="optionalFutureHitCacheLimit_";break}if(ie==0)this._didRasterizeContentOnLastDraw=!0,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOptionalTileCompletionCount++,ja.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${i.tileCacheCapacityRemaining()} / ${c}`);else if(ie==1){this._didRasterizeContentOnLastDraw=!0;let Ee=J.node;this._interruptCompletionCallback=Ke=>{this._compositor.ensureTileIsPopulatedContinue(Ee,Ke,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)},a+="optionalFutureInterrupt_";break}if(!i.permitsMoreWork()){a+="postFutureFrameRaster_";break}}}}}})}),0))});return this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtDidRasterWork=this._didRasterizeContentOnLastDraw,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtHasPendingInterruptForNextFrame=this._interruptCompletionCallback!=null,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtBrokeRenderAt=a,this._renderer.context().getGpuMetricsCollection().getCurrentFrameGPUMetrics().updateFrameBudgetInfo(i),s}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){var e;return(e=this._canvas())==null?void 0:e.scene().findNode(this._currentBaseScreenId())}_drawUI(e,r){this._context.annotate("Draw UI",()=>{var h;if(this._appState.getActiveCanvas()==null)return;let n=this.currentCanvasSpacePreviewBounds(),o=(h=this.currentCanvasSpaceFrameBounds())==null?void 0:h.topLeft(),i=L.new2();e.computeCanvasSpaceBounds1(i);let l=1/(e.zoomScale()*this._devicePixelRatio);if(n==null)return;let c=i.topLeft().subtract(n.topLeft()).makeAbs();this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),l);let d=this._canvas().prototypeDevice(),u=d.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),p=0;if(u&&(0,fM.devicePresetHasOverlyRoundedCorners)(d.presetIdentifier)&&(p=25),!u)n.intersectWith(i),sd.drawPreviewStencil(this._smoothPath,e.zoomScale(),n,i,r.backgroundColor,p);else if(o!=null){let g=L.new2();g.setTo2(o,d.size()),g.expand1(1/e.zoomScale());let m=g.clone();n.intersectWith(i),g.intersectWith(i),sd.drawPreviewStencil(this._smoothPath,e.zoomScale(),g,i,r.backgroundColor,p,m)}this._currentTlf()!=null&&this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),i),r.particles!=null&&sd.drawParticles(this._smoothPath,r.particles,1/e.zoomScale(),n),r.mouse!=null&&n.contains2(r.mouse)&&this._shouldRenderCursor&&sd.drawMouseCursor(this._smoothPath,r.mouse,e.zoomScale()),r.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),r.hotspots,r.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush()})}drawDeviceFrameIfNecessary(e,r,n,o){return this._drawDeviceFrameIfNecessary(this._smoothPath,r,n,o)}_drawDeviceFrameIfNecessary(e,r,n,o){return this._canvas()==null||!this._appState.prototypeState().showDeviceFrame()?!1:(this._context.annotate("Draw device frame",()=>{var i;if(this.deviceRenderer().drawPrototypeDeviceIfAny(r,this._canvas().prototypeDevice(),n,r.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=kf((i=this._appState.baseScreenNode())==null?void 0:i.id(),this._appState.currentScalingInfo().fitMode,this._appState.prototypeState().showTransparentBackground(),this._canvas());e.fillRect(o,a)}}),!0)}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}resetTileStackUsage(){this._renderer.resetTileStackUsage()}reclaimTileStack(){this._renderer.reclaimTileStack()}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let r=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(ja.VERBOSE_LOGS||r){let n=this._transitionProgressTracker.frameTimesMs,o=n.length,i=0,a=0,s=0,l=0,c=0,d=0,u=0,p=0,_=0;for(let T of n)p=Math.max(p,T),_+=T,T<20?i=i+1:T<40?a=a+1:T<80?s=s+1:T<160?l=l+1:T<320?c=c+1:T<640?d=d+1:u=u+1;if(p>60*1e3||this._ongoingTransition==null)return;let h=_/o,g=this._ongoingTransition.change,m=g.transitionParameters.transitionType,A=m=="SMART_ANIMATE"||Kn.supportsSmartAnimate(m)&&g.transitionParameters.transitionShouldSmartAnimate,S=new Map([["is_smart_animate",A],["mean_frame_ms",h],["max_frame_ms",p],["frame_count",o],["count_0_to_20ms",i],["count_20_to_40ms",a],["count_40_to_80ms",s],["count_80_to_160ms",l],["count_160_to_320ms",c],["count_320_to_640ms",d],["count_640_ms_or_higher",u]]);ja.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(qe.StringMap_toJSObject(S)),console.groupEnd()),r&&(Re.trackEvent("viewer_transition_frame_times_v2",qe.StringMap_toJSObject(S)),this._numTransitionsLogged=this._numTransitionsLogged+1)}}}triggerTransition(e,r,n){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new yh(e,r),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),n!=null&&id.applyTo(n,this._transitionProgressTracker)}handleAbortedTransition(e){var r;e==((r=this._ongoingTransition)==null?void 0:r.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var r;e==((r=this._ongoingTransition)==null?void 0:r.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,r,n){let o=e.toString(),i=new Zn;i.willStartTransitionWithDuration(r.transitionParameters.transitionDuration),n!=null&&id.applyTo(n,i),this._hsmTransitionMap.set(o,new bh(i,()=>{let a=i.progress();return r.transitionParameters.easingFunction==null||i.isProgressControlledExternally()?a:r.easingFunction().get(a)},r))}abortHsmTransition(e,r){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,r){this._hsmTransitionMap.delete(e.toString())}hasHsmTransition(){return this._hsmTransitionMap.size>0}triggerObjectAnimation(e,r){ja.VERBOSE_LOGS&&console.log("[ProtoRenderManager] triggerObjectAnimation",e),this._ongoingObjectAnimation=new yh(e,r),this._objectAnimationProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration);let n=e.objectAnimationTargetNode(this._appState.scene());if(!n)throw new Error("Expected object animation target node");if(n.animatingFrom)throw new Error("Expected target node's animatingFrom property to be null when triggering a new object animation");let o=v().cloneNode(n.id()),i=this._appState.scene().findNode(o);if(!i)throw new Error("Expected cloned node");v().setNodeToInitialObjectAnimationState(o,n.id()),v().setNodeToFinalObjectAnimationState(n.id(),n.id()),n.animatingFrom=i;let a=this._appState.getActiveCanvas();a.invalidateRenderTreeForSelfAndParents(),a.invalidateRenderTreeForChildren()}_setObjectAnimationToState(e,r){var o,i,a;let n=(o=this._ongoingObjectAnimation)==null?void 0:o.change.objectAnimationTargetNode(this._appState.scene());n&&(n.animatingFrom=null,r==="initial"?v().setNodeToInitialObjectAnimationState(n.id(),n.id()):v().setNodeToFinalObjectAnimationState(n.id(),n.id()),this._dirtinessTracker.dirtyNode(n),(i=this._thumbnailInvalidationManager)==null||i.handleObjectAnimationStateChange(n),n.invalidateRenderTreeForSelfAndParents(),n.invalidateRenderTreeForChildren()),e==((a=this._ongoingObjectAnimation)==null?void 0:a.change)&&(this._ongoingObjectAnimation=null)}handleAbortedObjectAnimation(e){ja.VERBOSE_LOGS&&console.log("[ProtoRenderManager] handleAbortedObjectAnimation",e),this._setObjectAnimationToState(e,"initial")}handleCommittedObjectAnimation(e){ja.VERBOSE_LOGS&&console.log("[ProtoRenderManager] handleCommittedObjectAnimation",e),this._setObjectAnimationToState(e,"final")}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let r=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?r:e.change.easingFunction().get(r)}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress())){this._maybeLogPerformanceMetricsForTransition();let r=this._transitionProgressTracker.transitionEnded();switch(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="ProtoRenderManager._onBeforeFrameForTransition "+r,r){case Zn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case Zn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let r=this._hsmTransitionMap.get(e);if(r==null)return;let n=r.tracker;if(n.advanceToNextFrame(),!n.isTransitionInProgress()){let o=n.transitionEnded(),i=this._appState.prototypeState(),a=r.change;if(i.getStateMachineInitiatedChange(a.stablePath)==a)switch(o){case Zn.TransitionEndedAction.COMMIT:{i.commitChangesBelowInstanceTransitionRoot(a.stablePath);let s=this._appState.scene().findNodeByStablePath(a.stablePath);s!=null&&this._dirtinessTracker.dirtyNode(s);break}case Zn.TransitionEndedAction.ABORT:{i.abortInstanceStateChange(a.stablePath);break}}}}})}_onBeforeFrameForObjectAnimation(){let e=this._ongoingObjectAnimation;if(e)if(this._objectAnimationProgressTracker.advanceToNextFrame(),this._objectAnimationProgressTracker.isTransitionInProgress()){let r=e.change.objectAnimationTargetNode(this._appState.scene());if(!r)throw new Error("Expected object animation target node");this._dirtinessTracker.dirtyNode(r)}else{let r=this._objectAnimationProgressTracker.transitionEnded();switch(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="ProtoRenderManager._onBeforeFrameForObjectAnimation "+r,r){case Zn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case Zn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}}currentCanvasSpacePreviewBounds(){if(this._ongoingTransition!=null){let n=this.ongoingPrototypeStateChange();if((n==null?void 0:n.transitionParameters.transitionType)!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),i=o.lastNodeForBaseScreen(),a=o.nextNodeForBaseScreen()??o.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(i,a)}}let r=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(r,r)}currentCanvasSpaceFrameBounds(){if(this._ongoingTransition!=null){let n=this.ongoingPrototypeStateChange();if((n==null?void 0:n.transitionParameters.transitionType)!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),i=o.lastNodeForBaseScreen(),a=o.nextNodeForBaseScreen()??o.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(i,a)}}let r=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(r,r)}canvasSpacePreviewBoundsForTransition(e,r){if(e==null&&r==null)return null;if(!X.equals(e==null?void 0:e.id(),r==null?void 0:r.id())){let n=Ae.FrozenVector_ZERO,o=Ae.FrozenVector_ZERO,i=0,a=0;if(e!=null){n=e.canvasSpaceBoundingBox().size();let p=e.strokeGeometry();p!=null&&p.bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(i=Math.abs(p.bounds.left()))}o=r.canvasSpaceBoundingBox().size();let s=r.strokeGeometry();s!=null&&s.bounds.isFinite()&&r.strokeAlign()!="INSIDE"&&(a=Math.abs(s.bounds.left()));let l=n.max(o),c=new L(0,0,l.x(),l.y()),d=Math.max(i,a),u=Q.new2().translatedBy1(r.canvasSpaceBoundingBox().center()).translatedBy1(c.center().negative());return c.transformInto1(c,u),c.expand1(d),c}return r.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,r){if(e==null&&r==null)return null;if(!X.equals(e==null?void 0:e.id(),r==null?void 0:r.id())){let n=e!=null?e.size():Ae.FrozenVector_ZERO,o=r.size(),i=n.max(o),a=new L(0,0,i.x(),i.y());return a.transformInto1(a,r.absoluteTransform()),a}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var e;return((e=this._ongoingTransition)==null?void 0:e.change)??null}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}};ja.VERBOSE_LOGS=!1;var vh=ja;var Hu=class{constructor(e,r){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=r,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,r){if(!this.isValid(r))return;let n=this._ballisticSimulation.pos1(),o=r.findNode(this._scrollingNodeID);e.setScrollOffsetUnconditionally(o,n)}};var Ch=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let r=new gt(e),n=kr.getSemanticNodePath(r);return this._semanticScrollStorage.getData(n,kr.DEFAULT_STORAGE_KEY)}setValueInStorage(e,r){let n=new gt(e),o=kr.getSemanticNodePath(n);this._semanticScrollStorage.insert(o,kr.DEFAULT_STORAGE_KEY,r)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.oldStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.newStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}commitCurrentScrollStateToStorage(e){switch(e.transitionParameters.navigationType){case"NAVIGATE":case"SWAP_STATE":let r=this._getOldNode(e);this._recursivelyRecordOffsets(r);break;case"OVERLAY":case"SWAP":let n=e.oldStateAndOverlays.overlays[e.oldStateAndOverlays.overlays.length-1];if(n){let o=this._appState.scene().findNode(n.id);this._recursivelyRecordOffsets(o)}break;case"SCROLL_TO":}}applyStoredScrollStateToScene(e){switch(e.transitionParameters.navigationType){case"NAVIGATE":case"SWAP_STATE":let r=this._getNewNode(e);this._recursivelySetOffsets(r);break;case"OVERLAY":case"SWAP":let n=e.newStateAndOverlays.overlays[e.newStateAndOverlays.overlays.length-1];if(n){let o=this._appState.scene().findNode(n.id);this._recursivelySetOffsets(o)}break;case"SCROLL_TO":}}resetScrollStateToScene(e){switch(e.transitionParameters.navigationType){case"NAVIGATE":case"SWAP_STATE":let r=this._getNewNode(e);this._recursivelyResetOffsets(r);break;case"OVERLAY":case"SWAP":let n=e.newStateAndOverlays.overlays[e.newStateAndOverlays.overlays.length-1];if(n){let o=this._appState.scene().findNode(n.id);this._recursivelyResetOffsets(o)}break;case"SCROLL_TO":}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(r=>{this._recursivelyRecordOffsets(r)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let r=this.getValueFromStorage(e);r!=null?r.equals(e.scrollOffset())||(Re.trackDefinedEvent("prototype.viewer_scroll_state_transferred",{}),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,r))):e.setScrollOffset(Ae.FrozenVector_ZERO)}e.forEachChild(r=>{this._recursivelySetOffsets(r)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(Re.trackDefinedEvent("prototype.viewer_scroll_state_reset",{}),e.setScrollOffset(Ae.FrozenVector_ZERO),this.setValueInStorage(e,Ae.FrozenVector_ZERO)),e.forEachChild(r=>{this._recursivelyResetOffsets(r)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}debugString(){return this._semanticScrollStorage.toString2(e=>`{x: ${e.x()}, y: ${e.y()}}`)}constructor(e,r){this._canvasView=e,this._appState=r,this._semanticScrollStorage=new Yl}};var rA=class{constructor(e,r,n,o,i,a,s,l,c){this.type="HOTSPOT",this.hotspot=e,this.prototypeInteraction=r,this.action=n,this.viewSpacePointOrNull=o,this.prototypeAction=i,this.connectionType=a,this.actionIndexPath=s,this.resolvedVariableModes=l,this.nodeForFindingTopmostScreen=c}},yN=class{constructor(e,r,n){this.type="OBJECT_ANIMATION",this.interactionId=e,this.actionIndex=r,this.transitionDirection=n}},nA=class{constructor(e,r){this._queue=[],this._canvasView=e,this._prototypeState=r,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendHotspotActionToQueue(e,r,n,o,i,a,s,l,c){this._queue.push(new rA(e,r,n,o,i,a,s,l,c))}insertHotspotActionInQueue(e,r,n,o,i,a,s,l,c,d){this._queue.splice(l,0,new rA(e,r,n,o,i,a,s,c,d))}appendObjectAnimationActionToQueue(e,r,n){this._queue.push(new yN(e,r,n))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){if(e.type=="HOTSPOT")this._canvasView.runSequentialAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes,e.nodeForFindingTopmostScreen);else if(e.type=="OBJECT_ANIMATION"){let r=this._prototypeState.getCurrentBaseScreenNode(),n=new ti(e.interactionId,e.actionIndex);this._prototypeState.playObjectAnimation(r,n,e.transitionDirection)}}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,r){if(this._queue.length>0&&this._shouldProcessAction(e)){let n=this._queue.shift();n!=null&&r(()=>{this._runAction(n)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,r){this._queue.length=0}handleHsmCommitted(e,r,n){if(this._queue.length>0&&this._shouldProcessAction(r)){let o=this._queue.shift();o!=null&&n(()=>{this._runAction(o)})}}handleHsmInitiated(e,r){}handleHsmRequested(e,r){}willTriggerHotspot(e,r,n,o){(n==4||n==8||n==9||n==3)&&(this._queue.length=0)}didScrollNode(e){}_shouldProcessAction(e){return!(e.cause==6||e.cause==7)}};var dd;(o=>{function t(i){return i.stateManagementVersion()==1}o.newStateManagementRulesEnabledForChange=t;function e(){return o._seenOldStateManagementInteraction}o.seenOldStateManagementInteraction=e;function r(){o._seenOldStateManagementInteraction=!0}o.markOldStateManagementInteractionSeen=r,o._seenOldStateManagementInteraction=!1})(dd||(dd={}));var oA=class{constructor(e,r,n){this._readableStreamController=null;this._appState=e,this._canvasView=r,this._nodeId=n,this._readableStream=new ReadableStream({start:i=>{this._readableStreamController=i}});let o=this._canvasView.thumbnailRenderer();if(!o)throw new Error("Thumbnail renderer not ready");this._thumbnailRenderer=o}get readable(){return this._readableStream}getSize(){let r=this.getNode().fullSizeCanvasSpaceBoundingBox(),n=Math.min(Math.min(3840/r.width(),1),Math.min(2160/r.height(),1));return{width:2*Math.round(r.width()*n/2),height:2*Math.round(r.height()*n/2)}}getNode(){let e=this._appState.scene().findNode(this._nodeId);if(!e)throw new Error(`Cannot find node ${this._nodeId} in scene`);return e}captureFrame(e){var r,n;try{let o=this.getNode(),i=o.fullSizeCanvasSpaceBoundingBox(),a=i.topLeft(),s=new xn(a,1),l=this._thumbnailRenderer.generateThumbnail(o,s,i.width(),i.height(),2);if(!l)throw new Error("Failed to generate thumbnail for node");(r=this._readableStreamController)==null||r.enqueue(new VideoFrame(l,{codedWidth:i.width(),codedHeight:i.height(),format:"RGBA",timestamp:e*1e3}))}catch(o){(n=this._readableStreamController)==null||n.error(o)}}stop(){var e;try{(e=this._readableStreamController)==null||e.close()}catch{}}};var Oz=1e3,zu=class{constructor(e){this._currentSeeked=0;this._allSeekedPromise=new to;this._listeners=[];this.onSeeked=()=>{this._currentSeeked+=1,this._currentSeeked===this._runtimes.length&&this._allSeekedPromise.resolve()};this._runtimes=e,this._listeners=e.map(r=>r.on("seeked",this.onSeeked))}async seekWithIndividualOffsets(e){this._allSeekedPromise=new to,this._currentSeeked=0,this._runtimes.forEach(r=>{let n=r.getStartTimeMs(),o=r.getEndTimeMs(),i=e+n;if(Bt.getFeatureGate("buzz_video_trimming")&&(o>0||n>0)){let a=o-n;a>0&&(i=e%a+n)}r.currentTime2((i+.001)/1e3)}),this._runtimes.length===0&&this._allSeekedPromise.resolve(),await this._allSeekedPromise.realPromise()}play(){this._runtimes.forEach(e=>e.play())}pause(){this._runtimes.forEach(e=>e.pause())}resume(){this._runtimes.filter(e=>!e.ended()).forEach(e=>e.play())}maxDurationMs(){return this._runtimes.length===0?0:Math.max(...this._runtimes.map(e=>{let r=e.getEndTimeMs(),n=e.getStartTimeMs();return Bt.getFeatureGate("buzz_video_trimming")&&r>0?r-n:e.duration()*Oz}))}getAllVideoBlobsByVideoHash(){let e=this._runtimes.map(r=>{let n=r.getSourceNodeGuid(),o=r.hash();return[n?`${n}:${o}`:o,r.getMP4VideoBlob()]}).filter(r=>r[1]!==null);return new Map(e)}getTrimValuesByVideoHash(){let e=this._runtimes.map(r=>{let n=r.getStartTimeMs(),o=r.getEndTimeMs();if(n>0||o>0){let i=r.getSourceNodeGuid(),a=r.hash();return[i?`${i}:${a}`:a,{startTimeMs:n,endTimeMs:o}]}return null}).filter(r=>r!==null);return new Map(e)}setVolumeForSubtree(e){this._runtimes.forEach(r=>{let n=r.getSourceNodeGuid();if(n){let o=e[n]??1;r.setVolume(o)}})}setTrimValuesByNodeId(e){this._runtimes.forEach(r=>{let n=r.getSourceNodeGuid();if(n){let o=e[n];o&&r.setTrimTimes(o.startTimeMs,o.endTimeMs)}})}destroy(){this._runtimes.forEach((e,r)=>e.off("seeked",this._listeners[r])),this.seekWithIndividualOffsets(0)}};function gM(t,e){let r={};return t.forEachDescendantPreorder(n=>{n.forEachSinglePaint(o=>{var l;let i=(l=o.video())==null?void 0:l.hash();if(!i)return;let a=n.id(),s=`${a}:${i}`;r[s]=e[a]??1})}),r}var bN=30,Nz=4e6,SM=48e3,iA=class{constructor(e,r){this._isExporting=!1;this._appState=e,this._canvasView=r}async exportVideo({nodeId:e,signal:r,videoVolumeByNodeId:n,videoTrimValuesByNodeId:o,onProgress:i}){if(this._isExporting)throw new Error("Video export is already in progress");this._isExporting=!0;let a=[],s=[],l=null,c=null;try{let d=this._appState.videoManager().getRuntimesForVisibleVideos();if(d.length===0)throw new Error("No videos found for export");l=new zu(d),Bt.getFeatureGate("buzz_video_trimming")&&o&&Object.keys(o).length>0&&(l.setTrimValuesByNodeId(o),await l.seekWithIndividualOffsets(0));let u=l.maxDurationMs(),p=Math.floor(u/1e3*bN),_=new oA(this._appState,this._canvasView,e),{allReadableStreams:h,audio:g,audioExportController:m}=await this.prepareVideoExport(l,_,_.getNode(),n);if(r!=null&&r.aborted)throw new el;let A=new $i;a=Ks.getImagesInSubtree(_.getNode()).map(O=>O.gif()).filter(O=>O!==null),s=a.map(O=>O.replaceTimeSource(A));let S=new BS({fps:bN,durationMs:u,onStop:()=>{_.stop(),m==null||m.stop()},onStart:()=>{},setPlayheadTimeMs:async O=>{A.setCurrentTime(O);let f=l==null?void 0:l.seekWithIndividualOffsets(O);m==null||m.captureAudio(O),await f,_.captureFrame(O)}}),{width:T,height:R}=_.getSize(),b=new wS({video:{config:{bitrate:Nz,codec:LS.AVC_HIGH_LEVEL_6_2,latencyMode:"quality",bitrateMode:"variable",width:T,height:R,framerate:bN},numFramesToRender:p},audio:g,onProgress:i||(()=>{}),onFrameCaptured:()=>{S.bumpTime()},readableStream:h});return c=()=>{b.stopRecording(!0)},r==null||r.addEventListener("abort",c,{once:!0}),await b.recordVideo(S)}finally{l==null||l.destroy(),c&&(r==null||r.removeEventListener("abort",c)),a.forEach((d,u)=>d.replaceTimeSource(s[u])),this._isExporting=!1}}isExporting(){return this._isExporting}async prepareVideoExport(e,r,n,o){let i=e.getAllVideoBlobsByVideoHash();if(i.size===0)return{allReadableStreams:r.readable};let a=new AudioContext({sampleRate:SM});try{let s=Array.from(i.entries()),l=await Promise.all(s.map(([_,h])=>h.arrayBuffer().then(g=>a.decodeAudioData(g)).catch(()=>null))),c=gM(n,o),d=e.getTrimValuesByVideoHash(),u=s.map(([_,h],g)=>{let m=d.get(_);return{buffer:l[g],volume:c[_]??1,startTimeMs:m==null?void 0:m.startTimeMs,endTimeMs:m==null?void 0:m.endTimeMs}}).filter(_=>_.buffer!==null),p=new j_(u);return{allReadableStreams:lM(p.readable,r.readable),audio:p.getAudioEncoderConfig(SM),audioExportController:p}}catch{return{allReadableStreams:r.readable}}finally{a.close()}}};var aA=class{constructor(e){this.params=e;this._startedAtMs=null;this._pausedAtMs=null;this._currentPlayheadTimeMs=0}stop(){this._startedAtMs&&(this.params.appState.removeFrameObserver(this),this._startedAtMs=null,this._pausedAtMs=null,this.params.onStop())}start(){this._startedAtMs||this._pausedAtMs||(this.params.appState.addFrameObserver(this),this._startedAtMs=performance.now(),this._currentPlayheadTimeMs=0,this.params.onStart(),this.params.setPlayheadTimeMs(this._currentPlayheadTimeMs))}pause(){this._pausedAtMs=performance.now(),this.params.onPause()}resume(){if(!this._startedAtMs||!this._pausedAtMs)return;let e=performance.now()-this._pausedAtMs;this._startedAtMs=this._startedAtMs+e,this._pausedAtMs=null,this.params.onResume()}onFrame(){if(!this._startedAtMs||this._pausedAtMs)return;let e=performance.now();if(this._currentPlayheadTimeMs=e-this._startedAtMs,this._currentPlayheadTimeMs>=this.params.durationMs){this.stop();return}this.params.setPlayheadTimeMs(this._currentPlayheadTimeMs)}};var sA=class{constructor(e){this.appState=e;this._session=null;this.stop=()=>{if(!this._session)return;let{clockSource:e,gifs:r,oldGifTimeSources:n,signal:o,videoController:i}=this._session;this._session=null,o==null||o.removeEventListener("abort",this.stop),r.forEach((a,s)=>a.replaceTimeSource(n[s])),e.stop(),i.pause(),i.destroy()}}async play({nodeId:e,onPlayheadTimeMs:r,onPause:n,onResume:o,onStop:i,onStart:a,onDurationMs:s,signal:l,videoVolumeByNodeId:c,videoTrimValuesByNodeId:d}){var T,R;if(((T=this._session)==null?void 0:T.state)==="playing"||((R=this._session)==null?void 0:R.state)==="paused")return;l==null||l.addEventListener("abort",this.stop,{once:!0});let u=this.appState.scene().findNode(e);if(!u)throw new Error(`Cannot find node with ID ${e} in scene`);let p=this.appState.videoManager().getRuntimesForVisibleVideos(),_=new $i,h=Ks.getImagesInSubtree(u).map(b=>b.gif()).filter(b=>b!==null),g=h.map(b=>b.replaceTimeSource(_)),m=new zu(p);m.setVolumeForSubtree(c),d&&m.setTrimValuesByNodeId(d),await m.seekWithIndividualOffsets(0);let A=m.maxDurationMs();s(A);let S=new aA({appState:this.appState,durationMs:A,onStop:()=>{i(),this.stop()},onStart:()=>{a(),m.play()},onPause:n,onResume:o,setPlayheadTimeMs:b=>{r(b),_.setCurrentTime(b)}});S.start(),this._session={state:"playing",clockSource:S,gifs:h,oldGifTimeSources:g,mockGlobalTime:_,videoController:m,signal:l}}isPlayingOrPaused(){return this._session!==null}resume(){var e;((e=this._session)==null?void 0:e.state)==="paused"&&(this._session.state="playing",this._session.videoController.resume(),this._session.clockSource.resume())}pause(){!this._session||this._session.state==="paused"||(this._session.state="paused",this._session.videoController.pause(),this._session.clockSource.pause())}};var lA=class{constructor(e,r){this._abortController=null;this._playingAbortController=null;this._appState=e,this._exporter=new iA(e,r),this._player=new sA(e),this._sceneDidCompleteInitialLoadPromise=new Promise(n=>{function o(){Xt.getEventEmitter().off("sceneDidCompleteInitialLoad",o),n()}Xt.getEventEmitter().on("sceneDidCompleteInitialLoad",o)})}async waitForSceneHydratedAndAssetsLoaded(){await this._sceneDidCompleteInitialLoadPromise;let e=this._appState;await new Promise(r=>{function n(){e.imageManager().hasPendingImages()?setTimeout(n,0):r()}n()}),await Promise.all(this._appState.videoManager().getRuntimesForVisibleVideos(!0).map(r=>r.waitForLoad().realPromise())).then(()=>{})}exportVideo(e){var n;(n=this._abortController)==null||n.abort();let r=this._abortController=new AbortController;return this._playingAbortController=null,this.waitForSceneHydratedAndAssetsLoaded().then(()=>this._exporter.exportVideo({...e,signal:r.signal})).finally(()=>{r===this._abortController&&(this._abortController=null)})}cancelCurrentTimelineActions(){var e;(e=this._abortController)==null||e.abort(),this._abortController=null,this._playingAbortController=null}cancelCurrentPlayingSession(){this._playingAbortController&&this.cancelCurrentTimelineActions()}async play(e){var n;if(this._exporter.isExporting())throw new Error("Cannot play video while exporting");if(this._player.isPlayingOrPaused()){this._player.resume();return}(n=this._abortController)==null||n.abort();let r=this._abortController=new AbortController;this._playingAbortController=r,this.waitForSceneHydratedAndAssetsLoaded().then(()=>this._player.play({...e,onStop:()=>{r===this._abortController&&(this._abortController=null,this._playingAbortController=null),e.onStop()},signal:r.signal}))}pause(){this._player.pause()}stop(){this._player.stop()}};var cA=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=Ae.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=Ae.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var CN=(r=>(r[r.SHORTCUT=0]="SHORTCUT",r[r.SCROLL=1]="SCROLL",r))(CN||{});var dA=class{constructor(e,r){this.swappedStablePath=e,this.hotspotStablePath=r}},uA=class{willTriggerHotspot(e,r,n,o){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,r,n,o)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,r){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=r}},Wu=class t{constructor(e,r){this.FRAMES_TO_FINISH_RENDERING=3,this._state=t.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new bn,this._emitter=null,e.addObserver(this),this._emitter=r}onFrame(){this._state==t.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop"),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=t.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==t.State.INACTIVE?e&&(this._emitter.trigger("renderingStart"),this._observers.forEach(r=>{r.handleRenderingStart()}),this._state=t.State.ACTIVE):this._state==t.State.ACTIVE?e||(this._state=t.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=t.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(e=>{let t;(i=>(i[i.ACTIVE=0]="ACTIVE",i[i.INACTIVE=1]="INACTIVE",i[i.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(t=e.State||(e.State={}))})(Wu||(Wu={}));var ge=class ge extends Fp{constructor(e){super(),this._appState=null,this._observers=new bn,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new cA,this._viewport=new wo,this._hotspotAnimation=new GS,this._uiRenderData=new mh,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=!1,this._mostRecentFrameNum=0,this._sequentialBlankFrameStartTimestamp=null,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.onScalingModeChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData=new HS,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new F(0,0),this._interactionObservers=new bn,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=e,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=Xt.getEventEmitter(),this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new VS(r=>{this._renderer.setZoomScale(r)},this._emitter),this._pointerEventDelegate=new ge.CanvasPointerEventDelegate(this),this._scrollSyncer=new Ch(this,this._appState),this._sequentialActionManager=new nA(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new zS(this._appState),this._loggedInvalidFramePresetSize=!1,this._timelineManager=new lA(e,this)}scrollPositionSyncer(){return this._scrollSyncer}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){this._renderer.setBackgroundEnabled(e)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let e=this._renderer;if(e!=null&&e.removeFrom(this),U.getFeatureFlags().viewer_disable_rendering)this._renderer=new WS;else{let r;U.useUnifiedRenderer()?r=new TS({needsAlpha:this._appState.needsAlphaGPUBackingStore()}):r=new ci({needsAlpha:this._appState.needsAlphaGPUBackingStore()}),Li.initializeGpuContext(r);let n=r.createVertexBufferPool(),o=i=>new Uf(r,n,i);this._renderer=new vh(this._viewport,this._appState,this._appState.imageManager(),this._emitter,r,n,o)}this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new qS(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new Wu(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),e!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}initializeThumbnailInvalidationManager(e){e!==null&&this._renderer.initializeThumbnailInvalidationManager(e)}thumbnailRenderer(){return this._renderer.thumbnailRenderer()}getContext(){return this._renderer.getContext()}appState(){return this._appState}idlenessTracker(){return this._idlenessTracker}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}timelineManager(){return this._timelineManager}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(e,r,n,o){this._viewport.setScrollPadding([e,r,n,o])}setMultiplayer(e){this._multiplayer=e}setShowHotspots(e){this._showHotspots=e}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(e,r){r!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(e,r){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let e=this._appState.prototypeState(),r=[];e.getCurrentBaseScreenNode()!=null&&r.push(e.getCurrentBaseScreenNode());for(let n=0,o=e.getCurrentOverlayData().length;n<o;n=n+1)r.push(e.nodeForOverlayAt(n));this._triggerPotentialTimedTransition(r,0)},this._appState.nodeTransitionTracker().triggerPotentialTimedTransitionForSpecificRootNode=e=>{e&&this._triggerPotentialTimedTransition([e],0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=e=>{e&&this._createVideoTriggerEvents([e])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let e=[],r=this._appState.prototypeState();r.getCurrentBaseScreenNode()!=null&&e.push(r.getCurrentBaseScreenNode());for(let n=0,o=r.getCurrentOverlayData().length;n<o;n=n+1)e.push(r.nodeForOverlayAt(n));this._createVideoTriggerEvents(e)}}navigateForward(e,r){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let o=this._appState.prototypeState().getCurrentBaseScreenNode();if(o==null)return;if(this._appState.prototypeState().getInitiatedChange()&&this._appState.prototypeStructure().navigationOrder().shouldCommitInitiatedChangeOnNavigate()){this._appState.prototypeState().commitStateChange(),this._viewport.invalidate();return}let i=this._appState.prototypeStructure().navigationOrder().getNextObjectAnimation();if(i!=null){let s=o.getObjectAnimationInteraction(i);if(s!=null)for(let l=i.actionIndex;l<s.allActions().length;l++)this._sequentialActionManager.appendObjectAnimationActionToQueue(s.id(),l,0);this._sequentialActionManager.runNextAction();return}if(U.shouldPlayVideosLinearly()&&this._appState.videoManager().playNextVisibleVideo()&&r)return;let a=this._appState.prototypeStructure().navigationOrder().getNextBaseScreenNode();if(a!=null){this.navigateViaArrows(o.id(),a.id(),0,e);return}}navigateBackward(e){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;if(this._appState.prototypeState().getInitiatedChange()){this._appState.prototypeState().abortStateChange(),this._viewport.invalidate();return}let i=this._appState.prototypeState().getCurrentAnimationState(),a=this._appState.prototypeStructure().navigationOrder().getPreviousObjectAnimation();if(i!=null){this._appState.prototypeState().playObjectAnimation(n,a,1);return}let s=this._appState.prototypeState().getPreviousBaseScreenNode();if(s!=null){this.navigateViaArrows(n.id(),s.id(),1,e);return}}navigateToFrameAtIndex(e){let r=this._appState.prototypeState().getCurrentBaseScreenId();if(r==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenIndex(),o=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(e<0||e>o.length-1||e==n)return;let i=X.fromString(o[e]),a=n<e?0:1;this.navigateViaArrows(r,i,a,null)}navigateViaArrows(e,r,n,o){this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&Re.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:qn[n],nonInteraction:0,prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString()});let i=this._appState.prototypeState().getCurrentBaseScreenNode();if(i!=null&&i.prototypeInteractions().length>0){let a=null;for(let s=0,l=i.prototypeInteractions().length;s<l;s=s+1){let c=i.prototypeInteractions()[s],d=(c==null?void 0:c.action())!=null?c.action().value:null;if(c!=null&&c.allActions().length>0)for(let p of c.allActions())p.transitionNodeID()!=null&&p.transitionNodeID()==r&&(d=p);let u=d!=null?this._appState.scene().findNode(d.transitionNodeID()):null;if(u!=null){let p=An.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),i==null?void 0:i.id(),u==null?void 0:u.id(),d.navigationType(),d.connectionType());a=p??null}if(X.equals(a,r)){this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,i,1,n,o,c,d);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,null,1,n,o,null,null)}_navigateToHyperlink(e,r){var n;if(e.hyperlink.url!==void 0){this.onURLClicked(e.hyperlink.url,!0);return}else if(e.hyperlink.guid!==void 0){let o=Tt.decodeGUID(e.hyperlink.guid);if(X.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let i=this._appState.scene().findNode(o),a=An.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(n=e.node)==null?void 0:n.id(),i==null?void 0:i.id(),r,"URL");if(a!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays(a);return}let s=this._appState.currentFileKey();this.onNavigateToPrototype(s,o)}}triggerHotspot(e,r,n,o){var s,l;let i=((s=e.hyperlink)==null?void 0:s.url)!==void 0;if(this._multiplayer!=null&&this._multiplayer.isObserving()&&!i||(this._observers.forEach(c=>{c.willTriggerHotspot(e,r,n,o)}),this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:e.node.stablePath().toString(),name:e.node.name(),interaction:r.id(),action:n,timeRecorded:Date.now(),currentFrameName:(l=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:l.name(),canvasViewSpaceMousePosition:o==null?void 0:this._canvasSpacePoint(o).toJSON()}),r==null||r.actions().length==0))return;!dd.seenOldStateManagementInteraction()&&r.stateManagementVersion()==0&&(Re.trackDefinedEvent("prototype.viewer_old_noodle_used",{}),dd.markOldStateManagementInteractionSeen());let a=e.node.getResolvedVariableModesForPrototype();for(let c=0,d=r.actions().length;c<d;c=c+1){let u=r.actions()[c],p=u.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&Re.trackEvent("prototype_view_interaction",{type:"triggerHotspot",transitionAction:lt[n],transitionType:u==null?void 0:u.transitionType(),action:p=="INTERNAL_NODE"?u==null?void 0:u.navigationType():p=="UPDATE_MEDIA_RUNTIME"?u==null?void 0:u.mediaAction():p,nonInteraction:0}),U.getViewerMode()==U.ViewerMode.MIRROR&&Re.trackDefinedEvent("mobile_platform.first_prototype_interaction_mirror",{});let _=e.node.id();if(e.node.isOrInInstance()){let h=e.node.findContainingPrimaryInstance();h&&h.id()&&(_=h.id())}this._sequentialActionManager.appendHotspotActionToQueue(e,r,n,o,u,p,[c],a,_)}this._sequentialActionManager.runNextAction()}runSequentialAction(e,r,n,o,i,a,s,l,c){let d=!0;switch(a){case"INTERNAL_NODE":{let u=i.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(e.node,u,n,r,o,s),i.navigationType()=="SCROLL_TO"&&i.transitionType()!="SCROLL_ANIMATE"||(d=!1);break}case"URL":{e.hyperlink==null?this.onURLClicked(i.connectionURL(),i.openUrlInNewTab()):this._navigateToHyperlink(e,i.navigationType());break}case"BACK":{this.requestBack(e.node,r,1,lt.fromInteractionType(r.event().interactionType()),Sn.fromPrototypeAction(i,r.stateManagementVersion()),i,o),d=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(e.node,r,1,i),d=!1;break}case"SET_VARIABLE":{let u=v();if(u.fonts().isWaitingForFontList())return;let p=i.targetVariableID()?u.getICActionsForSetVariableAction(c,i.targetVariableID(),i.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),l):[];if(p.length>0){let _=po.instance.setReverseVariantBindingsForICsDisabled(!0);for(let h of p){let m=e.node.scene().findNode(h.nodeToSwap),A=m.prototypeInteractions()[h.interactionIndex];this.runSequentialAction(new Ki(m),A,0,null,A.actions()[h.actionIndex],"INTERNAL_NODE",[h.actionIndex],l,c)}po.instance.setReverseVariantBindingsForICsDisabled(_),d=!1}if(i.targetVariableID()){let _=U.getFeatureFlags().prototype_log_run_action?performance.now():0,h=v().runSetVariable(c,i.targetVariableID(),i.targetVariableData(),l);if(this._appState.prototypeState().createMultiplayerSetVariableAction(c,i.targetVariableID(),h,l),U.getFeatureFlags().prototype_log_run_action){let g=performance.now()-_;Re.trackDefinedEvent("prototype.run_action",{action:"SET_VARIABLE",interaction_type:r.event().interactionType(),time_in_ms:g})}}break}case"SET_VARIABLE_MODE":{let u=i.targetVariableSetID()?i.targetVariableSetID():i.deprecatedTargetVariableSetKey()?v().sceneGraphTsApi().getVariableSetIDByKey(i.deprecatedTargetVariableSetKey()):null,p=i.targetVariableModeID();if(u===null){console.warn(`SET_VARIABLE_MODE action has ${!!i.targetVariableSetID()} targetVariableSetID and ${!!i.deprecatedTargetVariableSetKey()} deprecatedTargetVariableSetKey, and was not able to resolve the final setID. Cannot set variable mode.`);break}if(p===null){Nn.logw("PrototypeState","SET_VARIABLE_MODE action has no targetVariableModeId. Cannot set variable mode.");break}let _=U.getFeatureFlags().prototype_log_run_action?performance.now():0;if(v().runSetVariableMode(c,u,p),U.getFeatureFlags().prototype_log_run_action){let g=performance.now()-_,m=v().sceneGraphTsApi().getVariableSetInfoForSetModeAnalytics(u);Re.trackDefinedEvent("prototype.run_action",{action:"SET_VARIABLE_MODE",interaction_type:r.event().interactionType(),time_in_ms:g,...m})}let h=Ga.fromString(u);if(h===null){Nn.logw("PrototypeState","Cannot create multiplayer set variable mode action: invalid variable set ID",{targetVariableSetId:u});break}this._appState.prototypeState().createMultiplayerSetVariableModeAction(c,h,p);break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(i,e.node.id());break}case"CONDITIONAL":{if(v().fonts().isWaitingForFontList()||i.conditionalActions().length==0)return;let u=v().getFirstTruthyConditionalIndex(c,i.conditionalActions()[0].condition());if(u>=0&&u<i.conditionalActions().length){let _=i.conditionalActions()[u].actions();for(let h=0,g=_.length;h<g;h=h+1){let m=_[h],A=[s[0],u,h];this._sequentialActionManager.insertHotspotActionInQueue(e,r,n,o,m,m.connectionType(),A,h,l,c)}}break}default:console.error(`Unhandled connection type: ${a}`)}d&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(e,r,n){var i;let o=(i=this._appState.scene())==null?void 0:i.findNode(e);o!=null&&this.triggerHotspot(new Ki(o),r,n,null)}_findPrototypeActionGivenActionIndexPath(e,r){let n=e.actions(),o=r[0];if(o<n.length){let i=n[o];if(r.length>2){let a=r[1],s=r[2];if(i.conditionalActions()!=null&&i.conditionalActions().length>a){let l=i.conditionalActions()[a];if(l.actions()!=null&&l.actions().length>s)return l.actions()[s]}}return i}return null}_performNavigationOrOverlayChangeForHotspot(e,r,n,o,i,a){var l;this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=i==null;let s=this._findPrototypeActionGivenActionIndexPath(o,a);if(e==null&&Nn.logw("PrototypeState","Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),e==null||s.navigationType()=="NAVIGATE"||s.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null){let c=U.getFeatureFlags().prototype_log_run_action?performance.now():0;if(this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,e,1,0,n,o,s),U.getFeatureFlags().prototype_log_run_action){let d=performance.now()-c;Re.trackDefinedEvent("prototype.run_action",{action:"NAVIGATE",interaction_type:o.event().interactionType(),time_in_ms:d})}}else if(s.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(r,o);else if(s.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(r,e,0,n,o,s);else if(s.navigationType()=="SWAP"){let c=U.getFeatureFlags().prototype_log_run_action?performance.now():0;if(this._appState.prototypeState().swapTopOverlay(r,e,n,o,s),U.getFeatureFlags().prototype_log_run_action){let d=performance.now()-c;Re.trackDefinedEvent("prototype.run_action",{action:"SWAP",interaction_type:o.event().interactionType(),time_in_ms:d})}}else if(s.navigationType()=="SWAP_STATE"){if(v().fonts().isWaitingForFontList())return;let c=(l=dr.whichInstanceToSwap(e,s.transitionNodeID()))==null?void 0:l.stablePath();if(c!=null){let d=U.getFeatureFlags().prototype_log_run_action?performance.now():0;if(this._appState.prototypeState().swapInstanceToState2(c,r,e,n,o,1,s),U.getFeatureFlags().prototype_log_run_action){let u=performance.now()-d;Re.trackDefinedEvent("prototype.run_action",{action:"SWAP_STATE",interaction_type:o.event().interactionType(),time_in_ms:u})}}}}requestBack(e,r,n,o,i,a,s){var l;this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:e.stablePath().toString(),name:e.name(),interaction:r?r.id():"-1:-1",action:o,timeRecorded:Date.now(),currentFrameName:(l=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:l.name(),canvasViewSpaceMousePosition:s==null?void 0:this._canvasSpacePoint(s).toJSON()}),this._appState.prototypeState().returnToState2(e,r,n,o,i,a)}handleHsmAborted(e,r){this._renderer.abortHsmTransition(e,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath);let n=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,o=>(n.push(this._appState.scene().findNodeByStablePath(o)),0)),this._onCommitOrAbortForInteractions(n,r.cause,r.oldStateId())}handleHsmCommitted(e,r,n){this._renderer.commitHsmTransition(e,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath);let o=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,i=>(o.push(this._appState.scene().findNodeByStablePath(i)),0)),n(()=>{this._onCommitOrAbortForInteractions(o,r.cause,r.oldStateId())})}handleHsmRequested(e,r){dd.newStateManagementRulesEnabledForChange(r)&&this._scrollSyncer.commitCurrentScrollStateToStorage(r)}handleHsmInitiated(e,r){dd.newStateManagementRulesEnabledForChange(r)&&(r.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(r):this._scrollSyncer.resetScrollStateToScene(r));let n=this._multiplayer!=null&&this._multiplayer.isObserving(),o=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),r,n);this._renderer.triggerHsmTransition(e,r,o),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath)}handleStateChangeAborted(e){this._updateCanvasForCurrentBaseScreen();let r=null,n=[];X.equals(e.oldStateId(),e.newStateId())||n.push(e.oldStateId());let o=e.oldOverlayData(),i=e.newOverlayData();for(let a=0,s=o.length;a<s;a=a+1)(a>=i.length||!X.equals(o[a].id,i[a].id))&&n.push(o[a].id);if(r=n.map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode(a)}).filter(a=>a!=null),!X.equals(e.oldStateId(),e.newStateId())&&this.onBaseScreenIdChanged!=null){let a=this._appState.scene().findNode(e.newStateId()),s=a==null?void 0:a.isSymbol();this.onBaseScreenIdChanged(e.oldStateId(),lt.getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState(),s)}e.isObjectAnimation()?this._renderer.handleAbortedObjectAnimation(e):this._renderer.handleAbortedTransition(e),this._updateViewportForCurrentPreview(),this._appState.currentScalingInfo().fitMode=="free"&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(r,e.cause,e.oldStateId())}handleStateChangeCommitted(e,r){this._updateCanvasForCurrentBaseScreen(),e.isObjectAnimation()?this._renderer.handleCommittedObjectAnimation(e):this._renderer.handleCommittedTransition(e);let n=e.getNewOrChangedFrames(this._appState.scene()),o=this._appState.scene().findNode(this._appState.prototypeState().getTopmostScreenId());o!=null&&no(o,i=>(i!=o&&i.isInstance()&&n.push(i),0)),r(()=>{this._onCommitOrAbortForInteractions(n,e.cause,e.oldStateId())})}handleStateChangeInitiated(e){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!U.isInlinePreview()){console.warn("no current TLF after receiving update");return}if(this.setPhysicsForOS(this.getRelevantOS()),e.isObjectAnimation())this._renderer.triggerObjectAnimation(e,this._viewport);else{let n=this._multiplayer!=null&&this._multiplayer.isObserving(),o=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),e,n);this._renderer.triggerTransition(e,this._viewport,o)}if(this.setPhysicsForOS(this.getRelevantOS()),!X.equals(e==null?void 0:e.oldStateId(),e==null?void 0:e.newStateId())&&this.onBaseScreenIdChanged!=null){let n=this._appState.scene().findNode(e.newStateId()),o=n==null?void 0:n.isSymbol();this.onBaseScreenIdChanged(e.newStateId(),lt.getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState(),o)}let r=this._appState.prototypeState();if(e.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(e),e.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(e):this._scrollSyncer.resetScrollStateToScene(e);else if(e.preserveScroll()==1)ge.matchNodesAndPreserveScroll(this,r,e);else{let n=e.getNewOrChangedFrames(this._appState.scene());for(let o of n)this._resetScrollForTlf(o)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentScalingInfo().fitMode=="free"&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(e){}handleFitModeChange(e,r){this._appState.baseScreenNode()!=null&&!Rx(this._appState.prototypeState().getCurrentScalingInfo())&&(this._appState.activePrototypeDevice()!=null&&Al.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new F(0,0))),this._renderer.changeFitMode(r.fitMode),this.onScalingModeChanged!=null&&this.onScalingModeChanged(r),(e.contentScalingMode=="responsive"||r.contentScalingMode=="responsive")&&(this.maybeAbortStateChanges("CanvasView.handleFitModeChange"),this.resetResponsiveState()),this._setCurrentViewportSizeOnCanvas()}resetResponsiveState(e){var r;(r=v())==null||r.resetLocalNodeSizeChanges(e??null)}handleRestartPrototype(){this._scrollSyncer.uninit(),this.cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let e=this._appState.baseScreenNode();(e==null?void 0:e.canvas())!=null&&(this._appState.setActiveCanvas(e.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let e=this._appState.currentScalingInfo(),r=this._appState.activePrototypeDevice(),n=this._renderer.currentCanvasSpaceFrameBounds(),o=this._renderer.currentCanvasSpacePreviewBounds();n!=null&&o!=null?this._viewport.updateForCurrentPreview(n,o,e,r):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),e,r)}_updateResponsiveSizeForCurrentBaseScreen(){var c;if(this._appState.currentScalingInfo().contentScalingMode!=="responsive")return;let e=this._appState.baseScreenNode();if(e==null||e.isSymbol())return;let r=this._appState.baseScreenId(),n=this._appState.storedPrototypeDevice(),o=n&&n.type==="PRESET",i=e.fullSize(),a=null;if(o&&U.getViewerMode()!==U.ViewerMode.MIRROR){let d=ge._canvasSpaceBoundsOfDeviceBackground(e,n);if(d.isEmpty()&&!this._loggedInvalidFramePresetSize){this._loggedInvalidFramePresetSize=!0,Nn.logw("PrototypeState",`responsive viewer (inline preview ${U.isInlinePreview()}): frame preset size does not exist for device`);return}a=d.size()}else a=this.window().size();!i.floatEquals(a,1)&&((c=v())==null||c.modules().prototype.updateResponsiveSize(r,a.x()||1,a.y()||1))}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(e){X.equals(e.node.id(),this._appState.baseScreenId())?e.property==58?this._updateCanvasForCurrentBaseScreen():e.property==75&&this._updateViewportForCurrentPreview():e.property==60&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice(e.oldVal)),this._handleScrollingPropertyChange(e.node,e.property,e.oldVal,e.newVal),e.property!=45&&this._viewport.invalidate()}handleAction(e,r){switch(e){case 1:{if(U.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{if(U.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{if(U.isInlinePreview())break;this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),wn.addUpdate(_r.windowResize(this.events()),e=>{this._resize()}),wn.addUpdate(_r.windowFrame(this.window().events()),e=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let e=xn.new2();return e.translate2(this._viewport.viewSpaceBounds().topLeft()),e.multiply(this._viewport.canvasSpaceToViewSpace1()),e}_tryResizingTo(e){this._viewport.setBounds(new L(0,0,e.x(),e.y())),this._updateViewportForCurrentPreview();let r=this._renderer.resize(e.x(),e.y(),this._viewport.zoomScale(),si());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),r}_resize(){let e=this.absoluteBounds(),r=Ae.FrozenVector_new4(e.width(),e.height()),n=this._tryResizingTo(r),o=n.canvasSize;if(n.webGLDidAdjustCanvasSize){let i=this._tryResizingTo(o).canvasSize}this._appState.currentScalingInfo().contentScalingMode==="responsive"&&this.maybeAbortStateChanges("CanvasView._resize")}maybeAbortStateChanges(e){let r=this._appState.prototypeState().getInitiatedChange(),n=r&&r.oldStateId()!=null;this.renderingIsComplete()&&this.isTopLevelTransitionOngoing()&&n&&(this._appState.prototypeState().mostRecentFixInvalidStateInitiator=e,this._appState.prototypeState().abortStateChange())}_setCurrentViewportSizeOnCanvas(){let e=this._appState.baseScreenNode();if(e==null)return;let r=e.findContainingCanvasOrSelf();if(r==null)return;let n=null,o=this._appState.prototypeState().getCurrentFitMode();if(o=="contain"||o=="scale-down"||o=="contain-with-zoom")n=Ae.FrozenVector_INFINITY;else if(o=="scale-down-width"||o=="fit-width"){let i=this._viewport.getScaleFactorForCurrentTlf(e.fullSize(),this._appState.prototypeState().getCurrentScalingInfo(),r.prototypeDevice()),a=this._viewport.viewSpaceBounds().size().y()/i;n=new F(1/0,a)}else this._viewport.viewSpaceBounds()!=null&&(n=this._viewport.viewSpaceBounds().size());n!=null&&!r.currentViewportSize().equals(n)&&r.setCurrentViewportSize(n)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){var o,i,a;this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let e=this._appState.getActiveCanvas();if(e==null)return;this._clampDirtyScrollContainers(),ge._scrollAnimationManager!=null&&this._updateForAnimation(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),this._viewport.prepareForRendering(),this._updateResponsiveSizeForCurrentBaseScreen(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let r=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!r){if(this._sequentialBlankFrameStartTimestamp==null){let c=this._appState.prototypeState(),d=this._appState.scene(),u=(o=this._multiplayer)==null?void 0:o.scene(),p=this._appState.baseScreenNode(),_=((i=this._multiplayer)==null?void 0:i.nodeId())||X.invalid(),h=(a=this._appState.prototypeStructure())==null?void 0:a.getDestinationFrame(_);this._blankFrameLoggingEventParameters={hasScene:!!d,hasBaseScreenId:!!c.getCurrentBaseScreenId(),hasBaseScreen:!!p,baseScreenVisible:!!(p!=null&&p.visible()),hasMultiplayerScene:!!u,appStateAndMultiplayerScenesMatch:d===u,hasDestinationFrame:!!h,destinationFrameIsTopLevel:!!(h!=null&&h.isTopLevel()),destinationFrameIsVisibleInCanvas:!!(h!=null&&h.isVisibleInCanvas()),destinationFrameIsStateGroup:!!(h!=null&&h.isStateGroup()),destinationFrameIsGroup:!!(h!=null&&h.isGroup()),destinationFrameIsImmutableFrame:!!h&&!!er.isImmutableFrame(h==null?void 0:h.type()),mostRecentBaseScreenIdChangeInitiator:c.mostRecentBaseScreenIdChangeInitiator,mostRecentFixInvalidStateInitiator:c.mostRecentFixInvalidStateInitiator,baseScreenWasValidDestinationBeforeNodeChanges:c.baseScreenWasValidDestinationBeforeNodeChanges(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced}}let s=performance.now();this._sequentialBlankFrameStartTimestamp??(this._sequentialBlankFrameStartTimestamp=s);let l=s-this._sequentialBlankFrameStartTimestamp>1e3;if(!U.isInlinePreview()&&l){this._sequentialBlankFrameStartTimestamp=1/0;let c=this._renderer.getContext();c!=null&&c.isVisible()&&(Re.trackDefinedEvent("prototype.draw_blank",this._blankFrameLoggingEventParameters),U.getFeatureFlags().prototype_blank_frame_report_error&&Nn.logw("PrototypeState","drawing blank frames for >1s"))}this._renderer.drawBlank()}else this._sequentialBlankFrameStartTimestamp=null,this._appState.renderDots()?this._uiRenderData.backgroundColor=N.WHITE:this._uiRenderData.backgroundColor=kf(this._appState.baseScreenId(),this._appState.currentScalingInfo().fitMode,this._appState.prototypeState().showTransparentBackground(),e),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer==null?null:this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer==null?null:this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),this.mostRecentFrameNum()&&this.mostRecentFrameNum()%300==0&&(this._renderer.reclaimTileStack(),this._renderer.resetTileStackUsage()),Re.perfTimerScope("rendererDraw",Re.ProfileLevel.LEGACY,()=>{let s=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);this._idlenessTracker.setPreviousRenderStatus(s)}),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this._multiplayer!=null&&this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress());this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&r&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let e=i=>{let a=i.canvasSpaceScrolledInteractiveBounds(1),s=i.canvasSpaceScrolledInteractiveBounds(0);return new hh(a,s)},r=this._appState.prototypeState(),n=this._appState.baseScreenNode();if(!(!this._showHotspots||!r.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&n!=null){let i=(s,l)=>{var u;let c=l.event().interactionType(),d=(u=l.action())==null?void 0:u.value;if(c=="ON_MEDIA_HIT"||c=="ON_MEDIA_END")return!1;if(l.actions().length==1&&d.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(c)!=-1)return!1;if(s!=null)return dr.whichInstanceToSwap(s,d==null?void 0:d.transitionNodeID())!=null}return!0},a=r.getTopmostOverlayNode();if(a!=null){let s=r.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(a,0,i).map(l=>{let c=e(l),d=s.overlaySpaceToBaseTlfSpace2(n,c.canvasSpaceBounds),u=s.overlaySpaceToBaseTlfSpace2(n,c.canvasSpaceClipBounds);return new hh(d,u)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(n,1,i).map(e)}return null}hitTestDeviceFrame(e){let r=this._appState.getActiveCanvas();if(r==null)return!1;let n=this._appState.baseScreenNode();if(n==null)return!1;let o=this._renderer.deviceRenderer();if(o==null||!o.canRenderDeviceFrame(r.prototypeDevice()))return!1;let i=o.pixelAtPosition(e,n.canvasSpaceBoundingBox(),r.prototypeDevice());return N.alpha(i)>0}hitTestBaseScreen(e){let r=this._appState.baseScreenNode();if(r==null)return 0;let n=this._canvasSpacePoint(e),o=r.canvasSpaceBoundingBox();return o.contains2(n)?o.leftThird().contains2(n)?1:o.rightThird().contains2(n)?3:2:0}_canvasSpacePoint(e){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(e.clone())}canvasContentBounds(){var e;return(e=this._appState.getActiveCanvas())==null?void 0:e.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(e){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(e)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let e=this._cachedAbsoluteBounds,r=e.clone();r.setWidth(r.width()-1),this._cachedAbsoluteBounds=r,this._resize(),this._cachedAbsoluteBounds=e,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(e){return e}_setupInteractionHandlers(e){let r=i=>a=>{Re.perfTimerScope("discreteUserAction",Re.ProfileLevel.LOW,()=>{i(a)})},n=i=>a=>{Re.perfTimerScope("mouseMove",Re.ProfileLevel.LOW,()=>{i(a)})},o=i=>a=>{Re.perfTimerScope("dragUserAction",Re.ProfileLevel.LOW,()=>{i(a)})};wn.addUpdate(_r.mousePress(this.events()),r(i=>{this._pointerEventDelegate.onMousePress(this._nonNull(i.asMouseEvent()))})),wn.addUpdate(_r.mouseDrag(this.events()),o(i=>{this._pointerEventDelegate.onDrag(this._nonNull(i.asMouseEvent()))})),wn.addUpdate(_r.mouseRelease(this.events()),r(i=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(i.asMouseEvent()))})),wn.addUpdate(_r.mouseMove(this.events()),n(i=>{this._pointerEventDelegate.onMouseMove(this._nonNull(i.asMouseEvent()))})),wn.addUpdate(_r.mouseScroll(this.events()),o(i=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(i.asMouseEvent()))})),wn.addUpdate(_r.mouseLeave(this.window().root().events()),r(i=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(i.asMouseEvent()))})),wn.addUpdate(_r.touchPress(this.events()),r(i=>{this._pointerEventDelegate.onTouchPress(this._nonNull(i.asTouchEvent()))})),wn.addUpdate(_r.touchDrag(this.events()),o(i=>{this._pointerEventDelegate.onDrag(this._nonNull(i.asTouchEvent()))})),wn.addUpdate(_r.touchRelease(this.events()),r(i=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(i.asTouchEvent()))})),wn.addUpdate(_r.keyPress(this.events()),r(i=>{this._pointerEventDelegate.onKeyPress(i.asKeyEvent(),e)})),wn.addUpdate(_r.gamepadDown(this.events()),r(i=>{this._pointerEventDelegate.onGamepadDown(i.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(e){let r=this._appState.prototypeState(),n=r.getStateMachineInitiatedChange(e)??r.getStateMachineLastChangeInHistory(e);n!=null&&n.cause==2?this._hoveredStateInstances.set(e.toString(),n):this._hoveredStateInstances.delete(e.toString())}_onCommitOrAbortForInteractions(e,r,n){if(this._triggerPotentialTimedTransition(e,r),this._createVideoTriggerEvents(e),this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(e.map(o=>o.id())),n!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let o=!this._mostRecentTransitionViaArrowsLegacy,i=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&um(()=>{this.handleInteractionsForMove(i,o)})}}_createCallbackForMediaEvent(e,r,n){return()=>{this.triggerHotspot(e,r,n,null)}}_createVideoTriggerEvents(e){var r,n;if(this._appState.prototypeState().interactionsEnabled())if(U.viewerCreateVideoTriggersOpt()){let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaHitInteractionMap();for(let a of o.hotspots()){let s=o.getHotspotInteractions(a),l=(r=this._appState.scene())==null?void 0:r.findNode(a);if(l==null||s==null)return;for(let c of e)if(c.isAncestorOf(l)){this._createMediaHitEvents(s,new Ki(l));break}}let i=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaEndInteractionMap();for(let a of i.hotspots()){let s=i.getHotspotInteractions(a),l=(n=this._appState.scene())==null?void 0:n.findNode(a);if(l==null||s==null)return;for(let c of e)if(c.isAncestorOf(l)){this._createMediaEndEvents(s,new Ki(l));break}}}else{let o=new Set([lt.mapToInteractionType(20),lt.mapToInteractionType(21)]),i=s=>o.has(s.event().interactionType()),a=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(e),0,i);for(let s of a)this._registerMediaEventsForHotspot(s)}}_createMediaHitEvents(e,r){for(let n of e){let o=n.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(n,r.node.id(),o,this._createCallbackForMediaEvent(r,n,20))}}_createMediaEndEvents(e,r){for(let n=0,o=e.length;n<o;n=n+1){let i=e[n],a=this._createCallbackForMediaEvent(r,i,21);if(this._appState.videoManager().addInteractionEvent(i,r.node.id(),0,a),n+1<e.length){let s=e[n+1];if(this._shouldTriggerVariantInteractionWithMediaAction(i,s)){let l=this._createCallbackForMediaEvent(r,s,21);this._appState.videoManager().addInteractionEvent(s,r.node.id(),0,l)}}}}_registerMediaEventsForHotspot(e){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,lt.mapToInteractionType(20));this._createMediaHitEvents(r,e);let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,lt.mapToInteractionType(21));this._createMediaEndEvents(n,e)}_triggerPotentialTimedTransition(e,r){if(!this._appState.prototypeState().interactionsEnabled())return;let n=[],o=[],i=e.filter(s=>!e.some(l=>l&&l!==s&&l.isAncestorOf(s)));for(let s of i){let l=this._appState.prototypeStructure().findHotspotsWithInteractionType(s,0,"AFTER_TIMEOUT");for(let c of l){let d=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(c.node,lt.mapToInteractionType(1));for(let u of d)n.push(u),o.push(c.node)}}let a=0;n.forEach(s=>{var A;let l=o[a];a=a+1;let c=s.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),d=c!=null?(A=dr.whichInstanceToSwap(l,c.transitionNodeID()))==null?void 0:A.stablePath():null,u=this._appState.prototypeState(),p=d!=null?u.actionCountersForStateAndAncestors(d):[u.actionCounter()],_=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),h=l.stablePath(),g=()=>{var O;let S=(O=this._appState.scene())==null?void 0:O.findNodeByStablePath(h);if(S==null)return;let T=d!=null?u.actionCountersForStateAndAncestors(d):[u.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==_&&le.List_equalsWithComparison(p,T,(f,I)=>f==I)&&this.triggerDelayedHotspot(S.id(),s,1)},m=s.event().transitionTimeout()*1e3|0;(r==18||r==19)&&(m=Math.max(500,m)),setTimeout(g,m)})}updateCursorType(e,r){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(jt.isMobile(this.getRelevantOS())){this.setCursor(2);return}let n=this._appState.prototypeState().getTopmostScreen();if(n==null){this.setCursor(0);return}let o=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK",vo.getNodeInteractionPairs("ON_CLICK",r));o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS",vo.getNodeInteractionPairs("ON_PRESS",r))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",vo.getNodeInteractionPairs("MOUSE_DOWN",r))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP",vo.getNodeInteractionPairs("MOUSE_UP",r))),o!=null&&!X.equals(o.node.id(),n.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(e,r,n){var p;if(!this._appState.prototypeState().interactionsEnabled()||r==null)return;let o=e.node.id(),i=r.event().interactionType();if(this._maintainedData.getByHotspotAndInteractionType(o,i)!=null)return;let a=this._maintainedData.set(o,i,n),s=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),l=s!=null?(p=dr.whichInstanceToSwap(e.node,s.transitionNodeID()))==null?void 0:p.stablePath():null,c=l!=null?this._appState.prototypeState().actionCounterForState(l):-1,d=this._appState.prototypeState().actionCounter();setTimeout(()=>{var R;let _=this._maintainedData.getByHotspotAndInteractionType(o,i);if(_==null)return;let h=_.counter(),g=l!=null?this._appState.prototypeState().actionCounterForState(l):-1,m=this._appState.prototypeState().actionCounter(),A=(R=this._appState.scene())==null?void 0:R.findNode(o),S=a==h,T=S&&d==m&&c==g;S&&this._maintainedData.resetEntry(o,i),T&&A!=null&&this.triggerDelayedHotspot(A.id(),r,_.action())},r.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(e,r){let n=this._canvasSpacePoint(e);this._mouseEnteredNodesManager.updateEnteredNodes(n,r),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let o=ge.WasHandled.NOT_HANDLED,i=this._appState.prototypeState().actionCounter(),a=this._appState.prototypeState(),s=a.getTopmostOverlayNode(),l=this._appState.baseScreenNode(),c=s??l,d=a.getSecondTopmostOverlayNodeOrBaseScreen(),u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,g=>g.event().interactionType()=="MOUSE_LEAVE",vo.getNodeInteractionPairs("MOUSE_LEAVE",r));if(d!=null){let g=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(d,0,m=>m.event().interactionType()=="MOUSE_LEAVE");ln(u,g)}let p=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,g=>g.event().interactionType()=="MOUSE_ENTER",vo.getNodeInteractionPairs("MOUSE_ENTER",r)),_=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(u);for(let g of _){let m=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(g.node,"MOUSE_LEAVE"),A=this._appState.prototypeState().actionCounter();if(i!=A)return o;o=this._triggerOrHandleMaintainedInteractions(m,g,13,e)}let h=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(p);for(let g of h){let m=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(g.node,"MOUSE_ENTER"),A=this._appState.prototypeState().actionCounter();if(i!=A)return o;o=this._triggerOrHandleMaintainedInteractions(m,g,12,e)}return o}handleInteractionsForMove(e,r){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;let n=this._appState.prototypeState().getTopmostScreen(),o=this._appState.prototypeStructure().getInteractionsGroupedByType([n]);this.updateCursorType(e,o);let i=this._handleMouseEnterMouseLeave(e,o);r&&(i=this._handleGranularMoveForDeprecatedMouseInMouseOut(e,o)),i==ge.WasHandled.NOT_HANDLED&&r&&(this._handleHover1(e,o),this._handleReverseHover(e))}_handleGranularMoveForDeprecatedMouseInMouseOut(e,r){let n=10,o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_IN",vo.getNodeInteractionPairs("MOUSE_IN",r));if(o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_OUT",vo.getNodeInteractionPairs("MOUSE_OUT",r)),n=11),this._maintainedData.resetAllEntriesMatchingPredicate((a,s)=>["MOUSE_IN","MOUSE_OUT"].indexOf(s)!=-1&&!X.equals(o!=null?o.node.id():null,a)),o==null)return ge.WasHandled.NOT_HANDLED;let i=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,lt.mapToInteractionType(n));return this._triggerOrHandleMaintainedInteractions(i,o,n,e)}_handleHover1(e,r){let n=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_HOVER",vo.getNodeInteractionPairs("ON_HOVER",r));return this._handleHover2(n,e)}handleHoverAtHotspot(e){return this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,this._handleHover2(e,null)}_handleHover2(e,r){if(e!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,lt.mapToInteractionType(2));for(let o of n)return this.triggerHotspot(e,o,2,r),o.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(e){var o;let r=e.node,n=qe.StringMap_get(this._hoveredStateInstances,e.node.stablePath().toString(),null);return n==null||!X.equals((o=r.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?ge.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(n.stablePath,2,6),ge.WasHandled.HANDLED)}_handleReverseHover(e){var m,A;if(this._multiplayer!=null&&this._multiplayer.isObserving())return ge.WasHandled.HANDLED;let r=this._appState.prototypeState(),n=ge.WasHandled.NOT_HANDLED,o=[];for(let S of Array.from(this._hoveredStateInstances.keys())){let T=qe.StringMap_get(this._hoveredStateInstances,S,null);if(T==null){o.push(S);continue}let R=this._appState.scene().findNodeByStablePath(T.stablePath);if(R==null)continue;let b=(m=T==null?void 0:T.canvasSpaceTriggerBoundsOrNull)==null?void 0:m.clone();if(!X.equals((A=R.topLevelAncestor())==null?void 0:A.id(),r.getTopmostScreenId()))continue;let O=r.getCurrentBaseScreenNode();if(b!=null&&O!=null){let f=null,I=this._canvasSpacePoint(e),y=this._appState.prototypeState().getTopmostOverlay();if(f=(y==null?void 0:y.baseTlfSpaceToOverlaySpace1(O,I))??I,R.scrollAndClipBoundsBySelfAndAncestors(b,0).contains2(f))continue;r.returnInstanceToState(T.stablePath,2,6),o.push(S),n=ge.WasHandled.HANDLED}}for(let S of o)this._hoveredStateInstances.delete(S);if(n==ge.WasHandled.HANDLED)return n;let i=this._appState.prototypeState().getInitiatedChange()??this._appState.prototypeState().getLastChangeInHistory(),a=i==null?void 0:i.canvasSpaceTriggerBoundsOrNull;if(!(a!=null&&i.cause==2))return ge.WasHandled.NOT_HANDLED;let l=null;if(l=this._appState.scene().findNode(i==null?void 0:i.oldStateId()),l==null)return ge.WasHandled.NOT_HANDLED;let c=null,d=this._canvasSpacePoint(e);X.equals(i==null?void 0:i.oldStateId(),i==null?void 0:i.newStateId())||(d=this._canvasSpacePointInPreviousFrame(l,this._appState.baseScreenNode(),d));let u=i==null?void 0:i.oldOverlays(this._appState.prototypeState());u.length>0?c=le.List_last(u).baseTlfSpaceToOverlaySpace1(l,d):c=d;let p=i!=null?i.interactionAddress.hotspotStablePath:null,_=this._retrieveReverseInteractionHotspotFromStoredData(p);if(_==null||_.scrollAndClipBoundsBySelfAndAncestors(a,0).contains2(c))return ge.WasHandled.NOT_HANDLED;let g=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(p),lt.mapToInteractionType(2));for(let S of g){if(S.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(_,S,2,6,null,null,e),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(e){return this._appState.scene().findNodeByStablePath(e)}handleInteractionsForPress(e){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP");let r=this._handleMouseDown(e);return r==ge.WasHandled.NOT_HANDLED&&(r=this._handlePress(e)),r}_handleMouseDown(e){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN");if(r==null)return ge.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,lt.mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(n,r,8,e)}_handlePress(e){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS");if(r==null)return ge.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,lt.mapToInteractionType(3));for(let o of n){let i=r.node.stablePath(),a=o.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(a!=null){let s=dr.whichInstanceToSwap(r.node,a.transitionNodeID());this._lastPressData=new dA(s==null?void 0:s.stablePath(),i)}else this._lastPressData=new dA(null,i);return this.triggerHotspot(r,o,3,e),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(e){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().isLinear()){let o=this.hitTestBaseScreen(e);if(o!=0&&o!=2){let i=o==1?-1:1;return i==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&Re.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:i==1?"FORWARD":"REVERSE",inputType:"tap",nonInteraction:0,prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString()}),!0}}return!1}handleInteractionsForRelease(e,r,n){let o=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN");let i=this._appState.prototypeState().isDragging(),a=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());if(this._interactionObservers.forEach(d=>{d.handleRelease(a)}),i)return this._appState.prototypeState().setIsDragging(!1),ge.WasHandled.HANDLED;let s=this._handleMouseUp(e);s==ge.WasHandled.NOT_HANDLED&&r&&(s=this._handleClick(e)),s==ge.WasHandled.NOT_HANDLED&&(s=this._handleReversePress(o));let l=s==ge.WasHandled.NOT_HANDLED,c=n==ge.WasHandled.NOT_HANDLED;return l&&c&&Jl.notifyUnhandledMouseRelease(this._appState,a),s}_handleMouseUp(e){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP");if(r==null)return ge.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,lt.mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(n,r,9,e)}_handleReversePress(e){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer!=null&&this._multiplayer.isObserving())return ge.WasHandled.HANDLED;if(e==null)return ge.WasHandled.NOT_HANDLED;if(e.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(e.swappedStablePath,2,7),ge.WasHandled.HANDLED;{let r=e.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(e.hotspotStablePath):null,n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r,lt.mapToInteractionType(3));for(let o of n)return this.requestBack(r,o,2,7,null,null,null),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}_handleSlideshowNavigation(e,r,n){let o=n.filter(i=>{let a=i.actions();for(let s of a)if(s.navigationType()=="NAVIGATE"&&s.connectionType()=="INTERNAL_NODE")return!1;return!0});if(o.length>0)o.forEach(i=>{this.triggerHotspot(r,i,4,e)});else{if(jt.isMobile(this.getRelevantOS()))return ge.WasHandled.NOT_HANDLED;if(this._appState.prototypeState().getTransitionOnClick())this.navigateForward(4);else return ge.WasHandled.HANDLED}return ge.WasHandled.HANDLED}_handleClick(e){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;this._appState.prototypeState().disengageObservationOnClick()&&this.disengageObservationMode();let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK"),n=(r==null?void 0:r.node)||null,o=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n,lt.mapToInteractionType(4));if(this._appState.prototypeStructure().navigationOrderType()==2)return this._handleSlideshowNavigation(e,r,o);if(!this._appState.prototypeState().getTransitionOnClick())return ge.WasHandled.HANDLED;for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(this.triggerHotspot(r,s,4,e),i+1<o.length){let l=o[i+1];this._shouldTriggerVariantInteractionWithMediaAction(s,l)&&this.triggerHotspot(r,l,4,e)}return ge.WasHandled.HANDLED}if(this._shouldCloseTopmostOverlayOnClickOutside(e)){let i=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(i,1),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}handleInteractionsForDrag(e){let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN");this._maintainedData.resetAllEntriesMatchingPredicate((o,i)=>i=="MOUSE_DOWN"&&!X.equals(r!=null?r.node.id():null,o));let n=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());this._interactionObservers.forEach(o=>{o.handleDrag(n)})}handleDragStart(e,r,n){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return ge.WasHandled.HANDLED;if(r==null)return ge.WasHandled.NOT_HANDLED;let o=this._appState.prototypeStructure().findPrototypeInteractionWithId(r!=null?r.id():null,n);if(o==null)return ge.WasHandled.NOT_HANDLED;this.triggerHotspot(new Ki(r),o,5,e),this._appState.prototypeState().setIsDragging(!0);let i=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());return this._interactionObservers.forEach(a=>{a.handleDragStart(i)}),ge.WasHandled.HANDLED}handleInteractionsForScroll(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._lastPressData!=null&&(this._handleReversePress(this._lastPressData),this._lastPressData=null)}handleFling(e,r){var l;let n=r.length,o=Ze.seconds(),i=this._appState.getActiveCanvas();if(i==null)return ge.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let a=(l=i.scene())==null?void 0:l.findNode(e),s=50*si();this._initialFlingVelocity=new F(0,0);for(let c=n-1;c>=0;c=c-1)if(c==0||o-r[c-1].startTime>.1){let d=r[c],u=r[n-1],p=u.startLocation.subtract(d.startLocation).divideScalar(u.startTime-d.startTime),_=p.length(),h=Math.log(1+_)/5,g=_*h/5,m=p.multiplyScalar(g/_);if(d!=u&&_>s)if(a==null||a==i)this._viewport.flingCameraOffset(m,h);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(a,p).negative();let A=ge._scrollPhysics.createBallisticScrollSimulation(a.scrollOffset(),this._initialFlingVelocity,a.minScrollOffsetX(),a.maxScrollOffsetX(),a.minScrollOffsetY(),a.maxScrollOffsetY());return A!=null&&(ge._scrollAnimationManager=new Hu(A,a.id())),ge.WasHandled.HANDLED}break}return ge.WasHandled.NOT_HANDLED}handleInteractionsForLeave(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN"),this.handleInteractionsForMove(Ae.FrozenVector_new4(-1,-1),!0)}handleInteractionsForKeyPress(e){let r=this._appState.prototypeState().getTopmostScreen(),n=this._appState.prototypeStructure().findHotspotsWithInteractionType(r,0,"ON_KEY_DOWN"),o=this._createListFromKeyEvent(e),i=s=>(s=jt.current()!=4&&s==this.META_CODE?this.CONTROL_CODE:s,o.some(l=>l.indexOf(s)!=-1)),a=s=>{let l=s.event().keyTrigger().triggerDevice=="KEYBOARD",c=s.event().keyTrigger().keyCodes;if(c==null)return!1;let d=c.length==o.length;return l&&d&&c.every(i)};for(let s of n){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(s.node,lt.mapToInteractionType(14)).filter(a);for(let d=0,u=c.length;d<u;d=d+1){let p=c[d];if(this.triggerHotspot(s,p,14,null),d+1<c.length){let _=c[d+1];this._shouldTriggerVariantInteractionWithMediaAction(p,_)&&this.triggerHotspot(s,_,14,null)}return e.accept(),ge.WasHandled.HANDLED}}return ge.WasHandled.NOT_HANDLED}_createListFromKeyEvent(e){let r=[];return 1&e.modifiers()&&r.push([this.ALT_CODE]),4&e.modifiers()&&r.push([this.SHIFT_CODE]),2&e.modifiers()&&r.push([this.META_CODE]),8&e.modifiers()&&r.push([this.CONTROL_CODE]),Pp.Key_isModifier(e.key)||r.push(Pp.Key_keyToKeyCode(e.key)),r}handleInteractionsForGamepadDown(e){let r=this._appState.prototypeState().getTopmostScreen(),n=i=>{let a=i.event().keyTrigger().triggerDevice!="KEYBOARD";return i.event().keyTrigger().keyCodes==null?!1:a&&i.event().keyTrigger().keyCodes.indexOf(e.button)!=-1},o=this._appState.prototypeStructure().findHotspotsWithInteractionType(r,0,"ON_KEY_DOWN");for(let i of o){let s=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(i.node,lt.mapToInteractionType(14)).filter(n);for(let l=0,c=s.length;l<c;l=l+1){let d=s[l];if(this.triggerHotspot(i,d,14,null),l+1<s.length){let u=s[l+1];this._shouldTriggerVariantInteractionWithMediaAction(d,u)&&this.triggerHotspot(i,u,14,null)}return e.accept(),ge.WasHandled.HANDLED}}return ge.WasHandled.NOT_HANDLED}addInteractionObserver(e){this._interactionObservers.add(e)}removeInteractionObserver(e){this._interactionObservers.remove(e)}_hotspotAtViewportSpacePointWithInteractionType(e,r,n){let o=this._appState.prototypeStructure().navigationOrderType()===2;if(!this._appState.prototypeState().getTransitionOnClick()&&!o)return null;let i=this._canvasSpacePoint(e);return this._hotspotAtCanvasSpacePointWithInteractionType(i,r,n)}_hotspotAtCanvasSpacePointWithInteractionType(e,r,n){let o=this._appState.baseScreenNode();if(o==null||!o.canvasSpaceBoundingBox().contains2(e)&&r!="MOUSE_OUT")return null;let i=this._appState.prototypeState(),a=i.getTopmostOverlayNode();if(a!=null){let s=i.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(o,e);return this._appState.prototypeStructure().hotspotOnPresentedNode(a,s,r,n)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(o,e,r,n)}_canvasSpacePointInPreviousFrame(e,r,n){if(e==r)return n;let o=r.absoluteTransform().clone();if(!o.invert())return n;let i=e.absoluteTransform(),a=n.clone();return o.transformPoint(a),i.transformPoint(a),a}updateUserCursor(e){this._currentMouseLocation=e==null?void 0:e.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(e){let r=this._appState.prototypeState().getTopmostOverlay(),n=this._appState.prototypeState().getTopmostOverlayNode(),o=this._appState.baseScreenNode();if(o==null||n==null||r.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let i=this._canvasSpacePoint(e),a=r.baseTlfSpaceToOverlaySpace1(o,i);return!n.canvasSpaceBoundingBox().contains2(a)}recordViewportSpaceClick(e){if(this._multiplayer==null)return;let r=this._canvasSpacePoint(e);this._multiplayer.recordCanvasSpaceClick(r)}_sendMouseCursorUpdate(){if(this._multiplayer!=null)if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let e=this._canvasSpacePoint(this._currentMouseLocation);e!=null&&this._multiplayer.setCanvasSpaceMouse(e)}}triggerMouseAction(e,r){this._appState.triggerAction2(e,r)}_triggerOrHandleMaintainedInteractions(e,r,n,o){for(let i=0,a=e.length;i<a;i=i+1){let s=ge.WasHandled.NOT_HANDLED,l=e[i];if(l.event().interactionMaintained()?(this._handleMaintainedInteraction(r,l,n),s=ge.WasHandled.MAINTAINED):(this.triggerHotspot(r,l,n,o),s=ge.WasHandled.HANDLED),i+1<e.length){let c=e[i+1];this._shouldTriggerVariantInteractionWithMediaAction(l,c)&&(l.event().interactionMaintained()?(this._handleMaintainedInteraction(r,c,n),s=ge.WasHandled.MAINTAINED):(this.triggerHotspot(r,c,n,o),s=ge.WasHandled.HANDLED))}return s}return ge.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(e,r){let n=e.allActions().length>=1&&e.allActions().every(l=>l.connectionType()=="UPDATE_MEDIA_RUNTIME"),o=e.allActions().length>=1&&e.allActions().every(l=>X.isValid(l.transitionNodeID())),i=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),a=i!=null&&i.connectionType()=="INTERNAL_NODE",s=n&&o&&a;return s&&U.getFeatureFlags().prototype_log_video_and_ic_swap&&Re.trackEvent("prototype_interaction_conflict_override_triggered",{interaction_type:e.event().interactionType(),action_type:e.actions().map(l=>l.mediaAction())}),s}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:ge._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(e){if(e!=null){this.updateScrollOffsetForNode(e,Ae.FrozenVector_ZERO);let r=e.scrollableFrameDescendants();for(let n of r)this.updateScrollOffsetForNode(n,Ae.FrozenVector_ZERO)}}getBestScrollOrDragProposal(e,r,n){let o=this._appState.getActiveCanvas();if(o==null)return null;if(this._appState.currentScalingInfo().fitMode=="min-zoom"&&this._viewport.zoomScale()!=1)return new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.SCROLL,1,o==null?void 0:o.id(),null);let i=this._canvasSpacePoint(r);if(i==null||this._appState.baseScreenNode()==null)return null;let a=null;e==ge.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(a=(l,c)=>Lr.computeDragVector1(l,c,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let s=this._appState.prototypeState().getCurrentOverlays();for(let l=0,c=s.length;l<c;l=l+1){let d=s[s.length-l-1],u=d.node();if(u==null)continue;let p=d.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),i);if(!u.canvasSpaceBoundingBox().contains2(p)){if(d.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let _=ge.findBestScrollOrDragProposalInFrame(o,p,n,u,this._appState.activePrototypeDevice(),a);return X.equals(_==null?void 0:_.targetNodeId,o==null?void 0:o.id())?null:_}return ge.findBestScrollOrDragProposalInFrame(o,i,n,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),a)}_updateForAnimation(){if(ge._scrollAnimationManager==null)return;let e=!ge._scrollAnimationManager.isValid(this._appState.scene());e||(ge._scrollAnimationManager.performScroll(this,this._appState.scene()),e=ge._scrollAnimationManager.isDone()),e&&(this.cancelAnimationManager(),this._sequentialActionManager.runNextAction())}cancelAnimationManager(){ge._scrollAnimationManager=null}maybeHandleOverdragRelease(){var n;if(ge._overscrolledNodeID==null)return;let e=(n=this._appState.scene())==null?void 0:n.findNode(ge._overscrolledNodeID);ge._overscrolledNodeID=null,!(e==null||ge.clampScrollOffsetForNode(e,e.scrollOffset()).equals(e.scrollOffset()))&&(ge._scrollAnimationManager=new Hu(new Du(e.scrollOffset(),new F(0,0),e.minScrollOffsetX(),e.maxScrollOffsetX(),e.minScrollOffsetY(),e.maxScrollOffsetY()),e.id()))}setPhysicsForOS(e){switch(kO(e)){case 0:{ge._scrollPhysics=new $_;break}case 1:{ge._scrollPhysics=new eh;break}case 2:{ge._scrollPhysics=new Cu;break}}}_maybeChangePhysicsForDevice(e){let r=this.getRelevantOS(),n=ge._getRelevantOSForDevice(e);r!=n&&this.setPhysicsForOS(r)}updateScrollOffsetForNode(e,r){let n=ge.clampScrollOffsetForNode(e,r),o=this.restrictScrollDeltaAxes(e,r),i=this._pointerEventDelegate.isDragging();if(e.scrollOffset().equals(n)&&(!i||e.scrollOffset().equals(r)))return!1;if(i&&!n.equals(r)){let s=ge._scrollPhysics.applyOverscrollBehavior(o,n,e.scrollOffset(),e.size());s.equals(n)||(ge._overscrolledNodeID=e.id(),n=s)}e.setScrollOffset(n),this._observers.forEach(s=>{s.didScrollNode(e)}),this._emitter.trigger("scrollNode",e.id());let a=e.id();return this._multiplayer!=null&&this._multiplayer.setScrollPosition(a,e.scrollOffset()),!0}setScrollOffsetUnconditionally(e,r){e.setScrollOffset(r);let n=e.id();this._multiplayer!=null&&this._multiplayer.setScrollPosition(n,r)}restrictScrollDeltaAxes(e,r){let n=r.clone();switch(e.scrollDirection()){case"HORIZONTAL":{n.setY(0);break}case"VERTICAL":{n.setX(0);break}case"NONE":{n.setX(0),n.setY(0);break}case"BOTH":{let o=null;switch(e.overflowDirection()){case"NONE":{o="NONE";break}case"HORIZONTAL":{o="HORIZONTAL";break}case"VERTICAL":{o="VERTICAL";break}case"BOTH":{o="BOTH";break}}!Xn.scrollsHorizontally(o)&&!e.hasOverflowingContentInXDirection()&&n.setX(0),!Xn.scrollsVertically(o)&&!e.hasOverflowingContentInYDirection()&&n.setY(0);break}}return n}scrollToDestinationInFrame(e,r){var i;let n=this._appState.scene().findNode(e),o=(n==null?void 0:n.parent())??null;for(;o!=null&&!((o.scrollDirection()!="NONE"||o.isTopLevel())&&!o.isTooRotatedToScroll());)o=o.parent();if(o!=null){let a=(i=r.action())==null?void 0:i.value;for(let c of r.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))a=c;let s=Sn.fromPrototypeAction(a,r.stateManagementVersion()),l=n.absoluteTransform().translation().add(s.extraScrollOffset).subtract(o.absoluteTransform().translation());if(a.transitionType()=="SCROLL_ANIMATE"){let c=ge.clampScrollOffsetForNode(o,l);ge._scrollAnimationManager=new Hu(new th(o.scrollOffset(),c,s.transitionDuration,s.easingFunction),o.id())}else this.updateScrollOffsetForNode(o,l)}}scrollNode(e,r,n,o){var l,c,d;let i=(l=this._appState.scene())==null?void 0:l.findNode(e);if(i==null)return!1;if(this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:i.stablePath().toString(),name:i.name(),scrollOffset:n.toJSON(),action:tS,timeRecorded:Date.now(),currentFrameName:(c=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:c.name(),canvasViewSpaceMousePosition:o==null?void 0:this._canvasSpacePoint(o).toJSON()}),ge._scrollAnimationManager!=null&&ge._scrollAnimationManager.isOverscrolled()){let u=ge._scrollAnimationManager;if(i.id()!=u.nodeID()){let p=(d=this._appState.scene())==null?void 0:d.findNode(u.nodeID());p!=null&&p.setScrollOffset(u.simulation().endPos())}this.cancelAnimationManager()}else ge._scrollAnimationManager!=null&&r!=ge.ScrollSource.FLING&&this.cancelAnimationManager();if(i.isTooRotatedToScroll()||i.scrollDirection()=="NONE")return!1;let a=i.scrollOffset().clone();i.scrollDirection()=="HORIZONTAL"?a.setX(a.x()+(n.x()==0&&r==ge.ScrollSource.SCROLL_EVENT?n.y():n.x())):a.addUpdate1(n);let s=this.updateScrollOffsetForNode(i,a);return this.disengageObservationMode(),s}async exportVideos(e,r,n,o){var c,d,u;(c=this._multiplayer)==null||c.disconnect();let i=[],a=[],l=this.isDesktopApp()&&e.length>1;try{for(let p of e){await this._navigateToNodeForExport(p),await this._waitForNavigationComplete();let _=A=>{o==null||o(p.toString(),A)},h=await this._timelineManager.exportVideo({nodeId:p,videoVolumeByNodeId:r,videoTrimValuesByNodeId:n,onProgress:_}),g=(d=this._appState.scene())==null?void 0:d.findNode(p),m=(g==null?void 0:g.name())||"";l?a.push({buffer:h,name:m}):this.downloadVideo(h,m),i.push(h),o==null||o(p.toString(),1)}l&&a.length>0&&await this.downloadVideosAsZip(a)}finally{(u=this._multiplayer)==null||u.attemptReconnect()}return i}cancelVideoExport(){this._timelineManager.cancelCurrentTimelineActions()}downloadVideo(e,r){let n=new Blob([e],{type:"video/mp4"}),o=window.URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=`${r}.mp4`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)}isDesktopApp(){return!!window.__figmaDesktop}async downloadVideosAsZip(e){try{let r;try{r=(Vg(),Oi(Ug))}catch{throw new Error("zip.js not available")}let n=new r.ZipWriter(new r.BlobWriter("application/zip")),o=new Set;for(let l of e){let c=l.name||"video",d=`${c}.mp4`,u=1;for(;o.has(d);)d=`${c} (${u}).mp4`,u++;o.add(d),await n.add(d,new r.Uint8ArrayReader(new Uint8Array(l.buffer)))}let i=await n.close(),a=window.URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=`videos_${new Date().toISOString().split("T")[0]}.zip`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(r){console.error("Failed to create zip file, falling back to individual downloads:",r);for(let n of e)this.downloadVideo(n.buffer,n.name)}}async _navigateToNodeForExport(e){this._appState.prototypeState().navigateToFrameAndCloseOverlays(e,null,2,0,0)}async _waitForNavigationComplete(){return new Promise(e=>{let r=()=>{if(this._appState.prototypeState().getInitiatedChange()===null){e();return}setTimeout(r,16)};r()})}_updateScrollOffsetsFromMultiplayer(){var r,n;let e=((r=this._multiplayer)==null?void 0:r.getScrollPositions())||new Map;if(e!=null)for(let o of Array.from(e.keys())){let i=X.fromString(o),a=(n=this._appState.scene())==null?void 0:n.findNode(i);a!=null&&a.setScrollOffset(e.get(o))}}_clampDirtyScrollContainers(){let e=this._appState.scene();if(e==null)return;let r=new Set;for(let n of Array.from(ge._dirtyNodesForScrollClamping.values())){let o=e.findNode(n);for(let i=o;i!=null&&!(r.has(i.id())||i!=o&&er.isFrameLike(i.type())&&i.clipsToBoundingRectangle());i=i.parent())i.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(i,i.scrollOffset()),r.add(i.id())}ge._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(e,r,n,o){if(r==49)e.setScrollOffset(Ae.FrozenVector_ZERO);else if(r==75||r==70)ge._dirtyNodesForScrollClamping.add(e.id());else if(r==60){let i=this._appState.baseScreenNode();i!=null&&this.updateScrollOffsetForNode(i,i.scrollOffset())}else r==73&&(this._renderer.updateScroll(e),this._emitter.trigger("scrollEvent"))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}static findBestScrollOrDragProposalInTree(e,r,n,o,i){let a=o==0,s=null;return s=(l,c)=>{let d=l.canvasSpaceGeometryBounds().contains2(c),u=l.canvasSpaceBoundingBox().contains2(c);if(l.clipsToBoundingRectangle()&&!d&&!u)return null;let p=null;for(let T=0,R=l.childCount();T<R;T=T+1){let b=l.childAt2(l.childCount()-T-1,!0),O=c,f=Wa.getScrollTranslationOfNodeRelativeToParent(b);O=c.add(f);let I=s(b,O);p=(p==null?void 0:p.updateToBestProposal1(I))??I}let _=l.scrollDirectionWithScrollableContent(),h=u||d,g=_!="NONE"&&h&&!l.isInvisibleOrTransparent(),m=h&&l.visible()&&l.prototypeInteractions().some(T=>T.event().interactionType()=="DRAG"&&T.allActions().some(R=>H_.isValidForConnection(T.event().interactionType(),R.connectionType()))),A=r.length()>0?r.divideScalar(r.length()):r,S=null;if(h){if(g){let T=_L(_),R=ge.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(A.y())>0&&Math.abs(T.y())>0&&(A.y()>0?l.scrollOffset().y()<l.maxScrollOffsetY():l.scrollOffset().y()>l.minScrollOffsetY())&&(R=ge.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(A.x())>0&&Math.abs(T.x())>0&&(A.x()>0?l.scrollOffset().x()<l.maxScrollOffsetX():l.scrollOffset().x()>l.minScrollOffsetX())&&(R=ge.ScrollOrDragProposal.InteractionType.SCROLL);let b=Xn.getDirectionSimilarity(_,A);(R==ge.ScrollOrDragProposal.InteractionType.SCROLL||a)&&(S=new ge.ScrollOrDragProposal(R,b,l.id(),null))}if(i!=null&&m){let T=A.multiplyScalar(-1);for(let R of l.prototypeInteractions().filter(b=>b.event().interactionType()=="DRAG")){let b=i(l,R),O=b!=null?T.dot(b.divideScalar(b.length())):0;S=(S==null?void 0:S.updateToBestProposal2(ge.ScrollOrDragProposal.InteractionType.DRAG,O,l.id(),R.id()))??new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.DRAG,O,l.id(),R.id())}}}return S=(p==null?void 0:p.updateToBestProposal1(S))??S,S},s(n,e)}static _canvasSpaceBoundsOfDeviceBackground(e,r){let n=go.infoForDevice(r);if(n==null)return ar.FrozenRect_EMPTY;let o=e.canvasSpaceBoundingBox().topLeft(),i=r.canvasSpaceFramePresetSize(n);return new L(o.x(),o.y(),i.x(),i.y())}static findBestScrollOrDragProposalInFrame(e,r,n,o,i,a){if(o==null)return null;let s=i!=null&&Al.hasDevice(i.type),l=kO(ge._getRelevantOSForDevice(i)),c=Math.abs(n.y())>Math.abs(n.x())?"VERTICAL":"HORIZONTAL",d=o.scrollsInPreferredDirection(c)&&o.hasOverflowingContentInScrollDirection();if(o.canvasSpaceBoundingBox().contains2(r)){let u=ge.findBestScrollOrDragProposalInTree(r,n,o,l,a);if(u!=null)return u;if(s)return null}else if(s){if(ge._canvasSpaceBoundsOfDeviceBackground(o,i).contains2(r))return null}else if(d)return new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.SCROLL,1,o.id(),null);return new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.SCROLL,1,e==null?void 0:e.id(),null)}static copyScrollOffset(e,r,n){r!=null&&n!=null&&(e==null?n.setScrollOffset(r.scrollOffset()):e.updateScrollOffsetForNode(n,r.scrollOffset()))}static findMatchingTransitionNode(e,r){let n=r.filter(l=>l.name()==e.name());if(n.length==1)return n[0];let o=e.canvasSpaceBoundingBox(),i=r.filter(l=>l.canvasSpaceBoundingBox().size().approximatelyEquals(o.size(),1));if(i.length==0)return null;if(i.length==1)return i[0];let a=e.topLevelAncestor(),s=o.topLeft();a!=null&&s.subtractUpdate1(a.canvasSpaceBoundingBox().topLeft());for(let l of i){let c=l.canvasSpaceBoundingBox().topLeft(),d=l.topLevelAncestor();if(d!=null&&c.subtractUpdate1(d.canvasSpaceBoundingBox().topLeft()),s.approximatelyEquals(c,1))return l}return null}static matchNodesAndPreserveScroll(e,r,n){if(!X.equals(n.oldStateId(),n.newStateId())){let a=r.lastNodeForBaseScreen(),s=r.nextNodeForBaseScreen();ge.findMatchingNodesAndPreserveScroll(e,a,s)}let o=n.oldStateAndOverlays.overlays,i=n.newStateAndOverlays.overlays;for(let a=0,s=Math.min(o.length,i.length);a<s;a=a+1)if(!X.equals(o[a].id,i[a].id)){let l=r.lastNodeForOverlayAt(a),c=r.nextNodeForOverlayAt(a);ge.findMatchingNodesAndPreserveScroll(e,l,c)}}static findMatchingNodesAndPreserveScroll(e,r,n){if(r!=null&&n!=null){ge.copyScrollOffset(e,r,n);let o=r.scrollableFrameDescendants(),i=n.scrollableFrameDescendants();for(let a of o){if(i.length==0)break;let s=ge.findMatchingTransitionNode(a,i);s!=null&&(ge.copyScrollOffset(e,a,s),le.List_removeOne(i,s))}}}static clampScrollOffsetForNode(e,r){if(e.scrollDirection()=="NONE")return Ae.FrozenVector_ZERO.clone();let n=F.new();return e.scrollDirection()=="HORIZONTAL"?n.setX(Fr.Math_clamp(r.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())):e.scrollDirection()=="VERTICAL"?n.setY(Fr.Math_clamp(r.y(),e.minScrollOffsetY(),e.maxScrollOffsetY())):e.scrollDirection()=="BOTH"&&(n.setX(Fr.Math_clamp(r.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())),n.setY(Fr.Math_clamp(r.y(),e.minScrollOffsetY(),e.maxScrollOffsetY()))),n}static _getRelevantOSForDevice(e){return jt.current()==2||jt.current()==1||e==null?jt.current():e.os()==2||e.os()==1?e.os():jt.current()}};ge._scrollPhysics=new Cu,ge._scrollAnimationManager=null,ge._overscrolledNodeID=null,ge._dirtyNodesForScrollClamping=new Set;var bi=ge;(i=>{class t{constructor(s){this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._isPinchGestureConfirmed=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=s}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(s,l){let c=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(l,c),this._dragStart=c,this._isDragGestureConfirmed=!1,this._canvasView.recordViewportSpaceClick(this._dragStart),s.accept(),this._flingPoints=[],this._currentGesture=new pA(c,Ze.seconds(),s.interactionType()),this._lastPointerPressHandled=this._canvasView.handleInteractionsForPress(c),this._lastPointerPressHandled!=0&&(this._lastPointerPressHandledAt=Ze.seconds())}onMousePress(s){this._handleSinglePointerPress(s,6),this._canvasView.cancelAnimationManager()}onTouchPress(s){this._canvasView.cancelAnimationManager(),s.touches.length==1?this._handleSinglePointerPress(s,10):s.accept()}_processPointerRelease(s){var m,A;if(!this._canvasView.appState().prototypeState().interactionsEnabled())return!1;let l=this._isDragGestureConfirmed,c=!l&&this._lastPointerPressHandled!=2,d=l&&this._lastPointerPressHandled==1&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==i.ScrollOrDragProposal.InteractionType.DRAG),u=c||d,p=this._canvasView.handleInteractionsForRelease(s,u,this._lastPointerPressHandled);return(this._isDragging?this._canvasView.handleFling((m=this._activeScrollOrDrag)==null?void 0:m.targetNodeId,this._flingPoints):0)==0&&this._canvasView.maybeHandleOverdragRelease(),!l&&p==0&&this._lastPointerPressHandled==0&&(this._canvasView.appState().prototypeRecorder().isRecording()&&this._canvasView.appState().prototypeRecorder().addHistoricalEvent({type:"MISCLICK",action:4,currentFrameName:(A=this._canvasView.appState().prototypeState().getCurrentBaseScreenNode())==null?void 0:A.name(),canvasViewSpaceMousePosition:this._canvasView.viewport().canvasSpaceToViewSpace1().inverseTransformPoint(new F(s.x(),s.y())).toJSON(),timeRecorded:Date.now()}),this._canvasView.performHotspotAnimationOnClick()),!l&&this._canvasView.appState().scene()!=null&&U.getViewerMode()==U.ViewerMode.MIRROR&&this._canvasView.appState().triggerAction1(5),this._canvasView.updateCursorType(s,null),this._resetDragInfo(),l||p==1||this._lastPointerPressHandled==1}_storeOrProcessPointerReleaseAtPoint(s){if(Ze.seconds()-this._lastPointerPressHandledAt<Lz)this._storedPointerReleasePoint=s;else if(this._processPointerRelease(s))return 1;return this._lastPointerPressHandledAt=0,0}onMouseRelease(s){let l=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(9,l),this._storeOrProcessPointerReleaseAtPoint(l)}onTouchRelease(s){if(this._isPinchGestureConfirmed&&s.touches.length===0&&Re.trackEvent("slides.mobile_web.pinch_to_zoom",{fileKey:this._canvasView.appState().currentFileKey()}),s.touches.length==0&&this._currentGesture!=null){if(this._currentGesture!=null)if(this._currentGesture.endTime=Ze.seconds(),this.isSingleTap()){let l=this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation);this._canvasView.appState().prototypeStructure().navigationOrderType()===2&&l===0?this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):l==0&&this._canvasView.appState().prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation)}else this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation);this._resetDragInfo()}else s.touches.length==0&&this._canvasView.maybeHandleOverdragRelease();this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._isPinchGestureConfirmed=!1}_onPinchToZoom(s){let l=s.asTouchEvent();if(!l)return;let c=l.getPinchScale(),d=l.getPinchCenter();if(c===null||d===null)return;let u=d.subtract(this._canvasView.viewport().viewSpaceBounds().topLeft());this._canvasView.viewport().adjustCameraZoomWithPin(c,u)}onDrag(s){var d;let l=s.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=s.interactionCount()>1||l.distanceTo(this._dragStart)>Fz),this._isDragGestureConfirmed&&s.interactionCount()===2&&this._canvasView.appState().editorType()==="SLIDES"&&s.asTouchEvent().isPinching()){this._isPinchGestureConfirmed=!0,this._onPinchToZoom(s);return}if(this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let u=l.subtract(this._dragStart).multiplyScalar(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(1,this._dragStart,u)}if(!this._canvasView.appState().prototypeState().isDragging()){if(this._isDragGestureConfirmed&&U.getDragToPan()&&this._activeScrollOrDrag!=null){let u=s.delta(),p=(d=this._canvasView.appState().scene())==null?void 0:d.findNode(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case i.ScrollOrDragProposal.InteractionType.SCROLL:case i.ScrollOrDragProposal.InteractionType.OVERSCROLL:{p!=null&&p!=this._canvasView.appState().getActiveCanvas()?this._canvasView.scrollNode(p.id(),1,u.negative().divideScalar(this._canvasView.viewport().zoomScale()),s.locationInView(this._canvasView))&&(this._lastPointerPressHandled=1,this._isDragInteractionLocked=!0,this._canvasView.handleInteractionsForScroll()):this._canvasView.viewport().panCamera(u);break}case i.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView.handleDragStart(l,p,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}s.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new pA(l,Ze.seconds(),s.interactionType())),this._currentGesture.endLocation=l,this._currentGesture.endTime=Ze.seconds())}}this._canvasView.idlenessTracker().handleInteraction(),this._canvasView.handleInteractionsForDrag(l),s.interactionType()==0&&(this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(8,l))}onMouseScroll(s){var p;let l=this._canvasView.appState().getActiveCanvas();if(l==null)return;let c=Ze.seconds();c-this._lastScrollEvent>Dz&&(this._scrollingNodeId=null);let d=s.locationInView(this._canvasView),u=this._canvasView.appState().activePrototypeDevice()!=null&&Al.hasDevice(this._canvasView.appState().activePrototypeDevice().type);if((8&s.modifiers()||2&s.modifiers())&&Pf(this._canvasView.appState().prototypeState().getCurrentScalingInfo(),u))this._canvasView.viewport().adjustCameraZoomWithPin(Math.pow(.99,s.scrollDelta.y()),d.subtract(this._canvasView.viewport().viewSpaceBounds().topLeft())),s.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let _=(p=l.scene())==null?void 0:p.findNode(this._scrollingNodeId);if(_==null){let h=this._canvasView.getBestScrollOrDragProposal(0,d,s.scrollDelta);_=this._canvasView.appState().scene().findNode(h==null?void 0:h.targetNodeId),this._scrollingNodeId=_==null?void 0:_.id()}_==null||(_!=l?(this._canvasView.scrollNode(this._scrollingNodeId,0,s.scrollDelta.divideScalar(this._canvasView.viewport().zoomScale()),null)&&(this._canvasView.handleInteractionsForScroll(),this._canvasView.handleInteractionsForMove(d,!0)),s.accept()):U.getScrollToPan()&&(this._canvasView.viewport().panCamera(s.scrollDelta.negative()),this._scrollingNodeId=l.id(),s.accept(),this._canvasView.handleInteractionsForMove(d,!0)))}this._lastScrollEvent=c,this._canvasView.idlenessTracker().handleInteraction()}onMouseMove(s){let l=s.locationInView(this._canvasView);this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(7,l),this._canvasView.handleInteractionsForMove(l,!0),this._scrollingNodeId=null}onMouseLeave(s){this._canvasView.updateUserCursor(null),this._canvasView.handleInteractionsForLeave()}onKeyPress(s,l){let c=this._canvasView.handleInteractionsForKeyPress(s);U.isInlinePreview()&&c==0&&(s.key==7||s.key==8&&4&s.modifiers())&&l.trigger("requestClose")}onGamepadDown(s){this._canvasView.handleInteractionsForGamepadDown(s)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView.appState().baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}i.CanvasPointerEventDelegate=t;let e;(c=>(c[c.NOT_HANDLED=0]="NOT_HANDLED",c[c.HANDLED=1]="HANDLED",c[c.MAINTAINED=2]="MAINTAINED"))(e=i.WasHandled||(i.WasHandled={}));let r;(l=>(l[l.SCROLL_ONLY=0]="SCROLL_ONLY",l[l.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(r=i.ScrollOrDragQuerySet||(i.ScrollOrDragQuerySet={}));class n{updateToBestProposal1(s){return s!=null&&this.updateToBestProposal2(s.interactionType,s.directionSimilarity,s.targetNodeId,s.targetInteractionId),this}updateToBestProposal2(s,l,c,d){return(this.interactionType==i.ScrollOrDragProposal.InteractionType.OVERSCROLL&&s==i.ScrollOrDragProposal.InteractionType.DRAG||l>this.directionSimilarity)&&(this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=c,this.targetInteractionId=d),this}constructor(s,l,c,d){this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=c,this.targetInteractionId=d}}i.ScrollOrDragProposal=n,(s=>{let a;(u=>(u[u.OVERSCROLL=0]="OVERSCROLL",u[u.SCROLL=1]="SCROLL",u[u.DRAG=2]="DRAG"))(a=s.InteractionType||(s.InteractionType={}))})(n=i.ScrollOrDragProposal||(i.ScrollOrDragProposal={}));let o;(c=>(c[c.SCROLL_EVENT=0]="SCROLL_EVENT",c[c.DRAGGING=1]="DRAGGING",c[c.FLING=2]="FLING"))(o=i.ScrollSource||(i.ScrollSource={}))})(bi||(bi={}));var pA=class{constructor(e,r,n){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=r,this.endLocation=e,this.endTime=r,this.type=n}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<wz)&&this.endTime-this.startTime<xz}},Fz=5,Dz=.2,xz=.4,wz=50,Lz=.1;var Ku=class t{constructor(e,r,n){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=r,this._emitter=Xt.getEventEmitter(),this._session=n,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){var l;if(this._userSyncing==null)return null;let e=[],r=this._userSyncing.userBySessionID(),n=this._session.sessionID(),o=r.get(n),i=o==null?void 0:o.clientID,a=(l=this._session.presenterSessionID())==null?void 0:l.value;o!=null&&e.push(o.toJSON());for(let c of Array.from(this._userSyncing.userBySessionID().values()))if(c.sessionID!=n){if(i!=null&&c.clientID==i){a==c.sessionID&&(a=null);continue}e.push(c.toJSON())}let s=0;if(a!=null&&a==n)for(let c of Array.from(this._userSyncing.userBySessionID().values()))c.sessionID!=n&&c.observedSessions.indexOf(n)!=-1&&(s=s+1);return{deviceNameFilter:this._session.role(),sessionID:n,allUsers:e,followerCount:s,observingSessionID:this._session.observingSessionID(),presenterSessionID:a,presenterIsReconnected:this._session.presenterIsReconnected(),sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}syncObservedVariableActions(e){let r=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&r.resetVariablePrototypeState();let o=n.triggeredSetVariableActionData??[],i=n.triggeredSetVariableModeActionData??[];(r.getSetVariableActionHistoryLength()>o.length||r.getSetVariableModeActionHistoryLength()>i.length)&&r.resetVariablePrototypeState();let a=r.getSetVariableActionHistoryLength();for(let l=0;l<o.length;l++){let c=o[l];(l>=a||c.targetVariableData!==r._setVariableActionHistory[l].targetVariableData)&&r.performMultiplayerSetVariableAction(c)}let s=r.getSetVariableModeActionHistoryLength();for(let l=0;l<i.length;l++){let c=i[l];(l>=s||c.targetVariableModeId!==r._setVariableModeActionHistory[l].targetVariableModeId)&&r.performMultiplayerSetVariableModeAction(c)}}syncObservedVideoState(){let e=this._appState.prototypeState(),r=this._session.observedUser();if(r==null)return;let n=r.videoStateChangeData??[];for(let o=0;o<n.length;o++){let i=n[o];if(!i.targetNodeId)continue;let a=X.fromFigGUID(i.targetNodeId),s=e.getVideoStateChangeForGuid(a);(!s||!this._videoStateEqual(i,s))&&e.performMultiplayerVideoStateChange((s==null?void 0:s.currentTimes)||[],i)}}syncObservedEmbeddedPrototypeState(){let e=this._session.observedUser();if(e==null)return;let r=e.embeddedPrototypeData;for(let n of r){if(n.nodeId==null)continue;let o=X.fromFigGUID(n.nodeId);this._appState.embeddedPrototypeManager().requestPrototype(o),this._appState.embeddedPrototypeManager().setSessionId(o,n.sessionId??null)}}_videoStateEqual(e,r){if(!(!e.targetNodeId&&!r.targetNodeId||e.targetNodeId&&r.targetNodeId&&X.fromFigGUID(e.targetNodeId)===X.fromFigGUID(r.targetNodeId))||e.isPlaying!=r.isPlaying||e.isPlayingSound!=r.isPlayingSound||e.actionTakenTimestamp!=r.actionTakenTimestamp)return!1;let o=e.currentTimes,i=r.currentTimes;return!(!o&&i||o&&!i)}syncObservedFrameOrOverlay(e){if(!this._appState.getActiveCanvas()||!this._appState.getActiveCanvas().scene())return;let r=this._session.observedUser();if(r==null)return;this.applyInstanceStateSwaps(e);let n=this._appState.baseScreenId(),o=this._appState.prototypeState().getCurrentAnimationState();this._applyBaseScreenStateFromDriver(r),this._applyOverlayStateFromDriver(r),(!e||this._appState.prototypeState().getInitiatedChange()==null)&&this._applyObjectAnimationStateFromDriver(r,n,o,e);let i=this._appState.prototypeState();i.getInitiatedChange()!=null&&!e&&(i.mostRecentFixInvalidStateInitiator="MultiplayerCoupler.setPreviewToObservedFrameOrOverlay",i.commitStateChange())}_applyBaseScreenStateFromDriver(e){let r=e.currentFrame;if(r==null||X.equals(this._appState.baseScreenId(),r))return;let n=e.triggeredOverlaysData.length>0,o=n?null:e.lastTriggeredHotspot,i=n?null:e.lastTriggeredPrototypeInteractionID,a=null;if(o!=null&&i!=null)a=this._appState.prototypeStructure().findPrototypeInteractionWithId(o,i);else if(o!=null){let c=this._appState.getActiveCanvas().scene().findNode(o);if(c!=null){let d=An.cleanedInteractionsForNode(this._appState,c);d.length!=0&&(a=d[0])}}let s=this._appState.prototypeStructure().navigationOrder().transitionDirectionBetweenFrames(this._appState.baseScreenId(),r),l=o!=null?this._appState.scene().findNode(o):null;this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,l,1,s,0,a,null)}_applyOverlayStateFromDriver(e){let r=this._appState.prototypeState(),n=this._appState.prototypeStructure(),o=r.getCurrentOverlays(),i=e.triggeredOverlaysData??[];o.length>i.length&&(r.closeOverlayAtAndAbove(i.length,1),o=r.getCurrentOverlays());for(let a=0,s=i.length;a<s;a=a+1){let l=Tt.decodeGUID(i[a].overlayGuid),c=Tt.decodeGUID(i[a].swapGuid),d=Tt.decodeGUID_instanceHACK(i[a].hotspotGuid),u=Tt.decodeGUID(i[a].prototypeInteractionGuid),p=e.lastTriggeredPrototypeInteractionID,_=null;if(u!=null)_=n.findPrototypeInteractionWithId(d,u);else{let g=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(d,c);g.length!=0&&(_=g[0])}if(o.length<=a){let g=this._appState.scene().findNode(d);if(g==null)return;r.overlayFrame(c,g,0,0,_,null),o=r.getCurrentOverlays()}let h=o[a];if(!h){Nn.loge("MultiplayerCoupler","Cannot find overlay for setPreviewToObservedFrameOrOverlay",{driverOverlayId:l,driverOpeningOverlayId:c},{reportAsSentryError:!0,logToConsole:0});continue}if(!X.equals(h.id(),l)||!X.equals(h.overlayDataModelId(),c)){if(a<o.length-1&&r.closeOverlayAtAndAbove(a+1,1),!X.equals(h.overlayDataModelId(),c)){r.closeOverlayAtAndAbove(a,1);let T=this._appState.scene().findNode(d);r.overlayFrame(c,T,0,0,_,null)}let g=this._appState.scene().findNode(h.id()),m=e.lastTriggeredHotspot,A=this._appState.scene().findNode(m);A=g!=null&&g.isAncestorOf(A)?A:null;let S=null;A!=null&&p!=null?S=n.findPrototypeInteractionWithId(A.id(),p):A!=null&&n.nodeTransitionTracker().cleanedUpInteractionMap()._in(A.id())&&(S=n.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(A.id())[0]),r.swapTopOverlay(l,A,0,S,null)}o=r.getCurrentOverlays()}}compareAnimationState(e,r,n,o){if(e.id()!==n.id())return this._appState.prototypeStructure().navigationOrder().compare(e.id(),n.id());if(FO(r,o))return 0;if(r==null)return-1;if(o==null)return 1;let i=n.getObjectAnimationInteractionIndex(o),a=n.getObjectAnimationInteractionIndex(r);return i!==a?a-i:r.actionIndex-o.actionIndex}_applyObjectAnimationStateFromDriver(e,r,n,o){if(!this._appState.prototypeStructure().navigationOrder().shouldSyncObjectAnimations())return;let i=e.currentFrame,a=t.getAnimationStateFromDriver(e);if(X.equals(r,i)&&FO(n,a)||!X.equals(this._appState.baseScreenId(),i))return;let s=this._appState.scene().findNode(i),l=this._appState.scene().findNode(r);if(!s||!l)return;let c=this.compareAnimationState(l,n,s,a)<0?0:1;if(a==null)v().previewSceneAt(i,0,0);else{let u=s.getObjectAnimationInteractionIndex(a),p=s.objectAnimations(),_=p[u];u>=0&&u<p.length&&a.actionIndex>=0&&_&&a.actionIndex<_.getAllActions().length?v().previewSceneAt(i,u,a.actionIndex):Nn.loge("MultiplayerCoupler","Trying to sync invalid object animation state",{driverBaseScreenId:i,driverInteractionIndex:u,interactions:p,actionIndex:a.actionIndex},{reportAsSentryError:!0,logToConsole:0})}let d=this._appState.prototypeState();d.playObjectAnimation(s,a,c),o||d.commitStateChange()}static getAnimationStateFromDriver(e){let r=e.lastTriggeredPrototypeInteractionID,n=e.lastTriggeredObjectAnimationIndex;return r===X.invalid()||n===null||n<0?null:new ti(r,n)}_initiateStateSwap(e){var a;let r=this._appState.prototypeState(),n=Tt.decodeGUIDPath(e.hotspotStablePath),o=(a=this._appState.scene())==null?void 0:a.findNodeByStablePath(n),i=Tt.decodeGUID(e.interactionID);r.swapInstanceToState2(Tt.decodeGUIDPath(e.instanceStablePath),Tt.decodeGUID(e.stateID),o,0,o==null?void 0:o.findPrototypeInteraction(i),1,null)}_commitStateSwap(e){let r=this._appState.prototypeState(),n=Tt.decodeGUIDPath(e.instanceStablePath);r.commitChangesBelowInstanceTransitionRoot(n)}applyInstanceStateSwaps(e){let r=this._session.observedUser();if(r.instanceStateChanges!=null){for(let n of r.instanceStateChanges)n.phase=="INITIATED"&&this._initiateStateSwap(n),(n.phase=="COMMITTED"||!e)&&this._commitStateSwap(n);r.instanceStateChanges=[]}}handleConnect(e,r){this._userSyncing=new ad(this._session.sessionID()),this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=()=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=n=>{var o;n==this._session.observingSessionID()&&((o=this._canvasView)==null||o.viewport().invalidate())}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,r,n){e!=1&&this._emitter.trigger("joinStart")}handleJoinEnd(){var r;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let e=this._appState.getActiveCanvas();e!=null&&(U.isSlidesEmbed()?this._emitter.trigger("prototypeDeviceChanged",e.storedPrototypeDevice().toJSON()):this._emitter.trigger("prototypeDeviceChanged",e.prototypeDevice().toJSON())),(r=this._canvasView)==null||r.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().mostRecentFixInvalidStateInitiator="MultiplayerCoupler.didApplyNodeChanges",this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,r){}handleSceneChangedLoadingPhase(e,r){}onFrame(){this.syncObserved({allowTransitions:!0,isNewObservation:!1})}syncObserved({allowTransitions:e,isNewObservation:r}){this.syncObservedFrameOrOverlay(e),this.syncObservedVariableActions(r),this.syncObservedVideoState(),this.syncObservedEmbeddedPrototypeState()}};var _A;(p=>{function t(_){return _}p._shortcut1=t;function e(_,h){return _|h<<p.MODIFIERS_SHIFT}p._shortcut2=e;function r(_,h,g){return _|h<<p.MODIFIERS_SHIFT|g<<p.FLAGS_SHIFT}p._shortcut3=r;function n(_){return _==="SLIDES"?new Map:new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]])}p.shortcuts=n;function o(_,h){let g=p.shortcuts(h);for(let m of Array.from(g.keys()))for(let A of g.get(m)){let S=A&p.KEY_MASK,T=A>>p.MODIFIERS_SHIFT&p.MODIFIERS_MASK,R=A>>p.FLAGS_SHIFT&p.FLAGS_MASK;a.Flags_currentlyApplies(R)&&(16&T&&(T|=bc.Modifiers_currentPlatformModifier()),Dd.KeyShortcutMap_set(_,S,T,m))}}p.addTo=o;let i;(m=>(m[m.__NONE=0]="__NONE",m[m.MAC=1]="MAC",m[m.NON_MAC=2]="NON_MAC"))(i=p.Flags||(p.Flags={}));let a;(m=>{function _(A){return(1&A)!=0}m.Flags_isMacOnly=_;function h(A){return(2&A)!=0}m.Flags_isNonMacOnly=h;function g(A){return(!_(A)||jt.current()==4)&&(!h(A)||jt.current()!=4)}m.Flags_currentlyApplies=g})(a=p.in_Flags||(p.in_Flags={})),p.KEY_MASK=255,p.MODIFIERS_MASK=255,p.MODIFIERS_SHIFT=8,p.FLAGS_MASK=255,p.FLAGS_SHIFT=16})(_A||(_A={}));var Yu=class{constructor(e,r,n,o){this._shortcuts=new Map,this._window=new Pm(e,r,o==1,()=>U.disableKeyboardHandling(),()=>U.isInlinePreview()),this._appState=new Sr,this._canvasView=new bi(this._appState),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new Es(this._appState,()=>this._window.isActive(),n),this._multiplayerCoupler=new Ku(this._appState,this._canvasView,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),po.instance.setMultiplayer(this._multiplayerSession),ct.initializeJsImpl()}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;wn.addUpdate(_r.keyPress(this._window.root().events()),r=>{e&&(_A.addTo(this._shortcuts,this._appState.editorType()),e=!1);let n=Dd.KeyShortcutMap_get(this._shortcuts,r.asKeyEvent().key,r.modifiers(),0);n!=0&&(this._appState.triggerAction1(n),r.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="App.unloadSceneAndResetPrototypeLib",this._appState.setScene(null),this._multiplayerSession.setScene(null),v()!=null&&(console.debug("Resetting PrototypeLib..."),Yh())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");Kh(new mu(e,this._appState))}connectTo(e,r,n,o,i,a){this._appState.prototypeState().mostRecentFixInvalidStateInitiator="App.connectTo",this._appState.setActivePrototypeStartingPointNodeId(n),this._appState.prototypeState().mostRecentBaseScreenIdChangeInitiator="App.connectTo",this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!o),this._canvasView.setBackgroundEnabled(!o),this._appState.setEditorType(a),this._canvasView.initializeThumbnailInvalidationManager(a),Qt.setImagePrefixURL(`/file/${e}/image`),Qt.setVideoPrefixUrl(`/api/files/${e}/videos`),Qt.setCompressedTexturesAvailabilityURL(`/file/${e}/compressed_texture_available/batch`),U.shouldApplyMobileOptimizations()?Qt.setImageBatchURL(`/file/${e}/image/batch?max_size=2048`):Qt.setImageBatchURL(`/file/${e}/image/batch`),this.canvasView().dangerouslyAccessProtoRenderManager().getContext().supportsCompressedTextures()&&U.shouldUseCompressedTextures()&&Qt.setShouldUseCompressedTextures(!0),this.initializePrototypeLib(i),this._multiplayerSession.connectTo(e,r)}};var ON;(o=>{function t(i){return Array.from(i.values())}o.Set_values=t;function e(i,a){return n(i,a)}o.Set_subtract=e;function r(i){return new Set(i)}o.Set_new1=r;function n(i,a){let s=new Set(Array.from(i.values()));return i.forEach(l=>{a.has(l)&&s.delete(l)}),s}o.Set_difference=n})(ON||(ON={}));var Oh=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let r of e)this._watchedNodeIDs.set(r,!0)}handleSceneChange(e,r){this._scene=r,e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}_isWatchedNode(e){return this._watchedNodeIDs.has(e)}_isAncestorOrSelfOfWatchedNode(e){for(let r of Array.from(this._watchedNodeIDs.keys())){let n=this._scene.findNode(r);for(let o=n;o!=null;o=o.parent())if(X.equals(o.id(),e))return!0}return!1}handleSceneGraphEvent(e){let r=!1;if(e.property==58){let n=e.oldVal!=null&&pt.isParentIndex(e.oldVal)?pt.asParentIndex(e.oldVal):null,o=e.newVal!=null&&pt.isParentIndex(e.newVal)?pt.asParentIndex(e.newVal):null;(n==null||o==null||n.id!=o.id)&&(r=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==70?r=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==75||e.property==73)&&(r=this._isWatchedNode(e.node.id()));r&&this.onChangeCallback!=null&&this.onChangeCallback()}};var ud=class t{toJSON(){let e={nodeId:this.nodeId};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let r=null,n=null,o=null;return e.nodeId!==null&&e.nodeId!==void 0&&(r=X.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(n=new F(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(o=new F(e.canvasPosition.x,e.canvasPosition.y)),new t(r,n,o)}constructor(e,r,n){this.nodeId=e,this.nodeOffset=r,this.canvasPosition=n}},Nh=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new Oh(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,r){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,r){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,r){}_isAncestorOrSelfOfNodeWithComment(e){let r=this._appState.scene();if(r==null)return!1;for(let n of this._nodesWithComments){let o=r.findNode(n);for(let i=o;i!=null;i=i.parent()){let a=i.id();if(X.equals(a,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,r){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let r=e.oldStateAndOverlays.overlays;for(let o=0,i=r.length;o<i;o=o+1){let a=r[o].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let n=e.newStateAndOverlays.overlays;for(let o=0,i=n.length;o<i;o=o+1){let a=n[o].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,r){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let r=this._appState.scene();if(r==null)return null;let n=this._appState.baseScreenNode();if(n==null)return null;let o=this._appState.prototypeState().getCurrentOverlays();for(let a=o.length-1;a>=0;a=a-1){let s=r.findNode(o[a].id());if(s==null)continue;let l=o[a].renderedBounds(n);if(l.contains2(e)){let c=e.subtract(l.topLeft());return new ud(s.id(),c,null)}}let i=e.subtract(n.canvasSpaceBoundingBox().topLeft());return new ud(n.id(),i,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),r=this._appState.prototypeState().getTopmostOverlay();return e!=null&&r!=null?r.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,r){let n={};for(let o of Array.from(r.keys())){let i=r.get(o),a=e.findNode(i.nodeId),s=this._currentCommentsScreen(),l=this._currentCommentsScreenRenderedBounds();if(a==null||s==null||l==null)continue;let c=!1;if(c=s.isAncestorOf(a),!c)continue;let d=a.canvasSpaceScrolledBounds(1).topLeft().subtract(s.canvasSpaceBoundingBox().topLeft()),p=l.topLeft().add(d).add(i.nodeOffset),_={};_.x=p.x(),_.y=p.y(),n[o]=_}return n}};var mA;(A=>{function t(S,T){let R=new Gr("NONZERO",0,Lt.forCenterStrokeAroundRect(S,T),S);return new Ur([R],null,R.bounds(),null)}A.strokeGeometryForRect=t;function e(S,T){if(Math.abs(N.redF(S)-N.redF(T))+Math.abs(N.greenF(S)-N.greenF(T))+Math.abs(N.blueF(S)-N.blueF(T))+Math.abs(N.alphaF(S)-N.alphaF(T))>.01)throw new Error(`Colors are too different ${N.toString(S)} ${N.toString(T)}`)}A.assertColorRoughlyEquals=e;function r(S,T,R){var O,f;let b=Vd(S);return b.setTestOnlyFillPaints([$.createSolid(N.BLACK,R)]),b.setTestOnlyFillGeometry(wF(T)),je(b,(O=b.fillGeometry())==null?void 0:O.bounds.topLeft(),(f=b.fillGeometry())==null?void 0:f.bounds.size()),b}A.createStaticVectorWithMultipleRegions=r;function n(S,T,R,b){S.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),m.GeometryType_hasFill(T)&&S.setTestOnlyFillGeometry(la(R)),m.GeometryType_hasStroke(T)&&(S.setTestOnlyStrokeGeometry(t(R,b)),S.setStrokeWeight(b)),je(S,R.topLeft(),R.size())}A.addPaintsAndGeometry=n;function o(S,T,R,b){let O=qr(S);return n(O,T,R,b),O}A.createRectangleWithPaintsAndGeometry1=o;function i(S,T,R){return o(S,T,R,1)}A.createRectangleWithPaintsAndGeometry2=i;function a(S,T,R,b,O){let f=FF(S,T);return n(f,R,b,O),f}A.createRoundedRectangleWithPaintsAndGeometry1=a;function s(S,T,R,b){return a(S,T,R,b,1)}A.createRoundedRectangleWithPaintsAndGeometry2=s;function l(S,T,R,b,O,f,I,y,P,E){let C=new Gr("NONZERO",0,At.fromRect(R),R),B=new Ur([C],null,C.bounds(),null),G=pn(S,"RECTANGLE");return G.setTestOnlyFillGeometry(B),G.setTestOnlyFillPaints(b),G.setTestOnlyStrokeGeometry(B),G.setTestOnlyStrokePaints(O),G.setStrokeAlign(f),G.setStrokeWeight(10),G.setStrokeJoin("MITER"),G.setStrokeMiterLimit(4),G.setTestOnlyEffects([Oe.createDropShadow(I,y,P,E)]),G}A.createRoundedRectangleWithStrokeFillAndDropShadow=l;function c(S,T){let R=qr(S);R.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]);let b=T.topLeft().x(),O=T.topLeft().y(),f=T.width(),I=T.height(),y=new Gr("NONZERO",0,Lt.new2().moveTo1(b,O).lineTo(b+f,O).lineTo(b+f,O+I).lineTo(b,O+I-1).close(),T),P=new Ur([y],null,y.bounds(),null);return R.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),R.setTestOnlyFillGeometry(P),R.setTestOnlyStrokeGeometry(P),je(R,T.topLeft(),T.size()),R}A.createNonRectangleInNode=c;function d(S,T,R){let b=S.canvasSpaceBoundingBox();switch(R){case"INSIDE":case"OUTSIDE":{S.setTestOnlyStrokeGeometry(t(b,T*2));break}case"CENTER":{S.setTestOnlyStrokeGeometry(t(b,T));break}}S.setStrokeAlign(R)}A.setStrokeForRect=d;function u(){let S=AssertLib.deepStrictEqual,T=new Js("./src/test/rendertree.test.ts");Ct("generateRenderTree",()=>{let R=Me.createSceneWithCanvasForTests1(),b=R.root().childAt1(0),O=()=>{R=Me.createSceneWithCanvasForTests1(),b=R.root().childAt1(0),b.setPrototypeDevice(Wn.DEFAULT)};beforeEach(O),he("simple rect",()=>{var I;let f=i(b,0,new L(0,0,100,100));return T.asyncAssertMatchesSnapshot("should emit single fill",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("simple rounded rect",()=>{var I;let f=s(b,10,0,new L(0,0,100,100));return T.asyncAssertMatchesSnapshot("should emit single rounded rect fill",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("rounded rect symbol",()=>{var I;let f=Ba(b);return n(f,0,new L(0,0,100,100),0),f.setIsFrameMaskDisabled(!0),f.setCornerRadius(10),T.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("rounded rect instance",()=>{var y;let f=Ba(b),I=yl(b,f);return n(I,0,new L(0,0,100,100),0),I.setIsFrameMaskDisabled(!0),I.setCornerRadius(10),T.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),Jc("simple vector with multiple regions",()=>{var P,E;let f=[],I=r(b,[new L(0,0,10,10),new L(20,20,10,10)],.5);f.push(T.asyncAssertMatchesSnapshot("should emit single fill",((P=I.renderTree1())==null?void 0:P.debugString1())??""));let y=r(b,[new L(0,0,10,10),new L(5,5,10,10)],.5);return f.push(T.asyncAssertMatchesSnapshot("should emit multiple fills",((E=y.renderTree1())==null?void 0:E.debugString1())??"")),Promise.all(f)}),he("multiply blend mode",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setBlendMode("MULTIPLY"),T.asyncAssertMatchesSnapshot("should emit fill with blend mode",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("foreground blur",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyEffects([Oe.createForegroundBlur(4)]),T.asyncAssertMatchesSnapshot("should emit foreground blur",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("foreground blur w/ radius zero",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyEffects([Oe.createForegroundBlur(0)]),T.asyncAssertMatchesSnapshot("blur should be ellided",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("foreground blur disabled",()=>{var y;let f=i(b,0,new L(0,0,100,100)),I=Oe.createForegroundBlur(4);return I.setIsEnabled(!1),f.setTestOnlyEffects([I]),T.asyncAssertMatchesSnapshot("blur should be ellided",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur",()=>{var y;i(b,0,new L(25,25,50,50)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let I=i(b,0,new L(0,0,100,100));return I.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur on partially transparent node",()=>{var P;let f=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(f),i(b,0,new L(25,25,50,50)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let y=i(b,0,new L(0,0,100,100));return y.setTestOnlyFillPaints([$.createSolid(N.BLACK,.5)]),y.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("background blur should be emitted",((P=y.renderTree1())==null?void 0:P.debugString1())??"")}),he("rectangle won't show up in the background blur",()=>{var E;let f=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(f),i(b,0,new L(0,0,10,10)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let y=Xe(b);y.setTestOnlyFillPaints([$.createSolid(N.BLACK,.5)]),je(y,new F(0,0),new F(10,10));let P=i(y,0,new L(0,0,10,10));return P.setTestOnlyFillPaints([$.createSolid(N.GREEN,.5)]),P.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",((E=y.renderTree1())==null?void 0:E.debugString1())??"")}),Ct("noise effect",()=>{he("noise with size greater than 1",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createNoise("MONOTONE","NORMAL",new F(2.4,2.4),1,N.WHITE,N.BLACK,.25,123)]),T.asyncAssertMatchesSnapshot("noise should emitted",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("noise with size less than 1",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createNoise("MONOTONE","NORMAL",new F(.4,.4),1,N.WHITE,N.BLACK,.25,123)]),T.asyncAssertMatchesSnapshot("noise should be wrapped in SSAA group",((I=f.renderTree1())==null?void 0:I.debugString1())??"")})}),Ct("grain effect",()=>{he("grain with size greater than 1",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createGrain(new F(2.4,2.4),!0,1,123)]),T.asyncAssertMatchesSnapshot("grain should be emitted",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("grain with size less than 1",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createGrain(new F(.4,.4),!0,1,123)]),T.asyncAssertMatchesSnapshot("grain should be wrapped in SSAA group",((I=f.renderTree1())==null?void 0:I.debugString1())??"")})}),Ct("scrolling frames",()=>{he("wrap scrollable layers in a volatile property binding",()=>{var P;let I=Xe(b);return I.setOverflowDirection("VERTICAL"),je(I,new F(0,0),new F(100,100)),i(I,0,new L(0,0,100,200)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]),T.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",((P=I.renderTree1())==null?void 0:P.debugString1())??"")}),he("wrap scrollable layers with non-isolated blends with a group",()=>{let I=Xe(b);I.setOverflowDirection("VERTICAL"),je(I,new F(0,0),new F(100,100));let y=i(I,0,new L(0,0,100,200));y.setBlendMode("MULTIPLY"),y.setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let P=I.renderTree1();return T.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",(P==null?void 0:P.debugString1())??"")}),Jc("fixed layers and their descendants should be re-positioned",()=>{var C,B,G;let I=[];b.setPrototypeDevice(new Wn("CUSTOM",new F(100,100),"","NONE"));let y=Xe(b);je(y,new F(0,0),new F(100,500));let P=Xe(y);return P.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),P.setVerticalConstraint("MAX"),je(P,new F(0,400),new F(100,100)),i(P,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]),I.push(T.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",((C=y.renderTree1())==null?void 0:C.debugString1())??"")),I.push(T.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",((B=y.renderTreeForBaseScreen1())==null?void 0:B.debugString1())??"")),P.setScrollBehavior("SCROLLS"),I.push(T.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",((G=y.renderTreeForBaseScreen1())==null?void 0:G.debugString1())??"")),Promise.all(I)}),he("do not wrap fixed layers in a volatile property binding",()=>{var E;let I=Xe(b);I.setOverflowDirection("VERTICAL"),je(I,new F(0,0),new F(100,100));let y=Xe(I);return y.setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]),y.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),i(I,0,new L(0,50,100,150)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]),T.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",((E=I.renderTree1())==null?void 0:E.debugString1())??"")}),he("Background blur trees should not cull scrollable content",()=>{var C,B;let I=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(I);let y=Xe(b);y.setOverflowDirection("VERTICAL"),je(y,new F(0,0),new F(100,100)),y.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]);let P=i(y,0,new L(0,150,100,100));je(P,new F(150,0),new F(100,101)),P.setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]);let E=i(y,0,new L(0,0,100,100));return E.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),je(E,new F(0,0),new F(100,100)),E.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),E.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("blur node should contain green fill",((B=(C=y==null?void 0:y.renderTree1())==null?void 0:C.optimized())==null?void 0:B.debugString1())??"")}),["FRAME","GROUP"].forEach(I=>{he(`Background blur inside ${I} in scrolling content should contain transformed scrolling siblings`,()=>{var G,V;let y=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(y);let P=Xe(b);P.setOverflowDirection("VERTICAL"),je(P,new F(0,0),new F(100,100)),P.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]);let E=I=="FRAME"?Xe(P):Ma(P),C=i(E,0,new L(0,0,100,101));je(C,new F(0,0),new F(100,101)),C.setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]);let B=i(E,0,new L(0,0,100,100));return je(B,new F(0,0),new F(100,100)),B.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),B.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),je(E,new F(0,0),new F(100,101)),T.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",((V=(G=P.renderTree1())==null?void 0:G.optimized())==null?void 0:V.debugString1())??"")})}),he("calling .renderTree on a frame should NOT make it scrollable by default",()=>{var P;b.setCurrentViewportSize(new F(100,50));let I=Xe(b);return je(I,new F(0,0),new F(100,100)),i(I,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]),T.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",((P=I.renderTree1())==null?void 0:P.debugString1())??"")}),he("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{var P;b.setCurrentViewportSize(new F(100,50));let I=Xe(b);return je(I,new F(0,0),new F(100,100)),i(I,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]),T.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",((P=I.renderTreeForBaseScreen1())==null?void 0:P.debugString1())??"")})}),he("drop shadow",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("drop shadow should be emitted",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("two drop shadows",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createDropShadow(0,new F(50,50),N.RED,1),Oe.createDropShadow(0,new F(-50,-50),N.GREEN,1)]),T.asyncAssertMatchesSnapshot("two drop shadows should be emitted",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("drop shadow on semi-transparent layer",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),f.setOpacity(.5),T.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("drop shadow on clipping frame with visible background paints",()=>{var P;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=Xe(f);return je(I,new F(0,0),new F(200,200)),I.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),i(I,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]),I.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",((P=I.renderTree1())==null?void 0:P.debugString1())??"")}),he("drop shadow on non-clipping frame with visible background paints",()=>{var P;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=Xe(f);return je(I,new F(0,0),new F(200,200)),I.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),I.setIsFrameMaskDisabled(!0),i(I,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]),I.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",((P=I.renderTree1())==null?void 0:P.debugString1())??"")}),he("drop shadow on clipping frame with no background paints",()=>{var P;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=Xe(f);return je(I,new F(0,0),new F(200,200)),I.setTestOnlyFillPaints([]),i(I,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]),I.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",((P=I.renderTree1())==null?void 0:P.debugString1())??"")}),he("drop shadow on clipping frame with no visible background paints",()=>{var P;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=Xe(f);return je(I,new F(0,0),new F(200,200)),I.setTestOnlyFillPaints([$.createSolid(N.RED,0)]),i(I,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]),I.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",((P=I.renderTree1())==null?void 0:P.debugString1())??"")}),he("drop shadow on clipping frame with visible background paint with transparent area",()=>{var E;let f=$.createLinearGradient([new _t(N.new3(0,0,0,1),0),new _t(N.new3(0,0,0,0),.5)]),I=Xe(b);je(I,new F(-100,-100),new F(300,300));let y=Xe(I);return je(y,new F(0,0),new F(200,200)),y.setTestOnlyFillPaints([f]),i(y,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]),y.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",((E=y.renderTree1())==null?void 0:E.debugString1())??"")}),he("drop shadow on clipping frame with inside stroke",()=>{var y;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=xc(f,"frame",[$.createSolid(N.RED,1)],[$.createSolid(N.BLACK,1)],new L(0,0,50,50));return je(I,new F(0,0),new F(50,50)),I.setStrokeAlign("INSIDE"),I.setStrokeWeight(4),c(I,new L(0,0,100,100)),I.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{var y;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=xc(f,"frame",[$.createSolid(N.RED,1)],[$.createSolid(N.WHITE,1)],new L(0,0,50,50));return je(I,new F(0,0),new F(50,50)),I.setStrokeAlign("INSIDE"),I.setStrokeWeight(4),I.setCornerRadius(10),I.setTestOnlyFillGeometry(DF(I.canvasSpaceBoundingBox(),10)),I.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow and inner shadow on clipping frame with inside stroke",()=>{var y;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=xc(f,"frame",[$.createSolid(N.RED,1)],[$.createSolid(N.BLACK,1)],new L(0,0,50,50));return je(I,new F(0,0),new F(50,50)),I.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),I.setStrokeAlign("INSIDE"),I.setTestOnlyStrokePaints([$.createSolid(N.RED,1)]),I.setStrokeWeight(4),c(I,new L(0,0,100,100)),I.setTestOnlyEffects([Oe.createInnerShadow(4,new F(0,0),N.BLACK,.25),Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("spread shadow for eligible frame",()=>{var y;let f=Xe(b);je(f,new F(0,0),new F(300,300));let I=_i(f,"frame",$.createSolid(N.RED,1));return je(I,new F(0,0),new F(50,50)),I.setTestOnlyEffects([Oe.createDropShadow(0,new F(0,0),N.BLACK,.25,10)]),T.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${(y=I.renderTree1())==null?void 0:y.maxBounds}
`)}),he("no spread shadow for frame with no visible fill paints",()=>{var y;let f=_i(b,"frame",$.createSolid(N.RED,0));return je(f,new F(0,0),new F(50,50)),i(f,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createDropShadow(0,new F(0,0),N.BLACK,.25,10)]),T.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${(y=f.renderTree1())==null?void 0:y.maxBounds}
`)}),he("no spread shadow for frame that does not clip",()=>{var y;let f=Xe(b);je(f,new F(0,0),new F(300,300));let I=_i(f,"frame",$.createSolid(N.RED,1));return je(I,new F(0,0),new F(50,50)),I.setIsFrameMaskDisabled(!0),I.setTestOnlyEffects([Oe.createDropShadow(0,new F(0,0),N.BLACK,.25,10)]),T.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${(y=I.renderTree1())==null?void 0:y.maxBounds}
`)}),he("drop shadow with knockout: translucent node",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),f.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("drop shadow with knockout: opaque node",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),f.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("drop shadow with knockout: opaque frame",()=>{var y;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=_i(f,"frame",$.createSolid(N.RED,1));return je(I,new F(0,0),new F(50,50)),I.setIsFrameMaskDisabled(!0),I.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,20,!1)]),T.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow with knockout: node with gradient transparency",()=>{var y;let f=i(b,0,new L(0,0,100,100)),I=$.createLinearGradient([new _t(N.new3(0,0,0,1),0),new _t(N.new3(0,0,0,0),.3),new _t(N.new3(0,0,0,0),.7),new _t(N.new3(0,0,0,1),.7)]);return f.setTestOnlyFillPaints([I]),f.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should knockout gradient with transparency",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow with knockout: with effect blend mode",()=>{var y;let f=i(b,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]);let I=Oe.createDropShadow(0,new F(10,0),N.BLACK,.25,5,!1);return I.setBlendMode("DIFFERENCE"),f.setTestOnlyEffects([I]),T.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow with knockout: with an inner shadow",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),f.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1),Oe.createInnerShadow(4,new F(5,5),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("drop shadow with knockout: with fill/stroke blend modes",()=>{var P;let f=i(b,0,new L(0,0,100,100)),I=$.createSolid(N.RED,.5);I.setBlendMode("HARD_LIGHT"),f.setTestOnlyFillPaints([I]);let y=$.createSolid(N.BLUE,.5);return y.setBlendMode("SOFT_LIGHT"),f.setTestOnlyStrokePaints([y]),f.setStrokeWeight(5),f.setStrokeAlign("OUTSIDE"),f.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",((P=f.renderTree1())==null?void 0:P.debugString1())??"")}),he("drop shadow with knockout: with clip to shape grain effect",()=>{var I;O();let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),f.setTestOnlyEffects([Oe.createGrain(new F(2,2),!0,100,123),Oe.createDropShadow(137,new F(10,0),N.BLACK,1,0,!1)]),T.asyncAssertMatchesSnapshot("knockout shadow mask should wrap the grain node",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("with fill/stroke blend modes (fast stroke optimization)",()=>{var E;let f=Object({viewer_fast_stroke_shadow:!0});U.updateFeatureFlags(f);let I=i(b,1,new L(0,0,100,100)),y=$.createSolid(N.RED,.5);y.setBlendMode("HARD_LIGHT"),I.setTestOnlyFillPaints([y]);let P=$.createSolid(N.BLACK,1);return P.setBlendMode("SOFT_LIGHT"),I.setTestOnlyStrokePaints([P]),I.setStrokeAlign("OUTSIDE"),I.setStrokeJoin("MITER"),I.setStrokeMiterLimit(4),I.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should generate strokes with a combined rendertree.",((E=I.renderTree1())==null?void 0:E.debugString1())??"")}),he("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{var P;let f=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(f);let I=_i(b,"frame",$.createSolid(N.RED,1));je(I,new F(0,0),new F(50,50));let y=i(b,0,new L(0,0,100,100));return y.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),y.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,.25,5,!1),Oe.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",((P=y.renderTree1())==null?void 0:P.debugString1())??"")}),he("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),f.setTestOnlyEffects([Oe.createDropShadow(10,new F(200,0),N.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{var y;let f=Xe(b);je(f,new F(-100,-100),new F(300,300));let I=xc(f,"frame",[$.createSolid(N.RED,0)],[$.createSolid(N.BLACK,1)],new L(0,0,50,50));return je(I,new F(0,0),new F(50,50)),I.setTestOnlyEffects([Oe.createDropShadow(10,new F(10,0),N.BLACK,1,5,!1)]),T.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("inner shadow",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createInnerShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should output inner shadow",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("two inner shadows",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createInnerShadow(0,new F(50,50),N.RED,1),Oe.createInnerShadow(0,new F(-50,-50),N.GREEN,1)]),T.asyncAssertMatchesSnapshot("should output two inner shadows",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("inner shadow w/ zero blur radius",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createInnerShadow(0,new F(0,4),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should NOT output inner shadow",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{var I;let f=i(b,1,new L(0,0,100,100));return f.setStrokeAlign("OUTSIDE"),f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyStrokePaints([$.createSolid(N.WHITE,1)]),f.setTestOnlyEffects([Oe.createInnerShadow(1,new F(0,4),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("semi-transparent rect",()=>{var I;let f=i(b,0,new L(0,0,100,100));return f.setTestOnlyFillPaints([$.createSolid(N.BLACK,.5)]),f.setOpacity(.5),T.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("simple rect with stroke",()=>{var I;let f=i(b,1,new L(0,0,100,100));return f.setStrokeAlign("INSIDE"),f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyStrokePaints([$.createSolid(N.WHITE,1)]),T.asyncAssertMatchesSnapshot("should output FillStroke",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("rect with stroke and disabled fill should NOT render fill",()=>{var y;let f=i(b,1,new L(0,0,100,100));f.setStrokeAlign("INSIDE");let I=$.createSolid(N.BLACK,1);return I.setIsEnabled(!1),f.setTestOnlyFillPaints([I]),f.setTestOnlyStrokePaints([$.createSolid(N.WHITE,1)]),T.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur with no background",()=>{var y;let f=Object({viewer_background_blur_opts:!0});U.updateFeatureFlags(f);let I=_i(b,"frame",$.createSolid(N.RED,.5));return je(I,new F(0,0),new F(100,100)),I.setTestOnlyEffects([Oe.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("should not generate a background blur subtree",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur with no scrolling elements",()=>{var P;let f=Object({viewer_background_blur_opts:!0});U.updateFeatureFlags(f);let I=_i(b,"frame",$.createSolid(N.RED,1));je(I,new F(0,0),new F(100,100));let y=i(b,0,new L(0,0,50,50));return y.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),y.setTestOnlyEffects([Oe.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",((P=y.renderTree1())==null?void 0:P.debugString1())??"")}),he("background blur with scroll: foreground and background in clipping frame",()=>{var E;let f=Object({viewer_background_blur_opts:!0});U.updateFeatureFlags(f);let I=_i(b,"frame",$.createSolid(N.RED,1));je(I,new F(0,0),new F(100,100)),I.setOverflowDirection("VERTICAL");let y=_i(I,"container",$.createSolid(N.WHITE,1));je(y,new F(0,0),new F(100,500));let P=i(y,0,new L(0,0,50,50));return P.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),P.setTestOnlyEffects([Oe.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",((E=P.renderTree1())==null?void 0:E.debugString1())??"")}),Ct("simple stroke-only rect",()=>{let f;beforeEach(()=>{O(),f=i(b,1,new L(0,0,100,100)),f.setTestOnlyFillPaints(Ce.EMPTY),f.setTestOnlyStrokePaints([$.createSolid(N.WHITE,1)])}),he("inside stroke",()=>{var I;return d(f,1,"INSIDE"),T.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("outside stroke",()=>{var I;return d(f,1,"OUTSIDE"),T.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("center stroke",()=>{var I;return d(f,1,"CENTER"),T.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",((I=f.renderTree1())==null?void 0:I.debugString1())??"")})}),Ct("drop shadow with stroke, no spread",()=>{let f;he("strokeAlign = CENTER, drop shadow",()=>{var y;let I=Object({viewer_fast_stroke_shadow:!0});return U.updateFeatureFlags(I),O(),f=l(b,0,new L(0,0,100,100),[$.createSolid(N.BLACK,1)],[$.createSolid(N.WHITE,1)],"CENTER",4,new F(0,0),N.BLACK,.25),T.asyncAssertMatchesSnapshot("Should output one BLUR and three FILLS",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("strokeAlign = INSIDE, drop shadow",()=>{var y;let I=Object({viewer_fast_stroke_shadow:!0});return U.updateFeatureFlags(I),O(),f=l(b,0,new L(0,0,100,100),[$.createSolid(N.BLACK,1)],[$.createSolid(N.WHITE,1)],"INSIDE",4,new F(0,0),N.BLACK,.25),T.asyncAssertMatchesSnapshot("Should output one BLUR, two FILLS and one FILL_STROKE",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("strokeAlign = OUTSIDE, drop shadow",()=>{var y;let I=Object({viewer_fast_stroke_shadow:!0});return U.updateFeatureFlags(I),O(),f=l(b,0,new L(0,0,100,100),[$.createSolid(N.BLACK,1)],[$.createSolid(N.WHITE,1)],"OUTSIDE",4,new F(0,0),N.BLACK,.25),T.asyncAssertMatchesSnapshot("Should output one BLUR, TWO FILLS, and one FILL_STROKE",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("simulated image border, corner radius > 0",()=>{var E;let I=Object({viewer_fast_stroke_shadow:!0});U.updateFeatureFlags(I),O(),f=s(b,20,1,new L(0,0,100,100));let y=$.createSolid(N.WHITE,1);f.setTestOnlyFillPaints([y]);let P=$.createSolid(N.WHITE,1);return f.setTestOnlyStrokePaints([P]),f.setStrokeAlign("OUTSIDE"),f.setTestOnlyEffects([Oe.createDropShadow(6,new F(0,2),N.BLACK,.1,0,!1),Oe.createDropShadow(6,new F(0,0),N.BLACK,.08,0,!1),Oe.createDropShadow(6,new F(0,0),N.BLACK,.2,0,!1)]),f.setStrokeJoin("MITER"),f.setStrokeMiterLimit(4),T.asyncAssertMatchesSnapshot("should output three BLURs with FILLs, a FILL, and a FILL_STROKE.",((E=f.renderTree1())==null?void 0:E.debugString1())??"")})}),Ct("Simple tests on non-rects",()=>{he("simple non-rectangle",()=>{var I;let f=c(b,new L(0,0,100,100));return T.asyncAssertMatchesSnapshot("should be single fill without isRect flag",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("non-rectangle not clipped by frame",()=>{var I;let f=Xe(b);return je(f,new F(0,0),new F(100,100)),f.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),c(f,new L(0,0,99,99)),T.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("non-rectangle clipped by frame",()=>{var I;let f=Xe(b);return je(f,new F(0,0),new F(50,50)),f.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),c(f,new L(0,0,100,100)),T.asyncAssertMatchesSnapshot("clipping should not be optimized",((I=f.renderTree1())==null?void 0:I.debugString1())??"")})}),he("grouped single node",()=>{var y;let f=Ma(b);bl(f,!1),je(f,new F(0,0),new F(100,100));let I=i(f,0,new L(0,0,100,100));return I.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),T.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",((y=I.renderTree1())==null?void 0:y.debugString1())??"")}),he("nested groups",()=>{var C;let f=Ma(b);bl(f,!1),je(f,new F(0,0),new F(100,100));let I=Ma(f);bl(I,!1),je(I,new F(0,0),new F(50,50)),i(I,0,new L(0,0,50,50)).setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]);let P=Ma(f);return bl(P,!1),je(P,new F(50,50),new F(50,50)),i(P,0,new L(0,0,50,50)).setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),T.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",((C=f.renderTree1())==null?void 0:C.debugString1())??"")}),he("flatten nested opacities",()=>{var C;let f=Ma(b);je(f,new F(0,0),new F(100,100)),f.setOpacity(.8);let I=Ma(f);je(I,new F(0,0),new F(50,50)),I.setOpacity(.5);let y=i(I,0,new L(0,0,50,50));y.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),y.setOpacity(.5);let P=Ma(f);je(P,new F(50,50),new F(50,50)),P.setOpacity(.25);let E=i(P,0,new L(0,0,50,50));return E.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),E.setOpacity(.1),T.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",((C=f.renderTree1())==null?void 0:C.debugString1())??"")}),Ct("node outside bounds of frame",()=>{let f;beforeEach(()=>{O(),f=Xe(b),f.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),je(f,new F(0,0),new F(100,100)),i(f,0,new L(110,110,100,100)).setTestOnlyFillPaints([$.createSolid(N.BLACK,1)])}),he("without frame clipping",()=>{var I;return f.setIsFrameMaskDisabled(!0),T.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("with frame clipping",()=>{var I;return f.setIsFrameMaskDisabled(!1),T.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),ce("with frame clipping and no background color",()=>{f.setIsFrameMaskDisabled(!1),bl(f,!1),S(f.renderTree1(),null)})}),Ct("frame background",()=>{let f;beforeEach(()=>{O(),f=Xe(b),f.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),bl(f,!0),je(f,new F(0,0),new F(100,100))}),he("with solid paint",()=>{var I;return f.setTestOnlyFillPaints([$.createSolid(N.new3(1,.5,0,1),1)]),T.asyncAssertMatchesSnapshot("frame background fill should be present",((I=b.renderTree1())==null?void 0:I.debugString1())??"")}),he("with solid paint and blend mode",()=>{var y;let I=$.createSolid(N.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",((y=b.renderTree1())==null?void 0:y.debugString1())??"")}),he("with solid paint and blended gradient",()=>{var P;let I=$.createSolid(N.new3(1,.5,0,1),1),y=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return y.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I,y]),T.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",((P=b.renderTree1())==null?void 0:P.debugString1())??"")}),he("with solid paint and blend mode and children",()=>{var P;let I=$.createSolid(N.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I]),i(f,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.BLACK,.5)]),T.asyncAssertMatchesSnapshot("should output background and children",((P=b.renderTree1())==null?void 0:P.debugString1())??"")}),he("with drop shadow and opaque fill",()=>{var I;return f.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should not output a drop shadow",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("with drop shadow and no opaque fill",()=>{var I;return f.setTestOnlyFillPaints([$.createSolid(N.WHITE,.5)]),f.setTestOnlyEffects([Oe.createDropShadow(4,new F(0,0),N.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should output a drop shadow",((I=f.renderTree1())==null?void 0:I.debugString1())??"")})}),Ct("frame fills for containers supporting fill stroke and corners",()=>{let f;beforeEach(()=>{O(),f=Xe(b),f.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),je(f,new F(0,0),new F(100,100))}),he("with solid paint",()=>{var I;return f.setTestOnlyFillPaints([$.createSolid(N.new3(1,.5,0,1),1)]),T.asyncAssertMatchesSnapshot("frame background fill should be present",((I=b.renderTree1())==null?void 0:I.debugString1())??"")}),he("with solid paint and blend mode",()=>{var y;let I=$.createSolid(N.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",((y=b.renderTree1())==null?void 0:y.debugString1())??"")}),he("with solid paint and blended gradient",()=>{var P;let I=$.createSolid(N.new3(1,.5,0,1),1),y=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return y.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I,y]),T.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",((P=b.renderTree1())==null?void 0:P.debugString1())??"")}),he("with solid paint and blend mode and children",()=>{var P;let I=$.createSolid(N.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I]),i(f,0,new L(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(N.BLACK,.5)]),T.asyncAssertMatchesSnapshot("should output background and children",((P=b.renderTree1())==null?void 0:P.debugString1())??"")}),he("with inside stroke",()=>{var y;let I=xc(b,"frame",[$.createSolid(N.RED,1)],[$.createSolid(N.BLACK,1)],new L(0,0,50,50));return je(I,new F(0,0),new F(50,50)),I.setStrokeAlign("INSIDE"),I.setStrokeWeight(4),c(I,new L(0,0,100,100)),T.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",((y=b.renderTree1())==null?void 0:y.debugString1())??"")}),he("with outside stroke",()=>{var y;let I=xc(b,"frame",[$.createSolid(N.RED,1)],[$.createSolid(N.BLACK,1)],new L(0,0,50,50));return je(I,new F(0,0),new F(50,50)),je(I,new F(0,0),new F(50,50)),I.setStrokeAlign("OUTSIDE"),I.setStrokeWeight(4),c(I,new L(0,0,100,100)),T.asyncAssertMatchesSnapshot("should have stroke on top of mask",((y=b.renderTree1())==null?void 0:y.debugString1())??"")})}),Ct("masks",()=>{he("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{var P;let f=Xe(b);return f.setIsBackgroundEnabled(!1),f.setIsFrameMaskDisabled(!0),i(f,0,new L(0,0,10,10)).setIsMask(!0),i(f,0,new L(0,0,100,100)).setBlendMode("MULTIPLY"),T.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",((P=b.renderTree1())==null?void 0:P.debugString1())??"")}),he("small outside strokes should be masked",()=>{var P,E;let f=Xe(b);f.setIsBackgroundEnabled(!1),f.setIsFrameMaskDisabled(!0),i(f,0,new L(0,0,100,100)).setIsMask(!0);let y=o(f,1,new L(0,0,100,100),2);return y.setStrokeAlign("OUTSIDE"),y.setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),y.setTestOnlyStrokePaints([$.createSolid(N.BLACK,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",((E=(P=b.renderTree1())==null?void 0:P.optimized())==null?void 0:E.debugString1())??"")}),he("mask should be ignored if color is contained within the alpha",()=>{var P,E;let f=Xe(b);return f.setIsBackgroundEnabled(!1),f.setIsFrameMaskDisabled(!0),s(f,50,0,new L(0,0,100,100)).setIsMask(!0),s(f,10,0,new L(40,40,20,20)).setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should ignore mask as contained",((E=(P=b.renderTree1())==null?void 0:P.optimized())==null?void 0:E.debugString1())??"")}),he("mask should not ignored if color is not contained within the alpha",()=>{var P,E;let f=Xe(b);return f.setIsBackgroundEnabled(!1),f.setIsFrameMaskDisabled(!0),s(f,50,0,new L(0,0,100,100)).setIsMask(!0),s(f,32,0,new L(12,12,76,76)).setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should have a mask if alpha does not contain color",((E=(P=b.renderTree1())==null?void 0:P.optimized())==null?void 0:E.debugString1())??"")}),he("mask should be ignored if color contained within the a rounded rectangular alpha",()=>{var P,E;let f=Xe(b);return f.setIsBackgroundEnabled(!1),f.setIsFrameMaskDisabled(!0),s(f,27,0,new L(0,0,100,100)).setIsMask(!0),s(f,32,0,new L(12,12,76,76)).setTestOnlyFillPaints([$.createSolid(N.WHITE,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should not contain a mask if color is contained within a rounded rectangular alpha",((E=(P=b.renderTree1())==null?void 0:P.optimized())==null?void 0:E.debugString1())??"")})}),Ct("rectangle visibility",()=>{let f;beforeEach(()=>{O(),f=i(b,0,new L(0,0,100,100)),f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)])}),he("default visible",()=>{var I;return T.asyncAssertMatchesSnapshot("should output single fill",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),ce("visibility false",()=>{f.setVisible(!1),S(f.renderTree1(),null)}),ce("layer opacity zero",()=>{f.setOpacity(0),S(f.renderTree1(),null)}),ce("fill paint opacity zero",()=>{f.setTestOnlyFillPaints([$.createSolid(N.BLACK,0)]),S(f.renderTree1(),null)}),ce("no paints",()=>{f.setTestOnlyFillPaints(Ce.EMPTY),S(f.renderTree1(),null)}),ce("no fill paint, stroke paints, zero stroke width",()=>{let y=o(b,1,new L(0,0,100,100),0);y.setTestOnlyFillPaints(Ce.EMPTY),y.setTestOnlyStrokePaints([$.createSolid(N.TRANSPARENT,0)]),S(y.renderTree1(),null)})}),Ct("solid paints",()=>{let f;beforeEach(()=>{O(),f=i(b,0,new L(0,0,100,100))}),he("normal",()=>{var I;return f.setTestOnlyFillPaints([$.createSolid(N.new3(1,.5,0,1),1)]),T.asyncAssertMatchesSnapshot("should output fill with opacity=1",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("50% opacity",()=>{var I;return f.setTestOnlyFillPaints([$.createSolid(N.new3(1,.5,0,1),.5)]),T.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),ce("0% opacity",()=>{f.setTestOnlyFillPaints([$.createSolid(N.new3(1,.5,0,1),0)]),S(f.renderTree1(),null)}),ce("disabled",()=>{let I=$.createSolid(N.new3(1,.5,0,1),1);I.setIsEnabled(!1),f.setTestOnlyFillPaints([I]),S(f.renderTree1(),null)}),he("multiply blend",()=>{var y;let I=$.createSolid(N.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Blend with Fill child",((y=f.renderTree1())==null?void 0:y.debugString1())??"")})}),Ct("gradient paints",()=>{let f;beforeEach(()=>{O(),f=i(b,0,new L(0,0,100,100))}),he("linear",()=>{var y;let I=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("radial",()=>{var y;let I=$.createRadialGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("angular",()=>{var y;let I=$.createAngularGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("diamond",()=>{var y;let I=$.createDiamondGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("50% opacity",()=>{var y;let I=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);return I.setOpacity(.5),f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),ce("0% opacity",()=>{let I=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);I.setOpacity(0),f.setTestOnlyFillPaints([I]),S(f.renderTree1(),null)}),ce("disabled",()=>{let I=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);I.setIsEnabled(!1),f.setTestOnlyFillPaints([I]),S(f.renderTree1(),null)}),he("40% stop opacity",()=>{var y;let I=$.createLinearGradient([new _t(N.new3(1,.5,0,.4),.25),new _t(N.new3(0,.5,1,.6),.75)]);return f.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),ce("0% stop opacity",()=>{let I=$.createLinearGradient([new _t(N.new3(1,.5,0,0),.25),new _t(N.new3(0,.5,1,0),.75)]);f.setTestOnlyFillPaints([I]),S(f.renderTree1(),null)}),he("transform",()=>{var C;let I=$.createLinearGradient([new _t(N.new3(1,.5,0,1),.25),new _t(N.new3(0,.5,1,1),.75)]);I.setTransform1(new Q(.5,-.5,1,-1,1.5,-1.5)),f.setTestOnlyFillPaints([I]);let y=f.renderTree1();S(y==null?void 0:y.op(),3);let E=y.geometry.paints;return S(E,f.fillPaints()),T.asyncAssertMatchesSnapshot("should output linear gradient",((C=f.renderTree1())==null?void 0:C.debugString1())??"")})}),he("geometry",()=>{var B;let f=pn(b,"VECTOR");f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]);let I=new L(0,0,100,100),y=new Gr("ODD",0,Lt.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),I),P=new Gr("NONZERO",0,Lt.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),I);f.setTestOnlyFillGeometry(new Ur([y,P],null,I,null));let E=f.renderTree1();S(E==null?void 0:E.op(),1);let C=E;return S(C.children.length,2),S(C.children[0].op(),3),S(C.children[1].op(),3),S(C.children[0].geometry.path().windingRule(),"ODD"),S(C.children[1].geometry.path().windingRule(),"NONZERO"),T.asyncAssertMatchesSnapshot("should output a group with two fills",((B=f.renderTree1())==null?void 0:B.debugString1())??"")})}),Ct("RenderTree optimization of PaintData",()=>{ce("dual-color gradient",()=>{let R=[$.createLinearGradient([new _t(N.new3(0,.5,1,1),0),new _t(N.new3(1,.5,0,1),1)])],b=Ce.optimize(R);S(b.length,1),S(b[0].type(),"GRADIENT_LINEAR")}),ce("dual-opacity gradient",()=>{let R=[$.createLinearGradient([new _t(N.new3(1,.5,0,0),0),new _t(N.new3(1,.5,0,1),1)])],b=Ce.optimize(R);S(b.length,1),S(b[0].type(),"GRADIENT_LINEAR")}),ce("single-color gradient",()=>{let R=[$.createLinearGradient([new _t(N.new3(1,.5,0,1),0),new _t(N.new3(1,.5,0,1),1)])],b=Ce.optimize(R);S(b.length,1),S(b[0].type(),"SOLID")}),ce("solid underneath dual-color gradient",()=>{let R=[$.createSolid(N.GREEN,1),$.createLinearGradient([new _t(N.new3(0,0,1,.5),0),new _t(N.new3(1,0,0,.5),1)])],b=Ce.optimize(R);S(b.length,1),S(b[0].type(),"GRADIENT_LINEAR"),b[0].asSinglePaint()!=null;let O=b[0].asSinglePaint().colorStops()[0],f=b[0].asSinglePaint().colorStops()[1];S(O.position,0),e(O.color,N.new3(0,.5,.5,1)),S(f.position,1),e(f.color,N.new3(.5,.5,0,1))}),ce("solid underneath single-color gradient",()=>{let R=[$.createSolid(N.GREEN,1),$.createLinearGradient([new _t(N.new3(1,0,0,.5),0),new _t(N.new3(1,0,0,.5),1)])],b=Ce.optimize(R);S(b.length,1),S(b[0].type(),"SOLID"),e(b[0].asSinglePaint().color(),N.new3(.5,.5,0,1))})}),Ct("RenderTree.isRect",()=>{let R=O=>{S(new Gt(O,"ODD").isRect(),!0)},b=O=>{S(new Gt(O,"ODD").isRect(),!1)};ce("RenderTree.isRect",()=>{var y;R(Lt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),R(Lt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),R(Lt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),R(Lt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),R(Lt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),b(Lt.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),b(Lt.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),b(Lt.new2().quadraticTo(10,0,10,5).lineTo(0,5)),b(Lt.new2().lineTo(10,0).quadraticTo(10,5,0,5)),b(Lt.new2().cubicTo1(10,0,10,5,0,5));let f=Me.createSceneWithCanvasForTests1().root().childAt1(0),I=i(f,0,new L(0,0,100,100));S(I.renderTree1()!=null,!0),S((y=I.renderTree1())==null?void 0:y.isRectFill(),!0)})}),Ct("RenderTree optimization of Group nodes",()=>{let R;beforeEach(()=>{let b=new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.createSolid(N.BLACK,1)]);R=new Xr(Q.new2(),b,F.new())}),ce("empty group",()=>{S(new Le([]).optimized(),null)}),ce("empty nested group",()=>{S(new Le([new Le([])]).optimized(),null)}),he("single group",()=>{var b;return T.asyncAssertMatchesSnapshot("should be fill only; no groups",((b=new Le([R]).optimized())==null?void 0:b.debugString1())??"")}),he("single nested group",()=>{var b;return T.asyncAssertMatchesSnapshot("should be fill only; no groups",((b=new Le([new Le([R])]).optimized())==null?void 0:b.debugString1())??"")}),he("double group",()=>{var b;return T.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",((b=new Le([R,R]).optimized())==null?void 0:b.debugString1())??"")}),he("double nested group 1",()=>{var b;return T.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",((b=new Le([new Le([R,R])]).optimized())==null?void 0:b.debugString1())??"")}),he("double nested group 2",()=>{var b;return T.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",((b=new Le([new Le([R]),new Le([R])]).optimized())==null?void 0:b.debugString1())??"")})}),Ct("RenderTree optimization of Dissolve",()=>{let R=null,b=null,O=(f,I)=>new Qn(f,I,"A",()=>1).optimized();beforeEach(()=>{let f=new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.createSolid(N.BLACK,1)]);R=new Xr(Q.new2(),f,F.new());let I=new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.createSolid(N.RED,1)]);b=new Xr(Q.new2(),I,F.new())}),ce("both subtrees null",()=>{S(O(null,null),null)}),he("old subtree null",()=>{var f;return T.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",((f=O(null,R))==null?void 0:f.debugString1())??"")}),he("new subtree null",()=>{var f;return T.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",((f=O(R,null))==null?void 0:f.debugString1())??"")}),he("identical subtrees",()=>{var f;return T.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",((f=O(R,R))==null?void 0:f.debugString1())??"")}),he("different subtrees",()=>{var f;return T.asyncAssertMatchesSnapshot("dissolve should not be optimized away",((f=O(R,b))==null?void 0:f.debugString1())??"")})}),Ct("RenderTree optimization of Fill",()=>{ce("fill with zero opacity paint",()=>{S(new Xr(Q.new2(),new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.createSolid(N.BLACK,0)]),F.new()).optimized(),null)}),ce("fill with disabled paint",()=>{S(new Xr(Q.new2(),new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.create("SOLID",1,"NORMAL",!1,N.BLACK)]),F.new()).optimized(),null)}),ce("fill with empty bounds",()=>{S(new Xr(Q.new2(),new Kt(new Gt(At.fromRect(new L(0,0,0,0)),"ODD"),[$.createSolid(N.BLACK,1)]),F.new()).optimized(),null)})}),Ct("RenderTree optimization of Blur",()=>{let R;beforeEach(()=>{let b=new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.createSolid(N.BLACK,1)]);R=new Xr(Q.new2(),b,F.new())}),he("zero radius blur",()=>{var b;return T.asyncAssertMatchesSnapshot("should contain no Blur node",((b=Yn.createForStandardBlur(0,R,L.INVALID).optimized())==null?void 0:b.debugString1())??"")}),he("blur wrapping volatile fill",()=>{var b;return T.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",((b=Yn.createForStandardBlur(10,mt.forTranslation(R,Pt.forAnimateableTranslation("x"),()=>F.new()),L.INVALID).optimized())==null?void 0:b.debugString1())??"")}),he("clamp blur wrapping volatile fill",()=>{var b;return T.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",((b=Yn.createForStandardBlur(10,mt.forTranslation(R,Pt.forAnimateableTranslation("x"),()=>F.new()),new L(0,0,1,1)).optimized())==null?void 0:b.debugString1())??"")})}),Ct("RenderTree optimization of HardMaskWithColor",()=>{let R;beforeEach(()=>{let b=new Kt(new Gt(At.fromRect(new L(0,0,1,1)),"ODD"),[$.createSolid(N.BLACK,1)]);R=new Xr(Q.new2(),b,F.new())}),he("hard mask wrapping fill",()=>{var b;return T.asyncAssertMatchesSnapshot("should be a single Fill",((b=new fi(R,N.BLACK).optimized())==null?void 0:b.debugString1())??"")}),he("hard mask wrapping volatile fill",()=>{var b;return T.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",((b=new fi(mt.forTranslation(R,Pt.forAnimateableTranslation("x"),()=>F.new()),N.BLACK).optimized())==null?void 0:b.debugString1())??"")}),he("hard mask wrapping blend nodes",()=>{var b;return T.asyncAssertMatchesSnapshot("should be a single Fill",((b=new fi(new Fo("MULTIPLY",.5,R),N.BLACK).optimized())==null?void 0:b.debugString1())??"")})}),Ct("Stack reverse Z index",()=>{let R,b,O=()=>{R=Me.createSceneWithCanvasForTests1(),b=R.root().childAt1(0),b.setPrototypeDevice(Wn.DEFAULT)};beforeEach(O),he("stacking frame without stackReverseZIndex",()=>{var I;let f=ht(b,"f");return tr(f,"c1",N.RED,1),tr(f,"c2",N.BLUE,1),f.setStackMode("VERTICAL"),f.setStackReverseZIndex(!1),T.asyncAssertMatchesSnapshot("should have non-reversed children",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("stacking frame with stackReverseZIndex",()=>{var I;let f=ht(b,"f");return tr(f,"c1",N.RED,1),tr(f,"c2",N.BLUE,1),f.setStackMode("VERTICAL"),f.setStackReverseZIndex(!0),T.asyncAssertMatchesSnapshot("should have reversed children",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("non-stacking frame without stackReverseZIndex",()=>{var I;let f=ht(b,"f");return tr(f,"c1",N.RED,1),tr(f,"c2",N.BLUE,1),f.setStackMode("NONE"),f.setStackReverseZIndex(!1),T.asyncAssertMatchesSnapshot("should have non-reversed children",((I=f.renderTree1())==null?void 0:I.debugString1())??"")}),he("non-stacking frame with stackReverseZIndex",()=>{var I;let f=ht(b,"f");return tr(f,"c1",N.RED,1),tr(f,"c2",N.BLUE,1),f.setStackMode("NONE"),f.setStackReverseZIndex(!0),T.asyncAssertMatchesSnapshot("should have non-reversed children",((I=f.renderTree1())==null?void 0:I.debugString1())??"")})}),Ct("basic wasm render tree",()=>{beforeEach(()=>{ct.initializeWasmImpl()}),afterEach(()=>{ct.initializeJsImpl()}),ce("solid paints",()=>{var E,C;let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,.25),$.createSolid(N.BLUE,.5)]);let y=new gt(f,null).renderTree();S(y!=null,!0),S(y==null?void 0:y.op(),3);let P=y;return S(P instanceof R_,!0),S((P==null?void 0:P.transform)!=null,!0),S((E=P==null?void 0:P.transform)==null?void 0:E.equals1(Q.new2()),!0),S((C=P==null?void 0:P.paintSize)==null?void 0:C.equals(new F(100,100)),!0),T.asyncAssertMatchesSnapshot("wasm rendertree has correct solid paints",(y==null?void 0:y.debugString1())??"")}),ce("gradient paint",()=>{var P;let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createAngularGradient([new _t(N.new3(1,.5,0,.5),.25),new _t(N.new3(0,.5,1,.5),.75)],.5)]);let y=((P=new gt(f,null).renderTree())==null?void 0:P.debugString1())??"";return T.asyncAssertMatchesSnapshot("wasm rendertree has correct gradient paint",y)}),ce("fill and stroke",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,1,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,.5)]),f.setTestOnlyStrokePaints([$.createSolid(N.BLUE,1)]),f.setStrokeAlign("INSIDE"),f.setStrokeWeight(10);let y=new gt(f,null).renderTree();S(y!=null,!0);let P=null;if(y instanceof _u)P=y;else if(y instanceof hu){let E=y;S(E.children.length>0,!0),S(E.children[0]instanceof _u,!0),P=E.children[0]}return S(P!=null,!0),S(P.transform!=null,!0),S(P.transform.equals1(Q.new2()),!0),S(P.paintSize.equals(new F(100,100)),!0),S(P.mode,0),T.asyncAssertMatchesSnapshot("wasm rendertree has correct fill and stroke",(y==null?void 0:y.debugString1())??"")}),ce("group with children",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b);i(O,0,new L(0,0,50,50)).setTestOnlyFillPaints([$.createSolid(N.RED,1)]),i(O,0,new L(50,50,50,50)).setTestOnlyFillPaints([$.createSolid(N.BLUE,1)]);let P=new gt(O,null).renderTree();S(P!=null,!0),S(P==null?void 0:P.op(),1);let E=P;S(E instanceof hu,!0),S(E!=null,!0),S(E.children.length>0,!0);for(let C of(E==null?void 0:E.children)??[])S(C!=null,!0),S(C instanceof xt,!0);return T.asyncAssertMatchesSnapshot("wasm rendertree has correct group with children",(P==null?void 0:P.debugString1())??"")}),ce("inner shadow mask",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),f.setTestOnlyEffects([Oe.createInnerShadow(10,new F(5,5),N.BLACK,.5)]);let y=new gt(f,null).renderTree();if(S(y!=null,!0),y instanceof y_){S(y.type,2),S(y.alpha!=null,!0),S(y.color!=null,!0);let P=N.new3(0,0,0,.5);S(y.innerShadowFill==P,!0)}return T.asyncAssertMatchesSnapshot("wasm rendertree has correct inner shadow mask",(y==null?void 0:y.debugString1())??"")}),ce("blend with opacity",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),f.setBlendMode("MULTIPLY"),f.setOpacity(.75);let y=new gt(f,null).renderTree();S(y!=null,!0),S(y instanceof b_,!0);let P=y;return S(P.blendMode,"MULTIPLY"),S(P.opacity,.75),S(P.child!=null,!0),S(P.child instanceof xt,!0),T.asyncAssertMatchesSnapshot("wasm rendertree has correct blend with opacity",(y==null?void 0:y.debugString1())??"")}),ce("grain effect",()=>{var E,C;let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createGrain(new F(2.4,2.4),!0,10,123)]);let y=new gt(f,null).renderTree();S(y!=null,!0),S(y instanceof v_,!0);let P=y;return S(P.radius,10),S(Math.abs((((E=P==null?void 0:P.noiseSize)==null?void 0:E.x())??0)-2.4)<.001,!0),S(Math.abs((((C=P==null?void 0:P.noiseSize)==null?void 0:C.y())??0)-2.4)<.001,!0),S(P.clipToShape,!0),S(P.child!=null,!0),S(P.child instanceof xt,!0),T.asyncAssertMatchesSnapshot("wasm rendertree has correct grain effect",(y==null?void 0:y.debugString1())??"")}),ce("blur effect",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]),f.setTestOnlyEffects([Oe.createForegroundBlur(10)]);let y=new gt(f,null).renderTree();S(y!=null,!0),S(y instanceof C_,!0);let P=y;return S(P.startRadius,10),S(P.blurOpType!=null,!0),S(P.child!=null,!0),S(P.child instanceof xt,!0),T.asyncAssertMatchesSnapshot("wasm rendertree has correct blur effect",(y==null?void 0:y.debugString1())??"")}),ce("children iterators",()=>{var E;let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b);O.setTestOnlyFillPaints([$.createSolid(N.GREEN,.5)]);let f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,.25)]),f.setBlendMode("MULTIPLY");let I=i(O,0,new L(10,10,100,100));I.setTestOnlyFillPaints([$.createSolid(N.BLUE,.5)]),I.setBlendMode("DARKEN");let P=((E=new gt(O,null).renderTree())==null?void 0:E.debugString1())??"";return T.asyncAssertMatchesSnapshot("wasm rendertree with a child",P)}),ce("effect data",()=>{var P;let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyEffects([Oe.createForegroundBlur(10),Oe.createGrain(new F(10,10),!0,10,123)]);let y=((P=new gt(f,null).renderTree())==null?void 0:P.debugString1())??"";return T.asyncAssertMatchesSnapshot("wasm rendertree has correct effect data",y)}),ce("noise effect",()=>{var E,C;let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),f.setTestOnlyEffects([Oe.createNoise("MONOTONE","NORMAL",new F(2.4,2.4),1,N.WHITE,N.BLACK,.25,123)]);let y=new gt(f,null).renderTree();S(y!=null,!0),S(y==null?void 0:y.op(),15);let P=y;return S(P instanceof O_,!0),S(P==null?void 0:P.noiseType,"MONOTONE"),S(P==null?void 0:P.blendMode,"NORMAL"),S((P==null?void 0:P.noiseSize)!=null,!0),S(Math.abs((((E=P==null?void 0:P.noiseSize)==null?void 0:E.x())??0)-2.4)<.001,!0),S(Math.abs((((C=P==null?void 0:P.noiseSize)==null?void 0:C.y())??0)-2.4)<.001,!0),S(Math.abs(((P==null?void 0:P.density)??0)-1)<.001,!0),S(P==null?void 0:P.seed,123),S((P==null?void 0:P.child)!=null,!0),T.asyncAssertMatchesSnapshot("wasm rendertree has correct noise effect",(y==null?void 0:y.debugString1())??"")}),ce("volatile property binding",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let I=new gt(f,null),y=v().modules().wasmRenderTreeBindings;if(y!=null,!y)throw new Error("wasmRenderTreeBindings should be available");let P=y.generateRenderTree(I);S(P!=null,!0);let E=y.generateVolatilePropertyBindingForTests(P,"my_custom_vpb_id",et.TRANSFORM),C=xt.getOrCreate(E);S(C!=null,!0),S(C instanceof N_,!0);let B=C;return S(B.child!=null,!0),S(B.child instanceof xt,!0),S(B.id,"my_custom_vpb_id"),S(B.property,et.TRANSFORM),T.asyncAssertMatchesSnapshot("wasm rendertree has correct volatile property binding",(C==null?void 0:C.debugString1())??"")}),ce("volatile render effect",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.BLUE,1)]);let I=new gt(f,null),y=v().modules().wasmRenderTreeBindings;if(y!=null,!y)throw new Error("wasmRenderTreeBindings should be available");let P=y.generateRenderTree(I);S(P!=null,!0);let E={min:{x:0,y:0},max:{x:100,y:100}},C={x:50,y:50},B=Q.new2(),G={m00:B.m00(),m01:B.m01(),m02:B.m02(),m10:B.m10(),m11:B.m11(),m12:B.m12()},V=y.generateVolatileRenderEffectForTests(P,"my_custom_vre_id",Kr.BLUR,al.NORMAL,E,!0,G,15,.5,bs.DUOTONE,$r.MULTIPLY,42,C,!1),D=xt.getOrCreate(V);S(D!=null,!0),S(D instanceof P_,!0);let w=D;return S(w.child!=null,!0),S(w.child instanceof xt,!0),S(w.id,"my_custom_vre_id"),S(w.property,Kr.BLUR),S(w.maxEffectRadius,15),S(w.clipToShape,!0),S(w.cornerSmoothing,.5),T.asyncAssertMatchesSnapshot("wasm rendertree has correct volatile render effect",(D==null?void 0:D.debugString1())??"")}),ce("dissolve",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Xe(b),f=i(O,0,new L(0,0,100,100));f.setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let I=i(O,0,new L(0,0,100,100));I.setTestOnlyFillPaints([$.createSolid(N.GREEN,1)]);let y=new gt(f,null),P=new gt(I,null),E=v().modules().wasmRenderTreeBindings;if(E!=null,!E)throw new Error("wasmRenderTreeBindings should be available");let C=E.generateRenderTree(y),B=E.generateRenderTree(P);S(C!=null,!0),S(B!=null,!0);let G=E.generateDissolveForTests(C,B,"my_custom_dissolve_id"),V=xt.getOrCreate(G);S(V!=null,!0),S(V instanceof F_,!0);let D=V;return S(D.startChild!=null,!0),S(D.endChild!=null,!0),S(D.startChild instanceof xt,!0),S(D.endChild instanceof xt,!0),S(D.id,"my_custom_dissolve_id"),T.asyncAssertMatchesSnapshot("wasm rendertree has correct dissolve",(V==null?void 0:V.debugString1())??"")})})}A.testRenderTree=u;function p(){let S=AssertLib.deepStrictEqual;ce("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let R=Me.createSceneWithCanvasForTests1().root().childAt1(0),b=Xe(R),O=Xe(R),f=i(b,0,new L(0,0,100,100)),I=b.renderTree1(),y=O.renderTree1();S(I!=null,!0),S(y!=null,!0),f.setParentIndex(new vn(X.invalid(),Or.fromString(""))),O.appendChild(f);let P=b.renderTree1(),E=O.renderTree1();S(P!=I,!0),S(E!=y,!0)})}A.testNodeRenderTree=p;function _(){let S=AssertLib.deepStrictEqual,T=AssertLib.notDeepStrictEqual;ce("equalWithinBounds works for Group nodes",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Dr(b,"frame1",N.BLUE),f=Dr(b,"frame2",N.BLUE),I=O.renderTree1(),y=f.renderTree1(),P=()=>{I=O.renderTree1(),y=f.renderTree1()};P(),S(!!I,!0),I!=null&&(S(I.equals(y),!0),S(I,y),S(I.equalsWithinBounds(y,new L(15,15,10,10)),!0),S(I.equalsWithinBounds(y,new L(0,0,5,5)),!0));let E=i(O,0,new L(1,1,10,10)),C=i(f,0,new L(0,0,10,10));P(),S(I.equals(y),!1),T(I,y),S(I.equalsWithinBounds(y,new L(15,15,10,10)),!0),S(I.equalsWithinBounds(y,new L(0,0,5,5)),!1);let B=i(O,0,new L(15,15,10,10));P(),S(I.equalsWithinBounds(y,new L(30,30,10,10)),!1),S(I.equalsWithinBounds(y,new L(15,15,10,10)),!1),S(I.equalsWithinBounds(y,new L(0,0,5,5)),!1)}),ce("equalWithinBounds works with nested masking",()=>{let b=Me.createSceneWithCanvasForTests1().root().childAt1(0),O=Dr(b,"frame1",N.BLUE),f=Dr(b,"frame2",N.BLUE),I=O.renderTree1(),y=f.renderTree1(),P=()=>{I=O.renderTree1(),y=f.renderTree1()};P(),S(I.equals(y),!0),S(I,y),S(I.equalsWithinBounds(y,new L(15,15,10,10)),!0),S(I.equalsWithinBounds(y,new L(0,0,5,5)),!0),i(O,0,new L(1,1,10,10)).setIsMask(!0);let C=i(O,0,new L(1,1,100,100));i(f,0,new L(1,1,10,10)).setIsMask(!0);let G=i(f,0,new L(1,1,101,101));P(),S(I.equals(y),!1),T(I,y),S(I.equalsWithinBounds(y,new L(15,15,10,10)),!0),S(I.equalsWithinBounds(y,new L(0,0,5,5)),!1)})}A.testEqualsWithinBounds=_;function h(){Ct("GlassRectCornerInfo",()=>{ce("Corner radii scaling with horizontal constraint",()=>{let T=Me.createSceneWithCanvasForTests1().root().childAt1(0),R=qr(T);R.setSize(new F(120,200)),R.setRectangleCornerRadiiIndependent(!0),R.setRectangleTopLeftCornerRadius(50),R.setRectangleTopRightCornerRadius(80),R.setRectangleBottomLeftCornerRadius(40),R.setRectangleBottomRightCornerRadius(60),R.setCornerSmoothing(0);let b=new gt(R),O=Jo.createFromNode(b),f=120/130;yn(O.topLeftRadius(),50*f),yn(O.topRightRadius(),80*f),yn(O.bottomLeftRadius(),40),yn(O.bottomRightRadius(),60)}),ce("Corner radii scaling with horizontal and vertical constraint",()=>{let T=Me.createSceneWithCanvasForTests1().root().childAt1(0),R=qr(T);R.setSize(new F(80,60)),R.setRectangleCornerRadiiIndependent(!0),R.setRectangleTopLeftCornerRadius(30),R.setRectangleTopRightCornerRadius(60),R.setRectangleBottomLeftCornerRadius(45),R.setRectangleBottomRightCornerRadius(50),R.setCornerSmoothing(0);let b=new gt(R),O=Jo.createFromNode(b),f=60/75,I=60/110;yn(O.topLeftRadius(),30*f),yn(O.topRightRadius(),60*I),yn(O.bottomLeftRadius(),45*f),yn(O.bottomRightRadius(),50*I)}),ce("Valid corners with smoothing",()=>{let T=Me.createSceneWithCanvasForTests1().root().childAt1(0),R=qr(T);R.setSize(new F(100,100)),R.setRectangleCornerRadiiIndependent(!0),R.setRectangleTopLeftCornerRadius(20),R.setRectangleTopRightCornerRadius(25),R.setRectangleBottomLeftCornerRadius(15),R.setRectangleBottomRightCornerRadius(30),R.setCornerSmoothing(.2);let b=new gt(R),O=Jo.createFromNode(b);yn(O.topLeftRadius(),20),yn(O.topRightRadius(),25),yn(O.bottomLeftRadius(),15),yn(O.bottomRightRadius(),30);for(let f=0;f<4;f++)yn(O.cornerSmoothings[f],.2)}),ce("Uniform corners",()=>{let T=Me.createSceneWithCanvasForTests1().root().childAt1(0),R=qr(T);R.setSize(new F(10,10)),R.setRectangleCornerRadiiIndependent(!1),R.setCornerRadius(200);let b=new gt(R),O=Jo.createFromNode(b);O.topLeftRadius()+O.topRightRadius()<=10,O.bottomLeftRadius()+O.bottomRightRadius()<=10,O.topLeftRadius()+O.bottomLeftRadius()<=10,O.topRightRadius()+O.bottomRightRadius()<=10}),ce("Zero radii",()=>{let T=Me.createSceneWithCanvasForTests1().root().childAt1(0),R=qr(T);R.setSize(new F(100,100)),R.setRectangleCornerRadiiIndependent(!0),R.setRectangleTopLeftCornerRadius(0),R.setRectangleTopRightCornerRadius(0),R.setRectangleBottomLeftCornerRadius(0),R.setRectangleBottomRightCornerRadius(0),R.setCornerSmoothing(.3);let b=new gt(R),O=Jo.createFromNode(b);O.topLeftRadius(),O.topRightRadius(),O.bottomLeftRadius(),O.bottomRightRadius()}),ce("Corner smoothing constraints",()=>{let T=Me.createSceneWithCanvasForTests1().root().childAt1(0),R=qr(T);R.setSize(new F(100,100)),R.setRectangleCornerRadiiIndependent(!0),R.setRectangleTopLeftCornerRadius(40),R.setRectangleTopRightCornerRadius(40),R.setRectangleBottomLeftCornerRadius(30),R.setRectangleBottomRightCornerRadius(30),R.setCornerSmoothing(.5);let b=new gt(R),O=Jo.createFromNode(b);O.cornerSmoothings[0]<.5,O.cornerSmoothings[1]<.5,O.cornerSmoothings[2]<.5,O.cornerSmoothings[3]<.5})})}A.testGlassRectCornerInfo=h;let g;(R=>(R[R.FILL=0]="FILL",R[R.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(g=A.GeometryType||(A.GeometryType={}));let m;(R=>{function S(b){return b==0||b==1}R.GeometryType_hasFill=S;function T(b){return b==1}R.GeometryType_hasStroke=T})(m=A.in_GeometryType||(A.in_GeometryType={}))})(mA||(mA={}));function yM(){let t=new gi,e=new Ii(1024,256,()=>1,()=>Number.POSITIVE_INFINITY);return new cd(t,e)}function Uz(t){let e=new Gr("NONZERO",0,Lt.new2().moveTo1(t.x(),t.y()).lineTo(t.x()+t.width(),t.y()).lineTo(t.x()+t.width(),t.y()+t.height()).lineTo(t.x(),t.y()+t.height()-1).close(),t);return new Ur([e],null,e.bounds(),null)}function fA(t,e){let r=Vd(t);return r.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),r.setTestOnlyFillGeometry(Uz(e)),je(r,e.topLeft(),e.size()),r}function DN(t){let e=yM(),r=t.map(n=>{let o=n.renderTree1();return o!=null,new Vc(o,e)});return r.length===1?r[0]:Le.wrap(r)}var RM;(i=>{function t(){let a=qa(1,new L(0,0,100,100),new L(-50,-50,200,200),null,2048,256);a.length}i.testReturnsEmptyListForNullRoot=t;function e(){let s=Me.createSceneWithCanvasForTests1().root().childAt1(0),l=fA(s,new L(10,10,50,50)),c=DN([l]),d=qa(1,new L(0,0,100,100),new L(0,0,100,100),c,2048,256);d.length>=1,d[0]instanceof ku,d[0].canvasSpaceDistanceToViewport>=0}i.testSingleTileReturned=e;function r(){let s=Me.createSceneWithCanvasForTests1().root().childAt1(0),l=fA(s,new L(0,0,150,150)),c=DN([l]),d=qa(1,new L(0,0,100,100),new L(0,0,200,200),c,2048,256);d.length>=1;for(let u=0;u<d.length-1;u++)d[u].canvasSpaceDistanceToViewport<=d[u+1].canvasSpaceDistanceToViewport;d.forEach((u,p)=>{u.canvasSpaceDistanceToViewport>=0})}i.testTilesPrioritizedByDistanceToViewport=r;function n(){let s=Me.createSceneWithCanvasForTests1().root().childAt1(0),c=fA(s,new L(0,0,200,200)).renderTree1();c!=null;let d=yM(),u=new Vc(c,d),p=new mt(u,"test-low-scale",et.MAX_TRANSFORM_SCALE,()=>1),_=qa(2,new L(0,0,200,200),new L(0,0,200,200),p,2048,256),h=new mt(u,"test-medium-scale",et.MAX_TRANSFORM_SCALE,()=>2),g=qa(2,new L(0,0,200,200),new L(0,0,200,200),h,2048,256),m=new mt(u,"test-high-scale",et.MAX_TRANSFORM_SCALE,()=>4),A=qa(2,new L(0,0,200,200),new L(0,0,200,200),m,2048,256);_.length,g.length,A.length,[_,g,A].forEach(S=>{S.forEach(T=>{T instanceof ku,T.canvasSpaceDistanceToViewport>=0})})}i.testMaxTransformScaleAffectsTileCount=n;function o(){let s=Me.createSceneWithCanvasForTests1().root().childAt1(0),l=fA(s,new L(100,100,50,50)),c=DN([l]),d=qa(1,new L(0,0,50,50),new L(0,0,90,90),c,2048,256);d.length;let u=qa(1,new L(0,0,50,50),new L(0,0,200,200),c,2048,256);u.length}i.testCullingBoundsFiltersTiles=o})(RM||(RM={}));function Is(){return{}}function Vz(t){let e=new Gr("NONZERO",0,Lt.new2().moveTo1(t.x(),t.y()).lineTo(t.x()+t.width(),t.y()).lineTo(t.x()+t.width(),t.y()+t.height()).lineTo(t.x(),t.y()+t.height()-1).close(),t);return new Ur([e],null,e.bounds(),null)}function Ea(t,e){let r=Vd(t);return r.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),r.setTestOnlyFillGeometry(Vz(e)),je(r,e.topLeft(),e.size()),r}function gA(t){return new mt(t,"test-id",et.MAX_TRANSFORM_SCALE,()=>1)}var bM;(u=>{let t=new Js("./src/test/prepare-for-efficient-compositing.test.ts");function e(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),h=qr(_);h.setTestOnlyFillPaints([$.createSolid(N.RED,1)]);let g=h.renderTree1();g!=null;let m=[1],A=Is(),S=mr(g,m,A);return t.asyncAssertMatchesSnapshot("axis-aligned rect fills remain unchanged",S.debugString1())}u.testAxisAlignedRectFillsNotCached=e;function r(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=[1],A=Is(),S=mr(g,m,A);return t.asyncAssertMatchesSnapshot("complex geometry becomes CompositeTileGrid",S.debugString1())}u.testComplexGeometryGetsCached=r;function n(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=Q.new2();m.scale4(2,2);let A=new so(g,m),S=[1],T=Is(),R=mr(A,S,T);return t.asyncAssertMatchesSnapshot("StaticTransformBinding preserved with cached child",R.debugString1())}u.testStaticTransformBindingPreserved=n;function o(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),h=Ea(_,new L(0,0,50,50)),g=Ea(_,new L(60,0,50,50)),m=Ea(_,new L(120,0,50,50)),A=Ea(_,new L(180,0,50,50)),S=h.renderTree1(),T=g.renderTree1(),R=m.renderTree1(),b=A.renderTree1();S!=null&&T!=null&&R!=null&&b!=null;let O=gA(T),f=Le.wrap([S,O,R,b]),I=[1],y=Is(),P=mr(f,I,y);return t.asyncAssertMatchesSnapshot("group batches cacheable nodes around uncacheable",P.debugString1())}u.testGroupBatchingOptimization=o;function i(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=[15],A=Is(),S=mr(g,m,A);return t.asyncAssertMatchesSnapshot("large scale avoids caching",S.debugString1())}u.testLargeTransformScaleAvoidsCaching=i;function a(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=gA(g),A=Yn.createForStandardBlur(5,m,new L(0,0,100,100)),S=[1],T=Is(),R=mr(A,S,T);return t.asyncAssertMatchesSnapshot("large blur radius stops recursion",R.debugString1())}u.testBlurWithLargeRadiusReturnedUnchanged=a;function s(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=gA(g),A=Yn.createForStandardBlur(.5,m,new L(0,0,100,100)),S=[1],T=Is(),R=mr(A,S,T);return t.asyncAssertMatchesSnapshot("small blur radius recurses to process child",R.debugString1())}u.testBlurWithSmallRadiusCachesChild=s;function l(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=new ua(g,0),A=[1],S=Is(),T=mr(m,A,S);return t.asyncAssertMatchesSnapshot("metadata with cached child",T.debugString1())}u.testMetadataWrappingCacheableNode=l;function c(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=new Fo("NORMAL",.5,g),A=[1],S=Is(),T=mr(m,A,S);return t.asyncAssertMatchesSnapshot("blend with cached child",T.debugString1())}u.testBlendWrappingCacheableNode=c;function d(){let _=Me.createSceneWithCanvasForTests1().root().childAt1(0),g=Ea(_,new L(0,0,100,100)).renderTree1();g!=null;let m=gA(g),A=[1],S=Is(),T=mr(m,A,S);return t.asyncAssertMatchesSnapshot("volatile property binding with cached child",T.debugString1())}u.testVolatilePropertyBindingPreservesStructure=d})(bM||(bM={}));var TA;(s=>(s.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),s.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),s.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),s.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),s.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),s.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),s.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(TA||(TA={}));var Ph=class{constructor(e,r){if(this._app=null,this._frameLoader=null,this._session=null,this._pendingNodeId=null,this._app=e,this._session=r,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=Xt.getEventEmitter(),this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",n=>{n.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}hasPendingSelectionChange(){return this._pendingNodeId!=null}connectToFileAndShowNode(e,r,n,o,i,a){n!=null&&(this._app.state().prototypeState().mostRecentFixInvalidStateInitiator="Mirror.connectToFileAndShowNode",this._app.state().setActivePrototypeStartingPointNodeId(n)),this._session.fileKey()!=e?this._app.connectTo(e,r,n,o,i,a):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(r),this._pendingNodeId=r):this._frameLoader.requestTlf(r)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays(r):this._pendingNodeId=r}_handleIncrementalLoadFinished(){var e;this._pendingNodeId!=null&&((e=this._app.state().scene())==null?void 0:e.findNode(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}},Fh=class{constructor(e,r){this._app=null,this._session=null,this._app=e,this._session=r,this._observer=new xN(e.state()),Xt.getEventEmitter().on("sceneDidCompleteInitialLoad",n=>{e.state().scene().addObserver(this._observer)})}hasPendingSelectionChange(){return this._observer.hasPendingNodeId()}connectToFileAndShowNode(e,r,n,o,i,a){n!=null&&(this._app.state().prototypeState().mostRecentFixInvalidStateInitiator="Mirror.connectToFileAndShowNode",this._app.state().setActivePrototypeStartingPointNodeId(n)),this._session.fileKey()!=e?this._app.connectTo(e,r,n,o,i,a):this._app.state().currentFileKey()!=e?this._observer.setPendingNodeId(r):this.navigateToFrameAndCloseOverlays(r,n)}navigateToFrameAndCloseOverlays(e,r){var a;let n=X.fromString(e),o=X.fromString(r),i=this._app.state();if(n!=null&&X.isValid(n)){this._observer.setPendingNodeId(null);let s=(a=i.scene())==null?void 0:a.findNode(n);if(s!=null){i.prototypeState().mostRecentBaseScreenIdChangeInitiator="Mirror.navigateToFrameAndCloseOverlays",i.prototypeState().resetPrototype(!1),i.videoManager().handleRestartPrototype(),o&&(i.prototypeState().mostRecentFixInvalidStateInitiator="Mirror.navigateToFrameAndCloseOverlays",i.setActivePrototypeStartingPointNodeId(o));let l=o&&s.topLevelAncestor()==null?o:n;i.prototypeState().navigateToFrameAndCloseOverlays(l,null,2,0,22,null,null)}else this._observer.setPendingNodeId(n),this._session.incrementalLoader().requestTlf(n)}else console.error(`Expected node id; got '${e}' instead`)}},xN=class{constructor(e){this.appState=null,this._pendingNodeId=null,this.appState=e}setPendingNodeId(e){this._pendingNodeId=e}hasPendingNodeId(){return this._pendingNodeId!=null}handleSceneGraphEvent(e){var n;let r=this._pendingNodeId;if(!(r==null||e.node.id()!==r||!(e.property===58&&e.newVal))){if(this.appState.baseScreenId()===r){this._pendingNodeId=null;return}((n=this.appState.scene())==null?void 0:n.findNode(r))!=null&&this.appState.prototypeStructure().validDestinationForPrototypeFromId(r)&&(this._pendingNodeId=null,this.appState.prototypeState().mostRecentBaseScreenIdChangeInitiator="MirrorPrototypeObserver.handleSceneGraphEvent",this.appState.prototypeState().resetPrototype(!0),this.appState.videoManager().handleRestartPrototype(),this.appState.prototypeState().mostRecentFixInvalidStateInitiator="MirrorPrototypeObserver.handleSceneGraphEvent",this.appState.setActivePrototypeStartingPointNodeId(r),this.appState.prototypeState().navigateToFrameAndCloseOverlays(r,null,2,0,22,null,null))}}};var Qu;(a=>{function t(s){return{x:Math.round(s.x()*100)/100,y:Math.round(s.y()*100)/100}}a._serialize=t;function e(s){return new F(s.x,s.y)}a._deserializeVector=e;function r(s,l){1&l&&(s.alt=!0),2&l&&(s.meta=!0),4&l&&(s.shift=!0),8&l&&(s.ctrl=!0),16&l&&(s.platform=!0)}a._setModifiers=r;function n(s){return("alt"in s?1:0)|("meta"in s?2:0)|("shift"in s?4:0)|("ctrl"in s?8:0)|("platform"in s?16:0)}a._loadModifiers=n;function o(s,l){let c=s.asMouseEvent();if(c!=null){let u={};return u.type=vc[s.type()],u.at=t(l(c.locationInWindow)),c.locationInWindow.equals(c.previousLocationInWindow)||(u.lastAt=t(l(c.previousLocationInWindow))),c.clickCount!=0&&(u.clicks=c.clickCount),c.scrollDelta!=null&&(u.scroll=t(c.scrollDelta)),r(u,s.modifiers()),u}let d=s.asKeyEvent();if(d!=null){let u={};return u.type=vc[s.type()],u.key=d.key,d.isRepeat&&(u.repeat=!0),r(u,s.modifiers()),u}return null}a.serialize=o;function i(s,l,c,d){let u=gl.ViewerEventType_fromString(s.type);if(gl.ViewerEventType_isMouseEventType(u)){let p=d(e(s.at)),_=l(p),h=p;"lastAt"in s&&(h=d(e(s.lastAt)));let g=null;"scroll"in s&&(g=e(s.scroll));let m=0;"clicks"in s&&(m=s.clicks);let A=n(s);return new Ic(u,_,A,p,h,g,m,[])}else if(gl.ViewerEventType_isKeyEventType(u)){let p=c(),_=s.key|0,h=s.repeat,g=n(s);return new yc(u,p,g,_,h)}else if(gl.ViewerEventType_isTouchEventType(u)){let p=n(s),_=d(e(s.at)),h=l(_);if(u==11||u==12){let g=_;"lastAt"in s&&(g=d(e(s.lastAt)));let m=new Fd(0,h,_,g);return new Rc(u,h,p,[m],[m])}else return new Rc(u,h,p,[],[])}else if(gl.ViewerEventType_isWindowEventType(u))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${vc[u]}`)}a.deserialize=i})(Qu||(Qu={}));var vM="multiplayerLocalBroadcaster",Yz="handshakeBroadcaster",NM="multiplayerLocalBroadcasterReady",PM="multiplayerLocalBroadcasterHandlerReady",CM="LOCAL_COMMUNICATION_PAIR_REQUEST",OM="LOCAL_COMMUNICATION_PAIR_RESPONSE",EA=["recentClicks","instanceStateChanges","triggeredOverlaysData","videoStateChangeData","embeddedPrototypeData","activeSlidesEmbeddablePrototype","selection","lastTriggeredHotspot","lastTriggeredPrototypeInteractionID","lastTriggeredObjectAnimationIndex","triggeredSetVariableActionData","triggeredSetVariableModeActionData","mouse","scrollPositions"];function Qz(){return Math.floor(Math.random()*1e4)}var IA=class{constructor(e,r,n){this._hasSessionReceivedJoinEnd=!1;this._channelId=null;this._broadcastChannel=null;this._hasReceivedHandshake=!1;this._pairingMessageListener=null;this._cleanupListener=null;this._session=e,this._role=r,this._session.addObserver(this),this._handshakeChannel=new BroadcastChannel(Yz),this.enableBidirectionalComms()?this.setupPairingListener():(this._broadcastChannel=new BroadcastChannel(vM),this.setupHandshakeHandler(n))}enableBidirectionalComms(){return U.getFeatureFlags().slides_pv_av_bidirectional_comms??!1}onHandshakeReceived(){}setupHandshakeHandler(e){this.enableBidirectionalComms()||(this._handshakeChannel.onmessage=r=>{r.data.type===e&&(this._hasReceivedHandshake=!0,this.onHandshakeReceived())})}onBroadcastChannelMessage(e){}setupBroadcastChannel(e){this._channelId=e;let r=`${vM}-${this._channelId}`;this._broadcastChannel=new BroadcastChannel(r),this._hasReceivedHandshake=!1,this._broadcastChannel.onmessage=n=>{var o;n.data.type==="HANDSHAKE_REQUEST"?(this._hasReceivedHandshake=!0,this.maybeRespondToHandshake()):n.data.type==="HANDSHAKE_RESPONSE"?this._hasReceivedHandshake=!0:n.data.type==="CLOSE_CHANNEL"?((o=this._broadcastChannel)==null||o.close(),this._broadcastChannel=null):this.onBroadcastChannelMessage(n)}}maybeSendHandshake(){this.enableBidirectionalComms()&&this._hasSessionReceivedJoinEnd&&this._broadcastChannel&&this._broadcastChannel.postMessage({type:"HANDSHAKE_REQUEST"})}maybeRespondToHandshake(){this.enableBidirectionalComms()&&this._hasReceivedHandshake&&this._hasSessionReceivedJoinEnd&&this._broadcastChannel&&this._broadcastChannel.postMessage({type:"HANDSHAKE_RESPONSE"})}setupPairingRequest(){if(!this.enableBidirectionalComms()||!window.opener)return;let e=Qz();window.opener.postMessage({type:CM,requestRole:this._role==="driver"?"receiver":"driver",channelId:e})}setupPairingListener(){this.enableBidirectionalComms()&&(this._pairingMessageListener=e=>{e.data.type===CM&&e.data.channelId&&e.data.requestRole===this._role&&e.source?(this.setupBroadcastChannel(e.data.channelId),e.source.postMessage({type:OM,channelId:e.data.channelId,acceptedByRole:this._role})):e.data.type===OM&&e.data.channelId&&e.data.acceptedByRole!==this._role&&this.setupBroadcastChannel(e.data.channelId)},window.addEventListener("message",this._pairingMessageListener))}setupCleanupListener(){en||(this._cleanupListener=()=>{this._pairingMessageListener&&(window.removeEventListener("message",this._pairingMessageListener),this._pairingMessageListener=null),this._cleanupListener&&(window.removeEventListener("beforeunload",this._cleanupListener),this._cleanupListener=null),this._broadcastChannel&&(this._broadcastChannel.postMessage({type:"CLOSE_CHANNEL"}),this._broadcastChannel=null)},window.addEventListener("beforeunload",this._cleanupListener))}handleJoinEnd(){this._hasSessionReceivedJoinEnd=!0,this.enableBidirectionalComms()&&(this.setupPairingRequest(),this.setupCleanupListener())}isReadyForUse(){return this._hasSessionReceivedJoinEnd&&this._broadcastChannel!==null&&this._hasReceivedHandshake}handleConnect(e,r){}handleDisconnect(){}handleJoinStart(e,r,n){}handlePresenterChange(){}handleNodeChanges(){}handleSceneGraphReply(e,r){}handleSceneChangedLoadingPhase(e,r){}},Dh=class extends IA{constructor(e){super(e,"driver",PM),this._session.addMultiplayerMessageObserver(this)}onHandshakeReceived(){this.enableBidirectionalComms()||this._handshakeChannel.postMessage({type:NM})}handleMultiplayerMessage(e){var r;if(this.isReadyForUse()||e.type==="USER_CHANGES"&&this.maybeSendHandshake(),EA.some(n=>{var o,i;return(i=(o=e.userChanges)==null?void 0:o[0])==null?void 0:i[n]})){let n=wi.deflateRaw(Be().encodeMessage(e));(r=this._broadcastChannel)==null||r.postMessage(n),this._session.clearNextUserChange()}}sendObservingSessionIdMessage(e){var r;this.enableBidirectionalComms()&&((r=this._broadcastChannel)==null||r.postMessage({type:"SET_OBSERVING_SESSION_ID",sessionId:e}))}},xh=class extends IA{constructor(r,n){super(r,"receiver",NM);this._localBroadcasterSessionId=null;this._coupler=n,this.enableBidirectionalComms()||this.setupBroadcastChannelMessageHandler()}setupBroadcastChannelMessageHandler(){this._broadcastChannel&&(this._broadcastChannel.onmessage=r=>{this.isReadyForUse()&&this.handleMessage(r)})}handleMessage(r){var o;this._createMultiplayerUserSyncingIfNotExists(),this._maybeSetObservingSessionId();let n=v();n&&r.data&&((o=n.modules().prototype)==null||o.handleCompressedMultiplayerMessage(r.data,this._session.sessionID(),en,!0))}handleJoinEnd(){super.handleJoinEnd(),!this.enableBidirectionalComms()&&!this._hasReceivedHandshake&&this._handshakeChannel.postMessage({type:PM})}onBroadcastChannelMessage(r){r.data.type==="SET_OBSERVING_SESSION_ID"?r.data.sessionId&&this._session.sessionID()!==r.data.sessionId&&this._session.observingSessionID()!==r.data.sessionId&&(this._coupler.syncObserved({allowTransitions:!1,isNewObservation:!1}),this._session.setObservingSessionID(r.data.sessionId),this._coupler.handlePresenterChange()):this.isReadyForUse()&&this.handleMessage(r)}maybeForceUpdateOnUserChange(){this.isReadyForUse()&&this._coupler&&window.document.hidden&&this._coupler.syncObserved({allowTransitions:!1,isNewObservation:!1})}storeLocalBroadcasterSessionId(r){r!==this._session.sessionID()&&(this._localBroadcasterSessionId=r)}isSessionIdFromLocalBroadcasterPair(r){return!r||this._localBroadcasterSessionId===null?!1:r===this._localBroadcasterSessionId}shouldHandleUserChange(r,n){return this.enableBidirectionalComms()?this.shouldHandleUserChangeWithBidirectionalComms(r,n):!this.isReadyForUse()||!this._session.isObserving()||r.connected!==void 0?!0:EA.some(o=>r[o])?n:!0}shouldHandleUserChangeWithBidirectionalComms(r,n){return!this.isReadyForUse()||r.connected!==void 0?!0:EA.some(o=>r[o])?(n&&r.sessionID&&this.storeLocalBroadcasterSessionId(r.sessionID),this.isSessionIdFromLocalBroadcasterPair(r.sessionID)?n:!0):!0}_createMultiplayerUserSyncingIfNotExists(){if(this.enableBidirectionalComms()?this._session.isObserving()&&this._session.observedUser()===null:!this._session.observedUser()&&!this._session.hasMultiplayerUserSyncing()){let n=new ad(this._session.sessionID());n.addUserBySessionId(this._session.observingSessionID()),this._session.setMultiplayerUserSyncing(n)}}handleDisconnect(){this.isReadyForUse()&&this._createMultiplayerUserSyncingIfNotExists()}_maybeSetObservingSessionId(){this.enableBidirectionalComms()||(this._session.isObserving()?this._observingSessionId=this._session.observingSessionID():this._observingSessionId&&this._session.setObservingSessionID(this._observingSessionId))}};var nWe=new Nu(1/.05,1),oWe=Ou.withDampingRatio(.5,100,1.1);var xM;(r=>{function t(n,o){return n(o)}r.call=t;function e(n){return n}r._new=e})(xM||(xM={}));var LN;(o=>{function t(i,a){e(i.map(s=>(l,c,d,u)=>{s(d,u)}),a)}o.createNewSceneAndRun=t;function e(i,a=(s,l)=>Dr(s,l,N.BLACK)){let s=new Sr,l=Me.createSceneWithCanvasForTests1(),c=l.root().childAt1(0),d=a(c,"source");d.setRelativeTransform(new Q(1,0,0,0,1,400)),d.setSize(new F(500,700));let u=a(c,"dst");u.setRelativeTransform(new Q(1,0,0,0,1,1100)),u.setSize(new F(500,700)),s.setActiveCanvas(c),s.setScene(l);for(let p of i)p(s,l,d,u)}function r(){let i=Ru().deepStrictEqual,a=new Js("./src/test/protomagicmove.test.ts");beforeEach(()=>{U.setViewerMode(U.ViewerMode.PROTOTYPE)}),Ct("getNodeMatches",()=>{let s=(l,c,d)=>{let u=Ei.getNodeMatches(l,c);for(let p of d){let _=p[0],h=p[1],g=qe.StringMap_get(u,_.id(),null),m=qe.StringMap_get(u,h.id(),null);i(g,h,`Expected ${_.id()} to match ${h.id()}, but got ${g==null?null:g.id()} instead.`),i(m,_,`Expected ${h.id()} to match ${_.id()}, but got ${m==null?null:m.id()} instead.`)}i(u.size,d.length*2)};ce("simple match case",()=>{let c=Me.createSceneWithCanvasForTests1().root().childAt1(0),d=ht(c,"src"),u=dt(d,"A"),p=dt(d,"B"),_=dt(d,"C"),h=ht(c,"dst"),g=dt(h,"A"),m=dt(h,"B"),A=dt(h,"C");s(d,h,[[u,g],[p,m],[_,A]])}),ce("crossed match case",()=>{let c=Me.createSceneWithCanvasForTests1().root().childAt1(0),d=ht(c,"src"),u=dt(d,"A"),p=dt(d,"B"),_=ht(c,"dst"),h=dt(_,"B"),g=dt(_,"A");s(d,_,[[u,g],[p,h]])}),ce("duplicate names",()=>{let c=Me.createSceneWithCanvasForTests1().root().childAt1(0),d=ht(c,"src"),u=dt(d,"A"),p=dt(d,"A");dt(d,"A");let _=ht(c,"dst"),h=dt(_,"A"),g=dt(_,"A");s(d,_,[[u,h],[p,g]])}),ce("recursive matches",()=>{let c=Me.createSceneWithCanvasForTests1().root().childAt1(0),d=ht(c,"src"),u=ht(c,"dst"),p=dt(d,"A"),_=dt(p,"A"),h=dt(p,"B"),g=dt(d,"B");dt(g,"A"),dt(g,"B");let m=dt(d,"C");dt(m,"A"),dt(m,"B");let A=dt(u,"A"),S=dt(A,"A"),T=dt(A,"B"),R=dt(u,"B");dt(R,"C"),dt(R,"D");let b=dt(u,"D");dt(b,"A"),dt(b,"B"),s(d,u,[[p,A],[_,S],[h,T],[g,R]])}),ce("hidden and transparent nodes",()=>{let c=Me.createSceneWithCanvasForTests1().root().childAt1(0),d=ht(c,"src"),u=dt(d,"A");dt(d,"B");let p=dt(d,"C"),_=dt(d,"D");u.setVisible(!1),p.setOpacity(0);let h=ht(c,"dst");dt(h,"A");let g=dt(h,"B"),m=dt(h,"C"),A=dt(h,"D");g.setVisible(!1),_.setOpacity(0),s(d,h,[[p,m],[_,A]])}),ce("boolean op nodes",()=>{let c=Me.createSceneWithCanvasForTests1().root().childAt1(0),d=ht(c,"src"),u=Ud(d);u.setName("booleanOp"),dt(u,"A"),dt(u,"B");let p=ht(c,"dst"),_=Ud(p);_.setName("booleanOp"),dt(_,"A"),dt(_,"B"),s(d,p,[[u,_]])})}),ce("Smart animate of fixed elements",()=>{let s=new F(100,100),l=new F(10,10),c=new Sr,d=Me.createSceneWithCanvasForTests1(),u=d.root().childAt1(0);u.setPrototypeDevice(new Wn("CUSTOM",s,null,"NONE")),u.setCurrentViewportSize(s),c.setActiveCanvas(u),c.setScene(d);let p=(m,A)=>{let S=Xe(u);S.setSize(new F(m,A)),S.setUsedAsBaseScreen(!0);let T=qr(S);return T.setSize(new F(10,10)),T.setRelativeTransform(new Q(1,0,0,0,1,A-l.y())),T.setVerticalConstraint("MAX"),T.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),S},_=p(100,200),h=p(100,100);wc(_,h);let g=Mu.buildStrategy(_.childAt1(0),h.childAt1(0));i(g.transition.from().transform1().translation().y(),s.y()-l.y()),i(g.transition.to().transform1().translation().y(),s.y()-l.y())}),Ct("interpolation strategies",()=>{let s=(l,c)=>{let d=Mu.buildStrategy(l,c);Ya(d.isDissolve)};ce("dissolve discrete properties",()=>{[(c,d)=>{let u=pe(c,"A");u.setBlendMode("NORMAL");let p=pe(d,"A");p.setBlendMode("MULTIPLY"),s(u,p)},(c,d)=>{let u=LF(c,"B"),p=pe(d,"B");s(u,p)},(c,d)=>{let u=Dr(c,"C",N.TRANSPARENT);pe(u,"C_content");let p=Us(d,"C");pe(p,"C_content"),s(u,p)},(c,d)=>{c.setOverflowDirection("VERTICAL"),d.setOverflowDirection("VERTICAL");let u=pe(c,"D");u.setScrollBehavior("SCROLLS");let p=pe(d,"D");p.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),s(u,p)}].forEach(c=>{t([c])})}),ce("interpolate effects and paints",()=>{let l=$.createLinearGradient([new _t(N.RED,0),new _t(N.TRANSPARENT,.5)]);[(d,u)=>{let p=af(d,"A",[l]),_=pe(u,"A");s(p,_)},(d,u)=>{let p=pe(d,"B");p.setTestOnlyEffects([]);let _=pe(u,"B");_.setTestOnlyEffects([Oe.createForegroundBlur(1)]),s(p,_)},(d,u)=>{let p=pe(d,"C");p.setTestOnlyEffects([Oe.createForegroundBlur(1)]);let _=pe(u,"C");_.setTestOnlyEffects([Oe.createDropShadow(1,new F(1,1),N.BLACK,1)]),s(p,_)},(d,u)=>{let p=pe(d,"D"),_=[Oe.createForegroundBlur(1),Oe.createDropShadow(1,new F(1,1),N.BLACK,1)];p.setTestOnlyEffects(_);let h=pe(u,"D"),g=_.slice();g[0].setIsEnabled(!1),h.setTestOnlyEffects(g),s(p,h)},(d,u)=>{let p=pe(d,"E"),_=[l,$.createSolid(N.RED,1)];p.setTestOnlyFillPaints(_);let h=pe(u,"E"),g=_.slice();g[0].setIsEnabled(!1),h.setTestOnlyFillPaints(g),s(p,h)}].forEach(d=>{t([d])})}),ce("interpolate geometry",()=>{let l=(d,u,p)=>{let _=dt(d,u);_.setTestOnlyFillPaints([$.createSolid(N.BLACK,1)]);let h=p.topLeft().x(),g=p.topLeft().y(),m=p.width(),A=p.height(),S=new Gr("NONZERO",0,Lt.new2().moveTo1(h,g).lineTo(h+m,g).lineTo(h+m,g+A).lineTo(h,g+A-1).close(),p),T=new Ur([S],null,S.bounds(),null);return _.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),_.setTestOnlyFillGeometry(T),_.setTestOnlyStrokeGeometry(T),je(_,p.topLeft(),p.size()),_};[(d,u)=>{let p=l(d,"A",new L(0,0,100,100)),_=tr(u,"A",N.RED,1);s(p,_)}].forEach(d=>{t([d])})})}),Ct("magic move",()=>{let s=(u,p,_,h)=>{Jc(u,()=>{let g=[];return p.forEach(m=>{t([_,(A,S)=>{var y;let T=new Q(1,0,0,0,1,700),R=wt.FrozenAffineTransform_IDENTITY,b=Ei.getMagicMovePlan2(A,T,S,R,Zr.get(m));g.push(a.asyncAssertMatchesSnapshot(`plan ${m}`,b.debugString()));let O=()=>0,f=No.makeEasingFunction([0,0,1,1],.3),I=new Ta(b,O,f);g.push(a.asyncAssertMatchesSnapshot(`render tree ${m}`,((y=I.renderTree())==null?void 0:y.debugString1())??""))}],h)}),Promise.all(g)})},l=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],d=["DISSOLVE"];s("identical rectangles",d,(u,p)=>{pe(u,"rect"),pe(p,"rect")}),s("rectangles with different opacities",d,(u,p)=>{pe(u,"rect").setOpacity(.9),pe(p,"rect").setOpacity(.1)}),s("rectangles with changing and unchanging paints",d,(u,p)=>{af(u,"rect",[$.createSolid(N.RED,1),$.createSolid(N.GREEN,1)]),af(p,"rect",[$.createSolid(N.BLUE,1),$.createSolid(N.GREEN,1)])}),s("rectangles with different translations",d,(u,p)=>{pe(u,"rect").setRelativeTransform(new Q(1,0,30,0,1,50)),pe(p,"rect").setRelativeTransform(new Q(1,0,130,0,1,250))}),s("rectangles with different rotation",d,(u,p)=>{let _=pe(u,"rect");_.setRelativeTransform(new Q(1,0,30,0,1,50));let h=pe(p,"rect"),g=Q.new3(_.relativeTransform());g.rotatedBy(Math.PI/4),h.setRelativeTransform(g)}),s("rectangles with different scale",d,(u,p)=>{let _=pe(u,"rect");_.setRelativeTransform(new Q(1,0,30,0,1,50));let h=pe(p,"rect"),g=Q.new3(_.relativeTransform());g.scaledBy1(new F(2,3)),h.setRelativeTransform(g)}),s("insertion of new rectangle",d,(u,p)=>{pe(p,"rect")}),s("deletion of old rectangle",d,(u,p)=>{pe(u,"rect")}),s("rectangles with mismatched names",d,(u,p)=>{pe(u,"A"),pe(p,"B")}),s("hidden and never-visible rectangles",d,(u,p)=>{let _=pe(u,"hidden"),h=pe(u,"neverVisible");_.setVisible(!1),h.setOpacity(0);let g=pe(p,"hidden"),m=pe(p,"neverVisible");g.setVisible(!1),m.setOpacity(0)}),s("hidden and transparent and no match nodes to visible nodes",d,(u,p)=>{let _=pe(u,"hidden"),h=pe(u,"transparent");_.setVisible(!1),h.setOpacity(0),pe(p,"hidden"),pe(p,"transparent"),pe(p,"noMatch")}),s("visible nodes to hidden and transparent and no match nodes",d,(u,p)=>{pe(u,"hidden"),pe(u,"transparent"),pe(u,"noMatch");let _=pe(p,"hidden"),h=pe(p,"transparent");_.setVisible(!1),h.setOpacity(0)}),s("matching boolean op nodes",d,(u,p)=>{let _=Ud(u);_.setName("booleanOp"),dt(_,"A"),dt(_,"B");let h=Ud(p);h.setName("booleanOp"),dt(h,"A"),dt(h,"B")}),s("simple matching with layer re-ordering",d,(u,p)=>{pe(u,"A"),pe(u,"B"),pe(p,"B"),pe(p,"A")}),s("simple insertion, deletion, and matching",l,(u,p)=>{pe(u,"A"),pe(u,"B"),pe(p,"C"),pe(p,"B")}),s("complex layer re-ordering with insertions and removals",c,(u,p)=>{pe(u,"A"),pe(u,"B"),pe(u,"C"),pe(u,"D"),pe(u,"E"),pe(u,"F"),pe(u,"G"),pe(u,"H"),pe(p,"1"),pe(p,"2"),pe(p,"F"),pe(p,"3"),pe(p,"4"),pe(p,"C"),pe(p,"5"),pe(p,"6")}),s("complex matching case with no nesting",d,(u,p)=>{pe(u,"A"),pe(u,"B"),pe(u,"C"),pe(u,"E"),pe(p,"X"),pe(p,"Y"),pe(p,"B"),pe(p,"Z"),pe(p,"E"),pe(p,"F")}),s("simple nested matching",d,(u,p)=>{let _=ht(u,"F");ht(_,"rect");let h=ht(p,"F");ht(h,"rect").setOpacity(.5)}),s("nested insertions/removals",c,(u,p)=>{let _=ht(u,"A");pe(_,"rectA");let h=ht(p,"B");pe(h,"rectB")}),s("dissolving between different sized objects",d,(u,p)=>{pe(u,"A").setSize(new F(100,100)),pe(p,"A").setSize(new F(200,200))}),s("dissolving between non-uniformly scaling frames with children",d,(u,p)=>{let _=ht(u,"A");_.setSize(new F(150,1)),tr(_,"rect",N.RED,1).setSize(new F(100,100)),tr(_,"rect",N.RED,1).setSize(new F(100,100));let m=ht(p,"A");m.setSize(new F(300,300)),tr(m,"rect",N.RED,1).setSize(new F(100,100)),tr(m,"rect",N.RED,1).setSize(new F(100,100))}),s("dissolving between background blur objects",d,(u,p)=>{let _=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(_),tr(u,"A",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),tr(p,"A",N.BLUE,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)])}),s("dissolving between background blur objects with a background blur behind",d,(u,p)=>{let _=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(_),tr(u,"BG",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),tr(p,"BG",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),tr(u,"A",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),tr(p,"A",N.BLUE,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)])}),s("translating a background blur contained in a frame with clip-content enabled",d,(u,p)=>{let _=Object({viewer_background_blur_opts:!1});U.updateFeatureFlags(_);let h=ht(u,"A");h.setIsFrameMaskDisabled(!0);let g=ht(h,"B");tr(g,"BG",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]);let A=ht(p,"A");A.setIsFrameMaskDisabled(!0);let S=Q.new3(A.relativeTransform());S.translatedBy2(10,10),A.setRelativeTransform(S);let T=ht(A,"B");tr(T,"BG",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)])}),s("translating a node with a background blur",d,(u,p)=>{tr(u,"BG",N.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]);let h=tr(p,"BG",N.RED,.5);h.setTestOnlyEffects([Oe.createBackgroundBlur(1)]);let g=Q.new3(h.relativeTransform());g.translatedBy2(10,10),h.setRelativeTransform(g)}),s("dissolving + scaling between nodes with unmatched children",d,(u,p)=>{let _=Dr(u,"F",N.RED);_.setSize(new F(100,100)),pe(_,"rect"),ht(p,"F").setSize(new F(200,200))}),s("dissolve only between nodes with unmatched children",d,(u,p)=>{let _=Dr(u,"F",N.RED);_.setSize(new F(100,100)),pe(_,"rect"),PF(p,"F").setSize(new F(100,100))}),s("dissolving between visible top frame to invisibile top frame",d,(u,p)=>{let _=new $("SOLID");_.setColor(N.RED),_.setOpacity(1),_.setIsEnabled(!0),u.setTestOnlyFillPaints([_]),_.setOpacity(0),p.setTestOnlyFillPaints([_])}),s("dissolving between different opacity objects",d,(u,p)=>{let _=pe(u,"A");_.setOpacity(1),_.setBlendMode("MULTIPLY");let h=pe(p,"A");h.setOpacity(.5),h.setBlendMode("NORMAL")}),s("dissolving between invisible node to visible node",d,(u,p)=>{tr(u,"A",N.RED,0),tr(p,"A",N.BLUE,.5)}),s("interpolating between two solid color paints",d,(u,p)=>{tr(u,"A",N.RED,1),tr(p,"A",N.BLUE,1)}),s("drop shadow: node rotates",d,(u,p)=>{let _=pe(u,"rect");_.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new Q(1,0,30,0,1,50));let h=pe(p,"rect");h.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let g=Q.new3(_.relativeTransform());g.rotatedBy(Math.PI/4),h.setRelativeTransform(g)}),s("inner shadow: node rotates",d,(u,p)=>{let _=pe(u,"rect");_.setTestOnlyEffects([Oe.createInnerShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new Q(1,0,30,0,1,50));let h=pe(p,"rect");h.setTestOnlyEffects([Oe.createInnerShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let g=Q.new3(_.relativeTransform());g.rotatedBy(Math.PI/4),h.setRelativeTransform(g)}),s("drop shadow: group shadow where group rotates and children are static",d,(u,p)=>{let _=Dr(u,"F",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),pe(_,"rectA").setRelativeTransform(Q.new2()),pe(_,"rectB").setRelativeTransform(new Q(1,0,50,0,1,0)),_.setRelativeTransform(new Q(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let m=Dr(p,"F",N.TRANSPARENT);m.setIsBackgroundEnabled(!1),pe(m,"rectA").setRelativeTransform(Q.new2()),pe(m,"rectB").setRelativeTransform(new Q(1,0,50,0,1,0));let T=Q.new3(_.relativeTransform());T.rotatedBy(Math.PI/4),m.setRelativeTransform(T),m.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)])}),s("drop shadow: group shadow where group is static and children rotate",d,(u,p)=>{let _=Dr(u,"F",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),pe(_,"rectA").setRelativeTransform(Q.new2()),pe(_,"rectB").setRelativeTransform(new Q(1,0,50,0,1,0)),_.setRelativeTransform(new Q(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let m=Dr(p,"F",N.TRANSPARENT);m.setIsBackgroundEnabled(!1);let A=pe(m,"rectA");A.setRelativeTransform(Q.new2());let S=pe(m,"rectB");S.setRelativeTransform(new Q(1,0,50,0,1,0));let T=Q.new3(A.relativeTransform());T.rotatedBy(Math.PI/4),A.setRelativeTransform(T);let R=Q.new3(S.relativeTransform());R.rotatedBy(Math.PI/4),S.setRelativeTransform(R),m.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)])}),s("drop shadow: complex group shadow with nested groups and mixed transitions",d,(u,p)=>{let _=Dr(u,"staticGroup1",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new Q(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),pe(_,"staticRectZ").setRelativeTransform(Q.new2());let g=Dr(_,"rotatingGroup2",N.TRANSPARENT);g.setIsBackgroundEnabled(!1),pe(g,"rotatingRectA").setRelativeTransform(Q.new2()),pe(g,"staticRectB").setRelativeTransform(new Q(1,0,50,0,1,0));let S=Dr(p,"staticGroup1",N.TRANSPARENT);S.setIsBackgroundEnabled(!1),S.setRelativeTransform(new Q(1,0,30,0,1,50)),S.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),pe(S,"staticRectZ").setRelativeTransform(Q.new2());let R=Dr(S,"rotatingGroup2",N.TRANSPARENT);R.setIsBackgroundEnabled(!1),R.setRelativeTransform(Q.new2().rotatedBy(Math.PI/4)),pe(R,"rotatingRectA").setRelativeTransform(Q.new2().rotatedBy(Math.PI/3)),pe(R,"staticRectB").setRelativeTransform(new Q(1,0,50,0,1,0))}),s("inner shadow: complex group shadow with nested groups and mixed transitions",d,(u,p)=>{let _=Dr(u,"staticGroup1",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new Q(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createInnerShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),pe(_,"staticRectZ").setRelativeTransform(Q.new2());let g=Dr(_,"rotatingGroup2",N.TRANSPARENT);g.setIsBackgroundEnabled(!1),pe(g,"rotatingRectA").setRelativeTransform(Q.new2()),pe(g,"staticRectB").setRelativeTransform(new Q(1,0,50,0,1,0));let S=Dr(p,"staticGroup1",N.TRANSPARENT);S.setIsBackgroundEnabled(!1),S.setRelativeTransform(new Q(1,0,30,0,1,50)),S.setTestOnlyEffects([Oe.createInnerShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),pe(S,"staticRectZ").setRelativeTransform(Q.new2());let R=Dr(S,"rotatingGroup2",N.TRANSPARENT);R.setIsBackgroundEnabled(!1),R.setRelativeTransform(Q.new2().rotatedBy(Math.PI/4)),pe(R,"rotatingRectA").setRelativeTransform(Q.new2().rotatedBy(Math.PI/3)),pe(R,"staticRectB").setRelativeTransform(new Q(1,0,50,0,1,0))}),s("drop shadow: no node change but parent rotates",d,(u,p)=>{let _=ht(u,"F");pe(_,"rect").setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new Q(1,0,30,0,1,50));let g=pe(p,"F");pe(g,"rect").setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let A=Q.new3(_.relativeTransform());A.rotatedBy(Math.PI/4),g.setRelativeTransform(A)}),s("drop shadow: no node change but parent translates/resizes",d,(u,p)=>{let _=ht(u,"F");pe(_,"rect").setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new Q(1,0,30,0,1,50)),_.setSize(new F(100,100));let g=ht(p,"F");pe(g,"rect").setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let A=Q.new3(_.relativeTransform());A.translate1(Ae.FrozenVector_new4(1,1)),g.setRelativeTransform(A),g.setSize(new F(100,200))}),s("transition between scrolling frames",c,(u,p)=>{u.setOverflowDirection("VERTICAL"),u.setTestOnlyFillPaints([$.createSolid(N.RED,1)]),u.setTestOnlyEffects([Oe.createDropShadow(1,new F(1,1),N.BLACK,1)]),p.setTestOnlyFillPaints([$.createSolid(N.BLUE,1)]),p.setTestOnlyEffects([Oe.createDropShadow(1,new F(1,1),N.BLACK,1)]);let _=tr(u,"rect",N.GREEN,1);_.setSize(new F(u.size().x(),u.size().y()+100)),tr(p,"rect",N.GREEN,1).setSize(_.size())}),s("scaling nodes whose children have different scaling factors",d,(u,p)=>{let _=ht(u,"subframe");_.setSize(new F(100,100)),pe(_,"rect").setSize(new F(50,50));let g=ht(p,"subframe");g.setSize(new F(200,200)),pe(g,"rect").setSize(new F(50,50))}),s("deeply nested scaling nodes whose children have different scaling factors",d,(u,p)=>{let _=ht(u,"A");_.setSize(new F(100,100));let h=Dr(_,"B",N.RED);h.setSize(new F(50,50)),Dr(h,"C",N.BLACK).setSize(new F(10,10));let m=ht(p,"A");m.setSize(new F(200,200));let A=pe(m,"B");A.setSize(new F(50,50)),Dr(A,"C",N.BLACK).setSize(new F(10,10))}),s("transition between two screens with masks",d,(u,p)=>{let _=pe(u,"mask");_.setSize(new F(50,50)),_.setIsMask(!0),pe(u,"color").setSize(new F(100,100)),dt(p,"andrew");let g=pe(p,"mask");g.setRelativeTransform(new Q(1,0,10,0,1,10)),g.setSize(new F(50,50)),g.setIsMask(!0),pe(p,"color").setSize(new F(100,100))}),s("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(u,p)=>{let _=ht(u,"A");tr(_,"A_1",N.BLUE,1);let h=ht(p,"A");tr(h,"A_2",N.GREEN,1)}),s("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(u,p)=>{let _=ht(u,"A");_.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),tr(_,"A_1",N.BLUE,1);let h=ht(p,"A");tr(h,"A_2",N.GREEN,1)}),s("dissolving image fills with different geometries should separate into masks",d,(u,p)=>{yv(u,"tri",new F(100,100)),yv(p,"tri",new F(50,100))}),s("dissolving non-image fills with different geometries should NOT separate into masks",d,(u,p)=>{bv(u,"rect",N.RED,1,new F(100,100)),bv(p,"rect",N.GREEN,1,new F(50,100))}),Jc("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let u=[];return d.forEach(p=>{t([(_,h)=>{var b;Io(_,"rect",N.RED,1,new F(100,100)),Io(h,"rect",N.GREEN,1,new F(50,100));let g=new Q(1,0,0,0,1,700),m=wt.FrozenAffineTransform_IDENTITY,A=Ei.getMagicMovePlan2(_,g,h,m,Zr.get(p));u.push(a.asyncAssertMatchesSnapshot(`plan ${p}`,A.debugString()));let S=()=>0,T=No.makeEasingFunction([0,0,1,1],.3),R=new Ta(A,S,T);u.push(a.asyncAssertMatchesSnapshot(`render tree ${p}`,((b=R.renderTree())==null?void 0:b.debugString1())??""))}])}),Promise.all(u)}),Jc("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let u=[];return d.forEach(p=>{t([(_,h)=>{var f;Io(_,"rect",N.RED,1,new F(100,100)).setTestOnlyEffects([Oe.createDropShadow(1,new F(5,5),N.BLACK,.5,10)]),Io(h,"rect",N.GREEN,1,new F(50,100)).setTestOnlyEffects([Oe.createDropShadow(1,new F(5,5),N.BLACK,.5,10)]);let A=new Q(1,0,0,0,1,700),S=wt.FrozenAffineTransform_IDENTITY,T=Ei.getMagicMovePlan2(_,A,h,S,Zr.get(p));u.push(a.asyncAssertMatchesSnapshot(`plan ${p}`,T.debugString()));let R=()=>0,b=No.makeEasingFunction([0,0,1,1],.3),O=new Ta(T,R,b);u.push(a.asyncAssertMatchesSnapshot(`render tree ${p}`,((f=O.renderTree())==null?void 0:f.debugString1())??""))}])}),Promise.all(u)}),s("dissolving image rects with different geometries: render good-enough identical shadows for now",d,(u,p)=>{let _=[Oe.createDropShadow(1,new F(5,5),N.BLACK,.5)];Yp(u,"rect",new F(100,100)).setTestOnlyEffects(_),Yp(p,"rect",new F(50,100)).setTestOnlyEffects(_)}),s("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",d,(u,p)=>{Yp(u,"rect",new F(100,100)).setTestOnlyEffects([Oe.createDropShadow(1,new F(5,5),N.BLACK,.5)]),Yp(p,"rect",new F(50,100)).setTestOnlyEffects([Oe.createDropShadow(5,new F(5,5),N.BLACK,.5)])}),s("groups with drop shadows and moving children",d,(u,p)=>{let _=Us(u,"G");Io(_,"A",N.RED,1,new F(10,10)),Io(_,"B",N.GREEN,1,new F(10,10)),_.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]);let h=Us(p,"G");h.setTestOnlyEffects([Oe.createDropShadow(1,Ae.FrozenVector_new4(1,1),N.BLACK,.5)]),Io(h,"A",N.RED,1,new F(10,10)).setRelativeTransform(new Q(1,0,20,0,1,30)),Io(h,"B",N.GREEN,1,new F(10,10)).setRelativeTransform(new Q(1,0,50,0,1,100))}),s("resizing resize-to-fit-groups without background paints",d,(u,p)=>{let _=Us(u,"G");Io(_,"A",N.RED,1,new F(10,10)).setRelativeTransform(new Q(1,0,0,0,1,0)),Io(_,"B",N.GREEN,1,new F(10,10)).setRelativeTransform(new Q(1,0,10,0,1,30)),_.setSize(new F(20,40));let m=Us(p,"G");Io(m,"A",N.RED,1,new F(10,10)).setRelativeTransform(new Q(1,0,0,0,1,0)),Io(m,"B",N.GREEN,1,new F(10,10)).setRelativeTransform(new Q(1,0,20,0,1,30)),m.setSize(new F(30,40))}),s("resizing resize-to-fit-groups with background paints",d,(u,p)=>{let _=[$.createSolid(N.RED,1)],h=Us(u,"G");h.setTestOnlyFillPaints(_),Io(h,"A",N.RED,1,new F(10,10)).setRelativeTransform(new Q(1,0,0,0,1,0)),Io(h,"B",N.GREEN,1,new F(10,10)).setRelativeTransform(new Q(1,0,10,0,1,30)),h.setSize(new F(20,40));let A=Us(p,"G");A.setTestOnlyFillPaints(_),Io(A,"A",N.RED,1,new F(10,10)).setRelativeTransform(new Q(1,0,0,0,1,0)),Io(A,"B",N.GREEN,1,new F(10,10)).setRelativeTransform(new Q(1,0,20,0,1,30)),A.setSize(new F(30,40))}),s("transition between symbols with new frame properties",d,(u,p)=>{i(u.type(),"SYMBOL"),u.setTestOnlyFillPaints(u.fillPaints()),i(p.type(),"SYMBOL"),p.setTestOnlyFillPaints([$.createSolid(N.RED,1)])},(u,p)=>{let _=pn(u,"SYMBOL"),h=new $("SOLID");return h.setColor(N.BLACK),h.setOpacity(1),h.setIsEnabled(!0),_.setName(p),_.setBackgroundOpacity(1),_.setIsBackgroundEnabled(!0),_.setIsFrameMaskDisabled(!1),_.setIsResizeToFit(!1),_.setTestOnlyFillPaints([h]),_.setStrokeAlign("CENTER"),_}),s("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(u,p)=>{let _=h=>{h.setStackReverseZIndex(!0),h.setStackMode("HORIZONTAL");let g=tr(h,"A",N.RED,.5);g.setSize(new F(20,20)),g.setRelativeTransform(new Q(1,0,0,0,1,0));let m=tr(h,"B",N.BLUE,.5);m.setSize(new F(20,20)),m.setRelativeTransform(new Q(1,0,10,0,1,0))};_(u),_(p)})})}o.testMagicMove=r;function n(){let i=Ru().deepEqual;beforeEach(()=>{U.setViewerMode(U.ViewerMode.PROTOTYPE)}),Ct("Drag vector computation:",()=>{ce("Smart animate drag - matched object with translation",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setRelativeTransform(new Q(1,0,30,0,1,50)),pe(c,"rect").setRelativeTransform(new Q(1,0,130,0,1,250));let p=gn(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),_=Lr.computeDragVector1(d,p,l,a.prototypeStructure(),a.prototypeState());i(_,new F(100,200))}])}),ce("Smart animate drag - matched object with translation, rotation, and resizing",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setSize(new F(100,100)),d.setRelativeTransform(Q.new2().translatedBy1(d.size().negative().divideScalar(2)));let u=pe(c,"rect");u.setSize(new F(200,100));let p=Q.new2().translatedBy1(u.size().negative().divideScalar(2));p.postRotate(Math.PI/2),p.postTranslate(new F(100,200)),u.setRelativeTransform(p);let _=gn(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),h=Lr.computeDragVector1(d,_,l,a.prototypeStructure(),a.prototypeState());i(h,new F(100,200))}])}),ce("Smart animate drag - no matches",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setRelativeTransform(new Q(1,0,30,0,1,50));let u=gn(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),p=Lr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(p,null)}])}),ce("Smart animate drag - overlay swap with matched object with translation",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),u=ht(d,"overlayA"),p=ht(d,"overlayB"),_=pe(u,"rect");_.setRelativeTransform(new Q(1,0,30,0,1,50)),pe(p,"rect").setRelativeTransform(new Q(1,0,130,0,1,250));let g=gn(_,p,"DRAG","SMART_ANIMATE","SWAP");gn(l,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let m=Lr.computeDragVector1(_,g,l,a.prototypeStructure(),a.prototypeState());i(m,new F(100,200))}])}),ce("Smart animate drag - overlay swap with no matches",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),u=ht(d,"overlayA"),p=ht(d,"overlayB"),_=pe(u,"rect");_.setRelativeTransform(new Q(1,0,30,0,1,50));let h=gn(_,p,"DRAG","SMART_ANIMATE","SWAP");gn(l,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let g=Lr.computeDragVector1(_,h,l,a.prototypeStructure(),a.prototypeState());i(g,null)}])}),ce("Move in smart animate drag - matched object with translation",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setRelativeTransform(new Q(1,0,30,0,1,50)),pe(c,"rect").setRelativeTransform(new Q(1,0,130,0,1,250));let p=tf(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),_=Lr.computeDragVector1(d,p,l,a.prototypeStructure(),a.prototypeState());i(_,new F(100,200))}])}),ce("Move in smart animate drag - no matches",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setRelativeTransform(new Q(1,0,30,0,1,50));let u=tf(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),p=Zr.get("MOVE_FROM_LEFT").enteringFrameTransition(),_=c.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=Lr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),ce("Screen swipe drag - nested node move in transition",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setRelativeTransform(new Q(1,0,30,0,1,50));let u=gn(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),p=Zr.get("MOVE_FROM_LEFT").enteringFrameTransition(),_=c.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=Lr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),ce("Screen swipe drag - nested node move out transition",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect");d.setRelativeTransform(new Q(1,0,30,0,1,50));let u=gn(d,c,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),p=Zr.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),_=l.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=Lr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),ce("Screen swipe drag - TLF move in transition",()=>{e([(a,s,l,c)=>{let d=gn(l,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=Zr.get("MOVE_FROM_LEFT").enteringFrameTransition(),p=c.size().multiply(u.to().translation1().subtract(u.from().translation1())),_=Lr.computeDragVector1(l,d,l,a.prototypeStructure(),a.prototypeState());i(_,p)}])}),ce("Back screen swipe drag - TLF was opened by move in",()=>{e([(a,s,l,c)=>{var m;gn(l,c,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),rf(c),of(c,"DRAG");let d=l.prototypeInteractions()[0],u=(m=d.action())==null?void 0:m.value;a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().navigateToFrameAndCloseOverlays(u.transitionNodeID(),a.baseScreenNode(),1,0,4,d,u),a.prototypeState().commitStateChange();let p=Zr.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),_=c.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=c.prototypeInteractions()[0],g=Lr.computeDragVector1(c,h,c,a.prototypeStructure(),a.prototypeState());i(g,_)}])}),ce("Overlay swipe drag - overlay move in transition",()=>{e([(a,s,l,c)=>{gn(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),c.setSize(new F(250,250)),c.setOverlayPositionType("TOP_LEFT");let d=Lr.computeDragVector1(l,l.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(d,new F(c.size().x(),0))}])}),ce("Overlay swipe drag - overlay move in transition with nested source",()=>{e([(a,s,l,c)=>{let d=pe(l,"rect"),u=gn(d,c,"DRAG","MOVE_FROM_LEFT","OVERLAY");c.setSize(new F(250,250)),c.setOverlayPositionType("TOP_LEFT");let p=Lr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(p,new F(c.size().x(),0))}])}),ce("Close overlay swipe drag - overlay opened by move in",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),u=ht(d,"overlayA");u.setSize(new F(250,250)),u.setOverlayPositionType("TOP_LEFT");let p=pe(u,"rect");p.setRelativeTransform(new Q(1,0,30,0,1,50)),gn(l,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),Rv(p),of(p,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(u.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let _=Zr.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),h=u.size().multiply(_.to().translation1().subtract(_.from().translation1())),g=Lr.computeDragVector1(p,p.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(g,h)}])}),ce("Overlay go back swipe drag - no back frame",()=>{e([(a,s,l,c)=>{c.setSize(new F(250,250)),c.setOverlayPositionType("TOP_LEFT"),gn(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),rf(c),of(c,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(c.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let d=Lr.computeDragVector1(c,c.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(d,null)}])}),ce("Drag - invalid navigate transition",()=>{e([(a,s,l,c)=>{gn(l,c,"DRAG","DISSOLVE","NAVIGATE");let d=Lr.computeDragVector1(l,null,l,a.prototypeStructure(),a.prototypeState());i(d,null)}])})}),Ct("Drag progress measurement:",()=>{let a;beforeEach(()=>{a=new $i,Ze.dangerouslyPushMockTime(a)}),afterEach(()=>{Ze.popMockTime()}),ce("Simple drag velocity and progress measurement",()=>{e([(s,l,c,d)=>{let u=(O,f,I)=>{yn(I,f,`Expected velocity at timestep ${O} to equal ${f}, got ${I}`)};s.prototypeState().setIsDragging(!0);let p=new Lr(null,new F(1,0),null,null);p.handleDragStart(new F(0,0)),p.handleDrag(new F(0,0));let _=p.onTickProgress();i(_,0),a.advanceSeconds(1),p.handleDrag(new F(.5,0));let h=p.onTickProgress();i(h,.5);let g=p.signedDragSpeed();u(1,.5,g),a.advanceSeconds(.5),p.handleDrag(new F(1,0));let m=p.onTickProgress();i(m,1);let A=p.signedDragSpeed();u(2,1,A),a.advanceSeconds(1);let S=p.onTickProgress();i(S,1);let T=p.signedDragSpeed();u(3,0,T),a.advanceSeconds(.1),p.handleDrag(new F(.5,0));let R=p.onTickProgress();i(R,.5);let b=p.signedDragSpeed();u(4,-5,b)}])}),ce("Different-direction drag velocity and progress measurement",()=>{e([(s,l,c,d)=>{s.prototypeState().setIsDragging(!0);let u=new Lr(null,new F(1,0),null,null);u.handleDragStart(new F(0,0)),u.handleDrag(new F(0,0));let p=u.onTickProgress();i(p,0),a.advanceSeconds(1),u.handleDrag(new F(0,.5));let _=u.onTickProgress();i(_,0);let h=u.signedDragSpeed();mS(1,0,h),a.advanceSeconds(1),u.handleDrag(new F(-.5,0));let g=u.onTickProgress();i(g,0);let m=u.signedDragSpeed();mS(2,-.5,m),a.advanceSeconds(1),u.handleDrag(new F(.5,1));let A=u.onTickProgress();i(A,.5);let S=u.signedDragSpeed();mS(3,1,S)}])})})}o.testDragToAnimateBehavior=n})(LN||(LN={}));var wM;(s=>{function t(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2);let _=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),3);l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),d.free(),p.free(),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*2);let h=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),4);l(u.area.byteOffset(),0),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()),l(h.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*3),l(c.context.buffers.length,1);let g=c.context.buffers[0];u.check(g),_.check(g),h.check(g)}s.testBasicVertexBufferPoolGC=t;function e(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2);let _=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),3);l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),d.free(),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*3);let h=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),4);l(u.area.byteOffset(),0),l(p.area.byteOffset(),c.quarterChunkSizeInBytes()),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(h.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),l(c.context.buffers.length,1);let g=c.context.buffers[0];u.check(g),p.check(g),_.check(g),h.check(g)}s.testBasicVertexBufferPoolGC2=e;async function r(){Bt.updateFeatureGateForTesting("viewer_cleanup_buffer_areas",!0);let l=AssertLib.deepStrictEqual,c=new a,d=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2);let _=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),3);l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),d=null,p=null,await e4(),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*2);let h=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),4);l(u.area.byteOffset(),0),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()),l(h.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*3),l(c.context.buffers.length,1);let g=c.context.buffers[0];u.check(g),_.check(g),h.check(g)}s.testVertexBufferPoolGCAfterSystemGC=r;function n(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(bt.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2),u.free();let _=c.add(bt.getPositionF2(),c.chunkSizeInBytes()/2|0,3);l(d.area.byteOffset(),0),l(p.area.byteOffset(),c.quarterChunkSizeInBytes()),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),l(c.context.buffers.length,1);let h=c.context.buffers[0];d.check(h),p.check(h),_.check(h)}s.testByteOffsetBugFig5426=n;function o(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(bt.getPositionF2(),8,0);l(d.area.byteOffset(),0);let u=c.add(bt.getPositionF2(),8,1);l(u.area.byteOffset(),8);let p=c.add(bt.getPositionF4CoordF4(),32,2);l(p.area.byteOffset(),32);let _=c.add(bt.getPositionF4CoordF4(),32,3);l(_.area.byteOffset(),64),u.free(),p.free();let h=c.add(bt.getPositionF2(),c.chunkSizeInBytes()-64,4);l(d.area.byteOffset(),0),l(_.area.byteOffset(),32),l(h.area.byteOffset(),64),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()-64+40),l(c.context.buffers.length,1);let g=c.context.buffers[0];d.check(g),_.check(g),h.check(g)}s.testStrideBugFig5426=o;class i{free(){this.area.free(),this.area.wasFreed()}check(c){let d=c.bytesForUpload();if(d==null){return}for(let u=0,p=this.bytes.length;u<p;u=u+1)d[this.area.byteOffset()+u]==this.bytes[u]}constructor(c,d){this.bytes=c,this.area=d}}s.Result=i;class a{constructor(){this.context=new gi,this.pool=this.context.createVertexBufferPool()}add(c,d,u){let p=new Uint8Array(d);p[0]=u*2+1,p[p.length-1]=u*2+2;let _=this.pool.allocateVertexBufferAreas(ze.TRIANGLE_STRIP,c,p);return _.length,_[0],_[0].byteCount()==d,_[0].wasFreed(),new i(p,_[0])}chunkSizeInBytes(){return this.pool.chunkSizeInBytes()}quarterChunkSizeInBytes(){return this.chunkSizeInBytes()/4}}s.Helper=a})(wM||(wM={}));function $z(t){return new Promise(e=>setTimeout(e,t))}async function e4(){window.gc(),await $z(100)}var oYe=4*1024*1024;function MN(t){return pu("effects",{data:t,blobs:[]})}function BN(t){return pu("fillPaints",{data:t,blobs:[]})}var RA=class RA{constructor(){this._paintToOriginal=new WeakMap;this._effectToOriginal=new WeakMap;this._serialization=null}setSerialization(e){this._serialization=e}decodeCodeSnapshot(e){let r=Be().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let l=r.nodeChanges[0];n=this._serialization.decodePaints(l.codeSnapshot.paints,r.blobs)}catch(l){xe("Caught error during fill paints marshaling. Rendered output may be incorrect"),xe(l),n=[]}let o=Tt.decodeVector(r.nodeChanges[0].codeSnapshot.offset),i=Tt.decodeVector(r.nodeChanges[0].codeSnapshot.layoutSize),a=Tt.decodeVector(r.nodeChanges[0].codeSnapshot.canvasSize),s=r.nodeChanges[0].codeSnapshot.devicePixelRatio;return new Bd(n,o,i,a,s)}decodeFillPaintData(e,r){if(e.length==0)return Ce.EMPTY;let n=Be().decodeMessage(e);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let o=null;try{let i=n.nodeChanges[0],a=i.fillPaints!=null?i.fillPaints:i.strokePaints;o=this._serialization.decodePaints(a,n.blobs)}catch(i){xe("Caught error during fill paints marshaling. Rendered output may be incorrect"),xe(i),o=Ce.EMPTY}return this._paintToOriginal.set(o,r),o}decodeSingleSolidFillWithNormalBlendMode(e,r,n,o){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let i=new $("SOLID");i.setColor(N.new3(e.red,e.green,e.blue,e.alpha)),i.setOpacity(r),i.setIsEnabled(n);let a=[i];return this._paintToOriginal.set(a,o),a}decodeEffectData(e,r){let n=Be().decodeMessage(e);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let o=Tt.decodeEffects(n.nodeChanges[0].effects);return this._effectToOriginal.set(o,r),o}decodeTransformModifierData(e){let r=Be().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return Tt.decodeTransformModifiers(r.nodeChanges[0].transformModifiers)}decodePrototypeInteractions(e){let r=Be().decodeNodeChange(e);if(r==null)throw new Error("Got bad node change from C++");return Tt.decodePrototypeInteractions(r.prototypeInteractions)}decodeVectorData(e){let r=Be().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(r.nodeChanges[0].vectorData,r.blobs)}decodeTextData(e){let r=Be().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=this._serialization.decodeTextData(r.nodeChanges[0].textData,r.blobs);return new ls(n.styleOverrideTable(),n.fontSizes(),n.characters(),n.lines(),n.characterStyleIds())}decodeDerivedTextData(e,r,n){let o=Be().decodeMessage(e);if(o.nodeChanges===void 0||o.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let i=this._serialization.decodeDerivedTextData(o.nodeChanges[0].derivedTextData,o.blobs),a=[];for(let s of r)a.push(this._serialization.decodeEmojiImage(s,n));return new Pl(i.hyperlinkBoxes(),r,a)}encodeFillPaintsToString(e){let r=this._serialization.encodePaints(e);return BN(r)}encodeEffectDataToString(e){let r=this._serialization.encodeEffects(e);return MN(r)}getOriginalPaintData(e){return this._paintToOriginal.get(e)??0}getOriginalEffectData(e){return this._effectToOriginal.get(e)??0}};RA.instance=new RA;var wh=RA;var yA=class{constructor(e){this._viewerStatsigConfigBindings=e}getDynamicConfigBoolean(e,r,n){return this._viewerStatsigConfigBindings.getDynamicConfigBoolean(e,r,n)}getDynamicConfigNumber(e,r,n){return this._viewerStatsigConfigBindings.getDynamicConfigNumber(e,r,n)}getDynamicConfigString(e,r,n){return this._viewerStatsigConfigBindings.getDynamicConfigString(e,r,n)}getExperimentBoolean(e,r,n){return this._viewerStatsigConfigBindings.getExperimentBoolean(e,r,n)}getExperimentNumber(e,r,n){return this._viewerStatsigConfigBindings.getExperimentNumber(e,r,n)}getExperimentString(e,r,n){return this._viewerStatsigConfigBindings.getExperimentString(e,r,n)}getFeatureGate(e){return this._viewerStatsigConfigBindings.getFeatureGate(e)}logFeatureGateExposure(e,r){this._viewerStatsigConfigBindings.logFeatureGateExposure(e,r)}updateFeatureGateForTesting(e,r){Yr(),this._viewerStatsigConfigBindings.updateFeatureGateForTesting(e,r)}setInRenderServerForViewerTests(){var e;Yr(),(e=this._viewerStatsigConfigBindings)==null||e.setInRenderServerForViewerTests()}clearFeatureGatesForTesting(){var e;Yr(),(e=this._viewerStatsigConfigBindings)==null||e.clearFeatureGatesForTesting()}updateExperimentForTesting(e,r,n){Yr(),this._viewerStatsigConfigBindings.updateExperimentForTesting(e,r,n)}clearExperimentsForTesting(){var e;Yr(),(e=this._viewerStatsigConfigBindings)==null||e.clearExperimentsForTesting()}};var bA=class{constructor(e){this._clipInstanceIdToAnimate=null;this._timelineDuration=-1;this._appState=e,this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}onFrame(){var r;if(!this._clipInstanceIdToAnimate||this._timelineDuration<=0)return;let e=this._appState.scene();e&&(v().sceneGraphTsApi().timelineState(e.handle()).stateById.set([{timelineId:this._clipInstanceIdToAnimate,playbackInteractionTime:`${Date.now()*1e3%this._timelineDuration}`,status:tp.PLAYING}]),(r=v())==null||r.updateImmutableFramesAndLayoutDirtyGroupsAndStacks())}handleStateChangeCommitted(e,r){let n=this._appState.baseScreenNode();n.isClipInstance()?(this._clipInstanceIdToAnimate=n.id(),this._timelineDuration=n.timelineDuration()):(this._clipInstanceIdToAnimate=null,this._timelineDuration=-1)}handleStateChangeAborted(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}handleStateChangeInitiated(e){}};var vA=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new UN),this._preservers.push(new GN)}handleSceneChangedLoadingPhase(e,r){r==On.PENDING_LOAD_AFTER_RECONNECT?this.handleSceneWillRebuildAfterReconnect():e==On.PENDING_LOAD_AFTER_RECONNECT&&r==On.LOADED&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){xe("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(r=>{r.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,r){}handleDisconnect(){}handleJoinStart(e,r,n){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){this._isReconnecting&&this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,r){}},GN=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(Ae.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){qe.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(r,n)=>{let o=e.findNodeFromDeveloperFriendlyId(r);o!=null&&o.setScrollOffset(n)})}},UN=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new So}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(r=>{let n=e.findNodeFromDeveloperFriendlyId(r);n!=null&&n.setUsedAsBaseScreen(!0)})}};var CA=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._scene=r}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let r=0;r<this._scene.root().childCount();r=r+1){let n=this._scene.root().childAt1(r);n.type()=="CANVAS"&&!n.isInternalOnly()&&e.push({id:n.id(),name:n.name()})}return e}};var OA=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,r){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}handleSetVariableAction(e){}constructor(e){this.callback=e}};var VN;(o=>{function t(){return o._instance}o.instance=t;function e(i,a){o._instance=new r(i,a)}o.create=e;class r extends OA{constructor(a,s){super(l=>{this._emitter.trigger("topLevelFrameChange",null)}),this._dirtyNodes=null,this._emitter=null,this._scene=null,a.addFrameObserver(this),a.addAppObserver(this),a.prototypeState().addObserver(this),this._emitter=s,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new oa(a=>a)}handleSceneGraphEvent(a){switch(a.property){case 45:case 58:case 70:case 73:case 75:case 84:case 99:case 108:case 112:case 42:{this._dirtyNodes.add(a.node.id());break}}}handleSceneChange(a,s){a!=null&&a.removeObserver(this),s!=null&&s.addObserver(this)}handleActiveCanvasChange(a,s){}handleActivePrototypeStartingPointChange(a,s){}onFrame(){this._dirtyNodes.each(a=>{this._emitter.trigger("accessibilityNodeInvalidated",a)}),this._clearDirtySet()}}o._AccessibilityObserver=r,o._instance=null})(VN||(VN={}));function Lh(t){return{x:t.x(),y:t.y(),width:t.width(),height:t.height()}}function LM(t){let e=t.state().getActiveCanvas();if(e==null)return null;let r=e.backgroundColor();return r==N.TRANSPARENT?null:N.asFloattoJSON(r)}function MM(t){if(t.state().scene()==null)return null;let r=t.state().getActiveCanvas();if(r==null)return null;let n=U.prototypeBackgroundColorOverride!=null?U.prototypeBackgroundColorOverride.value:r.prototypeBackgroundColor();return n==N.TRANSPARENT?null:N.asInttoJSON(n)}function r4(t){let e=[];for(let r of t)e.push(X.fromString(r));return e}function n4(t){return{trigger:t.event().interactionType(),to:t.action().value.connectionType(),type:t.action().value.navigationType()}}function GM(t){return r=>{let n=r.subtract(t.canvasView().absoluteBounds().topLeft()),o=t.canvasView().canvasSpaceToWindowSpace().clone();return o.invert()?(o.transformPoint(n),n):null}}function UM(t,e){e.window().setRecordInteractionCallback(r=>{let n=Qu.serialize(r,t);n!==null&&Xt.getEventEmitter().trigger("recordInteraction",n)})}function o4(t){let e=GM(t);UM(e,t)}async function i4(t){var P;let e=0,r=t.interactionTestState;if(typeof r!="string"||r==="NONE")e=0;else if(r==="RECORD")e=1,D1();else if(r==="PLAYBACK")e=2,F1();else throw new Error(`Invalid interactionTestState ${r}`);Os.detect(),Qt.initialize(t),lr.initialize(),go.initialize(),U.initialize(t),yF(t.kiwiSchema),Bt.setDelegate(new yA(t.statsigViewerWebConfig)),Bu.initialize(t.safeModeOptions),xa.initialize(t.emscriptenGL);let n=new Yu(Qt.getContainerElement(),U.gameControllerListener(),new jS,0),o=n.multiplayerSession(),i=n.multiplayerCoupler(),a=Xt.getEventEmitter();new vA(o);let s=new Nh(n.state()),l=new CA(n.state());U.getFeatureFlags().metronome&&new bA(n.state());let c={clientId:null,allowedEmbedOrigins:null,embedHost:null},d=new URLSearchParams(window.location.search),u=d.get("client-id")||null,p=((P=window.INITIAL_OPTIONS)==null?void 0:P.allowed_embed_origins)||null,_=d.get("embed_host")||d.get("embed-host")||null;c={clientId:u,allowedEmbedOrigins:p,embedHost:_},Jl.init(n.state(),n.canvasView(),c);let h=null;U.getViewerMode()==U.ViewerMode.MIRROR&&(U.mirrorShouldUseInlinePreviewFrameLoader()?h=new Fh(n,o):h=new Ph(n,o));let g=null;t.enableLocalBroadcaster&&(g=new Dh(o));let m=null;t.enableLocalUserChangesHandler&&(m=new xh(o,i),n.multiplayerSession().addLocalUserChangesHandler(m)),a.on("documentSyncingMessage",E=>{Re.trackEvent("Viewer Document Syncing Message",{...E,hasPendingMirrorSelectionChange:(h==null?void 0:h.hasPendingSelectionChange())??!1,hasPendingPrototypeStateChange:n.state().prototypeState().hasRequestedStateChange()})});let A=t.connectionRole;if(typeof A=="string"){if(["viewer","prototype","popoutAudienceViewer"].indexOf(A)==-1)throw new Error(`Invalid connection role ${A}`);o.setRole(A)}a.on("sceneDidCompleteInitialLoad",E=>{let C=B=>{window.figmaPerfTesting&&window.postMessage({name:B,value:0},"*")};C("DOCUMENT_IS_LOADED"),window.DebuggingHelpers&&(window.DebuggingHelpers.documentIsLoaded=!0),n.canvasView().afterFrame=()=>{n.canvasView().afterFrame=null,C("AFTER_FIRST_RENDER"),a.trigger("documentIsLoaded")},n.canvasView().afterFirstRenderOfScreenStack=()=>{n.canvasView().afterFirstRenderOfScreenStack=null,C("AFTER_FIRST_RENDER_OF_TLF"),a.trigger("afterFirstRenderOfScreenStack")}});let S=null,T=null,R=null,b=null;e!=0&&(S=E=>{let C=E.clone();return n.canvasView().canvasSpaceToWindowSpace().transformPoint(C),C.add(n.canvasView().absoluteBounds().topLeft())},T=GM(n),R=E=>n.window().root().viewFromPoint(E),b=()=>n.window().focusedView()),e==1&&UM(T,n),n.state().addActionObserver(new Xt.ActionHandler);let O=new Xt.AppHandler(n.state());n.state().addFrameObserver(O),VN.create(n.state(),a),wn.addUpdate(_r.windowFrame(n.window().events()),E=>{o.maybeFlushNextUserChange(0)}),n.canvasView().onBaseScreenIdChanged=(E,C,B,G,V)=>{E!=null&&a.trigger("baseScreenChanged",{nodeId:E,userInitiated:C==1,updateURL:B,repairsInvalidState:G,isSymbol:V})},n.canvasView().onScalingModeChanged=E=>{a.trigger("scalingModeChanged",{contentScalingMode:E.contentScalingMode.toString(),viewportScalingMode:E.fitMode.toString()})},n.canvasView().disengageObservationMode=()=>{a.trigger("disengageObservationMode")},n.canvasView().viewportTracker().onChange=(E,C)=>{a.trigger("viewportChanged",{offset:{x:E.x(),y:E.y()},zoomScale:C})},n.canvasView().onResize=()=>{a.trigger("canvasResize")},n.canvasView().onURLClicked=(E,C)=>{a.trigger("urlClicked",{url:E,openInNewWindow:C})},n.canvasView().onNavigateToPrototype=(E,C)=>{a.trigger("navigateToPrototype",{fileKey:E,guid:C})},Vo.instance().startLibLoad=()=>{a.trigger("loadVideoJsLib",{})},l.onChange=E=>{a.trigger("pagesChange",E)},s.notifyCommentPositionsChange=()=>{a.trigger("watchedNodeBoundsChange")},new $c(n.state(),2,E=>{a.trigger("backgroundColorChange",LM(n))}),new $c(n.state(),59,E=>{a.trigger("prototypeBackgroundColorChange",MM(n))}),new $c(n.state(),60,E=>{a.trigger("prototypeDeviceChanged",E!=null?E.toJSON():null)});let f=[],I={appState:()=>n.state(),multiplayer:()=>o,prototypeState:()=>n.state().prototypeState(),logAndGetDocument:()=>{var C;let E=(C=n.state().scene())==null?void 0:C.root();return E!=null?console.log(E.debugString()):console.log("Document root not found \u{1F630}"),E},logAndGetBaseScreen:()=>{let E=n.state().baseScreenNode();return E!=null?console.log(E.debugString()):console.log("Base screen not found \u{1F630}"),E},logAndGetNode:E=>{var B;let C=(B=n.state().scene())==null?void 0:B.findNode(E);return C!=null?console.log(C.debugString()):console.log(`Node with id ${E??"null"} not found!`),C},logAndGetNodeByStablePath:E=>{var B;let C=(B=n.state().scene())==null?void 0:B.findNodeByStablePath(Rt.fromString(E));return C!=null?console.log(C.debugString()):console.log(`Node with stablePath ${E??"null"} not found!`),C},logAndGetRenderTree:E=>{var B,G;let C=(B=n.state().scene())==null?void 0:B.findNode(E);return C!=null?console.log(((G=C.renderTree1())==null?void 0:G.debugString1())??"null"):console.log(`Node with id ${E??"null"} not found!`),C.renderTree1()},logFakeError:E=>{N1(E)},logMultiplayerUserDebugInfo:()=>{console.log(JSON.stringify(o.debugInfo(),null,2))},setDebugUserChanges:E=>{Es.debugUserChanges=E},fulfilledMultiplayerQueries:()=>o.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(n.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(n.state().videoManager().runtimeStorage().toString1())},ScrollPositionStorageTrie:()=>{console.log(n.canvasView().scrollPositionSyncer().debugString())},getMemoryBreakdown:()=>{let E=v().modules().corePerfInfo;return{jsBuffers:E==null?void 0:E.getJsBufferMemory(),memStats:E==null?void 0:E.getMemStatsSummary()}}};U.getFeatureFlags().internal_only_debug_tools&&(window.DebuggingHelpers=I);let y={setObservingSessionID:E=>{if(!md(E))throw new Error("Missing sessionID");let C=E|0;C!=o.observingSessionID()&&(o.setObservingSessionID(C),i.syncObserved({allowTransitions:!1,isNewObservation:!0}),a.trigger("multiplayerUserInfoChange",i.userInfoJSON()),n.canvasView().viewport().invalidate())},setObservingSessionIdWithoutSync:E=>{let C=E|0;C!=o.observingSessionID()&&(o.setObservingSessionID(C),a.trigger("multiplayerUserInfoChange",i.userInfoJSON()),n.canvasView().viewport().invalidate())},syncThenSetObservingSessionIdOverLocal:E=>{g==null||g.sendObservingSessionIdMessage(E)},forceFlushNextUserChange:()=>{o.pushAllVideoStateChanges(),o.maybeFlushNextUserChange(1)},nominatePresenter:E=>{if(!md(E))throw new Error("Missing sessionID");o.nominatePresenter(E|0)},cancelPresenterNomination:E=>{if(!md(E))throw new Error("Missing sessionID");o.cancelPresenterNomination(E|0)},startPresenting:()=>{o.startPresenting()},stopPresenting:()=>{o.stopPresenting()},setSlideSpeakerNotes:(E,C)=>{o.setSlideSpeakerNotes(E,C)},setInteractiveSlideConfigData:(E,C,B)=>{o.setInteractiveSlideConfigData(E,C,B)},setInteractiveSlideParticipantData:(E,C,B)=>{o.setInteractiveSlideParticipantData(E,C,B)},adjustZoom:(E,C)=>{n.canvasView().viewport().adjustCameraZoom2(1,E,C)},setZoom:(E,C)=>{n.canvasView().viewport().setCameraZoom(1,E)},zoomToNode:(E,C)=>{var G;let B=(G=n.state().scene())==null?void 0:G.findNode(X.fromString(E));B!=null&&(n.state().setActiveCanvas(B.canvas()),n.canvasView().viewport().zoomToFit1(1,B.canvasSpaceBoundingBox(),C))},getClampedZoomBounds:()=>{var E;return{min:Math.max(wo.ZOOM_MIN,n.canvasView().viewport().getScaleFactorForCurrentTlf((E=n.state().baseScreenNode())==null?void 0:E.fullSize(),n.state().currentScalingInfo(),n.state().activePrototypeDevice())),max:wo.ZOOM_MAX}},getZoomBounds:()=>({min:wo.ZOOM_MIN,max:wo.ZOOM_MAX}),setCanvasSpaceCenter:(E,C)=>{let B=new F(-1*E.x,-1*E.y);n.canvasView().viewport().setCameraOffset2(1,B,C)},setCanvasSpaceCenterWithScroll:E=>{var k;let C=new F(E.x,E.y),B=(k=n.state().baseScreenNode())==null?void 0:k.canvasSpaceBoundingBox();if(B==null)return;let G=Math.max(C.x()-B.x(),0),V=Math.max(C.y()-B.y(),0),D=Math.max(G-B.width()/2,0),w=Math.max(V-B.height()/2,0);if(G!=0||V!=0){let z=new F(D,w);n.canvasView().updateScrollOffsetForNode(n.state().prototypeState().getTopmostScreen(),z)}},setScrollPadding:E=>{n.canvasView().setScrollPadding(+E.left,+E.top,+E.right,+E.bottom)},setScrollToPan:E=>{U.setScrollToPan(E)},setDragToPan:E=>{U.setDragToPan(E)},setShouldPlayVideosLinearly:E=>{U.setShouldPlayVideosLinearly(E)},injectVideoJsLib:E=>{Vo.instance().onLoadComplete(E)},connectTo:(E,C)=>{let B={prototypeApp:po.instance,viewerJsKiwiSerialization:Qh(),deprecatedJsSceneHooks:po.instance};C(B).then(G=>{let V=G.cppModules;n.state().setFontListPromise(G.fontListPromise),U.getFeatureFlags().internal_only_debug_tools&&(I.fullscreen=V==null?void 0:V.sharedDebuggingHelpers,window.DebuggingHelpers=I);let D=E.fileKey,w=X.fromString(E.nodeId);X.isRoot(w)&&(w=null),U.getViewerMode()==U.ViewerMode.MIRROR&&h!=null?h.connectToFileAndShowNode(D,w,X.fromString(E.startingPointNodeId),!!E.renderDots,V,E.editorType):n.connectTo(D,w,X.fromString(E.startingPointNodeId),!!E.renderDots,V,E.editorType)})},openFileKey:()=>o.fileKey()??n.state().currentFileKey(),isConnected:()=>o.isConnected(),hasActiveScene:()=>n.state().scene()!=null,unloadSceneForTesting:()=>{o.disconnect(),n.state().prototypeState().resetPrototype(),n.state().setScene(null)},disconnectForTesting:()=>{o.disconnect()},reconnectForTesting:()=>{o.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{n.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:E=>{let C=n.state().scene();if(C==null)throw new Error("No current scene");C.removeNode(X.fromString(E))},translateNodeForTesting:(E,C,B)=>{let G=n.state().scene();if(G==null)throw new Error("No current scene");let V=G.findNode(E);if(V==null)throw new Error("Node not found");let D=V.relativeTransform().clone();D.translate2(C,B),V.setRelativeTransform(D)},addCanvasViewObserverForTesting:(E,C)=>{let B=new uA((G,V,D,w)=>{E()},G=>{C(G.scrollOffset().x(),G.scrollOffset().y())});f.push(B),n.canvasView().addObserver(B)},clearCanvasViewObserversForTesting:()=>{for(let E of f)n.canvasView().removeObserver(E);f=[]},sendMultiplayerNodeChangesForTesting:E=>{let C=n.state().scene();if(C==null)throw new Error("No current scene");let B=Be().encodeMessage(E);C.applyMessageToScene(B)},setMockEmbedListener:E=>{Jl.setMockListener(E)},isPreloaded(){return n.state().isPreloaded},setMaximumDrawingBufferSizeForTesting:E=>{n.canvasView().setMaximumDrawingBufferSizeForTesting(E)},clearMaximumDrawingBufferSizeForTesting:()=>{n.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{n.canvasView().triggerResizeForTesting()},getVideoStateForNodeIdForTesting:E=>n.state().prototypeState().getVideoStateChangeForGuid(E),waitForAllVisibleVideosToLoadForTesting:()=>new Promise((C,B)=>{let G=1,V=()=>{n.state().prototypeState().allVisibleVideosAreLoaded()?C(!0):G>3?C(!1):(G++,setTimeout(V,G*1e3))};V()}),reset:()=>{n.state().prototypeState().resetState(),n.unloadSceneAndResetPrototypeLib()},loadFile:(E,C)=>{let B={prototypeApp:po.instance,viewerJsKiwiSerialization:Qh(),deprecatedJsSceneHooks:po.instance};C(B).then(G=>{let V=G.cppModules;n.state().setFontListPromise(G.fontListPromise),n.initializePrototypeLib(V),U.getFeatureFlags().internal_only_debug_tools&&(I.fullscreen=V==null?void 0:V.debuggingHelpers,window.DebuggingHelpers=I);let D=E.bytes,w=X.fromString(E.nodeId);X.isRoot(w)&&(w=null);let k=E.startingPointNodeId,z=E.imagePrefixURL,H=E.videoPrefixURL,K=E.renderDots,j=E.editorType;typeof z=="string"&&Qt.setImagePrefixURL(z),typeof H=="string"&&Qt.setVideoPrefixUrl(H),n.state().serialization().decodeSceneWithImages(D,"DUMMY_FILE_KEY").then(J=>{if(o.disconnect(),n.state().prototypeState().mostRecentBaseScreenIdChangeInitiator="externalAPI.loadFile",n.state().prototypeState().resetPrototype(),n.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.loadFile 1",n.state().setScene(J),n.state().setRenderDots(!!K),n.canvasView().setBackgroundEnabled(!K),n.state().setEditorType(j),n.canvasView().initializeThumbnailInvalidationManager(j),J.setAllTlfsLoaded(),U.getViewerMode()==U.ViewerMode.PROTOTYPE){let ie=n.state().scene().findNode(w);if(ie==null){let Ve=n.state().scene().findNode(X.fromString(k));if(Ve!=null&&Ve.isTopLevel()&&CF(Ve)&&(ie=Ve),ie==null){let at=n.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();at.length>0&&(ie=n.state().scene().findNode(X.fromString(at[0])))}}n.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.loadFile 2",n.state().setActivePrototypeStartingPointNodeId(X.fromString(k));let Ee=n.state().prototypeStructure().nodeToRestartPrototypeOn(n.state().getActiveCanvas()),Ke=ie==null?void 0:ie.topLevelAncestor();if(Ke!=null)n.state().prototypeState().navigateToFrameAndCloseOverlays(Ke.id());else if(Ee!=null)n.state().prototypeState().navigateToFrameAndCloseOverlays(Ee.id());else if(!Ca)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}n.state().fontListPromise().then(()=>{a.trigger("sceneDidCompleteInitialLoad")})})})},navigateForward:E=>{n.canvasView().navigateForward(19,E)},navigateBackward:()=>{n.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:E=>{let C=X.fromString(E);C!=null&&n.state().prototypeState().navigateToFrameAndCloseOverlays(C)},navigateToFrameAndCloseOverlaysOrRestart:E=>{let C=X.fromString(E);C!=null&&n.state().prototypeState().navigateToFrameAndCloseOverlaysOrRestart(C,"externalAPI.navigateToFrameAndCloseOverlaysOrRestart")},navigateToFrameAtIndex:E=>{n.canvasView().navigateToFrameAtIndex(E)},navigateViaArrows:(E,C)=>{let B=n.state().prototypeStructure().navigationOrder().transitionDirectionBetweenFrames(X.fromString(E),X.fromString(C));n.canvasView().navigateViaArrows(E,C,B,null)},setPreloaded:E=>{n.state().isPreloaded=E},restartPrototype:()=>{n.state().prototypeState().restartPrototype(1)},forceFrame:()=>{n.window().forceFrame!=null&&um(()=>{n.window().forceFrame()})},setScalingMode:E=>{typeof E=="string"?(E==="free"&&console.warn("setScalingMode('free') called "),n.state().prototypeState().setScalingInfoFromParameter(E)):E.hasOwnProperty("contentScalingMode")&&E.hasOwnProperty("viewportScalingMode")&&(E.viewportScalingMode==="free"&&console.warn("setScalingMode('free') called "),n.state().prototypeState().setScalingInfoFromParameter(E.viewportScalingMode,E.contentScalingMode)),n.state().prototypeState().getCurrentFitMode()=="min-zoom"&&n.canvasView().viewport().setCameraZoom(0,1)},getTransitionOnClick:()=>n.state().prototypeState().getTransitionOnClick(),setTransitionOnClick:E=>{n.state().prototypeState().setTransitionOnClick(E)},setShowHotspots:E=>{n.canvasView().setShowHotspots(E)},setShowDeviceFrame:E=>{n.state().prototypeState().setShowDeviceFrame(E),n.canvasView().viewport().invalidate()},setShowBareUI:E=>{n.state().prototypeState().setShowTransparentBackground(E),n.canvasView().viewport().invalidate()},setShouldRenderCursor:E=>{n.canvasView().dangerouslyAccessProtoRenderManager().setShouldRenderCursor(E)},setDisengageObservationOnClick:E=>{n.state().prototypeState().setDisengageObservationOnClick(E)},setInteractionsEnabled:E=>{n.state().prototypeState().setInteractionsEnabled(E)},toggleInteractionRecording:E=>{E?o4(n):n.window().stopRecordingInteractions()},getBackgroundColor:()=>LM(n),getPrototypeBackgroundColor:()=>MM(n),getPrototypeStartNodeId:()=>{let E=null,C=n.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return C.length>0&&(E=X.fromString(C[0])),E==null||!X.isValid(E)?null:E},getActivePrototypeStartingPointNodeId:()=>{let E=n.state().activePrototypeStartingPointNodeId();return E==null||!X.isValid(E)?null:E},setActivePrototypeStartingPointNodeId:E=>{let C=X.fromString(E);n.state().activePrototypeStartingPointNodeId()!=C&&(n.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.setActivePrototypeStartingPointNodeId",n.state().setActivePrototypeStartingPointNodeId(C))},prototypeStartingPointsData:()=>{let E=n.state().prototypeStructure();return E==null?null:E.prototypeStartingPointsData()},getBaseScreenId:()=>n.state().baseScreenId(),isScalingModeResponsive:()=>n.state().currentScalingInfo().contentScalingMode==="responsive",getCurrentOverlayIdsForTesting:()=>n.state().prototypeState().getCurrentOverlayIds().map(E=>E),getOnscreenStatesForTesting:()=>n.state().prototypeState().getOnscreenStates().map(E=>({stablePath:E.a.guids.map(C=>C),stateId:E.b})),getRelativeTransformForNode:E=>{var B;let C=(B=n.state().scene())==null?void 0:B.findNode(X.fromString(E));return C?C.relativeTransform().clone():null},pageIdForNodeId:E=>{var G;let C=n.state().scene();if(C==null)return null;let B=C.findNode(E);return(G=B==null?void 0:B.findContainingCanvasOrSelf())==null?void 0:G.id()},navigationOrderType:()=>n.state().prototypeStructure().navigationOrder().navigationOrderTypeString(),supportsLinearNavigationOrder:()=>n.state().prototypeStructure().isLinear(),requestPage:E=>{var V;let C,B=X.fromString(E),G=(V=n.state().scene())==null?void 0:V.findNode(B);G!=null&&G.type()=="CANVAS"&&n.state().requestSetActiveCanvas(G)},setCurrentPageId:E=>{var V;let C,B=X.fromString(E),G=(V=n.state().scene())==null?void 0:V.findNode(B);G!=null&&G.type()=="CANVAS"&&n.state().setActiveCanvas(G)},getCurrentPageId:()=>{var C;let E=n.state().getActiveCanvas();return(C=E==null?void 0:E.findContainingCanvasOrSelf())==null?void 0:C.id()},getNodesToShowInPrototype:()=>n.state().prototypeStructure().navigationOrder().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{var B,G;let E=n.state().getActiveCanvas();if(E==null)throw new Error("Asking for stats without an active canvas");let C=E.prototypeDevice();return{pageId:E.id(),deviceType:C.type,deviceSizeWidth:C.size().x(),deviceSizeHeight:C.size().y(),presetIdentifier:C.presetIdentifier,graphicsCardName:n.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:k1(n.canvasView().getContext()),isHighDPR:U.isHighDPR(),fastImageDecode:Dn.browserSupportsFastImageDecoding(),baseScreenWidth:(B=n.state().baseScreenNode())==null?void 0:B.fullSize().x(),baseScreenHeight:(G=n.state().baseScreenNode())==null?void 0:G.fullSize().y(),isInlinePreview:U.isInlinePreview()}},getPrototypeDeviceType:()=>{let E=n.state().getActiveCanvas();return E==null?(xe("Asking for prototype device type without a playback canvas"),"NONE"):E.prototypeDevice().type},getStoredPrototypeDevice:()=>{let E=n.state().getActiveCanvas();return E==null?null:E.storedPrototypeDevice()},setStoredPrototypeDevice:E=>{let C=n.state().getActiveCanvas();return C==null?(xe("Trying to set prototype device type without a playback canvas"),null):E==null?(xe("Trying to set null prototype device type"),null):C.setPrototypeDevice(Tt.decodePrototypeDevice(E))},getCurrentTlfBounds:(E=!1)=>{var G;let C=(G=n.state().baseScreenNode())==null?void 0:G.canvasSpaceBoundingBox(),B=L.new2();return C==null?null:E?Lh(C):(C.transformInto2(B,n.canvasView().canvasSpaceToWindowSpace()),Lh(B))},setUserDidAttemptZoom:E=>{n.canvasView().userDidAttemptZoom=C=>{E(CN[C])}},getCanvasSpaceBoundsByNodeId:E=>{let C={},B=n.state().scene();if(B==null)throw new Error("No current scene");for(let G of E){let V=X.fromString(G);if(V==null)continue;let D=B.findNode(V);if(D==null)continue;let w=D.canvasSpaceBoundingBox();C[G]=new Map([["x",w.x()],["y",w.y()],["width",w.width()],["height",w.height()]])}return C},getFullSizeByNodeId:E=>{let C=n.state().scene();if(C==null)throw new Error("No current scene");let B=X.fromString(E);if(B==null)return null;let G=C.findNode(B);return G==null?null:G.fullSize().toJSON()},watchBoundsForNodes:E=>{let C=r4(E);s.setNodesWithComments(C)},getPrototypeStateCurrentIndex:()=>n.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>n.state().prototypeStructure().navigationOrder().getNavigateForwardEnabled(),getNavigateBackwardEnabled:()=>n.state().prototypeStructure().navigationOrder().getNavigateBackwardEnabled(),getPages:()=>l.pages(),viewport:()=>{let E=n.canvasView().viewport(),C=E.offset(),B=E.zoomScale();return{offset:{x:C.x(),y:C.y()},zoomScale:B}},getStatsForDebugging:()=>dn.getStatsForDebugging(),getGPUMemoryTotal:()=>n.canvasView().getContext().stats().total(),getGPUMemoryStats:()=>{let E=n.canvasView().getContext().stats();return{textures:E.forType(0),vertexBuffers:E.forType(1),renderBuffers:E.forType(2),uniformBuffers:0}},on:a.on.bind(a),off:a.off.bind(a),trigger:a.trigger.bind(a),playbackInteraction:E=>{if(e==2){let C=Qu.deserialize(E,R,b,S);n.window().notify(C)}},setNewContainerElement:E=>{n.window().setNewContainerElement(E)},editorTypeForTesting:()=>n.state().editorType(),canvasViewCursorForTesting:()=>Dm[n.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let E=n.state().prototypeState().lastInitiatedTopLevelStateChange();return E==null||E.transitionParameters==null?null:{type:E.transitionParameters.transitionType,durationSeconds:E.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let E=n.state().prototypeState().lastInitiatedInstanceStateChange();return E==null||E.transitionParameters==null?null:{type:E.transitionParameters.transitionType,durationSeconds:E.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:E=>{let C=n.state().scene();if(C==null)return{};let B=C.findNode(E);return B!=null?B.scrollOffset().toJSON():F.new().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(E,C)=>{let B=n.state().scene();if(B==null)return{};let G=B.findNode(E);return G!=null?G.scrollOffset().toJSON():F.new().toJSON()},getCanvasSpaceCommentLocations:E=>{let C=n.state().scene();if(C==null)return{};let B=new Map;for(let G in E)B.set(G,ud.fromJSON(E[G]));return s.getCanvasSpaceCommentLocations(C,B)},getCommentDestinationAtPosition:E=>{let C=new F(E.x,E.y),B=s.getCommentDestinationAtPosition(C);return B==null?null:B.toJSON()},onChange:E=>{var C;return(C=n.state().scene())==null?void 0:C.onChange(E)},hasValidScene:()=>{var E;return((E=n.state().scene())==null?void 0:E.isValidScene)??!1},getRevisionNumber:()=>{var E;return(E=n.state().scene())==null?void 0:E.getRevisionNumber()},setLoadFullDocument:E=>n.multiplayerSession().incrementalLoader().dangerouslySetLoadFullDocument(E),preloadAllImages:()=>{n.state().imageManager().preloadAllImages()},preloadAllVideos:()=>n.state().videoManager().preloadAllVideos(),unloadAllVideos:()=>{n.state().isPreloaded=!1,n.state().prototypeState().restartPrototype(1),n.state().videoManager().unloadAllVideos()},associateYoutubeWithNode:(E,C)=>{n.state().videoManager().associateYoutubeWithNode(E,C)},disassociateYoutubeWithNode:E=>{n.state().videoManager().disassociateYoutubeWithNode(E)},hasVideoControls:E=>{var B;let C=(B=n.state().scene())==null?void 0:B.findNode(E);return(C==null?void 0:C.videoPlayback().showControls)??!1},hasVideoRuntimes:E=>!!n.state().videoManager().getVideoRuntimesForNode(E),subscribeToVideoRuntimeUpdates:E=>n.state().videoManager().subscribeToVideoRuntimeUpdates(E),waitForVideoRuntimesToLoad:E=>{let C=n.state().videoManager().getVideoRuntimesForNode(E);return C==null?Promise.reject(new Error("No runtimes found")):Promise.all(Array.from(C.values()).map(B=>B.waitForLoad().realPromise())).then(()=>{})},getHtmlVideoElementForNode:E=>{let C=n.state().videoManager().getVideoRuntimesForNode(E);if(C==null)return null;for(let B of C.values()){let G=B.getHtmlVideoElement();if(G!=null)return G}return null},playVideoRuntimesForNode:E=>{let C=Ir.NULL_ACTION.withTransitionNodeID(E).withMediaAction("PLAY");n.state().videoManager().updateVideoRuntime(C,E)},pauseVideoRuntimesForNode:E=>{let C=Ir.NULL_ACTION.withTransitionNodeID(E).withMediaAction("PAUSE");n.state().videoManager().updateVideoRuntime(C,E)},setIsSeekingVideoRuntimesForNode:(E,C)=>{let B=n.state().videoManager().getVideoRuntimesForNode(E);if(B==null)return null;for(let G of B.values())G.setIsSeeking(C)},skipToVideoRuntimesForNode:(E,C)=>{let B=Ir.NULL_ACTION.withTransitionNodeID(E).withMediaAction("SKIP_TO").withMediaSkipToTime(C);n.state().videoManager().updateVideoRuntime(B,E)},muteVideoRuntimesForNode:E=>{let C=Ir.NULL_ACTION.withTransitionNodeID(E).withMediaAction("MUTE");n.state().videoManager().updateVideoRuntime(C,E)},unmuteVideoRuntimesForNode:E=>{let C=Ir.NULL_ACTION.withTransitionNodeID(E).withMediaAction("UNMUTE");n.state().videoManager().updateVideoRuntime(C,E)},preloadDeviceFrames:(E,C)=>{(async()=>(await n.canvasView().deviceRenderer().preloadDeviceImage(Tt.decodePrototypeDevice(E)),await Promise.all(C.map(B=>n.canvasView().deviceRenderer().preloadDeviceImage(Tt.decodePrototypeDevice(B))))))()},getNodeByIdForTests(E){var C;return(C=n.state().scene())==null?void 0:C.findNode(E)},initialLoadFrames(){return[n.state().baseScreenNode().parent().parent()]},loadFrames:(E,C)=>{let B=0,G=[];for(;E.length>0&&G.length+B<50;){let V=E.pop();if(V!=null){if(V.isTopLevel()&&(V.type()=="FRAME"||V.type()=="SLIDE")&&!V.isInternalOnly())if(V.hasBeenLoaded())B+=1;else{G.push(V);continue}(V.type()=="DOCUMENT"||V.type()=="CANVAS"||V.type()=="SECTION"||V.type()=="SLIDE_GRID"||V.type()=="SLIDE_ROW"||V.isSlideModule())&&!V.isInternalOnly()&&V.forEachChild(D=>{E.push(D)})}}return{nodesToVisit:[...E,...G],numLoaded:C+B}},areAllImagesLoaded:()=>n.state().imageManager().getImageLoadingProgress(),areAllVideosLoaded:E=>n.state().videoManager().getVideoLoadingProgress(E),getThumbnailForNode:(E,C,B)=>{var j;let G=(j=n.state().scene())==null?void 0:j.findNode(E);if(!G||!G.hasBeenLoaded())return console.error("Cannot get thumbnail for node that has not been loaded",E),null;let V=G.fullSizeCanvasSpaceBoundingBox().topLeft(),D=G.fullSize().x()/C,w=G.fullSize().y()/B,k=Math.max(D,w),z=new xn(V,k);return n.canvasView().thumbnailRenderer().generateThumbnail(G,z,C,B,1)},isWaitingForDeviceFrameToLoadForTesting:()=>{var C;let E=n.state().getActiveCanvas();return E==null?!1:(C=n.canvasView().deviceRenderer())==null?void 0:C.isWaitingForDeviceFrameToLoad(E.prototypeDevice())},prototypeViewHitTest:E=>{let C=new F(E.x,E.y),B=n.state().baseScreenNode();return B==null?{type:"NONE"}:n.canvasView().hitTestDeviceFrame(C)?{type:"DEVICE_FRAME"}:B.canvasSpaceBoundingBox().contains2(C)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:E=>{var C;return(C=n.state().scene())==null?void 0:C.findNode(E)},getPrototypeNodeHasLoaded:E=>{var B;let C=(B=n.state().scene())==null?void 0:B.findNode(E);return(C==null?void 0:C.hasBeenLoaded())??!1},getTopmostFrameNode:E=>n.state().prototypeState().getTopmostScreen(),mapChildren:(E,C)=>{let B=[];if(E.isStack())for(let G=0,V=E.childCount();G<V;G=G+1)B.push(C(E.childAt1(G)));else for(let G=0,V=E.childCount();G<V;G=G+1)B.push(C(E.childAt1(E.childCount()-G-1)));return B},nodeId:E=>E.id(),nodeName:E=>E.name(),nodeParent:E=>E.parent(),nodeType:E=>E.type(),nodeCanvasSpaceBounds:E=>Lh(E.canvasSpacePreviewBounds()),nodeAbsoluteTransform:E=>E.absoluteTransform(),nodeShapeWithTextType:E=>E.shapeWithTextType(),nodeDisplayBounds:E=>{let C=null;if(E.isTopLevel()){let B=n.state().prototypeState().getOpenOverlayData(E.id());B!=null?C=B.renderedBounds(n.state().prototypeState().getCurrentBaseScreenNode()):C=E.canvasSpaceScrolledBounds(1),C=n.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(C.clone())}else{let B=E.fullSize(),G=new L(0,0,B.x(),B.y()),V=E.relativeTransform().clone(),D=Q.new2();D.scale2(n.canvasView().viewport().canvasSpaceToViewSpace1().scale()),V.leftMultiply(D),C=V.transformRect(G)}return Lh(C)},nodeFullSize:E=>{if(E.type()=="CANVAS")return null;let C=E.fullSize(),B=new L(0,0,C.x(),C.y());return Lh(B)},nodeFillTypes:E=>E.fillPaints().map(C=>C.type()),nodeInteractions:E=>E.prototypeInteractions().filter(C=>{var B;return C.action()!=null&&((B=C.action())==null?void 0:B.value.connectionType())!="NONE"}).map(C=>n4(C)),nodeScrollBounds:E=>{let C=null;if(E.hasOverflowingContentInScrollDirection()){let B=E.canvasSpaceContentBounds(),G=E.scrollOffset();C={x:G.x(),y:G.y(),width:B.width(),height:B.height()}}return C},nodeScrollTo:(E,C,B)=>{E.setScrollOffset(new F(C,B))},nodeText:E=>{var C;return(C=E==null?void 0:E.textData())==null?void 0:C.characters()},nodeVisible:E=>E==null?!1:E.visible()&&E.localOpacity()>0,nodeAccessibilityProperties:E=>({label:E.accessibleLabel()}),nodeTextStyleNode(E){var B;let C=E.get(94);return(B=n.state().scene())==null?void 0:B.findStyle(C)},nodeCharacterStyles:E=>{var B,G,V;let C=(B=E==null?void 0:E.textData())==null?void 0:B.characters();if(C!=null){let D=Nr._new();Nr.set(D,28,E.get(28));let w=(G=E==null?void 0:E.textData())==null?void 0:G.characterStyleIds(),k=((V=E==null?void 0:E.textData())==null?void 0:V.styleOverrideTable())??new Bn,z=w!=null?w.length:0,H=0,K=0,j=[],q=(J,ie,Ee)=>{let Ke=new Map;Nr.each(D,(at,Dt)=>{Ke.set(Ht[at],Dt)});let Ve=k==null?void 0:k.styleByID2();if(Ve!=null){let at=nr.IntMap_get(Ve,Ee,null);at!=null&&Nr.each(at,(Dt,qt)=>{Ke.set(Ht[Dt],qt)})}j.push({start:J,end:ie,props:Ke})};for(let J=0,ie=C.length;J<ie;J=J+1){let Ee=z>J?w[J]:0;k._in(Ee)||(Ee=0),H!=Ee&&(q(K,J,H),H=Ee,K=J)}return q(K,C.length,H),j}else return[]},nodeLineData:E=>{var B;let C=(B=E==null?void 0:E.textData())==null?void 0:B.lines();return C!=null?C.map(G=>({indentLevel:G.indentationLevel,lineType:G.lineType})):null},nodeTriggerInteraction:(E,C)=>{let B=0;C=="ON_CLICK"&&(B=4);let G=n.state().prototypeStructure().findHotspotsWithInteractionType(E,0,C);for(let V of G){let D=n.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(V.node,C);for(let w of D){n.canvasView().triggerHotspot(V,w,B,null);return}}},nodeHover:E=>{let C=new Ki(E);n.canvasView().handleHoverAtHotspot(C)},nodeReverseHover:E=>{let C=new Ki(E);n.canvasView().handleReverseHoverAtHotspot(C)},nodeTableCells:E=>{if(E.type()!="TABLE")return null;let C=[];for(let B=0,G=E.childCount();B<G;B=B+1)C.push(E.childAt1(E.childCount()-B-1));return C},nodeTableCellContent:E=>{var C,B;return E.type()!="TABLE_CELL"?null:(B=(C=E.childAt1(0))==null?void 0:C.textData())==null?void 0:B.characters()},nodeInteractiveSlideElementType:E=>E.interactiveSlideElementType(),nodeInteractiveSlideConfigData:E=>E.interactiveSlideConfigData(),nodeInteractiveSlideParticipantData:E=>E.interactiveSlideParticipantData(),nodeSlideSpeakerNotes:E=>E.slideSpeakerNotes(),nodeIsSkippedSlide:E=>E.isSkippedSlide(),nodeSlideThumbnailHash:E=>E.slideThumbnailHash(),hasBeenManuallyRenamed:E=>E.hasBeenManuallyRenamed(),isPresenterSession:()=>n.multiplayerSession().isPresenterSession(),isObserving:()=>n.multiplayerSession().isObserving(),userSessionId:()=>n.multiplayerSession().sessionID(),observingSessionId:()=>n.multiplayerSession().observingSessionID(),setEmbeddedPrototypeSession:(E,C)=>{n.state().embeddedPrototypeManager().setSessionId(E,C)},isActiveSlidesEmbeddedPrototype:E=>n.state().embeddedPrototypeManager().isActiveSlidesEmbeddedPrototype(E),setActiveSlidesEmbeddedPrototype:E=>{n.state().embeddedPrototypeManager().requestPrototype(E)},getCurrentOverlayStack:()=>n.state().prototypeState().getCurrentOverlays().map(E=>E.node()),setFeatureFlagsForTesting:E=>{U.setFeatureFlags(E)},getCanvasAsBase64Image(){return new Promise((E,C)=>{if(!en){C(new Error("not running interaction test, skipping"));return}n.canvasView().getContext().gl().canvas.toBlob(G=>{if(!G){C(new Error("Failed to create blob from canvas"));return}let V=new FileReader;V.onload=()=>{E(V.result)},V.onerror=()=>{C(new Error("Failed to read blob as base64"))},V.readAsDataURL(G)})})},setPrototypeBackgroundColorOverride:E=>{let C=N.new2(E>>16&255,E>>8&255,E&255,255);U.setPrototypeBackgroundColorOverride(new fe(C))},resetStateForTests:()=>{n.canvasView().resetStateForTests(),n.window().resetStateForTests()},resetRendererForTests:()=>{n.canvasView().makeRenderer()},takeSpectorSnapshot:()=>{n.canvasView().viewport().invalidate(),n.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{n.canvasView().viewport().invalidate(),n.canvasView().clearTileCaches(),n.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{U.internalDebugTools()&&(n.canvasView().viewport().invalidate(),n.canvasView().clearTileCaches(),n.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{U.internalDebugTools()&&n.canvasView().renderLayerByLayerDecreaseSpeed()},convertCanvasSpaceToViewportSpace:E=>{let B=n.canvasView().viewport().canvasSpaceToViewSpace1().clone().transformPoint(new F(E[0],E[1]));return[B.x(),B.y()]},isRecordingCommands:()=>n.state().prototypeRecorder().isRecording(),beginRecordingCommands:()=>{n.state().prototypeRecorder().startRecording()},stopRecordingCommands:()=>(n.state().prototypeRecorder().stopRecording(),n.state().prototypeRecorder().getHistory()),getCurrentRecording:()=>n.state().prototypeRecorder().getHistory(),getNodeNameByGuid:E=>{if(n.state().scene()==null)return"";var C=null;return Rt.fromString(E)?C=n.state().scene().findNodeByStablePath(Rt.fromString(E)):C=n.state().scene().findNode(X.fromString(E)),C===null?"":C.name()},getNodeNameByStablePath:E=>{if(n.state().scene()==null)return"";let C=Rt.fromString(E),B=n.state().scene().findNodeByStablePath(C);return B===null?"no name":B.name()},getInteraction:(E,C)=>{var w,k,z,H;if(n.state().scene()==null)return"";var B=null;if(Rt.fromString(E)!=null?B=n.state().scene().findNodeByStablePath(Rt.fromString(E)):B=n.state().scene().findNode(E),B==null)return"";let G=B.findPrototypeInteraction(X.fromString(C)),V=(k=(w=G==null?void 0:G.action())==null?void 0:w.value)==null?void 0:k.connectionType();var D=V==null?void 0:V.toString();return V=="INTERNAL_NODE"&&(D=(H=(z=G==null?void 0:G.action())==null?void 0:z.value)==null?void 0:H.navigationType().toString()),D},runProtoCommand:E=>{var C;if(E.type!="MISCLICK")if(E.action==6||E.action==0)n.state().prototypeState().returnInstanceToState(Rt.fromString(E.targetPath??""),2,6);else if(E.action==16){let B=n.state().scene().findNodeByStablePath(Rt.fromString(E.targetPath??""));if(!E.scrollOffset)throw new Error("sessionAction.scrollOffset is undefined");let G=new F(E.scrollOffset.x,E.scrollOffset.y);n.canvasView().scrollNode(B.id(),bi.ScrollSource.SCROLL_EVENT,G,null)}else{let B=(C=n.state().scene())==null?void 0:C.findNodeByStablePath(Rt.fromString(E.targetPath??"")),G=lt.mapToInteractionType(E.action);y.nodeTriggerInteraction(B,G)}},toggleRenderTreePrinting:()=>{U.internalDebugTools()&&n.canvasView().toggleRenderTreePrinting()},getAndClearHistogramBatchFields:()=>rt.getAndClearHistogramBatchFields(),getAndClearSlowFrameTrackerFields:()=>rt.getAndClearSlowFrameTrackerFields(),clearAllSlowFrameTrackerFields:()=>{rt.clearAllSlowFrameTrackerFields()},getViewerGpuMetricsCurrentFrameJSON:()=>JSON.stringify(n.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().getCurrentFrameGPUMetrics()),getViewerGpuMetricsPreviousFrameJSON:()=>JSON.stringify(n.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().getPreviousFrameGPUMetrics()),gpuMetricsNextFrame:()=>{n.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().nextFrame()},setProtoUseFrameEvictionForUnitTests:E=>{U.setProtoUseFrameEvictionForUnitTests(E)},invalidateCanvas:()=>{n.canvasView().viewport().invalidate()}};return!1,po.instance.setViewer(y),y}function a4(){return{prototypeApp:po.instance,viewerJsKiwiSerialization:Qh(),deprecatedJsSceneHooks:po.instance}}function VM(){let t=window,e=t.Fig;e||(t.Fig=e={}),e.createViewer=async r=>{if(delete e.createViewer,!(r instanceof Object))throw new Error("Missing parameters");return await i4(r)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,a4())}function kM(){M1(new wh)}function s4(){kM(),VM()}s4();})();
//!!!!!!!!!!!!!!!!!!!!!!
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v3.5.0
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/08588730546aa443c78b47e1f1c68f15e49f5ecd/ts-viewer.js.map

//# debugId=59640c47-b740-5ab3-9686-7a0a662009b5
